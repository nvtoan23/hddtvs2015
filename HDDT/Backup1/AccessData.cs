using System;
using Microsoft.Win32;
using System.Data;
using System.Collections;
using System.Xml;
using System.Data.OleDb;
using System.Data.SqlClient;
using System.Data.OracleClient;
using System.Drawing;
using System.IO;
using System.Diagnostics;
using System.Runtime.InteropServices;
using dichso;
using ThongSoData.Medisoft;

namespace LibMedi
{
	public class AccessData
	{	
		public const string Msg="Medisoft THIS",Normal="Bình thường",Msg_di="Dinh dưỡng";
		public const string cdnguyennhan="BPH+BNG+BBO+BRA+BTA+BMA";
		public const string phainu="BPH+BSA";
		public const string sosinh="BSO+BMT+BNH";
		public const string phongluu="99";
		public const string ngoaikhoa="14+18+19+20+21+22+23+24+25+28";
		public string insert="ins",delete="del",dutru="dutru",duyet="duyet";
		public const string yhdt="16+26";
		public const string links_userid="links",links_pass="link7155019s20",uxxx="tuneig@mp",pxxx="tuneig@mp",xxxxx="¯Ò¡Ì©Î«³²°Ô£";
		public const int Tiepdon=0,Khambenh=1,Ngoaitru=2,Phongluu=3,Nhanbenh=4,Khoa=5,Phauthuthuat=6,Vienphi=7,Duoc=8,Xetnghiem=9,Sieuam=10,Noisoi=11,Xquang=12,Le=13,Khucxa=14,Cls=15,Taikham=16,Pttt=17;
		public const int giamdoc=1,phogiamdoc=2,truongkhoa=3,nhanvien=8,nghiviec=9,ybs_cls=10;
		public int iHaophi=5;
		string sConn="Data Source=MEDISOFT;user id=MEDIBV;password=MEDIBV";
		[DllImport("winmm.dll")]
		private static extern bool PlaySound(string lpszName, int hModule, int dwFlags);
		private int iRownum=1;
		private decimal _e = 0, _p = 0, _l = 0, _g = 0;
		private string ma16_ngtru_quyenloimoi="";
		private string ma18_ngtru_khongchitra="";
		
		OracleDataAdapter dest;
		OracleConnection con;		
		string sComputer=null;
		string m_hotenkdau,sql="",userid="medibv",service_name="medisoft",b_sobienlaitamung="", b_tatca_sobienlaitamung="";
		decimal tc_tamung=0;
		bool b_sovaovien,b_soluutru;
		OracleCommand cmd;
		DataSet ds=null;
		DoiTuong _ctsdoituong;

		public AccessData()
		{
			if (Maincode("Con")!="") sConn=Maincode("Con");			
			sComputer=System.Environment.MachineName.Trim().ToUpper();
			b_sovaovien=bSovaovien;
			b_soluutru=bSoluutru;
			userid=sConn.Substring(sConn.LastIndexOf("=")+1).Trim();
			service_name=sConn.Substring(sConn.IndexOf("=")+1,sConn.IndexOf(";")-1-sConn.IndexOf("=")).Trim();
			upd_dmcomputer(sComputer);
			ds=get_data("select rownum,computer from dmcomputer");
			DataRow r=getrowbyid(ds.Tables[0],"computer='"+sComputer+"'");
			if (r!=null) iRownum=int.Parse(r["rownum"].ToString());
			_ctsdoituong=new DoiTuong();
		}

		public string user{get {return userid;}}
		public string service{get {return service_name;}}
		private string get_conn_d(string mmyy)
		{
			return "Data Source="+service_name+";user id="+userid+"d"+mmyy+";password="+userid+"d"+mmyy;
		}
		private string get_conn_v(string mmyy)
		{
			return "Data Source="+service_name+";user id="+userid+mmyy+";password="+userid+mmyy;
		}

		public string Maincode(string sql)
		{
			try
			{
				XmlDocument doc=new XmlDocument();
				doc.Load("..\\..\\..\\xml\\maincode.xml");
				XmlNodeList nodeLst=doc.GetElementsByTagName(sql);
				return nodeLst.Item(0).InnerText;
			}
			catch{}
			return "";
		}

		public string ConStr{get{return sConn;}}

		public string Madau
		{
			get
			{
				XmlDocument doc=new XmlDocument();
				doc.Load("..\\..\\..\\xml\\maincode.xml");
				XmlNodeList nodeLst=doc.GetElementsByTagName("Madau");
				return nodeLst.Item(0).InnerText;
			}
		}

		#region xxx
		public string Host
		{
			get
			{
				return "203.162.56.241";
			}
		}

		public string User
		{
			get
			{
				return Mabv.Substring(0,3);
			}
		}

		public string Pass
		{
			get
			{
				return User+"09t039i3e7066n8"+User;
			}
		}

		public string Dir
		{
			get
			{
				return "";
			}
		}
		#endregion

		public void writeXml(string tenfile,string cot,string s)
		{
			ds=new DataSet();
			try
			{
				ds.ReadXml("..\\..\\..\\xml\\"+tenfile.Replace(".xml","")+".xml");
				ds.Tables[0].Rows[0][cot]=s;
			}
			catch
			{
				DataColumn dc=new DataColumn();
				dc.ColumnName=cot;
				dc.DataType=Type.GetType("System.String");
				ds.Tables[0].Columns.Add(dc);
				ds.Tables[0].Rows[0][cot]=s;
			}
			ds.WriteXml("..\\..\\..\\xml\\"+tenfile+".xml");
		}

		public string Hoten_khongdau(string s)
		{
			ds=new DataSet();
			ds.ReadXml("..\\..\\..\\xml\\khongdau.xml");
			string s1=s.Trim().ToUpper(),s2="";
			DataRow r;
			for(int i=0;i<s1.Length;i++)
			{
				if (s1[i].ToString().Trim()!="")
				{	
					r=getrowbyid(ds.Tables[0],"codau='"+s1[i].ToString()+"'");
					if (r!=null) s2+=r[1].ToString();
					else s2+=s1[i];
				}
			}
			return s2;
		}

		public string khongdau(string s)
		{
			ds=new DataSet();
			ds.ReadXml("..\\..\\..\\xml\\khongdau.xml");
			string s1=s.Trim().ToUpper(),s2="";
			DataRow r;
			for(int i=0;i<s1.Length;i++)
			{
				if (s1[i].ToString().Trim()!="")
				{	
					r=getrowbyid(ds.Tables[0],"codau='"+s1[i].ToString()+"'");
					if (r!=null) s2+=r[1].ToString();
					else s2+=s1[i];
				}
				else s2+=s1[i];
			}
			return s2;
		}

		public string holot_ten(string hoten)
		{
			string holot="",ten=hoten;
			hoten=hoten.Trim();
			for(;;)
			{
				if (hoten.IndexOf("  ")==-1) break;
				hoten=hoten.Replace("  "," ");
			}
			int pos=hoten.LastIndexOf(" ");
			if (pos!=-1)
			{
				ten=hoten.Substring(pos+1);
				hoten=hoten.Substring(0,pos);
				holot=hoten;
				pos=hoten.LastIndexOf(" ");
				if (pos!=-1) holot=hoten.Substring(pos+1);
			}
			return holot+" "+ten;
		}

		public string Mabv
		{
			get
			{
				XmlDocument doc=new XmlDocument();
				doc.Load("..\\..\\..\\xml\\maincode.xml");
				XmlNodeList nodeLst=doc.GetElementsByTagName("Mabv");
				return (nodeLst.Item(0).InnerText=="")?"701.1.01":nodeLst.Item(0).InnerText;
			}
		}
		public string Mabvbhyt
		{
			get
			{
				try
				{
					XmlDocument doc=new XmlDocument();
					doc.Load("..\\..\\..\\xml\\maincode.xml");
					XmlNodeList nodeLst=doc.GetElementsByTagName("Mabvbhyt");
					return (nodeLst.Item(0).InnerText=="")?"701.1.01":nodeLst.Item(0).InnerText;
				}
				catch
				{
					return "";
				}
			}
		}

		public int Mabv_so
		{
			get
			{
				string s="";
				for(int i=0;i<Mabv.Length;i++)
					s+=(Mabv.Substring(i,1)==".")?"":Mabv.Substring(i,1);
				return int.Parse(s);
			}
		}

		public string Tenbv
		{
			get
			{
				XmlDocument doc=new XmlDocument();
				doc.Load("..\\..\\..\\xml\\maincode.xml");
				XmlNodeList nodeLst=doc.GetElementsByTagName("Tenbv");
				return nodeLst.Item(0).InnerText;
			}
		}

		public string Syte
		{
			get
			{
				XmlDocument doc=new XmlDocument();
				doc.Load("..\\..\\..\\xml\\maincode.xml");
				XmlNodeList nodeLst=doc.GetElementsByTagName("Syte");
				return nodeLst.Item(0).InnerText;
			}
		}

		public string Diachi
		{
			get
			{
				XmlDocument doc=new XmlDocument();
				doc.Load("..\\..\\..\\xml\\maincode.xml");
				XmlNodeList nodeLst=doc.GetElementsByTagName("Diachi");
				return nodeLst.Item(0).InnerText;
			}
		}

		public string Dienthoai
		{
			get
			{
				XmlDocument doc=new XmlDocument();
				doc.Load("..\\..\\..\\xml\\maincode.xml");
				XmlNodeList nodeLst=doc.GetElementsByTagName("Dienthoai");
				return nodeLst.Item(0).InnerText;
			}
		}

		public string Thongso(string sql)
		{
			try
			{
				XmlDocument doc=new XmlDocument();
				doc.Load("..\\..\\..\\xml\\thongso.xml");
				XmlNodeList nodeLst=doc.GetElementsByTagName(sql);
				return nodeLst.Item(0).InnerText;
			}
			catch
			{
				ds=new DataSet();
				ds.ReadXml("..\\..\\..\\xml\\thongso.xml");
				DataColumn dc=new DataColumn();
				dc.ColumnName=sql;
				dc.DataType=Type.GetType("System.String");
				ds.Tables[0].Columns.Add(dc);
				ds.Tables[0].Rows[0][sql]="0";
				ds.WriteXml("..\\..\\..\\xml\\thongso.xml");
				return "0";
			}
		}

		public string Mau(string sql)
		{
			try
			{
				XmlDocument doc=new XmlDocument();
				doc.Load("..\\..\\..\\xml\\mau.xml");
				XmlNodeList nodeLst=doc.GetElementsByTagName(sql);
				return nodeLst.Item(0).InnerText;
			}
			catch
			{
				return "";
			}
		}

		public string Maicd_rpt(string s)
		{
			try
			{
				string s1="",s2=".+-*";
				s=s.Trim().ToUpper();
				for(int i=0;i<s.Length;i++)
					if (s2.IndexOf(s.Substring(i,1))==-1) s1+=s.Substring(i,1);
				return s1;
			}
			catch{return "";}
		}

		public bool bMaicd(string s)
		{
			if (s=="") return true;
			else return get_data("select cicd10 from icd10 where cicd10='"+s+"'").Tables[0].Rows.Count>0;
		}

		public bool bMapt(string s)
		{
			if (s=="") return true;
			else return get_data("select mapt from dmpttt where mapt='"+s+"'").Tables[0].Rows.Count>0;
		}

		public string Maicd(string s)
		{
			try
			{
				string s1="";
				s=s.ToUpper();
				for(int i=0;i<s.Length;i++)
				{
					if (s.Substring(i,1)!="_")
						s1+=s.Substring(i,1);
				}
				return (s1.Length>4)?s1:s1.Substring(0,3);
			}
			catch{return "";}
		}

		public string Mapttt(string s)
		{
			try
			{
				string s1="";
				s=s.ToUpper();
				for(int i=0;i<s.Length;i++)
				{
					if (s.Substring(i,1)!="_")
						s1+=s.Substring(i,1);
					else
						break;
				}
				return (s1.Length>5)?s1:s1.Substring(0,4);
			}
			catch{return "";}
		}

		public string Ngaydemo
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=-3");
					if (ds.Tables[0].Rows.Count>0)
					{
						if (ds.Tables[0].Rows[0]["ten"].ToString()!="") return ds.Tables[0].Rows[0]["ten"].ToString();
						else return f_modify(file_exe("medisoft")).ToString().Substring(0,10);
					}
					else return "";
				}
				catch{return "";}
			}
		}

		public int Songaydemo
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=-4");
					if (ds.Tables[0].Rows.Count>0)
					{
						if (ds.Tables[0].Rows[0]["ten"].ToString()!="") return int.Parse(ds.Tables[0].Rows[0]["ten"].ToString());
						else return 30;
					}
					else return 0;
				}
				catch{return 0;}
			}
		}

		public bool bHieuchinhICD10
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=54");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bICDNguyennhan
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=100");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bSoluutru_Mabn
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=102");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bMoi_cu
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=106");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bXutri_noitru_kb
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=108");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return true;}
			}
		}

		public bool bXutri_ngoaitru_kb
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=109");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return true;}
			}
		}
		// nam 06/04/2012
		public bool bxutri
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1160");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return true;}
			}
		}
		public bool bsuathongtinHC
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1161");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return true;}
			}
		}
		// end nam

		public bool bXutri_noitru_ngtr
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=201");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return true;}
			}
		}

		public bool bXutri_noitru_pl
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=202");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return true;}
			}
		}

		public bool bXutri_ngoaitru_pl
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=203");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return true;}
			}
		}

		public bool bXutri_khambenh_pl
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=272");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return true;}
			}
		}

		public bool bsothe_mabn
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=204");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return true;}
			}
		}

		public bool bHansd_thuoc
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=205");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return true;}
			}
		}

		public bool bPttt_tsoduoc
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=207");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return true;}
			}
		}

		public bool bPttt_Konhapkhoa
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=208");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return true;}
			}
		}

		public bool bInsovaovien_ravien
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=209");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return true;}
			}
		}

		public bool bPhongkham_chidinh
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=210");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return true;}
			}
		}

		public bool bSoluutru_icd10
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=211");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return true;}
			}
		}

		public bool bInravien_ravien
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=212");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return true;}
			}
		}

		public bool bDocmavach
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=213");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bThanhtoan_tronsoluong
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=214");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bTaikham_chidinh
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=215");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bSongay_donthuoc
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=218");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bSoluutru_sovaovien
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=219");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bSoluutru_nam
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=220");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bSoluutru_nam_xuatvien
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=228");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bSoluutru_ma_icd10
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=265");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bSoluutru_makpmmsttyy
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=314");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public int iGiuongdieutri
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=315");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 0;}
			}
		}

		public decimal dGtruocpt
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=316");
					return decimal.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 0;}
			}
		}

		public long lGl1dau
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=317");
					return long.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 0;}
			}
		}

		public decimal dGl1stdau
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=318");
					return decimal.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 0;}
			}
		}

		public long lGl1tiep
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=319");
					return long.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 0;}
			}
		}

		public decimal dGl1sttiep
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=320");
					return decimal.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 0;}
			}
		}

		public decimal dGl1stcon
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=321");
					return decimal.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 0;}
			}
		}


		public long lGl2dau
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=322");
					return long.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 0;}
			}
		}

		public decimal dGl2stdau
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=323");
					return decimal.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 0;}
			}
		}

		public long lGl2tiep
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=324");
					return long.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 0;}
			}
		}

		public decimal dGl2sttiep
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=325");
					return decimal.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 0;}
			}
		}

		public decimal dGl2stcon
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=326");
					return decimal.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 0;}
			}
		}

		public long lGnsdau
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=327");
					return long.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 0;}
			}
		}

		public decimal dGnsstdau
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=328");
					return decimal.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 0;}
			}
		}

		public long lGnstiep
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=329");
					return long.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 0;}
			}
		}

		public decimal dGnssttiep
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=330");
					return decimal.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 0;}
			}
		}

		public decimal dGnsstcon
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=331");
					return decimal.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 0;}
			}
		}

		public decimal dGtruocde
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=332");
					return decimal.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 0;}
			}
		}

		public long lGdedau
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=333");
					return long.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 0;}
			}
		}

		public decimal dGdestdau
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=334");
					return decimal.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 0;}
			}
		}

		public long lGdetiep
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=335");
					return long.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 0;}
			}
		}

		public decimal dGdesttiep
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=336");
					return decimal.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 0;}
			}
		}

		public decimal dGdestcon
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=337");
					return decimal.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 0;}
			}
		}


		public int iGiuongthongtu14
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=338");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 0;}
			}
		}

		public decimal dGtruoc14
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=339");
					return decimal.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 0;}
			}
		}

		public decimal dGl1s14
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=340");
					return decimal.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 0;}
			}
		}

		public decimal dGl2s14
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=341");
					return decimal.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 0;}
			}
		}
		public decimal dGl3s14
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=342");
					return decimal.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 0;}
			}
		}
		public long lGdau14
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=343");
					return long.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 0;}
			}
		}
		public int madoituong_giuongdieutri
		{
			get
			{
				try
				{
					ds=get_data("select ten from thongso where id=344");
					if (ds.Tables[0].Rows.Count==0) return 0;
					return int.Parse(ds.Tables[0].Rows[0][0].ToString().Trim());
				}
				catch{return 0;}
			}
		}
		public bool bRavien_ngia
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=345");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		public bool bTaikham_hen
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=346");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return true;}
			}
		}
		public bool bTaikham_in
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=347");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return true;}
			}
		}

		public bool bChenhlech_doituong
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=348");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return true;}
			}
		}

		public bool bChenhlech_giavp
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=421");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return true;}
			}
		}

		public bool bAutoupdate
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=422");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public string Path_medisoft
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=423");
					return ds.Tables[0].Rows[0][0].ToString();
				}
				catch{return "";}
			}
		}

		public bool bGiayravien_vp
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=424");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public int iGiayravien_userid
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=425");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 0;}
			}
		}

		public int iGiayravien_sohieu
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=426");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 0;}
			}
		}

		public bool bTamung_konguoithu
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=427");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		
		public bool bDelFileTemp
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=428");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bBlankmabs
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=430");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bSoluutru_ngtru
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=431");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public int iSoluutru_user_ngtru
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=432");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 0;}
			}
		}

		public decimal muc_bhquidinh
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=433");
					return decimal.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 7000000;}
			}
		}

		public string huong_100
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=434");
					return ds.Tables[0].Rows[0][0].ToString();
				}
				catch{return "";}
			}
		}

		public string huong_100_khongqua
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=435");
					return ds.Tables[0].Rows[0][0].ToString();
				}
				catch{return "";}
			}
		}

		public decimal muc_khongqua
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=436");
					return decimal.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 20000000;}
			}
		}

		public int phantram_thuoc
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=437");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 50;}
			}
		}

		public bool bGia_bh_quydinh
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=438");
					return ds.Tables[0].Rows[0][0].ToString()=="1";
				}
				catch{return false;}
			}
		}

		public int phantram_bhyt
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=439");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 60;}
			}
		}

		public bool bBtdkp_ten
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=440");
					return ds.Tables[0].Rows[0][0].ToString()=="1";
				}
				catch{return false;}
			}
		}

		public bool bGiuong_khoa
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=441");
					return ds.Tables[0].Rows[0][0].ToString()=="1";
				}
				catch{return true;}
			}
		}

		public bool bDatkham
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=442");
					return ds.Tables[0].Rows[0][0].ToString()=="1";
				}
				catch{return false;}
			}
		}

		public bool bTrieuchung
		{
			get
			{
				try
				{
					DataSet ds = get_data("select ten from thongso where id=443");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString()) == 1;
				}
				catch { return false; }
			}
		}

		public bool bChonkho_donngoaitru
		{
			get
			{
				try
				{
					DataSet ds = get_data("select ten from thongso where id=444");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString()) == 1;
				}
				catch { return false; }
			}
		}

		public int kho_donngoaitru
		{
			get
			{
				try
				{
					ds=get_data("select ten from thongso where id=445");
					if (ds.Tables[0].Rows.Count==0) return 0;
					return int.Parse(ds.Tables[0].Rows[0][0].ToString().Trim());
				}
				catch{return 0;}
			}
		}

		public string makp_donngoaitru
		{
			get
			{
				try
				{
					ds=get_data("select ten from thongso where id=446");
					if (ds.Tables[0].Rows.Count==0) return "";
					return ds.Tables[0].Rows[0][0].ToString().Trim();
				}
				catch{return "";}
			}
		}

		public bool bQuanlythekham
		{
			get
			{
				try
				{
					DataSet ds = get_data("select ten from thongso where id=447");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString()) == 1;
				}
				catch { return false; }
			}
		}

		public bool bDuyet_khoa
		{
			get
			{
				try
				{
					DataSet ds = get_data("select ten from thongso where id=448");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString()) == 1;
				}
				catch { return true; }
			}
		}

		public bool bHoantra_tutruc
		{
			get
			{
				try
				{
					DataSet ds = get_data("select ten from thongso where id=449");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString()) == 1;
				}
				catch { return true; }
			}
		}

		public bool bBhyt_ngay_inchung
		{
			get
			{
				try
				{
					DataSet ds = get_data("select ten from thongso where id=450");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString()) == 1;
				}
				catch { return false; }
			}
		}

		public string makp_tiepdon
		{
			get
			{
				try
				{
					ds=get_data("select ten from thongso where id=451");
					if (ds.Tables[0].Rows.Count==0) return "";
					return ds.Tables[0].Rows[0][0].ToString().Trim();
				}
				catch{return "";}
			}
		}

		public bool bDiachitt
		{
			get
			{
				try
				{
					DataSet ds = get_data("select ten from thongso where id=452");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString()) == 1;
				}
				catch { return false; }
			}
		}


		public bool bSoluutru_makp_yy_stt
		{
			get
			{
				try
				{
					DataSet ds = get_data("select ten from thongso where id=453");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString()) == 1;
				}
				catch { return false; }
			}
		}

		public bool bKhoacdkham_chiphi
		{
			get
			{
				try
				{
					DataSet ds = get_data("select ten from thongso where id=454");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString()) == 1;
				}
				catch { return false; }
			}
		}

		public bool bGiuongdt_khoa
		{
			get
			{
				try
				{
					DataSet ds = get_data("select ten from thongso where id=455");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString()) == 1;
				}
				catch { return false; }
			}
		}

		public string sGiuongdt_khoa
		{
			get
			{
				try
				{
					ds=get_data("select ten from thongso where id=456");
					if (ds.Tables[0].Rows.Count==0) return "";
					return ds.Tables[0].Rows[0][0].ToString().Trim();
				}
				catch{return "";}
			}
		}

		public bool b1giuong_phong
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=457");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		public bool b1giuong_trugiuongthuong
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=605");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		public bool bDangky_bsbv
		{
			get
			{
				try
				{
					DataSet ds = get_data("select ten from thongso where id=458");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString()) == 1;
				}
				catch { return false; }
			}
		}

		public bool bGiuongdieutri_tungay
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=349");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return true;}
			}
		}
		public bool bMadoituong_giuongdichvu
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=350");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return true;}
			}
		}
		public int madoituong_giuongdichvu
		{
			get
			{
				try
				{
					ds=get_data("select ten from thongso where id=351");
					if (ds.Tables[0].Rows.Count==0) return 0;
					return int.Parse(ds.Tables[0].Rows[0][0].ToString().Trim());
				}
				catch{return 0;}
			}
		}
		public bool bGiuong_block
		{
			get
			{
				try
				{
					ds=get_data("select ten from thongso where id=352");
					if (ds.Tables[0].Rows.Count==0) return false;
					return ds.Tables[0].Rows[0][0].ToString().Trim()=="1";
				}
				catch{return false;}
			}
		}
		public int iBlock
		{
			get
			{
				try
				{
					ds=get_data("select ten from thongso where id=353");
					if (ds.Tables[0].Rows.Count==0) return 3;
					return int.Parse(ds.Tables[0].Rows[0][0].ToString().Trim());
				}
				catch{return 3;}
			}
		}
		public int iNgay_block
		{
			get
			{
				try
				{
					ds=get_data("select ten from thongso where id=354");
					if (ds.Tables[0].Rows.Count==0) return 5;
					return int.Parse(ds.Tables[0].Rows[0][0].ToString().Trim());
				}
				catch{return 5;}
			}
		}
		public int delay1
		{
			get
			{
				try
				{
					ds=get_data("select ten from thongso where id=355");
					if (ds.Tables[0].Rows.Count==0) return 600;
					return int.Parse(ds.Tables[0].Rows[0][0].ToString().Trim());
				}
				catch{return 600;}
			}
		}
		public int delay2
		{
			get
			{
				try
				{
					ds=get_data("select ten from thongso where id=356");
					if (ds.Tables[0].Rows.Count==0) return 600;
					return int.Parse(ds.Tables[0].Rows[0][0].ToString().Trim());
				}
				catch{return 600;}
			}
		}
		public int delay3
		{
			get
			{
				try
				{
					ds=get_data("select ten from thongso where id=357");
					if (ds.Tables[0].Rows.Count==0) return 600;
					return int.Parse(ds.Tables[0].Rows[0][0].ToString().Trim());
				}
				catch{return 600;}
			}
		}
		public int delay4
		{
			get
			{
				try
				{
					ds=get_data("select ten from thongso where id=360");
					if (ds.Tables[0].Rows.Count==0) return 600;
					return int.Parse(ds.Tables[0].Rows[0][0].ToString().Trim());
				}
				catch{return 600;}
			}
		}
		public bool bBhyt1kham
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=361");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		public bool bThutien_the
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=362");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bGiuongdv_dat
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=364");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bThutien_kham
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=365");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bInthe_dscho
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=366");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bGiuong_plylenh
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=367");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bPhongluu_userid
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=368");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bChidinh_exp_txt
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=369");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bThanhtoan_ngay
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=370");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public int iNhomvpthuoc
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=371");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 0;}
			}
		}

		public int iSTT_NhomvpThuoc(int iIDNhomvpthuoc)
		{
			return int.Parse(get_data("select stt from v_nhomvp where ma="+iIDNhomvpthuoc).Tables[0].Rows[0]["stt"].ToString());
		}
		public int iMavp_the
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=363");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 0;}
			}
		}

		public bool bChuctramngan
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=358");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return true;}
			}
		}
		public bool bVattu_pttt
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=359");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return true;}
			}
		}

		public bool bNgoaitru_bhyt_khambenh
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=460");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return true;}
			}
		}

		public string xutri_hen
		{
			get
			{
				try
				{
					ds=get_data("select ten from thongso where id=461");
					if (ds.Tables[0].Rows.Count==0) return "";
					return ds.Tables[0].Rows[0][0].ToString().Trim();
				}
				catch{return "";}
			}
		}

		public bool bDonthuoc_trongngay
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=462");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
//vu
		public bool bChenhlech_tructiep
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=463");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public string manhom_donthuoc
		{
			get
			{
				try
				{
					ds=get_data("select ten from thongso where id=464");
					if (ds.Tables[0].Rows.Count==0) return "";
					return ds.Tables[0].Rows[0][0].ToString().Trim();
				}
				catch{return "";}
			}
		}

		public bool bBienlai_mien
		{
			get
			{
				try
				{
					DataSet ds = get_data("select ten from thongso where id=465");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString()) == 1;
				}
				catch { return false; }
			}
		}

		public bool bKhoa_ttravien_prn
		{
			get
			{
				try
				{
					DataSet ds = get_data("select ten from thongso where id=466");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString()) == 1;
				}
				catch { return false; }
			}
		}

		public string ksk_nhi
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=467");
					return ds.Tables[0].Rows[0][0].ToString();
				}
				catch{return "00";}
			}
		}

		public int iKsk_nhi
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=468");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 16;}
			}
		}

		public bool bKhamchuyen_chidinh
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=469");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		//Thuy 10.05.2012
		public bool bLayLaiSoLuuTruChoLanKhamTiepTheo
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=2541");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public string sTrieuchung
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=470");
					return ds.Tables[0].Rows[0][0].ToString();
				}
				catch{return "Triệu chứng ban đầu :";}
			}
		}

		public bool bHen_dangkylai
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=471");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bPhieuravien_ct_th
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=472");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bChuyenkham_tinhcong
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=473");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bSophieu_ttrv_nam
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=474");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bPttt_kemtheo
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=475");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bDanhsach_cho_db
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=47");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public int iPttt_kemtheo
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=476");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 50;}
			}
		}

		public string sPttt_kemtheo
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=477");
					return ds.Tables[0].Rows[0][0].ToString().Trim();
				}
				catch{return "";}
			}
		}

		public string sNgoaigio_makp
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=478");
					return ds.Tables[0].Rows[0][0].ToString().Trim();
				}
				catch{return "";}
			}
		}

		public bool bChandoansobo_icd10
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=479");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bPttt_vienphi_vattu
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=480");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bPhongkham_hanhchanh
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=481");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bTraituyen
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=482");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		//		public bool bTraituyen_thuchenhlech
		//		{
		//			get
		//			{
		//				try
		//				{
		//					DataSet ds=get_data("select ten from thongso where id=484");
		//					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
		//				}
		//				catch{return false;}
		//			}
		//		}
		
		public int iTraituyen_bhyt
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=483");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 0;}
			}
		}

		public bool bMatreem_mabn
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=485");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public int iMatreem
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=486");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 0;}
			}
		}
		/// <summary>
		/// G38. Thanh toán chênh lệch chỉ áp dụng trái tuyến
		/// </summary>
		public bool bChenhlech_traituyen
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=487");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bGia_bh_quydinh_giamua
		{
			get
			{
				try
				{
					DataSet ds = get_data("select ten from thongso where id=489");
					return ds.Tables[0].Rows[0][0].ToString() == "1";
				}
				catch { return false; }
			}
		}

		public bool bTraituyen_bhtra
		{
			get
			{
				try
				{
					DataSet ds = get_data("select ten from thongso where id=490");
					return ds.Tables[0].Rows[0][0].ToString() == "1";
				}
				catch { return false; }
			}
		}

		public bool bDonthuoc_khambenh_1lan
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=266");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bSankhoa_tresosinh
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=267");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bDutru_n_thuoc
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=271");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bChiphi_xuatkhoa
		{
			//G43
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=229");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bKhongChuyen_Chiphi_phhongluu_chuyen_phongkham
		{
			//G81
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1081");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		public bool bChidinh_dain_khongchohuy
		{
			//H20
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1082");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		public bool bChuyenchiphi_PK_vao_Ngoaitru
		{
			//G46.1
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1083");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return true;}
			}
		}
		public bool bChuyenchiphi_PK_vao_cc
		{
			//G46.2
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1162");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return true;}
			}
		}
		public bool bKBkhongnhapNhantuvaNoigioithieu
		{
			//C77
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1170");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return true;}
			}
		}
		#region cao vũ thêm E32 04/05/2013
		public bool bBHYT_ngaybd_KhongLonHon_ngayTrinhThe
		{
			//E32
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=11681");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return true;}
			}
		}
		#endregion		
		#region cao vũ thêm G89 24/05/2013
		public bool bVP_ChuyenPhongKham_NoiTru
		{
			//G89
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1173");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return true;}
			}
		}
		#endregion
		#region cao vũ thêm I20 04/06/2013
		public bool bTT_ChoPhepChonKhoa
		{
			//I20
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1174");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return true;}
			}
		}
		#endregion
		#region cao vũ thêm E33 19/08/2013
		/// <summary>
		/// Không tự động hiển thị số thẻ BHYT --> bắt buộc nhập số thẻ BHYT.
		/// </summary>
		public bool bBHYT_KhongTuDongHienThiSoTheBHYT
		{
			//E32
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=11682");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		#endregion
		#region cao vũ thêm E34 26/12/2014
		/// <summary>
		/// Áp dụng chi phí tính theo thông tư 1314 của bhyt
		/// </summary>
		public bool pbBhytApDungTT1314
		{
			//E34
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=5034");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		#endregion
		#region cao vũ thêm E341 29/12/2014
		/// <summary>
		/// BHYT tính theo thông tư 1314 chi trả cho bệnh nhân nội trú trái tuyến.
		/// </summary>
		public int piBhyt1314_TraiTuyen_NoiTru
		{
			//E34-1
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=50341");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 0;}
			}
		}
		#endregion
		#region cao vũ thêm E341 29/12/2014
		/// <summary>
		/// BHYT tính theo thông tư 1314 chi trả cho bệnh nhân nội trú trái tuyến.
		/// </summary>
		public int piBhyt1314_TraiTuyen_NgoaiTru
		{
			//E34-2
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=50342");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 0;}
			}
		}
		#endregion
		#region cao vũ thêm D34 29/08/2013
		/// <summary>
		/// D34. Cấp số thứ tự bệnh nhân chờ khi chỉ định.
		/// </summary>
		public bool bCapSTTCho_KhiChiDinh
		{
			//E32
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1175");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		#endregion
		public bool bKPnhapthuoc_vattu_khongcannhapkhoa
		{
			//c.74
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1163");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return true;}
			}
		}
		public bool bQuanlybankhamtd
		{
			//c78
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1174");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return true;}
			}
		}
		public bool bDaInmau38_khongchophep_captoa_themcls
		{
			//F.64
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1178");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		public bool bKnhanbenh_chuaketthuckhamBHYT
		{
			//C79. Không nhận bệnh, BN chưa kết thúc khám BHYT
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1179");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		
		public bool bGiuongthuong_dichvu
		{
			//Giường dịch vụ <12 giờ tính nữa ngày, Giường thường tính như giường dịch vụ(c1180)
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1180");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		/// <summary>
		/// G91
		/// </summary>
		public bool bTinhChenhLech_XanhPon
		{
			//G91. Tính chênh lệch: gia_th>gia_bh=thu phí, gia_dv>gia_bh=dịch vụ (c1181)
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1181");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		/// <summary>
		/// H24
		/// </summary>
		public bool bChidinh_Dathutien_KhongchoInchidinh
		{
			//G91. Tính chênh lệch: gia_th>gia_bh=thu phí, gia_dv>gia_bh=dịch vụ (c1181)
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=8024");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		/// <summary>
		/// H25 nội trú tính chênh lệch.
		/// </summary>
		public bool bBHYT_NoiTruTinhChenhLechCLS
		{
			//H25
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=8025");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return true;}
			}
		}
		/// <summary>
		/// H26 Chi Admin moi duoc huy thong tin nhap vien phi khoa.
		/// </summary>
		public bool bvpkhoa_ChiAdMinMoiDuocHuyThongTin
		{
			//H26
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=8026");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		/// <summary>
		/// H27 Chi Admin moi duoc huy thong tin nhap thuoc,vat tu.
		/// </summary>
		public bool bthuoc_ChiAdMinMoiDuocHuyThongTin
		{
			//H27
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=8027");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		/// <summary>
		/// H28 Chi Admin moi duoc huy thong tin tu ho so benh an.
		/// </summary>
		public bool bbenhan_ChiAdMinMoiDuocHuyThongTin
		{
			//H28
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=8028");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		public bool bBHYT_QRCode_Dangky
		{
			//B11. BHYT dùng QR Code khi đăng ký
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1600");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		public bool bBoquathongbaodanhapchidinh
		{
			//c.75
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1165");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return true;}
			}
		}
		public bool bThongbaotoathuoc
		{
			//F69
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1166");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return true;}
			}
		}

		public bool bPT_batbuot_nhaptuongtrinh_I18
		{
			//I18
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1088");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		public bool bTT_batbuot_nhaptuongtrinh_I19
		{
			//I19
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1089");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		public bool bThanhtoan_khu
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=230");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		
		public bool bHaophi_thanhtoan
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=231");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bDangky_mau2
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=235");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bExcel_tonghop
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=236");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bIn1lan
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=237");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bDichvu_dongia
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=238");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bDuyet_donve
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=239");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public int iUserid_donve
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=240");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 0;}
			}
		}

		public bool bCD_BS_Chidinh
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=241");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bBS_batbuot_trong_Chidinh
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=491");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bPhongkham_bangdien_hanoi
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=492");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bNoitru_bhyt_khambenh
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=493");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		public bool bPttt_hiendien
		{
			//Í6
			get
			{
				try
				{
					return (int.Parse(get_data("select ten from thongso where id=494").Tables[0].Rows[0][0].ToString()) == 1);
				}
				catch
				{
					return false;
				}
			}
		}
		public bool bChenhlenh_thuoc_dm
		{
			get
			{
				try
				{
					return (get_data("select ten from thongso where id=495").Tables[0].Rows[0][0].ToString() == "1");
				}
				catch
				{
					return false;
				}
			}
		}
 
		public bool bThetunguyen(string sothe)
		{
			string sthetunguyen = sThetunguyen;
			return (((sothe.Trim().Length == 15) || (sothe.Trim().Length == 20)) && (sthetunguyen.IndexOf(sothe.Substring(0, 2)) != -1));
		}


 

		public bool bInphieulanh_user_1lan
		{//F52
			get
			{
				try
				{
					return (int.Parse(get_data("select ten from thongso where id=496").Tables[0].Rows[0][0].ToString()) == 1);
				}
				catch
				{
					return true;
				}
			}
		}

		public string sThetunguyen
		{
			//E29
			get
			{
				try
				{
					return get_data("select ten from thongso where id=497").Tables[0].Rows[0][0].ToString();
				}
				catch
				{
					return "GD+TL+XV";
				}
			}
		}
		public string cc1_te1
		{
			get
			{
				try
				{
					this.ds = get_data("select ten from thongso where id=564");
					if (ds.Tables[0].Rows.Count == 0)
					{
						return "CC1+TE1";
					}
					return ds.Tables[0].Rows[0][0].ToString().Trim();
				}
				catch
				{
					return "CC1+TE1";
				}
			}
		}
		public string ck2_ca3
		{
			get
			{
				try
				{
					this.ds = get_data("select ten from thongso where id=565");
					if (ds.Tables[0].Rows.Count == 0)
					{
						return "CK2+CA3";
					}
					return this.ds.Tables[0].Rows[0][0].ToString().Trim();
				}
				catch
				{
					return "CK2+CA3";
				}
			}
		}

		public decimal ck2_ca3_26
		{
			get
			{
				try
				{
					this.ds = get_data("select ten from thongso where id=566");
					if (ds.Tables[0].Rows.Count == 0)
					{
						return 26000000;
					}
					return decimal.Parse(ds.Tables[0].Rows[0][0].ToString().Trim());
				}
				catch
				{
					return 26000000;
				}
			}
		}
		public string bt4_hn4_ht5
		{
			get
			{
				try
				{
					this.ds = get_data("select ten from thongso where id=567");
					if (ds.Tables[0].Rows.Count == 0)
					{
						return "CK2+CA3";
					}
					return ds.Tables[0].Rows[0][0].ToString().Trim();
				}
				catch
				{
					return "CK2+CA3";
				}
			}
		}
		public decimal thuoc_50
		{
			get
			{
				try
				{
					this.ds = get_data("select ten from thongso where id=568");
					if (ds.Tables[0].Rows.Count == 0)
					{
						return 50;
					}
					return decimal.Parse(ds.Tables[0].Rows[0][0].ToString().Trim());
				}
				catch
				{
					return 50M;
				}
			}
		}
		public string te1
		{
			get
			{
				try
				{
					this.ds = get_data("select ten from thongso where id=569");
					if (ds.Tables[0].Rows.Count == 0)
					{
						return "TE1";
					}
					return ds.Tables[0].Rows[0][0].ToString().Trim();
				}
				catch
				{
					return "TE1";
				}
			}
		}

		public bool bInchidinh_loaivp
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=242");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bInchidinh_yeucau
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=243");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bInchidinh_mau
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=248");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bMaubenhan
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=249");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bMaubenhan_pk
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=394");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return bMaubenhan;}
			}
		}

		public bool bGoi_dangky
		{
			get
			{
				try
				{
					DataSet ds = get_data("select ten from " + user + ".thongso where id=395");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString()) == 1;
				}
				catch { return false; }
			}
		}

		public int sonhay
		{
			get
			{
				try
				{
					DataSet ds = get_data("select ten from " + user + ".thongso where id=403");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch { return 5; }
			}
		}

		public bool bTructiep
		{
			get
			{
				try
				{
					DataSet ds = get_data("select ten from " + user + ".thongso where id=404");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString()) == 1;
				}
				catch { return false; }
			}
		}

		public bool bBieu031_bo
		{
			get
			{
				try
				{
					DataSet ds = get_data("select ten from " + user + ".thongso where id=406");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString()) == 1;
				}
				catch { return false; }
			}
		}

		public bool bTaikham_inchiphi
		{
			get
			{
				try
				{
					DataSet ds = get_data("select ten from " + user + ".thongso where id=407");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString()) == 1;
				}
				catch { return false; }
			}
		}

		public bool bCachudung
		{
			get
			{
				try
				{
					DataSet ds = get_data("select ten from " + user + ".thongso where id=408");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString()) == 1;
				}
				catch { return false; }
			}
		}

		public int Taikham_songay
		{
			get
			{
				try
				{
					DataSet ds = get_data("select ten from " + user + ".thongso where id=409");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch { return 30; }
			}
		}

		public string format_soluong
		{
			get
			{
				string ret="###,###,##0";
				int n=soluong_le;
				if (n>0) ret+=".";
				for(int i=0;i<n;i++) ret+="0";
				return ret;
			}
		}

		public string sSothe_jl
		{
			get
			{
				try
				{
					DataSet ds = get_data("select ten from " + user + ".thongso where id=410");
					return ds.Tables[0].Rows[0][0].ToString();
				}
				catch { return ""; }
			}
		}

		public int iSothe_jl_vitri
		{
			get
			{
				try
				{
					DataSet ds = get_data("select ten from " + user + ".thongso where id=411");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch { return 12; }
			}
		}

		public int soluong_le
		{
			get
			{
				try
				{
					DataSet ds = get_data("select ten from " + user + ".thongso where id=418");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch { return 3; }
			}
		}

		public bool bPhongkham_khambenh
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=412");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bNgayhienhanh_thuoc_chidinh
		{
			get
			{
				try
				{
					DataSet ds = get_data("select ten from thongso where id=413");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString()) == 1;
				}
				catch { return true; }
			}
		}

		public bool bNhapvien_kocongkham
		{
			get
			{
				try
				{
					DataSet ds = get_data("select ten from thongso where id=414");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString()) == 1;
				}
				catch { return false; }
			}
		}

		public bool bCongkhai_all
		{
			get
			{
				try
				{
					DataSet ds = get_data("select ten from thongso where id=415");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString()) == 1;
				}
				catch { return false; }
			}
		}

		public bool bSothe_dmbhyt
		{
			get
			{
				try
				{
					DataSet ds = get_data("select ten from thongso where id=416");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString()) == 1;
				}
				catch { return false; }
			}
		}

		public bool bKhambenh_khu
		{
			get
			{
				try
				{
					DataSet ds = get_data("select ten from thongso where id=417");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString()) == 1;
				}
				catch { return false; }
			}
		}

		public bool bHaophi_vienphi
		{
			get
			{
				try
				{
					DataSet ds = get_data("select ten from thongso where id=419");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString()) == 1;
				}
				catch { return false; }
			}
		}

		public bool bTaikham_landau
		{
			get
			{
				try
				{
					DataSet ds = get_data("select ten from thongso where id=420");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString()) == 1;
				}
				catch { return false; }
			}
		}

		public string thuoc_dieutri
		{
			get
			{
				try
				{
					ds=get_data("select ten from thongso where id=405");
					if (ds.Tables[0].Rows.Count==0) return "";
					return ds.Tables[0].Rows[0][0].ToString().Trim();
				}
				catch{return "";}
			}
		}
		public string KPnhapthuoc
		{
			get
			{
				try
				{
					ds=get_data("select ten from thongso where id=1164");
					if (ds.Tables[0].Rows.Count==0) return "";
					return ds.Tables[0].Rows[0][0].ToString().Trim();
				}
				catch{return "";}
			}
		}

		public int _delay1
		{
			get
			{
				try
				{
					ds = get_data("select ten from " + user + ".thongso where id=396");
					if (ds.Tables[0].Rows.Count == 0) return 1800;
					return int.Parse(ds.Tables[0].Rows[0][0].ToString().Trim());
				}
				catch { return 1800; }
			}
		}

		public int _delay2
		{
			get
			{
				try
				{
					ds = get_data("select ten from " + user + ".thongso where id=397");
					if (ds.Tables[0].Rows.Count == 0) return 600;
					return int.Parse(ds.Tables[0].Rows[0][0].ToString().Trim());
				}
				catch { return 600; }
			}
		}

		public int _delay3
		{
			get
			{
				try
				{
					ds = get_data("select ten from " + user + ".thongso where id=398");
					if (ds.Tables[0].Rows.Count == 0) return 300;
					return int.Parse(ds.Tables[0].Rows[0][0].ToString().Trim());
				}
				catch { return 300; }
			}
		}

		public int _delay4
		{
			get
			{
				try
				{
					ds = get_data("select ten from " + user + ".thongso where id=399");
					if (ds.Tables[0].Rows.Count == 0) return 600;
					return int.Parse(ds.Tables[0].Rows[0][0].ToString().Trim());
				}
				catch { return 600; }
			}
		}

		public int _delay5
		{
			get
			{
				try
				{
					ds = get_data("select ten from " + user + ".thongso where id=400");
					if (ds.Tables[0].Rows.Count == 0) return 600;
					return int.Parse(ds.Tables[0].Rows[0][0].ToString().Trim());
				}
				catch { return 600; }
			}
		}

		public int _delay6
		{
			get
			{
				try
				{
					ds = get_data("select ten from " + user + ".thongso where id=401");
					if (ds.Tables[0].Rows.Count == 0) return 600;
					return int.Parse(ds.Tables[0].Rows[0][0].ToString().Trim());
				}
				catch { return 600; }
			}
		}

		public int _delay7
		{
			get
			{
				try
				{
					ds = get_data("select ten from " + user + ".thongso where id=402");
					if (ds.Tables[0].Rows.Count == 0) return 600;
					return int.Parse(ds.Tables[0].Rows[0][0].ToString().Trim());
				}
				catch { return 600; }
			}
		}

		public bool bStt
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=250");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bNgoaitonkho
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=251");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bNgay1kham
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=252");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bTiensu
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=253");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bBacsi_khambenh
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=254");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bThuoc_ylenhngay
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=255");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bLocdichvu_doituong
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=256");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bKhambenh_bangdien
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=257");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bRavien_hcbd
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=258");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bNgoaigio_ylenh
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=259");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bNoingoaitru
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=260");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		
		public bool bPttt_makp_user
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=261");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bYta_khambenh
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=262");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bBacsi_hanhchinh
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=263");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bPhonggiuong
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=244");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool b1giuong
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=245");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bGiuong_giu_khoa
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=309");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bHuyvp_phuchoi
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=310");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return true;}
			}
		}

		public bool bBienlai_mayin
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=311");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bPhongluu_bhyt_khambenh
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=312");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bChonhinh_mabn
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=313");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bNgayra_ngayvao_1
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=293");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bTongtien_donduyet
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=294");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bSuadt_auto_dichvu
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=295");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bYlenh_nhom_ten
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=296");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bTamung_khambenh
		{
			get
			{
				try
				{
					return int.Parse(Thongso("c297").ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bThuTamung_tiepdon
		{
			get
			{
				try
				{
					return int.Parse(Thongso("c372").ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bHinh
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=299");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bSothe_dkkcb
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=300");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public int Sothe_dkkcb_len
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=301");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 0;}
			}
		}

		public string Sothe_dkkcb_so
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=302");
					return ds.Tables[0].Rows[0][0].ToString();
				}
				catch{return "";}
			}
		}

		public int Sothe_dkkcb_vitri
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=303");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 0;}
			}
		}
		/// <summary>
		/// E10. Nhập ngày được hưởng chi phí, chăm sóc,thuốc đặc trị
		/// </summary>
		public bool bSothe_ngay_huong
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=304");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bMabn_tudong_tiepdon
		{
			get
			{
				try
				{
					DataSet ds = get_data("select ten from thongso where id=305");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString()) == 1;
				}
				catch { return false; }
			}
		}

		public bool bGiuong_ngay
		{
			get
			{
				try
				{
					DataSet ds = get_data("select ten from thongso where id=306");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString()) == 1;
				}
				catch { return false; }
			}
		}

		public int iGuong_ngay
		{
			get
			{
				try
				{
					DataSet ds = get_data("select ten from thongso where id=307");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch { return 0; }
			}
		}

		public bool bBhyt20_ndot
		{
			get
			{
				try
				{
					DataSet ds = get_data("select ten from thongso where id=308");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString()) == 1;
				}
				catch { return false; }
			}
		}

		public int iUserTamung_khambenh
		{
			get
			{
				try
				{
					return int.Parse(Thongso("c298").ToString());
				}
				catch{return 0;}
			}
		}

		public bool bKiemtra_phieu
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=274");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bSuadoituong_khoa
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=275");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bXuatvien_xuatkhoa
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=276");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bKhoa_duyet
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=277");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public int iUserid_duyet
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=278");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 0;}
			}
		}

		public string makho_auto_duyet
		{
			get
			{
				try
				{
					ds=get_data("select ten from thongso where id=374");
					if (ds.Tables[0].Rows.Count==0) return "";
					return ds.Tables[0].Rows[0][0].ToString().Trim();
				}
				catch{return "";}
			}
		}

		public bool bEdit_doituong_capdon
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=375");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public string madoituong_hen
		{
			get
			{
				try
				{
					ds=get_data("select ten from thongso where id=376");
					if (ds.Tables[0].Rows.Count==0) return "";
					return ds.Tables[0].Rows[0][0].ToString().Trim();
				}
				catch{return "";}
			}
		}

		public bool bKhamsuckhoe
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=377");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public string ksk_phong
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=378");
					return ds.Tables[0].Rows[0][0].ToString();
				}
				catch{return "00";}
			}
		}

		public string ksk_noi
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=379");
					return ds.Tables[0].Rows[0][0].ToString();
				}
				catch{return "00";}
			}
		}

		public string ksk_ngoai
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=380");
					return ds.Tables[0].Rows[0][0].ToString();
				}
				catch{return "00";}
			}
		}

		public string ksk_mat
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=381");
					return ds.Tables[0].Rows[0][0].ToString();
				}
				catch{return "00";}
			}
		}

		public string ksk_rang
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=382");
					return ds.Tables[0].Rows[0][0].ToString();
				}
				catch{return "00";}
			}
		}

		public string ksk_tmh
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=383");
					return ds.Tables[0].Rows[0][0].ToString();
				}
				catch{return "00";}
			}
		}

		public string ksk_sanphu
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=384");
					return ds.Tables[0].Rows[0][0].ToString();
				}
				catch{return "00";}
			}
		}
		public string ksk_xutri
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=385");
					return ds.Tables[0].Rows[0][0].ToString();
				}
				catch{return "01";}
			}
		}

		public bool bFindmabn
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=386");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bHuyvp_lydo
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=387");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bHoantrathua_knhapmoi
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=388");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bNhapkhoa_bmi
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=389");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bThuthuat_chidinh
		{
			get
			{
				try
				{
					DataSet ds = get_data("select ten from thongso where id=390");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString()) == 1;
				}
				catch { return false; }
			}
		}

		public int iNhomvp_thuthuat
		{
			get
			{
				try
				{
					DataSet ds = get_data("select ten from thongso where id=391");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch { return 0; }
			}
		}

		public bool bPhauthuat_chidinh
		{
			get
			{
				try
				{
					DataSet ds = get_data("select ten from thongso where id=392");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString()) == 1;
				}
				catch { return false; }
			}
		}

		public int iNhomvp_phauthuat
		{
			get
			{
				try
				{
					DataSet ds = get_data("select ten from thongso where id=393");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch { return 0; }
			}
		}

		public bool bNgoaitru_noitru
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=279");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bThongbao_ngay
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=280");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bSuakho_taisan
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=281");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bStt_tudong
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=282");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bHienthi_tivi
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=283");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public int delay
		{
			get
			{
				DataSet ds=get_data("select ten from thongso where id=284");
				return (ds.Tables[0].Rows[0][0].ToString().Trim()=="")?20:int.Parse(ds.Tables[0].Rows[0][0].ToString().Trim());
			}
		}

		public int LocationX
		{
			get
			{
				return int.Parse(Mau("x"));
			}
		}

		public int LocationY
		{
			get
			{
				return int.Parse(Mau("y"));
			}
		}

		public int width
		{
			get
			{
				return int.Parse(Mau("w"));
			}
		}

		public int height
		{
			get
			{
				return int.Parse(Mau("h"));
			}
		}

		public int size
		{
			get
			{
				return int.Parse(Mau("s"));
			}
		}

		public int sogiay
		{
			get
			{
				DataSet ds=get_data("select ten from thongso where id=285");
				return (ds.Tables[0].Rows[0][0].ToString().Trim()=="")?2:int.Parse(ds.Tables[0].Rows[0][0].ToString().Trim());
			}
		}

		public bool bStt_kham
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=291");
					return (ds.Tables[0].Rows[0][0].ToString().Trim()=="1");
				}
				catch{return false;}
			}
		}

		public bool bHien_holotten
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=292");
					return (ds.Tables[0].Rows[0][0].ToString().Trim()=="1");
				}
				catch{return false;}
			}
		}

		public int iNhomphonggiuong
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=246");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 0;}
			}
		}

		public int iNhomxetnghiem
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=247");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 0;}
			}
		}

		public bool bHTDT_ngoaitru
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=221");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bThuoc_1don
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=222");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bThuoc_1don_hc
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=459");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bSovaovien_noitru
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=223");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bSovaovien_khoa
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=264");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bSongay_dutru
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=224");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public string ID_HIV
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=225");
					return ds.Tables[0].Rows[0][0].ToString().Trim();
				}
				catch{return "";}
			}
		}

		public bool bGhichu_toamuangoai
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=226");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public decimal Tamung_min
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=227");
					return decimal.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 0;}
			}
		}

		public decimal Soluong_max
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=232");
					return decimal.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 0;}
			}
		}
		public decimal Toathuoc_max
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1167");
					return decimal.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 0;}
			}
		}
		public bool bTinhBHYTBatDauTuNgayDuyet
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1168");
					return (ds.Tables[0].Rows[0][0].ToString()=="1");
				}
				catch{return false;}
			}
		}

		public int iMavp_taikham
		{
			get
			{
				try
				{
					ds=get_data("select ten from thongso where id=216");
					if (ds.Tables[0].Rows.Count==0) return 0;
					return int.Parse(ds.Tables[0].Rows[0][0].ToString().Trim());
				}
				catch{return 0;}
			}
		}

		public string Makp_khamnoi
		{
			get
			{
				try
				{
					ds=get_data("select ten from thongso where id=217");
					if (ds.Tables[0].Rows.Count==0) return "";
					return ds.Tables[0].Rows[0][0].ToString().Trim();
				}
				catch{return "";}
			}
		}

		public int kho_dtngoaitru
		{
			get
			{
				try
				{
					ds=get_data("select ten from thongso where id=233");
					if (ds.Tables[0].Rows.Count==0) return 0;
					return int.Parse(ds.Tables[0].Rows[0][0].ToString().Trim());
				}
				catch{return 0;}
			}
		}

		public string makp_dtngoaitru
		{
			get
			{
				try
				{
					ds=get_data("select ten from thongso where id=234");
					if (ds.Tables[0].Rows.Count==0) return "";
					return ds.Tables[0].Rows[0][0].ToString().Trim();
				}
				catch{return "";}
			}
		}

		public string mapk_auto_noitru
		{
			get
			{
				try
				{
					ds=get_data("select ten from thongso where id=373");
					if (ds.Tables[0].Rows.Count==0) return "";
					return ds.Tables[0].Rows[0][0].ToString().Trim();
				}
				catch{return "";}
			}
		}

		public bool bThanhtoan_ndot
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=110");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bThanhtoan_ndot_ngtru
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1075");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bXemKQXN_KhoaXN_Dakiemtra
		{
			//H17
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1076");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bDaduyetMau38_khongcho_captoa_chidinhcls
		{
			//F64
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1077");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bNhapthuoc_ten
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=112");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bChuyenkhoasan
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=117");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bPttt_phongmo
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=118");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bvodanh(string hoten)
		{
			return vodanh_hoten.IndexOf(Hoten_vodanh(hoten))!=-1;
		}

		public string vodanh
		{
			get
			{
				return "VÔ DANH "+get_capid(0).ToString().Trim();
			}
		}

		private string Hoten_vodanh(string s)
		{
			ds=new DataSet();
			ds.ReadXml("..\\..\\..\\xml\\khongdau.xml");
			string s1=s.Trim().ToUpper(),s2="";
			DataRow r;
			for(int i=0;i<s1.Length;i++)
			{
				if (s1[i].ToString().Trim()!="" && char.IsLetter(Convert.ToChar(s1[i].ToString().Trim())))
				{	
					r=getrowbyid(ds.Tables[0],"codau='"+s1[i].ToString()+"'");
					if (r!=null) s2+=r[1].ToString();
					else s2+=s1[i];
				}
			}
			return s2;
		}

		public int vodanh_gioitinh
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=119");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 1;}
			}
		}

		public int vodanh_tuoi
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=120");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 30;}
			}
		}

		public string vodanh_nghenghiep
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=121");
					return ds.Tables[0].Rows[0][0].ToString();
				}
				catch{return "99";}
			}
		}

		public string vodanh_dantoc
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=122");
					return ds.Tables[0].Rows[0][0].ToString();
				}
				catch{return "25";}
			}
		}

		public string vodanh_tinh
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=123");
					return ds.Tables[0].Rows[0][0].ToString();
				}
				catch{return Mabv.Substring(0,3);}
			}
		}

		public string vodanh_hoten
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=124");
					return ds.Tables[0].Rows[0][0].ToString();
				}
				catch{return "VODANH,VD";}
			}
		}


		public bool bBosolieuduoc
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=128");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bInthanhtoanchitiet
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=129");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bInylenh_cachdung
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=130");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bSuadt_chitiet
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=132");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bVantay
		{
			get
			{
				try
				{
					return int.Parse(Thongso("c140"))==1;
				}
				catch{return false;}
			}
		}

		public bool bVantay_mabntudong
		{
			get
			{
				try
				{
					return int.Parse(Thongso("c177"))==1;
				}
				catch{return false;}
			}
		}

		public bool bDsSothe
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=178");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bChenhlech
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=179");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bSuadoituong
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=180");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bYlenh_nhathuoc
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=181");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bCapve_noitru
		{
			//G46
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=182");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bBHYTngtr_noitru
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=183");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bSolan_donthuoc
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=184");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bLydomien
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=141");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		public bool bDienthoai
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=142");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public string sNhompttt
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=143");
					return ds.Tables[0].Rows[0][0].ToString().Trim();
				}
				catch{return "";}
			}
		}

		public int iThongtu03
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=198");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 0;}
			}
		}

		public bool bPttt_vienphi
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=144");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bEdit_pttt_vienphi
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=146");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bPttt_thuoc
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=145");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public int iTreem6tuoi
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=147");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 0;}
			}
		}
		public bool bBacsy_tiepdon
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=148");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public int iTunguyen
		{
			get{return _ctsdoituong.piTunguyen;}
		}

		public int iTunguyen_doituong_(int madoituong)
		{			
			try
			{
				int i_madt_tn=0;
				DataSet ds=get_data("select madt_cl, madoituong from doituong where chenhlech=1 and madoituong="+madoituong);
				if(ds.Tables[0].Rows.Count>0)
				{
					i_madt_tn= int.Parse(ds.Tables[0].Rows[0]["madt_cl"].ToString());
					if(i_madt_tn==0)i_madt_tn=iTunguyen;
				}
				else i_madt_tn=madoituong;
				return i_madt_tn;
			}
			catch{return iTunguyen;}
		}

		public int iTunguyen_doituong_(int madoituong, int iloaivp)
		{			
			try
			{
				int i_madt_tn=0;
				DataSet ds=get_data("select madt_cl, madoituong from v_loaivp_thanhtoan where  idloaivp="+iloaivp+" and madoituong="+madoituong);
				if(ds.Tables[0].Rows.Count>0)
				{
					i_madt_tn= int.Parse(ds.Tables[0].Rows[0]["madt_cl"].ToString());
					if(i_madt_tn==0)i_madt_tn=iTunguyen;
				}
				else i_madt_tn=madoituong;
				return i_madt_tn;
			}
			catch{return iTunguyen;}
		}		

		public int iTunguyen_doituong_(int madoituong, int iloaivp, int idgiavp)
		{			
			try
			{
				int i_madt_tn=0;
				string asql="select a.madt_cl, a.madoituong from v_loaivp_thanhtoan a, v_giavp b where a.idloaivp=b.id_loai and a.madoituong="+madoituong+" and b.id="+idgiavp;
				if(iloaivp>0)asql+=" and a.idloaivp="+iloaivp; 
				DataSet ds=get_data(asql);
				if(ds.Tables[0].Rows.Count>0)
				{
					i_madt_tn= int.Parse(ds.Tables[0].Rows[0]["madt_cl"].ToString());
					if(i_madt_tn==0)
						i_madt_tn=iTunguyen_doituong_(madoituong);
				}
				else i_madt_tn=madoituong;
				return i_madt_tn;
			}
			catch{return iTunguyen;}
		}
		public int iTunguyen_doituong_tt_loaivp(int madoituong, int iloaivp)
		{			
			try
			{
				int i_madt_tt=0;
				DataSet ds=get_data("select madt_tt, madoituong from v_loaivp_thanhtoan where  idloaivp="+iloaivp+" and madoituong="+madoituong);
				if(ds.Tables[0].Rows.Count>0)
				{
					i_madt_tt= int.Parse(ds.Tables[0].Rows[0]["madt_tt"].ToString());
					if(i_madt_tt==0)i_madt_tt=madoituong;
				}
				else i_madt_tt=madoituong;
				return i_madt_tt;
			}
			catch{return madoituong;}
		}

		public int iTunguyen_doituong_tt_loaivp(int madoituong, int iloaivp, int idgiavp)
		{			
			try
			{
				int i_madt_tt=0;
				string asql="select a.madt_tt, a.madoituong from v_loaivp_thanhtoan a, v_giavp b where a.idloaivp=b.id_loai and a.madoituong="+madoituong+" and b.id="+idgiavp;
				if(iloaivp>0)asql+=" and a.idloaivp="+iloaivp;
				DataSet ds=get_data(asql);
				if(ds.Tables[0].Rows.Count>0)
				{
					i_madt_tt= int.Parse(ds.Tables[0].Rows[0]["madt_tt"].ToString());
					if(i_madt_tt==0)i_madt_tt=madoituong;
				}
				else i_madt_tt=madoituong;
				return i_madt_tt;
			}
			catch{return madoituong;}
		}

		public bool bCapcuu_noitru
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=150");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bKyhieu_chung
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=151");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bKham_trong_ngoai_gio
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=153");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bDenngay_sothe
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=154");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bChieu_sang
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=155");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bDonthuoc_cachdung
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=156");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bChidinh_vienphi
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=157");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public string MaDangKyKhamBenh()//gam 10/02/2012
		{
			ds=get_data("select ten from d_thongso where id=216");
			if (ds.Tables[0].Rows.Count==0) return "";
			return ds.Tables[0].Rows[0][0].ToString();
		}

		public string ViTriMaDangKyKhamBenh()//gam 10/02/2012
		{
			ds=get_data("select ten from d_thongso where id=217");
			if (ds.Tables[0].Rows.Count==0) return "16,5";
			return ds.Tables[0].Rows[0][0].ToString();
		}

		public bool KiemTraDangKyTaiBenhVien(string strSoThe)//gam 10/02/2012
		{		
			bool bKetQua= false;
			try
			{
				string strViTri=ViTriMaDangKyKhamBenh();
				int pos=strViTri.IndexOf(",");
				if (pos!=-1)
				{
					int iV1=int.Parse(strViTri.Substring(0,pos))-1;
					int iV2=int.Parse(strViTri.Substring(pos+1));
					if( strSoThe.Substring(iV1,iV2) == MaDangKyKhamBenh() )
					{
						bKetQua = true;
					}

				}
				
			}
			catch{}
			return bKetQua;
		}

		public bool bHoisuc_dungcu
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=158");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		public bool bSophieu_pttt
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=159");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		public bool bChandoan_icd10
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=160");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		public bool bInphieuttravien_xuatkhoa
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=161");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		public bool bLoad_tiepdon
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=162");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		public bool bBHYT_tungay
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=163");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		public bool bInchidinh_donthuoc
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=164");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		public bool bSovaovien_ylenh
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=167");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		public bool bThuoc_ngay
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=169");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		public bool bKetxuat_bangdien
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=170");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		public bool bNoigioithieu_tiepdon
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=172");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bMabn_tudong_cdh
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=173");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public string Path_backup
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=174");
					return ds.Tables[0].Rows[0][0].ToString();
				}
				catch{return "c:\\medisoft\\backup";}
			}
		}

		public string Path_bangdien
		{
			get
			{
				string ret=System.IO.Directory.GetCurrentDirectory().Substring(0,3)+"\\medisoft\\bangdien";
				try
				{
					DataSet ds=get_data("select ten from thongso where id=171");
					if (ds.Tables[0].Rows[0][0].ToString()!="") ret=ds.Tables[0].Rows[0][0].ToString();
				}
				catch{}
				if (!System.IO.Directory.Exists(ret)) System.IO.Directory.CreateDirectory(ret);
				return ret;
			}
		}

		public bool bKhongin_tienkham
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=133");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bDanhmucthuocbv
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=48");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bLuachon_tienkham
		{
			get
			{
				try
				{
					return int.Parse(Thongso("c134"))==1;
				}
				catch{return false;}
			}		
		}

		public bool bDanhmuc_nhathuoc
		{
			get
			{
				try
				{
					return int.Parse(Thongso("c135"))==1;
				}
				catch{return false;}
			}		
		}

		public string gio_nhathuoc
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=136");
					return ds.Tables[0].Rows[0][0].ToString().Trim();
				}
				catch{return "00:00";}
			}
		}

		public string gio_bhyt
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=175");
					return ds.Tables[0].Rows[0][0].ToString().Trim();
				}
				catch{return "00:00";}
			}
		}

		public string kho_bhyt
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=176");
					return ds.Tables[0].Rows[0][0].ToString().Trim();
				}
				catch{return "";}
			}
		}

		public string gio_treem
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=185");
					return ds.Tables[0].Rows[0][0].ToString().Trim();
				}
				catch{return "00:00";}
			}
		}

		public string kho_treem
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=186");
					return ds.Tables[0].Rows[0][0].ToString().Trim();
				}
				catch{return "";}
			}
		}

		public string gio_ngoai
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=187");
					return ds.Tables[0].Rows[0][0].ToString().Trim();
				}
				catch{return "00:00";}
			}
		}

		public bool bTress_bame
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=188");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public int soprocess
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=189");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 1;}
			}
		}

		public string gio_linh
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=190");
					return ds.Tables[0].Rows[0][0].ToString().Trim();
				}
				catch{return "00:00";}
			}
		}

		public string kho_linh
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=191");
					return ds.Tables[0].Rows[0][0].ToString().Trim();
				}
				catch{return "";}
			}
		}

		public bool bSuadoituong_khambenh
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=192");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return true;}
			}
		}

		public bool bSuadoituong_ngoaitru
		{
			//E03.1
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1015");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return true;}
			}
		}
		public bool bChuyenkham_batbuot_nhapchandoan
		{
			//C59
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1016");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		public bool bKhambenh_batbuot_nhapchandoan
		{
			//C76
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1169");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		public bool bSuachandoanKB
		{
			//C76.1
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1171");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		public long songaysuachandoan
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1172");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 7;}
			}
		}
		public bool bDTChenhlech_khongnhapchidinh_vpkhoa
		{
			//H12
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1017");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bNhapnoicap_theBHYT
		{
			//H12
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1018");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		public bool bInmau38_khongcho_xuattutruc
		{
			//F50
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1019");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return true;}
			}
		}
		public bool bBH_chitra_1congkham
		{
			//G72
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1020");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		public bool bChidinh_TheoDoituong_kbdanhmuc
		{
			//H13
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1021");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		public bool bChenhlech_tructiep_theoloaivp
		{
			//G73
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1022");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		public bool bPhanbietkholinh_tronggio_ngoaigio
		{
			//F00
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1023");
					if(ds.Tables[0].Rows.Count==0)
					{
						ds=get_data("select ten from thongso where id=190 and (ten='00:00' or ten is null or ten='')");
						return ds.Tables[0].Rows.Count==0;

					}
					else return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		public bool bInPhieuThanhtoanravien_daydu
		{
			//G74
			get
			{
				try
				{					
					DataSet ds=get_data("select ten from thongso where id=1024");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		public bool bHienthi_BieutuongMayin
		{
			//A17
			get
			{
				try
				{					
					DataSet ds=get_data("select ten from thongso where id=1026");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		public int iNgaydieutri_ngayra_ngayvao_1
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1025");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 1;}
			}
		}
		public bool bQuantrihethong_suaxutri_PK_PL
		{
			//C60
			get
			{
				try
				{					
					DataSet ds=get_data("select ten from thongso where id=1028");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		public bool bThuoc_PTTT_lay_doituongvao
		{
			//I17
			get
			{
				try
				{					
					DataSet ds=get_data("select ten from thongso where id=1029");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		public int iSolanin_Phieulinh_medisoft
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1027");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 0;}
			}
		}
		public int iDoituong_ngoaigio
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=193");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 0;}
			}
		}

		public bool bLuu_Donthuoc_bacsy
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=194");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return true;}
			}
		}

		public bool bThuoc_nghi_letet
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=197");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bInchidinh_dien
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=199");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public string kho_nhathuoc
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=137");
					return ds.Tables[0].Rows[0][0].ToString().Trim();
				}
				catch{return "";}
			}
		}

		public string sGiobaocao
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=138");
					return ds.Tables[0].Rows[0][0].ToString();
				}
				catch{return "00:00";}
			}
		}

		public string sGiotrua_tu
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=268");
					return ds.Tables[0].Rows[0][0].ToString();
				}
				catch{return "00:00";}
			}
		}

		public string sGiotrua_den
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=269");
					return ds.Tables[0].Rows[0][0].ToString();
				}
				catch{return "00:00";}
			}
		}

		public string sGiochunhat
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=270");
					return ds.Tables[0].Rows[0][0].ToString();
				}
				catch{return "00:00";}
			}
		}

		public int songaydtngoaitru
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=139");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 30;}
			}
		}
		public bool bSuadt_thuoc_vp
		{
			//chi sua doi tuong ban dau trong thuoc: moi sua lai tu ngay 03/07/2010
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=131");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public int nhom_nhathuoc
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=165");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 1;}
			}
		}

		public int nhom_duoc
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=166");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 1;}
			}
		}

		public int nhom_duoc_noivien
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1049");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 1;}
			}
		}
		public bool bCongdon
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=200");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bMabame
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=114");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public string Path_thongbao
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=115");
					return ds.Tables[0].Rows[0][0].ToString();
				}
				catch{return "..\\..\\..\\doc\\thongbao.rtf";}
			}
		}

		public bool bKhamthai
		{
			get
			{
				try
				{
					return int.Parse(Thongso("c116"))==1;
				}
				catch{return false;}
			}
		}

		public bool bHonnhan
		{
			get
			{
				try
				{
					return int.Parse(Thongso("c125"))==1;
				}
				catch{return false;}
			}
		}

		public bool bMach_nhietdo
		{
			get
			{
				try
				{
					return int.Parse(Thongso("c126"))==1;
				}
				catch{return false;}
			}
		}

		public bool bLydokham
		{
			get
			{
				try
				{
					return int.Parse(Thongso("c127"))==1;
				}
				catch{return false;}
			}
		}

		public bool bSoluutru_nhapvien
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=111");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bNuocngoai(string m_mabn)
		{
			ds=get_data("select madantoc from btdbn where mabn='"+m_mabn+"'");
			if (ds.Tables[0].Rows.Count>0) return ds.Tables[0].Rows[0]["madantoc"].ToString()=="55";
			else return false;
		}

		public long dTygia
		{
			get
			{
				ds=get_data("select to_char(ngay,'yyyymmdd'),tygia from v_tygia order by ngay desc");
				if (ds.Tables[0].Rows.Count>0) return long.Parse(ds.Tables[0].Rows[0]["tygia"].ToString());
				else return 1;
			}
		}

		public bool bHiendanhsach
		{
			get
			{
				try
				{
					return int.Parse(Thongso("c105"))==1;
				}
				catch{return false;}
			}
		}

		public bool bSoluutru_kb
		{
			get
			{
				try
				{
					return int.Parse(Thongso("c273"))==1;
				}
				catch{return false;}
			}
		}

		public bool bHienkyhieu
		{
			get
			{
				try
				{
					return int.Parse(Thongso("c57"))==1;
				}
				catch{return false;}
			}
		}

		public bool bSobienlai
		{
			get
			{
				try
				{
					return int.Parse(Thongso("c58"))==1;
				}
				catch{return false;}
			}
		}

		public bool bDiungthuoc
		{
			get
			{
				try
				{
					return int.Parse(Thongso("c61"))==1;
				}
				catch{return false;}
			}
		}

		public int iTuoi_khamnhi
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=104");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 15;}
			}
		}

		public int iTuoi_nguoibenh
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=107");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 120;}
			}
		}

		public void TaoTable()
		{
			if (get_data("select * from btdkp_bv where makp='99'").Tables[0].Rows.Count==0)
				upd_btdkp_bv("btdkp_bv","99","Phòng lưu",0,0,"02","",4,0,"","","99","");
			if (get_data("select * from thongso where id=103").Tables[0].Rows.Count==0)
			{
				ds=new DataSet();
				ds.ReadXml("..\\..\\..\\xml\\thongso.xml");
				DataColumn dc=new DataColumn();
				dc.ColumnName="c105";
				dc.DataType=Type.GetType("System.String");
				ds.Tables[0].Columns.Add(dc);
				ds.Tables[0].Rows[0]["c105"]="0";
				ds.WriteXml("..\\..\\..\\xml\\thongso.xml");
				execute_data("insert into thongso(id,ten) values (103,"+"1"+")");
				sql="create table DMTHON(THON nvarchar2(50))";
				execute_data(sql);
				sql="alter table tainantt add(DIENBIEN number(1),XUTRI number(1),THON nvarchar2(50),MATT varchar2(3),MAQU varchar2(5),MAPHUONGXA varchar2(7))";
				execute_data(sql);
				sql="update tainantt set dienbien=3,xutri=7,matt="+Mabv.Substring(0,3)+",maqu="+Mabv.Substring(0,3)+"00"+",maphuongxa="+Mabv.Substring(0,3)+"0000";
				execute_data(sql);
				sql="create table DMDIENBIEN(MA number(1),TEN nvarchar2(50),STT number(2))";
				execute_data(sql);
				sql="create table DMXUTRI(MA number(1),TEN nvarchar2(50),STT number(2))";
				execute_data(sql);
				sql="alter table dm_01 add(LOAI varchar2(1),KP number(1),MATK number(2))";
				execute_data(sql);
				sql="alter table tiepdon add(DONE varchar2(1))";
				execute_data(sql);
				xml_access();
			}
			try
			{
				ds=new DataSet();
				ds.ReadXml("..\\..\\..\\xml\\thongso.xml");
				DataColumn dc=new DataColumn();
				dc.ColumnName="c273";
				dc.DataType=Type.GetType("System.String");
				ds.Tables[0].Columns.Add(dc);
				ds.Tables[0].Rows[0]["c273"]="0";
				ds.WriteXml("..\\..\\..\\xml\\thongso.xml");
			}
			catch{}
		}

		private void xml_access()
		{
			execute_data("delete from dm_01");
			ds=new DataSet();
			ds.ReadXml("..\\..\\..\\xml\\dm_01.xml");
			foreach(DataRow r in ds.Tables[0].Rows)
				upd_dm01(int.Parse(r["ma"].ToString()),r["stt"].ToString(),r["ten"].ToString(),r["loai"].ToString(),int.Parse(r["kp"].ToString()),int.Parse(r["matk"].ToString()));
			foreach(DataRow r in get_data("select * from btdkp_bv order by loai").Tables[0].Rows)
				upd_dm01(int.Parse(r["makp"].ToString())+51,"-",r["tenkp"].ToString(),"C",(r["loai"].ToString()=="0")?2:1,int.Parse(r["makpbo"].ToString())+12);
			kh_dm_1451();	
			xml_access("dmdiadiem");
			xml_access("dmngodoc");
			xml_access("dmnguyennhan");
			xml_access("dmbophan");
			xml_access("dmdienbien");
			xml_access("dmxutri");
		}

		private void kh_dm_1451()
		{
			execute_data("delete from kh_dm_1451");
			ds=new DataSet();
			ds.ReadXml("..\\..\\..\\xml\\kh_dm_1451.xml");
			foreach(DataRow r in ds.Tables[0].Rows)
				upd_danhmuc(int.Parse(r["ma"].ToString()),r["stt"].ToString(),r["ten"].ToString(),"kh_dm_1451");
		}

		private void xml_access(string tenfile)
		{
			execute_data("delete from "+tenfile);
			ds=new DataSet();
			ds.ReadXml("..\\..\\..\\xml\\"+tenfile+".xml");
			foreach(DataRow r in ds.Tables[0].Rows)
				upd_danhmuc(int.Parse(r["ma"].ToString()),int.Parse(r["stt"].ToString()),r["ten"].ToString(),tenfile);
		}

		//ThanhCuong 04/04/2012
		public bool upd_danhmuc(int m_ma,string m_stt,string m_ten,string m_table, int m_tuyen, string m_coso)
		{
			sql="update "+m_table+" set stt=:m_stt,ten=:m_ten,tuyen=:m_tuyen,coso=:m_coso";
			sql+=" where ma=:m_ma and tuyen=:m_tuyen and coso=:m_coso";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_stt",OracleType.VarChar).Value=m_stt;
				cmd.Parameters.Add("m_ten",OracleType.NVarChar).Value=m_ten;
				cmd.Parameters.Add("m_tuyen",OracleType.Number).Value=m_tuyen;
				cmd.Parameters.Add("m_coso",OracleType.VarChar).Value=m_coso;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+m_table+" (ma,stt,ten,tuyen,coso) values (:m_ma,:m_stt,:m_ten,:m_tuyen,:m_coso)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_stt",OracleType.VarChar).Value=m_stt;
					cmd.Parameters.Add("m_ten",OracleType.NVarChar).Value=m_ten;
					cmd.Parameters.Add("m_tuyen",OracleType.Number).Value=m_tuyen;
					cmd.Parameters.Add("m_coso",OracleType.VarChar).Value=m_coso;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,m_table);
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}
		//End ThanhCuong 04/04/2012
		private bool upd_danhmuc(int m_ma,int m_stt,string m_ten,string m_table)
		{
			sql="update "+m_table+" set stt=:m_stt,ten=:m_ten";
			sql+=" where ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
				cmd.Parameters.Add("m_ten",OracleType.NVarChar,100).Value=m_ten;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+m_table+" (ma,stt,ten) values (:m_ma,:m_stt,:m_ten)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
					cmd.Parameters.Add("m_ten",OracleType.NVarChar,100).Value=m_ten;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,m_table);
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		
		public bool bAdmin(int userid)
		{
			try
			{
				ds=get_data("select manhom from dlogin where manhom in (0,1) and id="+userid);
				return ds.Tables[0].Rows.Count!=0;
			}
			catch{return false;}
		}

		public bool bAdmin_khoaphong(int userid)
		{
			try
			{
				// nam ngay 19/06/2012 chi co user quan trị he thong moi duoc sua quan trị khoa khoa phòn không ho sữa.
				ds=get_data("select manhom from dlogin where manhom in(0,1) and id="+userid);
				return ds.Tables[0].Rows.Count!=0;
			}
			catch{return false;}
		}
		//nam ngay 29/06/2012
		public bool bAdmin_hethong(int userid)
		{
			try
			{
				// nam ngay 19/06/2012 chi co user quan trị he thong moi duoc sua quan trị khoa khoa phòn không ho sữa.
				ds=get_data("select manhom from dlogin where manhom in(0) and id="+userid);
				return ds.Tables[0].Rows.Count!=0;
			}
			catch{return false;}
		}



		public bool bThuvien
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=101");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch
				{
					if (get_data("select * from thongso where id=101").Tables[0].Rows.Count==0) execute_data("insert into thongso(id,ten) values (101,"+"0"+")");
					return false;
				}
			}
		}

		public bool bHanhChinh
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=0");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public void MaskDigit(System.Windows.Forms.KeyPressEventArgs e)
		{
			if(Char.IsDigit(e.KeyChar) || e.KeyChar == 8) e.Handled = false;
			else e.Handled = true;
		}
		public void MaskDecimal(System.Windows.Forms.KeyPressEventArgs e)
		{
			if(Char.IsDigit(e.KeyChar) || e.KeyChar == '.' || e.KeyChar == 8) e.Handled = false;
			else e.Handled = true;
		}
		public void MaskDecimal_div(System.Windows.Forms.KeyPressEventArgs e)
		{
			if(Char.IsDigit(e.KeyChar) || e.KeyChar == '/' || e.KeyChar == '.' || e.KeyChar == 8) e.Handled = false;
			else e.Handled = true;
		}
		public string abc_uni(string s)
		{
			DataSet ds=new DataSet();
			ds.ReadXml("..\\..\\..\\xml\\doifont.xml");
			string s_abc=s.Trim(),s_uni="",s1="óïñòô­øõö÷ùýúûüþãßáâä«èåæçé¬íêëìî1";
			DataRow r;
			for(int i=0;i<s_abc.Length;i++)
			{
				if (s1.IndexOf(s_abc[i].ToString())!=-1)
				{
					r=getrowbyid(ds.Tables[0],"abc1='"+s_abc[i].ToString()+"'");
					if (r!=null) s_uni+=r[3].ToString();
					else s_uni+=s_abc[i];
				}
				else
				{
					r=getrowbyid(ds.Tables[0],"abc='"+s_abc[i].ToString()+"'");
					if (r!=null) s_uni+=r[1].ToString();
					else s_uni+=s_abc[i];
				}
			}
			return s_uni;
		}

		public string getIndex(int i)
		{
			string[] map = {"A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K", "L", "M", "N", "O", "P", "Q", "R", "S", "T", "U", "V", "W", "X", "Y", "Z",
							   "AA", "AB", "AC", "AD", "AE", "AF", "AG", "AH", "AI", "AJ", "AK", "AL", "AM", "AN", "AO", "AP", "AQ", "AR", "AS", "AT", "AU", "AV", "AW", "AX", "AY", "AZ",
							   "BA", "BB", "BC", "BD", "BE", "BF", "BG", "BH", "BI", "BJ", "BK", "BL", "BM", "BN", "BO", "BP", "BQ", "BR", "BS", "BT", "BU", "BV", "BW", "BX", "BY", "BZ",
							   "CA", "CB", "CC", "CD", "CE", "CF", "CG", "CH", "CI", "CJ", "CK", "CL", "CM", "CN", "CO", "CP", "CQ", "CR", "CS", "CT", "CU", "CV", "CW", "CX", "CY", "CZ",
							   "DA", "DB", "DC", "DD", "DE", "DF", "DG", "DH", "DI", "DJ", "DK", "DL", "DM", "DN", "DO", "DP", "DQ", "DR", "DS", "DT", "DU", "DV", "DW", "DX", "DY", "DZ",
							   "EA", "EB", "EC", "ED", "EE", "EF", "EG", "EH", "EI", "EJ", "EK", "EL", "EM", "EN", "EO", "EP", "EQ", "ER", "ES", "ET", "EU", "EV", "EW", "EX", "EY", "EZ",
							   "FA", "FB", "FC", "FD", "FE", "FF", "FG", "FH", "FI", "FJ", "FK", "FL", "FM", "FN", "FO", "FP", "FQ", "FR", "FS", "FT", "FU", "FV", "FW", "FX", "FY", "FZ",
							   "GA", "GB", "GC", "GD", "GE", "GF", "GG", "GH", "GI", "GJ", "GK", "GL", "GM", "GN", "GO", "GP", "GQ", "GR", "GS", "GT", "GU", "GV", "GW", "GX", "GY", "GZ",
							   "HA", "HB", "HC", "HD", "HE", "HF", "HG", "HH", "HI", "HJ", "HK", "HL", "HM", "HN", "HO", "HP", "HQ", "HR", "HS", "HT", "HU", "HV", "HW", "HX", "HY", "HZ",
							   "IA", "IB", "IC", "ID", "IE", "IF", "IG", "IH", "II", "IJ", "IK", "IL", "IM", "IN", "IO", "IP", "IQ", "IR", "IS", "IT", "IU", "IV", "IW", "IX", "IY", "IZ",
							   "JA", "JB", "JC", "JD", "JE", "JF", "JG", "JH", "JI", "JJ", "JK", "JL", "JM", "JN", "JO", "JP", "JQ", "JR", "JS", "JT", "JU", "JV", "JW", "JX", "JY", "JZ",
							   "KA", "KB", "KC", "KD", "KE", "KF", "KG", "KH", "KI", "KJ", "KK", "KL", "KM", "KN", "KO", "KP", "KQ", "KR", "KS", "KT", "KU", "KV", "KW", "KX", "KY", "KZ",
							   "LA", "LB", "LC", "LD", "LE", "LF", "LG", "LH", "LI", "LJ", "LK", "LL", "LM", "LN", "LO", "LP", "LQ", "LR", "LS", "LT", "LU", "LV", "LW", "LX", "LY", "LZ",
							   "MA", "MB", "MC", "MD", "ME", "MF", "MG", "MH", "MI", "MJ", "MK", "ML", "MM", "MN", "MO", "MP", "MQ", "MR", "MS", "MT", "MU", "MV", "MW", "MX", "MY", "MZ",
							   "NA", "NB", "NC", "ND", "NE", "NF", "NG", "NH", "NI", "NJ", "NK", "NL", "NM", "NN", "NO", "NP", "NQ", "NR", "NS", "NT", "NU", "NV", "NW", "NX", "NY", "NZ",
							   "OA", "OB", "OC", "OD", "OE", "OF", "OG", "OH", "OI", "OJ", "OK", "OL", "OM", "ON", "OO", "OP", "OQ", "OR", "OS", "OT", "OU", "OV", "OW", "OX", "OY", "OZ",
							   "PA", "PB", "PC", "PD", "PE", "PF", "PG", "PH", "PI", "PJ", "PK", "PL", "PM", "PN", "PO", "PP", "PQ", "PR", "PS", "PT", "PU", "PV", "PW", "PX", "PY", "PZ",
							   "QA", "QB", "QC", "QD", "QE", "QF", "QG", "QH", "QI", "QJ", "QK", "QL", "QM", "QN", "QO", "QP", "QQ", "QR", "QS", "QT", "QU", "QV", "QW", "QX", "QY", "QZ",
							   "RA", "RB", "RC", "RD", "RE", "RF", "RG", "RH", "RI", "RJ", "RK", "RL", "RM", "RN", "RO", "RP", "RQ", "RR", "RS", "RT", "RU", "RV", "RW", "RX", "RY", "RZ",
							   "SA", "SB", "SC", "SD", "SE", "SF", "SG", "SH", "SI", "SJ", "SK", "SL", "SM", "SN", "SO", "SP", "SQ", "SR", "SS", "ST", "SU", "SV", "SW", "SX", "SY", "SZ",
							   "TA", "TB", "TC", "TD", "TE", "TF", "TG", "TH", "TI", "TJ", "TK", "TL", "TM", "TN", "TO", "TP", "TQ", "TR", "TS", "TT", "TU", "TV", "TW", "TX", "TY", "TZ",
							   "UA", "UB", "UC", "UD", "UE", "UF", "UG", "UH", "UI", "UJ", "UK", "UL", "UM", "UN", "UO", "UP", "UQ", "UR", "US", "UT", "UU", "UV", "UW", "UX", "UY", "UZ",
							   "VA", "VB", "VC", "VD", "VE", "VF", "VG", "VH", "VI", "VJ", "VK", "VL", "VM", "VN", "VO", "VP", "VQ", "VR", "VS", "VT", "VU", "VV", "VW", "VX", "VY", "VZ",
							   "WA", "WB", "WC", "WD", "WE", "WF", "WG", "WH", "WI", "WJ", "WK", "WL", "WM", "WN", "WO", "WP", "WQ", "WR", "WS", "WT", "WU", "WV", "WW", "WX", "WY", "WZ",
							   "XA", "XB", "XC", "XD", "XE", "XF", "XG", "XH", "XI", "XJ", "XK", "XL", "XM", "XN", "XO", "XP", "XQ", "XR", "XS", "XT", "XU", "XV", "XW", "XX", "XY", "XZ",
							   "YA", "YB", "YC", "YD", "YE", "YF", "YG", "YH", "YI", "YJ", "YK", "YL", "YM", "YN", "YO", "YP", "YQ", "YR", "YS", "YT", "YU", "YV", "YW", "YX", "YY", "YZ",
							   "ZA", "ZB", "ZC", "ZD", "ZE", "ZF", "ZG", "ZH", "ZI", "ZJ", "ZK", "ZL", "ZM", "ZN", "ZO", "ZP", "ZQ", "ZR", "ZS", "ZT", "ZU", "ZV", "ZW", "ZX", "ZY", "ZZ"};

			return map[i];
		}

		public Color getColor(int i)
		{
			Color[] color = {Color.FromArgb(255,192,192),Color.FromArgb(192,192,255),Color.FromArgb(255,224,192),Color.FromArgb(192,255,192),Color.FromArgb(255,192,255),
								Color.Aqua,Color.Aquamarine,Color.BurlyWood,Color.CadetBlue,Color.Chartreuse,Color.Chocolate,Color.Coral,Color.CornflowerBlue,
								Color.Crimson,Color.Cyan,Color.DarkBlue,Color.DarkCyan,Color.DarkGoldenrod,Color.DarkGray,Color.DarkGreen,Color.DarkKhaki,Color.DarkMagenta,Color.DarkOliveGreen,
								Color.DarkOrange,Color.DarkOrchid,Color.DarkRed,Color.DarkSalmon,Color.DarkSeaGreen,Color.DarkSlateBlue,Color.DarkSlateGray,Color.DarkTurquoise,Color.DarkViolet,Color.DeepPink,
								Color.DeepSkyBlue,Color.DimGray,Color.DodgerBlue,Color.Firebrick,Color.FloralWhite,Color.ForestGreen,Color.Fuchsia,Color.Gainsboro,Color.Gold,Color.Goldenrod,
								Color.Gray,Color.Green,Color.GreenYellow,Color.Honeydew,Color.HotPink,Color.IndianRed,Color.Indigo,Color.Ivory,Color.Khaki,Color.Lavender,
								Color.LavenderBlush,Color.LawnGreen,Color.LemonChiffon,Color.LightBlue,Color.LightCoral,Color.LightCyan,Color.LightGoldenrodYellow,Color.LightGray,Color.LightGreen,Color.LightPink,
								Color.LightSalmon,Color.LightSeaGreen,Color.LightSkyBlue,Color.LightSlateGray,Color.LightSteelBlue,Color.LightYellow,Color.Lime,Color.LimeGreen,Color.Linen,Color.Magenta};
			return color[i];
		}

		public string Export_Excel(DataSet dset,string tenfile)
		{
			try
			{
				string dirPath=AppDomain.CurrentDomain.BaseDirectory+"Excel";
				string filePath=dirPath+"\\"+tenfile+".xls";
				if (!System.IO.Directory.Exists(dirPath)) System.IO.Directory.CreateDirectory(dirPath);
				System.IO.StreamWriter sw  =  new System.IO.StreamWriter(filePath,false,System.Text.Encoding.Unicode);
				string astr="";
				astr="<Table>";//"<Table border=1>";
				astr=astr + "<tr>";
				for(int i=0;i<dset.Tables[0].Columns.Count;i++)
				{
					astr=astr + "<th>";
					astr=astr + dset.Tables[0].Columns[i].ColumnName;
					astr=astr + "</th>";
				}
				astr=astr + "</tr>";
				sw.Write(astr);
				for(int i=0;i<dset.Tables[0].Rows.Count;i++)
				{
					astr="<tr>";
					for(int j=0;j<dset.Tables[0].Columns.Count;j++)
					{
						astr=astr + "<td>";
						astr=astr + dset.Tables[0].Rows[i][j].ToString();
						astr=astr + "</td>";
					}
					astr=astr + "</tr>";
					sw.Write(astr);
				}
				astr="</Table>";
				sw.Write(astr);
				sw.Close();
				return filePath;
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,tenfile);
				return "";
			}
		}

		private string onlyso(string s)
		{
			string ret="",s1=" 0123456789";
			for(int i=0;i<s.Length;i++)
				if (s1.IndexOf(s.Substring(i,1))!=-1) ret+=s.Substring(i,1);
			return ret;
		}

		public string Ktngaygio(string s,int len)
		{
			try
			{
				string s1=onlyso(s);
				if (len==10)
					return s1.Substring(0,2).Trim().PadLeft(2,'0')+"/"+s1.Substring(2,2).Trim().PadLeft(2,'0')+"/"+s1.Substring(4).Trim().PadLeft(4,'0');
				else
					return s1.Substring(0,2).Trim().PadLeft(2,'0')+"/"+s1.Substring(2,2).Trim().PadLeft(2,'0')+"/"+s1.Substring(4,4).Trim().PadLeft(4,'0')+" "+s1.Substring(9,2).Trim().PadLeft(2,'0')+":"+s1.Substring(11,2).Trim().PadLeft(2,'0');
			}
			catch{return s;}
		}

		public bool bNgay(string ngay)
		{
			try
			{
				if (ngay.IndexOf("_")!=-1) return false;
				int len=ngay.Length;
				if (len==0) return false;
				string dd=ngay.Substring(0,2),mm=ngay.Substring(3,2),yyyy=ngay.Substring(6,4);
				string s31="01+03+05+07+08+10+12+",s30="04+06+09+11+",s2829=(int.Parse(yyyy)%4==0)?"29":"28";
				if (int.Parse(yyyy.Substring(0,1))<1) return false;
				if (int.Parse(mm)<1 || int.Parse(mm)>12) return false;
				if (s31.IndexOf(mm+"+")>-1)
				{
					if (int.Parse(dd)<1 || int.Parse(dd)>31) return false;
				}
				else if (s30.IndexOf(mm+"+")>-1)
				{
					if (int.Parse(dd)<1 || int.Parse(dd)>30) return false;
				}
				else if (int.Parse(dd)<1 || int.Parse(dd)>int.Parse(s2829)) return false;
				if (len>10)
				{
					string hh=ngay.Substring(11,2),MM=ngay.Substring(14,2);
					if (int.Parse(hh)>23) return false;
					if (int.Parse(MM)>59) return false;
				}
				return true;
			}
			catch{return false;};
		}

		public bool bGio(string gio)
		{
			string hh=gio.Substring(0,2),MM=gio.Substring(3,2);
			if (int.Parse(hh)>23) return false;
			if (int.Parse(MM)>59) return false;
			return true;
		}

		public string Caps( string s)
		{
			if (s.Length==0 || s==null) return null;
			System.Text.StringBuilder sb = new System.Text.StringBuilder(s);//.ToLower());
			sb[0] = Char.ToUpper( sb[0]);
			string ret=null;			
			int num = 0;int ispace =0;
			while(num < sb.Length)
			{
				if(Char.IsWhiteSpace(sb[num])) ispace++;
				if(!Char.IsWhiteSpace(sb[num])) 							
				{
					if (ispace>0 && num>0)
					{
						sb[num] = Char.ToUpper( sb[num]);
						ispace=0;
					}
				}				
				num++;				
			}
			num = 0;
			ispace=0;
			while(num < sb.Length)
			{
				if(Char.IsWhiteSpace(sb[num]))
				{
					if (ispace<1 && num>0 ) ret+=sb[num];
					ispace++;
				}
				else
				{
					ret+=sb[num];
					ispace=0;
				}				
				num++;
			}
			return ret;
		}

		public bool bNgay(string ngayvao,string ngaysinh)
		{
			//true: khi ngay sinh < ngay vao
			//false: khi ngay sinh > ngay vao
			try
			{
				int d1 = DateTime.Now.Day;
				int m1 = DateTime.Now.Month;
				int y1 = DateTime.Now.Year;
				if (ngayvao!="")
				{
					y1=int.Parse(ngayvao.Substring(6,4));
					m1=int.Parse(ngayvao.Substring(3,2));
					d1=int.Parse(ngayvao.Substring(0,2));
				}
				int d2 = int.Parse(ngaysinh.Substring(0,2));
				int m2 = int.Parse(ngaysinh.Substring(3,2));
				int y2 = int.Parse(ngaysinh.Substring(6,4));

				if (y2>y1) return false;
				else if (y2<y1) return true;
				if (m2>m1) return false;
				else if (m2<m1) return true;
				if (d2>d1) return false;
				return true;
			}
			catch{return false;}
		}

		public string Max(string ngay1,string ngay2)
		{
			int y1=int.Parse(ngay1.Substring(6,4));
			int m1=int.Parse(ngay1.Substring(3,2));
			int d1=int.Parse(ngay1.Substring(0,2));

			int d2 = int.Parse(ngay2.Substring(0,2));
			int m2 = int.Parse(ngay2.Substring(3,2));
			int y2 = int.Parse(ngay2.Substring(6,4));

			if (y2>y1) return ngay2;
			else if (y2<y1) return ngay1;
			if (m2>m1) return ngay2;
			else if (m2<m1) return ngay1;
			if (d2>d1) return ngay2;
			return ngay1;
		}

		public bool bNgaygio(string ngayrv,string ngayvv)
		{
			try
			{
				int y1=int.Parse(ngayrv.Substring(6,4));
				int m1=int.Parse(ngayrv.Substring(3,2));
				int d1=int.Parse(ngayrv.Substring(0,2));
				int h1=int.Parse(ngayrv.Substring(11,2));
				int p1=int.Parse(ngayrv.Substring(14,2));

				int d2=int.Parse(ngayvv.Substring(0,2));
				int m2=int.Parse(ngayvv.Substring(3,2));
				int y2=int.Parse(ngayvv.Substring(6,4));
				int h2=int.Parse(ngayvv.Substring(11,2));
				int p2=int.Parse(ngayvv.Substring(14,2));

				if (y2>y1) return false;
				else if (y2<y1) return true;
				if (m2>m1) return false;
				else if (m2<m1) return true;
				if (d2>d1) return false;
				else if (d2<d1) return true;
				if (h2>h1) return false;
				else if(h2<h1) return true;
				if (p2>p1) return false;
				return true;
			}
			catch{return false;}
		}

		public string Tuoivao(string ngayvao,string ngaysinh)
		{
			string tuoi="";
			int namht=DateTime.Now.Year;
			int thanght=DateTime.Now.Month;
			int ngayht=DateTime.Now.Day;
			int gioht=DateTime.Now.Hour;

			int nam=int.Parse(ngaysinh.Substring(6,4));
			int thang=int.Parse(ngaysinh.Substring(3,2));
			int ngay=int.Parse(ngaysinh.Substring(0,2));
			int gio=(ngaysinh.Length>10)?int.Parse(ngaysinh.Substring(11,2)):0;
			if (ngayvao!="")
			{
				namht=int.Parse(ngayvao.Substring(6,4));
				thanght=int.Parse(ngayvao.Substring(3,2));
				ngayht=int.Parse(ngayvao.Substring(0,2));
				gioht=(ngayvao.Length>10)?int.Parse(ngayvao.Substring(11,2)):0;
			}
			if(nam==namht)
			{
				if(thang==thanght)
				{
					if(ngay==ngayht) tuoi="3/"+(gioht-gio);
					else tuoi="2/"+(ngayht-ngay);
				}
				else tuoi="1/"+(thanght-thang);
			}
			else tuoi="0/"+(namht-nam);
			return tuoi;
		}

		public int Namsinh(string ngaysinh)
		{
			return int.Parse(ngaysinh.Substring(6,4));
		}

		public int Namsinh(string ngayvao,int ituoi,int iloai)
		{
			int namht=(ngayvao!="")?int.Parse(ngayvao.Substring(6,4)):DateTime.Now.Year;
			int iNamsinh=0;
			if (iloai==1 && ituoi<=12)
			{
				if (bNgay(DateTime.Now.Day.ToString().PadLeft(2,'0')+"/"+ituoi.ToString().PadLeft(2,'0')+"/"+namht.ToString().PadLeft(4,'0'),DateTime.Now.Day.ToString().PadLeft(2,'0')+"/"+DateTime.Now.Month.ToString().PadLeft(2,'0')+"/"+namht.ToString().PadLeft(4,'0')))
					iNamsinh=namht-1;
				else iNamsinh=namht;
			}
			else if (iloai==1 && ituoi<=72)
			{
				int tmp_tuoi=ituoi/12;
				int tmp_thang=ituoi -(tmp_tuoi*12);
				if (bNgay(DateTime.Now.Day.ToString().PadLeft(2,'0')+"/"+tmp_thang.ToString().PadLeft(2,'0')+"/"+namht.ToString().PadLeft(4,'0'),DateTime.Now.Day.ToString().PadLeft(2,'0')+"/"+DateTime.Now.Month.ToString().PadLeft(2,'0')+"/"+namht.ToString().PadLeft(4,'0')))
					iNamsinh=namht-tmp_tuoi-1;
				else iNamsinh=namht-tmp_tuoi;
			}
			else
			{
				switch (iloai)
				{
					case 0: iNamsinh=namht-ituoi; // nam 18/06/2012
						break;
					case 1:	iNamsinh=namht-ituoi/12;
						break;
					case 2: iNamsinh=namht-ituoi/365;
						break;
					default: iNamsinh=namht;
						break;
				}
			}
			return iNamsinh;
		}
		// nam  18/06/2012 dieu chinh do tuoi  theo nam sinh(tuoi thay doi nhung nam sinh du nguyen)
		public int Namsinh_(string ngayvao,int iNamsinh,int iloai)
		{
			int namht=(ngayvao!="")?int.Parse(ngayvao.Substring(6,4)):DateTime.Now.Year;
			int ituoi=0;
			if (iloai==1 && ituoi<=12)
			{
				if (bNgay(DateTime.Now.Day.ToString().PadLeft(2,'0')+"/"+ituoi.ToString().PadLeft(2,'0')+"/"+namht.ToString().PadLeft(4,'0'),DateTime.Now.Day.ToString().PadLeft(2,'0')+"/"+DateTime.Now.Month.ToString().PadLeft(2,'0')+"/"+namht.ToString().PadLeft(4,'0')))
					iNamsinh=namht-1;
				else iNamsinh=namht;
			}
			else if (iloai==1 && ituoi<=72)
			{
				int tmp_tuoi=ituoi/12;
				int tmp_thang=ituoi -(tmp_tuoi*12);
				if (bNgay(DateTime.Now.Day.ToString().PadLeft(2,'0')+"/"+tmp_thang.ToString().PadLeft(2,'0')+"/"+namht.ToString().PadLeft(4,'0'),DateTime.Now.Day.ToString().PadLeft(2,'0')+"/"+DateTime.Now.Month.ToString().PadLeft(2,'0')+"/"+namht.ToString().PadLeft(4,'0')))
					iNamsinh=namht-tmp_tuoi-1;
				else iNamsinh=namht-tmp_tuoi;
			}
			else
			{
				switch (iloai)
				{
						//case 0: iNamsinh=namht-ituoi; // nam 18/06/2012
					case 0 : ituoi= namht-iNamsinh;
						break;
					case 1:	 ituoi=(namht- iNamsinh)*12;
						break;
					case 2: ituoi=(namht-iNamsinh)*365;
						break ;
					
				}
			}
			return ituoi;
		}
		// end nam


		
		public string Ngaylocal(string s)
		{
			try
			{
				string s1=s.Substring(0,10),s2="";
				if (s.Length>16) s=s.Substring(0,16);
				if (s.Length==16) s2=s.Substring(10,6);
				return StringToDate(s1).ToLocalTime().ToShortDateString()+s2;
			}
			catch{return "";};
		}

		public Int64 songay(DateTime d1,DateTime d2,int congthem)
		{
			try
			{	
				return Convert.ToInt64(d1.ToOADate()-d2.ToOADate()+congthem);
			}
			catch{return 0;}
		}
		public double songay_1(DateTime d1,DateTime d2)
		{
			double ret=0;
			try
			{	
				double so=d1.ToOADate()-d2.ToOADate();
				if (so>1)
				{
					string s=so.ToString();
					int p=s.IndexOf(".");
					if (p!=-1)
					{
						ret=double.Parse(s.Substring(0,p));
						string c="0."+s.Substring(p+1);
						ret+=((double.Parse(c)<0.5)?0.5:1.0);
					}
					else {ret=so;}
				}
				else
				{
					so=StringToDate(DateToString("dd/MM/yyyy",d1)).ToOADate()-StringToDate(DateToString("dd/MM/yyyy",d2)).ToOADate();
					ret=Math.Max(0.5,Math.Floor(so));//+congthem;
				}
			}
			catch{ret=0;}
			return ret;
		}

		public double sogio(DateTime d1,DateTime d2)
		{
			TimeSpan duration = d1-d2;
			return duration.TotalHours;
		}

		public void songayblock(DateTime d1,DateTime d2,string ngay,long id,string mabn,long maql,long idkhoa,
			string ngayrv,string makp,int madoituong,decimal dongia,int userid,int idgiuong)
		{
			DataTable dtdt=get_data("select * from doituong").Tables[0];
			DataRow r2=getrowbyid(dtdt,"madoituong="+madoituong);
			string fie="gia_th", fie_cl="gia_dv";
			if (r2!=null) fie=r2["field_gia"].ToString().Trim();
			decimal tygia = (fie.IndexOf("_nn") != -1) ? dTygia : 1;
			bool bDoituongcoChenhlech=r2["chenhlech"].ToString()=="1";
			if(bDoituongcoChenhlech)
			{
				DataRow r3=getrowbyid(dtdt,"madoituong="+iTunguyen);
				if(r3!=null)fie_cl=r3["field_gia"].ToString().Trim();
			}
			double so=0,songay=0;			
			double gio=sogio(d1,d2);
			int gioblock=iBlock;
			int ngayblock=iNgay_block;
			long block=0;
			decimal dBhyt=0;
			long tmp_id=0;
			try
			{	
				sql="select a.*,c.bhyt as bhyt_b, c.gia_th as gia_th_b,c.gia_bh as gia_bh_b,c.gia_cs as gia_cs_bh,c.gia_dv as gia_dv_b,c.gia_nn as gia_nn_b ";
				sql+=" from dmgiuong a,dmphong b,v_giavp c ";
				sql+=" where a.idphong=b.id and a.block=c.id and b.dichvu=1 and a.id="+idgiuong;
				DataTable dt=get_data(sql).Tables[0];
				if (dt.Rows.Count>0)
				{
					if (gio>1)
					{
						block=long.Parse(dt.Rows[0]["block"].ToString());
						
						songay=Math.Floor(gio/24);
						so=(gio-songay*24)/gioblock;
						so+=(so.ToString().IndexOf(".")!=-1)?1:0;
						so=Math.Floor(so);
						if (so>ngayblock || songay==0) //ThanhCuong 23/04/2012 - BV VuAnh nếu "NgàyRa-NgàyVào<=24h" thì tính 1 ngày, ngược lại tính như củ
						{
							songay+=1;
							so=0;
						}
						if (songay>0) 
						{
							upd_vpkhoa(mmyy(ngay),id,mabn,maql,idkhoa,ngayrv,makp,madoituong,idgiuong,decimal.Parse(songay.ToString()),dongia,0,userid,0);
							if(bChenhlech && bDoituongcoChenhlech)
							{
								dongia=decimal.Parse(dt.Rows[0][fie_cl].ToString())-dongia;
								tmp_id=-1*id;//get_id_vpkhoa;
								upd_vpkhoa(mmyy(ngay),tmp_id,mabn, maql, idkhoa,ngayrv,makp,iTunguyen,idgiuong,decimal.Parse(songay.ToString()),dongia,0,userid,0);
							}
						}
						if (so>0)
						{
								
							fie+="_b";
							tmp_id = get_id_vpkhoa;
							dongia=decimal.Parse(dt.Rows[0][fie].ToString())*tygia;
							upd_vpkhoa(mmyy(ngay),tmp_id,mabn,maql,idkhoa,ngayrv,makp,madoituong,Convert.ToInt32(block),decimal.Parse(so.ToString()),dongia,0,userid,0);
							//
							//bbbb: Block BHYT khong chi tra - kiem tra ty le BHYT chi tra
							dBhyt=decimal.Parse(dt.Rows[0]["bhyt_b"].ToString());
							if(dBhyt==0 && bDoituong_BHYT(madoituong))
							{
								madoituong=iTunguyen;
								fie=fie_cl;
								fie+="_b";
								dongia=decimal.Parse(dt.Rows[0][fie].ToString());
								tmp_id=-1*tmp_id;
								upd_vpkhoa(mmyy(ngay),tmp_id,mabn,maql,idkhoa,ngayrv,makp,madoituong,Convert.ToInt32(block),decimal.Parse(so.ToString()),dongia,0,userid,0);
							}
							//
						}
					}
				}
				else
				{					
					so=Math.Max(1,Math.Floor(StringToDate(DateToString("dd/MM/yyyy",d1)).ToOADate()-StringToDate(DateToString("dd/MM/yyyy",d2)).ToOADate()));
					upd_vpkhoa(mmyy(ngay),id,mabn,maql,idkhoa,ngayrv,makp,madoituong,idgiuong,decimal.Parse(so.ToString()),dongia,0,userid,0);
				}
				upd_theodoigiuong(id,ngayrv,madoituong,Math.Max(1,Math.Floor(StringToDate(DateToString("dd/MM/yyyy",d1)).ToOADate()-StringToDate(DateToString("dd/MM/yyyy",d2)).ToOADate())));
				execute_data("update dmgiuong set soluong=soluong-1,tinhtrang=0 where id="+idgiuong);
			}
			catch{}
		}

		public decimal songayblock(DataSet dsv,DateTime d1,DateTime d2,string ngay,long id,string mabn,long maql,long idkhoa,
			string ngayrv,string makp,int madoituong,decimal dongia,int idgiuong)
		{
			DataTable dtdt=get_data("select * from doituong").Tables[0];
			DataRow r2=getrowbyid(dtdt,"madoituong="+madoituong);
			string fie="gia_th",yymmdd=d2.Year.ToString().Substring(2,2)+d2.Month.ToString().PadLeft(2,'0')+d2.Day.ToString().PadLeft(2,'0');
			if (r2!=null) fie=r2["field_gia"].ToString().Trim();
			decimal tygia = (fie.IndexOf("_nn") != -1) ? dTygia : 1,stien=0;
			double so=0,songay=0;			
			double gio=sogio(d1,d2);
			int gioblock=iBlock;
			int ngayblock=iNgay_block;
			long block=0;
			decimal st=0;
			try
			{	
				sql="select a.*,c.bhyt as bhyt_b, c.gia_th as gia_th_b,c.gia_bh as gia_bh_b,c.gia_cs as gia_cs_bh,c.gia_dv as gia_dv_b,c.gia_nn as gia_nn_b ";
				sql+=" from dmgiuong a,dmphong b,v_giavp c ";
				sql+=" where a.idphong=b.id and a.block=c.id and b.dichvu=1 and a.id="+idgiuong;
				DataTable dt=get_data(sql).Tables[0];
				if (dt.Rows.Count>0)
				{
					if (gio>1)
					{
						block=long.Parse(dt.Rows[0]["block"].ToString());
						songay=Math.Floor(gio/24);
						so=(gio-songay*24)/gioblock;
						so+=(so.ToString().IndexOf(".")!=-1)?1:0;
						so=Math.Floor(so);
						if (so>ngayblock) 
						{
							songay+=1;
							so=0;
						}
						if (songay>0)
						{
							stien=decimal.Parse(songay.ToString())*dongia;
							if (dsv!=null)
							{
								sql="select 0 as idttrv,'"+yymmdd+"' as yymmdd, '"+ngayrv.Substring(0,10)+"' as ngay,'"+makp+"' as makp,b.id as mavp,"+dongia+" as dongia,"+songay+" as soluong,"+stien+" as sotien, ";
								sql+="0 as bhytt0107,0 as bhyt,0 as vattu,b.id_loai, 0 as giachenhlech ";
								sql+=" from v_giavp b,v_loaivp c where b.id_loai=c.id and b.id="+idgiuong;
								dsv.Merge(get_data(sql));
							}
							st+=stien;
						}
						if (so>0)
						{
							fie+="_b";//don gia block
							dongia=decimal.Parse(dt.Rows[0][fie].ToString())*tygia;
							stien=decimal.Parse(so.ToString())*dongia;
							st+=stien;
							if (dsv!=null)
							{
								sql="select 0 as idttrv,'"+yymmdd+"' as yymmdd, '"+ngayrv.Substring(0,10)+"' as ngay,'"+makp+"' as makp,b.id as mavp,"+dongia+" as dongia,"+so+" as soluong,"+stien+" as sotien, ";
								sql+=" 0 as bhytt0107,";
								if(bDoituong_BHYT(madoituong.ToString()))
								{
									sql+=""+stien+" as bhyt,";
								}
								else
								{
									sql+=" 0 as bhyt,";
								}								
								sql+=" 0 as vattu,b.id_loai, 0 as giachenhlech ";
								sql+=" from v_giavp b,v_loaivp c where b.id_loai=c.id and b.id="+Convert.ToInt32(block);
								dsv.Merge(get_data(sql));
							}
						}
					}
				}
				else
				{					
					so=Math.Max(1,Math.Floor(StringToDate(DateToString("dd/MM/yyyy",d1)).ToOADate()-StringToDate(DateToString("dd/MM/yyyy",d2)).ToOADate()));
					stien=stien=decimal.Parse(so.ToString())*dongia;
					st+=stien;
					if (dsv!=null)
					{
						sql="select 0 as idttrv,'"+yymmdd+"' as yymmdd, '"+ngayrv.Substring(0,10)+"' as ngay,'"+makp+"' as makp,b.id as mavp,"+dongia+" as dongia,"+so+" as soluong,"+stien+" as sotien, ";
						sql+="0 as bhytt0107,";
						if(bDoituong_BHYT(madoituong.ToString()))
						{
							sql+=""+stien+" as bhyt,";
						}
						else
						{
							sql+=" 0 as bhyt,";
						}	
						sql+=" 0 as vattu,b.id_loai, 0 as giachenhlech ";
						sql+=" from v_giavp b,v_loaivp c where b.id_loai=c.id and b.id="+idgiuong;
						dsv.Merge(get_data(sql));
					}
				}
			}
			catch{}
			//dsv.WriteXml("..\\..\\dataxml\\pg.xml",XmlWriteMode.WriteSchema);
			return st;
		}

		public double songaygiuong(DateTime d1,DateTime d2,int congthem,int idgiuong)
		{
			double ret=0;
			try
			{	
				double so=d1.ToOADate()-d2.ToOADate();
				if (congthem!=0)
				{
					sql="select a.* from dmgiuong a,dmphong b where a.idphong=b.id and b.dichvu=1 and a.id="+idgiuong;
					if (get_data(sql).Tables[0].Rows.Count>0)
					{
						string s=so.ToString();
						int p=s.IndexOf(".");
						if (p!=-1)
						{
							ret=double.Parse(s.Substring(0,p));
							string c="0."+s.Substring(p+1);
							ret+=((double.Parse(c)<0.5)?0.5:1.0);
						}
						else ret=0.5;
					}
					else
					{
						so=StringToDate(DateToString("dd/MM/yyyy",d1)).ToOADate()-StringToDate(DateToString("dd/MM/yyyy",d2)).ToOADate();
						ret=Math.Max(1,Math.Floor(so));//+congthem;
					}
				}
				else
				{
					so=StringToDate(DateToString("dd/MM/yyyy",d1)).ToOADate()-StringToDate(DateToString("dd/MM/yyyy",d2)).ToOADate();
					ret=Math.Floor(so)+congthem;
				}
			}
			catch{ret=0;}
			return ret;
		}

		public double songaygiuong_1(DateTime d1,DateTime d2,int idgiuong)
		{
			double ret=0;
			try
			{	
				double so=d1.ToOADate()-d2.ToOADate();
				sql="select a.* from dmgiuong a,dmphong b where a.idphong=b.id and a.id="+idgiuong;
				if (get_data(sql).Tables[0].Rows.Count>0)
				{
					string s=so.ToString();
					int p=s.IndexOf(".");
					if (p!=-1)
					{
						ret=double.Parse(s.Substring(0,p));
						string c="0."+s.Substring(p+1);
						ret+=((double.Parse(c)<0.5)?0.5:1.0);
					}
					else ret=0.5;
				}
				else
				{
					so=StringToDate(DateToString("dd/MM/yyyy",d1)).ToOADate()-StringToDate(DateToString("dd/MM/yyyy",d2)).ToOADate();
					ret=Math.Max(0.5,Math.Floor(so));//+congthem;
				}
			}
			catch{ret=0;}
			return ret;
		}

		public System.DateTime StringToDate(string s)
		{
			string [] format={"dd/MM/yyyy"};
			return System.DateTime.ParseExact(s.Substring(0,10),format,System.Globalization.DateTimeFormatInfo.CurrentInfo,System.Globalization.DateTimeStyles.None);
		}

		public string StringToMMDDYYYY(string s)
		{
			return s.Substring(3,2)+"/"+s.Substring(0,2)+"/"+s.Substring(6,4);
		}

		public string StringToDDMMYYYY(string s)
		{
			return s.Substring(0,2)+s.Substring(3,2)+s.Substring(6,4);
		}

		public System.DateTime StringToDateTime(string s)
		{
			string [] format1={"dd/MM/yyyy"},format2={"dd/MM/yyyy HH:mm"};
			return System.DateTime.ParseExact(s.ToString(),(s.Length==10)?format1:format2,System.Globalization.DateTimeFormatInfo.CurrentInfo,System.Globalization.DateTimeStyles.None);
		}

		public System.DateTime StringToDateTime(string s,string f)
		{
			string [] format={f};
			return System.DateTime.ParseExact(s.ToString(),format,System.Globalization.DateTimeFormatInfo.CurrentInfo,System.Globalization.DateTimeStyles.None);
		}

		public string DateToString(string format,System.DateTime date)
		{
			if (date.Equals(null)) return "";
			else return  date.ToString(format,System.Globalization.DateTimeFormatInfo.CurrentInfo);
		}

		public bool ngay(DateTime d1,DateTime d2,int so)
		{
			return (Math.Abs(songay(d1,StringToDate(d2.Day.ToString().PadLeft(2,'0')+"/"+d2.Month.ToString().PadLeft(2,'0')+"/"+d2.Year.ToString()),0))<=so);
		}


		public string Ngaysanhdudoan(string ngaykinhcc)
		{
			string yyyy=ngaykinhcc.Substring(6,4),mmyy=ngaykinhcc.Substring(3,2)+ngaykinhcc.Substring(8,2);
			int dd=int.Parse(ngaykinhcc.Substring(0,2));
			for(int i=0;i<3;i++) mmyy=Mmyy_truoc(mmyy);
			string s30="04+06+09+11+";
			int yyyys=int.Parse("20"+mmyy.Substring(2,2))+1;
			if (mmyy.Substring(0,2)=="02" && dd>28)
			{				
				if (yyyys%4==0) dd=Math.Min(dd,29);
				else dd=Math.Min(dd,28);
			}
			else if (s30.IndexOf(mmyy.Substring(0,2)+"+")!=-1) dd=Math.Min(dd,30);
			return DateToString("dd/MM/yyyy",StringToDate(dd.ToString().PadLeft(2,'0')+"/"+mmyy.Substring(0,2)+"/"+Convert.ToString(int.Parse("20"+mmyy.Substring(2,2))+1).PadLeft(4,'0')).AddDays(7));
		}

		public string Mmyy_truoc(string d_mmyy)
		{
			int t_mm,t_yy;
			string mm=d_mmyy.Substring(0,2),yy=d_mmyy.Substring(2,2);
			if (mm=="01")
			{
				t_mm=12;t_yy=int.Parse(yy)-1;
			}
			else
			{
				t_mm=int.Parse(mm)-1;t_yy=int.Parse(yy);
			}
			return t_mm.ToString().PadLeft(2,'0')+t_yy.ToString().PadLeft(2,'0');
		}

		public string Mmyy_sau(string d_mmyy)
		{
			int t_mm,t_yy;
			string mm=d_mmyy.Substring(0,2),yy=d_mmyy.Substring(2,2);
			if (mm=="12")
			{
				t_mm=01;t_yy=int.Parse(yy)+1;
			}
			else
			{
				t_mm=int.Parse(mm)+1;t_yy=int.Parse(yy);
			}
			return t_mm.ToString().PadLeft(2,'0')+t_yy.ToString().PadLeft(2,'0');
		}

		public string getBackup
		{
			get
			{
				XmlDocument doc=new XmlDocument();
				string strpath="..\\..\\..\\xml\\maincode.xml"; 
				doc.Load(strpath);
				XmlNodeList nodeLst=doc.GetElementsByTagName("BK");
				return nodeLst.Item(0).InnerText;			
			}
		}

		public int Ngaylv_Ngayht
		{
			get
			{
				return int.Parse(Thongso("c14"));
			}
		}

		public int iTreem6
		{
			get
			{
				try
				{
					return int.Parse(get_data("select ten from thongso where id=42").Tables[0].Rows[0][0].ToString());
				}
				catch{return 6;}
			}
		}

		public int iTreem15
		{
			get
			{
				try
				{
					return int.Parse(get_data("select ten from thongso where id=43").Tables[0].Rows[0][0].ToString());
				}
				catch{return 15;}
			}
		}

		public bool bSovaovien
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=15");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bAcc_Ora
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=37");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bSoluutru
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=16");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bChandoan
		{
			get
			{
				return int.Parse(Thongso("c17"))==1;
			}
		}

		public bool bPttt
		{
			get
			{
				return int.Parse(Thongso("c18"))==1;
			}
		}

		public bool bNetwork
		{
			get
			{
				DataSet ds=get_data("select ten from thongso where id=19");
				return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
			}
		}

		public string Ngaygio_hienhanh
		{
			get{return DateTime.Now.Day.ToString().PadLeft(2,'0')+"/"+DateTime.Now.Month.ToString().PadLeft(2,'0')+"/"+DateTime.Now.Year.ToString()+" "+DateTime.Now.Hour.ToString().PadLeft(2,'0')+":"+DateTime.Now.Minute.ToString().PadLeft(2,'0');}
		}

		public string Ngaygio
		{
			get
			{
				if (int.Parse(Thongso("c21"))==0) return "";
				else return ngayhienhanh_server;//DateTime.Now.Day.ToString().PadLeft(2,'0')+"/"+DateTime.Now.Month.ToString().PadLeft(2,'0')+"/"+DateTime.Now.Year.ToString()+" "+DateTime.Now.Hour.ToString().PadLeft(2,'0')+":"+DateTime.Now.Minute.ToString().PadLeft(2,'0');
			}
		}

		public bool bSolieu
		{
			get
			{
				return int.Parse(Thongso("c22"))==1;
			}
		}

		public bool bKhambenh
		{
			get
			{
				return int.Parse(Thongso("c23"))==1;
			}
		}

		public bool bNoichuyen
		{
			get
			{
				return int.Parse(Thongso("c25"))==1;
			}
		}

		public bool bsKhambenh
		{
			get
			{
				return int.Parse(Thongso("c26"))==1;
			}
		}

		public bool bsNgoaitru
		{
			get
			{
				return int.Parse(Thongso("c27"))==1;
			}
		}

		public bool bsNhanbenh
		{
			get
			{
				return int.Parse(Thongso("c28"))==1;
			}
		}

		public bool bsNhapkhoa
		{
			get
			{
				return int.Parse(Thongso("c29"))==1;
			}
		}

		public bool bsXuatkhoa
		{
			get
			{
				return int.Parse(Thongso("c30"))==1;
			}
		}

		public bool bsXuatvien
		{
			get
			{
				return int.Parse(Thongso("c31"))==1;
			}
		}

		public bool bsPttt
		{
			get
			{
				return int.Parse(Thongso("c32"))==1;
			}
		}

		public bool bSaoluu
		{
			get
			{
				try
				{
					return int.Parse(Thongso("c33"))==1;
				}
				catch{return false;}
			}
		}

		public bool bListicd
		{
			get
			{
				try
				{
					return int.Parse(Thongso("c34"))==1;
				}
				catch{return false;}
			}
		}

		public bool bListpttt
		{
			get
			{
				try
				{
					return int.Parse(Thongso("c35"))==1;
				}
				catch{return false;}
			}
		}

		public bool bThongtinnhapvien
		{
			get
			{
				try
				{
					return int.Parse(Thongso("c36"))==1;
				}
				catch{return false;}
			}
		}

		public bool bBenhkhac
		{
			get
			{
				try
				{
					return int.Parse(Thongso("c38"))==1;
				}
				catch{return false;}
			}
		}

		public string Giamdoc
		{
			get{return Thongso("c39");}
		}

		public string TpKHTH
		{
			get{return Thongso("c40");}
		}

		public string Thongke
		{
			get{return Thongso("c41");}
		}

		public bool bHoten_gioitinh
		{
			get
			{
				try
				{
					return int.Parse(Thongso("c44"))==1;
				}
				catch{return false;}
			}
		}

		public bool bPreview{get{try{return int.Parse(Thongso("c45"))==1;}  
								 catch{return false;}
							 }
		}
		public bool bIn_khambenh{get{try{return int.Parse(Thongso("c46"))==1;}  
									 catch{return false;}
								 }
		}
		public bool bDanhsach_cho{get{try{return int.Parse(Thongso("c47"))==1;}  
									  catch{return false;}
								  }
		}
		public bool bMavach{get{try{return int.Parse(Thongso("c51"))==1;} 
								catch{return false;}
							}
		}
		public bool bPhieudieutri{get{try{return int.Parse(Thongso("c52"))==1;}  
									  catch{return false;}
								  }
		}
		public bool bSuagiakham{get{try{return int.Parse(Thongso("c53"))==1;} 
									catch{return false;}
								}
		}
		public bool bDausinhton{get{try{return int.Parse(Thongso("c55"))==1;} 
									catch{return false;}
								}
		}
		public int iSudungthuoc{get{try{return int.Parse(Thongso("c56"));} 
									catch{return 3;}
								}
		}
		public int iSokham{get{try{return int.Parse(Thongso("c59"));}  
							   catch{return 3;}
						   }
		}
		public int iChidinh{get{try{return int.Parse(Thongso("c60"));} 
								catch{return 3;}
							}
		}
		public int iVienphi{get{try{return int.Parse(get_data("select ten from thongso where id=113").Tables[0].Rows[0]["ten"].ToString());} 
								catch{return 3;}
							}
		}
		public bool bDangky_mau1{get{try{return int.Parse(Thongso("c195"))==1;}  
									 catch{return false;}
								 }
		}
		public int iUservp{get{try{return int.Parse(Thongso("c196"));}  
							   catch{return 0;}
						   }
		}
		public bool blSovaovien(string m_ngay,int m_loaiba,string m_sovaovien,long m_maql)
		{
			return get_data("select sovaovien from benhandt where maql<>"+m_maql+" and loaiba="+m_loaiba+" and sovaovien='"+m_sovaovien+"' and to_char(ngay,'yyyy')='"+m_ngay.Substring(6,4)+"'").Tables[0].Rows.Count>0;
		}

		public bool blSoluutru(string m_soluutru,long m_maql,string table)
		{
			if (Mabv_so==701424 || Mabv_so==701417) return false;
			else return get_data("select soluutru from "+table+" where maql<>"+m_maql+" and soluutru='"+m_soluutru+"'").Tables[0].Rows.Count>0;
		}

		public bool blSoluutru(string m_soluutru)
		{
			return get_data("select soluutru from xuatvien where soluutru='"+m_soluutru+"'").Tables[0].Rows.Count!=0;
		}

		public bool bRavien(long maql)
		{
			return get_data("select maql from xuatvien where maql="+maql).Tables[0].Rows.Count>0;
		}
		public bool bRavien(long maql,int tinhtrang)
		{
			return get_data("select maql from xuatvien where maql="+maql+" and ttlucrv<>"+tinhtrang).Tables[0].Rows.Count>0;
		}

		public string Matuyen(string mabv)
		{
			try
			{
				return get_data("select matuyen from tenvien where mabv='"+mabv+"'").Tables[0].Rows[0][0].ToString();
			}
			catch{return "";};
		}

		// nam  23/07/2012 kiem tra benh nhan con hien hien hay khong
		public bool bHiendien(long m_maql,string m_makp)
		{
			try
			{
				ds= get_data("select trim(b.tenkp)||' '||to_char(a.ngay,'dd/mm/yyyy hh24:mi') from hiendien a,btdkp_bv b where a.makp=b.makp and a.nhapkhoa=1 and a.xuatkhoa=0 and a.maql="+m_maql+ "and b.makp='"+m_makp+"'");
				if(ds!=null)
				{
					if(ds.Tables[0].Rows.Count >0)
					{
						return true;
					}
					else 
					{
						return false;
					}
				}
				else 
				{
					return true;
				}
				
			
			}
			catch{return false;}
		}

		public bool bHiendien_ngtru(string m_mabn,string m_makp)
		{
			try
			{
				ds= get_data("select trim(b.tenkp)||' '||to_char(a.ngay,'dd/mm/yyyy hh24:mi') from hiendien a,btdkp_bv b where a.makp=b.makp and a.mabn='"+m_mabn+"'and b.makp='"+m_makp+"'");
				if(ds!=null)
				{
					if(ds.Tables[0].Rows.Count >0)
					{
						return true;
					}
					else 
					{
						return false;
					}
				}
				else 
				{
					return true;
				}
				
			
			}
			catch{return false;}
		}
		// nam ngay 30/07/2012
		public void upd_hiendien_ngtru(string m_mabn,string m_makp)
		{
			sql="update hiendien set nhapkhoa=1 where  nhapkhoa=0 and  mabn='"+m_mabn+"' and makp='"+m_makp+"'" ;
			execute_data(sql);
		}
		
		// end nam

		// nam them funtion bhiendien cho phep benh nhan ngoai tru lam 2 benh an dong thoi

		public string bHiendien(string m_mabn,int m_loaiba, string m_makp)
		{
			try
			{
		
				return get_data("select trim(b.tenkp)||' '||to_char(a.ngay,'dd/mm/yyyy hh24:mi') from hiendien a,btdkp_bv b,benhandt c where a.makp=b.makp and a.maql=c.maql and a.nhapkhoa=1 and a.xuatkhoa=0 and a.mabn='"+m_mabn+"' and c.makp='"+m_makp+"'and c.loaiba="+m_loaiba).Tables[0].Rows[0][0].ToString();
			}
			catch{return "";}
		}

		// end nam
		
		public string bHiendien(long m_maql)
		{
			try
			{
				return get_data("select trim(b.tenkp)||' '||to_char(a.ngay,'dd/mm/yyyy hh24:mi') from hiendien a,btdkp_bv b where a.makp=b.makp and a.nhapkhoa=1 and a.xuatkhoa=0 and a.maql="+m_maql).Tables[0].Rows[0][0].ToString();

			}
			catch{return "";}
		}

				
		public string bHiendien(string m_mabn,int m_loaiba)
		{
			try
			{
				return get_data("select trim(b.tenkp)||' '||to_char(a.ngay,'dd/mm/yyyy hh24:mi') from hiendien a,btdkp_bv b,benhandt c where a.makp=b.makp and a.maql=c.maql and a.nhapkhoa=1 and a.xuatkhoa=0 and a.mabn='"+m_mabn+"'"+" and c.loaiba="+m_loaiba).Tables[0].Rows[0][0].ToString();
			}
			catch{return "";}
		}

		public string bNhapvien(string m_mabn,long m_maql,int loaiba)
		{
			try
			{
				return get_data("select trim(b.tenkp)||' '||to_char(a.ngay,'dd/mm/yyyy hh24:mi') from benhandt a,btdkp_bv b where a.makp=b.makp and a.maql not in (select maql from xuatvien) and a.mabn='"+m_mabn+"'"+" and a.loaiba="+loaiba+" and maql<>"+m_maql).Tables[0].Rows[0][0].ToString();
			}
			catch{return "";}
		}
		//  nam start function benh an ngoai tru cho phep nhieu hon 1 benh an hien dien
		public string bNhapvien(string m_mabn,long m_maql,int loaiba, string m_makp)
		{
			try
			{
				return get_data("select trim(b.tenkp)||' '||to_char(a.ngay,'dd/mm/yyyy hh24:mi') from benhandt a,btdkp_bv b where a.makp=b.makp and a.maql not in (select maql from xuatvien) and a.mabn='"+m_mabn+"'"+" and a.loaiba="+loaiba+" and  a.makp='"+m_makp+"' and maql<>"+m_maql).Tables[0].Rows[0][0].ToString();
			}
			catch{return "";}
		}

		// end nam 


		public long get_maql(string mabn,string ngay,int loaiba)
		{
			sql="select maql from benhandt where mabn='"+mabn+"' and to_char(ngay,'dd/mm/yyyy hh24:mi')='"+ngay+"' and loaiba="+loaiba;
			ds=get_data(sql);
			if (ds.Tables[0].Rows.Count>0) return long.Parse(ds.Tables[0].Rows[0]["maql"].ToString());
			else return 0;
		}

		public string get_khambhyt(string mabn,string ngay,long maql)
		{
			string s="";
			if (bMmyy(mmyy(ngay)))
			{
				sql="select b.tenkp,to_char(a.ngay,'dd/mm/yyyy hh24:mi') as ngay ";
				sql+=" from "+user+mmyy(ngay)+".tiepdon a,btdkp_bv b where a.makp=b.makp and a.mabn='"+mabn+"' and to_char(a.ngay,'dd/mm/yyyy')='"+ngay.Substring(0,10)+"'";
				sql+=" and a.maql<>"+maql+" and a.madoituong in("+sMaDoituong_BHYT().Trim().Trim(',')+") and a.noitiepdon in (0,1,5,16)";///sql+=" and a.maql<>"+maql+" and a.madoituong=1 and a.noitiepdon in (0,1,5,16)";
				foreach(DataRow r in get_data(sql).Tables[0].Rows)
				{
					s="Người bệnh BHYT ngày "+r["ngay"].ToString()+" đã khám tại "+r["tenkp"].ToString();
					break;
				}
			}
			return s;
		}

		public bool bKhaibaobandau
		{
			get 
			{
				try
				{
					return get_data("select * from dmcomputer").Tables[0].Rows.Count!=0;
				}
				catch{return false;}
			}
		}

		public string Maqu
		{
			get
			{
				DataSet ds=get_data("select ten from thongso where id=24");
				return ds.Tables[0].Rows[0][0].ToString().Trim();
			}
		}

		public DataSet Tqx(string s)
		{
			return get_data("select a.tentt||' - '||b.tenquan||' - '||c.tenpxa as TEN,c.MAPHUONGXA,c.VIETTAT from btdtt a,btdquan b,btdpxa c where a.matt=b.matt and b.maqu=c.maqu and upper(c.viettat) like '"+s.Trim().ToUpper()+"%'"+" order by c.maphuongxa");
		}

		public string get_vviet(string maicd)
		{
			if (maicd=="") return "";
			try
			{
				return get_data("select vviet from icd10 where hide=0 and trim(cicd10)='"+maicd.Trim()+"'").Tables[0].Rows[0][0].ToString();
			}
			catch{return "";}
		}

		public string get_tenpt(string mapt)
		{
			if (mapt=="") return "";
			try
			{
				DataTable dt=get_data("select loaipt,noi_dung from dmpttt where trim(mapt)='"+mapt.Trim()+"'").Tables[0];
				return dt.Rows[0][0].ToString().Trim()+dt.Rows[0][1].ToString();
			}
			catch{return "";}
		}

		public void import_xml_to_oracle(string filexml)
		{
			try
			{
				con=new OracleConnection(sConn);
				con.Open();				
				DataSet lds=new DataSet();
				string strpath="..\\..\\..\\temp\\"+filexml+".xml";
				lds.ReadXml(strpath);			
				string strfields="",strpara="";			
				foreach(DataColumn icol in lds.Tables[0].Columns)
				{
					strfields=((strfields=="")?"":strfields+",")+icol.ColumnName;
					strpara=((strpara=="")?":":strpara+",:")+icol.ColumnName;
				}
				foreach(DataRow r in lds.Tables[0].Rows)
				{
					string strsql="Insert Into "+filexml+" ("+ strfields+")" +" values ("+strpara+")";
					cmd=new OracleCommand(strsql,con);
					cmd.CommandType=CommandType.Text;
					int i=0;
					foreach(DataColumn icol in lds.Tables[0].Columns)
					{	
						if (icol.DataType==typeof(string))
							cmd.Parameters.Add(icol.ColumnName,OracleType.NVarChar);
						else 
							cmd.Parameters.Add(icol.ColumnName,OracleType.Number);
						cmd.Parameters[icol.ColumnName].Value=(r[i].ToString()=="")?" ":r[i].ToString().Trim();
						i+=1;
					}
					cmd.ExecuteNonQuery();
					cmd.Dispose();
				}									
				con.Close();con.Dispose();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message.ToString().Trim(),sComputer,filexml);
			}
		}

		public void upd_data(string  m_tblname, int m_code, string m_loai)
		{
			try
			{
				string sql="Update "+m_tblname+" set loai=:loai where code=:code";
				con=new OracleConnection(sConn);
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				int irow=cmd.ExecuteNonQuery();
				cmd.Cancel();
				cmd.Dispose();
				if(irow>0)
				{
					sql="Insert Into "+m_tblname+" (code, loai) values(:code, :loai)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;

					cmd.Parameters.Add("code",m_code);
					cmd.Parameters.Add("loai",m_loai);

					cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
				con.Close();con.Dispose();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim(),sComputer,m_tblname);
			}
		}


		public void upd_data(string  m_tblname, string m_code, string m_loai)
		{
			try
			{
				string sql="Update "+m_tblname+" set loai=:loai where code=:code";
				con=new OracleConnection(sConn);
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				int irow=cmd.ExecuteNonQuery();
				cmd.Cancel();
				cmd.Dispose();
				if(irow>0)
				{
					sql="Insert Into "+m_tblname+" (code, loai) values(:code, :loai)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;

					cmd.Parameters.Add("code",m_code);
					cmd.Parameters.Add("loai",m_loai);

					cmd.ExecuteNonQuery();
					cmd.Cancel();
					cmd.Dispose();
				}
				con.Close();con.Dispose();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim(),sComputer,m_tblname);
			}
		}

		/*
		public DataSet get_data_v(string mmyy,string sql)
		{		
			try
			{
				if (ds!=null)
				{
					ds.Dispose();
					ds=null;
				}
				ds=new DataSet();
				con=new OracleConnection(get_conn_v(mmyy));
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				dest=new OracleDataAdapter(cmd);				
				dest.Fill(ds);	
				cmd.Dispose();				
				con.Close();con.Dispose();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim(),sComputer,"?");
			}
			return ds;
		}
		public DataSet get_data_d(string mmyy,string sql)
		{		
			try
			{
				if (ds!=null)
				{
					ds.Dispose();
					ds=null;
				}
				ds=new DataSet();
				con=new OracleConnection(get_conn_d(mmyy));
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				dest=new OracleDataAdapter(cmd);				
				dest.Fill(ds);	
				cmd.Dispose();				
				con.Close();con.Dispose();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim(),sComputer,"?");
			}
			return ds;
		}
		*/
		public DataSet get_data(string asql)
		{		
			DataSet ds1=new DataSet();
			try
			{
				//				if (ds1!=null)
				//				{
				//					ds1.Dispose();
				//					ds1=null;
				//				}
				if (con != null)
				{
					con.Close(); con.Dispose();
				}
				ds1=new DataSet();
				con=new OracleConnection(sConn);
				con.Open();
				cmd=new OracleCommand(asql,con);
				cmd.CommandType=CommandType.Text;
				dest=new OracleDataAdapter(cmd);				
				dest.Fill(ds1);	
				cmd.Dispose();				
				con.Close();con.Dispose();
				if(ds1.Tables.Count==0){ds1=null;}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim()+" - asql: "+asql,sComputer,"?");		
				ds1=null;
			}
			return ds1;
		}

		/*
		public DataSet get_data(string mmyy,string sql)
		{		
			try
			{
				if (ds!=null)
				{
					ds.Dispose();
					ds=null;
				}
				if (con != null)
				{
					con.Close(); con.Dispose();
				}
				ds=new DataSet();
				con=new OracleConnection(get_conn_v(mmyy));
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				dest=new OracleDataAdapter(cmd);				
				dest.Fill(ds);	
				cmd.Dispose();				
				con.Close();con.Dispose();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim(),sComputer,"?");
			}
			return ds;
		}
		
		public bool execute_data_d(string mmyy,string  sql)
		{
			try
			{
				con=new OracleConnection(get_conn_d(mmyy));
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.ExecuteNonQuery();
				cmd.Dispose();
				con.Close();con.Dispose();
				return true;
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim(),sComputer,"?");
				return false;
			}
		}
		*/
		public int iNgaykiemke
		{
			get
			{
				int i_Ngaykiemke=0;
				ds=get_data("select distinct ten from d_thongso where id=105 and ten is not null ");
				try
				{
					foreach (DataRow r in ds.Tables[0].Rows)
					{
						if (r["ten"].ToString() == "") i_Ngaykiemke = 22;
						else
						{
							if (i_Ngaykiemke < int.Parse(r["ten"].ToString()))
								i_Ngaykiemke = int.Parse(r["ten"].ToString());
						}
					}
				}
				catch { }
				if (i_Ngaykiemke == 0) i_Ngaykiemke = 22;
				return i_Ngaykiemke;
				//				ds=get_data("select ten from d_thongso where id=105");
				//				if (ds.Tables[0].Rows.Count>0) return int.Parse(ds.Tables[0].Rows[0]["ten"].ToString());
				//				else return 7;
			}
		}
		public void execute_data_mmyy(string str, string tu, string den, bool khoangcach, bool bluuError)
		{
			
			DateTime dt1 = (khoangcach) ? StringToDate(tu).AddDays(-iNgaykiemke) : StringToDate(tu);
			DateTime dt2 = (khoangcach) ? StringToDate(den).AddDays(iNgaykiemke) : StringToDate(den);
			int y1 = dt1.Year, m1 = dt1.Month;
			int y2 = dt2.Year, m2 = dt2.Month;
			int itu, iden;
			string mmyy = "";
			for (int i = y1; i <= y2; i++)
			{
				itu = (i == y1) ? m1 : 1;
				iden = (i == y2) ? m2 : 12;
				for (int j = itu; j <= iden; j++)
				{
					mmyy = j.ToString().PadLeft(2, '0') + i.ToString().Substring(2, 2);
					if (bMmyy(mmyy))
					{
						sql = str.Replace("xxx", user + mmyy);
						execute_data(sql,bluuError);
					}
				}
			}
		}

		public void execute_data_mmyy(string str, string tu, string den, bool khoangcach)
		{
			
			DateTime dt1 = (khoangcach) ? StringToDate(tu).AddDays(-iNgaykiemke) : StringToDate(tu);
			DateTime dt2 = (khoangcach) ? StringToDate(den).AddDays(iNgaykiemke) : StringToDate(den);
			int y1 = dt1.Year, m1 = dt1.Month;
			int y2 = dt2.Year, m2 = dt2.Month;
			int itu, iden;
			string mmyy = "";
			for (int i = y1; i <= y2; i++)
			{
				itu = (i == y1) ? m1 : 1;
				iden = (i == y2) ? m2 : 12;
				for (int j = itu; j <= iden; j++)
				{
					mmyy = j.ToString().PadLeft(2, '0') + i.ToString().Substring(2, 2);
					if (bMmyy(mmyy))
					{
						sql = str.Replace("xxx", user + mmyy);
						execute_data(sql);
					}
				}
			}
		}

		public void execute_data_mmyy(string str, string tu, string den, int songay)
		{
			DateTime dt1 = (songay!=0) ? StringToDate(tu).AddDays(-songay) : StringToDate(tu);
			DateTime dt2 = (songay!=0) ? StringToDate(den).AddDays(songay) : StringToDate(den);
			int y1 = dt1.Year, m1 = dt1.Month;
			int y2 = dt2.Year, m2 = dt2.Month;
			int itu, iden;
			string mmyy = "";
			for (int i = y1; i <= y2; i++)
			{
				itu = (i == y1) ? m1 : 1;
				iden = (i == y2) ? m2 : 12;
				for (int j = itu; j <= iden; j++)
				{
					mmyy = j.ToString().PadLeft(2, '0') + i.ToString().Substring(2, 2);
					if (bMmyy(mmyy))
					{
						sql = str.Replace("xxx", user + mmyy);
						execute_data(sql);
					}
				}
			}
		}

		/*
		public bool execute_data_v(string mmyy,string  sql)
		{
			try
			{
				con=new OracleConnection(get_conn_v(mmyy));
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.ExecuteNonQuery();
				cmd.Dispose();
				con.Close();con.Dispose();
				return true;
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim(),sComputer,"?");
				return false;
			}
		}
		*/

		public bool execute_data(string connect,string  sql)
		{
			try
			{
				con=new OracleConnection(connect);
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.ExecuteNonQuery();
				cmd.Dispose();
				con.Close();con.Dispose();
				return true;
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim()+"-SQL:"+sql,sComputer,"?");
				return false;
			}
		}

		public bool execute_data(string connect,string  sql, bool bLuuError)
		{
			try
			{
				con=new OracleConnection(connect);
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.ExecuteNonQuery();
				cmd.Dispose();
				con.Close();con.Dispose();
				return true;
			}
			catch(OracleException ex)
			{
				if(bLuuError)upd_error(ex.Message.ToString().Trim()+"-SQL:"+sql,sComputer,"?");
				return false;
			}
		}

		public bool execute_data(string  sql)
		{
			try
			{
				con=new OracleConnection(sConn);
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.ExecuteNonQuery();
				cmd.Dispose();
				con.Close();con.Dispose();
				return true;
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim()+"-SQL: "+sql,sComputer,"?");
				return false;
			}
		}

		public bool execute_data(string  sql, bool bLuuEror)
		{
			try
			{
				con=new OracleConnection(sConn);
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.ExecuteNonQuery();
				cmd.Dispose();
				con.Close();con.Dispose();
				return true;
			}
			catch(OracleException ex)
			{
				if(bLuuEror)upd_error(ex.Message.ToString().Trim()+"-SQL: "+sql,sComputer,"?");
				return false;
			}
		}


		public bool execute_data_upd_ins(string upd,string ins)
		{
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(upd,con);
				cmd.CommandType=CommandType.Text;			
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					cmd=new OracleCommand(ins,con);
					cmd.CommandType=CommandType.Text;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"?");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public void delrec(DataTable dt,string exp)
		{
			try
			{
				DataRow[] r = dt.Select(exp);
				for(int i=0;i<r.Length;i++)	r[i].Delete();
			}
			catch{}
		}

		public DataRow getrowbyid (DataTable dt,string exp ) 
		{
			try
			{
				DataRow[] r = dt.Select ( exp ) ;
				return r[0] ;
			}
			catch{return null ;}
		}
		public DataRow getrowbyid (DataTable dt,string exp , string sort) 
		{
			try
			{
				DataRow[] r = dt.Select ( exp ,sort) ;
				return r[0] ;
			}
			catch{return null ;}
		}
		public void upd_error(string m_message,string m_computer,string m_table)
		{
			con.Close();con.Dispose();
			string sql1="insert into error(message,computer,tables,ngayud) values (:m_message,:m_computer,:m_table,sysdate)";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql1,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_message",OracleType.VarChar).Value=m_message;
				cmd.Parameters.Add("m_computer",OracleType.VarChar,20).Value=m_computer;
				cmd.Parameters.Add("m_table",OracleType.VarChar,20).Value=m_table;
				cmd.ExecuteNonQuery();
				cmd.Dispose();
			}
			catch{}
			finally
			{
				con.Close();con.Dispose();
			}
		}

		public void upd_thongso(int id,string fie,string ten)
		{
			sql="update thongso set "+fie+"=:ten ";
			if (fie=="tendef") sql+=",ngayud=sysdate";
			sql+=" where id=:id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("ten",OracleType.NVarChar,254).Value=ten;
				cmd.Parameters.Add("id",OracleType.Number).Value=id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into thongso(id,ten) values (:id,:ten)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("id",OracleType.Number).Value=id;
					cmd.Parameters.Add("ten",OracleType.NVarChar,254).Value=ten;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim(),sComputer,"Thongso");
			}
			finally
			{
				con.Close();con.Dispose();
			}		
		}

		public void upd_thongso(int id,string ten,string tendef,string tencur)
		{
			sql="update thongso set ten=:ten,tendef=:tendef,tencur=:tencur ";
			sql+=" where id=:id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("ten",OracleType.NVarChar,254).Value=ten;
				cmd.Parameters.Add("tendef",OracleType.NVarChar,254).Value=tendef;
				cmd.Parameters.Add("tencur",OracleType.NVarChar,254).Value=tencur;
				cmd.Parameters.Add("id",OracleType.Number).Value=id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into thongso(id,ten,tendef,tencur) values (:id,:ten,:tendef,:tencur)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("id",OracleType.Number).Value=id;
					cmd.Parameters.Add("ten",OracleType.NVarChar,254).Value=ten;
					cmd.Parameters.Add("tendef",OracleType.NVarChar,254).Value=tendef;
					cmd.Parameters.Add("tencur",OracleType.NVarChar,254).Value=tencur;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim(),sComputer,"Thongso");
			}
			finally
			{
				con.Close();con.Dispose();
			}		
		}

		public void upd_capmabn(int m_yy,int m_loai,int m_userid,int m_stt)
		{
			sql="update capmabn set stt=:m_stt where yy=:m_yy and loai=:m_loai and userid=:m_userid";
			con=new OracleConnection(sConn);
			con.Open();
			cmd=new OracleCommand(sql,con);
			cmd.CommandType=CommandType.Text;
			cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
			cmd.Parameters.Add("m_yy",OracleType.Number).Value=m_yy;
			cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
			cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
			int irec=cmd.ExecuteNonQuery();
			cmd.Dispose();
			if (irec==0)
			{
				sql="insert into capmabn(yy,stt,loai,userid) values (:m_yy,:m_stt,:m_loai,:m_userid)";
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_yy",OracleType.Number).Value=m_yy;
				cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
				cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.ExecuteNonQuery();
				cmd.Dispose();
			}
			con.Close();con.Dispose();
		}

		public long get_mabn(int yy,int loai,int userid,bool update)
		{
			int ma=0;
			ds=get_data("select stt from capmabn where yy="+yy+" and loai="+loai+" and userid="+userid);
			if (ds.Tables[0].Rows.Count>0) ma=int.Parse(ds.Tables[0].Rows[0]["stt"].ToString());
			ma+=1;
			if (update) upd_capmabn(yy,loai,userid,ma);
			return ma;
		}

		public long get_mabns(int yy,int loai,int userid)
		{
			int ma=0;
			ds=get_data("select stt from capmabns where yy="+yy+" and loai="+loai+" and userid="+userid+" and computer="+iRownum+" order by stt");
			if (ds.Tables[0].Rows.Count>0) ma=int.Parse(ds.Tables[0].Rows[0]["stt"].ToString());
			return ma;
		}

		public void upd_mabns(int m_yy,int m_loai,int m_userid,long m_stt)
		{
			sql="update capmabns set computer="+iRownum+" where yy=:m_yy and loai=:m_loai and userid=:m_userid and stt=:m_stt";
			con=new OracleConnection(sConn);
			con.Open();
			cmd=new OracleCommand(sql,con);
			cmd.CommandType=CommandType.Text;
			cmd.Parameters.Add("m_yy",OracleType.Number).Value=m_yy;
			cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
			cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
			cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
			int irec=cmd.ExecuteNonQuery();
			cmd.Dispose();
			if (irec==0)
			{
				sql="insert into capmabns(yy,stt,loai,userid,computer) values (:m_yy,:m_stt,:m_loai,:m_userid,"+iRownum+")";
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_yy",OracleType.Number).Value=m_yy;
				cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
				cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.ExecuteNonQuery();
				cmd.Dispose();
			}
			con.Close();con.Dispose();
		}
		public void del_mabns(int yy,int loai,int userid,long stt)
		{
			execute_data("delete from capmabns where yy="+yy+" and loai="+loai+" and userid="+userid+" and stt="+stt);
		}

		public long get_capid(int m_ma,string m_yy)
		{
			sql="update capid set id=id+1 where ma=:m_ma and yy=:m_yy";
			con=new OracleConnection(sConn);
			con.Open();
			cmd=new OracleCommand(sql,con);
			cmd.CommandType=CommandType.Text;
			cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
			cmd.Parameters.Add("m_yy",OracleType.VarChar).Value=m_yy;
			int irec=cmd.ExecuteNonQuery();
			cmd.Dispose();
			if (irec==0)
			{
				sql="insert into capid(ma,yy,loai,id) values (:m_ma,:m_yy,'?',1)";
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				cmd.Parameters.Add("m_yy",OracleType.VarChar).Value=m_yy;
				cmd.ExecuteNonQuery();
				cmd.Dispose();
			}
			con.Close();con.Dispose();
			return long.Parse(get_data("select id from capid where yy='"+m_yy+"'"+" and ma="+m_ma).Tables[0].Rows[0][0].ToString());
		}

		public long get_capid(int m_ma)
		{
			sql="update capid set id=id+1 where ma=:m_ma";
			con=new OracleConnection(sConn);
			con.Open();
			cmd=new OracleCommand(sql,con);
			cmd.CommandType=CommandType.Text;
			cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
			int irec=cmd.ExecuteNonQuery();
			cmd.Dispose();
			if (irec==0)
			{
				sql="insert into capid(ma,yy,loai,id) values (:m_ma,'??',:m_loai,1)";
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				cmd.Parameters.Add("m_loai",OracleType.VarChar,20).Value=sComputer;
				cmd.ExecuteNonQuery();
				cmd.Dispose();
			}
			sql="select id from capid where ma="+m_ma;
			cmd=new OracleCommand(sql,con);
			cmd.CommandType=CommandType.Text;
			dest=new OracleDataAdapter(cmd);
			ds=new DataSet();
			dest.Fill(ds);	
			cmd.Dispose();				
			con.Close();con.Dispose();
			return long.Parse(ds.Tables[0].Rows[0][0].ToString());
		}
		public bool upd_ttbenhnhiem(long m_id,string m_mabn,long m_maql,long m_mavaovien,string m_ngayvaovien,string m_ngaykhoiphat,string m_trieuchung,string m_chandoan,string m_maicd,string m_xetnghiem,string m_tinhtrang,string m_ghichu,int m_userid)
		{
			sql="update ttbenhnhiem set mabn=:m_mabn,mavaovien=:m_mavaovien,ngayvaovien=:m_ngayvaovien,";
			sql+="ngaykhoiphat=:m_ngaykhoiphat,trieuchung=:m_trieuchung,chandoan=:m_chandoan,";
			sql+="maicd=:m_maicd,xetnghiem=:m_xetnghiem,tinhtrang=:m_tinhtrang,ghichu=:m_ghichu";
			//sql+=",userid=:m_userid ";
			sql+=" where id=:m_id and maql=:m_maql";
			OracleConnection oracon=new OracleConnection(sConn);
			try
			{
				oracon.Open();
				cmd=new OracleCommand(sql,oracon);
				cmd.CommandType=CommandType.Text;
			
				cmd.Parameters.Add("m_mabn",OracleType.VarChar).Value=m_mabn;
				cmd.Parameters.Add("m_mavaovien",OracleType.Number).Value=m_mavaovien;
				cmd.Parameters.Add("m_ngayvaovien",OracleType.DateTime).Value=StringToDateTime(m_ngayvaovien);
				cmd.Parameters.Add("m_ngaykhoiphat",OracleType.DateTime).Value=StringToDateTime(m_ngaykhoiphat);
				cmd.Parameters.Add("m_trieuchung",OracleType.NVarChar,254).Value=m_trieuchung;
				cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,254).Value=m_chandoan;
				cmd.Parameters.Add("m_maicd",OracleType.VarChar,10).Value=m_maicd;
				cmd.Parameters.Add("m_xetnghiem",OracleType.NVarChar,254).Value=m_xetnghiem;
				cmd.Parameters.Add("m_tinhtrang",OracleType.NVarChar,254).Value=m_tinhtrang;
				cmd.Parameters.Add("m_ghichu",OracleType.NVarChar,254).Value=m_ghichu;
				//cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into ttbenhnhiem(id,mabn,maql,mavaovien,ngayvaovien,ngaykhoiphat,trieuchung,chandoan,maicd,xetnghiem,tinhtrang,ghichu,userid,ngayud)";
					sql+=" values (:m_id,:m_mabn,:m_maql,:m_mavaovien,:m_ngayvaovien,:m_ngaykhoiphat,:m_trieuchung,:m_chandoan,:m_maicd,:m_xetnghiem,:m_tinhtrang,:m_ghichu,:m_userid,sysdate)";
					cmd=new OracleCommand(sql,oracon);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar).Value=m_mabn;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_mavaovien",OracleType.Number).Value=m_mavaovien;
					cmd.Parameters.Add("m_ngayvaovien",OracleType.DateTime).Value=StringToDateTime(m_ngayvaovien);
					cmd.Parameters.Add("m_ngaykhoiphat",OracleType.DateTime).Value=StringToDateTime(m_ngaykhoiphat);
					cmd.Parameters.Add("m_trieuchung",OracleType.NVarChar,254).Value=m_trieuchung;
					cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,254).Value=m_chandoan;
					cmd.Parameters.Add("m_maicd",OracleType.VarChar,10).Value=m_maicd;
					cmd.Parameters.Add("m_xetnghiem",OracleType.NVarChar,254).Value=m_xetnghiem;
					cmd.Parameters.Add("m_tinhtrang",OracleType.NVarChar,254).Value=m_tinhtrang;
					cmd.Parameters.Add("m_ghichu",OracleType.NVarChar,254).Value=m_ghichu;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ttbenhnhiem");
				return false;
			}
			finally
			{
				oracon.Close();oracon.Dispose();
			}		
			return true;
		}
		//end Thuy 13.02.2012
		public int get_dmcomputer()
		{
			sql="update dmcomputer set computer=:m_computer where computer=:m_computer";
			con=new OracleConnection(sConn);
			con.Open();
			cmd=new OracleCommand(sql,con);
			cmd.CommandType=CommandType.Text;
			cmd.Parameters.Add("m_computer",OracleType.VarChar,20).Value=sComputer;
			int irec=cmd.ExecuteNonQuery();
			cmd.Dispose();
			if (irec==0)
			{
				sql="insert into dmcomputer(id,computer,ngayud) values (1,:m_computer,sysdate)";
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_computer",OracleType.VarChar,20).Value=sComputer;
				cmd.ExecuteNonQuery();
				cmd.Dispose();
			}
			con.Close();con.Dispose();
			try
			{
				return int.Parse(get_data("select id from dmcomputer where computer='"+sComputer+"'").Tables[0].Rows[0][0].ToString());
			}
			catch{return 0;}
		}

		public int get_dmcomputer(string m_computer)
		{
			sql="update dmcomputer set computer=:m_computer where computer=:m_computer";
			con=new OracleConnection(sConn);
			con.Open();
			cmd=new OracleCommand(sql,con);
			cmd.CommandType=CommandType.Text;
			cmd.Parameters.Add("m_computer",OracleType.VarChar,20).Value=m_computer;
			int irec=cmd.ExecuteNonQuery();
			cmd.Dispose();
			if (irec==0)
			{
				sql="insert into dmcomputer(computer) values (:m_computer)";
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_computer",OracleType.VarChar,20).Value=m_computer;
				cmd.ExecuteNonQuery();
				cmd.Dispose();
			}
			con.Close();con.Dispose();
			return int.Parse(get_data("select id from dmcomputer where computer='"+m_computer+"'").Tables[0].Rows[0][0].ToString());
		}

		public bool upd_btdbn(string m_mabn,byte[] m_image)
		{
			if(m_image==null) return true;
			sql="update btdbn set image=:m_image where mabn=:m_mabn";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_image",OracleType.Blob,m_image.Length).Value=m_image;
				cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
				cmd.ExecuteNonQuery();
				cmd.Dispose();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"btdbn");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_btdbn(string m_mabn,string m_hoten,string m_ngaysinh,string m_namsinh,
			int m_phai,string m_mann,string m_madantoc,string m_sonha,string m_thon,
			string m_cholam,string m_matt,string m_maqu,string m_maphuongxa,int m_userid)
		{
			if (m_mabn.Trim().Length!=8) return false;
			m_hotenkdau=Hoten_khongdau(m_hoten);
			sql="update btdbn set hoten=:m_hoten,";
			if (m_ngaysinh!="") sql+="ngaysinh=:m_ngaysinh,";
			else sql+="ngaysinh=null,";
			sql+="namsinh=:m_namsinh,phai=:m_phai,mann=:m_mann,madantoc=:m_madantoc,";
			sql+="sonha=:m_sonha,thon=:m_thon,cholam=:m_cholam,matt=:m_matt,maqu=:m_maqu,";
			sql+="maphuongxa=:m_maphuongxa,userid=:m_userid,hotenkdau=:m_hotenkdau where mabn=:m_mabn";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_hoten",OracleType.NVarChar,70).Value=m_hoten;
				if (m_ngaysinh!="") cmd.Parameters.Add("m_ngaysinh",OracleType.DateTime).Value=StringToDateTime(m_ngaysinh);
				cmd.Parameters.Add("m_namsinh",OracleType.VarChar,4).Value=m_namsinh;
				cmd.Parameters.Add("m_phai",OracleType.Number).Value=m_phai;
				cmd.Parameters.Add("m_mann",OracleType.VarChar,2).Value=m_mann;
				cmd.Parameters.Add("m_madantoc",OracleType.VarChar,2).Value=m_madantoc;
				cmd.Parameters.Add("m_sonha",OracleType.NVarChar,10).Value=m_sonha;
				cmd.Parameters.Add("m_thon",OracleType.NVarChar,150).Value=m_thon;
				cmd.Parameters.Add("m_cholam",OracleType.NVarChar,150).Value=m_cholam;
				cmd.Parameters.Add("m_matt",OracleType.VarChar,3).Value=m_matt;
				cmd.Parameters.Add("m_maqu",OracleType.VarChar,5).Value=m_maqu;
				cmd.Parameters.Add("m_maphuongxa",OracleType.VarChar,7).Value=m_maphuongxa;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_hotenkdau",OracleType.NVarChar,70).Value=m_hotenkdau;
				cmd.Parameters.Add("m_mabn",OracleType.VarChar).Value=m_mabn;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					if (m_ngaysinh!="")
					{
						sql="insert into btdbn (mabn,hoten,ngaysinh,namsinh,phai,mann,madantoc,sonha,thon,cholam,matt,maqu,maphuongxa,userid,hotenkdau,ngayud)";
						sql+=" values (:m_mabn,:m_hoten,:m_ngaysinh,:m_namsinh,:m_phai,:m_mann,:m_madantoc,:m_sonha,:m_thon,:m_cholam,:m_matt,:m_maqu,:m_maphuongxa,:m_userid,:m_hotenkdau,sysdate)";
					}
					else
					{
						sql="insert into btdbn (mabn,hoten,namsinh,phai,mann,madantoc,sonha,thon,cholam,matt,maqu,maphuongxa,userid,hotenkdau,ngayud)";
						sql+=" values (:m_mabn,:m_hoten,:m_namsinh,:m_phai,:m_mann,:m_madantoc,:m_sonha,:m_thon,:m_cholam,:m_matt,:m_maqu,:m_maphuongxa,:m_userid,:m_hotenkdau,sysdate)";
					}
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar).Value=m_mabn;
					cmd.Parameters.Add("m_hoten",OracleType.NVarChar,70).Value=m_hoten;
					if (m_ngaysinh!="") cmd.Parameters.Add("m_ngaysinh",OracleType.DateTime).Value=StringToDateTime(m_ngaysinh);
					cmd.Parameters.Add("m_namsinh",OracleType.VarChar,4).Value=m_namsinh;
					cmd.Parameters.Add("m_phai",OracleType.Number).Value=m_phai;
					cmd.Parameters.Add("m_mann",OracleType.VarChar,2).Value=m_mann;
					cmd.Parameters.Add("m_madantoc",OracleType.VarChar,2).Value=m_madantoc;
					cmd.Parameters.Add("m_sonha",OracleType.NVarChar,10).Value=m_sonha;
					cmd.Parameters.Add("m_thon",OracleType.NVarChar,150).Value=m_thon;
					cmd.Parameters.Add("m_cholam",OracleType.NVarChar,150).Value=m_cholam;
					cmd.Parameters.Add("m_matt",OracleType.VarChar,3).Value=m_matt;
					cmd.Parameters.Add("m_maqu",OracleType.VarChar,5).Value=m_maqu;
					cmd.Parameters.Add("m_maphuongxa",OracleType.VarChar,7).Value=m_maphuongxa;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					cmd.Parameters.Add("m_hotenkdau",OracleType.NVarChar,70).Value=m_hotenkdau;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
					if (bVantay && bVantay_mabntudong) if (get_mabn(int.Parse(m_mabn.Substring(0,2)),0,0,true)<int.Parse(m_mabn.Substring(2))) upd_capmabn(int.Parse(m_mabn.Substring(0,2)),0,0,int.Parse(m_mabn.Substring(2)));
				}
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"Btdbn "+m_mabn);
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_btdbn(string m_mabn,string m_hoten,string m_ngaysinh,string m_namsinh,
			int m_phai,string m_mann,string m_madantoc,string m_sonha,string m_thon,
			string m_cholam,string m_matt,string m_maqu,string m_maphuongxa,int m_userid,string m_nam)
		{
			m_hotenkdau=Hoten_khongdau(m_hoten);
			sql="update btdbn set hoten=:m_hoten,";
			if (m_ngaysinh!="") sql+="ngaysinh=:m_ngaysinh,";
			else sql+="ngaysinh=null,";
			sql+="namsinh=:m_namsinh,phai=:m_phai,mann=:m_mann,madantoc=:m_madantoc,";
			sql+="sonha=:m_sonha,thon=:m_thon,cholam=:m_cholam,matt=:m_matt,maqu=:m_maqu,";
			sql+="maphuongxa=:m_maphuongxa,userid=:m_userid,hotenkdau=:m_hotenkdau,nam=:m_nam where mabn=:m_mabn";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_hoten",OracleType.NVarChar,70).Value=m_hoten;
				if (m_ngaysinh!="") cmd.Parameters.Add("m_ngaysinh",OracleType.DateTime).Value=StringToDateTime(m_ngaysinh);
				cmd.Parameters.Add("m_namsinh",OracleType.VarChar,4).Value=m_namsinh;
				cmd.Parameters.Add("m_phai",OracleType.Number).Value=m_phai;
				cmd.Parameters.Add("m_mann",OracleType.VarChar,2).Value=m_mann;
				cmd.Parameters.Add("m_madantoc",OracleType.VarChar,2).Value=m_madantoc;
				cmd.Parameters.Add("m_sonha",OracleType.NVarChar,10).Value=m_sonha;
				cmd.Parameters.Add("m_thon",OracleType.NVarChar,150).Value=m_thon;
				cmd.Parameters.Add("m_cholam",OracleType.NVarChar,150).Value=m_cholam;
				cmd.Parameters.Add("m_matt",OracleType.VarChar,3).Value=m_matt;
				cmd.Parameters.Add("m_maqu",OracleType.VarChar,5).Value=m_maqu;
				cmd.Parameters.Add("m_maphuongxa",OracleType.VarChar,7).Value=m_maphuongxa;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_hotenkdau",OracleType.NVarChar,70).Value=m_hotenkdau;
				cmd.Parameters.Add("m_nam",OracleType.VarChar,500).Value=m_nam;
				cmd.Parameters.Add("m_mabn",OracleType.VarChar).Value=m_mabn;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					if (m_ngaysinh!="")
					{
						sql="insert into btdbn (mabn,hoten,ngaysinh,namsinh,phai,mann,madantoc,sonha,thon,cholam,matt,maqu,maphuongxa,userid,hotenkdau,nam,ngayud)";
						sql+=" values (:m_mabn,:m_hoten,:m_ngaysinh,:m_namsinh,:m_phai,:m_mann,:m_madantoc,:m_sonha,:m_thon,:m_cholam,:m_matt,:m_maqu,:m_maphuongxa,:m_userid,:m_hotenkdau,:m_nam,sysdate)";
					}
					else
					{
						sql="insert into btdbn (mabn,hoten,namsinh,phai,mann,madantoc,sonha,thon,cholam,matt,maqu,maphuongxa,userid,hotenkdau,nam,ngayud)";
						sql+=" values (:m_mabn,:m_hoten,:m_namsinh,:m_phai,:m_mann,:m_madantoc,:m_sonha,:m_thon,:m_cholam,:m_matt,:m_maqu,:m_maphuongxa,:m_userid,:m_hotenkdau,:m_nam,sysdate)";
					}
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar).Value=m_mabn;
					cmd.Parameters.Add("m_hoten",OracleType.NVarChar,70).Value=m_hoten;
					if (m_ngaysinh!="") cmd.Parameters.Add("m_ngaysinh",OracleType.DateTime).Value=StringToDateTime(m_ngaysinh);
					cmd.Parameters.Add("m_namsinh",OracleType.VarChar,4).Value=m_namsinh;
					cmd.Parameters.Add("m_phai",OracleType.Number).Value=m_phai;
					cmd.Parameters.Add("m_mann",OracleType.VarChar,2).Value=m_mann;
					cmd.Parameters.Add("m_madantoc",OracleType.VarChar,2).Value=m_madantoc;
					cmd.Parameters.Add("m_sonha",OracleType.NVarChar,10).Value=m_sonha;
					cmd.Parameters.Add("m_thon",OracleType.NVarChar,150).Value=m_thon;
					cmd.Parameters.Add("m_cholam",OracleType.NVarChar,150).Value=m_cholam;
					cmd.Parameters.Add("m_matt",OracleType.VarChar,3).Value=m_matt;
					cmd.Parameters.Add("m_maqu",OracleType.VarChar,5).Value=m_maqu;
					cmd.Parameters.Add("m_maphuongxa",OracleType.VarChar,7).Value=m_maphuongxa;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					cmd.Parameters.Add("m_hotenkdau",OracleType.NVarChar,70).Value=m_hotenkdau;
					cmd.Parameters.Add("m_nam",OracleType.VarChar,500).Value=m_nam;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
					if (bVantay && bVantay_mabntudong) if (get_mabn(int.Parse(m_mabn.Substring(0,2)),0,0,true)<int.Parse(m_mabn.Substring(2))) upd_capmabn(int.Parse(m_mabn.Substring(0,2)),0,0,int.Parse(m_mabn.Substring(2)));
				}
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"Btdbn "+m_mabn);
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_dienthoai(string m_mabn,string m_nha,string m_coquan,string m_didong,string m_email)
		{
			sql="update dienthoai set nha=:m_nha,";
			sql+="coquan=:m_coquan,didong=:m_didong,email=:m_email ";
			sql+="where mabn=:m_mabn";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_nha",OracleType.VarChar,20).Value=m_nha;
				cmd.Parameters.Add("m_coquan",OracleType.VarChar,20).Value=m_coquan;
				cmd.Parameters.Add("m_didong",OracleType.VarChar,15).Value=m_didong;
				cmd.Parameters.Add("m_email",OracleType.NVarChar,50).Value=m_email;
				cmd.Parameters.Add("m_mabn",OracleType.VarChar).Value=m_mabn;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into dienthoai (mabn,nha,coquan,didong,email)";
					sql+=" values (:m_mabn,:m_nha,:m_coquan,:m_didong,:m_email)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar).Value=m_mabn;
					cmd.Parameters.Add("m_nha",OracleType.VarChar,20).Value=m_nha;
					cmd.Parameters.Add("m_coquan",OracleType.VarChar,20).Value=m_coquan;
					cmd.Parameters.Add("m_didong",OracleType.VarChar,15).Value=m_didong;
					cmd.Parameters.Add("m_email",OracleType.NVarChar,50).Value=m_email;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"dienthoai "+m_mabn);
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_dausinhton(long m_maql,decimal m_mach,decimal m_nhietdo,string m_huyetap,string m_ghichu)
		{
			sql="update dausinhton set mach=:m_mach,nhietdo=:m_nhietdo,huyetap=:m_huyetap,ghichu=:m_ghichu";
			sql+=" where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_mach",OracleType.Number).Value=m_mach;
				cmd.Parameters.Add("m_nhietdo",OracleType.Number).Value=m_nhietdo;
				cmd.Parameters.Add("m_huyetap",OracleType.VarChar,7).Value=m_huyetap;
				cmd.Parameters.Add("m_ghichu",OracleType.NVarChar,254).Value=m_ghichu;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into dausinhton (maql,mach,nhietdo,huyetap,ghichu)";
					sql+=" values (:m_maql,:m_mach,:m_nhietdo,:m_huyetap,:m_ghichu)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_mach",OracleType.Number).Value=m_mach;
					cmd.Parameters.Add("m_nhietdo",OracleType.Number).Value=m_nhietdo;
					cmd.Parameters.Add("m_huyetap",OracleType.VarChar,7).Value=m_huyetap;
					cmd.Parameters.Add("m_ghichu",OracleType.NVarChar,254).Value=m_ghichu;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"dausinhton");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_lienhe(long m_maql,string m_sonha,string m_thon,
			string m_cholam,string m_matt,string m_maqu,string m_maphuongxa,string m_tuoivao,int m_loai,int m_bnmoi)
		{
			sql="update lienhe set sonha=:m_sonha,thon=:m_thon,cholam=:m_cholam,matt=:m_matt,maqu=:m_maqu,";
			sql+="maphuongxa=:m_maphuongxa,tuoivao=:m_tuoivao,loai=:m_loai,bnmoi=:m_bnmoi where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_sonha",OracleType.NVarChar,10).Value=m_sonha;
				cmd.Parameters.Add("m_thon",OracleType.NVarChar,150).Value=m_thon;
				cmd.Parameters.Add("m_cholam",OracleType.NVarChar,150).Value=m_cholam;
				cmd.Parameters.Add("m_matt",OracleType.VarChar,3).Value=m_matt;
				cmd.Parameters.Add("m_maqu",OracleType.VarChar,5).Value=m_maqu;
				cmd.Parameters.Add("m_maphuongxa",OracleType.VarChar,7).Value=m_maphuongxa;
				cmd.Parameters.Add("m_tuoivao",OracleType.VarChar,4).Value=m_tuoivao;
				cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
				cmd.Parameters.Add("m_bnmoi",OracleType.Number).Value=m_bnmoi;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into lienhe (maql,sonha,thon,cholam,matt,maqu,maphuongxa,tuoivao,loai,bnmoi)";
					sql+=" values (:m_maql,:m_sonha,:m_thon,:m_cholam,:m_matt,:m_maqu,:m_maphuongxa,:m_tuoivao,:m_loai,:m_bnmoi)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_sonha",OracleType.NVarChar,10).Value=m_sonha;
					cmd.Parameters.Add("m_thon",OracleType.NVarChar,150).Value=m_thon;
					cmd.Parameters.Add("m_cholam",OracleType.NVarChar,150).Value=m_cholam;
					cmd.Parameters.Add("m_matt",OracleType.VarChar,3).Value=m_matt;
					cmd.Parameters.Add("m_maqu",OracleType.VarChar,5).Value=m_maqu;
					cmd.Parameters.Add("m_maphuongxa",OracleType.VarChar,7).Value=m_maphuongxa;
					cmd.Parameters.Add("m_tuoivao",OracleType.VarChar,4).Value=m_tuoivao;
					cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
					cmd.Parameters.Add("m_bnmoi",OracleType.Number).Value=m_bnmoi;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"Lienhe");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public void upd_soluutru(long m_maql,string m_soluutru)
		{
			execute_data("update lienhe set soluutru='"+m_soluutru+"'"+" where maql="+m_maql);
		}

		public string get_soluutru(long m_maql)
		{
			ds=get_data("select soluutru from lienhe where maql="+m_maql);
			if (ds.Tables[0].Rows.Count==0) return "";
			else return ds.Tables[0].Rows[0]["soluutru"].ToString();
		}

		public string get_soluutru_xuatvien(long m_maql)
		{
			ds=get_data("select soluutru from xuatvien where maql="+m_maql);
			if (ds.Tables[0].Rows.Count==0) return "";
			else return ds.Tables[0].Rows[0]["soluutru"].ToString();
		}

		public bool upd_bhyt(string m_mabn,long m_maql,string m_sothe,string m_denngay,string m_mabv)
		{
			int m_maphu=0;
			sql="update bhyt set sothe=:m_sothe,";
			//if (m_denngay!="") sql+="denngay=:m_denngay,";
			sql+="mabv=:m_mabv,maphu=:m_maphu where maql=:m_maql ";
			sql+=" and sothe=:m_sothe";//binh
			sql+=" and denngay=:m_denngay";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_sothe",OracleType.VarChar,20).Value=m_sothe;
				//if (m_denngay!="") cmd.Parameters.Add("m_denngay",OracleType.DateTime).Value=StringToDateTime(m_denngay);
				cmd.Parameters.Add("m_mabv",OracleType.VarChar,8).Value=m_mabv;
				cmd.Parameters.Add("m_maphu",OracleType.Number).Value=m_maphu;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				cmd.Parameters.Add("m_denngay",OracleType.DateTime).Value=StringToDateTime(m_denngay);
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					if (m_denngay!="")
						sql="insert into bhyt(mabn,maql,sothe,denngay,mabv,maphu) values (:m_mabn,:m_maql,:m_sothe,:m_denngay,:m_mabv,:m_maphu)";
					else
						sql="insert into bhyt(mabn,maql,sothe,mabv,maphu) values (:m_mabn,:m_maql,:m_sothe,:m_mabv,:m_maphu)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_sothe",OracleType.VarChar,20).Value=m_sothe;
					if (m_denngay!="") cmd.Parameters.Add("m_denngay",OracleType.DateTime).Value=StringToDateTime(m_denngay);
					cmd.Parameters.Add("m_mabv",OracleType.VarChar,8).Value=m_mabv;
					cmd.Parameters.Add("m_maphu",OracleType.Number).Value=m_maphu;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"Bhyt "+m_mabn);
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}
		public bool upd_bhyt(string m_mabn,long m_maql,string m_sothe,int m_makhuvuc,int m_mienchitra)
		{
			
			sql="update bhyt set makhuvuc="+m_makhuvuc+", mienchitra="+m_mienchitra;
			sql+="  where mabn='"+m_mabn+"' and maql="+m_maql+" and sothe='"+m_sothe+"'";			
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;				
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"Bhyt "+m_mabn);
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_bhyt_mmyy(string m_ngay,string m_mabn,long m_maql,string m_sothe,int m_makhuvuc,int m_mienchitra)
		{
			
			sql="update "+user+mmyy(m_ngay)+".bhyt set makhuvuc="+m_makhuvuc+", mienchitra="+m_mienchitra;
			sql+="  where mabn='"+m_mabn+"' and maql="+m_maql+" and sothe='"+m_sothe+"'";			
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;				
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"Bhyt "+m_mabn);
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_bhyt_(string m_mabn,long m_maql,string m_sothe,string m_denngay,string m_mabv, string m_thecu)
		{
			int m_maphu=0;
			sql="update bhyt set sothe=:m_sothe,";
			//if (m_denngay!="") sql+="denngay=:m_denngay,";
			sql+="mabv=:m_mabv,maphu=:m_maphu where maql=:m_maql ";
			if(m_thecu!="") sql+=" and sothe=:m_sothe";//binh
			sql+=" and denngay=:m_denngay";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_sothe",OracleType.VarChar,20).Value=m_sothe;
				//if (m_denngay!="") cmd.Parameters.Add("m_denngay",OracleType.DateTime).Value=StringToDateTime(m_denngay);
				cmd.Parameters.Add("m_mabv",OracleType.VarChar,8).Value=m_mabv;
				cmd.Parameters.Add("m_maphu",OracleType.Number).Value=m_maphu;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				if(m_thecu!="")cmd.Parameters.Add("m_thecu",OracleType.VarChar,20).Value=m_thecu;
				cmd.Parameters.Add("m_denngay",OracleType.DateTime).Value=StringToDateTime(m_denngay);
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					if (m_denngay!="")
						sql="insert into bhyt(mabn,maql,sothe,denngay,mabv,maphu) values (:m_mabn,:m_maql,:m_sothe,:m_denngay,:m_mabv,:m_maphu)";
					else
						sql="insert into bhyt(mabn,maql,sothe,mabv,maphu) values (:m_mabn,:m_maql,:m_sothe,:m_mabv,:m_maphu)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_sothe",OracleType.VarChar,20).Value=m_sothe;
					if (m_denngay!="") cmd.Parameters.Add("m_denngay",OracleType.DateTime).Value=StringToDateTime(m_denngay);
					cmd.Parameters.Add("m_mabv",OracleType.VarChar,8).Value=m_mabv;
					cmd.Parameters.Add("m_maphu",OracleType.Number).Value=m_maphu;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"Bhyt "+m_mabn);
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_bhyt(string m_mabn,long m_maql,string m_sothe,string m_denngay,string m_mabv,int m_maphu,int traituyen)
		{
			sql="update bhyt set sothe=:m_sothe,";
			//if (m_denngay!="") sql+="denngay=:m_denngay,";
			sql+="mabv=:m_mabv,maphu=:m_maphu,traituyen="+traituyen+" where maql=:m_maql ";
			sql+=" and sothe=:m_sothe";//binh
			sql+=" and denngay=:m_denngay";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_sothe",OracleType.VarChar,20).Value=m_sothe;
				//if (m_denngay!="") cmd.Parameters.Add("m_denngay",OracleType.DateTime).Value=StringToDateTime(m_denngay);
				cmd.Parameters.Add("m_mabv",OracleType.VarChar,8).Value=m_mabv;
				cmd.Parameters.Add("m_maphu",OracleType.Number).Value=m_maphu;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				cmd.Parameters.Add("m_denngay",OracleType.DateTime).Value=StringToDateTime(m_denngay);
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					if (m_denngay!="")
						sql="insert into bhyt(mabn,maql,sothe,denngay,mabv,maphu,traituyen) values (:m_mabn,:m_maql,:m_sothe,:m_denngay,:m_mabv,:m_maphu,"+traituyen+")";
					else
						sql="insert into bhyt(mabn,maql,sothe,mabv,maphu,traituyen) values (:m_mabn,:m_maql,:m_sothe,:m_mabv,:m_maphu,"+traituyen+")";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_sothe",OracleType.VarChar,20).Value=m_sothe;
					if (m_denngay!="") cmd.Parameters.Add("m_denngay",OracleType.DateTime).Value=StringToDateTime(m_denngay);
					cmd.Parameters.Add("m_mabv",OracleType.VarChar,8).Value=m_mabv;
					cmd.Parameters.Add("m_maphu",OracleType.Number).Value=m_maphu;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"Bhyt "+m_mabn);
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_bhyt_(string m_mabn,long m_maql,string m_sothe,string m_denngay,string m_mabv,int m_maphu,int traituyen, string m_thecu)
		{
			sql="update bhyt set sothe=:m_sothe,";
			//if (m_denngay!="") sql+="denngay=:m_denngay,";
			sql+="mabv=:m_mabv,maphu=:m_maphu,traituyen="+traituyen+" where maql=:m_maql ";
			if(m_thecu!="")sql+=" and sothe=:m_thecu";//binh
			sql+=" and denngay=:m_denngay";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_sothe",OracleType.VarChar,20).Value=m_sothe;
				//if (m_denngay!="") cmd.Parameters.Add("m_denngay",OracleType.DateTime).Value=StringToDateTime(m_denngay);
				cmd.Parameters.Add("m_mabv",OracleType.VarChar,8).Value=m_mabv;
				cmd.Parameters.Add("m_maphu",OracleType.Number).Value=m_maphu;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				if(m_thecu!="")cmd.Parameters.Add("m_thecu",OracleType.VarChar,20).Value=m_thecu;
				if (m_denngay!="") cmd.Parameters.Add("m_denngay",OracleType.DateTime).Value=StringToDateTime(m_denngay);
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					if (m_denngay!="")
						sql="insert into bhyt(mabn,maql,sothe,denngay,mabv,maphu,traituyen) values (:m_mabn,:m_maql,:m_sothe,:m_denngay,:m_mabv,:m_maphu,"+traituyen+")";
					else
						sql="insert into bhyt(mabn,maql,sothe,mabv,maphu,traituyen) values (:m_mabn,:m_maql,:m_sothe,:m_mabv,:m_maphu,"+traituyen+")";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_sothe",OracleType.VarChar,20).Value=m_sothe;
					if (m_denngay!="") cmd.Parameters.Add("m_denngay",OracleType.DateTime).Value=StringToDateTime(m_denngay);
					cmd.Parameters.Add("m_mabv",OracleType.VarChar,8).Value=m_mabv;
					cmd.Parameters.Add("m_maphu",OracleType.Number).Value=m_maphu;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"Bhyt "+m_mabn);
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_bhyt(string m_mabn,long m_maql,string m_sothe,string m_denngay,string m_mabv,int m_maphu,
			string m_tungay,int traituyen)
		{
			sql="update bhyt set sothe=:m_sothe";
			//if (m_denngay!="") sql+=",denngay=:m_denngay";
			sql+=",mabv=:m_mabv,maphu=:m_maphu";
			if (m_tungay!="") sql+=",tungay=:m_tungay";
			sql+=",traituyen="+traituyen;
			sql+=" where maql=:m_maql";
			sql+=" and sothe=:m_sothe";//binh
			sql+=" and denngay=:m_denngay";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_sothe",OracleType.VarChar,20).Value=m_sothe;
				//if (m_denngay!="") cmd.Parameters.Add("m_denngay",OracleType.DateTime).Value=StringToDateTime(m_denngay);
				cmd.Parameters.Add("m_mabv",OracleType.VarChar,8).Value=m_mabv;
				cmd.Parameters.Add("m_maphu",OracleType.Number).Value=m_maphu;
				if (m_tungay!="") cmd.Parameters.Add("m_tungay",OracleType.DateTime).Value=StringToDateTime(m_tungay);
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				if (m_denngay!="") cmd.Parameters.Add("m_denngay",OracleType.DateTime).Value=StringToDateTime(m_denngay);
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into bhyt(mabn,maql,sothe";
					if (m_denngay!="") sql+=",denngay";
					sql+=",mabv,maphu";
					if (m_tungay!="") sql+=",tungay";
					sql+=",traituyen) values (:m_mabn,:m_maql,:m_sothe";
					if (m_denngay!="") sql+=",:m_denngay";
					sql+=",:m_mabv,:m_maphu";
					if (m_tungay!="")  sql+=",:m_tungay";
					sql+=","+traituyen+")";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_sothe",OracleType.VarChar,20).Value=m_sothe;
					if (m_denngay!="") cmd.Parameters.Add("m_denngay",OracleType.DateTime).Value=StringToDateTime(m_denngay);
					cmd.Parameters.Add("m_mabv",OracleType.VarChar,8).Value=m_mabv;
					cmd.Parameters.Add("m_maphu",OracleType.Number).Value=m_maphu;
					if (m_tungay!="") cmd.Parameters.Add("m_tungay",OracleType.DateTime).Value=StringToDateTime(m_tungay);
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"Bhyt "+m_mabn);
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_bhyt_(string m_mabn,long m_maql,string m_sothe,string m_denngay,string m_mabv,int m_maphu,
			string m_tungay,int traituyen, string m_thecu)
		{
			sql="update bhyt set sothe=:m_sothe";
			//if (m_denngay!="") sql+=",denngay=:m_denngay";
			sql+=",mabv=:m_mabv,maphu=:m_maphu";
			if (m_tungay!="") sql+=",tungay=:m_tungay";
			sql+=",traituyen="+traituyen;
			sql+=" where maql=:m_maql";
			if(m_thecu!="") sql+=" and sothe='"+m_thecu+"'";//binh
			if (m_denngay!="") sql+=" and denngay=:m_denngay";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_sothe",OracleType.VarChar,20).Value=m_sothe;
				//if (m_denngay!="") cmd.Parameters.Add("m_denngay",OracleType.DateTime).Value=StringToDateTime(m_denngay);
				cmd.Parameters.Add("m_mabv",OracleType.VarChar,8).Value=m_mabv;
				cmd.Parameters.Add("m_maphu",OracleType.Number).Value=m_maphu;
				if (m_tungay!="") cmd.Parameters.Add("m_tungay",OracleType.DateTime).Value=StringToDateTime(m_tungay);
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				if (m_denngay!="") cmd.Parameters.Add("m_denngay",OracleType.DateTime).Value=StringToDateTime(m_denngay);
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into bhyt(mabn,maql,sothe";
					if (m_denngay!="") sql+=",denngay";
					sql+=",mabv,maphu";
					if (m_tungay!="") sql+=",tungay";
					sql+=",traituyen) values (:m_mabn,:m_maql,:m_sothe";
					if (m_denngay!="") sql+=",:m_denngay";
					sql+=",:m_mabv,:m_maphu";
					if (m_tungay!="")  sql+=",:m_tungay";
					sql+=","+traituyen+")";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_sothe",OracleType.VarChar,20).Value=m_sothe;
					if (m_denngay!="") cmd.Parameters.Add("m_denngay",OracleType.DateTime).Value=StringToDateTime(m_denngay);
					cmd.Parameters.Add("m_mabv",OracleType.VarChar,8).Value=m_mabv;
					cmd.Parameters.Add("m_maphu",OracleType.Number).Value=m_maphu;
					if (m_tungay!="") cmd.Parameters.Add("m_tungay",OracleType.DateTime).Value=StringToDateTime(m_tungay);
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"Bhyt "+m_mabn);
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_bhyt(long m_maql,string m_sothe,string m_ngay1,string m_ngay2,string m_ngay3)
		{
			sql="update bhyt set maql=:m_maql";
			if (m_ngay1.Length==10) sql+=",ngay1=:m_ngay1";
			if (m_ngay2.Length==10) sql+=",ngay2=:m_ngay2";
			if (m_ngay3.Length==10) sql+=",ngay3=:m_ngay3";
			sql+=" where maql=:m_maql and sothe=:m_sothe";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				if (m_ngay1.Length==10) cmd.Parameters.Add("m_ngay1",OracleType.DateTime).Value=StringToDateTime(m_ngay1);
				if (m_ngay2.Length==10) cmd.Parameters.Add("m_ngay2",OracleType.DateTime).Value=StringToDateTime(m_ngay2);
				if (m_ngay3.Length==10) cmd.Parameters.Add("m_ngay3",OracleType.DateTime).Value=StringToDateTime(m_ngay3);
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				cmd.Parameters.Add("m_sothe",OracleType.VarChar,20).Value=m_sothe;
				cmd.ExecuteNonQuery();
				cmd.Dispose();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"Bhyt "+m_maql.ToString());
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_bhyt_mmyy(string m_ngay,long m_maql,string m_ngay1,string m_ngay2,string m_ngay3)
		{
			sql="update "+user+mmyy(m_ngay)+".bhyt set maql=:m_maql";
			if (m_ngay1.Length==10) sql+=",ngay1=:m_ngay1";
			if (m_ngay2.Length==10) sql+=",ngay2=:m_ngay2";
			if (m_ngay3.Length==10) sql+=",ngay3=:m_ngay3";
			sql+=" where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				if (m_ngay1.Length==10) cmd.Parameters.Add("m_ngay1",OracleType.DateTime).Value=StringToDateTime(m_ngay1);
				if (m_ngay2.Length==10) cmd.Parameters.Add("m_ngay2",OracleType.DateTime).Value=StringToDateTime(m_ngay2);
				if (m_ngay3.Length==10) cmd.Parameters.Add("m_ngay3",OracleType.DateTime).Value=StringToDateTime(m_ngay3);
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				cmd.ExecuteNonQuery();
				cmd.Dispose();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"Bhyt "+m_maql.ToString());
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_bhyt_add(string m_mabn,long m_maql,string m_sothe,string m_denngay,string m_mabv,
			int m_maphu,string m_tungay,int traituyen)
		{
			sql="update bhyt set mabv=:m_mabv,maphu=:m_maphu";
			//if (m_denngay!="") sql+=",denngay=:m_denngay";
			if (m_tungay!="") sql+=",tungay=:m_tungay";
			sql+=",traituyen="+traituyen;
			sql+=" where maql=:m_maql and sothe=:m_sothe and denngay=:m_denngay";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;				
				cmd.Parameters.Add("m_mabv",OracleType.VarChar,8).Value=m_mabv;
				cmd.Parameters.Add("m_maphu",OracleType.Number).Value=m_maphu;
				//				if (m_denngay!="") cmd.Parameters.Add("m_denngay",OracleType.DateTime).Value=StringToDateTime(m_denngay);
				if (m_tungay!="") cmd.Parameters.Add("m_tungay",OracleType.DateTime).Value=StringToDateTime(m_tungay);
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				cmd.Parameters.Add("m_sothe",OracleType.VarChar,20).Value=m_sothe;
				cmd.Parameters.Add("m_denngay",OracleType.DateTime).Value=StringToDateTime(m_denngay);
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into bhyt(mabn,maql,sothe";
					if (m_denngay!="") sql+=",denngay";
					sql+=",mabv,maphu";
					if (m_tungay!="") sql+=",tungay";
					sql+=",traituyen) values (:m_mabn,:m_maql,:m_sothe";
					if (m_denngay!="") sql+=",:m_denngay";
					sql+=",:m_mabv,:m_maphu";
					if (m_tungay!="")  sql+=",:m_tungay";
					sql+=","+traituyen+")";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_sothe",OracleType.VarChar,20).Value=m_sothe;
					if (m_denngay!="") cmd.Parameters.Add("m_denngay",OracleType.DateTime).Value=StringToDateTime(m_denngay);
					cmd.Parameters.Add("m_mabv",OracleType.VarChar,8).Value=m_mabv;
					cmd.Parameters.Add("m_maphu",OracleType.Number).Value=m_maphu;
					if (m_tungay!="") cmd.Parameters.Add("m_tungay",OracleType.DateTime).Value=StringToDateTime(m_tungay);
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"Bhyt "+m_mabn);
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_dmbhyt(string m_mabn,string m_ma,string m_sothe,string m_tungay,string m_denngay,string m_mabv,int m_maphu)
		{
			sql="update dmbhyt set ";
			if (m_ma!="")  sql+=" ma=:m_ma,";
			if (m_tungay!="") sql+="tungay=:m_tungay,";
			if (m_denngay!="") sql+="denngay=:m_denngay,";
			sql+="mabv=:m_mabv,maphu=:m_maphu";
			sql+=" where sothe=:m_sothe";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				if (m_ma!="") cmd.Parameters.Add("m_ma",OracleType.VarChar,10).Value=m_ma;
				if (m_tungay!="") cmd.Parameters.Add("m_tungay",OracleType.DateTime).Value=StringToDateTime(m_tungay);
				if (m_denngay!="") cmd.Parameters.Add("m_denngay",OracleType.DateTime).Value=StringToDateTime(m_denngay);
				cmd.Parameters.Add("m_mabv",OracleType.VarChar,8).Value=m_mabv;
				cmd.Parameters.Add("m_maphu",OracleType.Number).Value=m_maphu;
				cmd.Parameters.Add("m_sothe",OracleType.VarChar,20).Value=m_sothe;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into dmbhyt(mabn,ma,sothe";
					if (m_tungay!="") sql+=",tungay";
					if (m_denngay!="") sql+=",denngay";
					sql+=",mabv,maphu";
					sql+=") values (:m_mabn,:m_ma,:m_sothe";
					if (m_tungay!="")  sql+=",:m_tungay";
					if (m_denngay!="") sql+=",:m_denngay";
					sql+=",:m_mabv,:m_maphu";
					sql+=")";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
					cmd.Parameters.Add("m_ma",OracleType.VarChar,10).Value=m_ma;
					cmd.Parameters.Add("m_sothe",OracleType.VarChar,20).Value=m_sothe;
					if (m_tungay!="") cmd.Parameters.Add("m_tungay",OracleType.DateTime).Value=StringToDateTime(m_tungay);
					if (m_denngay!="") cmd.Parameters.Add("m_denngay",OracleType.DateTime).Value=StringToDateTime(m_denngay);
					cmd.Parameters.Add("m_mabv",OracleType.VarChar,8).Value=m_mabv;
					cmd.Parameters.Add("m_maphu",OracleType.Number).Value=m_maphu;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"dmbhyt");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public string mmyy(string ngay)
		{
			try
			{
				return (ngay.Length==4)?ngay:ngay.Substring(3,2)+ngay.Substring(8,2);
			}
			catch{return "";}
		}

		public bool upd_tiepdon(string m_mabn,long m_mavaovien,long m_maql,string m_makp,string m_ngay,
			int m_madoituong,string m_sovaovien,string m_tuoivao,int m_bnmoi,int m_userid,int m_noitiepdon,int m_loai)
		{
			sql="update tiepdon set mavaovien="+m_mavaovien+",makp=:m_makp,ngay=:m_ngay,madoituong=:m_madoituong,";
			if (m_sovaovien!="") sql+="sovaovien=:m_sovaovien,";
			sql+="tuoivao=:m_tuoivao,bnmoi=:m_bnmoi,userid=:m_userid,noitiepdon=:m_noitiepdon,loai=:m_loai where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_madoituong",OracleType.Number).Value=m_madoituong;
				if (m_sovaovien!="") cmd.Parameters.Add("m_sovaovien",OracleType.VarChar,10).Value=m_sovaovien;
				cmd.Parameters.Add("m_tuoivao",OracleType.VarChar,4).Value=m_tuoivao;
				cmd.Parameters.Add("m_bnmoi",OracleType.Number).Value=m_bnmoi;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_noitiepdon",OracleType.Number).Value=m_noitiepdon;
				cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					if (m_sovaovien=="")
					{
						sql="insert into tiepdon(mabn,mavaovien,maql,makp,ngay,madoituong,tuoivao,bnmoi,userid,noitiepdon,loai,ngayud)";
						sql+=" values (:m_mabn,"+m_mavaovien+",:m_maql,:m_makp,:m_ngay,:m_madoituong,:m_tuoivao,:m_bnmoi,:m_userid,:m_noitiepdon,:m_loai,sysdate)";
					}
					else
					{
						sql="insert into tiepdon(mabn,mavaovien,maql,makp,ngay,madoituong,sovaovien,tuoivao,bnmoi,userid,noitiepdon,loai,ngayud)";
						sql+=" values (:m_mabn,"+m_mavaovien+",:m_maql,:m_makp,:m_ngay,:m_madoituong,:m_sovaovien,:m_tuoivao,:m_bnmoi,:m_userid,:m_noitiepdon,:m_loai,sysdate)";
					}
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar).Value=m_mabn;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_madoituong",OracleType.Number).Value=m_madoituong;
					if (m_sovaovien!="") cmd.Parameters.Add("m_sovaovien",OracleType.VarChar,10).Value=m_sovaovien;
					cmd.Parameters.Add("m_bnmoi",OracleType.Number).Value=m_bnmoi;
					cmd.Parameters.Add("m_tuoivao",OracleType.VarChar,4).Value=m_tuoivao;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					cmd.Parameters.Add("m_noitiepdon",OracleType.Number).Value=m_noitiepdon;
					cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"Tiepdon");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_tiepdon_mmyy(string m_mabn,long m_maql,string m_makp,string m_ngay,
			int m_madoituong,string m_sovaovien,string m_tuoivao,int m_bnmoi,int m_userid,int m_noitiepdon,int m_loai,long m_mavaovien)
		{
			string xxx=user+mmyy(m_ngay);
			sql="update "+xxx+".tiepdon set makp=:m_makp,ngay=:m_ngay,madoituong=:m_madoituong,";
			if (m_sovaovien!="" && m_sovaovien!= null) sql+="sovaovien=:m_sovaovien,";
			sql+="tuoivao=:m_tuoivao,done='',bnmoi=:m_bnmoi,userid=:m_userid,noitiepdon=:m_noitiepdon,loai=:m_loai,";
			sql+="mavaovien=:m_mavaovien where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_madoituong",OracleType.Number).Value=m_madoituong;
				if (m_sovaovien!="" && m_sovaovien!= null) cmd.Parameters.Add("m_sovaovien",OracleType.VarChar,10).Value=m_sovaovien;
				cmd.Parameters.Add("m_tuoivao",OracleType.VarChar,4).Value=m_tuoivao;
				cmd.Parameters.Add("m_bnmoi",OracleType.Number).Value=m_bnmoi;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_noitiepdon",OracleType.Number).Value=m_noitiepdon;
				cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
				cmd.Parameters.Add("m_mavaovien",OracleType.Number).Value=m_mavaovien;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					if (m_sovaovien=="" || m_sovaovien== null)
					{
						sql="insert into "+xxx+".tiepdon(mabn,maql,makp,ngay,madoituong,tuoivao,bnmoi,userid,noitiepdon,loai,ngayud,mavaovien)";
						sql+=" values (:m_mabn,:m_maql,:m_makp,:m_ngay,:m_madoituong,:m_tuoivao,:m_bnmoi,:m_userid,:m_noitiepdon,:m_loai,sysdate,:m_mavaovien)";
					}
					else
					{
						sql="insert into "+xxx+".tiepdon(mabn,maql,makp,ngay,madoituong,sovaovien,tuoivao,bnmoi,userid,noitiepdon,loai,ngayud,mavaovien)";
						sql+=" values (:m_mabn,:m_maql,:m_makp,:m_ngay,:m_madoituong,:m_sovaovien,:m_tuoivao,:m_bnmoi,:m_userid,:m_noitiepdon,:m_loai,sysdate,:m_mavaovien)";
					}
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar).Value=m_mabn;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_madoituong",OracleType.Number).Value=m_madoituong;
					if (m_sovaovien!="" && m_sovaovien!= null) cmd.Parameters.Add("m_sovaovien",OracleType.VarChar,10).Value=m_sovaovien;
					cmd.Parameters.Add("m_bnmoi",OracleType.Number).Value=m_bnmoi;
					cmd.Parameters.Add("m_tuoivao",OracleType.VarChar,4).Value=m_tuoivao;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					cmd.Parameters.Add("m_noitiepdon",OracleType.Number).Value=m_noitiepdon;
					cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
					cmd.Parameters.Add("m_mavaovien",OracleType.Number).Value=m_mavaovien;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"TD-"+m_mabn.Trim());
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_benhandt(string m_mabn,long m_maql,string m_makp,string m_ngay,
			int m_dentu,int m_nhantu,int m_lanthu,int m_madoituong,string m_chandoan,
			string m_maicd,string m_mabs,string m_sovaovien,int m_loaiba,int m_userid,bool m_update,long m_mangtr)
		{
			sql="update benhandt set ";
			if (m_update) sql+="makp=:m_makp,";//userid=:m_userid,";
			sql+="ngay=:m_ngay,dentu=:m_dentu,nhantu=:m_nhantu,";
			sql+="lanthu=:m_lanthu,madoituong=:m_madoituong,chandoan=:m_chandoan,maicd=:m_maicd,mabs=:m_mabs,";
			if (m_sovaovien!="") sql+="sovaovien=:m_sovaovien,";
			sql+="loaiba=:m_loaiba,mangtr=:m_mangtr where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				if (m_update)
				{
					cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
					//cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				}
				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_dentu",OracleType.Number).Value=m_dentu;
				cmd.Parameters.Add("m_nhantu",OracleType.Number).Value=m_nhantu;
				cmd.Parameters.Add("m_lanthu",OracleType.Number).Value=m_lanthu;
				cmd.Parameters.Add("m_madoituong",OracleType.Number).Value=m_madoituong;
				cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,254).Value=m_chandoan;
				cmd.Parameters.Add("m_maicd",OracleType.VarChar,9).Value=m_maicd;
				cmd.Parameters.Add("m_mabs",OracleType.VarChar,4).Value=m_mabs;
				if (m_sovaovien!="") cmd.Parameters.Add("m_sovaovien",OracleType.VarChar,10).Value=m_sovaovien;
				cmd.Parameters.Add("m_loaiba",OracleType.Number).Value=m_loaiba;				
				cmd.Parameters.Add("m_mangtr",OracleType.Number).Value=m_mangtr;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					if (m_sovaovien=="")
					{
						sql="insert into benhandt(mabn,maql,makp,ngay,dentu,nhantu,lanthu,madoituong,chandoan,maicd,mabs,loaiba,userid,ngayud,mangtr)";
						sql+=" values (:m_mabn,:m_maql,:m_makp,:m_ngay,:m_dentu,:m_nhantu,:m_lanthu,:m_madoituong,:m_chandoan,:m_maicd,:m_mabs,:m_loaiba,:m_userid,sysdate,:m_mangtr)";
					}
					else
					{
						sql="insert into benhandt(mabn,maql,makp,ngay,dentu,nhantu,lanthu,madoituong,chandoan,maicd,mabs,sovaovien,loaiba,userid,ngayud,mangtr)";
						sql+=" values (:m_mabn,:m_maql,:m_makp,:m_ngay,:m_dentu,:m_nhantu,:m_lanthu,:m_madoituong,:m_chandoan,:m_maicd,:m_mabs,:m_sovaovien,:m_loaiba,:m_userid,sysdate,:m_mangtr)";
					}
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar).Value=m_mabn;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_dentu",OracleType.Number).Value=m_dentu;
					cmd.Parameters.Add("m_nhantu",OracleType.Number).Value=m_nhantu;
					cmd.Parameters.Add("m_lanthu",OracleType.Number).Value=m_lanthu;
					cmd.Parameters.Add("m_madoituong",OracleType.Number).Value=m_madoituong;
					cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,254).Value=m_chandoan;
					cmd.Parameters.Add("m_maicd",OracleType.VarChar,9).Value=m_maicd;
					cmd.Parameters.Add("m_mabs",OracleType.VarChar,4).Value=m_mabs;
					if (m_sovaovien!="") cmd.Parameters.Add("m_sovaovien",OracleType.VarChar,10).Value=m_sovaovien;
					cmd.Parameters.Add("m_loaiba",OracleType.Number).Value=m_loaiba;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					cmd.Parameters.Add("m_mangtr",OracleType.Number).Value=m_mangtr;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
					con.Close();con.Dispose();
					if (m_sovaovien=="")
					{
						if (bSoluutru_makpmmsttyy) upd_sovaovien(m_maql,get_sovaovien_makpmmsttyy(m_maql,m_makp,m_ngay));
						else if(m_loaiba==2 && bSovaovien_tudong_ngoaitru_chungnoitru) upd_sovaovien(m_maql,get_capid(5,m_ngay.Substring(8,2)).ToString().PadLeft(7,'0')+"/"+m_ngay.Substring(8,2));
						else if(m_loaiba==2 && bSovaovien_tudong_ngoaitru_rieng) upd_sovaovien(m_maql,get_capid(-5,m_ngay.Substring(8,2)).ToString().PadLeft(7,'0')+"/"+m_ngay.Substring(8,2));
						else if (bSovaovien_noitru)
						{
							if (m_loaiba==1)
							{
								if (bSovaovien_khoa) upd_sovaovien(m_maql,get_capid(900+int.Parse(m_makp),m_ngay.Substring(8,2)).ToString().PadLeft(7,'0')+"/"+m_ngay.Substring(8,2));
								else upd_sovaovien(m_maql,get_capid(5,m_ngay.Substring(8,2)).ToString().PadLeft(7,'0')+"/"+m_ngay.Substring(8,2));
							}
						}
						
						else if (m_loaiba!=3) upd_sovaovien(m_maql,get_capid(5,m_ngay.Substring(8,2)).ToString().PadLeft(7,'0')+"/"+m_ngay.Substring(8,2));
					}
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"Benhandt");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_nhapkhoa(long m_id,string m_mabn,long m_maql,string m_makp,int m_maba,string m_ngay,string m_tuoivao,string m_giuong,string m_khoachuyen,string m_chandoan,string m_maicd,string m_mabs,int m_lan,int m_userid)
		{
			sql="update nhapkhoa set makp=:m_makp,maba=:m_maba,ngay=:m_ngay,";
			sql+="tuoivao=:m_tuoivao,giuong=:m_giuong,khoachuyen=:m_khoachuyen,";
			sql+="chandoan=:m_chandoan,maicd=:m_maicd,mabs=:m_mabs,lan=:m_lan";
			//sql+=",userid=:m_userid ";
			sql+=" where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
			
				cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
				cmd.Parameters.Add("m_maba",OracleType.Number).Value=m_maba;
				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_tuoivao",OracleType.VarChar,4).Value=m_tuoivao;
				cmd.Parameters.Add("m_giuong",OracleType.VarChar,10).Value=m_giuong;
				cmd.Parameters.Add("m_khoachuyen",OracleType.VarChar,2).Value=m_khoachuyen;
				cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,254).Value=m_chandoan;
				cmd.Parameters.Add("m_maicd",OracleType.VarChar,9).Value=m_maicd;
				cmd.Parameters.Add("m_mabs",OracleType.VarChar,4).Value=m_mabs;
				cmd.Parameters.Add("m_lan",OracleType.Number).Value=m_lan;
				//cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into nhapkhoa(id,mabn,maql,makp,maba,ngay,tuoivao,giuong,khoachuyen,chandoan,maicd,mabs,lan,userid,ngayud)";
					sql+=" values (:m_id,:m_mabn,:m_maql,:m_makp,:m_maba,:m_ngay,:m_tuoivao,:m_giuong,:m_khoachuyen,:m_chandoan,:m_maicd,:m_mabs,:m_lan,:m_userid,sysdate)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar).Value=m_mabn;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
					cmd.Parameters.Add("m_maba",OracleType.Number).Value=m_maba;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_tuoivao",OracleType.VarChar,4).Value=m_tuoivao;
					cmd.Parameters.Add("m_giuong",OracleType.VarChar,10).Value=m_giuong;
					cmd.Parameters.Add("m_khoachuyen",OracleType.VarChar,2).Value=m_khoachuyen;
					cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,254).Value=m_chandoan;
					cmd.Parameters.Add("m_maicd",OracleType.VarChar,9).Value=m_maicd;
					cmd.Parameters.Add("m_mabs",OracleType.VarChar,4).Value=m_mabs;
					cmd.Parameters.Add("m_lan",OracleType.Number).Value=m_lan;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
				execute_data("delete hiendien where nhapkhoa=0 and xuatkhoa=0 and mabn='"+m_mabn+"' and maql="+m_maql+" and makp='"+m_makp+"'");
				upd_hiendien(m_id,m_mabn,m_maql,m_makp,m_ngay,m_khoachuyen);
				upd_hiendien(m_id,0);
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"Nhapkhoa");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_xuattam(long m_id,string m_mabn,long m_maql,long m_idkhoa,string m_ngayvv,string m_makp,string m_ngayvk,string m_chandoan,int m_lydo,string m_ghichu,string m_tinhtrangra,string m_mabs,string m_ngayra,int m_userid)
		{
			sql = "update xuattam set mabn=:m_mabn,maql=:m_maql,idkhoa=:m_idkhoa,ngayvv=to_date(:m_ngayvv,'dd/mm/yyyy hh24:mi'),";
			sql += "makp=:m_makp,ngayvk=to_date(:m_ngayvk,'dd/mm/yyyy hh24:mi'),chandoan=:m_chandoan,lydo=:m_lydo,";
			sql += "ghichu=:m_ghichu,tinhtrangra=:m_tinhtrangra,mabs=:m_mabs,";
			if (m_ngayra.Trim()!="") sql += "ngayra=to_date(:m_ngayra,'dd/mm/yyyy hh24:mi'),";
			sql += "userid=:m_userid where id=:m_id";
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd = new OracleCommand(sql, con);
				cmd.CommandType = CommandType.Text;
				cmd.Parameters.Add("m_mabn", OracleType.VarChar, 8).Value = m_mabn;
				cmd.Parameters.Add("m_maql", OracleType.Number).Value = m_maql;
				cmd.Parameters.Add("m_idkhoa", OracleType.Number).Value = m_idkhoa;
				cmd.Parameters.Add("m_ngayvv", OracleType.VarChar, 16).Value = m_ngayvv;
				cmd.Parameters.Add("m_makp", OracleType.VarChar, 2).Value = m_makp;
				cmd.Parameters.Add("m_ngayvk", OracleType.VarChar, 16).Value = m_ngayvk;
				cmd.Parameters.Add("m_chandoan", OracleType.NVarChar,254).Value = m_chandoan;
				cmd.Parameters.Add("m_lydo", OracleType.Number).Value = m_lydo;
				cmd.Parameters.Add("m_ghichu", OracleType.NVarChar,254).Value = m_ghichu;
				cmd.Parameters.Add("m_tinhtrangra", OracleType.NVarChar,254).Value = m_tinhtrangra;
				cmd.Parameters.Add("m_mabs", OracleType.VarChar, 4).Value = m_mabs;
				if (m_ngayra.Trim()!="") cmd.Parameters.Add("m_ngayra", OracleType.VarChar, 16).Value = m_ngayra;
				cmd.Parameters.Add("m_userid", OracleType.Number).Value = m_userid;
				cmd.Parameters.Add("m_id", OracleType.Number).Value = m_id;
				int irec = cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec == 0)
				{
					sql = "insert into xuattam(id,mabn,maql,idkhoa,ngayvv,makp,ngayvk,chandoan,lydo,ghichu,tinhtrangra,mabs,";
					if (m_ngayra.Trim()!="") sql +="ngayra,";
					sql +="userid)";
					sql += "values (:m_id,:m_mabn,:m_maql,:m_idkhoa,to_date(:m_ngayvv,'dd/mm/yyyy hh24:mi'),:m_makp,to_date(:m_ngayvk,'dd/mm/yyyy hh24:mi'),:m_chandoan,:m_lydo,:m_ghichu,:m_tinhtrangra,:m_mabs,";
					if (m_ngayra.Trim()!="") sql +="to_date(:m_ngayra,'dd/mm/yyyy hh24:mi'),";
					sql +=":m_userid)";
					cmd = new OracleCommand(sql, con);
					cmd.CommandType = CommandType.Text;
					cmd.Parameters.Add("m_id", OracleType.Number).Value = m_id;
					cmd.Parameters.Add("m_mabn", OracleType.VarChar, 8).Value = m_mabn;
					cmd.Parameters.Add("m_maql", OracleType.Number).Value = m_maql;
					cmd.Parameters.Add("m_idkhoa", OracleType.Number).Value = m_idkhoa;
					cmd.Parameters.Add("m_ngayvv", OracleType.VarChar, 16).Value = m_ngayvv;
					cmd.Parameters.Add("m_makp", OracleType.VarChar, 2).Value = m_makp;
					cmd.Parameters.Add("m_ngayvk", OracleType.VarChar, 16).Value = m_ngayvk;
					cmd.Parameters.Add("m_chandoan", OracleType.NVarChar,254).Value = m_chandoan;
					cmd.Parameters.Add("m_lydo", OracleType.Number).Value = m_lydo;
					cmd.Parameters.Add("m_ghichu", OracleType.NVarChar,254).Value = m_ghichu;
					cmd.Parameters.Add("m_tinhtrangra", OracleType.NVarChar,254).Value = m_tinhtrangra;
					cmd.Parameters.Add("m_mabs", OracleType.VarChar, 4).Value = m_mabs;
					if (m_ngayra.Trim()!="") cmd.Parameters.Add("m_ngayra", OracleType.VarChar, 16).Value = m_ngayra;
					cmd.Parameters.Add("m_userid", OracleType.Number).Value = m_userid;
					irec = cmd.ExecuteNonQuery();
					cmd.Dispose();
					execute_data("update hiendien set xuatkhoa=1 where id="+m_idkhoa);
				}
			}
			catch (OracleException ex)
			{
				upd_error(ex.Message, sComputer, "Xuattam");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_xuattam(long m_id,long m_idkhoa,string m_ngayvao,string m_tinhtrangvao,string m_giuong,int m_idgiuong)
		{
			sql = "update xuattam set ngayvao=to_date(:m_ngayvao,'dd/mm/yyyy hh24:mi'),";
			sql += "tinhtrangvao=:m_tinhtrangvao,giuong=:m_giuong,idgiuong=:m_idgiuong ";
			sql += "where id=:m_id";
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd = new OracleCommand(sql, con);
				cmd.CommandType = CommandType.Text;
				cmd.Parameters.Add("m_ngayvao", OracleType.VarChar, 16).Value = m_ngayvao;
				cmd.Parameters.Add("m_tinhtrangvao", OracleType.NVarChar,254).Value = m_tinhtrangvao;
				cmd.Parameters.Add("m_giuong", OracleType.VarChar, 20).Value = m_giuong;
				cmd.Parameters.Add("m_idgiuong", OracleType.Number).Value = m_idgiuong;
				cmd.Parameters.Add("m_id", OracleType.Number).Value = m_id;
				cmd.ExecuteNonQuery();
				cmd.Dispose();
				execute_data("update hiendien set xuatkhoa=0 where xuatkhoa=1 and id="+m_idkhoa);
			}
			catch (OracleException ex)
			{
				upd_error(ex.Message, sComputer, "Xuattam");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_xuatkhoa(long m_id,string m_ngay,int m_ketqua,int m_ttlucrk,
			string m_chandoan,string m_maicd,string m_mabs,int m_bienchung,int m_taibien,int m_giaiphau,int m_userid)
		{
			sql="update xuatkhoa set ngay=:m_ngay,ketqua=:m_ketqua,ttlucrk=:m_ttlucrk,";
			sql+="chandoan=:m_chandoan,maicd=:m_maicd,mabs=:m_mabs,bienchung=:m_bienchung,";
			sql+="taibien=:m_taibien,giaiphau=:m_giaiphau";
			//sql+=",userid=:m_userid ";
			sql+=" where id=:m_id";
			con=new OracleConnection(sConn);

			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
			
				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_ketqua",OracleType.Number).Value=m_ketqua;
				cmd.Parameters.Add("m_ttlucrk",OracleType.Number).Value=m_ttlucrk;
				cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,254).Value=m_chandoan;
				cmd.Parameters.Add("m_maicd",OracleType.VarChar,9).Value=m_maicd;
				cmd.Parameters.Add("m_mabs",OracleType.VarChar,4).Value=m_mabs;
				cmd.Parameters.Add("m_bienchung",OracleType.Number).Value=m_bienchung;
				cmd.Parameters.Add("m_taibien",OracleType.Number).Value=m_taibien;
				cmd.Parameters.Add("m_giaiphau",OracleType.Number).Value=m_giaiphau;
				//cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into xuatkhoa(id,ngay,ketqua,ttlucrk,chandoan,maicd,mabs,bienchung,taibien,giaiphau,userid,ngayud)";
					sql+="values (:m_id,:m_ngay,:m_ketqua,:m_ttlucrk,:m_chandoan,:m_maicd,:m_mabs,:m_bienchung,:m_taibien,:m_giaiphau,:m_userid,sysdate)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_ketqua",OracleType.Number).Value=m_ketqua;
					cmd.Parameters.Add("m_ttlucrk",OracleType.Number).Value=m_ttlucrk;
					cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,254).Value=m_chandoan;
					cmd.Parameters.Add("m_maicd",OracleType.VarChar,9).Value=m_maicd;
					cmd.Parameters.Add("m_mabs",OracleType.VarChar,4).Value=m_mabs;
					cmd.Parameters.Add("m_bienchung",OracleType.Number).Value=m_bienchung;
					cmd.Parameters.Add("m_taibien",OracleType.Number).Value=m_taibien;
					cmd.Parameters.Add("m_giaiphau",OracleType.Number).Value=m_giaiphau;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"Xuatkhoa");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
				upd_hiendien(m_id,1);
			}		
			return true;
		}
		// start nam them function xuat khoa 
		public bool upd_xuatkhoa(long m_id,string m_ngay,int m_ketqua,int m_ttlucrk,
			string m_chandoan,string m_maicd,string m_mabs,int m_bienchung,int m_taibien,int m_giaiphau,int m_userid,long m_idkhoachuyen)
		{
			sql="update xuatkhoa set ngay=:m_ngay,ketqua=:m_ketqua,ttlucrk=:m_ttlucrk,";
			sql+="chandoan=:m_chandoan,maicd=:m_maicd,mabs=:m_mabs,bienchung=:m_bienchung,";
			sql+="taibien=:m_taibien,giaiphau=:m_giaiphau,idkhoachuyen=:m_idkhoachuyen";
			//sql+=",userid=:m_userid ";
			sql+=" where id=:m_id";
			con=new OracleConnection(sConn);

			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
			
				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_ketqua",OracleType.Number).Value=m_ketqua;
				cmd.Parameters.Add("m_ttlucrk",OracleType.Number).Value=m_ttlucrk;
				cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,254).Value=m_chandoan;
				cmd.Parameters.Add("m_maicd",OracleType.VarChar,9).Value=m_maicd;
				cmd.Parameters.Add("m_mabs",OracleType.VarChar,4).Value=m_mabs;
				cmd.Parameters.Add("m_bienchung",OracleType.Number).Value=m_bienchung;
				cmd.Parameters.Add("m_taibien",OracleType.Number).Value=m_taibien;
				cmd.Parameters.Add("m_giaiphau",OracleType.Number).Value=m_giaiphau;
				//cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_idkhoachuyen",OracleType.Number).Value=m_idkhoachuyen;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into xuatkhoa(id,ngay,ketqua,ttlucrk,chandoan,maicd,mabs,bienchung,taibien,giaiphau,userid,ngayud,idkhoachuyen)";
					sql+="values (:m_id,:m_ngay,:m_ketqua,:m_ttlucrk,:m_chandoan,:m_maicd,:m_mabs,:m_bienchung,:m_taibien,:m_giaiphau,:m_userid,sysdate,:m_idkhoachuyen)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_ketqua",OracleType.Number).Value=m_ketqua;
					cmd.Parameters.Add("m_ttlucrk",OracleType.Number).Value=m_ttlucrk;
					cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,254).Value=m_chandoan;
					cmd.Parameters.Add("m_maicd",OracleType.VarChar,9).Value=m_maicd;
					cmd.Parameters.Add("m_mabs",OracleType.VarChar,4).Value=m_mabs;
					cmd.Parameters.Add("m_bienchung",OracleType.Number).Value=m_bienchung;
					cmd.Parameters.Add("m_taibien",OracleType.Number).Value=m_taibien;
					cmd.Parameters.Add("m_giaiphau",OracleType.Number).Value=m_giaiphau;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					cmd.Parameters.Add("m_idkhoachuyen",OracleType.Number).Value=m_idkhoachuyen;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"Xuatkhoa");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
				upd_hiendien(m_id,1);
			}		
			return true;
		}
		// end nam


		public bool upd_xuatvien(string m_mabn,long m_maql,string m_makp,string m_ngay,int m_ketqua,int m_ttlucrv,
			string m_chandoan,string m_maicd,string m_mabs,string m_soluutru,int m_bienchung,int m_taibien,int m_giaiphau,int m_userid)
		{
			string sql="update xuatvien set makp=:m_makp,ngay=:m_ngay,";
			sql+="ketqua=:m_ketqua,ttlucrv=:m_ttlucrv,chandoan=:m_chandoan,";
			sql+="maicd=:m_maicd,mabs=:m_mabs,soluutru=:m_soluutru,bienchung=:m_bienchung,";
			sql+="taibien=:m_taibien,giaiphau=:m_giaiphau,userid=:m_userid,ngayud=sysdate";
			sql+=" where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
			
				cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_ketqua",OracleType.Number).Value=m_ketqua;
				cmd.Parameters.Add("m_ttlucrv",OracleType.Number).Value=m_ttlucrv;
				cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,254).Value=m_chandoan;
				cmd.Parameters.Add("m_maicd",OracleType.VarChar,9).Value=m_maicd;
				cmd.Parameters.Add("m_mabs",OracleType.VarChar,4).Value=m_mabs;
				cmd.Parameters.Add("m_soluutru",OracleType.NVarChar,10).Value=m_soluutru;
				cmd.Parameters.Add("m_bienchung",OracleType.Number).Value=m_bienchung;
				cmd.Parameters.Add("m_taibien",OracleType.Number).Value=m_taibien;
				cmd.Parameters.Add("m_giaiphau",OracleType.Number).Value=m_giaiphau;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into xuatvien (mabn,maql,makp,ngay,ketqua,ttlucrv,chandoan,maicd,mabs,soluutru,bienchung,taibien,giaiphau,userid,ngayud)";
					sql+=" values (:m_mabn,:m_maql,:m_makp,:m_ngay,:m_ketqua,:m_ttlucrv,:m_chandoan,:m_maicd,:m_mabs,:m_soluutru,:m_bienchung,:m_taibien,:m_giaiphau,:m_userid,sysdate)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar).Value=m_mabn;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_ketqua",OracleType.Number).Value=m_ketqua;
					cmd.Parameters.Add("m_ttlucrv",OracleType.Number).Value=m_ttlucrv;
					cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,254).Value=m_chandoan;
					cmd.Parameters.Add("m_maicd",OracleType.VarChar,9).Value=m_maicd;
					cmd.Parameters.Add("m_mabs",OracleType.VarChar,4).Value=m_mabs;
					cmd.Parameters.Add("m_soluutru",OracleType.NVarChar,10).Value=m_soluutru;
					cmd.Parameters.Add("m_bienchung",OracleType.Number).Value=m_bienchung;
					cmd.Parameters.Add("m_taibien",OracleType.Number).Value=m_taibien;
					cmd.Parameters.Add("m_giaiphau",OracleType.Number).Value=m_giaiphau;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
				con.Close();con.Dispose();
				upd_hiendien(m_maql);
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"Xuatvien");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public string get_khoaden(long m_id)
		{
			try
			{
				return get_data("select khoaden from chuyenkhoa where id="+m_id).Tables[0].Rows[0][0].ToString();
			}
			catch{return "";}
		}

		public string get_ngaykb(long m_maql)
		{
			try
			{
				return get_data("select to_char(ngay,'dd/mm/yyyy hh24:mi') from ngaykb where maql="+m_maql).Tables[0].Rows[0][0].ToString();
			}
			catch{return "";}
		}

		public string get_makp(long m_maql)
		{
			ds=get_data("select makp from benhandt where maql="+m_maql);
			return (ds.Tables[0].Rows.Count==0)?"":ds.Tables[0].Rows[0][0].ToString();
		}

		public bool get_nhapkhoa(long m_maql)
		{
			ds=get_data("select makp from nhapkhoa where maql="+m_maql);
			return ds.Tables[0].Rows.Count!=0;
		}

		public string get_tuoivao(long m_maql)
		{
			ds=get_data("select tuoivao from lienhe where maql="+m_maql);
			return (ds.Tables[0].Rows.Count==0)?"":ds.Tables[0].Rows[0][0].ToString();
		}

		public bool get_maql_ravien(long m_maql)
		{
			ds=get_data("select maql from xuatvien where maql="+m_maql);
			return ds.Tables[0].Rows.Count>0;
		}

		public long get_mavaovien(long m_maql)
		{
			ds=get_data("select distinct matiepdon from sukien where matiepdon>0 and macap="+m_maql);
			long l_mavv=(ds.Tables[0].Rows.Count==0)?0:long.Parse(ds.Tables[0].Rows[0][0].ToString());
			return l_mavv;
		}

		public long get_mavaovien(long m_maql, string mmyy)
		{
			try
			{
				sql="select distinct matiepdon from sukien where matiepdon>0 and macap="+m_maql;
				sql+=" union all ";
				sql+="select distinct matiepdon from "+user+mmyy+".sukien where macap="+m_maql;
				ds=get_data(sql);
				long l_mavv=(ds.Tables[0].Rows.Count==0)?0:long.Parse(ds.Tables[0].Rows[0][0].ToString());
				return l_mavv;
			}
			catch{return 0;}
		}

		public long get_maql(string m_mabn,string m_ngay)
		{
			ds=get_data("select maql from ngaykb where mabn='"+m_mabn+"'"+" and to_char(ngay,'dd/mm/yyyy hh24:mi')='"+m_ngay+"'");
			long l_maql=(ds.Tables[0].Rows.Count==0)?0:long.Parse(ds.Tables[0].Rows[0][0].ToString());
			return l_maql;
		}

		public string Ngayhienhanh
		{
			get{return ngayhienhanh_server.Substring(0,10);}//DateTime.Now.Day.ToString().PadLeft(2,'0')+"/"+DateTime.Now.Month.ToString().PadLeft(2,'0')+"/"+DateTime.Now.Year.ToString();}
		}

		public string ngayhienhanh_server
		{
			get
			{
				return get_data("select to_char(sysdate,'dd/mm/yyyy hh24:mi') as ngay from dual").Tables[0].Rows[0]["ngay"].ToString();
			}
		}

		public string get_ngaytiepdon(string m_mabn,string m_ngay)
		{
			try
			{
				return get_data("select to_char(ngay,'dd/mm/yyyy hh24:mi') from tiepdon where mabn='"+m_mabn+"'"+" and to_char(ngay,'dd/mm/yyyy')='"+m_ngay.Substring(0,10)+"'"+" order by ngay desc").Tables[0].Rows[0][0].ToString();
			}
			catch{return "";}
		}

		public long get_maql_tiepdon_ngay(string m_mabn,string m_ngay)
		{
			ds=get_data("select maql from tiepdon where mabn='"+m_mabn+"' and to_char(ngay,'dd/mm/yyyy')='"+m_ngay.Substring(0,10)+"'");
			long l_maql=(ds.Tables[0].Rows.Count==0)?0:long.Parse(ds.Tables[0].Rows[0][0].ToString());
			return l_maql;
		}

		public long get_maql_tiepdon_ngay_0(string m_mabn,string m_ngay)
		{
			if (!bMmyy(mmyy(m_ngay))) return 0;
			sql="select mavaovien from "+user+mmyy(m_ngay)+".tiepdon where mabn='"+m_mabn+"' and to_char(ngay,'dd/mm/yyyy')='"+m_ngay.Substring(0,10)+"' and noitiepdon=0";
			ds=get_data(sql);
			long l_maql=(ds.Tables[0].Rows.Count==0)?0:long.Parse(ds.Tables[0].Rows[0][0].ToString());
			return l_maql;
		}

		public long get_maql_tiepdon(string m_mabn,string m_makp,string m_ngay)
		{
			ds=get_data("select maql from tiepdon where mabn='"+m_mabn+"'"+" and makp='"+m_makp+"'"+" and to_char(ngay,'dd/mm/yyyy hh24:mi')='"+m_ngay+"'");
			long l_maql=(ds.Tables[0].Rows.Count==0)?0:long.Parse(ds.Tables[0].Rows[0][0].ToString());
			return l_maql;
		}

		public long get_maql(string m_mabn,string m_makp,string m_ngay)
		{
			sql="select maql from tiepdon where mabn='"+m_mabn+"'"+" and to_char(ngay,'dd/mm/yyyy hh24:mi')='"+m_ngay+"'";
			if (m_makp!="??") sql+=" and makp='"+m_makp+"'";
			ds=get_data(sql);
			long l_maql=(ds.Tables[0].Rows.Count==0)?0:long.Parse(ds.Tables[0].Rows[0][0].ToString());
			if (l_maql==0 && m_makp!="??") l_maql=getidyymmddhhmiss_stt_computer;//get_capid(1);
			return l_maql;
		}

		public long get_maql_mmyy(string m_mabn,string m_makp,string m_ngay)
		{
			if (!bMmyy(mmyy(m_ngay))) return 0;
			sql = "select maql from " + user+mmyy(m_ngay) + ".tiepdon where mabn='" + m_mabn + "'" + " and to_char(ngay,'dd/mm/yyyy hh24:mi')='" + m_ngay + "'";
			if (m_makp!="??") {sql+=" and makp='"+m_makp+"'";}
			else if (!bChuyenchiphi_PK_vao_cc) {sql+=" and makp<>'99'";}
			ds=get_data(sql);
			long l_maql=(ds.Tables[0].Rows.Count==0)?0:long.Parse(ds.Tables[0].Rows[0][0].ToString());
			if (l_maql==0 && m_makp!="??") l_maql=getidyymmddhhmiss_stt_computer;//get_capid(1);
			return l_maql;
		}

		public long get_maql_tiepdon_mmyy(string m_mabn,string m_makp,string m_ngay)
		{
			if (!bMmyy(mmyy(m_ngay))) return 0;
			ds=get_data("select maql from "+user+mmyy(m_ngay)+".tiepdon where mabn='"+m_mabn+"'"+" and makp='"+m_makp+"'"+" and to_char(ngay,'dd/mm/yyyy hh24:mi')='"+m_ngay+"'");
			long l_maql=(ds.Tables[0].Rows.Count==0)?0:long.Parse(ds.Tables[0].Rows[0][0].ToString());
			return l_maql;
		}

		public long get_maql_tiepdon_ngay_mmyy(string m_mabn,string m_ngay)
		{
			if (!bMmyy(mmyy(m_ngay))) return 0;
			ds=get_data("select maql from "+user+mmyy(m_ngay)+".tiepdon where mabn='"+m_mabn+"' and to_char(ngay,'dd/mm/yyyy')='"+m_ngay.Substring(0,10)+"'");
			long l_maql=(ds.Tables[0].Rows.Count==0)?0:long.Parse(ds.Tables[0].Rows[0][0].ToString());
			return l_maql;
		}
		public void get_maql_tiepdon_ngay_mmyy(string m_mabn,string m_ngay, ref long m_maql, ref bool m_dakham,ref bool m_dathutien)
		{
			if (!bMmyy(mmyy(m_ngay))) 
			{
				m_maql=0;m_dakham=false;m_dathutien=false;
			}
			else 
			{
				ds=get_data("select maql, done, mavaovien from "+user+mmyy(m_ngay)+".tiepdon where mabn='"+m_mabn+"' and to_char(ngay,'dd/mm/yyyy')='"+m_ngay.Substring(0,10)+"'");
				if(ds==null || ds.Tables.Count<=0 || ds.Tables[0].Rows.Count<=0)
				{
					m_maql=0;m_dakham=false;
				}
				else 
				{
					m_maql=(ds.Tables[0].Rows.Count==0)?0:long.Parse(ds.Tables[0].Rows[0][0].ToString());
					m_dakham=ds.Tables[0].Rows[0]["done"].ToString()!="";
					if(m_dakham)
					{
						if(get_data("select * from "+user+mmyy(m_ngay)+".benhandt where mavaovien="+ds.Tables[0].Rows[0]["mavaovien"].ToString()).Tables[0].Rows.Count<=0){m_dakham=false;}
					}
				}
				ds=null;
				ds=get_data("select paid from "+user+mmyy(m_ngay)+".v_chidinh where mabn='"+m_mabn+"' and maql="+m_maql+" and to_char(ngay,'dd/mm/yyyy')='"+m_ngay.Substring(0,10)+"' and loai="+iNgoaitru+" and paid=1");
				if(ds==null || ds.Tables.Count<=0 || ds.Tables[0].Rows.Count<=0)
				{
					m_dathutien=false;
				}
				else m_dathutien=ds.Tables[0].Rows[0]["paid"].ToString()!="0";
			}	 		
		}

		public void get_maql_tiepdon_ngay_mmyy(string m_mabn,string m_ngay, ref long m_maql, ref bool m_dakham,ref bool m_dathutien,string m_makp)
		{
			if (!bMmyy(mmyy(m_ngay))) 
			{
				m_maql=0;m_dakham=false;m_dathutien=false;
			}
			else 
			{
				string sa="";
				if (!bChuyenchiphi_PK_vao_cc) {sa=" and makp<>'99'";}
				ds=get_data("select maql, done, mavaovien from "+user+mmyy(m_ngay)+".tiepdon where mabn='"+m_mabn+"' "+sa+" and to_char(ngay,'dd/mm/yyyy')='"+m_ngay.Substring(0,10)+"'");
				if(ds==null || ds.Tables.Count<=0 || ds.Tables[0].Rows.Count<=0)
				{
					m_maql=0;m_dakham=false;
				}
				else 
				{
					m_maql=(ds.Tables[0].Rows.Count==0)?0:long.Parse(ds.Tables[0].Rows[0][0].ToString());
					m_dakham=ds.Tables[0].Rows[0]["done"].ToString()!="";
					if(m_dakham)
					{
						if(get_data("select * from "+user+mmyy(m_ngay)+".benhandt where makp='"+m_makp+"' and mavaovien="+ds.Tables[0].Rows[0]["mavaovien"].ToString()).Tables[0].Rows.Count<=0){m_dakham=false;}
					}
				}
				ds=null;
				ds=get_data("select paid from "+user+mmyy(m_ngay)+".v_chidinh where mabn='"+m_mabn+"' and maql="+m_maql+" and to_char(ngay,'dd/mm/yyyy')='"+m_ngay.Substring(0,10)+"' and loai="+iNgoaitru+" and paid=1");
				if(ds==null || ds.Tables.Count<=0 || ds.Tables[0].Rows.Count<=0)
				{
					m_dathutien=false;
				}
				else m_dathutien=ds.Tables[0].Rows[0]["paid"].ToString()!="0";
			}	 		
		}
		public void get_maql_tiepdon_ngay_mmyy(string m_mabn,string m_ngay, ref long m_maql, ref bool m_dakham)
		{
			if (!bMmyy(mmyy(m_ngay))) 
			{
				m_maql=0;m_dakham=false;
			}
			else 
			{
				ds=get_data("select maql, done from "+user+mmyy(m_ngay)+".tiepdon where mabn='"+m_mabn+"' and to_char(ngay,'dd/mm/yyyy')='"+m_ngay.Substring(0,10)+"'");
				if(ds==null || ds.Tables.Count<=0 || ds.Tables[0].Rows.Count<=0)
				{
					m_maql=0;m_dakham=false;
				}
				else 
				{
					m_maql=(ds.Tables[0].Rows.Count==0)?0:long.Parse(ds.Tables[0].Rows[0][0].ToString());
					m_dakham=ds.Tables[0].Rows[0]["done"].ToString()!="";
				}	
			}	 		
		}
		public long get_maql_tiepdon_mmyy(string m_mabn,string m_ngay)
		{
			if (!bMmyy(mmyy(m_ngay))) return 0;
			sql="select maql from "+user+mmyy(m_ngay)+".tiepdon where mabn='"+m_mabn+"'"+" and to_char(ngay,'dd/mm/yyyy hh24:mi')='"+m_ngay+"'";
			ds=get_data(sql);
			long l_maql=(ds.Tables[0].Rows.Count==0)?0:long.Parse(ds.Tables[0].Rows[0][0].ToString());
			if (l_maql==0) l_maql=getidyymmddhhmiss_stt_computer;//get_capid(1);
			return l_maql;
		}

		public long get_maql_tiepdon_hen(string m_mabn,string m_ngay)
		{
			sql="select maql from tiepdon where mabn='"+m_mabn+"'"+" and to_char(ngay,'dd/mm/yyyy hh24:mi')='"+m_ngay+"'";
			ds=get_data(sql);
			long l_maql=(ds.Tables[0].Rows.Count==0)?0:long.Parse(ds.Tables[0].Rows[0][0].ToString());
			if (l_maql==0) l_maql=getidyymmddhhmiss_stt_computer;//get_capid(1);
			return l_maql;
		}

		public long get_maql_tiepdon(string m_mabn,string m_ngay)
		{
			sql="select maql from tiepdon where mabn='"+m_mabn+"'"+" and to_char(ngay,'dd/mm/yyyy hh24:mi')='"+m_ngay+"'";
			ds=get_data(sql);
			long l_maql=(ds.Tables[0].Rows.Count==0)?0:long.Parse(ds.Tables[0].Rows[0][0].ToString());
			if (l_maql==0) l_maql=getidyymmddhhmiss_stt_computer;//get_capid(1);
			return l_maql;
		}

		public long get_maql(string m_mabn,string m_makp,string m_ngay,bool save)
		{
			ds=get_data("select maql from benhandt where mabn='"+m_mabn+"'"+" and makp='"+m_makp+"' and to_char(ngay,'dd/mm/yyyy hh24:mi')='"+m_ngay+"'");
			long l_maql=(ds.Tables[0].Rows.Count==0)?0:long.Parse(ds.Tables[0].Rows[0][0].ToString());
			if (l_maql==0 && save) l_maql=getidyymmddhhmiss_stt_computer;//get_capid(1);
			return l_maql;
		}

		public long get_maql(int m_loaiba,string m_mabn,string m_makp,string m_ngay,bool save)
		{
			ds=get_data("select maql from benhandt where loaiba="+m_loaiba+" and mabn='"+m_mabn+"' and to_char(ngay,'dd/mm/yyyy hh24:mi')='"+m_ngay+"'");
			long l_maql=(ds.Tables[0].Rows.Count==0)?0:long.Parse(ds.Tables[0].Rows[0][0].ToString());
			if (l_maql==0 && save) l_maql=getidyymmddhhmiss_stt_computer;//get_capid(1);
			return l_maql;
		}

		public long get_maql_mmyy(int m_loaiba,string m_mabn,string m_makp,string m_ngay,bool save)
		{
			if (!bMmyy(mmyy(m_ngay))) return 0;
			sql="select maql from "+user+mmyy(m_ngay)+".benhandt where loaiba="+m_loaiba+" and mabn='"+m_mabn+"' and to_char(ngay,'dd/mm/yyyy hh24:mi')='"+m_ngay+"'";
			if (m_makp!="??") sql+=" and makp='"+m_makp+"'";
			ds=get_data(sql);
			long l_maql=(ds.Tables[0].Rows.Count==0)?0:long.Parse(ds.Tables[0].Rows[0][0].ToString());
			if (l_maql==0 && save) l_maql=getidyymmddhhmiss_stt_computer;//get_capid(1);
			return l_maql;
		}

		public long get_maql_ngay(int m_loaiba,string m_mabn,string m_makp,string m_ngay)
		{
			if (!bMmyy(mmyy(m_ngay))) return 0;
			sql="select maql from "+user+mmyy(m_ngay)+".benhandt where loaiba="+m_loaiba+" and mabn='"+m_mabn+"' and to_char(ngay,'dd/mm/yyyy')='"+m_ngay.Substring(0,10)+"'";
			if (m_makp!="??") sql+=" and makp='"+m_makp+"'";
			ds=get_data(sql);
			long l_maql=(ds.Tables[0].Rows.Count==0)?0:long.Parse(ds.Tables[0].Rows[0][0].ToString());
			return l_maql;
		}

		public long get_maql_ngay_gio(int m_loaiba,string m_mabn,string m_makp,string m_ngay)
		{
			if (!bMmyy(mmyy(m_ngay))) return 0;
			sql="select maql from "+user+mmyy(m_ngay)+".benhandt where loaiba="+m_loaiba+" and mabn='"+m_mabn+"' and to_char(ngay,'dd/mm/yyyy hh24:mi')<>'"+m_ngay+"'";
			sql+=" and to_char(ngay,'dd/mm/yyyy')='"+m_ngay.Substring(0,10)+"'";
			if (m_makp!="??") sql+=" and makp='"+m_makp+"'";
			ds=get_data(sql);
			long l_maql=(ds.Tables[0].Rows.Count==0)?0:long.Parse(ds.Tables[0].Rows[0][0].ToString());
			return l_maql;
		}

		public long get_maql(int m_loaiba,string m_mabn,string m_ngaygio,bool save)
		{
			ds=get_data("select maql from benhandt where loaiba="+m_loaiba+" and mabn='"+m_mabn+"'"+" and to_char(ngay,'dd/mm/yyyy hh24:mi')='"+m_ngaygio+"'");
			long l_maql=(ds.Tables[0].Rows.Count==0)?0:long.Parse(ds.Tables[0].Rows[0][0].ToString());
			if (l_maql==0 && save) l_maql=getidyymmddhhmiss_stt_computer;//get_capid(1);
			return l_maql;
		}

		public long get_maql_chuyen(long maql)
		{
			ds=get_data("select maqlcu,maqlmoi from capmaql where maqlcu="+maql);
			if (ds.Tables[0].Rows.Count>0) return long.Parse(ds.Tables[0].Rows[0]["maqlmoi"].ToString());
			else
			{
				long maqlmoi=getidyymmddhhmiss_stt_computer;//get_capid(1);
				sql="insert into capmaql(maqlcu,maqlmoi) values ("+maql+","+maqlmoi+")";
				execute_data(sql);
				return maqlmoi;
			}
		}

		public string get_stt_cls_ketqua_max(string m_ngay,int i_loai)
		{
			if (!bMmyy(mmyy(m_ngay))) return "001";
			int ret = 1;
			sql = "select max(to_number(substr(idcls,7,3),'999')) as so from " + user + mmyy(m_ngay) + ".cls_ketqua where loai=" + i_loai;
			sql += " and to_char(ngay,'dd/mm/yyyy')='" + m_ngay.Substring(0, 10) + "'";
			ds = get_data(sql);
			if (ds.Tables[0].Rows[0]["so"].ToString() != "")  ret = int.Parse(ds.Tables[0].Rows[0]["so"].ToString()) + 1;
			return ret.ToString().PadLeft(3, '0');
		}

		public string get_stt_cls_ketqua(string m_ngay, int i_loai)
		{
			if (!bMmyy(mmyy(m_ngay))) return "001";
			int i = 1;
			sql = "select to_number(substr(idcls,7,3),'999') as so from " + user + mmyy(m_ngay) + ".cls_ketqua where loai=" + i_loai;
			sql += " and to_char(ngay,'dd/mm/yyyy')='" + m_ngay.Substring(0, 10) + "'";
			ds = get_data(sql);
			DataRow r;
			for (i = 1; i < 1000; i++)
			{
				r = getrowbyid(ds.Tables[0], "so=" + i);
				if (r == null) break;
			}            
			return i.ToString().PadLeft(3, '0');
		}

		public void MaskDigit_dautru(System.Windows.Forms.KeyPressEventArgs e)
		{
			if (Char.IsDigit(e.KeyChar) || e.KeyChar == 8 || e.KeyChar == '-') e.Handled = false;
			else e.Handled = true;
		}

		public long get_id_cls_ketqua(string m_mabn, string m_ngaygio, int i_loai, bool gio)
		{
			if (!bMmyy(mmyy(m_ngaygio))) return 0;
			sql = "select id from " + user + mmyy(m_ngaygio) + ".cls_ketqua where mabn='" + m_mabn + "' and loai=" + i_loai;
			if (gio) sql += " and to_char(ngay,'dd/mm/yyyy hh24:mi')='" + m_ngaygio + "'";
			else sql += " and to_char(ngay,'dd/mm/yyyy')='" + m_ngaygio.Substring(0, 10) + "'";
			ds = get_data(sql);
			long l_id = (ds.Tables[0].Rows.Count == 0) ? 0 : long.Parse(ds.Tables[0].Rows[0][0].ToString());
			return l_id;
		}

		public long get_id_cls_ketqua(string m_mabn,string m_ngaygio, int m_loai)
		{
			if (!bMmyy(mmyy(m_ngaygio))) return 0;
			ds = get_data("select id from " + user + mmyy(m_ngaygio) + ".cls_ketqua where mabn='" + m_mabn + "' and to_char(ngay,'dd/mm/yyyy hh24:mi')='" + m_ngaygio + "' and loai=" + m_loai);
			long l_id = (ds.Tables[0].Rows.Count == 0) ? 0 : long.Parse(ds.Tables[0].Rows[0][0].ToString());
			if (l_id == 0) l_id = getidyymmddhhmiss_stt_computer;//get_capid(-3);
			return l_id;
		}

		public long get_id_cls_ketqua(string m_mmyy,int m_loai,string m_idcls)
		{
			if (!bMmyy(m_mmyy)) return 0;
			ds = get_data("select id from " + user + m_mmyy + ".cls_ketqua where idcls='" + m_idcls + "' and loai=" + m_loai);
			return (ds.Tables[0].Rows.Count == 0) ? 0 : long.Parse(ds.Tables[0].Rows[0][0].ToString());
		}

		public long get_maql_benhanpk(string m_mabn, string m_ngay)
		{
			if (!bMmyy(mmyy(m_ngay))) return 0;
			ds = get_data("select maql from " + user + mmyy(m_ngay) + ".benhandt where mabn='" + m_mabn + "' and to_char(ngay,'dd/mm/yyyy hh24:mi')='" + m_ngay + "'");
			long l_maql = (ds.Tables[0].Rows.Count == 0) ? 0 : long.Parse(ds.Tables[0].Rows[0][0].ToString());
			return l_maql;
		}

		public long get_maql_benhanpk(string m_mabn, string m_ngay,string m_makp,bool save)
		{
			if (!bMmyy(mmyy(m_ngay))) return 0;
			ds = get_data("select maql from " + user+mmyy(m_ngay)+".benhandt where mabn='" + m_mabn + "' and to_char(ngay,'dd/mm/yyyy hh24:mi')='" + m_ngay + "' and makp='"+m_makp+"'");
			long l_maql = (ds.Tables[0].Rows.Count == 0) ? 0 : long.Parse(ds.Tables[0].Rows[0][0].ToString());
			if (l_maql == 0 && save) l_maql = getidyymmddhhmiss_stt_computer;//get_capid(1);
			return l_maql;
		}

		public long get_id_pttt(string m_mabn,string m_ngaygio)
		{
			ds=get_data("select id from pttt where mabn='"+m_mabn+"'"+" and to_char(ngay,'dd/mm/yyyy hh24:mi')='"+m_ngaygio+"'");
			long l_id=(ds.Tables[0].Rows.Count==0)?0:long.Parse(ds.Tables[0].Rows[0][0].ToString());
			if (l_id==0) l_id=getidyymmddhhmiss_stt_computer;//get_capid(6);
			return l_id;
		}

		public long get_id(string m_ngay,string m_table,int i)
		{
			DataSet ds=get_data("select id from	"+m_table+" where to_char(ngay,'dd/mm/yyyy')='"+m_ngay+"'");
			if (ds.Tables[0].Rows.Count>0) return long.Parse(ds.Tables[0].Rows[0][0].ToString());
			else return getidyymmddhhmiss_stt_computer;//get_capid(i);
		}

		public long get_id(long m_maql,string m_makp,string m_ngay,bool save)
		{
			ds=get_data("select id from nhapkhoa where maql="+m_maql+" and makp='"+m_makp+"'"+" and to_char(ngay,'dd/mm/yyyy')='"+m_ngay.Substring(0,10)+"'");
			long l_id=(ds.Tables[0].Rows.Count==0)?0:long.Parse(ds.Tables[0].Rows[0][0].ToString());
			if (l_id==0 && save) l_id=getidyymmddhhmiss_stt_computer;//get_capid(2);
			return l_id;
		}

		public long get_id(long m_maql,string m_makp,string m_ngaygio)
		{
			ds=get_data("select id from nhapkhoa where maql="+m_maql+" and makp='"+m_makp+"' and to_char(ngay,'dd/mm/yyyy hh24:mi')='"+m_ngaygio+"'");
			long l_id=(ds.Tables[0].Rows.Count==0)?0:long.Parse(ds.Tables[0].Rows[0][0].ToString());
			if (l_id==0) l_id=getidyymmddhhmiss_stt_computer;//get_capid(2);
			return l_id;
		}
		
		public long get_id_(long m_maql,string m_makp)
		{
			ds=get_data("select id from nhapkhoa where maql="+m_maql+" and makp='"+m_makp+"'");
			long l_id=(ds.Tables[0].Rows.Count==0)?0:long.Parse(ds.Tables[0].Rows[0][0].ToString());
			if (l_id==0) l_id=getidyymmddhhmiss_stt_computer;//get_capid(2);
			return l_id;
		}




		public long get_idxuattam(long m_idkhoa,string m_makp,string m_ngaygio,bool save)
		{
			ds=get_data("select id from xuattam where idkhoa="+m_idkhoa+" and makp='"+m_makp+"'"+" and to_char(ngayra,'dd/mm/yyyy hh24:mi')='"+m_ngaygio+"'");
			long l_id=(ds.Tables[0].Rows.Count==0)?0:long.Parse(ds.Tables[0].Rows[0][0].ToString());
			if (l_id==0 && save) l_id=getidyymmddhhmiss_stt_computer;//get_capid(2);
			return l_id;
		}

		public long get_id_cls(string m_mabn,string m_ngaygio,int i_loai,bool gio)
		{
			sql="select id from cls_thuchien where mabn='"+m_mabn+"' and loai="+i_loai;
			if (gio) sql+=" and to_char(ngay,'dd/mm/yyyy hh24:mi')='"+m_ngaygio+"'";
			else sql+=" and to_char(ngay,'dd/mm/yyyy')='"+m_ngaygio.Substring(0,10)+"'";
			ds=get_data(sql);
			long l_id=(ds.Tables[0].Rows.Count==0)?0:long.Parse(ds.Tables[0].Rows[0][0].ToString());
			return l_id;
		}

		public long get_id_cls(string m_mabn,string m_makp,string m_ngaygio,int m_loai)
		{
			ds=get_data("select id from cls_thuchien where mabn='"+m_mabn+"' and makp='"+m_makp+"'"+" and to_char(ngay,'dd/mm/yyyy hh24:mi')='"+m_ngaygio+"' and loai="+m_loai);
			long l_id=(ds.Tables[0].Rows.Count==0)?0:long.Parse(ds.Tables[0].Rows[0][0].ToString());
			if (l_id==0) l_id=getidyymmddhhmiss_stt_computer;//get_capid(-3);
			return l_id;
		}

		public bool upd_noigioithieu(long m_maql,string m_mabv,string m_chandoan,string m_maicd)
		{
			sql="update noigioithieu set mabv=:m_mabv,chandoan=:m_chandoan,maicd=:m_maicd where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
			
				cmd.Parameters.Add("m_mabv",OracleType.VarChar,8).Value=m_mabv;
				cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,254).Value=m_chandoan;
				cmd.Parameters.Add("m_maicd",OracleType.VarChar,9).Value=m_maicd;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into noigioithieu(maql,mabv,chandoan,maicd) values (:m_maql,:m_mabv,:m_chandoan,:m_maicd)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_mabv",OracleType.VarChar,8).Value=m_mabv;
					cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,254).Value=m_chandoan;
					cmd.Parameters.Add("m_maicd",OracleType.VarChar,9).Value=m_maicd;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"Noigioithieu");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}


		public bool upd_noigioithieu(long m_maql,string m_sochuyenden)
		{
			sql="update noigioithieu set sochuyenden=:m_sochuyenden where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
			
				cmd.Parameters.Add("m_sochuyenden",OracleType.NVarChar,30).Value=m_sochuyenden;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				cmd.ExecuteNonQuery();
				cmd.Dispose();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"Noigioithieu");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}


		public bool upd_cdkemtheo(long m_id,long m_maql,int m_loai,string m_chandoan,string m_maicd,int m_stt)
		{
			sql="update cdkemtheo set chandoan=:m_chandoan,maicd=:m_maicd,maql=:m_maql where id=:m_id and loai=:m_loai and stt=:m_stt";
			con=new OracleConnection(sConn);

			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
			
				cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,254).Value=m_chandoan;
				cmd.Parameters.Add("m_maicd",OracleType.VarChar,9).Value=m_maicd;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
				cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into cdkemtheo(id,maql,loai,chandoan,maicd,stt) values (:m_id,:m_maql,:m_loai,:m_chandoan,:m_maicd,:m_stt)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
					cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,254).Value=m_chandoan;
					cmd.Parameters.Add("m_maicd",OracleType.VarChar,9).Value=m_maicd;
					cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"Cdkemtheo");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_cdnguyennhan(long m_id,long m_maql,string m_chandoan,string m_maicd)
		{
			sql="update cdnguyennhan set chandoan=:m_chandoan,maicd=:m_maicd where id=:m_id";
			con=new OracleConnection(sConn);

			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
			
				cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,254).Value=m_chandoan;
				cmd.Parameters.Add("m_maicd",OracleType.VarChar,9).Value=m_maicd;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into cdnguyennhan(id,maql,chandoan,maicd) values (:m_id,:m_maql,:m_chandoan,:m_maicd)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,254).Value=m_chandoan;
					cmd.Parameters.Add("m_maicd",OracleType.VarChar,9).Value=m_maicd;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"Cdnguyennhan");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_chuyenvien(long m_maql,string m_mabv,int m_loaibv)
		{
			sql="update chuyenvien set mabv=:m_mabv,loaibv=:m_loaibv where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
			
				cmd.Parameters.Add("m_mabv",OracleType.VarChar,8).Value=m_mabv;
				cmd.Parameters.Add("m_loaibv",OracleType.Number).Value=m_loaibv;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into chuyenvien(maql,mabv,loaibv) values (:m_maql,:m_mabv,:m_loaibv)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_mabv",OracleType.VarChar,8).Value=m_mabv;
					cmd.Parameters.Add("m_loaibv",OracleType.Number).Value=m_loaibv;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"chuyenvien");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_chuyenvien(long m_maql,string m_lamsang,string m_xn,string m_chandoan,string m_thuoc,
			string m_tinhtrang,string m_lydo,string m_ngay,string m_vanchuyen,string m_nguoidua,int m_userid)
		{
			sql="update chuyenvien set lamsang=:m_lamsang,xn=:m_xn,chandoan=:m_chandoan,thuoc=:m_thuoc,";
			sql+="tinhtrang=:m_tinhtrang,lydo=:m_lydo,ngay=to_date(:m_ngay,'dd/mm/yyyy hh24:mi'),";
			sql+="vanchuyen=:m_vanchuyen,nguoidua=:m_nguoidua,userid=:m_userid";
			sql+=" where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
			
				cmd.Parameters.Add("m_lamsang",OracleType.NVarChar,1000).Value=m_lamsang;
				cmd.Parameters.Add("m_xn",OracleType.NVarChar,1000).Value=m_xn;
				cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,254).Value=m_chandoan;
				cmd.Parameters.Add("m_thuoc",OracleType.NVarChar,1000).Value=m_thuoc;
				cmd.Parameters.Add("m_tinhtrang",OracleType.NVarChar,254).Value=m_tinhtrang;
				cmd.Parameters.Add("m_lydo",OracleType.NVarChar,254).Value=m_lydo;
				cmd.Parameters.Add("m_ngay",OracleType.VarChar,16).Value=m_ngay;
				cmd.Parameters.Add("m_vanchuyen",OracleType.NVarChar,254).Value=m_vanchuyen;
				cmd.Parameters.Add("m_nguoidua",OracleType.NVarChar,254).Value=m_nguoidua;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"chuyenvien");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}		

		public bool upd_nuocngoai(string m_mabn,string m_id_nuoc)
		{
			sql="update nuocngoai set id_nuoc=:m_id_nuoc where mabn=:m_mabn";
			con=new OracleConnection(sConn);

			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_id_nuoc",OracleType.VarChar,2).Value=m_id_nuoc;
				cmd.Parameters.Add("m_mabn",OracleType.VarChar).Value=m_mabn;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into nuocngoai(mabn,id_nuoc) values (:m_mabn,:m_id_nuoc)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar).Value=m_mabn;
					cmd.Parameters.Add("m_id_nuoc",OracleType.VarChar,2).Value=m_id_nuoc;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"nuocngoai");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_quanhe(long m_maql,string m_quanhe,string m_hoten,string m_diachi,string m_dienthoai)
		{
			sql="update quanhe set quanhe=:m_quanhe,hoten=:m_hoten,diachi=:m_diachi,dienthoai=:m_dienthoai";
			sql+=" where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
			
				cmd.Parameters.Add("m_quanhe",OracleType.NVarChar,20).Value=m_quanhe;
				cmd.Parameters.Add("m_hoten",OracleType.NVarChar,50).Value=m_hoten;
				cmd.Parameters.Add("m_diachi",OracleType.NVarChar,50).Value=m_diachi;
				cmd.Parameters.Add("m_dienthoai",OracleType.VarChar,20).Value=m_dienthoai;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into quanhe (maql,quanhe,hoten,diachi,dienthoai) values (:m_maql,:m_quanhe,:m_hoten,:m_diachi,:m_dienthoai)"; 
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_quanhe",OracleType.NVarChar,20).Value=m_quanhe;
					cmd.Parameters.Add("m_hoten",OracleType.NVarChar,50).Value=m_hoten;
					cmd.Parameters.Add("m_diachi",OracleType.NVarChar,50).Value=m_diachi;
					cmd.Parameters.Add("m_dienthoai",OracleType.VarChar,20).Value=m_dienthoai;
					cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"quanhe");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_hiendien(long m_id,string m_mabn,long m_maql,string m_makp,string m_ngay,string m_noichuyen)
		{
			sql="update hiendien set makp=:m_makp,ngay=:m_ngay,noichuyen=:m_noichuyen where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_noichuyen",OracleType.VarChar,2).Value=m_noichuyen;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into hiendien(id,mabn,maql,makp,ngay,noichuyen,nhapkhoa,xuatkhoa) values (:m_id,:m_mabn,:m_maql,:m_makp,:m_ngay,:m_noichuyen,0,0)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar).Value=m_mabn;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_noichuyen",OracleType.VarChar,2).Value=m_noichuyen;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"hiendien");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		//
	
		public bool upd_hiendien(long m_id,string m_mabn,long m_maql,string m_makp,string m_ngay,string m_noichuyen,int m_nhapkhoa,int m_xuatkhoa)
		{
			sql="update hiendien set makp=:m_makp,ngay=:m_ngay,noichuyen=:m_noichuyen,";
			sql+="nhapkhoa=:m_nhapkhoa,xuatkhoa=:m_xuatkhoa where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_noichuyen",OracleType.VarChar,2).Value=m_noichuyen;
				cmd.Parameters.Add("m_nhapkhoa",OracleType.Number).Value=m_nhapkhoa;
				cmd.Parameters.Add("m_xuatkhoa",OracleType.Number).Value=m_xuatkhoa;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into hiendien(id,mabn,maql,makp,ngay,noichuyen,nhapkhoa,xuatkhoa) values (:m_id,:m_mabn,:m_maql,:m_makp,:m_ngay,:m_noichuyen,:m_nhapkhoa,:m_xuatkhoa)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar).Value=m_mabn;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_noichuyen",OracleType.VarChar,2).Value=m_noichuyen;
					cmd.Parameters.Add("m_nhapkhoa",OracleType.Number).Value=m_nhapkhoa;
					cmd.Parameters.Add("m_xuatkhoa",OracleType.Number).Value=m_xuatkhoa;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"hiendien");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public void upd_hiendien(long m_id,int m_nhapxuat)
		{
			if (m_nhapxuat==0) sql="update hiendien set nhapkhoa=1 where and nhapkhoa=0 and  id="+m_id;
			else sql="delete from hiendien where id="+m_id;
			execute_data(sql);
		}
		public void upd_hiendien_(long m_id)
		{
			sql="update hiendien set nhapkhoa=1 where  nhapkhoa=0 and  id="+m_id;
			///else sql="delete from hiendien where id="+m_id;
			execute_data(sql);
		}




		public void upd_hiendien(long m_maql)
		{
			sql="delete from hiendien where maql="+m_maql;
			execute_data(sql);
		}

		public void upd_sovaovien(long m_maql,string m_sovaovien)
		{
			sql="update benhandt set sovaovien='"+m_sovaovien+"' where maql="+m_maql;
			execute_data(sql);
		}

		public bool upd_chuyenkhoa(long m_id,string m_mabn,long m_maql,string m_makp,
			string m_ngaychuyen,string m_khoaden,string m_chandoan,string m_maicd,int m_userid,long m_idchuyenkhoa)
		{
			sql="update chuyenkhoa set mabn=:m_mabn,maql=:m_maql,makp=:m_makp,ngaychuyen=:m_ngaychuyen,khoaden=:m_khoaden,";
			sql+="chandoan=:m_chandoan,maicd=:m_maicd,userid=:m_userid,idkhoachuyen=:m_idchuyenkhoa where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_mabn",OracleType.VarChar).Value=m_mabn;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
				cmd.Parameters.Add("m_ngaychuyen",OracleType.DateTime).Value=StringToDateTime(m_ngaychuyen);
				cmd.Parameters.Add("m_khoaden",OracleType.VarChar,2).Value=m_khoaden;
				cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,254).Value=m_chandoan;
				cmd.Parameters.Add("m_maicd",OracleType.VarChar,9).Value=m_maicd;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_idchuyenkhoa",OracleType.Number).Value=m_idchuyenkhoa;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into chuyenkhoa(id,mabn,maql,makp,ngaychuyen,khoaden,chandoan,maicd,userid,ngayud,idkhoachuyen)";
					sql+=" values (:m_id,:m_mabn,:m_maql,:m_makp,:m_ngaychuyen,:m_khoaden,:m_chandoan,:m_maicd,:m_userid,sysdate,:m_idchuyenkhoa)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar).Value=m_mabn;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
					cmd.Parameters.Add("m_ngaychuyen",OracleType.DateTime).Value=StringToDateTime(m_ngaychuyen);
					cmd.Parameters.Add("m_khoaden",OracleType.VarChar,2).Value=m_khoaden;
					cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,254).Value=m_chandoan;
					cmd.Parameters.Add("m_maicd",OracleType.VarChar,9).Value=m_maicd;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					cmd.Parameters.Add("m_idchuyenkhoa",OracleType.Number).Value=m_idchuyenkhoa;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"chuyenkhoa");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}
		public bool upd_chuyenkhoa(long m_id,string m_mabn,long m_maql,string m_makp,
			string m_ngaychuyen,string m_khoaden,string m_chandoan,string m_maicd,int m_userid)
		{
			sql="update chuyenkhoa set mabn=:m_mabn,maql=:m_maql,makp=:m_makp,ngaychuyen=:m_ngaychuyen,khoaden=:m_khoaden,";
			sql+="chandoan=:m_chandoan,maicd=:m_maicd,userid=:m_userid where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_mabn",OracleType.VarChar).Value=m_mabn;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
				cmd.Parameters.Add("m_ngaychuyen",OracleType.DateTime).Value=StringToDateTime(m_ngaychuyen);
				cmd.Parameters.Add("m_khoaden",OracleType.VarChar,2).Value=m_khoaden;
				cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,254).Value=m_chandoan;
				cmd.Parameters.Add("m_maicd",OracleType.VarChar,9).Value=m_maicd;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into chuyenkhoa(id,mabn,maql,makp,ngaychuyen,khoaden,chandoan,maicd,userid,ngayud)";
					sql+=" values (:m_id,:m_mabn,:m_maql,:m_makp,:m_ngaychuyen,:m_khoaden,:m_chandoan,:m_maicd,:m_userid,sysdate)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar).Value=m_mabn;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
					cmd.Parameters.Add("m_ngaychuyen",OracleType.DateTime).Value=StringToDateTime(m_ngaychuyen);
					cmd.Parameters.Add("m_khoaden",OracleType.VarChar,2).Value=m_khoaden;
					cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,254).Value=m_chandoan;
					cmd.Parameters.Add("m_maicd",OracleType.VarChar,9).Value=m_maicd;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"chuyenkhoa");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}


		public bool upd_tuvong(long m_maql,string m_ngaynhan,string m_ngaymo,string m_chandoan,
			string m_maicd,int m_nguyennhan,int m_benhly,int m_khamtuthi,int m_userid)
		{
			if (m_ngaynhan!="")
				sql="update tuvong set ngaynhan=:m_ngaynhan,ngaymo=:m_ngaymo,chandoan=:m_chandoan,";
			else
				sql="update tuvong set chandoan=:m_chandoan,";
			sql+="maicd=:m_maicd,nguyennhan=:m_nguyennhan,benhly=:m_benhly,khamtuthi=:m_khamtuthi,userid=:m_userid where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				if (m_ngaynhan!="")
				{
					cmd.Parameters.Add("m_ngaynhan",OracleType.DateTime).Value=StringToDateTime(m_ngaynhan);
					cmd.Parameters.Add("m_ngaymo",OracleType.DateTime).Value=StringToDateTime(m_ngaymo);
				}
				cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,254).Value=m_chandoan;
				cmd.Parameters.Add("m_maicd",OracleType.VarChar,9).Value=m_maicd;
				cmd.Parameters.Add("m_nguyennhan",OracleType.Number).Value=m_nguyennhan;
				cmd.Parameters.Add("m_benhly",OracleType.Number).Value=m_benhly;
				cmd.Parameters.Add("m_khamtuthi",OracleType.Number).Value=m_khamtuthi;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					if (m_ngaynhan!="")
					{
						sql="insert into tuvong(maql,ngaynhan,ngaymo,chandoan,maicd,nguyennhan,benhly,khamtuthi,userid,ngayud)";
						sql+=" values (:m_maql,:m_ngaynhan,:m_ngaymo,:m_chandoan,:m_maicd,:m_nguyennhan,:m_benhly,:m_khamtuthi,:m_userid,sysdate)";
					}
					else
					{
						sql="insert into tuvong(maql,chandoan,maicd,nguyennhan,benhly,khamtuthi,userid,ngayud)";
						sql+=" values (:m_maql,:m_chandoan,:m_maicd,:m_nguyennhan,:m_benhly,:m_khamtuthi,:m_userid,sysdate)";
					}
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					if (m_ngaynhan!="")
					{
						cmd.Parameters.Add("m_ngaynhan",OracleType.DateTime).Value=StringToDateTime(m_ngaynhan);
						cmd.Parameters.Add("m_ngaymo",OracleType.DateTime).Value=StringToDateTime(m_ngaymo);
					}
					cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,254).Value=m_chandoan;
					cmd.Parameters.Add("m_maicd",OracleType.VarChar,9).Value=m_maicd;
					cmd.Parameters.Add("m_nguyennhan",OracleType.Number).Value=m_nguyennhan;
					cmd.Parameters.Add("m_benhly",OracleType.Number).Value=m_benhly;
					cmd.Parameters.Add("m_khamtuthi",OracleType.Number).Value=m_khamtuthi;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"tuvong "+m_maql.ToString());
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_pttt(long m_id,string m_mabn,long m_maql,string m_makp,long m_sophieu,
			string m_ngay,string m_chandoant,string m_maicdt,string m_chandoans,
			string m_maicds,string m_mapt,string m_tenpt,string m_phuongphap,
			int m_tinhhinh,string m_ptv,int m_taibien,int m_tuvong,int m_userid)
		{
			sql="update pttt set makp=:m_makp,sophieu=:m_sophieu,ngay=:m_ngay,chandoant=:m_chandoant,";
			sql+="maicdt=:m_maicdt,chandoans=:m_chandoans,maicds=:m_maicds,mapt=:m_mapt,";
			sql+="tenpt=:m_tenpt,phuongphap=:m_phuongphap,tinhhinh=:m_tinhhinh,ptv=:m_ptv,";
			sql+="taibien=:m_taibien,tuvong=:m_tuvong,userid=:m_userid where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
				cmd.Parameters.Add("m_sophieu",OracleType.Number).Value=m_sophieu;
				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_chandoant",OracleType.NVarChar,254).Value=m_chandoant;
				cmd.Parameters.Add("m_maicdt",OracleType.VarChar,9).Value=m_maicdt;
				cmd.Parameters.Add("m_chandoans",OracleType.NVarChar,254).Value=m_chandoans;
				cmd.Parameters.Add("m_maicds",OracleType.VarChar,9).Value=m_maicds;
				cmd.Parameters.Add("m_mapt",OracleType.VarChar,6).Value=m_mapt;
				cmd.Parameters.Add("m_tenpt",OracleType.NVarChar,254).Value=m_tenpt;
				cmd.Parameters.Add("m_phuongphap",OracleType.VarChar,2).Value=m_phuongphap;
				cmd.Parameters.Add("m_tinhhinh",OracleType.Number).Value=m_tinhhinh;
				cmd.Parameters.Add("m_ptv",OracleType.VarChar,4).Value=m_ptv;
				cmd.Parameters.Add("m_taibien",OracleType.Number).Value=m_taibien;
				cmd.Parameters.Add("m_tuvong",OracleType.Number).Value=m_tuvong;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into pttt(id,mabn,maql,makp,sophieu,ngay,chandoant,maicdt,chandoans,maicds,mapt,tenpt,phuongphap,tinhhinh,ptv,taibien,tuvong,userid,ngayud)";
					sql+=" values (:m_id,:m_mabn,:m_maql,:m_makp,:m_sophieu,:m_ngay,:m_chandoant,:m_maicdt,:m_chandoans,:m_maicds,:m_mapt,:m_tenpt,:m_phuongphap,:m_tinhhinh,:m_ptv,:m_taibien,:m_tuvong,:m_userid,sysdate)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar).Value=m_mabn;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
					cmd.Parameters.Add("m_sophieu",OracleType.Number).Value=m_sophieu;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_chandoant",OracleType.NVarChar,254).Value=m_chandoant;
					cmd.Parameters.Add("m_maicdt",OracleType.VarChar,9).Value=m_maicdt;
					cmd.Parameters.Add("m_chandoans",OracleType.NVarChar,254).Value=m_chandoans;
					cmd.Parameters.Add("m_maicds",OracleType.VarChar,9).Value=m_maicds;
					cmd.Parameters.Add("m_mapt",OracleType.VarChar,6).Value=m_mapt;
					cmd.Parameters.Add("m_tenpt",OracleType.NVarChar,254).Value=m_tenpt;
					cmd.Parameters.Add("m_phuongphap",OracleType.VarChar,2).Value=m_phuongphap;
					cmd.Parameters.Add("m_tinhhinh",OracleType.Number).Value=m_tinhhinh;
					cmd.Parameters.Add("m_ptv",OracleType.VarChar,4).Value=m_ptv;
					cmd.Parameters.Add("m_taibien",OracleType.Number).Value=m_taibien;
					cmd.Parameters.Add("m_tuvong",OracleType.Number).Value=m_tuvong;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"pttt "+m_id.ToString());
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_pttt(long m_id,string m_mabn,long m_maql,string m_makp,long m_sophieu,
			string m_ngay,string m_chandoant,string m_maicdt,string m_chandoans,
			string m_maicds,string m_mapt,string m_tenpt,string m_phuongphap,
			int m_tinhhinh,string m_ptv,int m_taibien,int m_tuvong,int m_userid,
			string m_mamau,string m_ngaykt,decimal m_mach,decimal m_nhietdo,string m_huyetap,
			string m_phu1,string m_phu2,string m_bsgayme,string m_ktvgayme,
			string m_hoisuc,string m_dungcu,string m_noidung,int m_loaibn,string m_mapmo,
			int m_somat,int m_molaimien,long m_idvpkhoa,long m_idduoc,long m_idkhoa,int m_mavp,
			int m_madoituong,int m_loai,int m_noisoi,int m_bienchung,long idthuchien)
		{
			sql="update pttt set makp=:m_makp,sophieu=:m_sophieu,ngay=:m_ngay,chandoant=:m_chandoant,";
			sql+="maicdt=:m_maicdt,chandoans=:m_chandoans,maicds=:m_maicds,mapt=:m_mapt,";
			sql+="tenpt=:m_tenpt,phuongphap=:m_phuongphap,tinhhinh=:m_tinhhinh,ptv=:m_ptv,";
			sql+="taibien=:m_taibien,tuvong=:m_tuvong,userid=:m_userid,";
			sql+="mamau=:m_mamau,ngaykt=:m_ngaykt,mach=:m_mach,nhietdo=:m_nhietdo,";
			sql+="huyetap=:m_huyetap,phu1=:m_phu1,phu2=:m_phu2,bsgayme=:m_bsgayme,";
			sql+="ktvgayme=:m_ktvgayme,hoisuc=:m_hoisuc,dungcu=:m_dungcu,noidung=:m_noidung,";
			sql+="loaibn=:m_loaibn,mapmo=:m_mapmo,somat=:m_somat,molaimien=:m_molaimien,";
			sql+="idvpkhoa=:m_idvpkhoa,idduoc=:m_idduoc,idkhoa=:m_idkhoa,mavp=:m_mavp,madoituong=:m_madoituong,";
			sql+="loai=:m_loai,noisoi=:m_noisoi,bienchung=:m_bienchung,idthuchien="+idthuchien+" where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
				cmd.Parameters.Add("m_sophieu",OracleType.Number).Value=m_sophieu;
				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_chandoant",OracleType.NVarChar,254).Value=m_chandoant;
				cmd.Parameters.Add("m_maicdt",OracleType.VarChar,9).Value=m_maicdt;
				cmd.Parameters.Add("m_chandoans",OracleType.NVarChar,254).Value=m_chandoans;
				cmd.Parameters.Add("m_maicds",OracleType.VarChar,9).Value=m_maicds;
				cmd.Parameters.Add("m_mapt",OracleType.VarChar,6).Value=m_mapt;
				cmd.Parameters.Add("m_tenpt",OracleType.NVarChar,254).Value=m_tenpt;
				cmd.Parameters.Add("m_phuongphap",OracleType.VarChar,2).Value=m_phuongphap;
				cmd.Parameters.Add("m_tinhhinh",OracleType.Number).Value=m_tinhhinh;
				cmd.Parameters.Add("m_ptv",OracleType.VarChar,4).Value=m_ptv;
				cmd.Parameters.Add("m_taibien",OracleType.Number).Value=m_taibien;
				cmd.Parameters.Add("m_tuvong",OracleType.Number).Value=m_tuvong;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_mamau",OracleType.VarChar,10).Value=m_mamau;
				cmd.Parameters.Add("m_ngaykt",OracleType.DateTime).Value=StringToDateTime(m_ngaykt);
				cmd.Parameters.Add("m_mach",OracleType.Number).Value=m_mach;
				cmd.Parameters.Add("m_nhietdo",OracleType.Number).Value=m_nhietdo;
				cmd.Parameters.Add("m_huyetap",OracleType.VarChar,7).Value=m_huyetap;
				cmd.Parameters.Add("m_phu1",OracleType.VarChar,4).Value=m_phu1;
				cmd.Parameters.Add("m_phu2",OracleType.VarChar,4).Value=m_phu2;
				cmd.Parameters.Add("m_bsgayme",OracleType.VarChar,4).Value=m_bsgayme;
				cmd.Parameters.Add("m_ktvgayme",OracleType.VarChar,4).Value=m_ktvgayme;
				cmd.Parameters.Add("m_hoisuc",OracleType.VarChar,4).Value=m_hoisuc;
				cmd.Parameters.Add("m_dungcu",OracleType.VarChar,4).Value=m_dungcu;
				cmd.Parameters.Add("m_noidung",OracleType.NVarChar,2000).Value=m_noidung;
				cmd.Parameters.Add("m_loaibn",OracleType.Number).Value=m_loaibn;
				cmd.Parameters.Add("m_mapmo",OracleType.VarChar,2).Value=m_mapmo;
				cmd.Parameters.Add("m_somat",OracleType.Number).Value=m_somat;
				cmd.Parameters.Add("m_molaimien",OracleType.Number).Value=m_molaimien;
				cmd.Parameters.Add("m_idvpkhoa",OracleType.Number).Value=m_idvpkhoa;
				cmd.Parameters.Add("m_idduoc",OracleType.Number).Value=m_idduoc;
				cmd.Parameters.Add("m_idkhoa",OracleType.Number).Value=m_idkhoa;
				cmd.Parameters.Add("m_mavp",OracleType.Number).Value=m_mavp;
				cmd.Parameters.Add("m_madoituong",OracleType.Number).Value=m_madoituong;
				cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
				cmd.Parameters.Add("m_noisoi",OracleType.Number).Value=m_noisoi;
				cmd.Parameters.Add("m_bienchung",OracleType.Number).Value=m_bienchung;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into pttt(id,mabn,maql,makp,sophieu,ngay,chandoant,maicdt,chandoans,maicds,mapt,tenpt,phuongphap,tinhhinh,ptv,taibien,tuvong,userid,ngayud,mamau,ngaykt,mach,nhietdo,huyetap,phu1,phu2,bsgayme,ktvgayme,hoisuc,dungcu,noidung,loaibn,mapmo,somat,molaimien,idvpkhoa,idduoc,idkhoa,mavp,madoituong,loai,noisoi,bienchung,idthuchien)";
					sql+=" values (:m_id,:m_mabn,:m_maql,:m_makp,:m_sophieu,:m_ngay,:m_chandoant,:m_maicdt,:m_chandoans,:m_maicds,:m_mapt,:m_tenpt,:m_phuongphap,:m_tinhhinh,:m_ptv,:m_taibien,:m_tuvong,:m_userid,sysdate,:m_mamau,:m_ngaykt,:m_mach,:m_nhietdo,:m_huyetap,:m_phu1,:m_phu2,:m_bsgayme,:m_ktvgayme,:m_hoisuc,:m_dungcu,:m_noidung,:m_loaibn,:m_mapmo,:m_somat,:m_molaimien,:m_idvpkhoa,:m_idduoc,:m_idkhoa,:m_mavp,:m_madoituong,:m_loai,:m_noisoi,:m_bienchung,"+idthuchien+")";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar).Value=m_mabn;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
					cmd.Parameters.Add("m_sophieu",OracleType.Number).Value=m_sophieu;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_chandoant",OracleType.NVarChar,254).Value=m_chandoant;
					cmd.Parameters.Add("m_maicdt",OracleType.VarChar,9).Value=m_maicdt;
					cmd.Parameters.Add("m_chandoans",OracleType.NVarChar,254).Value=m_chandoans;
					cmd.Parameters.Add("m_maicds",OracleType.VarChar,9).Value=m_maicds;
					cmd.Parameters.Add("m_mapt",OracleType.VarChar,6).Value=m_mapt;
					cmd.Parameters.Add("m_tenpt",OracleType.NVarChar,254).Value=m_tenpt;
					cmd.Parameters.Add("m_phuongphap",OracleType.VarChar,2).Value=m_phuongphap;
					cmd.Parameters.Add("m_tinhhinh",OracleType.Number).Value=m_tinhhinh;
					cmd.Parameters.Add("m_ptv",OracleType.VarChar,4).Value=m_ptv;
					cmd.Parameters.Add("m_taibien",OracleType.Number).Value=m_taibien;
					cmd.Parameters.Add("m_tuvong",OracleType.Number).Value=m_tuvong;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					cmd.Parameters.Add("m_mamau",OracleType.VarChar,10).Value=m_mamau;
					cmd.Parameters.Add("m_ngaykt",OracleType.DateTime).Value=StringToDateTime(m_ngaykt);
					cmd.Parameters.Add("m_mach",OracleType.Number).Value=m_mach;
					cmd.Parameters.Add("m_nhietdo",OracleType.Number).Value=m_nhietdo;
					cmd.Parameters.Add("m_huyetap",OracleType.VarChar,7).Value=m_huyetap;
					cmd.Parameters.Add("m_phu1",OracleType.VarChar,4).Value=m_phu1;
					cmd.Parameters.Add("m_phu2",OracleType.VarChar,4).Value=m_phu2;
					cmd.Parameters.Add("m_bsgayme",OracleType.VarChar,4).Value=m_bsgayme;
					cmd.Parameters.Add("m_ktvgayme",OracleType.VarChar,4).Value=m_ktvgayme;
					cmd.Parameters.Add("m_hoisuc",OracleType.VarChar,4).Value=m_hoisuc;
					cmd.Parameters.Add("m_dungcu",OracleType.VarChar,4).Value=m_dungcu;
					cmd.Parameters.Add("m_noidung",OracleType.NVarChar,2000).Value=m_noidung;
					cmd.Parameters.Add("m_loaibn",OracleType.Number).Value=m_loaibn;
					cmd.Parameters.Add("m_mapmo",OracleType.VarChar,2).Value=m_mapmo;
					cmd.Parameters.Add("m_somat",OracleType.Number).Value=m_somat;
					cmd.Parameters.Add("m_molaimien",OracleType.Number).Value=m_molaimien;
					cmd.Parameters.Add("m_idvpkhoa",OracleType.Number).Value=m_idvpkhoa;
					cmd.Parameters.Add("m_idduoc",OracleType.Number).Value=m_idduoc;
					cmd.Parameters.Add("m_idkhoa",OracleType.Number).Value=m_idkhoa;
					cmd.Parameters.Add("m_mavp",OracleType.Number).Value=m_mavp;
					cmd.Parameters.Add("m_madoituong",OracleType.Number).Value=m_madoituong;
					cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
					cmd.Parameters.Add("m_noisoi",OracleType.Number).Value=m_noisoi;
					cmd.Parameters.Add("m_bienchung",OracleType.Number).Value=m_bienchung;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"pttt "+m_id.ToString());
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_pttt_hinh(long m_id,byte[] m_image1,byte[] m_image2)
		{
			sql="update pttt_hinh set image1=:m_image1,image2=:m_image2 where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_image1",OracleType.Blob,m_image1.Length).Value=m_image1;
				cmd.Parameters.Add("m_image2",OracleType.Blob,m_image2.Length).Value=m_image2;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into pttt_hinh(id,image1,image2) values (:m_id,:m_image1,:m_image2)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_image1",OracleType.Blob,m_image1.Length).Value=m_image1;
					cmd.Parameters.Add("m_image2",OracleType.Blob,m_image2.Length).Value=m_image2;					
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"pttt_hinh");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_pttt_mau(string m_ma,string m_mapt,string m_ten,string m_mabs,string m_makp,string m_noidung,int m_userid,
			long m_mavp,decimal m_ptv,decimal m_phu1,decimal m_phu2,decimal m_bsgayme,decimal m_ktvgayme,decimal m_hoisuc,decimal m_dungcu,string m_mapm)
		{
			sql="update pttt_mau set mapt=:m_mapt,ten=:m_ten,mabs=:m_mabs,makp=:m_makp,noidung=:m_noidung,";
			sql+="userid=:m_userid,mavp=:m_mavp,";
			sql+="ptv=:m_ptv,phu1=:m_phu1,phu2=:m_phu2,bsgayme=:m_bsgayme,";
			sql+="ktvgayme=:m_ktvgayme,hoisuc=:m_hoisuc,dungcu=:m_dungcu,mapm=:m_mapm ";
			sql+=" where ma=:m_ma";
			con=new OracleConnection(sConn);

			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_mapt",OracleType.VarChar,6).Value=m_mapt;
				cmd.Parameters.Add("m_ten",OracleType.NVarChar,254).Value=m_ten;
				cmd.Parameters.Add("m_mabs",OracleType.VarChar,4).Value=m_mabs;
				cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
				cmd.Parameters.Add("m_noidung",OracleType.NVarChar,2000).Value=m_noidung;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_mavp",OracleType.Number).Value=m_mavp;
				cmd.Parameters.Add("m_ptv",OracleType.Number).Value=m_ptv;
				cmd.Parameters.Add("m_phu1",OracleType.Number).Value=m_phu1;
				cmd.Parameters.Add("m_phu2",OracleType.Number).Value=m_phu2;
				cmd.Parameters.Add("m_bsgayme",OracleType.Number).Value=m_bsgayme;
				cmd.Parameters.Add("m_ktvgayme",OracleType.Number).Value=m_ktvgayme;
				cmd.Parameters.Add("m_hoisuc",OracleType.Number).Value=m_hoisuc;
				cmd.Parameters.Add("m_dungcu",OracleType.Number).Value=m_dungcu;
				cmd.Parameters.Add("m_mapm",OracleType.VarChar,2).Value=m_mapm;
				cmd.Parameters.Add("m_ma",OracleType.VarChar,10).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into pttt_mau(ma,mapt,ten,mabs,makp,noidung,userid,mavp,ptv,phu1,phu2,bsgayme,ktvgayme,hoisuc,dungcu,mapm)";
					sql+=" values (:m_ma,:m_mapt,:m_ten,:m_mabs,:m_makp,:m_noidung,:m_userid,:m_mavp,:m_ptv,:m_phu1,:m_phu2,:m_bsgayme,:m_ktvgayme,:m_hoisuc,:m_dungcu,:m_mapm)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_ma",OracleType.VarChar,10).Value=m_ma;
					cmd.Parameters.Add("m_mapt",OracleType.VarChar,6).Value=m_mapt;
					cmd.Parameters.Add("m_ten",OracleType.NVarChar,254).Value=m_ten;
					cmd.Parameters.Add("m_mabs",OracleType.VarChar,4).Value=m_mabs;
					cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
					cmd.Parameters.Add("m_noidung",OracleType.NVarChar,2000).Value=m_noidung;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					cmd.Parameters.Add("m_mavp",OracleType.Number).Value=m_mavp;
					cmd.Parameters.Add("m_ptv",OracleType.Number).Value=m_ptv;
					cmd.Parameters.Add("m_phu1",OracleType.Number).Value=m_phu1;
					cmd.Parameters.Add("m_phu2",OracleType.Number).Value=m_phu2;
					cmd.Parameters.Add("m_bsgayme",OracleType.Number).Value=m_bsgayme;
					cmd.Parameters.Add("m_ktvgayme",OracleType.Number).Value=m_ktvgayme;
					cmd.Parameters.Add("m_hoisuc",OracleType.Number).Value=m_hoisuc;
					cmd.Parameters.Add("m_dungcu",OracleType.Number).Value=m_dungcu;
					cmd.Parameters.Add("m_mapm",OracleType.VarChar,2).Value=m_mapm;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"pttt_mau "+m_ma.ToString());
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_pttt_mau(string m_ma,byte[] m_image1,byte[] m_image2)
		{
			sql="update pttt_mau set image1=:m_image1,image2=:m_image2 where ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_image1",OracleType.Blob,m_image1.Length).Value=m_image1;
				cmd.Parameters.Add("m_image2",OracleType.Blob,m_image2.Length).Value=m_image2;
				cmd.Parameters.Add("m_ma",OracleType.VarChar,10).Value=m_ma;
				cmd.ExecuteNonQuery();
				cmd.Dispose();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"pttt_mau");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_pttt_thuoc(string m_ma,int m_mabd,decimal m_soluong,int m_manguon,int m_madoituong)
		{
			sql="update pttt_thuoc set soluong=:m_soluong,manguon=:m_manguon,madoituong=:m_madoituong";
			sql+=" where ma=:m_ma and mabd=:m_mabd";
			con=new OracleConnection(sConn);

			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_soluong",OracleType.Number).Value=m_soluong;
				cmd.Parameters.Add("m_manguon",OracleType.Number).Value=m_manguon;
				cmd.Parameters.Add("m_madoituong",OracleType.Number).Value=m_madoituong;
				cmd.Parameters.Add("m_ma",OracleType.VarChar,10).Value=m_ma;
				cmd.Parameters.Add("m_mabd",OracleType.Number).Value=m_mabd;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into pttt_thuoc(ma,mabd,soluong,manguon,madoituong)";
					sql+=" values (:m_ma,:m_mabd,:m_soluong,:m_manguon,:m_madoituong)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_ma",OracleType.VarChar,10).Value=m_ma;
					cmd.Parameters.Add("m_mabd",OracleType.Number).Value=m_mabd;
					cmd.Parameters.Add("m_soluong",OracleType.Number).Value=m_soluong;
					cmd.Parameters.Add("m_manguon",OracleType.Number).Value=m_manguon;
					cmd.Parameters.Add("m_madoituong",OracleType.Number).Value=m_madoituong;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"pttt_thuoc "+m_ma.ToString());
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public int get_lichmo(long m_id)
		{
			ds=get_data("select done from pttt_lichmo where id="+m_id);
			if (ds.Tables[0].Rows.Count==0) return 0;
			else return int.Parse(ds.Tables[0].Rows[0]["done"].ToString());
		}

		public bool upd_pttt_lichmo(long m_id,string m_mabn,long m_maql,long m_idkhoa,string m_makp,
			string m_mapmo,string m_ngay,int m_stt,string m_maicd,string m_chandoan,string m_mamau,string m_tenpt,
			string m_phuongphap,string m_ptv,string m_phu1,string m_phu2,string m_bsgayme,string m_ktvgayme,
			string m_hoisuc,string m_dungcu,string m_ngaymo,int m_noisoi,int m_userid,int m_mavp,long m_idchidinh,string m_ngaychidinh)
		{
			sql="update pttt_lichmo set makp=:m_makp,mapmo=:m_mapmo,ngay=:m_ngay,stt=:m_stt,";
			sql+="maicd=:m_maicd,chandoan=:m_chandoan,mamau=:m_mamau,tenpt=:m_tenpt,phuongphap=:m_phuongphap,ptv=:m_ptv,";
			sql+="phu1=:m_phu1,phu2=:m_phu2,bsgayme=:m_bsgayme,ktvgayme=:m_ktvgayme,hoisuc=:m_hoisuc,";
			sql+="dungcu=:m_dungcu,ngaymo=:m_ngaymo,noisoi=:m_noisoi,userid=:m_userid,mavp=:m_mavp,idchidinh=:m_idchidinh,";
			sql+="ngaychidinh=to_date(:m_ngaychidinh,'dd/mm/yyyy') where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
				cmd.Parameters.Add("m_mapmo",OracleType.VarChar,2).Value=m_mapmo;
				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
				cmd.Parameters.Add("m_maicd",OracleType.VarChar,9).Value=m_maicd;
				cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,254).Value=m_chandoan;
				cmd.Parameters.Add("m_mamau",OracleType.VarChar,10).Value=m_mamau;
				cmd.Parameters.Add("m_tenpt",OracleType.NVarChar,254).Value=m_tenpt;
				cmd.Parameters.Add("m_phuongphap",OracleType.VarChar,2).Value=m_phuongphap;
				cmd.Parameters.Add("m_ptv",OracleType.VarChar,4).Value=m_ptv;
				cmd.Parameters.Add("m_phu1",OracleType.VarChar,4).Value=m_phu1;
				cmd.Parameters.Add("m_phu2",OracleType.VarChar,4).Value=m_phu2;
				cmd.Parameters.Add("m_bsgayme",OracleType.VarChar,4).Value=m_bsgayme;
				cmd.Parameters.Add("m_ktvgayme",OracleType.VarChar,4).Value=m_ktvgayme;
				cmd.Parameters.Add("m_hoisuc",OracleType.VarChar,4).Value=m_hoisuc;
				cmd.Parameters.Add("m_dungcu",OracleType.VarChar,4).Value=m_dungcu;
				cmd.Parameters.Add("m_ngaymo",OracleType.DateTime).Value=StringToDateTime(m_ngaymo);
				cmd.Parameters.Add("m_noisoi",OracleType.Number).Value=m_noisoi;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_mavp",OracleType.Number).Value=m_mavp;
				cmd.Parameters.Add("m_idchidinh",OracleType.Number).Value=m_idchidinh;
				cmd.Parameters.Add("m_ngaychidinh",OracleType.VarChar,10).Value=m_ngaychidinh;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into pttt_lichmo(id,mabn,maql,idkhoa,makp,mapmo,ngay,stt,maicd,chandoan,mamau,tenpt,phuongphap,ptv,phu1,phu2,bsgayme,ktvgayme,hoisuc,dungcu,ngaymo,noisoi,userid,mavp,idchidinh,ngaychidinh)";
					sql+=" values (:m_id,:m_mabn,:m_maql,:m_idkhoa,:m_makp,:m_mapmo,:m_ngay,:m_stt,:m_maicd,:m_chandoan,:m_mamau,:m_tenpt,:m_phuongphap,:m_ptv,:m_phu1,:m_phu2,:m_bsgayme,:m_ktvgayme,:m_hoisuc,:m_dungcu,:m_ngaymo,:m_noisoi,:m_userid,:m_mavp,:m_idchidinh,to_date(:m_ngaychidinh,'dd/mm/yyyy'))";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar).Value=m_mabn;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_idkhoa",OracleType.Number).Value=m_idkhoa;
					cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
					cmd.Parameters.Add("m_mapmo",OracleType.VarChar,2).Value=m_mapmo;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
					cmd.Parameters.Add("m_maicd",OracleType.VarChar,9).Value=m_maicd;
					cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,254).Value=m_chandoan;
					cmd.Parameters.Add("m_mamau",OracleType.VarChar,10).Value=m_mamau;
					cmd.Parameters.Add("m_tenpt",OracleType.NVarChar,254).Value=m_tenpt;
					cmd.Parameters.Add("m_phuongphap",OracleType.VarChar,2).Value=m_phuongphap;
					cmd.Parameters.Add("m_ptv",OracleType.VarChar,4).Value=m_ptv;
					cmd.Parameters.Add("m_phu1",OracleType.VarChar,4).Value=m_phu1;
					cmd.Parameters.Add("m_phu2",OracleType.VarChar,4).Value=m_phu2;
					cmd.Parameters.Add("m_bsgayme",OracleType.VarChar,4).Value=m_bsgayme;
					cmd.Parameters.Add("m_ktvgayme",OracleType.VarChar,4).Value=m_ktvgayme;
					cmd.Parameters.Add("m_hoisuc",OracleType.VarChar,4).Value=m_hoisuc;
					cmd.Parameters.Add("m_dungcu",OracleType.VarChar,4).Value=m_dungcu;
					cmd.Parameters.Add("m_ngaymo",OracleType.DateTime).Value=StringToDateTime(m_ngaymo);
					cmd.Parameters.Add("m_noisoi",OracleType.Number).Value=m_noisoi;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					cmd.Parameters.Add("m_mavp",OracleType.Number).Value=m_mavp;
					cmd.Parameters.Add("m_idchidinh",OracleType.Number).Value=m_idchidinh;
					cmd.Parameters.Add("m_ngaychidinh",OracleType.VarChar,10).Value=m_ngaychidinh;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"pttt_lichmo");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_dmbs(string m_ma,string m_hoten,string m_makp,string m_mapk,int m_nhom,string m_viettat)
		{
			sql="update dmbs set hoten=:m_hoten,makp=:m_makp,mapk=:m_mapk,nhom=:m_nhom,viettat=:m_viettat where ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_hoten",OracleType.NVarChar,50).Value=m_hoten;
				cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
				cmd.Parameters.Add("m_mapk",OracleType.VarChar,2).Value=m_mapk;
				cmd.Parameters.Add("m_nhom",OracleType.Number).Value=m_nhom;
				cmd.Parameters.Add("m_viettat",OracleType.VarChar,10).Value=m_viettat;
				cmd.Parameters.Add("m_ma",OracleType.VarChar,4).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into dmbs(ma,hoten,makp,mapk,nhom,viettat)";
					sql+=" values (:m_ma,:m_hoten,:m_makp,:m_mapk,:m_nhom,:m_viettat)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_ma",OracleType.VarChar,4).Value=m_ma;
					cmd.Parameters.Add("m_hoten",OracleType.NVarChar,50).Value=m_hoten;
					cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
					cmd.Parameters.Add("m_mapk",OracleType.VarChar,2).Value=m_mapk;
					cmd.Parameters.Add("m_nhom",OracleType.Number).Value=m_nhom;
					cmd.Parameters.Add("m_viettat",OracleType.VarChar,10).Value=m_viettat;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"dmbs");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_dmbs(string m_ma,string m_password)
		{
			sql="update dmbs set password_=:m_password where ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_password",OracleType.VarChar,10).Value=m_password;
				cmd.Parameters.Add("m_ma",OracleType.VarChar,4).Value=m_ma;
				cmd.ExecuteNonQuery();
				cmd.Dispose();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"dmbs");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_dmbs(string m_ma,byte[] m_image)
		{
			sql="update dmbs set image=:m_image where ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_image",OracleType.Blob,m_image.Length).Value=m_image;
				cmd.Parameters.Add("m_ma",OracleType.VarChar,4).Value=m_ma;
				cmd.ExecuteNonQuery();
				cmd.Dispose();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"dmbs");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_dmmete(string m_ma,string m_ten)
		{
			sql="update dmmete set ten=:m_ten where ma=:m_ma";
			con=new OracleConnection(sConn);

			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_ten",OracleType.NVarChar,50).Value=m_ten;
				cmd.Parameters.Add("m_ma",OracleType.VarChar,2).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into dmmete(ma,ten)";
					sql+=" values (:m_ma,:m_ten)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_ma",OracleType.VarChar,2).Value=m_ma;
					cmd.Parameters.Add("m_ten",OracleType.NVarChar,50).Value=m_ten;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"dmmete");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_btdkp_bv(string m_table,string m_makp,string m_tenkp,int m_kehoach,int m_thucke,string m_makpbo,string m_maba,int m_loai,int m_mavp,string m_loaivp,string m_mucvp,string m_viettat,string m_kem)
		{
			sql="update "+m_table+" set tenkp=:m_tenkp,kehoach=:m_kehoach,thucke=:m_thucke,makpbo=:m_makpbo,maba=:m_maba,loai=:m_loai,";
			if (m_mavp!=0) sql+="mavp=:m_mavp,";
			sql+="loaivp=:m_loaivp,mucvp=:m_mucvp,viettat=:m_viettat,kem=:m_kem where makp=:m_makp";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_tenkp",OracleType.NVarChar,100).Value=m_tenkp;
				cmd.Parameters.Add("m_kehoach",OracleType.Number).Value=m_kehoach;
				cmd.Parameters.Add("m_thucke",OracleType.Number).Value=m_thucke;
				cmd.Parameters.Add("m_makpbo",OracleType.VarChar,2).Value=m_makpbo;
				cmd.Parameters.Add("m_maba",OracleType.VarChar,70).Value=m_maba;
				cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
				if (m_mavp!=0)	cmd.Parameters.Add("m_mavp",OracleType.Number).Value=m_mavp;
				cmd.Parameters.Add("m_loaivp",OracleType.VarChar,500).Value=m_loaivp;
				cmd.Parameters.Add("m_mucvp",OracleType.VarChar,4000).Value=m_mucvp;
				cmd.Parameters.Add("m_viettat",OracleType.VarChar,8).Value=m_viettat;
				cmd.Parameters.Add("m_kem",OracleType.VarChar,100).Value=m_kem;
				cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+m_table+" (makp,tenkp,kehoach,thucke,makpbo,maba,loai,";
					if (m_mavp!=0) sql+="mavp,";
					sql+="loaivp,mucvp,viettat,kem) values (:m_makp,:m_tenkp,:m_kehoach,:m_thucke,:m_makpbo,:m_maba,:m_loai,";
					if (m_mavp!=0) sql+=":m_mavp,";
					sql+=":m_loaivp,:m_mucvp,:m_viettat,:m_kem)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
					cmd.Parameters.Add("m_tenkp",OracleType.NVarChar,100).Value=m_tenkp;
					cmd.Parameters.Add("m_kehoach",OracleType.Number).Value=m_kehoach;
					cmd.Parameters.Add("m_thucke",OracleType.Number).Value=m_thucke;
					cmd.Parameters.Add("m_makpbo",OracleType.VarChar,2).Value=m_makpbo;
					cmd.Parameters.Add("m_maba",OracleType.VarChar,70).Value=m_maba;
					cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
					if (m_mavp!=0)	cmd.Parameters.Add("m_mavp",OracleType.Number).Value=m_mavp;
					cmd.Parameters.Add("m_loaivp",OracleType.VarChar,500).Value=m_loaivp;
					cmd.Parameters.Add("m_mucvp",OracleType.VarChar,4000).Value=m_mucvp;
					cmd.Parameters.Add("m_viettat",OracleType.VarChar,8).Value=m_viettat;
					cmd.Parameters.Add("m_kem",OracleType.VarChar,100).Value=m_kem;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,m_table);
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_btdnn_bv(string m_table,string m_mann,string m_tennn,string m_mannbo)
		{
			sql="update "+m_table+" set tennn=:m_tennn,mannbo=:m_mannbo where mann=:m_mann";
			con=new OracleConnection(sConn);

			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_tennn",OracleType.NVarChar,50).Value=m_tennn;
				cmd.Parameters.Add("m_mannbo",OracleType.VarChar,2).Value=m_mannbo;
				cmd.Parameters.Add("m_mann",OracleType.VarChar,2).Value=m_mann;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+m_table+" (mann,tennn,mannbo)";
					sql+=" values (:m_mann,:m_tennn,:m_mannbo)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_mann",OracleType.VarChar,2).Value=m_mann;
					cmd.Parameters.Add("m_tennn",OracleType.NVarChar,50).Value=m_tennn;
					cmd.Parameters.Add("m_mannbo",OracleType.VarChar,2).Value=m_mannbo;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,m_table);
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool get_dasuamadt(long maql,long idkhoa)
		{
			sql="select maql,idkhoa from dasuamadt where maql="+maql;
			if (idkhoa!=0) sql+=" and idkhoa="+idkhoa;
			ds=get_data(sql);
			return ds.Tables[0].Rows.Count>0;
		}

		public bool upd_dasuamadt(long m_maql,long m_idkhoa)
		{
			sql="update dasuamadt set maql=:m_maql,idkhoa=:m_idkhoa where maql=:m_maql and idkhoa=:m_idkhoa";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				cmd.Parameters.Add("m_idkhoa",OracleType.Number).Value=m_idkhoa;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into dasuamadt (maql,idkhoa) values (:m_maql,:m_idkhoa)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_idkhoa",OracleType.Number).Value=m_idkhoa;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"dasuamadt");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_dmbenhan_bv(int m_maba,string m_mavt,int m_loaiba,string m_ten,string m_tenvt,string m_tenfile)
		{
			sql="update dmbenhan_bv set mavt=:m_mavt,loaiba=:m_loaiba,ten=:m_ten,tenvt=:m_tenvt,tenfile=:m_tenfile where maba=:m_maba";
			con=new OracleConnection(sConn);

			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_mavt",OracleType.VarChar,3).Value=m_mavt;
				cmd.Parameters.Add("m_loaiba",OracleType.Number).Value=m_loaiba;
				cmd.Parameters.Add("m_ten",OracleType.NVarChar,100).Value=m_ten;
				cmd.Parameters.Add("m_tenvt",OracleType.NVarChar,50).Value=m_tenvt;
				cmd.Parameters.Add("m_tenfile",OracleType.VarChar,20).Value=m_tenfile;
				cmd.Parameters.Add("m_maba",OracleType.Number).Value=m_maba;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into dmbenhan_bv(maba,mavt,loaiba,ten,tenvt,tenfile)";
					sql+=" values (:m_maba,:m_mavt,:m_loaiba,:m_ten,:m_tenvt,:m_tenfile)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_maba",OracleType.Number).Value=m_maba;
					cmd.Parameters.Add("m_mavt",OracleType.VarChar,3).Value=m_mavt;
					cmd.Parameters.Add("m_loaiba",OracleType.Number).Value=m_loaiba;
					cmd.Parameters.Add("m_ten",OracleType.NVarChar,100).Value=m_ten;
					cmd.Parameters.Add("m_tenvt",OracleType.NVarChar,50).Value=m_tenvt;
					cmd.Parameters.Add("m_tenfile",OracleType.VarChar,20).Value=m_tenfile;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"dmbenhan_bv");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}


		public bool upd_dm11_bieu11(int m_ma, string m_stt, string m_ten)
		{
			sql="update dm_11 set ten=:m_ten, stt=:m_stt where ma=:m_ma";
			con=new OracleConnection(sConn);

			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_ten",OracleType.NVarChar,200).Value=m_ten;
				cmd.Parameters.Add("m_stt",OracleType.VarChar,3).Value=m_stt;
				cmd.Parameters.Add("m_ma",OracleType.Number,3).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into btdvt(ten, stt, ma) values (:m_ten,:m_stt,:m_ma)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_ten",OracleType.NVarChar,200).Value=m_ten;
					cmd.Parameters.Add("m_stt",OracleType.VarChar,3).Value=m_stt;
					cmd.Parameters.Add("m_ma",OracleType.Number,3).Value=m_ma;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"btdvt");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_btdvt(string m_matat,string m_daydu)
		{
			sql="update btdvt set daydu=:m_daydu where lower(trim(matat))=:m_matat";
			con=new OracleConnection(sConn);

			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_daydu",OracleType.NVarChar,100).Value=m_daydu;
				cmd.Parameters.Add("m_matat",OracleType.NVarChar,30).Value=m_matat.Trim().ToLower();
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into btdvt(matat,daydu) values (:m_matat,:m_daydu)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_matat",OracleType.NVarChar,30).Value=m_matat.Trim().ToLower();
					cmd.Parameters.Add("m_daydu",OracleType.NVarChar,100).Value=m_daydu;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"btdvt");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_tttamthan(long m_maql,string m_vanhoa)
		{
			sql="update tttamthan set vanhoa=:m_vanhoa where maql=:m_maql";
			con=new OracleConnection(sConn);

			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_vanhoa",OracleType.NVarChar,30).Value=m_vanhoa;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into tttamthan(maql,vanhoa) values (:m_maql,:m_vanhoa)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_vanhoa",OracleType.NVarChar,30).Value=m_vanhoa;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"tttamthan");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ttbong(long m_maql,string m_ngay)
		{
			sql="update ttbong set ngay=:m_ngay where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into ttbong(maql,ngay) values (:m_maql,:m_ngay)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ttbong");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_cdsankhoa(long m_maql,string m_ngay,string m_cachthucde,int m_kiemsoat,string m_mataibien)
		{
			sql="update cdsankhoa set ngay=:m_ngay,cachthucde=:m_cachthucde,kiemsoat=:m_kiemsoat,mataibien=:m_mataibien where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_cachthucde",OracleType.NVarChar,50).Value=m_cachthucde;
				cmd.Parameters.Add("m_kiemsoat",OracleType.Number).Value=m_kiemsoat;
				cmd.Parameters.Add("m_mataibien",OracleType.VarChar,10).Value=m_mataibien;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into cdsankhoa(maql,ngay,cachthucde,kiemsoat,mataibien) values (:m_maql,:m_ngay,:m_cachthucde,:m_kiemsoat,:m_mataibien)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_cachthucde",OracleType.NVarChar,50).Value=m_cachthucde;
					cmd.Parameters.Add("m_kiemsoat",OracleType.Number).Value=m_kiemsoat;
					cmd.Parameters.Add("m_mataibien",OracleType.VarChar,10).Value=m_mataibien;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"cdsankhoa");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_cdungbuou(long m_id,long m_maql,string m_t,string m_n,string m_m,string m_giaidoan,int m_nhapxuat)
		{
			if (m_nhapxuat==0)
				sql="update cdungbuou set t_v=:m_t,n_v=:m_n,m_v=:m_m,giaidoan_v=:m_giaidoan where id=:m_id";
			else
				sql="update cdungbuou set t_r=:m_t,n_r=:m_n,m_r=:m_m,giaidoan_r=:m_giaidoan where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_t",OracleType.NVarChar,50).Value=m_t;
				cmd.Parameters.Add("m_n",OracleType.NVarChar,50).Value=m_n;
				cmd.Parameters.Add("m_m",OracleType.NVarChar,50).Value=m_m;
				cmd.Parameters.Add("m_giaidoan",OracleType.NVarChar,50).Value=m_giaidoan;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					if (m_nhapxuat==0)
						sql="insert into cdungbuou(id,maql,t_v,n_v,m_v,giaidoan_v) values (:m_id,:m_maql,:m_t,:m_n,:m_m,:m_giaidoan)";
					else 
						sql="insert into cdungbuou(id,maql,t_r,n_r,m_r,giaidoan_r) values (:m_id,:m_maql,:m_t,:m_n,:m_m,:m_giaidoan)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_t",OracleType.NVarChar,50).Value=m_t;
					cmd.Parameters.Add("m_n",OracleType.NVarChar,50).Value=m_n;
					cmd.Parameters.Add("m_m",OracleType.NVarChar,50).Value=m_m;
					cmd.Parameters.Add("m_giaidoan",OracleType.NVarChar,50).Value=m_giaidoan;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"cdungbuou");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_cdungbuou(long m_id,long m_maql,string m_t_v,string m_n_v,string m_m_v,string m_giaidoan_v,string m_t_r,string m_n_r,string m_m_r,string m_giaidoan_r)
		{
			sql="update cdungbuou set t_v=:m_t_v,n_v=:m_n_v,m_v=:m_m_v,giaidoan_v=:m_giaidoan_v,";
			sql+="t_r=:m_t_r,n_r=:m_n_r,m_r=:m_m_r,giaidoan_r=:m_giaidoan_r where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_t_v",OracleType.NVarChar,50).Value=m_t_v;
				cmd.Parameters.Add("m_n_v",OracleType.NVarChar,50).Value=m_n_v;
				cmd.Parameters.Add("m_m_v",OracleType.NVarChar,50).Value=m_m_v;
				cmd.Parameters.Add("m_giaidoan_v",OracleType.NVarChar,50).Value=m_giaidoan_v;
				cmd.Parameters.Add("m_t_r",OracleType.NVarChar,50).Value=m_t_r;
				cmd.Parameters.Add("m_n_r",OracleType.NVarChar,50).Value=m_n_r;
				cmd.Parameters.Add("m_m_r",OracleType.NVarChar,50).Value=m_m_r;
				cmd.Parameters.Add("m_giaidoan_r",OracleType.NVarChar,50).Value=m_giaidoan_r;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into cdungbuou(id,maql,t_v,n_v,m_v,giaidoan_v,t_r,n_r,m_r,giaidoan_r) values ";
					sql+="(:m_id,:m_maql,:m_t_v,:m_n_v,:m_m_v,:m_giaidoan_v,:m_t_r,:m_n_r,:m_m_r,:m_giaidoan_r)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_t_v",OracleType.NVarChar,50).Value=m_t_v;
					cmd.Parameters.Add("m_n_v",OracleType.NVarChar,50).Value=m_n_v;
					cmd.Parameters.Add("m_m_v",OracleType.NVarChar,50).Value=m_m_v;
					cmd.Parameters.Add("m_giaidoan_v",OracleType.NVarChar,50).Value=m_giaidoan_v;
					cmd.Parameters.Add("m_t_r",OracleType.NVarChar,50).Value=m_t_r;
					cmd.Parameters.Add("m_n_r",OracleType.NVarChar,50).Value=m_n_r;
					cmd.Parameters.Add("m_m_r",OracleType.NVarChar,50).Value=m_m_r;
					cmd.Parameters.Add("m_giaidoan_r",OracleType.NVarChar,50).Value=m_giaidoan_r;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"cdungbuou");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_hcnhi(string m_mabn,string m_hoten_bo,string m_vanhoa_bo,string m_mann_bo,
			string m_hoten_me,string m_vanhoa_me,string m_mann_me)
		{
			sql="update hcnhi set hoten_bo=:m_hoten_bo,vanhoa_bo=:m_vanhoa_bo,mann_bo=:m_mann_bo,";
			sql+="hoten_me=:m_hoten_me,vanhoa_me=:m_vanhoa_me,mann_me=:m_mann_me where mabn=:m_mabn";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_hoten_bo",OracleType.NVarChar,50).Value=m_hoten_bo;
				cmd.Parameters.Add("m_vanhoa_bo",OracleType.NVarChar,30).Value=m_vanhoa_bo;
				cmd.Parameters.Add("m_mann_bo",OracleType.NVarChar,2).Value=m_mann_bo;
				cmd.Parameters.Add("m_hoten_me",OracleType.NVarChar,50).Value=m_hoten_me;
				cmd.Parameters.Add("m_vanhoa_me",OracleType.NVarChar,30).Value=m_vanhoa_me;
				cmd.Parameters.Add("m_mann_me",OracleType.NVarChar,2).Value=m_mann_me;
				cmd.Parameters.Add("m_mabn",OracleType.VarChar).Value=m_mabn;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into hcnhi(mabn,hoten_bo,vanhoa_bo,mann_bo,hoten_me,vanhoa_me,mann_me) values ";
					sql+="(:m_mabn,:m_hoten_bo,:m_vanhoa_bo,:m_mann_bo,:m_hoten_me,:m_vanhoa_me,:m_mann_me)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar).Value=m_mabn;
					cmd.Parameters.Add("m_hoten_bo",OracleType.NVarChar,50).Value=m_hoten_bo;
					cmd.Parameters.Add("m_vanhoa_bo",OracleType.NVarChar,30).Value=m_vanhoa_bo;
					cmd.Parameters.Add("m_mann_bo",OracleType.NVarChar,2).Value=m_mann_bo;
					cmd.Parameters.Add("m_hoten_me",OracleType.NVarChar,50).Value=m_hoten_me;
					cmd.Parameters.Add("m_vanhoa_me",OracleType.NVarChar,30).Value=m_vanhoa_me;
					cmd.Parameters.Add("m_mann_me",OracleType.NVarChar,2).Value=m_mann_me;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"hcnhi");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_hcsosinh(string m_mabn,string m_hoten_me,string m_ns_me,string m_mann_me,
			int m_delan,string m_hoten_bo,string m_ns_bo,string m_mann_bo,int m_nhommau,string m_para,string m_mame)
		{
			sql="update hcsosinh set hoten_me=:m_hoten_me,mann_me=:m_mann_me,delan=:m_delan,";
			sql+="ns_me=:m_ns_me,ns_bo=:m_ns_bo,";
			sql+="hoten_bo=:m_hoten_bo,mann_bo=:m_mann_bo,nhommau=:m_nhommau,para=:m_para";
			if (m_mame!="") sql+=",mame=:m_mame ";
			sql+=" where mabn=:m_mabn";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_hoten_me",OracleType.NVarChar,50).Value=m_hoten_me;
				cmd.Parameters.Add("m_mann_me",OracleType.NVarChar,2).Value=m_mann_me;
				cmd.Parameters.Add("m_delan",OracleType.Number).Value=m_delan;
				cmd.Parameters.Add("m_ns_me",OracleType.VarChar,4).Value=m_ns_me;
				cmd.Parameters.Add("m_ns_bo",OracleType.VarChar,4).Value=m_ns_bo;
				cmd.Parameters.Add("m_hoten_bo",OracleType.NVarChar,50).Value=m_hoten_bo;
				cmd.Parameters.Add("m_mann_bo",OracleType.NVarChar,2).Value=m_mann_bo;
				cmd.Parameters.Add("m_nhommau",OracleType.Number).Value=m_nhommau;
				cmd.Parameters.Add("m_para",OracleType.NVarChar,8).Value=m_para;
				if (m_mame!="") cmd.Parameters.Add("m_mame",OracleType.VarChar).Value=m_mame;
				cmd.Parameters.Add("m_mabn",OracleType.VarChar).Value=m_mabn;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					if (m_mame!="")
					{
						sql="insert into hcsosinh(mabn,hoten_me,mann_me,delan,ns_me,ns_bo,";
						sql+="hoten_bo,mann_bo,nhommau,para,mame) values ";
						sql+="(:m_mabn,:m_hoten_me,:m_mann_me,:m_delan,:m_ns_me,:m_ns_bo,";
						sql+=":m_hoten_bo,:m_mann_bo,:m_nhommau,:m_para,:m_mame)";
					}
					else
					{
						sql="insert into hcsosinh(mabn,hoten_me,mann_me,delan,ns_me,ns_bo,";
						sql+="hoten_bo,mann_bo,nhommau,para) values ";
						sql+="(:m_mabn,:m_hoten_me,:m_mann_me,:m_delan,:m_ns_me,:m_ns_bo,";
						sql+=":m_hoten_bo,:m_mann_bo,:m_nhommau,:m_para)";
					}
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar).Value=m_mabn;
					cmd.Parameters.Add("m_hoten_me",OracleType.NVarChar,50).Value=m_hoten_me;
					cmd.Parameters.Add("m_mann_me",OracleType.NVarChar,2).Value=m_mann_me;
					cmd.Parameters.Add("m_delan",OracleType.Number).Value=m_delan;
					cmd.Parameters.Add("m_ns_me",OracleType.VarChar,4).Value=m_ns_me;
					cmd.Parameters.Add("m_ns_bo",OracleType.VarChar,4).Value=m_ns_bo;
					cmd.Parameters.Add("m_hoten_bo",OracleType.NVarChar,50).Value=m_hoten_bo;
					cmd.Parameters.Add("m_mann_bo",OracleType.NVarChar,2).Value=m_mann_bo;
					cmd.Parameters.Add("m_nhommau",OracleType.Number).Value=m_nhommau;
					cmd.Parameters.Add("m_para",OracleType.NVarChar,8).Value=m_para;
					if (m_mame!="") cmd.Parameters.Add("m_mame",OracleType.VarChar).Value=m_mame;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"hcsosinh");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}


		public bool upd_tresosinh(long m_id_ss,long m_maql,string m_ngay,string m_ngoithai,
			int m_phai,int m_tinhtrang,int m_ditat,int m_cannang,int m_userid)
		{
			sql="update tresosinh set ngay=:m_ngay,ngoithai=:m_ngoithai,phai=:m_phai,";
			sql+="tinhtrang=:m_tinhtrang,ditat=:m_ditat,cannang=:m_cannang,userid=:m_userid where id_ss=:m_id_ss";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_ngoithai",OracleType.NVarChar,30).Value=m_ngoithai;
				cmd.Parameters.Add("m_phai",OracleType.Number).Value=m_phai;
				cmd.Parameters.Add("m_tinhtrang",OracleType.Number).Value=m_tinhtrang;
				cmd.Parameters.Add("m_ditat",OracleType.Number).Value=m_ditat;
				cmd.Parameters.Add("m_cannang",OracleType.Number).Value=m_cannang;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id_ss",OracleType.Number).Value=m_id_ss;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into tresosinh(id_ss,maql,ngay,ngoithai,phai,tinhtrang,ditat,cannang,userid,ngayud) values ";
					sql+="(:m_id_ss,:m_maql,:m_ngay,:m_ngoithai,:m_phai,:m_tinhtrang,:m_ditat,:m_cannang,:m_userid,sysdate)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id_ss",OracleType.Number).Value=m_id_ss;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_ngoithai",OracleType.NVarChar,30).Value=m_ngoithai;
					cmd.Parameters.Add("m_phai",OracleType.Number).Value=m_phai;
					cmd.Parameters.Add("m_tinhtrang",OracleType.Number).Value=m_tinhtrang;
					cmd.Parameters.Add("m_ditat",OracleType.Number).Value=m_ditat;
					cmd.Parameters.Add("m_cannang",OracleType.Number).Value=m_cannang;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"tresosinh");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ngaykb(long m_maql,string m_mabn,string m_ngay)
		{
			sql="update ngaykb set mabn=:m_mabn,ngay=:m_ngay where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_mabn",OracleType.VarChar).Value=m_mabn;
				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into ngaykb(maql,mabn,ngay) values (:m_maql,:m_mabn,:m_ngay)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar).Value=m_mabn;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ngaykb");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}
		public void updrec_11(DataTable dt,string stt,string c01,string c02,string c03,string c04,string c05,string c06,string c07,string c08,string c09,string c10,string c11,string c12)
		{
			string exp="stt='"+stt+"'";
			DataRow[] dr = dt.Select(exp);
			if (dr.Length!=0)
			{
				dr[0]["c01"] = c01;
				dr[0]["c02"] = c02;
				dr[0]["c03"] = c03;
				dr[0]["c04"] = c04;
				dr[0]["c05"] = c05;
				dr[0]["c06"] = c06;
				dr[0]["c07"] = c07;
				dr[0]["c08"] = c08;
				dr[0]["c09"] = c09;
				dr[0]["c10"] = c10;
				dr[0]["c11"] = c11;
				dr[0]["c12"] = c12;
			}
		}

		public void updrec_11_18(DataTable dt,string stt,string c01,string c02,string c03,string c04,string c05,string c06,string c07,string c08,string c09,string c10,string c11,string c12,string c041,string c051,string c15,string c16,string c17,string c18)
		{
			string exp="stt='"+stt+"'";
			DataRow[] dr = dt.Select(exp);
			if (dr.Length!=0)
			{
				dr[0]["c01"] = c01;
				dr[0]["c02"] = c02;
				dr[0]["c03"] = c03;
				dr[0]["c04"] = c04;
				dr[0]["c05"] = c05;
				dr[0]["c06"] = c06;
				dr[0]["c07"] = c07;
				dr[0]["c08"] = c08;
				dr[0]["c09"] = c09;
				dr[0]["c10"] = c10;
				dr[0]["c11"] = c11;
				dr[0]["c12"] = c12;
				dr[0]["c041"] = c041;
				dr[0]["c051"] = c051;
				dr[0]["c15"] = c15;
				dr[0]["c16"] = c16;
				dr[0]["c17"] = c17;
				dr[0]["c18"] = c18;
			}
		}
		public void updrec_01 (DataTable dt,string stt,int col,long so)
		{
			long l=0;
			DataRow[] dr = dt.Select("stt='"+stt+"'");
			if (dr.Length!=0) dr[0][col] = so;
			dr = dt.Select("stt='B'");
			if (dr.Length!=0) l+=long.Parse(dr[0][col].ToString());
			dr = dt.Select("stt='C'");
			if (dr.Length!=0) l+=long.Parse(dr[0][col].ToString());
			dr = dt.Select("stt='D'");
			if (dr.Length!=0) l+=long.Parse(dr[0][col].ToString());
			dr = dt.Select("stt='A'");
			if (dr.Length!=0) dr[0][col]= l;
		}

		public void updrec_05 (DataTable dt,string stt,int col,Decimal so)
		{
			//Decimal l=0;
			DataRow[] dr = dt.Select("stt='"+stt+"'");
			if (dr.Length!=0) dr[0][col] = so;
			//			dr = dt.Select("stt='B'");
			//			if (dr.Length!=0) l+=Decimal.Parse(dr[0][col].ToString());
			//			dr = dt.Select("stt='C'");
			//			if (dr.Length!=0) l+=Decimal.Parse(dr[0][col].ToString());
			//			dr = dt.Select("stt='A'");
			//			if (dr.Length!=0) dr[0][col]= l;
		}

		public void updrec_06 (DataTable dt,string stt,int col,Decimal so)
		{
			Decimal l=0;
			DataRow[] dr = dt.Select("stt='"+stt+"'");
			if (dr.Length!=0) dr[0][col] = so;
			dr = dt.Select("stt='B'");
			if (dr.Length!=0) l+=Decimal.Parse(dr[0][col].ToString());
			dr = dt.Select("stt='C'");
			if (dr.Length!=0) l+=Decimal.Parse(dr[0][col].ToString());
			dr = dt.Select("stt='E'");
			if (dr.Length!=0) l+=Decimal.Parse(dr[0][col].ToString());
			dr = dt.Select("stt='F'");
			if (dr.Length!=0) l+=Decimal.Parse(dr[0][col].ToString());
			dr = dt.Select("stt='A'");
			if (dr.Length!=0) dr[0][col]= l;
		}

		#region vudieutri
		/// <summary>
		/// 
		/// </summary>
		/// 
		public int get_stt(DataTable dt)
		{
			try
			{
				if (dt.Rows.Count==0) return 1;
				else return int.Parse(dt.Rows[dt.Rows.Count-1]["stt"].ToString())+1;
			}
			catch{return 1;}
		}

		public void updrec_bieu(DataTable dt,long ma,string ten,long so)
		{//bbbb
			string exp="ma="+ma;
			DataRow r = getrowbyid (dt,exp); 
			if ( r == null )
			{
				DataRow nrow = dt.NewRow ( ) ;
				nrow["ma"] =ma;
				nrow["stt"]=get_stt(dt);
				nrow["ten"]=ten;
				for(int i=1;i<=so;i++) nrow["c"+i.ToString().PadLeft(2,'0')]=0;
				dt.Rows.Add ( nrow ) ;
			}
			else r["ten"]=ten;
		}

		public bool upd_dm01(int m_ma,string m_stt,string m_ten,string m_loai,int m_kp,int m_matk)
		{
			sql="update dm_01 set stt=:m_stt,ten=:m_ten,loai=:m_loai,kp=:m_kp,matk=:m_matk where ma=:m_ma";
			con=new OracleConnection(sConn);

			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_stt",OracleType.VarChar,2).Value=m_stt;
				cmd.Parameters.Add("m_ten",OracleType.NVarChar,100).Value=m_ten;
				cmd.Parameters.Add("m_loai",OracleType.VarChar,1).Value=m_loai;
				cmd.Parameters.Add("m_kp",OracleType.Number).Value=m_kp;
				cmd.Parameters.Add("m_matk",OracleType.Number).Value=m_matk;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into dm_01(ma,stt,ten,loai,kp,matk,c01,c02,c03,c04,c05,c06,c07,c08,c09,c10,c11,c12,c13,c14,c15,c16,c17,c18,c19,c20,c21,c22,c23) values ";
					sql+="(:m_ma,:m_stt,:m_ten,:m_loai,:m_kp,:m_matk,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_stt",OracleType.VarChar,2).Value=m_stt;
					cmd.Parameters.Add("m_ten",OracleType.NVarChar,100).Value=m_ten;
					cmd.Parameters.Add("m_loai",OracleType.VarChar,1).Value=m_loai;
					cmd.Parameters.Add("m_kp",OracleType.Number).Value=m_kp;
					cmd.Parameters.Add("m_matk",OracleType.Number).Value=m_matk;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"dm_01");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}
		//Thuy 20.03.2012
		public bool upd_dm031(int m_ma,string m_stt,string m_ten)
		{
			sql="update dm_031 set stt=:m_stt,ten=:m_ten where ma=:m_ma";
			con=new OracleConnection(sConn);

			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_stt",OracleType.VarChar,2).Value=m_stt;
				cmd.Parameters.Add("m_ten",OracleType.NVarChar,100).Value=m_ten;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into dm_031(ma,stt,ten,c01,c02,c03,c04,c05,c06,c07,c08,c09,c10,c11) values ";
					sql+="(:m_ma,:m_stt,:m_ten,0,0,0,0,0,0,0,0,0,0,0)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_stt",OracleType.VarChar,2).Value=m_stt;
					cmd.Parameters.Add("m_ten",OracleType.NVarChar,100).Value=m_ten;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"dm_031");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		 
		}

		public bool upd_bieu01(long m_id,int m_ma,string m_ngay,int m_c01,int m_c02,int m_c03,int m_c04,int m_c05,int m_c06,int m_c07,int m_c08,int m_c09,int m_c10,int m_c11,int m_c12,int m_c13,int m_c14,int m_c15,int m_c16,int m_c17,int m_c18,int m_c19,int m_c20,int m_c21,int m_c22,int m_c23,int m_userid)
		{
			sql="update bieu_01 set ngay=:m_ngay,c01=:m_c01,c02=:m_c02,c03=:m_c03,c04=:m_c04,";
			sql+="c05=:m_c05,c06=:m_c06,c07=:m_c07,c08=:m_c08,c09=:m_c09,c10=:m_c10,";
			sql+="c11=:m_c11,c12=:m_c12,c13=:m_c13,c14=:m_c14,c15=:m_c15,";
			sql+="c16=:m_c16,c17=:m_c17,c18=:m_c18,c19=:m_c19,c20=:m_c20,c21=:m_c21,";
			sql+="c22=:m_c22,c23=:m_c23,userid=:m_userid where id=:m_id and ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
				cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
				cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
				cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
				cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
				cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
				cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
				cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
				cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
				cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
				cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
				cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
				cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
				cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
				cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
				cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
				cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
				cmd.Parameters.Add("m_c18",OracleType.Number).Value=m_c18;
				cmd.Parameters.Add("m_c19",OracleType.Number).Value=m_c19;
				cmd.Parameters.Add("m_c20",OracleType.Number).Value=m_c20;
				cmd.Parameters.Add("m_c21",OracleType.Number).Value=m_c21;
				cmd.Parameters.Add("m_c22",OracleType.Number).Value=m_c22;
				cmd.Parameters.Add("m_c23",OracleType.Number).Value=m_c23;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into bieu_01(id,ma,ngay,c01,c02,c03,c04,c05,c06,c07,c08,c09,c10,c11,c12,c13,c14,c15,c16,c17,c18,c19,c20,c21,c22,c23,userid,ngayud) values ";
					sql+="(:m_id,:m_ma,:m_ngay,:m_c01,:m_c02,:m_c03,:m_c04,:m_c05,:m_c06,:m_c07,:m_c08,:m_c09,:m_c10,:m_c11,:m_c12,:m_c13,:m_c14,:m_c15,:m_c16,:m_c17,:m_c18,:m_c19,:m_c20,:m_c21,:m_c22,:m_c23,:m_userid,sysdate)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
					cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
					cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
					cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
					cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
					cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
					cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
					cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
					cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
					cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
					cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
					cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
					cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
					cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
					cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
					cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
					cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
					cmd.Parameters.Add("m_c18",OracleType.Number).Value=m_c18;
					cmd.Parameters.Add("m_c19",OracleType.Number).Value=m_c19;
					cmd.Parameters.Add("m_c20",OracleType.Number).Value=m_c20;
					cmd.Parameters.Add("m_c21",OracleType.Number).Value=m_c21;
					cmd.Parameters.Add("m_c22",OracleType.Number).Value=m_c22;
					cmd.Parameters.Add("m_c23",OracleType.Number).Value=m_c23;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"bieu_01");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public void updrec_145 (DataTable dt,int stt,int col,Decimal so)
		{
			DataRow[] dr = dt.Select("ma="+stt);
			dr[0][col] = so;
		}

		public void updrec_02 (DataTable dt,string stt,int col,Decimal so)
		{
			DataRow[] dr = dt.Select("stt='"+stt+"'");
			if(dr.Length>0)dr[0][col] = so;
		}

		public void updrec_021 (DataTable dt,decimal s_ma,decimal s_tuyen,int col,long so)
		{
			DataRow[] dr = dt.Select("ma='"+s_ma+"' and tuyen='"+s_tuyen+"'");
			if(dr.Length>0)dr[0][col] = so;
		}

		public void updrec_07 (DataTable dt,int ma,int col,long so)
		{
			DataRow[] dr = dt.Select("ma="+ma);
			dr[0][col] = so;
		}

		public bool upd_bieu02(long m_id,int m_ma,string m_ngay,int m_c01,int m_c02,
			int m_c03,int m_c04,int m_c05,int m_c06,int m_c07,int m_c08,int m_c09,int m_userid)
		{
			sql="update bieu_02 set ngay=:m_ngay,c01=:m_c01,c02=:m_c02,c03=:m_c03,c04=:m_c04,";
			sql+="c05=:m_c05,c06=:m_c06,c07=:m_c07,c08=:m_c08,c09=:m_c09,";
			sql+="userid=:m_userid where id=:m_id and ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
				cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
				cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
				cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
				cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
				cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
				cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
				cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
				cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into bieu_02(id,ma,ngay,c01,c02,c03,c04,c05,c06,c07,c08,c09,userid,ngayud) values ";
					sql+="(:m_id,:m_ma,:m_ngay,:m_c01,:m_c02,:m_c03,:m_c04,:m_c05,:m_c06,:m_c07,:m_c08,:m_c09,:m_userid,sysdate)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
					cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
					cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
					cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
					cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
					cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
					cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
					cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
					cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"bieu_02");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_bieu031(long m_id,int m_ma,string m_ngay,int m_c01,int m_c02,
			int m_c03,int m_c04,int m_c05,int m_c06,int m_c07,int m_c08,int m_c09,
			int m_c10,int m_c11,int m_userid)
		{
			sql="update bieu_031 set ngay=:m_ngay,c01=:m_c01,c02=:m_c02,c03=:m_c03,c04=:m_c04,";
			sql+="c05=:m_c05,c06=:m_c06,c07=:m_c07,c08=:m_c08,c09=:m_c09,c10=:m_c10,c11=:m_c11,";
			sql+="userid=:m_userid where id=:m_id and ma=:m_ma";
			con=new OracleConnection(sConn);

			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
				cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
				cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
				cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
				cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
				cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
				cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
				cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
				cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
				cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
				cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into bieu_031(id,ma,ngay,c01,c02,c03,c04,c05,c06,c07,c08,c09,c10,c11,userid,ngayud) values ";
					sql+="(:m_id,:m_ma,:m_ngay,:m_c01,:m_c02,:m_c03,:m_c04,:m_c05,:m_c06,:m_c07,:m_c08,:m_c09,:m_c10,:m_c11,:m_userid,sysdate)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
					cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
					cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
					cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
					cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
					cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
					cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
					cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
					cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
					cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
					cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"bieu_031");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_bieu04(long m_id,int m_ma,string m_ngay,int m_c01,int m_c02,
			int m_c03,int m_c04,int m_c05,int m_c06,int m_c07,int m_c08,int m_c09,
			int m_c10,int m_userid)
		{
			sql="update bieu_04 set ngay=:m_ngay,c01=:m_c01,c02=:m_c02,c03=:m_c03,c04=:m_c04,";
			sql+="c05=:m_c05,c06=:m_c06,c07=:m_c07,c08=:m_c08,c09=:m_c09,c10=:m_c10,";
			sql+="userid=:m_userid where id=:m_id and ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
				cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
				cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
				cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
				cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
				cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
				cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
				cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
				cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
				cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into bieu_04(id,ma,ngay,c01,c02,c03,c04,c05,c06,c07,c08,c09,c10,userid,ngayud) values ";
					sql+="(:m_id,:m_ma,:m_ngay,:m_c01,:m_c02,:m_c03,:m_c04,:m_c05,:m_c06,:m_c07,:m_c08,:m_c09,:m_c10,:m_userid,sysdate)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
					cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
					cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
					cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
					cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
					cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
					cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
					cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
					cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
					cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"bieu_04");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_bieu05(long m_id,int m_ma,string m_ngay,int m_soluong,int m_userid)
		{
			sql="update bieu_05 set ngay=:m_ngay,soluong=:m_soluong,";
			sql+="userid=:m_userid where id=:m_id and ma=:m_ma";
			con=new OracleConnection(sConn);

			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_soluong",OracleType.Number).Value=m_soluong;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into bieu_05(id,ma,ngay,soluong,userid,ngayud) values ";
					sql+="(:m_id,:m_ma,:m_ngay,:m_soluong,:m_userid,sysdate)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_soluong",OracleType.Number).Value=m_soluong;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"bieu_05");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_bieu06(long m_id,int m_ma,string m_ngay,int m_c01,int m_c02,int m_userid)
		{
			sql="update bieu_06 set ngay=:m_ngay,c01=:m_c01,c02=:m_c02,";
			sql+="userid=:m_userid where id=:m_id and ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
				cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into bieu_06(id,ma,ngay,c01,c02,userid,ngayud) values ";
					sql+="(:m_id,:m_ma,:m_ngay,:m_c01,:m_c02,:m_userid,sysdate)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
					cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"bieu_06");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}


		public bool upd_bieu07(long m_id,int m_ma,string m_ngay,Decimal m_soluong,int m_userid)
		{
			sql="update bieu_07 set ngay=:m_ngay,soluong=:m_soluong,";
			sql+="userid=:m_userid where id=:m_id and ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_soluong",OracleType.Number).Value=m_soluong;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into bieu_07(id,ma,ngay,soluong,userid,ngayud) values ";
					sql+="(:m_id,:m_ma,:m_ngay,:m_soluong,:m_userid,sysdate)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_soluong",OracleType.Number).Value=m_soluong;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"bieu_07");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_bieu08(long m_id,int m_ma,string m_ngay,int m_c01,int m_c02,
			int m_c03,int m_c04,int m_c05,int m_c06,int m_c07,int m_userid)
		{
			sql="update bieu_08 set ngay=:m_ngay,c01=:m_c01,c02=:m_c02,c03=:m_c03,c04=:m_c04,";
			sql+="c05=:m_c05,c06=:m_c06,c07=:m_c07,";
			sql+="userid=:m_userid where id=:m_id and ma=:m_ma";
			con=new OracleConnection(sConn);

			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
				cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
				cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
				cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
				cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
				cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
				cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into bieu_08(id,ma,ngay,c01,c02,c03,c04,c05,c06,c07,userid,ngayud) values ";
					sql+="(:m_id,:m_ma,:m_ngay,:m_c01,:m_c02,:m_c03,:m_c04,:m_c05,:m_c06,:m_c07,:m_userid,sysdate)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
					cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
					cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
					cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
					cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
					cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
					cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"bieu_08");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_bieu091(long m_id,int m_ma,string m_ngay,int m_tongso,int m_userid)
		{
			sql="update bieu_091 set ngay=:m_ngay,tongso=:m_tongso,";
			sql+="userid=:m_userid where id=:m_id and ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_tongso",OracleType.Number).Value=m_tongso;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into bieu_091(id,ma,ngay,tongso,userid,ngayud) values ";
					sql+="(:m_id,:m_ma,:m_ngay,:m_tongso,:m_userid,sysdate)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_tongso",OracleType.Number).Value=m_tongso;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"bieu_091");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_bieu092(long m_id,int m_ma,string m_ngay,string m_ten,Decimal m_c01,int m_c02,
			int m_c03,int m_c04,int m_userid)
		{
			sql="update bieu_092 set ngay=:m_ngay,ten=:m_ten,c01=:m_c01,c02=:m_c02,c03=:m_c03,c04=:m_c04,";
			sql+="userid=:m_userid where id=:m_id and ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_ten",OracleType.NVarChar).Value=m_ten;
				cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
				cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
				cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
				cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into bieu_092(id,ma,ngay,ten,c01,c02,c03,c04,userid,ngayud) values ";
					sql+="(:m_id,:m_ma,:m_ngay,:m_ten,:m_c01,:m_c02,:m_c03,:m_c04,:m_userid,sysdate)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_ten",OracleType.NVarChar).Value=m_ten;
					cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
					cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
					cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
					cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"bieu_092");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_bieu11(long m_id,int m_ma,string m_ngay,int m_c01,int m_c02,
			int m_c03,int m_c04,int m_c05,int m_c06,int m_c07,int m_c08,int m_c09,
			int m_c10,int m_c11,int m_c12,int m_userid)
		{
			sql="update bieu_11 set ngay=:m_ngay,c01=:m_c01,c02=:m_c02,c03=:m_c03,c04=:m_c04,";
			sql+="c05=:m_c05,c06=:m_c06,c07=:m_c07,c08=:m_c08,c09=:m_c09,c10=:m_c10,c11=:m_c11,";
			sql+="c12=:m_c12,userid=:m_userid where id=:m_id and ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
				cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
				cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
				cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
				cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
				cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
				cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
				cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
				cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
				cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
				cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
				cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into bieu_11(id,ma,ngay,c01,c02,c03,c04,c05,c06,c07,c08,c09,c10,c11,c12,userid,ngayud) values ";
					sql+="(:m_id,:m_ma,:m_ngay,:m_c01,:m_c02,:m_c03,:m_c04,:m_c05,:m_c06,:m_c07,:m_c08,:m_c09,:m_c10,:m_c11,:m_c12,:m_userid,sysdate)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
					cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
					cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
					cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
					cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
					cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
					cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
					cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
					cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
					cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
					cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
					cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"bieu_11");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_bieu11_18(long m_id,int m_ma,string m_ngay,int m_c01,int m_c02,
			int m_c03,int m_c04,int m_c05,int m_c06,int m_c07,int m_c08,int m_c09,
			int m_c10,int m_c11,int m_c12,int m_userid,int m_c041,int m_c051,int m_c15,int m_c16,int m_c17,int m_c18)
		{
			sql="update bieu_11 set ngay=:m_ngay,c01=:m_c01,c02=:m_c02,c03=:m_c03,c04=:m_c04,";
			sql+="c05=:m_c05,c06=:m_c06,c07=:m_c07,c08=:m_c08,c09=:m_c09,c10=:m_c10,c11=:m_c11,";
			sql+="c12=:m_c12,c041=:m_c041,c051=:m_c051,c15=:m_c15,c16=:m_c16,c17=:m_c17,c18=:m_c18,userid=:m_userid where id=:m_id and ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
				cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
				cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
				cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
				cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
				cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
				cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
				cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
				cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
				cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
				cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
				cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
				cmd.Parameters.Add("m_c041",OracleType.Number).Value=m_c041;
				cmd.Parameters.Add("m_c051",OracleType.Number).Value=m_c051;
				cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
				cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
				cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
				cmd.Parameters.Add("m_c18",OracleType.Number).Value=m_c18;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into bieu_11(id,ma,ngay,c01,c02,c03,c04,c05,c06,c07,c08,c09,c10,c11,c12,c041,c051,c15,c16,c17,c18,userid,ngayud) values ";
					sql+="(:m_id,:m_ma,:m_ngay,:m_c01,:m_c02,:m_c03,:m_c04,:m_c05,:m_c06,:m_c07,:m_c08,:m_c09,:m_c10,:m_c11,:m_c12,:m_c041,:m_c051,:m_c15,:m_c16,:m_c17,:m_c18,:m_userid,sysdate)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
					cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
					cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
					cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
					cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
					cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
					cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
					cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
					cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
					cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
					cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
					cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
					cmd.Parameters.Add("m_c041",OracleType.Number).Value=m_c041;
					cmd.Parameters.Add("m_c051",OracleType.Number).Value=m_c051;
					cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
					cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
					cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
					cmd.Parameters.Add("m_c18",OracleType.Number).Value=m_c18;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"bieu_11_18");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_bieu101(long m_id,int m_ma,string m_ngay,Decimal m_sotien,int m_userid)
		{
			sql="update bieu_101 set ngay=:m_ngay,sotien=:m_sotien,";
			sql+="userid=:m_userid where id=:m_id and ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_sotien",OracleType.Number).Value=m_sotien;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into bieu_101(id,ma,ngay,sotien,userid,ngayud) values ";
					sql+="(:m_id,:m_ma,:m_ngay,:m_sotien,:m_userid,sysdate)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_sotien",OracleType.Number).Value=m_sotien;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"bieu_101");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}


		public bool upd_bieu1021(long m_id,int m_ma,string m_ngay,Decimal m_vienphi,Decimal m_bhyt,int m_userid)
		{
			sql="update bieu_1021 set ngay=:m_ngay,vienphi=:m_vienphi,";
			sql+="bhyt=:m_bhyt,userid=:m_userid where id=:m_id and ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_vienphi",OracleType.Number).Value=m_vienphi;
				cmd.Parameters.Add("m_bhyt",OracleType.Number).Value=m_bhyt;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into bieu_1021(id,ma,ngay,vienphi,bhyt,userid,ngayud) values ";
					sql+="(:m_id,:m_ma,:m_ngay,:m_vienphi,:m_bhyt,:m_userid,sysdate)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_vienphi",OracleType.Number).Value=m_vienphi;
					cmd.Parameters.Add("m_bhyt",OracleType.Number).Value=m_bhyt;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"bieu_1021");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_bieu1022(long m_id,int m_ma,string m_ngay,Decimal m_sotien,int m_userid)
		{
			sql="update bieu_1022 set ngay=:m_ngay,sotien=:m_sotien,";
			sql+="userid=:m_userid where id=:m_id and ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_sotien",OracleType.Number).Value=m_sotien;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into bieu_1022(id,ma,ngay,sotien,userid,ngayud) values ";
					sql+="(:m_id,:m_ma,:m_ngay,:m_sotien,:m_userid,sysdate)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_sotien",OracleType.Number).Value=m_sotien;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"bieu_1022");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_bieu103(long m_id,int m_ma,string m_ngay,Decimal m_c01,Decimal m_c02,
			Decimal m_c03,Decimal m_c04,Decimal m_c05,Decimal m_c06,int m_userid)
		{
			sql="update bieu_103 set ngay=:m_ngay,c01=:m_c01,c02=:m_c02,c03=:m_c03,c04=:m_c04,";
			sql+="c05=:m_c05,c06=:m_c06,";
			sql+="userid=:m_userid where id=:m_id and ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
				cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
				cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
				cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
				cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
				cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into bieu_103(id,ma,ngay,c01,c02,c03,c04,c05,c06,userid,ngayud) values ";
					sql+="(:m_id,:m_ma,:m_ngay,:m_c01,:m_c02,:m_c03,:m_c04,:m_c05,:m_c06,:m_userid,sysdate)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
					cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
					cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
					cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
					cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
					cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"bieu_103");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}
		#endregion

		public void upd_dmcomputer(string m_computer)
		{
			sql="update dmcomputer set computer=:m_computer where computer=:m_computer";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_computer",OracleType.VarChar,20).Value=m_computer;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into dmcomputer(computer) values (:m_computer)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_computer",OracleType.VarChar,20).Value=m_computer;
					cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"dmcomputer");
			}
			finally
			{
				con.Close();con.Dispose();
			}		
		}

		public bool upd_dlogin(int m_id,string m_hoten,string m_userid,string m_password,int m_manhom,string m_makp,string m_right,string m_madoituong,string m_nhomkho,string m_cls,string m_mabs)
		{
			sql="update dlogin set hoten=:m_hoten,userid=:m_userid,password_=:m_password,manhom=:m_manhom";
			sql+=",makp=:m_makp,right_=:m_right,madoituong=:m_madoituong,nhomkho=:m_nhomkho,cls=:m_cls,mabs=:m_mabs";
			sql+=" where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_hoten",OracleType.NVarChar,50).Value=m_hoten;
				cmd.Parameters.Add("m_userid",OracleType.VarChar,10).Value=m_userid;
				cmd.Parameters.Add("m_password",OracleType.VarChar,10).Value=m_password;
				cmd.Parameters.Add("m_manhom",OracleType.Number).Value=m_manhom;
				cmd.Parameters.Add("m_makp",OracleType.VarChar,254).Value=m_makp;
				cmd.Parameters.Add("m_right",OracleType.VarChar,2000).Value=m_right;
				cmd.Parameters.Add("m_madoituong",OracleType.VarChar,50).Value=m_madoituong;
				cmd.Parameters.Add("m_nhomkho",OracleType.VarChar,50).Value=m_nhomkho;
				cmd.Parameters.Add("m_cls",OracleType.VarChar,20).Value=m_cls;
				cmd.Parameters.Add("m_mabs",OracleType.VarChar,4).Value=m_mabs;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into dlogin(id,hoten,userid,password_,manhom";
					sql+=",makp,right_,madoituong,nhomkho,cls,mabs";
					sql+=") values ";
					sql+="(:m_id,:m_hoten,:m_userid,:m_password,:m_manhom";
					sql+=",:m_makp,:m_right,:m_madoituong,:m_nhomkho,:m_cls,:m_mabs";
					sql+=")";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_hoten",OracleType.NVarChar,50).Value=m_hoten;
					cmd.Parameters.Add("m_userid",OracleType.VarChar,10).Value=m_userid;
					cmd.Parameters.Add("m_password",OracleType.VarChar,10).Value=m_password;
					cmd.Parameters.Add("m_manhom",OracleType.Number).Value=m_manhom;
					cmd.Parameters.Add("m_makp",OracleType.VarChar,254).Value=m_makp;
					cmd.Parameters.Add("m_right",OracleType.VarChar,2000).Value=m_right;
					cmd.Parameters.Add("m_madoituong",OracleType.VarChar,50).Value=m_madoituong;
					cmd.Parameters.Add("m_nhomkho",OracleType.VarChar,50).Value=m_nhomkho;
					cmd.Parameters.Add("m_cls",OracleType.VarChar,20).Value=m_cls;
					cmd.Parameters.Add("m_mabs",OracleType.VarChar,4).Value=m_mabs;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"dlogin");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_dlogin(int m_id,string m_right)
		{
			sql="update dlogin set right_=:m_right where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_right",OracleType.VarChar).Value=m_right;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.ExecuteNonQuery();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"dlogin");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public void updrec (DataTable dt,string maicd,bool matt,int p,decimal so)
		{
			string exp="maicd='"+maicd.ToString()+"'";
			DataRow r = getrowbyid (dt,exp); 
			if ( r == null )
			{
				DataRow nrow = dt.NewRow ( ) ;
				nrow[0]=maicd;
				if (p!=2 && !matt) nrow[3]=so;
				nrow[p]=so;
				dt.Rows.Add ( nrow ) ;
			}
			else
			{
				DataRow[] dr = dt.Select(exp);
				dr[0][p]=(dr[0][p].ToString()=="")?so:decimal.Parse(dr[0][p].ToString())+so;
				if (p!=2 && !matt) dr[0][3]=(dr[0][3].ToString()=="")?so:decimal.Parse(dr[0][3].ToString())+so;
			}
		}

		public void updrec (DataTable dt,int ma)
		{
			string exp="ma="+ma;
			DataRow r = getrowbyid (dt,exp); 
			if ( r == null )
			{
				DataRow nrow = dt.NewRow ( ) ;
				nrow[0] = ma;
				nrow[1] = "-";
				nrow[2] = "-";
				dt.Rows.Add ( nrow ) ;
			}
		}

		public void updrec (DataTable dt,int id,string userid,string password,string right)
		{
			string exp="id="+id;
			DataRow r = getrowbyid (dt,exp); 
			if ( r == null )
			{
				DataRow nrow = dt.NewRow ( ) ;
				nrow[0] = id;
				nrow[2] = userid;
				nrow[3] = password;
				nrow[6] = right;
				dt.Rows.Add ( nrow ) ;
			}
			else
			{
				DataRow[] dr = dt.Select(exp);
				if (dr.Length>0) dr[0][6] = right;
			}
		}

		public void u_bieudo(DataTable dt,string ma,string ten,long so)
		{
			string exp="ma='"+ma+"'";
			DataRow r = getrowbyid (dt,exp); 
			if ( r == null )
			{
				DataRow nrow = dt.NewRow ( ) ;
				nrow[0] = ma;
				nrow[1] = ten;
				nrow[2] = so;
				dt.Rows.Add ( nrow ) ;
			}
			else
			{
				DataRow[] dr = dt.Select(exp);
				long l=long.Parse(dr[0][2].ToString())+so;
				dr[0][2] = l;
			}
		}

		public bool upd_btdtt(string m_table,string m_mavung,string m_matt,string m_tentt)
		{
			sql="update "+m_table+" set tentt=:m_tentt where matt=:m_matt";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_tentt",OracleType.NVarChar,50).Value=m_tentt;
				cmd.Parameters.Add("m_matt",OracleType.VarChar,3).Value=m_matt;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+m_table+" (matt,tentt,mavung) values (:m_matt,:m_tentt,:m_mavung)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_matt",OracleType.VarChar,3).Value=m_matt;
					cmd.Parameters.Add("m_tentt",OracleType.NVarChar,50).Value=m_tentt;
					cmd.Parameters.Add("m_mavung",OracleType.VarChar,1).Value=m_mavung;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}

			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,m_table);
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_btdquan(string m_table,string m_matt,string m_maqu,string m_tenquan)
		{
			sql="update "+m_table+" set tenquan=:m_tenquan,matt=:m_matt where maqu=:m_maqu";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_tenquan",OracleType.NVarChar,50).Value=m_tenquan;
				cmd.Parameters.Add("m_matt",OracleType.VarChar,3).Value=m_matt;
				cmd.Parameters.Add("m_maqu",OracleType.VarChar,5).Value=m_maqu;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+m_table+" (matt,maqu,tenquan) values (:m_matt,:m_maqu,:m_tenquan)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_matt",OracleType.VarChar,3).Value=m_matt;
					cmd.Parameters.Add("m_maqu",OracleType.VarChar,5).Value=m_maqu;
					cmd.Parameters.Add("m_tenquan",OracleType.NVarChar,50).Value=m_tenquan;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}

			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,m_table);
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}
		public bool upd_btdpxa(string m_table,string m_maqu,string m_maphuongxa,string m_tenpxa,string m_viettat,int m_thanhthi)
		{
			sql="update "+m_table+" set tenpxa=:m_tenpxa,maqu=:m_maqu,viettat=:m_viettat,thanhthi=:m_thanhthi where maphuongxa=:m_maphuongxa";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_tenpxa",OracleType.NVarChar,50).Value=m_tenpxa;
				cmd.Parameters.Add("m_maqu",OracleType.VarChar,5).Value=m_maqu;
				cmd.Parameters.Add("m_viettat",OracleType.VarChar,10).Value=m_viettat;
				cmd.Parameters.Add("m_maphuongxa",OracleType.VarChar,7).Value=m_maphuongxa;
				cmd.Parameters.Add("m_thanhthi",OracleType.Number,1).Value=m_thanhthi;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+m_table+" (maqu,maphuongxa,tenpxa,viettat,thanhthi) values (:m_maqu,:m_maphuongxa,:m_tenpxa,:m_viettat,:m_thanhthi)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_maqu",OracleType.VarChar,5).Value=m_maqu;
					cmd.Parameters.Add("m_maphuongxa",OracleType.VarChar,7).Value=m_maphuongxa;
					cmd.Parameters.Add("m_tenpxa",OracleType.NVarChar,50).Value=m_tenpxa;
					cmd.Parameters.Add("m_viettat",OracleType.VarChar,10).Value=m_viettat;
					cmd.Parameters.Add("m_thanhthi",OracleType.Number,1).Value=m_thanhthi;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}

			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,m_table);
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}


		public bool upd_btdpxa(string m_table,string m_maqu,string m_maphuongxa,string m_tenpxa,string m_viettat)
		{
			sql="update "+m_table+" set tenpxa=:m_tenpxa,maqu=:m_maqu,viettat=:m_viettat where maphuongxa=:m_maphuongxa";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_tenpxa",OracleType.NVarChar,50).Value=m_tenpxa;
				cmd.Parameters.Add("m_maqu",OracleType.VarChar,5).Value=m_maqu;
				cmd.Parameters.Add("m_viettat",OracleType.VarChar,10).Value=m_viettat;
				cmd.Parameters.Add("m_maphuongxa",OracleType.VarChar,7).Value=m_maphuongxa;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+m_table+" (maqu,maphuongxa,tenpxa,viettat) values (:m_maqu,:m_maphuongxa,:m_tenpxa,:m_viettat)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_maqu",OracleType.VarChar,5).Value=m_maqu;
					cmd.Parameters.Add("m_maphuongxa",OracleType.VarChar,7).Value=m_maphuongxa;
					cmd.Parameters.Add("m_tenpxa",OracleType.NVarChar,50).Value=m_tenpxa;
					cmd.Parameters.Add("m_viettat",OracleType.VarChar,10).Value=m_viettat;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}

			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,m_table);
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_btdpxa(string m_table,string m_maqu,string m_maphuongxa,string m_tenpxa)
		{
			sql="update "+m_table+" set tenpxa=:m_tenpxa,maqu=:m_maqu where maphuongxa=:m_maphuongxa";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_tenpxa",OracleType.NVarChar,50).Value=m_tenpxa;
				cmd.Parameters.Add("m_maqu",OracleType.VarChar,5).Value=m_maqu;
				cmd.Parameters.Add("m_maphuongxa",OracleType.VarChar,7).Value=m_maphuongxa;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+m_table+" (maqu,maphuongxa,tenpxa,viettat) values (:m_maqu,:m_maphuongxa,:m_tenpxa,'')";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_maqu",OracleType.VarChar,5).Value=m_maqu;
					cmd.Parameters.Add("m_maphuongxa",OracleType.VarChar,7).Value=m_maphuongxa;
					cmd.Parameters.Add("m_tenpxa",OracleType.NVarChar,50).Value=m_tenpxa;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}

			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,m_table);
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_tenvien(string m_table,string m_mabv,string m_tenbv,string m_diachi,string m_sodt,
			string m_matuyen,string m_maloai,string m_mahang,string m_mavung,string m_matinh)
		{
			sql="update "+m_table+" set tenbv=:m_tenbv,diachi=:m_diachi,sodt=:m_sodt,";
			sql+="matuyen=:m_matuyen,maloai=:m_maloai,mahang=:m_mahang,";
			sql+="mavung=:m_mavung,matinh=:m_matinh where mabv=:m_mabv";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_tenbv",OracleType.NVarChar,100).Value=m_tenbv;
				cmd.Parameters.Add("m_diachi",OracleType.NVarChar,100).Value=m_diachi;
				cmd.Parameters.Add("m_sodt",OracleType.VarChar,20).Value=m_sodt;
				cmd.Parameters.Add("m_matuyen",OracleType.VarChar,1).Value=m_matuyen;
				cmd.Parameters.Add("m_maloai",OracleType.VarChar,5).Value=m_maloai;
				cmd.Parameters.Add("m_mahang",OracleType.VarChar,1).Value=m_mahang;
				cmd.Parameters.Add("m_mavung",OracleType.VarChar,1).Value=m_mavung;
				cmd.Parameters.Add("m_matinh",OracleType.VarChar,3).Value=m_matinh;
				cmd.Parameters.Add("m_mabv",OracleType.VarChar,9).Value=m_mabv;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+m_table+" (mabv,tenbv,diachi,sodt,matuyen,maloai,mahang,mavung,matinh) values (:m_mabv,:m_tenbv,:m_diachi,:m_sodt,:m_matuyen,:m_maloai,:m_mahang,:m_mavung,:m_matinh)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_mabv",OracleType.VarChar,9).Value=m_mabv;
					cmd.Parameters.Add("m_tenbv",OracleType.NVarChar,100).Value=m_tenbv;
					cmd.Parameters.Add("m_diachi",OracleType.NVarChar,100).Value=m_diachi;
					cmd.Parameters.Add("m_sodt",OracleType.VarChar,20).Value=m_sodt;
					cmd.Parameters.Add("m_matuyen",OracleType.VarChar,1).Value=m_matuyen;
					cmd.Parameters.Add("m_maloai",OracleType.VarChar,5).Value=m_maloai;
					cmd.Parameters.Add("m_mahang",OracleType.VarChar,1).Value=m_mahang;
					cmd.Parameters.Add("m_mavung",OracleType.VarChar,1).Value=m_mavung;
					cmd.Parameters.Add("m_matinh",OracleType.VarChar,3).Value=m_matinh;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}

			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,m_table);
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_dmnhommau(int m_ma,string m_ten)
		{
			sql="update dmnhommau set ten=:m_ten where ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_ten",OracleType.NVarChar,20).Value=m_ten;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into dmnhommau(ma,ten) values (:m_ma,:m_ten)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ten",OracleType.NVarChar,20).Value=m_ten;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}

			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"dmnhommau");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_icd10(string m_cicd10,string m_vviet)
		{
			sql="update icd10 set vviet=:m_vviet where cicd10=:m_cicd10";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_vviet",OracleType.NVarChar,254).Value=Caps(m_vviet);
				cmd.Parameters.Add("m_cicd10",OracleType.VarChar,9).Value=m_cicd10;
				cmd.ExecuteNonQuery();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"icd10");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_icd10(string m_table,string m_cicd10,int m_id_chapter,string m_vviet,
			string m_vanh,int m_id_nhom,int m_loai,string m_manh,string m_stt)
		{
			sql="update "+m_table+" set id_chapter=:m_id_chapter,vviet=:m_vviet,";
			sql+="vanh=:m_vanh,id_nhom=:m_id_nhom,loai=:m_loai,manh=:m_manh,";
			sql+="stt=:m_stt where cicd10=:m_cicd10";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_id_chapter",OracleType.Number).Value=m_id_chapter;
				cmd.Parameters.Add("m_vviet",OracleType.NVarChar,254).Value=m_vviet;
				cmd.Parameters.Add("m_vanh",OracleType.VarChar,160).Value=m_vanh;
				cmd.Parameters.Add("m_id_nhom",OracleType.Number).Value=m_id_nhom;
				cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
				cmd.Parameters.Add("m_manh",OracleType.VarChar,7).Value=m_manh;
				cmd.Parameters.Add("m_stt",OracleType.VarChar,3).Value=m_stt;
				cmd.Parameters.Add("m_cicd10",OracleType.VarChar,9).Value=m_cicd10;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+m_table+"(cicd10,id_chapter,vviet,vanh,id_nhom,loai,manh,stt,readonly) values (:m_cicd10,:m_id_chapter,:m_vviet,:m_vanh,:m_id_nhom,:m_loai,:m_manh,:m_stt,0)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_cicd10",OracleType.VarChar,9).Value=m_cicd10;
					cmd.Parameters.Add("m_id_chapter",OracleType.Number).Value=m_id_chapter;
					cmd.Parameters.Add("m_vviet",OracleType.NVarChar,254).Value=m_vviet;
					cmd.Parameters.Add("m_vanh",OracleType.VarChar,160).Value=m_vanh;
					cmd.Parameters.Add("m_id_nhom",OracleType.Number).Value=m_id_nhom;
					cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
					cmd.Parameters.Add("m_manh",OracleType.VarChar,7).Value=m_manh;
					cmd.Parameters.Add("m_stt",OracleType.VarChar,3).Value=m_stt;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}

			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,m_table+"->"+m_cicd10.Trim());
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_dmthon(string m_thon)
		{
			sql="update dmthon set thon=:m_thon where thon=:m_thon";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_thon",OracleType.NVarChar,100).Value=m_thon;
				cmd.Parameters.Add("m_thon",OracleType.NVarChar,100).Value=m_thon;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into dmthon (thon) values (:m_thon)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_thon",OracleType.NVarChar,100).Value=m_thon;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"dmthon");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_tainantt(string m_mabn,long m_maql,string m_ngay,int m_diadiem,int m_bophan,
			int m_nguyennhan,int m_ngodoc,int m_dienbien,int m_xutri,string m_thon,string m_matt,string m_maqu,string m_maphuongxa,string m_mota)
		{
			sql="update tainantt set ngay=:m_ngay,diadiem=:m_diadiem,bophan=:m_bophan,";
			sql+="nguyennhan=:m_nguyennhan,ngodoc=:m_ngodoc,dienbien=:m_dienbien,xutri=:m_xutri,thon=:m_thon,matt=:m_matt,maqu=:m_maqu,maphuongxa=:m_maphuongxa,mota=:m_mota";
			sql+=" where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_diadiem",OracleType.Number).Value=m_diadiem;
				cmd.Parameters.Add("m_bophan",OracleType.Number).Value=m_bophan;
				cmd.Parameters.Add("m_nguyennhan",OracleType.Number).Value=m_nguyennhan;
				cmd.Parameters.Add("m_ngodoc",OracleType.Number).Value=m_ngodoc;
				cmd.Parameters.Add("m_dienbien",OracleType.Number).Value=m_dienbien;
				cmd.Parameters.Add("m_xutri",OracleType.Number).Value=m_xutri;
				cmd.Parameters.Add("m_thon",OracleType.NVarChar,50).Value=m_thon;
				cmd.Parameters.Add("m_matt",OracleType.VarChar,3).Value=m_matt;
				cmd.Parameters.Add("m_maqu",OracleType.VarChar,5).Value=m_maqu;
				cmd.Parameters.Add("m_maphuongxa",OracleType.VarChar,7).Value=m_maphuongxa;
				cmd.Parameters.Add("m_mota",OracleType.NVarChar,254).Value=m_mota;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into tainantt(mabn,maql,ngay,diadiem,bophan,nguyennhan,ngodoc,dienbien,xutri,thon,matt,maqu,maphuongxa,mota) values (:m_mabn,:m_maql,:m_ngay,:m_diadiem,:m_bophan,:m_nguyennhan,:m_ngodoc,:m_dienbien,:m_xutri,:m_thon,:m_matt,:m_maqu,:m_maphuongxa,:m_mota)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar,10).Value=m_mabn;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_diadiem",OracleType.Number).Value=m_diadiem;
					cmd.Parameters.Add("m_bophan",OracleType.Number).Value=m_bophan;
					cmd.Parameters.Add("m_nguyennhan",OracleType.Number).Value=m_nguyennhan;
					cmd.Parameters.Add("m_ngodoc",OracleType.Number).Value=m_ngodoc;
					cmd.Parameters.Add("m_dienbien",OracleType.Number).Value=m_dienbien;
					cmd.Parameters.Add("m_xutri",OracleType.Number).Value=m_xutri;
					cmd.Parameters.Add("m_thon",OracleType.NVarChar,50).Value=m_thon;
					cmd.Parameters.Add("m_matt",OracleType.VarChar,3).Value=m_matt;
					cmd.Parameters.Add("m_maqu",OracleType.VarChar,5).Value=m_maqu;
					cmd.Parameters.Add("m_maphuongxa",OracleType.VarChar,7).Value=m_maphuongxa;
					cmd.Parameters.Add("m_mota",OracleType.NVarChar,254).Value=m_mota;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}

			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"tainantt");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_dmcoso(int m_ma,string m_ten,int m_tuyen)
		{
			sql="update dmcoso set ten=:m_ten,tuyen=:m_tuyen";
			sql+=" where ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_ten",OracleType.NVarChar,100).Value=m_ten;
				cmd.Parameters.Add("m_tuyen",OracleType.Number).Value=m_tuyen;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into dmcoso(ma,ten,tuyen) values (:m_ma,:m_ten,:m_tuyen)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ten",OracleType.NVarChar,100).Value=m_ten;
					cmd.Parameters.Add("m_tuyen",OracleType.Number).Value=m_tuyen;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"dmcoso");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		//ThanhCuong 04/04/2012
		public bool upd_dmcoso(int m_ma,string m_ten,int m_tuyen,string m_coso)
		{
			sql="update dmcoso set ten=:m_ten,tuyen=:m_tuyen,coso=:m_coso";
			sql+=" where ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_ten",OracleType.NVarChar,100).Value=m_ten;
				cmd.Parameters.Add("m_tuyen",OracleType.Number).Value=m_tuyen;
				cmd.Parameters.Add("m_coso",OracleType.VarChar).Value=m_coso;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into dmcoso(ma,ten,tuyen,coso) values (:m_ma,:m_ten,:m_tuyen,:m_coso)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ten",OracleType.NVarChar,100).Value=m_ten;
					cmd.Parameters.Add("m_tuyen",OracleType.Number).Value=m_tuyen;
					cmd.Parameters.Add("m_coso",OracleType.VarChar).Value=m_coso;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"dmcoso");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}
		//End ThanhCuong 04/04/2012

		public bool upd_danhmuc(int m_ma,string m_stt,string m_ten,string m_table)
		{
			sql="update "+m_table+" set stt=:m_stt,ten=:m_ten";
			sql+=" where ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_stt",OracleType.VarChar).Value=m_stt;
				cmd.Parameters.Add("m_ten",OracleType.NVarChar).Value=m_ten;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+m_table+" (ma,stt,ten) values (:m_ma,:m_stt,:m_ten)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_stt",OracleType.VarChar).Value=m_stt;
					cmd.Parameters.Add("m_ten",OracleType.NVarChar).Value=m_ten;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,m_table);
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_danhmuc(int m_ma,string m_stt,string m_ten,string m_table,string m_loai)
		{
			sql="update "+m_table+" set stt=:m_stt,ten=:m_ten,loai=:m_loai";
			sql+=" where ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_stt",OracleType.VarChar).Value=m_stt;
				cmd.Parameters.Add("m_ten",OracleType.NVarChar).Value=m_ten;
				cmd.Parameters.Add("m_loai",OracleType.VarChar,1).Value=m_loai;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+m_table+" (ma,stt,ten,loai) values (:m_ma,:m_stt,:m_ten,:m_loai)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_stt",OracleType.VarChar).Value=m_stt;
					cmd.Parameters.Add("m_ten",OracleType.NVarChar).Value=m_ten;
					cmd.Parameters.Add("m_loai",OracleType.VarChar,1).Value=m_loai;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				//				upd_error(ex.Message,sComputer,m_table);
				//				return false;
				upd_danhmuc(m_ma,m_stt,m_ten,m_table);
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_danhmuc(int m_ma,string m_stt,string m_table)
		{
			sql="update "+m_table+" set stt=:m_stt";
			sql+=" where ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_stt",OracleType.VarChar,2).Value=m_stt;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				cmd.ExecuteNonQuery();
				cmd.Dispose();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,m_table);
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		//ThanhCuong 04/04/2012
		public bool upd_danhmuc(int m_ma,string m_stt,string m_table,int m_tuyen,string m_coso)
		{
			sql="update "+m_table+" set stt=:m_stt";
			sql+=" where ma=:m_ma and tuyen=:m_tuyen and coso=:m_coso";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_stt",OracleType.VarChar,2).Value=m_stt;
				cmd.Parameters.Add("m_tuyen",OracleType.Number).Value=m_tuyen;
				cmd.Parameters.Add("m_coso",OracleType.VarChar).Value=m_coso;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				cmd.ExecuteNonQuery();
				cmd.Dispose();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,m_table);
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}
		//End ThanhCuong 04/04/2012
		public void sort_stt()
		{
			int i=1;
			foreach(DataRow r in get_data("select * from kh_dm_01 where stt<>'A' order by ma").Tables[0].Rows)
			{
				upd_danhmuc(int.Parse(r["ma"].ToString()),i.ToString(),"kh_dm_01");
				i++;
			}
			i=1;
			foreach(DataRow r in get_data("select * from kh_dm_02 where stt<>'A' order by ma").Tables[0].Rows)
			{
				upd_danhmuc(int.Parse(r["ma"].ToString()),i.ToString(),"kh_dm_02");
				i++;
			}
			i=1;
			foreach(DataRow r in get_data("select * from kh_dm_04 where stt<>'A' order by ma").Tables[0].Rows)
			{
				upd_danhmuc(int.Parse(r["ma"].ToString()),i.ToString(),"kh_dm_04");
				i++;
			}
		}

		public void sort_danhmuc(string table)
		{
			int i=1;
			foreach(DataRow r in get_data("select * from "+table+" where stt<>'A' order by ma").Tables[0].Rows)
			{
				upd_danhmuc(int.Parse(r["ma"].ToString()),i.ToString(),table);
				i++;
			}
		}

		public void sort_stt(string table)
		{
			int i=1,j=0;
			execute_data("delete from "+table+" where stt in ('A','B','C')");
			foreach(DataRow r in get_data("select * from "+table+" where stt<>'A' order by ma").Tables[0].Rows)
			{
				j=int.Parse(r["ma"].ToString());
				upd_danhmuc((j<50)?0:50,(j<50)?"B":"C",(j<50)?"I. Tuyến huyện":"II. Tuyến xã",table);
			}
			foreach(DataRow r in get_data("select * from "+table+" where ma between 1 and 49 order by ma").Tables[0].Rows)
			{
				upd_danhmuc(int.Parse(r["ma"].ToString()),i.ToString(),table);
				i++;
			}
			i=1;
			foreach(DataRow r in get_data("select * from "+table+" where ma between 51 and 99 order by ma").Tables[0].Rows)
			{
				upd_danhmuc(int.Parse(r["ma"].ToString()),i.ToString(),table);
				i++;
			}
		}
		//ThanhCuong 04/04/2012
		public void sort_stt(string table,int tuyen, string coso)
		{
			int i=1,i_ma=0;
			//execute_data("delete from "+table+" where stt in ('A','B','C')");
			string a="H";
			if(coso!="A")
			{
				if(coso!="B")
				{
					try
					{
						i_ma=int.Parse(get_data("select max(ma) from "+table).Tables[0].Rows[0]["ma"].ToString())+1;
						a="X";
					}
					catch{i_ma=0;}
				}
				else
				{
					try
					{
						i_ma=int.Parse(get_data("select max(ma) from "+table).Tables[0].Rows[0]["ma"].ToString())+1;
						a="Z";
					}
					catch{i_ma=0;}
				}
			}
			upd_danhmuc(i_ma,coso,(coso=="A")?"Cơ sở y tế công":(coso=="B")?"Cơ sở các ngành":"Cơ sở y tế tư nhân" ,table,0,a);
			upd_danhmuc(0,(tuyen==0)?"I":(tuyen==1)?"II":"III",(tuyen==0)?"Trung ương":(tuyen==1)?"Tuyến tỉnh":"Tuyến huyện" ,table,tuyen,coso);
			foreach(DataRow r in get_data("select * from "+table+" where tuyen="+tuyen+" and coso='"+coso+"' and stt not in('I','II','III') order by ma").Tables[0].Rows)
			{
				upd_danhmuc(int.Parse(r["ma"].ToString()),i.ToString(),table,tuyen,coso);
				i++;
			}
		}
		//End ThanhCuong

		public bool upd_dmcssxkd(int m_ma,string m_ten)
		{
			sql="update dmcssxkd set ten=:m_ten";
			sql+=" where ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_ten",OracleType.NVarChar,100).Value=m_ten;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into dmcssxkd(ma,ten) values (:m_ma,:m_ten)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ten",OracleType.NVarChar,100).Value=m_ten;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"dmcssxkd");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_danhmuc(string m_table,int m_ma,string m_ten)
		{
			sql="update "+m_table+" set ten=:m_ten";
			sql+=" where id=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_ten",OracleType.NVarChar,50).Value=m_ten;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+m_table+" (id,ten) values (:m_ma,:m_ten)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ten",OracleType.NVarChar,50).Value=m_ten;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,m_table);
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_xutrikb(string m_table,int m_ma,string m_ten)
		{
			sql="update "+m_table+" set ten=:m_ten";
			sql+=" where ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_ten",OracleType.NVarChar,50).Value=m_ten;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+m_table+"(ma,ten) values (:m_ma,:m_ten)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ten",OracleType.NVarChar,50).Value=m_ten;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,m_table);
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_xutrikbct(long m_maql,string m_xutri,string m_makp)
		{
			sql="update xutrikbct set xutri=:m_xutri,makp=:m_makp";
			sql+=" where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_xutri",OracleType.VarChar,50).Value=m_xutri;
				cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into xutrikbct(maql,xutri,makp) values (:m_maql,:m_xutri,:m_makp)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_xutri",OracleType.VarChar,50).Value=m_xutri;
					cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"xutrikbct");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public string get_xutri(long m_maql,int i)
		{
			DataTable dt=get_data("select xutri,makp from xutrikbct where maql="+m_maql).Tables[0];
			if (dt.Rows.Count==0) return "";
			else return dt.Rows[0][i].ToString();
		}

		#region vukehoach
		/// <summary>
		/// 
		/// </summary>
		public bool upd_kh01(long m_id,int m_ma,string m_ngay,int m_c01,int m_c02,int m_c03,int m_c04,int m_c05,int m_c06,int m_c07,int m_c08,int m_c09,int m_c10,int m_c11,int m_userid)
		{
			sql="update kh_bieu_01 set ngay=:m_ngay,c01=:m_c01,c02=:m_c02,c03=:m_c03,c04=:m_c04,";
			sql+="c05=:m_c05,c06=:m_c06,c07=:m_c07,c08=:m_c08,c09=:m_c09,c10=:m_c10,c11=:m_c11,";
			sql+="userid=:m_userid where id=:m_id and ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
				cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
				cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
				cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
				cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
				cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
				cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
				cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
				cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
				cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
				cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into kh_bieu_01(id,ma,ngay,c01,c02,c03,c04,c05,c06,c07,c08,c09,c10,c11,userid,ngayud) values ";
					sql+="(:m_id,:m_ma,:m_ngay,:m_c01,:m_c02,:m_c03,:m_c04,:m_c05,:m_c06,:m_c07,:m_c08,:m_c09,:m_c10,:m_c11,:m_userid,sysdate)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
					cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
					cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
					cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
					cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
					cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
					cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
					cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
					cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
					cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
					cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"kh_bieu_01");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_kh02(long m_id,int m_ma,string m_ngay,int m_c01,int m_c02,
			int m_c03,int m_c04,int m_c05,int m_c06,int m_c07,int m_c08,int m_c09,
			int m_c10,int m_c11,int m_c12,int m_c13,int m_c14,int m_c15,int m_c16,int m_c17,int m_userid)
		{
			sql="update kh_bieu_02 set ngay=:m_ngay,c01=:m_c01,c02=:m_c02,c03=:m_c03,c04=:m_c04,";
			sql+="c05=:m_c05,c06=:m_c06,c07=:m_c07,c08=:m_c08,c09=:m_c09,c10=:m_c10,";
			sql+="c11=:m_c11,c12=:m_c12,c13=:m_c13,c14=:m_c14,c15=:m_c15,c16=:m_c16,c17=:m_c17,";
			sql+="userid=:m_userid where id=:m_id and ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
				cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
				cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
				cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
				cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
				cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
				cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
				cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
				cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
				cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
				cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
				cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
				cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
				cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
				cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
				cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
				cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into kh_bieu_02(id,ma,ngay,c01,c02,c03,c04,c05,c06,c07,c08,c09,c10,c11,c12,c13,c14,c15,c16,c17,userid,ngayud) values ";
					sql+="(:m_id,:m_ma,:m_ngay,:m_c01,:m_c02,:m_c03,:m_c04,:m_c05,:m_c06,:m_c07,:m_c08,:m_c09,:m_c10,:m_c11,:m_c12,:m_c13,:m_c14,:m_c15,:m_c16,:m_c17,:m_userid,sysdate)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
					cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
					cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
					cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
					cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
					cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
					cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
					cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
					cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
					cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
					cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
					cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
					cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
					cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
					cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
					cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
					cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"kh_bieu_02");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_kh03(long m_id,int m_ma,string m_ngay,int m_c01,int m_c02,
			int m_c03,int m_c04,int m_c05,int m_c06,int m_c07,int m_c08,int m_c09,
			int m_c10,int m_c11,int m_c12,int m_c13,int m_c14,int m_c15,int m_c16,
			int m_c17,int m_c18,int m_c19,int m_c20,int m_userid)
		{
			sql="update kh_bieu_03 set ngay=:m_ngay,c01=:m_c01,c02=:m_c02,c03=:m_c03,c04=:m_c04,";
			sql+="c05=:m_c05,c06=:m_c06,c07=:m_c07,c08=:m_c08,c09=:m_c09,c10=:m_c10,";
			sql+="c11=:m_c11,c12=:m_c12,c13=:m_c13,c14=:m_c14,c15=:m_c15,c16=:m_c16,c17=:m_c17,c18=:m_c18,";
			sql+="c19=:m_c19,c20=:m_c20,userid=:m_userid where id=:m_id and ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
				cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
				cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
				cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
				cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
				cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
				cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
				cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
				cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
				cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
				cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
				cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
				cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
				cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
				cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
				cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
				cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
				cmd.Parameters.Add("m_c18",OracleType.Number).Value=m_c18;
				cmd.Parameters.Add("m_c19",OracleType.Number).Value=m_c19;
				cmd.Parameters.Add("m_c20",OracleType.Number).Value=m_c20;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into kh_bieu_03(id,ma,ngay,c01,c02,c03,c04,c05,c06,c07,c08,c09,c10,c11,c12,c13,c14,c15,c16,c17,c18,c19,c20,userid,ngayud) values ";
					sql+="(:m_id,:m_ma,:m_ngay,:m_c01,:m_c02,:m_c03,:m_c04,:m_c05,:m_c06,:m_c07,:m_c08,:m_c09,:m_c10,:m_c11,:m_c12,:m_c13,:m_c14,:m_c15,:m_c16,:m_c17,:m_c18,:m_c19,:m_c20,:m_userid,sysdate)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
					cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
					cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
					cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
					cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
					cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
					cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
					cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
					cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
					cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
					cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
					cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
					cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
					cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
					cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
					cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
					cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
					cmd.Parameters.Add("m_c18",OracleType.Number).Value=m_c18;
					cmd.Parameters.Add("m_c19",OracleType.Number).Value=m_c19;
					cmd.Parameters.Add("m_c20",OracleType.Number).Value=m_c20;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"kh_bieu_03");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_kh04(long m_id,int m_ma,string m_ngay,int m_c01,int m_c02,
			int m_c03,int m_c04,int m_c05,int m_c06,int m_c07,int m_c08,int m_c09,
			int m_c10,int m_c11,int m_c12,int m_c13,int m_c14,int m_c15,int m_c16,int m_c17,string m_c18,int m_userid)
		{
			sql="update kh_bieu_04 set ngay=:m_ngay,c01=:m_c01,c02=:m_c02,c03=:m_c03,c04=:m_c04,";
			sql+="c05=:m_c05,c06=:m_c06,c07=:m_c07,c08=:m_c08,c09=:m_c09,c10=:m_c10,";
			sql+="c11=:m_c11,c12=:m_c12,c13=:m_c13,c14=:m_c14,c15=:m_c15,c16=:m_c16,c17=:m_c17,c18=:m_c18,";
			sql+="userid=:m_userid where id=:m_id and ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
				cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
				cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
				cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
				cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
				cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
				cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
				cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
				cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
				cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
				cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
				cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
				cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
				cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
				cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
				cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
				cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
				cmd.Parameters.Add("m_c18",OracleType.NVarChar,50).Value=m_c18;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into kh_bieu_04(id,ma,ngay,c01,c02,c03,c04,c05,c06,c07,c08,c09,c10,c11,c12,c13,c14,c15,c16,c17,c18,userid,ngayud) values ";
					sql+="(:m_id,:m_ma,:m_ngay,:m_c01,:m_c02,:m_c03,:m_c04,:m_c05,:m_c06,:m_c07,:m_c08,:m_c09,:m_c10,:m_c11,:m_c12,:m_c13,:m_c14,:m_c15,:m_c16,:m_c17,:m_c18,:m_userid,sysdate)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
					cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
					cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
					cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
					cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
					cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
					cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
					cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
					cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
					cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
					cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
					cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
					cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
					cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
					cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
					cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
					cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
					cmd.Parameters.Add("m_c18",OracleType.NVarChar,50).Value=m_c18;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"kh_bieu_04");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}
        

		//		public bool upd_kh_dm_04(int m_ma,string m_stt, string m_ten,int m_c01,int m_c02,
		//			int m_c03,int m_c04,int m_c05,int m_c06,int m_c07,int m_c08,int m_c09,
		//			int m_c10,int m_c11,int m_c12,int m_c13,int m_c14,int m_c15,int m_c16,int m_c17,string m_c18)
		//		{
		//			sql="update kh_dm_04 set stt=:m_stt,ten=:m_ten,c01=:m_c01,c02=:m_c02,c03=:m_c03,c04=:m_c04,";
		//			sql+="c05=:m_c05,c06=:m_c06,c07=:m_c07,c08=:m_c08,c09=:m_c09,c10=:m_c10,";
		//			sql+="c11=:m_c11,c12=:m_c12,c13=:m_c13,c14=:m_c14,c15=:m_c15,c16=:m_c16,c17=:m_c17,c18=:m_c18,";
		//			sql+="userid=:m_userid where ma=:m_ma";
		//			con=new OracleConnection(sConn);
		//			try
		//			{
		//				con.Open();
		//				cmd=new OracleCommand(sql,con);
		//				cmd.CommandType=CommandType.Text;
		//
		//				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
		//				cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
		//				cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
		//				cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
		//				cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
		//				cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
		//				cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
		//				cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
		//				cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
		//				cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
		//				cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
		//				cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
		//				cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
		//				cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
		//				cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
		//				cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
		//				cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
		//				cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
		//				cmd.Parameters.Add("m_c18",OracleType.NVarChar,50).Value=m_c18;
		//				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
		//				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
		//				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
		//				int irec=cmd.ExecuteNonQuery();
		//				cmd.Dispose();
		//				if (irec==0)
		//				{
		//					sql="insert into kh_bieu_04(id,ma,ngay,c01,c02,c03,c04,c05,c06,c07,c08,c09,c10,c11,c12,c13,c14,c15,c16,c17,c18,userid,ngayud) values ";
		//					sql+="(:m_id,:m_ma,:m_ngay,:m_c01,:m_c02,:m_c03,:m_c04,:m_c05,:m_c06,:m_c07,:m_c08,:m_c09,:m_c10,:m_c11,:m_c12,:m_c13,:m_c14,:m_c15,:m_c16,:m_c17,:m_c18,:m_userid,sysdate)";
		//					cmd=new OracleCommand(sql,con);
		//					cmd.CommandType=CommandType.Text;
		//					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
		//					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
		//					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
		//					cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
		//					cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
		//					cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
		//					cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
		//					cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
		//					cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
		//					cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
		//					cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
		//					cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
		//					cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
		//					cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
		//					cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
		//					cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
		//					cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
		//					cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
		//					cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
		//					cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
		//					cmd.Parameters.Add("m_c18",OracleType.NVarChar,50).Value=m_c18;
		//					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
		//					irec=cmd.ExecuteNonQuery();
		//					cmd.Dispose();
		//				}
		//			}
		//			catch(OracleException ex)
		//			{
		//				upd_error(ex.Message,sComputer,"kh_bieu_04");
		//				return false;
		//			}
		//			finally
		//			{
		//				con.Close();con.Dispose();
		//			}		
		//			return true;
		//		}
		public bool upd_kh05(long m_id,int m_ma,string m_ngay,int m_c01,int m_c02,
			int m_c03,int m_c04,int m_c05,int m_c06,int m_c07,int m_c08,int m_c09,
			int m_c10,int m_c11,int m_c12,int m_c13,int m_c14,int m_userid,int m_c15)
		{
			sql="update kh_bieu_05 set ngay=:m_ngay,c01=:m_c01,c02=:m_c02,c03=:m_c03,c04=:m_c04,";
			sql+="c05=:m_c05,c06=:m_c06,c07=:m_c07,c08=:m_c08,c09=:m_c09,c10=:m_c10,";
			sql+="c11=:m_c11,c12=:m_c12,c13=:m_c13,c14=:m_c14,";
			sql+="userid=:m_userid,c15=:m_c15 where id=:m_id and ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
				cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
				cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
				cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
				cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
				cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
				cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
				cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
				cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
				cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
				cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
				cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
				cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
				cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into kh_bieu_05(id,ma,ngay,c01,c02,c03,c04,c05,c06,c07,c08,c09,c10,c11,c12,c13,c14,userid,ngayud,c15) values ";
					sql+="(:m_id,:m_ma,:m_ngay,:m_c01,:m_c02,:m_c03,:m_c04,:m_c05,:m_c06,:m_c07,:m_c08,:m_c09,:m_c10,:m_c11,:m_c12,:m_c13,:m_c14,:m_userid,sysdate,:m_c15)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
					cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
					cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
					cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
					cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
					cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
					cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
					cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
					cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
					cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
					cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
					cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
					cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
					cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"kh_bieu_05");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		//ThanhCuong 05/04/2012
		public bool upd_kh05(long m_id,int m_ma,string m_ngay,int m_c01,int m_c02,
			int m_c03,int m_c04,int m_c05,int m_c06,int m_c07,int m_c08,int m_c09,
			int m_c10,int m_c11,int m_c12,int m_c13,int m_c14,int m_userid,int m_c15,string m_stt,int m_tuyen)
		{
			sql="update kh_bieu_05 set ngay=:m_ngay,c01=:m_c01,c02=:m_c02,c03=:m_c03,c04=:m_c04,";
			sql+="c05=:m_c05,c06=:m_c06,c07=:m_c07,c08=:m_c08,c09=:m_c09,c10=:m_c10,";
			sql+="c11=:m_c11,c12=:m_c12,c13=:m_c13,c14=:m_c14,";
			sql+="userid=:m_userid,c15=:m_c15 where id=:m_id and ma=:m_ma and stt=:m_stt and tuyen=:m_tuyen";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
				cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
				cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
				cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
				cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
				cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
				cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
				cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
				cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
				cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
				cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
				cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
				cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
				cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				cmd.Parameters.Add("m_stt",OracleType.VarChar).Value=m_stt;
				cmd.Parameters.Add("m_tuyen",OracleType.Number).Value=m_tuyen;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into kh_bieu_05(id,ma,ngay,c01,c02,c03,c04,c05,c06,c07,c08,c09,c10,c11,c12,c13,c14,userid,ngayud,c15,stt,tuyen) values ";
					sql+="(:m_id,:m_ma,:m_ngay,:m_c01,:m_c02,:m_c03,:m_c04,:m_c05,:m_c06,:m_c07,:m_c08,:m_c09,:m_c10,:m_c11,:m_c12,:m_c13,:m_c14,:m_userid,sysdate,:m_c15,:m_stt,:m_tuyen)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
					cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
					cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
					cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
					cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
					cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
					cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
					cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
					cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
					cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
					cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
					cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
					cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
					cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
					cmd.Parameters.Add("m_stt",OracleType.VarChar).Value=m_stt;
					cmd.Parameters.Add("m_tuyen",OracleType.Number).Value=m_tuyen;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"kh_bieu_05");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		//End ThanhCuong 05/04/2012
		public bool upd_kh06(long m_id,int m_ma,string m_ngay,int m_c01,int m_c02,
			int m_c03,int m_c04,int m_c05,int m_c06,int m_c07,int m_c08,int m_c09,
			int m_c10,int m_c11,int m_c12,int m_c13,int m_c14,int m_c15,int m_c16,
			int m_c17,int m_c18,int m_c19,int m_c20,int m_c21,int m_c22,int m_c23,
			int m_c24,int m_c25,int m_c26,int m_c27,int m_c28,int m_c29,int m_c30,
			int m_c31,int m_userid,int m_c32,int m_c33,int m_c34,int m_c35,int m_c36,int m_c37,
			int m_c38)
		{
			sql="update kh_bieu_06 set ngay=:m_ngay,c01=:m_c01,c02=:m_c02,c03=:m_c03,c04=:m_c04,";
			sql+="c05=:m_c05,c06=:m_c06,c07=:m_c07,c08=:m_c08,c09=:m_c09,c10=:m_c10,";
			sql+="c11=:m_c11,c12=:m_c12,c13=:m_c13,c14=:m_c14,c15=:m_c15,c16=:m_c16,c17=:m_c17,";
			sql+="c18=:m_c18,c19=:m_c19,c20=:m_c20,c21=:m_c21,c22=:m_c22,c23=:m_c23,c24=:m_c24,";
			sql+="c25=:m_c25,c26=:m_c26,c27=:m_c27,c28=:m_c28,c29=:m_c29,c30=:m_c30,c31=:m_c31,";
			sql+="userid=:m_userid,c32=:m_c32,c33=:m_c33,c34=:m_c34,c35=:m_c35,c36=:m_c36,c37=:m_c37,c38=:m_c38 where id=:m_id and ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
				cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
				cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
				cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
				cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
				cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
				cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
				cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
				cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
				cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
				cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
				cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
				cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
				cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
				cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
				cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
				cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
				cmd.Parameters.Add("m_c18",OracleType.Number).Value=m_c18;
				cmd.Parameters.Add("m_c19",OracleType.Number).Value=m_c19;
				cmd.Parameters.Add("m_c20",OracleType.Number).Value=m_c20;
				cmd.Parameters.Add("m_c21",OracleType.Number).Value=m_c21;
				cmd.Parameters.Add("m_c22",OracleType.Number).Value=m_c22;
				cmd.Parameters.Add("m_c23",OracleType.Number).Value=m_c23;
				cmd.Parameters.Add("m_c24",OracleType.Number).Value=m_c24;
				cmd.Parameters.Add("m_c25",OracleType.Number).Value=m_c25;
				cmd.Parameters.Add("m_c26",OracleType.Number).Value=m_c26;
				cmd.Parameters.Add("m_c27",OracleType.Number).Value=m_c27;
				cmd.Parameters.Add("m_c28",OracleType.Number).Value=m_c28;
				cmd.Parameters.Add("m_c29",OracleType.Number).Value=m_c29;
				cmd.Parameters.Add("m_c30",OracleType.Number).Value=m_c30;
				cmd.Parameters.Add("m_c31",OracleType.Number).Value=m_c31;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_c32",OracleType.Number).Value=m_c32;
				cmd.Parameters.Add("m_c33",OracleType.Number).Value=m_c33;
				cmd.Parameters.Add("m_c34",OracleType.Number).Value=m_c34;
				cmd.Parameters.Add("m_c35",OracleType.Number).Value=m_c35;
				cmd.Parameters.Add("m_c36",OracleType.Number).Value=m_c36;
				cmd.Parameters.Add("m_c37",OracleType.Number).Value=m_c37;
				cmd.Parameters.Add("m_c38",OracleType.Number).Value=m_c38;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into kh_bieu_06(id,ma,ngay,c01,c02,c03,c04,c05,c06,c07,c08,c09,c10,c11,c12,c13,c14,c15,c16,c17,c18,c19,c20,c21,c22,c23,c24,c25,c26,c27,c28,c29,c30,c31,userid,ngayud,c32,c33,c34,c35,c36,c37,c38) values ";
					sql+="(:m_id,:m_ma,:m_ngay,:m_c01,:m_c02,:m_c03,:m_c04,:m_c05,:m_c06,:m_c07,:m_c08,:m_c09,:m_c10,:m_c11,:m_c12,:m_c13,:m_c14,:m_c15,:m_c16,:m_c17,:m_c18,:m_c19,:m_c20,:m_c21,:m_c22,:m_c23,:m_c24,:m_c25,:m_c26,:m_c27,:m_c28,:m_c29,:m_c30,:m_c31,:m_userid,sysdate,:m_c32,:m_c33,:m_c34,:m_c35,:m_c36,:m_c37,:m_c38)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
					cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
					cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
					cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
					cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
					cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
					cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
					cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
					cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
					cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
					cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
					cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
					cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
					cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
					cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
					cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
					cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
					cmd.Parameters.Add("m_c18",OracleType.Number).Value=m_c18;
					cmd.Parameters.Add("m_c19",OracleType.Number).Value=m_c19;
					cmd.Parameters.Add("m_c20",OracleType.Number).Value=m_c20;
					cmd.Parameters.Add("m_c21",OracleType.Number).Value=m_c21;
					cmd.Parameters.Add("m_c22",OracleType.Number).Value=m_c22;
					cmd.Parameters.Add("m_c23",OracleType.Number).Value=m_c23;
					cmd.Parameters.Add("m_c24",OracleType.Number).Value=m_c24;
					cmd.Parameters.Add("m_c25",OracleType.Number).Value=m_c25;
					cmd.Parameters.Add("m_c26",OracleType.Number).Value=m_c26;
					cmd.Parameters.Add("m_c27",OracleType.Number).Value=m_c27;
					cmd.Parameters.Add("m_c28",OracleType.Number).Value=m_c28;
					cmd.Parameters.Add("m_c29",OracleType.Number).Value=m_c29;
					cmd.Parameters.Add("m_c30",OracleType.Number).Value=m_c30;
					cmd.Parameters.Add("m_c31",OracleType.Number).Value=m_c31;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					cmd.Parameters.Add("m_c32",OracleType.Number).Value=m_c32;
					cmd.Parameters.Add("m_c33",OracleType.Number).Value=m_c33;
					cmd.Parameters.Add("m_c34",OracleType.Number).Value=m_c34;
					cmd.Parameters.Add("m_c35",OracleType.Number).Value=m_c35;
					cmd.Parameters.Add("m_c36",OracleType.Number).Value=m_c36;
					cmd.Parameters.Add("m_c37",OracleType.Number).Value=m_c37;
					cmd.Parameters.Add("m_c38",OracleType.Number).Value=m_c38;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"kh_bieu_06");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_kh06_(long m_id,int m_ma,string m_ngay,int m_c01,int m_c02,
			int m_c03,int m_c04,int m_c05,int m_c06,int m_c07,int m_c08,int m_c09,
			int m_c10,int m_c11,int m_c12,int m_c13,int m_c14,int m_c15,int m_c16,
			int m_c17,int m_c18,int m_c19,int m_c20,int m_c21,int m_c22,int m_c23,
			int m_c24,int m_c25,int m_c26,int m_c27,int m_c28,int m_c29,int m_c30,
			int m_c31,int m_userid)
		{
			sql="update kh_bieu_06 set ngay=:m_ngay,c01=:m_c01,c02=:m_c02,c03=:m_c03,c04=:m_c04,";
			sql+="c05=:m_c05,c06=:m_c06,c07=:m_c07,c08=:m_c08,c09=:m_c09,c10=:m_c10,";
			sql+="c11=:m_c11,c12=:m_c12,c13=:m_c13,c14=:m_c14,c15=:m_c15,c16=:m_c16,c17=:m_c17,";
			sql+="c18=:m_c18,c19=:m_c19,c20=:m_c20,c21=:m_c21,c22=:m_c22,c23=:m_c23,c24=:m_c24,";
			sql+="c25=:m_c25,c26=:m_c26,c27=:m_c27,c28=:m_c28,c29=:m_c29,c30=:m_c30,c31=:m_c31,";
			sql+="userid=:m_userid where id=:m_id and ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
				cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
				cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
				cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
				cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
				cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
				cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
				cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
				cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
				cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
				cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
				cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
				cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
				cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
				cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
				cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
				cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
				cmd.Parameters.Add("m_c18",OracleType.Number).Value=m_c18;
				cmd.Parameters.Add("m_c19",OracleType.Number).Value=m_c19;
				cmd.Parameters.Add("m_c20",OracleType.Number).Value=m_c20;
				cmd.Parameters.Add("m_c21",OracleType.Number).Value=m_c21;
				cmd.Parameters.Add("m_c22",OracleType.Number).Value=m_c22;
				cmd.Parameters.Add("m_c23",OracleType.Number).Value=m_c23;
				cmd.Parameters.Add("m_c24",OracleType.Number).Value=m_c24;
				cmd.Parameters.Add("m_c25",OracleType.Number).Value=m_c25;
				cmd.Parameters.Add("m_c26",OracleType.Number).Value=m_c26;
				cmd.Parameters.Add("m_c27",OracleType.Number).Value=m_c27;
				cmd.Parameters.Add("m_c28",OracleType.Number).Value=m_c28;
				cmd.Parameters.Add("m_c29",OracleType.Number).Value=m_c29;
				cmd.Parameters.Add("m_c30",OracleType.Number).Value=m_c30;
				cmd.Parameters.Add("m_c31",OracleType.Number).Value=m_c31;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into kh_bieu_06(id,ma,ngay,c01,c02,c03,c04,c05,c06,c07,c08,c09,c10,c11,c12,c13,c14,c15,c16,c17,c18,c19,c20,c21,c22,c23,c24,c25,c26,c27,c28,c29,c30,c31,userid,ngayud) values ";
					sql+="(:m_id,:m_ma,:m_ngay,:m_c01,:m_c02,:m_c03,:m_c04,:m_c05,:m_c06,:m_c07,:m_c08,:m_c09,:m_c10,:m_c11,:m_c12,:m_c13,:m_c14,:m_c15,:m_c16,:m_c17,:m_c18,:m_c19,:m_c20,:m_c21,:m_c22,:m_c23,:m_c24,:m_c25,:m_c26,:m_c27,:m_c28,:m_c29,:m_c30,:m_c31,:m_userid,sysdate)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
					cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
					cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
					cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
					cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
					cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
					cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
					cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
					cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
					cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
					cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
					cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
					cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
					cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
					cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
					cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
					cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
					cmd.Parameters.Add("m_c18",OracleType.Number).Value=m_c18;
					cmd.Parameters.Add("m_c19",OracleType.Number).Value=m_c19;
					cmd.Parameters.Add("m_c20",OracleType.Number).Value=m_c20;
					cmd.Parameters.Add("m_c21",OracleType.Number).Value=m_c21;
					cmd.Parameters.Add("m_c22",OracleType.Number).Value=m_c22;
					cmd.Parameters.Add("m_c23",OracleType.Number).Value=m_c23;
					cmd.Parameters.Add("m_c24",OracleType.Number).Value=m_c24;
					cmd.Parameters.Add("m_c25",OracleType.Number).Value=m_c25;
					cmd.Parameters.Add("m_c26",OracleType.Number).Value=m_c26;
					cmd.Parameters.Add("m_c27",OracleType.Number).Value=m_c27;
					cmd.Parameters.Add("m_c28",OracleType.Number).Value=m_c28;
					cmd.Parameters.Add("m_c29",OracleType.Number).Value=m_c29;
					cmd.Parameters.Add("m_c30",OracleType.Number).Value=m_c30;
					cmd.Parameters.Add("m_c31",OracleType.Number).Value=m_c31;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"kh_bieu_06");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_kh07(long m_id,int m_ma,string m_ngay,int m_c01,int m_c02,
			int m_c03,int m_c04,int m_c05,int m_c06,int m_c07,int m_c08,int m_c09,int m_userid,string m_c10)
		{
			sql="update kh_bieu_07 set ngay=:m_ngay,c01=:m_c01,c02=:m_c02,c03=:m_c03,c04=:m_c04,";
			sql+="c05=:m_c05,c06=:m_c06,c07=:m_c07,c08=:m_c08,c09=:m_c09,";
			sql+="userid=:m_userid,c10=:m_c10 where id=:m_id and ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
				cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
				cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
				cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
				cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
				cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
				cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
				cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
				cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_c10",OracleType.NVarChar,200).Value=m_c10;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into kh_bieu_07(id,ma,ngay,c01,c02,c03,c04,c05,c06,c07,c08,c09,userid,ngayud,c10) values ";
					sql+="(:m_id,:m_ma,:m_ngay,:m_c01,:m_c02,:m_c03,:m_c04,:m_c05,:m_c06,:m_c07,:m_c08,:m_c09,:m_userid,sysdate,:m_c10)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
					cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
					cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
					cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
					cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
					cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
					cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
					cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
					cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					cmd.Parameters.Add("m_c10",OracleType.NVarChar,200).Value=m_c10;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"kh_bieu_07");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_kh15(long m_id,int m_ma,string m_ngay,int m_c01,int m_c02,
			int m_c03,int m_c04,int m_c05,int m_c06,int m_userid,int m_c07,int m_c08,
			int m_c09,int m_c10,int m_c11,int m_c12)
		{
			sql="update kh_bieu_15 set ngay=:m_ngay,c01=:m_c01,c02=:m_c02,c03=:m_c03,c04=:m_c04,";
			sql+="c05=:m_c05,c06=:m_c06,userid=:m_userid,";
			sql+="c07=:m_c07,c08=:m_c08,c09=:m_c09,c10=:m_c10,c11=:m_c11,c12=:m_c12 where id=:m_id and ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
				cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
				cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
				cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
				cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
				cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
				cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
				cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
				cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
				cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
				cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into kh_bieu_15(id,ma,ngay,c01,c02,c03,c04,c05,c06,userid,ngayud,c07,c08,c09,c10,c11,c12) values ";
					sql+="(:m_id,:m_ma,:m_ngay,:m_c01,:m_c02,:m_c03,:m_c04,:m_c05,:m_c06,:m_userid,sysdate,:m_c07,:m_c08,:m_c09,:m_c10,:m_c11,:m_c12)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
					cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
					cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
					cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
					cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
					cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
					cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
					cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
					cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
					cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
					cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"kh_bieu_15");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_kh09(long m_id,int m_ma,string m_ngay,int m_c01,int m_c02,
			int m_c03,int m_c04,int m_c05,int m_c06,int m_c07,int m_c08,int m_c09,
			int m_c10,int m_c11,int m_c12,int m_c13,int m_c14,int m_c15,int m_c16,
			int m_c17,int m_c18,int m_c19,int m_c20,int m_c21,int m_c22,int m_c23,
			int m_c24,int m_c25,int m_c26,int m_c27,int m_c28,int m_c29,int m_c30,int m_userid)
		{
			sql="update kh_bieu_09 set ngay=:m_ngay,c01=:m_c01,c02=:m_c02,c03=:m_c03,c04=:m_c04,";
			sql+="c05=:m_c05,c06=:m_c06,c07=:m_c07,c08=:m_c08,c09=:m_c09,c10=:m_c10,";
			sql+="c11=:m_c11,c12=:m_c12,c13=:m_c13,c14=:m_c14,c15=:m_c15,c16=:m_c16,c17=:m_c17,";
			sql+="c18=:m_c18,c19=:m_c19,c20=:m_c20,c21=:m_c21,c22=:m_c22,c23=:m_c23,c24=:m_c24,";
			sql+="c25=:m_c25,c26=:m_c26,c27=:m_c27,c28=:m_c28,c29=:m_c29,c30=:m_c30,";
			sql+="userid=:m_userid where id=:m_id and ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
				cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
				cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
				cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
				cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
				cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
				cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
				cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
				cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
				cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
				cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
				cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
				cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
				cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
				cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
				cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
				cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
				cmd.Parameters.Add("m_c18",OracleType.Number).Value=m_c18;
				cmd.Parameters.Add("m_c19",OracleType.Number).Value=m_c19;
				cmd.Parameters.Add("m_c20",OracleType.Number).Value=m_c20;
				cmd.Parameters.Add("m_c21",OracleType.Number).Value=m_c21;
				cmd.Parameters.Add("m_c22",OracleType.Number).Value=m_c22;
				cmd.Parameters.Add("m_c23",OracleType.Number).Value=m_c23;
				cmd.Parameters.Add("m_c24",OracleType.Number).Value=m_c24;
				cmd.Parameters.Add("m_c25",OracleType.Number).Value=m_c25;
				cmd.Parameters.Add("m_c26",OracleType.Number).Value=m_c26;
				cmd.Parameters.Add("m_c27",OracleType.Number).Value=m_c27;
				cmd.Parameters.Add("m_c28",OracleType.Number).Value=m_c28;
				cmd.Parameters.Add("m_c29",OracleType.Number).Value=m_c29;
				cmd.Parameters.Add("m_c30",OracleType.Number).Value=m_c30;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into kh_bieu_09(id,ma,ngay,c01,c02,c03,c04,c05,c06,c07,c08,c09,c10,c11,c12,c13,c14,c15,c16,c17,c18,c19,c20,c21,c22,c23,c24,c25,c26,c27,c28,c29,c30,userid,ngayud) values ";
					sql+="(:m_id,:m_ma,:m_ngay,:m_c01,:m_c02,:m_c03,:m_c04,:m_c05,:m_c06,:m_c07,:m_c08,:m_c09,:m_c10,:m_c11,:m_c12,:m_c13,:m_c14,:m_c15,:m_c16,:m_c17,:m_c18,:m_c19,:m_c20,:m_c21,:m_c22,:m_c23,:m_c24,:m_c25,:m_c26,:m_c27,:m_c28,:m_c29,:m_c30,:m_userid,sysdate)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
					cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
					cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
					cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
					cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
					cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
					cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
					cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
					cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
					cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
					cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
					cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
					cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
					cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
					cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
					cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
					cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
					cmd.Parameters.Add("m_c18",OracleType.Number).Value=m_c18;
					cmd.Parameters.Add("m_c19",OracleType.Number).Value=m_c19;
					cmd.Parameters.Add("m_c20",OracleType.Number).Value=m_c20;
					cmd.Parameters.Add("m_c21",OracleType.Number).Value=m_c21;
					cmd.Parameters.Add("m_c22",OracleType.Number).Value=m_c22;
					cmd.Parameters.Add("m_c23",OracleType.Number).Value=m_c23;
					cmd.Parameters.Add("m_c24",OracleType.Number).Value=m_c24;
					cmd.Parameters.Add("m_c25",OracleType.Number).Value=m_c25;
					cmd.Parameters.Add("m_c26",OracleType.Number).Value=m_c26;
					cmd.Parameters.Add("m_c27",OracleType.Number).Value=m_c27;
					cmd.Parameters.Add("m_c28",OracleType.Number).Value=m_c28;
					cmd.Parameters.Add("m_c29",OracleType.Number).Value=m_c29;
					cmd.Parameters.Add("m_c30",OracleType.Number).Value=m_c30;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"kh_bieu_09");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		//ThanhCuong 09/04/2012
		public bool upd_kh09(long m_id,int m_ma,string m_ngay,int m_c01,int m_c02,
			int m_c03,int m_c04,int m_c05,int m_c06,int m_c07,int m_c08,int m_c09,
			int m_c10,int m_c11,int m_c12,int m_c13,int m_c14,int m_c15,int m_c16,
			int m_c17,int m_c18,int m_c19,int m_c20,int m_c21,int m_c22,int m_c23,
			int m_c24,int m_c25,int m_c26,int m_c27,int m_c28,int m_c29,int m_c30,int m_userid,string m_stt,int m_tuyen)
		{
			sql="update kh_bieu_09 set ngay=:m_ngay,c01=:m_c01,c02=:m_c02,c03=:m_c03,c04=:m_c04,";
			sql+="c05=:m_c05,c06=:m_c06,c07=:m_c07,c08=:m_c08,c09=:m_c09,c10=:m_c10,";
			sql+="c11=:m_c11,c12=:m_c12,c13=:m_c13,c14=:m_c14,c15=:m_c15,c16=:m_c16,c17=:m_c17,";
			sql+="c18=:m_c18,c19=:m_c19,c20=:m_c20,c21=:m_c21,c22=:m_c22,c23=:m_c23,c24=:m_c24,";
			sql+="c25=:m_c25,c26=:m_c26,c27=:m_c27,c28=:m_c28,c29=:m_c29,c30=:m_c30,";
			sql+="userid=:m_userid where id=:m_id and ma=:m_ma and stt=:m_stt and tuyen=:m_tuyen";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
				cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
				cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
				cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
				cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
				cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
				cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
				cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
				cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
				cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
				cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
				cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
				cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
				cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
				cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
				cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
				cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
				cmd.Parameters.Add("m_c18",OracleType.Number).Value=m_c18;
				cmd.Parameters.Add("m_c19",OracleType.Number).Value=m_c19;
				cmd.Parameters.Add("m_c20",OracleType.Number).Value=m_c20;
				cmd.Parameters.Add("m_c21",OracleType.Number).Value=m_c21;
				cmd.Parameters.Add("m_c22",OracleType.Number).Value=m_c22;
				cmd.Parameters.Add("m_c23",OracleType.Number).Value=m_c23;
				cmd.Parameters.Add("m_c24",OracleType.Number).Value=m_c24;
				cmd.Parameters.Add("m_c25",OracleType.Number).Value=m_c25;
				cmd.Parameters.Add("m_c26",OracleType.Number).Value=m_c26;
				cmd.Parameters.Add("m_c27",OracleType.Number).Value=m_c27;
				cmd.Parameters.Add("m_c28",OracleType.Number).Value=m_c28;
				cmd.Parameters.Add("m_c29",OracleType.Number).Value=m_c29;
				cmd.Parameters.Add("m_c30",OracleType.Number).Value=m_c30;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				cmd.Parameters.Add("m_stt",OracleType.VarChar).Value=m_stt;
				cmd.Parameters.Add("m_tuyen",OracleType.Number).Value=m_tuyen;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into kh_bieu_09(id,ma,ngay,c01,c02,c03,c04,c05,c06,c07,c08,c09,c10,c11,c12,c13,c14,c15,c16,c17,c18,c19,c20,c21,c22,c23,c24,c25,c26,c27,c28,c29,c30,userid,ngayud,stt,tuyen) values ";
					sql+="(:m_id,:m_ma,:m_ngay,:m_c01,:m_c02,:m_c03,:m_c04,:m_c05,:m_c06,:m_c07,:m_c08,:m_c09,:m_c10,:m_c11,:m_c12,:m_c13,:m_c14,:m_c15,:m_c16,:m_c17,:m_c18,:m_c19,:m_c20,:m_c21,:m_c22,:m_c23,:m_c24,:m_c25,:m_c26,:m_c27,:m_c28,:m_c29,:m_c30,:m_userid,sysdate,:m_stt,:m_tuyen)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
					cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
					cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
					cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
					cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
					cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
					cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
					cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
					cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
					cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
					cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
					cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
					cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
					cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
					cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
					cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
					cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
					cmd.Parameters.Add("m_c18",OracleType.Number).Value=m_c18;
					cmd.Parameters.Add("m_c19",OracleType.Number).Value=m_c19;
					cmd.Parameters.Add("m_c20",OracleType.Number).Value=m_c20;
					cmd.Parameters.Add("m_c21",OracleType.Number).Value=m_c21;
					cmd.Parameters.Add("m_c22",OracleType.Number).Value=m_c22;
					cmd.Parameters.Add("m_c23",OracleType.Number).Value=m_c23;
					cmd.Parameters.Add("m_c24",OracleType.Number).Value=m_c24;
					cmd.Parameters.Add("m_c25",OracleType.Number).Value=m_c25;
					cmd.Parameters.Add("m_c26",OracleType.Number).Value=m_c26;
					cmd.Parameters.Add("m_c27",OracleType.Number).Value=m_c27;
					cmd.Parameters.Add("m_c28",OracleType.Number).Value=m_c28;
					cmd.Parameters.Add("m_c29",OracleType.Number).Value=m_c29;
					cmd.Parameters.Add("m_c30",OracleType.Number).Value=m_c30;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					cmd.Parameters.Add("m_stt",OracleType.VarChar).Value=m_stt;
					cmd.Parameters.Add("m_tuyen",OracleType.Number).Value=m_tuyen;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"kh_bieu_09");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}
		//End ThanhCuong 09/04/20112
		public bool upd_kh10(long m_id,int m_ma,string m_ngay,int m_c01,int m_c02,
			int m_c03,int m_c04,int m_c05,int m_c06,int m_c07,int m_c08,int m_c09,
			int m_c10,int m_c11,int m_c12,int m_c13,int m_c14,int m_c15,int m_c16,
			int m_c17,int m_c18,int m_c19,int m_c20,int m_c21,int m_c22,int m_c23,
			int m_c24,int m_c25,int m_c26,int m_c27,int m_c28,int m_c29,int m_c30,int m_userid)
		{
			sql="update kh_bieu_10 set ngay=:m_ngay,c01=:m_c01,c02=:m_c02,c03=:m_c03,c04=:m_c04,";
			sql+="c05=:m_c05,c06=:m_c06,c07=:m_c07,c08=:m_c08,c09=:m_c09,c10=:m_c10,";
			sql+="c11=:m_c11,c12=:m_c12,c13=:m_c13,c14=:m_c14,c15=:m_c15,c16=:m_c16,c17=:m_c17,";
			sql+="c18=:m_c18,c19=:m_c19,c20=:m_c20,c21=:m_c21,c22=:m_c22,c23=:m_c23,c24=:m_c24,";
			sql+="c25=:m_c25,c26=:m_c26,c27=:m_c27,c28=:m_c28,c29=:m_c29,c30=:m_c30,";
			sql+="userid=:m_userid where id=:m_id and ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
				cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
				cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
				cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
				cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
				cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
				cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
				cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
				cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
				cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
				cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
				cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
				cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
				cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
				cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
				cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
				cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
				cmd.Parameters.Add("m_c18",OracleType.Number).Value=m_c18;
				cmd.Parameters.Add("m_c19",OracleType.Number).Value=m_c19;
				cmd.Parameters.Add("m_c20",OracleType.Number).Value=m_c20;
				cmd.Parameters.Add("m_c21",OracleType.Number).Value=m_c21;
				cmd.Parameters.Add("m_c22",OracleType.Number).Value=m_c22;
				cmd.Parameters.Add("m_c23",OracleType.Number).Value=m_c23;
				cmd.Parameters.Add("m_c24",OracleType.Number).Value=m_c24;
				cmd.Parameters.Add("m_c25",OracleType.Number).Value=m_c25;
				cmd.Parameters.Add("m_c26",OracleType.Number).Value=m_c26;
				cmd.Parameters.Add("m_c27",OracleType.Number).Value=m_c27;
				cmd.Parameters.Add("m_c28",OracleType.Number).Value=m_c28;
				cmd.Parameters.Add("m_c29",OracleType.Number).Value=m_c29;
				cmd.Parameters.Add("m_c30",OracleType.Number).Value=m_c30;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;

				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into kh_bieu_10(id,ma,ngay,c01,c02,c03,c04,c05,c06,c07,c08,c09,c10,c11,c12,c13,c14,c15,c16,c17,c18,c19,c20,c21,c22,c23,c24,c25,c26,c27,c28,c29,c30,userid,ngayud) values ";
					sql+="(:m_id,:m_ma,:m_ngay,:m_c01,:m_c02,:m_c03,:m_c04,:m_c05,:m_c06,:m_c07,:m_c08,:m_c09,:m_c10,:m_c11,:m_c12,:m_c13,:m_c14,:m_c15,:m_c16,:m_c17,:m_c18,:m_c19,:m_c20,:m_c21,:m_c22,:m_c23,:m_c24,:m_c25,:m_c26,:m_c27,:m_c28,:m_c29,:m_c30,:m_userid,sysdate)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
					cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
					cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
					cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
					cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
					cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
					cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
					cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
					cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
					cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
					cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
					cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
					cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
					cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
					cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
					cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
					cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
					cmd.Parameters.Add("m_c18",OracleType.Number).Value=m_c18;
					cmd.Parameters.Add("m_c19",OracleType.Number).Value=m_c19;
					cmd.Parameters.Add("m_c20",OracleType.Number).Value=m_c20;
					cmd.Parameters.Add("m_c21",OracleType.Number).Value=m_c21;
					cmd.Parameters.Add("m_c22",OracleType.Number).Value=m_c22;
					cmd.Parameters.Add("m_c23",OracleType.Number).Value=m_c23;
					cmd.Parameters.Add("m_c24",OracleType.Number).Value=m_c24;
					cmd.Parameters.Add("m_c25",OracleType.Number).Value=m_c25;
					cmd.Parameters.Add("m_c26",OracleType.Number).Value=m_c26;
					cmd.Parameters.Add("m_c27",OracleType.Number).Value=m_c27;
					cmd.Parameters.Add("m_c28",OracleType.Number).Value=m_c28;
					cmd.Parameters.Add("m_c29",OracleType.Number).Value=m_c29;
					cmd.Parameters.Add("m_c30",OracleType.Number).Value=m_c30;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"kh_bieu_10");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		//ThanhCuong 05/04/2012
		public bool upd_kh10(long m_id,int m_ma,string m_ngay,int m_c01,int m_c02,
			int m_c03,int m_c04,int m_c05,int m_c06,int m_c07,int m_c08,int m_c09,
			int m_c10,int m_c11,int m_c12,int m_c13,int m_c14,int m_c15,int m_c16,
			int m_c17,int m_c18,int m_c19,int m_c20,int m_c21,int m_c22,int m_c23,
			int m_c24,int m_c25,int m_c26,int m_c27,int m_c28,int m_c29,int m_c30,int m_userid,string m_stt,int m_tuyen)
		{
			sql="update kh_bieu_10 set ngay=:m_ngay,c01=:m_c01,c02=:m_c02,c03=:m_c03,c04=:m_c04,";
			sql+="c05=:m_c05,c06=:m_c06,c07=:m_c07,c08=:m_c08,c09=:m_c09,c10=:m_c10,";
			sql+="c11=:m_c11,c12=:m_c12,c13=:m_c13,c14=:m_c14,c15=:m_c15,c16=:m_c16,c17=:m_c17,";
			sql+="c18=:m_c18,c19=:m_c19,c20=:m_c20,c21=:m_c21,c22=:m_c22,c23=:m_c23,c24=:m_c24,";
			sql+="c25=:m_c25,c26=:m_c26,c27=:m_c27,c28=:m_c28,c29=:m_c29,c30=:m_c30,";
			sql+="userid=:m_userid where id=:m_id and ma=:m_ma and stt=:m_stt and tuyen=:m_tuyen";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
				cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
				cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
				cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
				cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
				cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
				cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
				cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
				cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
				cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
				cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
				cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
				cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
				cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
				cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
				cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
				cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
				cmd.Parameters.Add("m_c18",OracleType.Number).Value=m_c18;
				cmd.Parameters.Add("m_c19",OracleType.Number).Value=m_c19;
				cmd.Parameters.Add("m_c20",OracleType.Number).Value=m_c20;
				cmd.Parameters.Add("m_c21",OracleType.Number).Value=m_c21;
				cmd.Parameters.Add("m_c22",OracleType.Number).Value=m_c22;
				cmd.Parameters.Add("m_c23",OracleType.Number).Value=m_c23;
				cmd.Parameters.Add("m_c24",OracleType.Number).Value=m_c24;
				cmd.Parameters.Add("m_c25",OracleType.Number).Value=m_c25;
				cmd.Parameters.Add("m_c26",OracleType.Number).Value=m_c26;
				cmd.Parameters.Add("m_c27",OracleType.Number).Value=m_c27;
				cmd.Parameters.Add("m_c28",OracleType.Number).Value=m_c28;
				cmd.Parameters.Add("m_c29",OracleType.Number).Value=m_c29;
				cmd.Parameters.Add("m_c30",OracleType.Number).Value=m_c30;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				cmd.Parameters.Add("m_stt",OracleType.VarChar).Value=m_stt;
				cmd.Parameters.Add("m_tuyen",OracleType.Number).Value=m_tuyen;

				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into kh_bieu_10(id,ma,ngay,c01,c02,c03,c04,c05,c06,c07,c08,c09,c10,c11,c12,c13,c14,c15,c16,c17,c18,c19,c20,c21,c22,c23,c24,c25,c26,c27,c28,c29,c30,userid,ngayud,stt,tuyen) values ";
					sql+="(:m_id,:m_ma,:m_ngay,:m_c01,:m_c02,:m_c03,:m_c04,:m_c05,:m_c06,:m_c07,:m_c08,:m_c09,:m_c10,:m_c11,:m_c12,:m_c13,:m_c14,:m_c15,:m_c16,:m_c17,:m_c18,:m_c19,:m_c20,:m_c21,:m_c22,:m_c23,:m_c24,:m_c25,:m_c26,:m_c27,:m_c28,:m_c29,:m_c30,:m_userid,sysdate,:m_stt,:m_tuyen)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
					cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
					cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
					cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
					cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
					cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
					cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
					cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
					cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
					cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
					cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
					cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
					cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
					cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
					cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
					cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
					cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
					cmd.Parameters.Add("m_c18",OracleType.Number).Value=m_c18;
					cmd.Parameters.Add("m_c19",OracleType.Number).Value=m_c19;
					cmd.Parameters.Add("m_c20",OracleType.Number).Value=m_c20;
					cmd.Parameters.Add("m_c21",OracleType.Number).Value=m_c21;
					cmd.Parameters.Add("m_c22",OracleType.Number).Value=m_c22;
					cmd.Parameters.Add("m_c23",OracleType.Number).Value=m_c23;
					cmd.Parameters.Add("m_c24",OracleType.Number).Value=m_c24;
					cmd.Parameters.Add("m_c25",OracleType.Number).Value=m_c25;
					cmd.Parameters.Add("m_c26",OracleType.Number).Value=m_c26;
					cmd.Parameters.Add("m_c27",OracleType.Number).Value=m_c27;
					cmd.Parameters.Add("m_c28",OracleType.Number).Value=m_c28;
					cmd.Parameters.Add("m_c29",OracleType.Number).Value=m_c29;
					cmd.Parameters.Add("m_c30",OracleType.Number).Value=m_c30;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					cmd.Parameters.Add("m_stt",OracleType.VarChar).Value=m_stt;
					cmd.Parameters.Add("m_tuyen",OracleType.Number).Value=m_tuyen;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"kh_bieu_10");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}
		//End ThanhCuong 05/04/2012
		public bool upd_kh08(long m_id,int m_ma,string m_ngay,int m_c01,int m_c02,
			int m_c03,int m_c04,int m_c05,string m_c06,int m_userid)
		{
			sql="update kh_bieu_08 set ngay=:m_ngay,c01=:m_c01,c02=:m_c02,c03=:m_c03,c04=:m_c04,";
			sql+="c05=:m_c05,c06=:m_c06,";
			sql+="userid=:m_userid where id=:m_id and ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
				cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
				cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
				cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
				cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
				cmd.Parameters.Add("m_c06",OracleType.NVarChar,200).Value=m_c06;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into kh_bieu_08(id,ma,ngay,c01,c02,c03,c04,c05,c06,userid,ngayud) values ";
					sql+="(:m_id,:m_ma,:m_ngay,:m_c01,:m_c02,:m_c03,:m_c04,:m_c05,:m_c06,:m_userid,sysdate)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
					cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
					cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
					cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
					cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
					cmd.Parameters.Add("m_c06",OracleType.NVarChar,200).Value=m_c06;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"kh_bieu_08");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_kh11(long m_id,int m_ma,string m_ngay,int m_c01,int m_c02,
			int m_c03,int m_c04,int m_c05,int m_c06,int m_c07,int m_c08,int m_c09,
			int m_c10,int m_c11,int m_c12,int m_c13,int m_c14,int m_c15,int m_c16,
			int m_c17,int m_c18,int m_c19,int m_c20,int m_userid)
		{
			sql="update kh_bieu_11 set ngay=:m_ngay,c01=:m_c01,c02=:m_c02,c03=:m_c03,c04=:m_c04,";
			sql+="c05=:m_c05,c06=:m_c06,c07=:m_c07,c08=:m_c08,c09=:m_c09,c10=:m_c10,";
			sql+="c11=:m_c11,c12=:m_c12,c13=:m_c13,c14=:m_c14,c15=:m_c15,c16=:m_c16,c17=:m_c17,";
			sql+="c18=:m_c18,c19=:m_c19,c20=:m_c20,";
			sql+="userid=:m_userid where id=:m_id and ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
				cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
				cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
				cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
				cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
				cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
				cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
				cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
				cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
				cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
				cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
				cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
				cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
				cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
				cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
				cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
				cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
				cmd.Parameters.Add("m_c18",OracleType.Number).Value=m_c18;
				cmd.Parameters.Add("m_c19",OracleType.Number).Value=m_c19;
				cmd.Parameters.Add("m_c20",OracleType.Number).Value=m_c20;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into kh_bieu_11(id,ma,ngay,c01,c02,c03,c04,c05,c06,c07,c08,c09,c10,c11,c12,c13,c14,c15,c16,c17,c18,c19,c20,userid,ngayud) values ";
					sql+="(:m_id,:m_ma,:m_ngay,:m_c01,:m_c02,:m_c03,:m_c04,:m_c05,:m_c06,:m_c07,:m_c08,:m_c09,:m_c10,:m_c11,:m_c12,:m_c13,:m_c14,:m_c15,:m_c16,:m_c17,:m_c18,:m_c19,:m_c20,:m_userid,sysdate)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
					cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
					cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
					cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
					cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
					cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
					cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
					cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
					cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
					cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
					cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
					cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
					cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
					cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
					cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
					cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
					cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
					cmd.Parameters.Add("m_c18",OracleType.Number).Value=m_c18;
					cmd.Parameters.Add("m_c19",OracleType.Number).Value=m_c19;
					cmd.Parameters.Add("m_c20",OracleType.Number).Value=m_c20;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"kh_bieu_11");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		//ThanhCuong 09/04/2012
		public bool upd_kh11(long m_id,int m_ma,string m_ngay,int m_c01,int m_c02,
			int m_c03,int m_c04,int m_c05,int m_c06,int m_c07,int m_c08,int m_c09,
			int m_c10,int m_c11,int m_c12,int m_c13,int m_c14,int m_c15,int m_c16,
			int m_c17,int m_c18,int m_c19,int m_c20,int m_userid,string m_stt,int m_tuyen)
		{
			sql="update kh_bieu_11 set ngay=:m_ngay,c01=:m_c01,c02=:m_c02,c03=:m_c03,c04=:m_c04,";
			sql+="c05=:m_c05,c06=:m_c06,c07=:m_c07,c08=:m_c08,c09=:m_c09,c10=:m_c10,";
			sql+="c11=:m_c11,c12=:m_c12,c13=:m_c13,c14=:m_c14,c15=:m_c15,c16=:m_c16,c17=:m_c17,";
			sql+="c18=:m_c18,c19=:m_c19,c20=:m_c20,";
			sql+="userid=:m_userid where id=:m_id and ma=:m_ma and stt=:m_stt and tuyen=:m_tuyen";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
				cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
				cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
				cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
				cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
				cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
				cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
				cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
				cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
				cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
				cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
				cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
				cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
				cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
				cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
				cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
				cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
				cmd.Parameters.Add("m_c18",OracleType.Number).Value=m_c18;
				cmd.Parameters.Add("m_c19",OracleType.Number).Value=m_c19;
				cmd.Parameters.Add("m_c20",OracleType.Number).Value=m_c20;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				cmd.Parameters.Add("m_stt",OracleType.VarChar).Value=m_stt;
				cmd.Parameters.Add("m_tuyen",OracleType.Number).Value=m_tuyen;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into kh_bieu_11(id,ma,ngay,c01,c02,c03,c04,c05,c06,c07,c08,c09,c10,c11,c12,c13,c14,c15,c16,c17,c18,c19,c20,userid,ngayud,stt,tuyen) values ";
					sql+="(:m_id,:m_ma,:m_ngay,:m_c01,:m_c02,:m_c03,:m_c04,:m_c05,:m_c06,:m_c07,:m_c08,:m_c09,:m_c10,:m_c11,:m_c12,:m_c13,:m_c14,:m_c15,:m_c16,:m_c17,:m_c18,:m_c19,:m_c20,:m_userid,sysdate,:m_stt,:m_tuyen)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
					cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
					cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
					cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
					cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
					cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
					cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
					cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
					cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
					cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
					cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
					cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
					cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
					cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
					cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
					cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
					cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
					cmd.Parameters.Add("m_c18",OracleType.Number).Value=m_c18;
					cmd.Parameters.Add("m_c19",OracleType.Number).Value=m_c19;
					cmd.Parameters.Add("m_c20",OracleType.Number).Value=m_c20;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					cmd.Parameters.Add("m_stt",OracleType.VarChar).Value=m_stt;
					cmd.Parameters.Add("m_tuyen",OracleType.Number).Value=m_tuyen;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"kh_bieu_11");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}
		//End ThanhCuong 09/04/2012
		public bool upd_kh121(long m_id,int m_ma,string m_ngay,int m_c01,int m_c02,
			int m_c03,int m_c04,int m_c05,int m_c06,int m_c07,int m_c08,int m_c09,
			int m_c10,int m_c11,int m_c12,int m_c13,int m_c14,int m_c15,int m_c16,
			int m_c17,int m_userid)
		{
			sql="update kh_bieu_121 set ngay=:m_ngay,c01=:m_c01,c02=:m_c02,c03=:m_c03,c04=:m_c04,";
			sql+="c05=:m_c05,c06=:m_c06,c07=:m_c07,c08=:m_c08,c09=:m_c09,c10=:m_c10,";
			sql+="c11=:m_c11,c12=:m_c12,c13=:m_c13,c14=:m_c14,c15=:m_c15,c16=:m_c16,c17=:m_c17,";
			sql+="userid=:m_userid where id=:m_id and ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
				cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
				cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
				cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
				cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
				cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
				cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
				cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
				cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
				cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
				cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
				cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
				cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
				cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
				cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
				cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
				cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into kh_bieu_121(id,ma,ngay,c01,c02,c03,c04,c05,c06,c07,c08,c09,c10,c11,c12,c13,c14,c15,c16,c17,userid,ngayud) values ";
					sql+="(:m_id,:m_ma,:m_ngay,:m_c01,:m_c02,:m_c03,:m_c04,:m_c05,:m_c06,:m_c07,:m_c08,:m_c09,:m_c10,:m_c11,:m_c12,:m_c13,:m_c14,:m_c15,:m_c16,:m_c17,:m_userid,sysdate)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
					cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
					cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
					cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
					cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
					cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
					cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
					cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
					cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
					cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
					cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
					cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
					cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
					cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
					cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
					cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
					cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"kh_bieu_121");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		//ThanhCuong 09/04/2012
		public bool upd_kh121(long m_id,int m_ma,string m_ngay,int m_c01,int m_c02,
			int m_c03,int m_c04,int m_c05,int m_c06,int m_c07,int m_c08,int m_c09,
			int m_c10,int m_c11,int m_c12,int m_c13,int m_c14,int m_c15,int m_c16,
			int m_c17,int m_userid,string m_stt,int m_tuyen)
		{
			sql="update kh_bieu_121 set ngay=:m_ngay,c01=:m_c01,c02=:m_c02,c03=:m_c03,c04=:m_c04,";
			sql+="c05=:m_c05,c06=:m_c06,c07=:m_c07,c08=:m_c08,c09=:m_c09,c10=:m_c10,";
			sql+="c11=:m_c11,c12=:m_c12,c13=:m_c13,c14=:m_c14,c15=:m_c15,c16=:m_c16,c17=:m_c17,";
			sql+="userid=:m_userid where id=:m_id and ma=:m_ma and stt=:m_stt and tuyen=:m_tuyen";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
				cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
				cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
				cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
				cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
				cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
				cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
				cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
				cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
				cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
				cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
				cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
				cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
				cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
				cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
				cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
				cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				cmd.Parameters.Add("m_stt",OracleType.VarChar).Value=m_stt;
				cmd.Parameters.Add("m_tuyen",OracleType.Number).Value=m_tuyen;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into kh_bieu_121(id,ma,ngay,c01,c02,c03,c04,c05,c06,c07,c08,c09,c10,c11,c12,c13,c14,c15,c16,c17,userid,ngayud,stt,tuyen) values ";
					sql+="(:m_id,:m_ma,:m_ngay,:m_c01,:m_c02,:m_c03,:m_c04,:m_c05,:m_c06,:m_c07,:m_c08,:m_c09,:m_c10,:m_c11,:m_c12,:m_c13,:m_c14,:m_c15,:m_c16,:m_c17,:m_userid,sysdate,:m_stt,:m_tuyen)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
					cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
					cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
					cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
					cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
					cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
					cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
					cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
					cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
					cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
					cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
					cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
					cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
					cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
					cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
					cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
					cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					cmd.Parameters.Add("m_stt",OracleType.VarChar).Value=m_stt;
					cmd.Parameters.Add("m_tuyen",OracleType.Number).Value=m_tuyen;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"kh_bieu_121");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}
		//End ThanhCuong 09/04/2012
		public bool upd_kh122(long m_id,int m_ma,string m_ngay,int m_c01,int m_c02,
			int m_c03,int m_c04,int m_c05,int m_c06,int m_c07,int m_c08,int m_c09,
			int m_c10,int m_c11,int m_c12,int m_c13,int m_c14,int m_c15,int m_c16,
			int m_c17,int m_c18,int m_c19,int m_userid)
		{
			sql="update kh_bieu_122 set ngay=:m_ngay,c01=:m_c01,c02=:m_c02,c03=:m_c03,c04=:m_c04,";
			sql+="c05=:m_c05,c06=:m_c06,c07=:m_c07,c08=:m_c08,c09=:m_c09,c10=:m_c10,";
			sql+="c11=:m_c11,c12=:m_c12,c13=:m_c13,c14=:m_c14,c15=:m_c15,c16=:m_c16,c17=:m_c17,";
			sql+="c18=:m_c18,c19=:m_c19,userid=:m_userid where id=:m_id and ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
				cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
				cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
				cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
				cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
				cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
				cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
				cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
				cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
				cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
				cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
				cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
				cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
				cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
				cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
				cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
				cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
				cmd.Parameters.Add("m_c18",OracleType.Number).Value=m_c18;
				cmd.Parameters.Add("m_c19",OracleType.Number).Value=m_c19;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into kh_bieu_122(id,ma,ngay,c01,c02,c03,c04,c05,c06,c07,c08,c09,c10,c11,c12,c13,c14,c15,c16,c17,c18,c19,userid,ngayud) values ";
					sql+="(:m_id,:m_ma,:m_ngay,:m_c01,:m_c02,:m_c03,:m_c04,:m_c05,:m_c06,:m_c07,:m_c08,:m_c09,:m_c10,:m_c11,:m_c12,:m_c13,:m_c14,:m_c15,:m_c16,:m_c17,:m_c18,:m_c19,:m_userid,sysdate)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
					cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
					cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
					cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
					cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
					cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
					cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
					cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
					cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
					cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
					cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
					cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
					cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
					cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
					cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
					cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
					cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
					cmd.Parameters.Add("m_c18",OracleType.Number).Value=m_c18;
					cmd.Parameters.Add("m_c19",OracleType.Number).Value=m_c19;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"kh_bieu_122");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		//ThanhCuong 09/04/2012
		public bool upd_kh122(long m_id,int m_ma,string m_ngay,int m_c01,int m_c02,
			int m_c03,int m_c04,int m_c05,int m_c06,int m_c07,int m_c08,int m_c09,
			int m_c10,int m_c11,int m_c12,int m_c13,int m_c14,int m_c15,int m_c16,
			int m_c17,int m_c18,int m_c19,int m_userid,string m_stt,int m_tuyen)
		{
			sql="update kh_bieu_122 set ngay=:m_ngay,c01=:m_c01,c02=:m_c02,c03=:m_c03,c04=:m_c04,";
			sql+="c05=:m_c05,c06=:m_c06,c07=:m_c07,c08=:m_c08,c09=:m_c09,c10=:m_c10,";
			sql+="c11=:m_c11,c12=:m_c12,c13=:m_c13,c14=:m_c14,c15=:m_c15,c16=:m_c16,c17=:m_c17,";
			sql+="c18=:m_c18,c19=:m_c19,userid=:m_userid where id=:m_id and ma=:m_ma and stt=:m_stt and tuyen=:m_tuyen";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
				cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
				cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
				cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
				cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
				cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
				cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
				cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
				cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
				cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
				cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
				cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
				cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
				cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
				cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
				cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
				cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
				cmd.Parameters.Add("m_c18",OracleType.Number).Value=m_c18;
				cmd.Parameters.Add("m_c19",OracleType.Number).Value=m_c19;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				cmd.Parameters.Add("m_stt",OracleType.VarChar).Value=m_stt;
				cmd.Parameters.Add("m_tuyen",OracleType.Number).Value=m_tuyen;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into kh_bieu_122(id,ma,ngay,c01,c02,c03,c04,c05,c06,c07,c08,c09,c10,c11,c12,c13,c14,c15,c16,c17,c18,c19,userid,ngayud,stt,tuyen) values ";
					sql+="(:m_id,:m_ma,:m_ngay,:m_c01,:m_c02,:m_c03,:m_c04,:m_c05,:m_c06,:m_c07,:m_c08,:m_c09,:m_c10,:m_c11,:m_c12,:m_c13,:m_c14,:m_c15,:m_c16,:m_c17,:m_c18,:m_c19,:m_userid,sysdate,:m_stt,:m_tuyen)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
					cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
					cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
					cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
					cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
					cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
					cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
					cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
					cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
					cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
					cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
					cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
					cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
					cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
					cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
					cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
					cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
					cmd.Parameters.Add("m_c18",OracleType.Number).Value=m_c18;
					cmd.Parameters.Add("m_c19",OracleType.Number).Value=m_c19;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					cmd.Parameters.Add("m_stt",OracleType.VarChar).Value=m_stt;
					cmd.Parameters.Add("m_tuyen",OracleType.Number).Value=m_tuyen;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"kh_bieu_122");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}
		//End ThanhCuong 09/04/2012
		public bool upd_kh123(long m_id,int m_ma,string m_ngay,int m_c01,int m_c02,
			int m_c03,int m_c04,int m_c05,int m_c06,int m_c07,int m_c08,int m_c09,
			int m_c10,int m_c11,int m_c12,int m_c13,int m_c14,int m_c15,int m_c16,
			int m_c17,int m_c18,int m_c19,string m_c20,int m_userid)
		{
			sql="update kh_bieu_123 set ngay=:m_ngay,c01=:m_c01,c02=:m_c02,c03=:m_c03,c04=:m_c04,";
			sql+="c05=:m_c05,c06=:m_c06,c07=:m_c07,c08=:m_c08,c09=:m_c09,c10=:m_c10,";
			sql+="c11=:m_c11,c12=:m_c12,c13=:m_c13,c14=:m_c14,c15=:m_c15,c16=:m_c16,c17=:m_c17,";
			sql+="c18=:m_c18,c19=:m_c19,c20=:m_c20,userid=:m_userid where id=:m_id and ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
				cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
				cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
				cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
				cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
				cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
				cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
				cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
				cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
				cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
				cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
				cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
				cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
				cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
				cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
				cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
				cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
				cmd.Parameters.Add("m_c18",OracleType.Number).Value=m_c18;
				cmd.Parameters.Add("m_c19",OracleType.Number).Value=m_c19;
				cmd.Parameters.Add("m_c20",OracleType.NVarChar,200).Value=m_c20;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into kh_bieu_123(id,ma,ngay,c01,c02,c03,c04,c05,c06,c07,c08,c09,c10,c11,c12,c13,c14,c15,c16,c17,c18,c19,c20,userid,ngayud) values ";
					sql+="(:m_id,:m_ma,:m_ngay,:m_c01,:m_c02,:m_c03,:m_c04,:m_c05,:m_c06,:m_c07,:m_c08,:m_c09,:m_c10,:m_c11,:m_c12,:m_c13,:m_c14,:m_c15,:m_c16,:m_c17,:m_c18,:m_c19,:m_c20,:m_userid,sysdate)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
					cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
					cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
					cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
					cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
					cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
					cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
					cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
					cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
					cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
					cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
					cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
					cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
					cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
					cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
					cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
					cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
					cmd.Parameters.Add("m_c18",OracleType.Number).Value=m_c18;
					cmd.Parameters.Add("m_c19",OracleType.Number).Value=m_c19;
					cmd.Parameters.Add("m_c20",OracleType.NVarChar,200).Value=m_c20;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"kh_bieu_123");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_kh124(long m_id,int m_ma,string m_ngay,int m_c01,int m_c02,
			int m_c03,int m_c04,int m_c05,int m_c06,int m_c07,int m_c08,int m_c09,
			int m_c10,int m_c11,int m_c12,int m_c13,int m_c14,int m_c15,int m_c16,
			int m_c17,int m_c18,int m_c19,int m_c20,int m_c21,int m_c22,int m_c23,int m_c24,int m_userid)
		{
			sql="update kh_bieu_124 set ngay=:m_ngay,c01=:m_c01,c02=:m_c02,c03=:m_c03,c04=:m_c04,";
			sql+="c05=:m_c05,c06=:m_c06,c07=:m_c07,c08=:m_c08,c09=:m_c09,c10=:m_c10,";
			sql+="c11=:m_c11,c12=:m_c12,c13=:m_c13,c14=:m_c14,c15=:m_c15,c16=:m_c16,c17=:m_c17,";
			sql+="c18=:m_c18,c19=:m_c19,c20=:m_c20,c21=:m_c21,c22=:m_c22,c23=:m_c23,c24=:m_c24,userid=:m_userid where id=:m_id and ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
				cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
				cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
				cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
				cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
				cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
				cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
				cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
				cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
				cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
				cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
				cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
				cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
				cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
				cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
				cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
				cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
				cmd.Parameters.Add("m_c18",OracleType.Number).Value=m_c18;
				cmd.Parameters.Add("m_c19",OracleType.Number).Value=m_c19;
				cmd.Parameters.Add("m_c20",OracleType.Number).Value=m_c20;
				cmd.Parameters.Add("m_c21",OracleType.Number).Value=m_c21;
				cmd.Parameters.Add("m_c22",OracleType.Number).Value=m_c22;
				cmd.Parameters.Add("m_c23",OracleType.Number).Value=m_c23;
				cmd.Parameters.Add("m_c24",OracleType.Number).Value=m_c24;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into kh_bieu_124(id,ma,ngay,c01,c02,c03,c04,c05,c06,c07,c08,c09,c10,c11,c12,c13,c14,c15,c16,c17,c18,c19,c20,c21,c22,c23,c24,userid,ngayud) values ";
					sql+="(:m_id,:m_ma,:m_ngay,:m_c01,:m_c02,:m_c03,:m_c04,:m_c05,:m_c06,:m_c07,:m_c08,:m_c09,:m_c10,:m_c11,:m_c12,:m_c13,:m_c14,:m_c15,:m_c16,:m_c17,:m_c18,:m_c19,:m_c20,:m_c21,:m_c22,:m_c23,:m_c24,:m_userid,sysdate)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
					cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
					cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
					cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
					cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
					cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
					cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
					cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
					cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
					cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
					cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
					cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
					cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
					cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
					cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
					cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
					cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
					cmd.Parameters.Add("m_c18",OracleType.Number).Value=m_c18;
					cmd.Parameters.Add("m_c19",OracleType.Number).Value=m_c19;
					cmd.Parameters.Add("m_c20",OracleType.Number).Value=m_c20;
					cmd.Parameters.Add("m_c21",OracleType.Number).Value=m_c21;
					cmd.Parameters.Add("m_c22",OracleType.Number).Value=m_c22;
					cmd.Parameters.Add("m_c23",OracleType.Number).Value=m_c23;
					cmd.Parameters.Add("m_c24",OracleType.Number).Value=m_c24;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"kh_bieu_124");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		//ThanhCuong 05/04/2012
		public bool upd_kh124(long m_id,int m_ma,string m_ngay,int m_c01,int m_c02,
			int m_c03,int m_c04,int m_c05,int m_c06,int m_c07,int m_c08,int m_c09,
			int m_c10,int m_c11,int m_c12,int m_c13,int m_c14,int m_c15,int m_c16,
			int m_c17,int m_c18,int m_c19,int m_c20,int m_c21,int m_c22,int m_c23,int m_c24,int m_userid,string m_stt,int m_tuyen)
		{
			sql="update kh_bieu_124 set ngay=:m_ngay,c01=:m_c01,c02=:m_c02,c03=:m_c03,c04=:m_c04,";
			sql+="c05=:m_c05,c06=:m_c06,c07=:m_c07,c08=:m_c08,c09=:m_c09,c10=:m_c10,";
			sql+="c11=:m_c11,c12=:m_c12,c13=:m_c13,c14=:m_c14,c15=:m_c15,c16=:m_c16,c17=:m_c17,";
			sql+="c18=:m_c18,c19=:m_c19,c20=:m_c20,c21=:m_c21,c22=:m_c22,c23=:m_c23,c24=:m_c24,userid=:m_userid where id=:m_id and ma=:m_ma and stt=:m_stt and tuyen=:m_tuyen";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
				cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
				cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
				cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
				cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
				cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
				cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
				cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
				cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
				cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
				cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
				cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
				cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
				cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
				cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
				cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
				cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
				cmd.Parameters.Add("m_c18",OracleType.Number).Value=m_c18;
				cmd.Parameters.Add("m_c19",OracleType.Number).Value=m_c19;
				cmd.Parameters.Add("m_c20",OracleType.Number).Value=m_c20;
				cmd.Parameters.Add("m_c21",OracleType.Number).Value=m_c21;
				cmd.Parameters.Add("m_c22",OracleType.Number).Value=m_c22;
				cmd.Parameters.Add("m_c23",OracleType.Number).Value=m_c23;
				cmd.Parameters.Add("m_c24",OracleType.Number).Value=m_c24;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				cmd.Parameters.Add("m_stt",OracleType.VarChar).Value=m_stt;
				cmd.Parameters.Add("m_tuyen",OracleType.Number).Value=m_tuyen;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into kh_bieu_124(id,ma,ngay,c01,c02,c03,c04,c05,c06,c07,c08,c09,c10,c11,c12,c13,c14,c15,c16,c17,c18,c19,c20,c21,c22,c23,c24,userid,ngayud,stt,tuyen) values ";
					sql+="(:m_id,:m_ma,:m_ngay,:m_c01,:m_c02,:m_c03,:m_c04,:m_c05,:m_c06,:m_c07,:m_c08,:m_c09,:m_c10,:m_c11,:m_c12,:m_c13,:m_c14,:m_c15,:m_c16,:m_c17,:m_c18,:m_c19,:m_c20,:m_c21,:m_c22,:m_c23,:m_c24,:m_userid,sysdate,:m_stt,:m_tuyen)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
					cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
					cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
					cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
					cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
					cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
					cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
					cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
					cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
					cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
					cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
					cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
					cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
					cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
					cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
					cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
					cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
					cmd.Parameters.Add("m_c18",OracleType.Number).Value=m_c18;
					cmd.Parameters.Add("m_c19",OracleType.Number).Value=m_c19;
					cmd.Parameters.Add("m_c20",OracleType.Number).Value=m_c20;
					cmd.Parameters.Add("m_c21",OracleType.Number).Value=m_c21;
					cmd.Parameters.Add("m_c22",OracleType.Number).Value=m_c22;
					cmd.Parameters.Add("m_c23",OracleType.Number).Value=m_c23;
					cmd.Parameters.Add("m_c24",OracleType.Number).Value=m_c24;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					cmd.Parameters.Add("m_stt",OracleType.VarChar).Value=m_stt;
					cmd.Parameters.Add("m_tuyen",OracleType.Number).Value=m_tuyen;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"kh_bieu_124");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}
		//End ThanhCuong 05/04/2012

		public bool upd_kh131(long m_id,int m_ma,string m_ngay,int m_c01,int m_c02,
			int m_c03,int m_c04,int m_c05,int m_c06,int m_c07,int m_c08,int m_c09,
			int m_c10,int m_c11,int m_c12,int m_c13,int m_c14,int m_c15,int m_c16,
			int m_c17,int m_c18,int m_c19,int m_c20,int m_c21,int m_c22,int m_c23,int m_userid, string m_c24)
		{
			sql="update kh_bieu_131 set ngay=:m_ngay,c01=:m_c01,c02=:m_c02,c03=:m_c03,c04=:m_c04,";
			sql+="c05=:m_c05,c06=:m_c06,c07=:m_c07,c08=:m_c08,c09=:m_c09,c10=:m_c10,";
			sql+="c11=:m_c11,c12=:m_c12,c13=:m_c13,c14=:m_c14,c15=:m_c15,c16=:m_c16,c17=:m_c17,";
			sql+="c18=:m_c18,c19=:m_c19,c20=:m_c20,c21=:m_c21,c22=:m_c22,c23=:m_c23,userid=:m_userid,c24=:m_c24 where id=:m_id and ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
				cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
				cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
				cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
				cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
				cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
				cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
				cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
				cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
				cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
				cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
				cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
				cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
				cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
				cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
				cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
				cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
				cmd.Parameters.Add("m_c18",OracleType.Number).Value=m_c18;
				cmd.Parameters.Add("m_c19",OracleType.Number).Value=m_c19;
				cmd.Parameters.Add("m_c20",OracleType.Number).Value=m_c20;
				cmd.Parameters.Add("m_c21",OracleType.Number).Value=m_c21;
				cmd.Parameters.Add("m_c22",OracleType.Number).Value=m_c22;
				cmd.Parameters.Add("m_c23",OracleType.Number).Value=m_c23;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_c24",OracleType.NVarChar,200).Value=m_c24;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into kh_bieu_131(id,ma,ngay,c01,c02,c03,c04,c05,c06,c07,c08,c09,c10,c11,c12,c13,c14,c15,c16,c17,c18,c19,c20,c21,c22,c23,userid,ngayud,c24) values ";
					sql+="(:m_id,:m_ma,:m_ngay,:m_c01,:m_c02,:m_c03,:m_c04,:m_c05,:m_c06,:m_c07,:m_c08,:m_c09,:m_c10,:m_c11,:m_c12,:m_c13,:m_c14,:m_c15,:m_c16,:m_c17,:m_c18,:m_c19,:m_c20,:m_c21,:m_c22,:m_c23,:m_userid,sysdate,:m_c24)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
					cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
					cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
					cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
					cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
					cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
					cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
					cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
					cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
					cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
					cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
					cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
					cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
					cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
					cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
					cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
					cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
					cmd.Parameters.Add("m_c18",OracleType.Number).Value=m_c18;
					cmd.Parameters.Add("m_c19",OracleType.Number).Value=m_c19;
					cmd.Parameters.Add("m_c20",OracleType.Number).Value=m_c20;
					cmd.Parameters.Add("m_c21",OracleType.Number).Value=m_c21;
					cmd.Parameters.Add("m_c22",OracleType.Number).Value=m_c22;
					cmd.Parameters.Add("m_c23",OracleType.Number).Value=m_c23;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					cmd.Parameters.Add("m_c24",OracleType.NVarChar,200).Value=m_c24;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"kh_bieu_131");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_kh132(long m_id,int m_ma,string m_ngay,int m_c01,int m_c02,
			int m_c03,int m_c04,int m_c05,int m_c06,int m_c07,int m_c08,int m_c09,
			int m_c10,int m_c11,int m_c12,int m_c13,int m_c14,int m_c15,int m_c16,
			int m_c17,int m_c18,int m_c19,int m_c20,int m_c21,int m_c22,int m_c23,
			int m_c24,int m_c25,int m_c26,int m_c27,int m_userid)
		{
			sql="update kh_bieu_132 set ngay=:m_ngay,c01=:m_c01,c02=:m_c02,c03=:m_c03,c04=:m_c04,";
			sql+="c05=:m_c05,c06=:m_c06,c07=:m_c07,c08=:m_c08,c09=:m_c09,c10=:m_c10,";
			sql+="c11=:m_c11,c12=:m_c12,c13=:m_c13,c14=:m_c14,c15=:m_c15,c16=:m_c16,c17=:m_c17,";
			sql+="c18=:m_c18,c19=:m_c19,c20=:m_c20,c21=:m_c21,c22=:m_c22,c23=:m_c23,";
			sql+="c24=:m_c24,c25=:m_c25,c26=:m_c26,c27=:m_c27,userid=:m_userid where id=:m_id and ma=:m_ma";
			con=new OracleConnection(sConn);

			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
				cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
				cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
				cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
				cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
				cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
				cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
				cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
				cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
				cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
				cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
				cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
				cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
				cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
				cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
				cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
				cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
				cmd.Parameters.Add("m_c18",OracleType.Number).Value=m_c18;
				cmd.Parameters.Add("m_c19",OracleType.Number).Value=m_c19;
				cmd.Parameters.Add("m_c20",OracleType.Number).Value=m_c20;
				cmd.Parameters.Add("m_c21",OracleType.Number).Value=m_c21;
				cmd.Parameters.Add("m_c22",OracleType.Number).Value=m_c22;
				cmd.Parameters.Add("m_c23",OracleType.Number).Value=m_c23;
				cmd.Parameters.Add("m_c24",OracleType.Number).Value=m_c24;
				cmd.Parameters.Add("m_c25",OracleType.Number).Value=m_c25;
				cmd.Parameters.Add("m_c26",OracleType.Number).Value=m_c26;
				cmd.Parameters.Add("m_c27",OracleType.Number).Value=m_c27;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into kh_bieu_132(id,ma,ngay,c01,c02,c03,c04,c05,c06,c07,c08,c09,c10,c11,c12,c13,c14,c15,c16,c17,c18,c19,c20,c21,c22,c23,c24,c25,c26,c27,userid,ngayud) values ";
					sql+="(:m_id,:m_ma,:m_ngay,:m_c01,:m_c02,:m_c03,:m_c04,:m_c05,:m_c06,:m_c07,:m_c08,:m_c09,:m_c10,:m_c11,:m_c12,:m_c13,:m_c14,:m_c15,:m_c16,:m_c17,:m_c18,:m_c19,:m_c20,:m_c21,:m_c22,:m_c23,:m_c24,:m_c25,:m_c26,:m_c27,:m_userid,sysdate)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
					cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
					cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
					cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
					cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
					cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
					cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
					cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
					cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
					cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
					cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
					cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
					cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
					cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
					cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
					cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
					cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
					cmd.Parameters.Add("m_c18",OracleType.Number).Value=m_c18;
					cmd.Parameters.Add("m_c19",OracleType.Number).Value=m_c19;
					cmd.Parameters.Add("m_c20",OracleType.Number).Value=m_c20;
					cmd.Parameters.Add("m_c21",OracleType.Number).Value=m_c21;
					cmd.Parameters.Add("m_c22",OracleType.Number).Value=m_c22;
					cmd.Parameters.Add("m_c23",OracleType.Number).Value=m_c23;
					cmd.Parameters.Add("m_c24",OracleType.Number).Value=m_c24;
					cmd.Parameters.Add("m_c25",OracleType.Number).Value=m_c25;
					cmd.Parameters.Add("m_c26",OracleType.Number).Value=m_c26;
					cmd.Parameters.Add("m_c27",OracleType.Number).Value=m_c27;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"kh_bieu_132");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		//ThanhCuong 09/04/2012
		public bool upd_kh132(long m_id,int m_ma,string m_ngay,int m_c01,int m_c02,
			int m_c03,int m_c04,int m_c05,int m_c06,int m_c07,int m_c08,int m_c09,
			int m_c10,int m_c11,int m_c12,int m_c13,int m_c14,int m_c15,int m_c16,
			int m_c17,int m_c18,int m_c19,int m_c20,int m_c21,int m_c22,int m_c23,
			int m_c24,int m_c25,int m_c26,int m_c27,int m_userid,string m_stt, int m_tuyen)
		{
			sql="update kh_bieu_132 set ngay=:m_ngay,c01=:m_c01,c02=:m_c02,c03=:m_c03,c04=:m_c04,";
			sql+="c05=:m_c05,c06=:m_c06,c07=:m_c07,c08=:m_c08,c09=:m_c09,c10=:m_c10,";
			sql+="c11=:m_c11,c12=:m_c12,c13=:m_c13,c14=:m_c14,c15=:m_c15,c16=:m_c16,c17=:m_c17,";
			sql+="c18=:m_c18,c19=:m_c19,c20=:m_c20,c21=:m_c21,c22=:m_c22,c23=:m_c23,";
			sql+="c24=:m_c24,c25=:m_c25,c26=:m_c26,c27=:m_c27,userid=:m_userid where id=:m_id and ma=:m_ma and stt=:m_stt and tuyen=:m_tuyen";
			con=new OracleConnection(sConn);

			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
				cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
				cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
				cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
				cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
				cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
				cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
				cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
				cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
				cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
				cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
				cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
				cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
				cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
				cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
				cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
				cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
				cmd.Parameters.Add("m_c18",OracleType.Number).Value=m_c18;
				cmd.Parameters.Add("m_c19",OracleType.Number).Value=m_c19;
				cmd.Parameters.Add("m_c20",OracleType.Number).Value=m_c20;
				cmd.Parameters.Add("m_c21",OracleType.Number).Value=m_c21;
				cmd.Parameters.Add("m_c22",OracleType.Number).Value=m_c22;
				cmd.Parameters.Add("m_c23",OracleType.Number).Value=m_c23;
				cmd.Parameters.Add("m_c24",OracleType.Number).Value=m_c24;
				cmd.Parameters.Add("m_c25",OracleType.Number).Value=m_c25;
				cmd.Parameters.Add("m_c26",OracleType.Number).Value=m_c26;
				cmd.Parameters.Add("m_c27",OracleType.Number).Value=m_c27;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				cmd.Parameters.Add("m_stt",OracleType.VarChar).Value=m_stt;
				cmd.Parameters.Add("m_tuyen",OracleType.Number).Value=m_tuyen;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into kh_bieu_132(id,ma,ngay,c01,c02,c03,c04,c05,c06,c07,c08,c09,c10,c11,c12,c13,c14,c15,c16,c17,c18,c19,c20,c21,c22,c23,c24,c25,c26,c27,userid,ngayud,stt,tuyen) values ";
					sql+="(:m_id,:m_ma,:m_ngay,:m_c01,:m_c02,:m_c03,:m_c04,:m_c05,:m_c06,:m_c07,:m_c08,:m_c09,:m_c10,:m_c11,:m_c12,:m_c13,:m_c14,:m_c15,:m_c16,:m_c17,:m_c18,:m_c19,:m_c20,:m_c21,:m_c22,:m_c23,:m_c24,:m_c25,:m_c26,:m_c27,:m_userid,sysdate,:m_stt,:m_tuyen)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
					cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
					cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
					cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
					cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
					cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
					cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
					cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
					cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
					cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
					cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
					cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
					cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
					cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
					cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
					cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
					cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
					cmd.Parameters.Add("m_c18",OracleType.Number).Value=m_c18;
					cmd.Parameters.Add("m_c19",OracleType.Number).Value=m_c19;
					cmd.Parameters.Add("m_c20",OracleType.Number).Value=m_c20;
					cmd.Parameters.Add("m_c21",OracleType.Number).Value=m_c21;
					cmd.Parameters.Add("m_c22",OracleType.Number).Value=m_c22;
					cmd.Parameters.Add("m_c23",OracleType.Number).Value=m_c23;
					cmd.Parameters.Add("m_c24",OracleType.Number).Value=m_c24;
					cmd.Parameters.Add("m_c25",OracleType.Number).Value=m_c25;
					cmd.Parameters.Add("m_c26",OracleType.Number).Value=m_c26;
					cmd.Parameters.Add("m_c27",OracleType.Number).Value=m_c27;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					cmd.Parameters.Add("m_stt",OracleType.VarChar).Value=m_stt;
					cmd.Parameters.Add("m_tuyen",OracleType.Number).Value=m_tuyen;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"kh_bieu_132");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}
		//End ThanhCuong 09/04/2012
		public bool upd_kh133(long m_id,int m_ma,string m_ngay,int m_c01,int m_c02,
			int m_c03,int m_c04,int m_c05,int m_c06,int m_c07,int m_c08,int m_c09,
			int m_c10,int m_c11,int m_c12,int m_c13,int m_c14,int m_c15,int m_c16,
			int m_c17,int m_c18,int m_c19,int m_c20,int m_c21,int m_c22,int m_c23,
			int m_c24,int m_c25,int m_c26,int m_c27,int m_c28,int m_c29,int m_c30,int m_userid)
		{
			sql="update kh_bieu_133 set ngay=:m_ngay,c01=:m_c01,c02=:m_c02,c03=:m_c03,c04=:m_c04,";
			sql+="c05=:m_c05,c06=:m_c06,c07=:m_c07,c08=:m_c08,c09=:m_c09,c10=:m_c10,";
			sql+="c11=:m_c11,c12=:m_c12,c13=:m_c13,c14=:m_c14,c15=:m_c15,c16=:m_c16,c17=:m_c17,";
			sql+="c18=:m_c18,c19=:m_c19,c20=:m_c20,c21=:m_c21,c22=:m_c22,c23=:m_c23,";
			sql+="c24=:m_c24,c25=:m_c25,c26=:m_c26,c27=:m_c27,c28=:m_c28,c29=:m_c29,c30=:m_c30,userid=:m_userid where id=:m_id and ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
				cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
				cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
				cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
				cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
				cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
				cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
				cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
				cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
				cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
				cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
				cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
				cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
				cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
				cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
				cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
				cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
				cmd.Parameters.Add("m_c18",OracleType.Number).Value=m_c18;
				cmd.Parameters.Add("m_c19",OracleType.Number).Value=m_c19;
				cmd.Parameters.Add("m_c20",OracleType.Number).Value=m_c20;
				cmd.Parameters.Add("m_c21",OracleType.Number).Value=m_c21;
				cmd.Parameters.Add("m_c22",OracleType.Number).Value=m_c22;
				cmd.Parameters.Add("m_c23",OracleType.Number).Value=m_c23;
				cmd.Parameters.Add("m_c24",OracleType.Number).Value=m_c24;
				cmd.Parameters.Add("m_c25",OracleType.Number).Value=m_c25;
				cmd.Parameters.Add("m_c26",OracleType.Number).Value=m_c26;
				cmd.Parameters.Add("m_c27",OracleType.Number).Value=m_c27;
				cmd.Parameters.Add("m_c28",OracleType.Number).Value=m_c28;
				cmd.Parameters.Add("m_c29",OracleType.Number).Value=m_c29;
				cmd.Parameters.Add("m_c30",OracleType.Number).Value=m_c30;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into kh_bieu_133(id,ma,ngay,c01,c02,c03,c04,c05,c06,c07,c08,c09,c10,c11,c12,c13,c14,c15,c16,c17,c18,c19,c20,c21,c22,c23,c24,c25,c26,c27,c28,c29,c30,userid,ngayud) values ";
					sql+="(:m_id,:m_ma,:m_ngay,:m_c01,:m_c02,:m_c03,:m_c04,:m_c05,:m_c06,:m_c07,:m_c08,:m_c09,:m_c10,:m_c11,:m_c12,:m_c13,:m_c14,:m_c15,:m_c16,:m_c17,:m_c18,:m_c19,:m_c20,:m_c21,:m_c22,:m_c23,:m_c24,:m_c25,:m_c26,:m_c27,:m_c28,:m_c29,:m_c30,:m_userid,sysdate)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
					cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
					cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
					cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
					cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
					cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
					cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
					cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
					cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
					cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
					cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
					cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
					cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
					cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
					cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
					cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
					cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
					cmd.Parameters.Add("m_c18",OracleType.Number).Value=m_c18;
					cmd.Parameters.Add("m_c19",OracleType.Number).Value=m_c19;
					cmd.Parameters.Add("m_c20",OracleType.Number).Value=m_c20;
					cmd.Parameters.Add("m_c21",OracleType.Number).Value=m_c21;
					cmd.Parameters.Add("m_c22",OracleType.Number).Value=m_c22;
					cmd.Parameters.Add("m_c23",OracleType.Number).Value=m_c23;
					cmd.Parameters.Add("m_c24",OracleType.Number).Value=m_c24;
					cmd.Parameters.Add("m_c25",OracleType.Number).Value=m_c25;
					cmd.Parameters.Add("m_c26",OracleType.Number).Value=m_c26;
					cmd.Parameters.Add("m_c27",OracleType.Number).Value=m_c27;
					cmd.Parameters.Add("m_c28",OracleType.Number).Value=m_c28;
					cmd.Parameters.Add("m_c29",OracleType.Number).Value=m_c29;
					cmd.Parameters.Add("m_c30",OracleType.Number).Value=m_c30;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"kh_bieu_133");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_kh141(long m_id,int m_ma,string m_ngay,int m_c01,int m_c02,
			int m_c03,int m_c04,int m_c05,int m_c06,int m_c07,int m_c08,int m_c09,
			int m_c10,int m_c11,int m_c12,int m_c13,int m_c14,int m_c15,int m_c16,
			int m_c17,int m_c18,int m_c19,int m_c20,int m_c21,int m_c22,int m_c23,
			int m_c24,int m_c25,int m_c26,int m_c27,int m_c28,int m_userid,int m_c29,int m_c30,
			int m_c31,int m_c32,int m_c33,int m_c34,int m_c35,int m_c36,int m_c37,
			int m_c38,int m_c39,int m_c40,int m_c41,int m_c42,int m_c43,int m_c44,
			int m_c45,int m_c46,int m_c47,int m_c48,int m_c49,int m_c50,int m_c51,
			int m_c52,int m_c53,int m_c54,int m_c55,int m_c56)
		{
			sql="update kh_bieu_141 set ngay=:m_ngay,c01=:m_c01,c02=:m_c02,c03=:m_c03,c04=:m_c04,";
			sql+="c05=:m_c05,c06=:m_c06,c07=:m_c07,c08=:m_c08,c09=:m_c09,c10=:m_c10,";
			sql+="c11=:m_c11,c12=:m_c12,c13=:m_c13,c14=:m_c14,c15=:m_c15,c16=:m_c16,c17=:m_c17,";
			sql+="c18=:m_c18,c19=:m_c19,c20=:m_c20,c21=:m_c21,c22=:m_c22,c23=:m_c23,";
			sql+="c24=:m_c24,c25=:m_c25,c26=:m_c26,c27=:m_c27,c28=:m_c28,userid=:m_userid,c29=:m_c29,c30=:m_c30,c31=:m_c31,c32=:m_c32,";
			sql+="c33=:m_c33,c34=:m_c34,c35=:m_c35,c36=:m_c36,c37=:m_c37,c38=:m_c38,";
			sql+="c39=:m_c39,c40=:m_c40,c41=:m_c41,c42=:m_c42,c43=:m_c43,c44=:m_c44,c45=:m_c45,";
			sql+="c46=:m_c46,c47=:m_c47,c48=:m_c48,c49=:m_c49,c50=:m_c50,c51=:m_c51,";
			sql+="c52=:m_c52,c53=:m_c53,c54=:m_c54,c55=:m_c55,c56=:m_c56 where id=:m_id and ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
				cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
				cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
				cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
				cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
				cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
				cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
				cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
				cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
				cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
				cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
				cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
				cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
				cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
				cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
				cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
				cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
				cmd.Parameters.Add("m_c18",OracleType.Number).Value=m_c18;
				cmd.Parameters.Add("m_c19",OracleType.Number).Value=m_c19;
				cmd.Parameters.Add("m_c20",OracleType.Number).Value=m_c20;
				cmd.Parameters.Add("m_c21",OracleType.Number).Value=m_c21;
				cmd.Parameters.Add("m_c22",OracleType.Number).Value=m_c22;
				cmd.Parameters.Add("m_c23",OracleType.Number).Value=m_c23;
				cmd.Parameters.Add("m_c24",OracleType.Number).Value=m_c24;
				cmd.Parameters.Add("m_c25",OracleType.Number).Value=m_c25;
				cmd.Parameters.Add("m_c26",OracleType.Number).Value=m_c26;
				cmd.Parameters.Add("m_c27",OracleType.Number).Value=m_c27;
				cmd.Parameters.Add("m_c28",OracleType.Number).Value=m_c28;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_c29",OracleType.Number).Value=m_c29;
				cmd.Parameters.Add("m_c30",OracleType.Number).Value=m_c30;
				cmd.Parameters.Add("m_c31",OracleType.Number).Value=m_c31;
				cmd.Parameters.Add("m_c32",OracleType.Number).Value=m_c32;
				cmd.Parameters.Add("m_c33",OracleType.Number).Value=m_c33;
				cmd.Parameters.Add("m_c34",OracleType.Number).Value=m_c34;
				cmd.Parameters.Add("m_c35",OracleType.Number).Value=m_c35;
				cmd.Parameters.Add("m_c36",OracleType.Number).Value=m_c36;
				cmd.Parameters.Add("m_c37",OracleType.Number).Value=m_c37;
				cmd.Parameters.Add("m_c38",OracleType.Number).Value=m_c38;
				cmd.Parameters.Add("m_c39",OracleType.Number).Value=m_c39;
				cmd.Parameters.Add("m_c40",OracleType.Number).Value=m_c40;
				cmd.Parameters.Add("m_c41",OracleType.Number).Value=m_c41;
				cmd.Parameters.Add("m_c42",OracleType.Number).Value=m_c42;
				cmd.Parameters.Add("m_c43",OracleType.Number).Value=m_c43;
				cmd.Parameters.Add("m_c44",OracleType.Number).Value=m_c44;
				cmd.Parameters.Add("m_c45",OracleType.Number).Value=m_c45;
				cmd.Parameters.Add("m_c46",OracleType.Number).Value=m_c46;
				cmd.Parameters.Add("m_c47",OracleType.Number).Value=m_c47;
				cmd.Parameters.Add("m_c48",OracleType.Number).Value=m_c48;
				cmd.Parameters.Add("m_c49",OracleType.Number).Value=m_c49;
				cmd.Parameters.Add("m_c50",OracleType.Number).Value=m_c50;
				cmd.Parameters.Add("m_c51",OracleType.Number).Value=m_c51;
				cmd.Parameters.Add("m_c52",OracleType.Number).Value=m_c52;
				cmd.Parameters.Add("m_c53",OracleType.Number).Value=m_c53;
				cmd.Parameters.Add("m_c54",OracleType.Number).Value=m_c54;
				cmd.Parameters.Add("m_c55",OracleType.Number).Value=m_c55;
				cmd.Parameters.Add("m_c56",OracleType.Number).Value=m_c56;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into kh_bieu_141(id,ma,ngay,c01,c02,c03,c04,c05,c06,c07,c08,c09,c10,c11,c12,c13,c14,c15,c16,c17,c18,c19,c20,c21,c22,c23,c24,c25,c26,c27,c28,userid,ngayud";
					sql+=",c29,c30,c31,c32,c33,c34,c35,c36,c37,c38,c39,c40,c41,c42,c43,c44,c45,c46,c47,c48,c49,c50,c51,c52,c53,c54,c55,c56) values ";
					sql+="(:m_id,:m_ma,:m_ngay,:m_c01,:m_c02,:m_c03,:m_c04,:m_c05,:m_c06,:m_c07,:m_c08,:m_c09,:m_c10,:m_c11,:m_c12,:m_c13,:m_c14,:m_c15,:m_c16,:m_c17,:m_c18,:m_c19,:m_c20,:m_c21,:m_c22,:m_c23,:m_c24,:m_c25,:m_c26,:m_c27,:m_c28,:m_userid,sysdate";
					sql+=",:m_c29,:m_c30,:m_c31,:m_c32,:m_c33,:m_c34,:m_c35,:m_c36,:m_c37,:m_c38,:m_c39,:m_c40,:m_c41,:m_c42,:m_c43,:m_c44,:m_c45,:m_c46,:m_c47,:m_c48,:m_c49,:m_c50,:m_c51,:m_c52,:m_c53,:m_c54,:m_c55,:m_c56)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
					cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
					cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
					cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
					cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
					cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
					cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
					cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
					cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
					cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
					cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
					cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
					cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
					cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
					cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
					cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
					cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
					cmd.Parameters.Add("m_c18",OracleType.Number).Value=m_c18;
					cmd.Parameters.Add("m_c19",OracleType.Number).Value=m_c19;
					cmd.Parameters.Add("m_c20",OracleType.Number).Value=m_c20;
					cmd.Parameters.Add("m_c21",OracleType.Number).Value=m_c21;
					cmd.Parameters.Add("m_c22",OracleType.Number).Value=m_c22;
					cmd.Parameters.Add("m_c23",OracleType.Number).Value=m_c23;
					cmd.Parameters.Add("m_c24",OracleType.Number).Value=m_c24;
					cmd.Parameters.Add("m_c25",OracleType.Number).Value=m_c25;
					cmd.Parameters.Add("m_c26",OracleType.Number).Value=m_c26;
					cmd.Parameters.Add("m_c27",OracleType.Number).Value=m_c27;
					cmd.Parameters.Add("m_c28",OracleType.Number).Value=m_c28;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					cmd.Parameters.Add("m_c29",OracleType.Number).Value=m_c29;
					cmd.Parameters.Add("m_c30",OracleType.Number).Value=m_c30;
					cmd.Parameters.Add("m_c31",OracleType.Number).Value=m_c31;
					cmd.Parameters.Add("m_c32",OracleType.Number).Value=m_c32;
					cmd.Parameters.Add("m_c33",OracleType.Number).Value=m_c33;
					cmd.Parameters.Add("m_c34",OracleType.Number).Value=m_c34;
					cmd.Parameters.Add("m_c35",OracleType.Number).Value=m_c35;
					cmd.Parameters.Add("m_c36",OracleType.Number).Value=m_c36;
					cmd.Parameters.Add("m_c37",OracleType.Number).Value=m_c37;
					cmd.Parameters.Add("m_c38",OracleType.Number).Value=m_c38;
					cmd.Parameters.Add("m_c39",OracleType.Number).Value=m_c39;
					cmd.Parameters.Add("m_c40",OracleType.Number).Value=m_c40;
					cmd.Parameters.Add("m_c41",OracleType.Number).Value=m_c41;
					cmd.Parameters.Add("m_c42",OracleType.Number).Value=m_c42;
					cmd.Parameters.Add("m_c43",OracleType.Number).Value=m_c43;
					cmd.Parameters.Add("m_c44",OracleType.Number).Value=m_c44;
					cmd.Parameters.Add("m_c45",OracleType.Number).Value=m_c45;
					cmd.Parameters.Add("m_c46",OracleType.Number).Value=m_c46;
					cmd.Parameters.Add("m_c47",OracleType.Number).Value=m_c47;
					cmd.Parameters.Add("m_c48",OracleType.Number).Value=m_c48;
					cmd.Parameters.Add("m_c49",OracleType.Number).Value=m_c49;
					cmd.Parameters.Add("m_c50",OracleType.Number).Value=m_c50;
					cmd.Parameters.Add("m_c51",OracleType.Number).Value=m_c51;
					cmd.Parameters.Add("m_c52",OracleType.Number).Value=m_c52;
					cmd.Parameters.Add("m_c53",OracleType.Number).Value=m_c53;
					cmd.Parameters.Add("m_c54",OracleType.Number).Value=m_c54;
					cmd.Parameters.Add("m_c55",OracleType.Number).Value=m_c55;
					cmd.Parameters.Add("m_c56",OracleType.Number).Value=m_c56;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"kh_bieu_141");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		//ThanhCuong 09/04/2012
		public bool upd_kh141(long m_id,int m_ma,string m_ngay,int m_c01,int m_c02,
			int m_c03,int m_c04,int m_c05,int m_c06,int m_c07,int m_c08,int m_c09,
			int m_c10,int m_c11,int m_c12,int m_c13,int m_c14,int m_c15,int m_c16,
			int m_c17,int m_c18,int m_c19,int m_c20,int m_c21,int m_c22,int m_c23,
			int m_c24,int m_c25,int m_c26,int m_c27,int m_c28,int m_userid,int m_c29,int m_c30,
			int m_c31,int m_c32,int m_c33,int m_c34,int m_c35,int m_c36,int m_c37,
			int m_c38,int m_c39,int m_c40,int m_c41,int m_c42,int m_c43,int m_c44,
			int m_c45,int m_c46,int m_c47,int m_c48,int m_c49,int m_c50,int m_c51,
			int m_c52,int m_c53,int m_c54,int m_c55,int m_c56,string m_stt,int m_tuyen)
		{
			sql="update kh_bieu_141 set ngay=:m_ngay,c01=:m_c01,c02=:m_c02,c03=:m_c03,c04=:m_c04,";
			sql+="c05=:m_c05,c06=:m_c06,c07=:m_c07,c08=:m_c08,c09=:m_c09,c10=:m_c10,";
			sql+="c11=:m_c11,c12=:m_c12,c13=:m_c13,c14=:m_c14,c15=:m_c15,c16=:m_c16,c17=:m_c17,";
			sql+="c18=:m_c18,c19=:m_c19,c20=:m_c20,c21=:m_c21,c22=:m_c22,c23=:m_c23,";
			sql+="c24=:m_c24,c25=:m_c25,c26=:m_c26,c27=:m_c27,c28=:m_c28,userid=:m_userid,c29=:m_c29,c30=:m_c30,c31=:m_c31,c32=:m_c32,";
			sql+="c33=:m_c33,c34=:m_c34,c35=:m_c35,c36=:m_c36,c37=:m_c37,c38=:m_c38,";
			sql+="c39=:m_c39,c40=:m_c40,c41=:m_c41,c42=:m_c42,c43=:m_c43,c44=:m_c44,c45=:m_c45,";
			sql+="c46=:m_c46,c47=:m_c47,c48=:m_c48,c49=:m_c49,c50=:m_c50,c51=:m_c51,";
			sql+="c52=:m_c52,c53=:m_c53,c54=:m_c54,c55=:m_c55,c56=:m_c56 where id=:m_id and ma=:m_ma and stt=:m_stt and tuyen=:m_tuyen";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
				cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
				cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
				cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
				cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
				cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
				cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
				cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
				cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
				cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
				cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
				cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
				cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
				cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
				cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
				cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
				cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
				cmd.Parameters.Add("m_c18",OracleType.Number).Value=m_c18;
				cmd.Parameters.Add("m_c19",OracleType.Number).Value=m_c19;
				cmd.Parameters.Add("m_c20",OracleType.Number).Value=m_c20;
				cmd.Parameters.Add("m_c21",OracleType.Number).Value=m_c21;
				cmd.Parameters.Add("m_c22",OracleType.Number).Value=m_c22;
				cmd.Parameters.Add("m_c23",OracleType.Number).Value=m_c23;
				cmd.Parameters.Add("m_c24",OracleType.Number).Value=m_c24;
				cmd.Parameters.Add("m_c25",OracleType.Number).Value=m_c25;
				cmd.Parameters.Add("m_c26",OracleType.Number).Value=m_c26;
				cmd.Parameters.Add("m_c27",OracleType.Number).Value=m_c27;
				cmd.Parameters.Add("m_c28",OracleType.Number).Value=m_c28;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_c29",OracleType.Number).Value=m_c29;
				cmd.Parameters.Add("m_c30",OracleType.Number).Value=m_c30;
				cmd.Parameters.Add("m_c31",OracleType.Number).Value=m_c31;
				cmd.Parameters.Add("m_c32",OracleType.Number).Value=m_c32;
				cmd.Parameters.Add("m_c33",OracleType.Number).Value=m_c33;
				cmd.Parameters.Add("m_c34",OracleType.Number).Value=m_c34;
				cmd.Parameters.Add("m_c35",OracleType.Number).Value=m_c35;
				cmd.Parameters.Add("m_c36",OracleType.Number).Value=m_c36;
				cmd.Parameters.Add("m_c37",OracleType.Number).Value=m_c37;
				cmd.Parameters.Add("m_c38",OracleType.Number).Value=m_c38;
				cmd.Parameters.Add("m_c39",OracleType.Number).Value=m_c39;
				cmd.Parameters.Add("m_c40",OracleType.Number).Value=m_c40;
				cmd.Parameters.Add("m_c41",OracleType.Number).Value=m_c41;
				cmd.Parameters.Add("m_c42",OracleType.Number).Value=m_c42;
				cmd.Parameters.Add("m_c43",OracleType.Number).Value=m_c43;
				cmd.Parameters.Add("m_c44",OracleType.Number).Value=m_c44;
				cmd.Parameters.Add("m_c45",OracleType.Number).Value=m_c45;
				cmd.Parameters.Add("m_c46",OracleType.Number).Value=m_c46;
				cmd.Parameters.Add("m_c47",OracleType.Number).Value=m_c47;
				cmd.Parameters.Add("m_c48",OracleType.Number).Value=m_c48;
				cmd.Parameters.Add("m_c49",OracleType.Number).Value=m_c49;
				cmd.Parameters.Add("m_c50",OracleType.Number).Value=m_c50;
				cmd.Parameters.Add("m_c51",OracleType.Number).Value=m_c51;
				cmd.Parameters.Add("m_c52",OracleType.Number).Value=m_c52;
				cmd.Parameters.Add("m_c53",OracleType.Number).Value=m_c53;
				cmd.Parameters.Add("m_c54",OracleType.Number).Value=m_c54;
				cmd.Parameters.Add("m_c55",OracleType.Number).Value=m_c55;
				cmd.Parameters.Add("m_c56",OracleType.Number).Value=m_c56;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				cmd.Parameters.Add("m_stt",OracleType.VarChar).Value=m_stt;
				cmd.Parameters.Add("m_tuyen",OracleType.Number).Value=m_tuyen;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into kh_bieu_141(id,ma,ngay,c01,c02,c03,c04,c05,c06,c07,c08,c09,c10,c11,c12,c13,c14,c15,c16,c17,c18,c19,c20,c21,c22,c23,c24,c25,c26,c27,c28,userid,ngayud";
					sql+=",c29,c30,c31,c32,c33,c34,c35,c36,c37,c38,c39,c40,c41,c42,c43,c44,c45,c46,c47,c48,c49,c50,c51,c52,c53,c54,c55,c56,stt,tuyen) values ";
					sql+="(:m_id,:m_ma,:m_ngay,:m_c01,:m_c02,:m_c03,:m_c04,:m_c05,:m_c06,:m_c07,:m_c08,:m_c09,:m_c10,:m_c11,:m_c12,:m_c13,:m_c14,:m_c15,:m_c16,:m_c17,:m_c18,:m_c19,:m_c20,:m_c21,:m_c22,:m_c23,:m_c24,:m_c25,:m_c26,:m_c27,:m_c28,:m_userid,sysdate";
					sql+=",:m_c29,:m_c30,:m_c31,:m_c32,:m_c33,:m_c34,:m_c35,:m_c36,:m_c37,:m_c38,:m_c39,:m_c40,:m_c41,:m_c42,:m_c43,:m_c44,:m_c45,:m_c46,:m_c47,:m_c48,:m_c49,:m_c50,:m_c51,:m_c52,:m_c53,:m_c54,:m_c55,:m_c56,:m_stt,:m_tuyen)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
					cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
					cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
					cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
					cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
					cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
					cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
					cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
					cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
					cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
					cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
					cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
					cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
					cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
					cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
					cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
					cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
					cmd.Parameters.Add("m_c18",OracleType.Number).Value=m_c18;
					cmd.Parameters.Add("m_c19",OracleType.Number).Value=m_c19;
					cmd.Parameters.Add("m_c20",OracleType.Number).Value=m_c20;
					cmd.Parameters.Add("m_c21",OracleType.Number).Value=m_c21;
					cmd.Parameters.Add("m_c22",OracleType.Number).Value=m_c22;
					cmd.Parameters.Add("m_c23",OracleType.Number).Value=m_c23;
					cmd.Parameters.Add("m_c24",OracleType.Number).Value=m_c24;
					cmd.Parameters.Add("m_c25",OracleType.Number).Value=m_c25;
					cmd.Parameters.Add("m_c26",OracleType.Number).Value=m_c26;
					cmd.Parameters.Add("m_c27",OracleType.Number).Value=m_c27;
					cmd.Parameters.Add("m_c28",OracleType.Number).Value=m_c28;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					cmd.Parameters.Add("m_c29",OracleType.Number).Value=m_c29;
					cmd.Parameters.Add("m_c30",OracleType.Number).Value=m_c30;
					cmd.Parameters.Add("m_c31",OracleType.Number).Value=m_c31;
					cmd.Parameters.Add("m_c32",OracleType.Number).Value=m_c32;
					cmd.Parameters.Add("m_c33",OracleType.Number).Value=m_c33;
					cmd.Parameters.Add("m_c34",OracleType.Number).Value=m_c34;
					cmd.Parameters.Add("m_c35",OracleType.Number).Value=m_c35;
					cmd.Parameters.Add("m_c36",OracleType.Number).Value=m_c36;
					cmd.Parameters.Add("m_c37",OracleType.Number).Value=m_c37;
					cmd.Parameters.Add("m_c38",OracleType.Number).Value=m_c38;
					cmd.Parameters.Add("m_c39",OracleType.Number).Value=m_c39;
					cmd.Parameters.Add("m_c40",OracleType.Number).Value=m_c40;
					cmd.Parameters.Add("m_c41",OracleType.Number).Value=m_c41;
					cmd.Parameters.Add("m_c42",OracleType.Number).Value=m_c42;
					cmd.Parameters.Add("m_c43",OracleType.Number).Value=m_c43;
					cmd.Parameters.Add("m_c44",OracleType.Number).Value=m_c44;
					cmd.Parameters.Add("m_c45",OracleType.Number).Value=m_c45;
					cmd.Parameters.Add("m_c46",OracleType.Number).Value=m_c46;
					cmd.Parameters.Add("m_c47",OracleType.Number).Value=m_c47;
					cmd.Parameters.Add("m_c48",OracleType.Number).Value=m_c48;
					cmd.Parameters.Add("m_c49",OracleType.Number).Value=m_c49;
					cmd.Parameters.Add("m_c50",OracleType.Number).Value=m_c50;
					cmd.Parameters.Add("m_c51",OracleType.Number).Value=m_c51;
					cmd.Parameters.Add("m_c52",OracleType.Number).Value=m_c52;
					cmd.Parameters.Add("m_c53",OracleType.Number).Value=m_c53;
					cmd.Parameters.Add("m_c54",OracleType.Number).Value=m_c54;
					cmd.Parameters.Add("m_c55",OracleType.Number).Value=m_c55;
					cmd.Parameters.Add("m_c56",OracleType.Number).Value=m_c56;
					cmd.Parameters.Add("m_stt",OracleType.VarChar).Value=m_stt;
					cmd.Parameters.Add("m_tuyen",OracleType.Number).Value=m_tuyen;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"kh_bieu_141");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}
		//End ThanhCuong
		public bool upd_kh142(long m_id,int m_ma,string m_ngay,int m_c01,int m_c02,
			int m_c03,int m_c04,int m_c05,int m_c06,int m_c07,int m_c08,int m_c09,
			int m_c10,int m_c11,int m_c12,int m_c13,int m_c14,int m_c15,int m_c16,
			int m_c17,int m_c18,int m_c19,int m_c20,int m_c21,int m_c22,int m_userid)
		{
			sql="update kh_bieu_142 set ngay=:m_ngay,c01=:m_c01,c02=:m_c02,c03=:m_c03,c04=:m_c04,";
			sql+="c05=:m_c05,c06=:m_c06,c07=:m_c07,c08=:m_c08,c09=:m_c09,c10=:m_c10,";
			sql+="c11=:m_c11,c12=:m_c12,c13=:m_c13,c14=:m_c14,c15=:m_c15,c16=:m_c16,c17=:m_c17,";
			sql+="c18=:m_c18,c19=:m_c19,c20=:m_c20,c21=:m_c21,c22=:m_c22,";
			sql+="userid=:m_userid where id=:m_id and ma=:m_ma";
			con=new OracleConnection(sConn);

			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
				cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
				cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
				cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
				cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
				cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
				cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
				cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
				cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
				cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
				cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
				cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
				cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
				cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
				cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
				cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
				cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
				cmd.Parameters.Add("m_c18",OracleType.Number).Value=m_c18;
				cmd.Parameters.Add("m_c19",OracleType.Number).Value=m_c19;
				cmd.Parameters.Add("m_c20",OracleType.Number).Value=m_c20;
				cmd.Parameters.Add("m_c21",OracleType.Number).Value=m_c21;
				cmd.Parameters.Add("m_c22",OracleType.Number).Value=m_c22;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into kh_bieu_142(id,ma,ngay,c01,c02,c03,c04,c05,c06,c07,c08,c09,c10,c11,c12,c13,c14,c15,c16,c17,c18,c19,c20,c21,c22,userid,ngayud) values ";
					sql+="(:m_id,:m_ma,:m_ngay,:m_c01,:m_c02,:m_c03,:m_c04,:m_c05,:m_c06,:m_c07,:m_c08,:m_c09,:m_c10,:m_c11,:m_c12,:m_c13,:m_c14,:m_c15,:m_c16,:m_c17,:m_c18,:m_c19,:m_c20,:m_c21,:m_c22,:m_userid,sysdate)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
					cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
					cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
					cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
					cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
					cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
					cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
					cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
					cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
					cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
					cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
					cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
					cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
					cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
					cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
					cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
					cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
					cmd.Parameters.Add("m_c18",OracleType.Number).Value=m_c18;
					cmd.Parameters.Add("m_c19",OracleType.Number).Value=m_c19;
					cmd.Parameters.Add("m_c20",OracleType.Number).Value=m_c20;
					cmd.Parameters.Add("m_c21",OracleType.Number).Value=m_c21;
					cmd.Parameters.Add("m_c22",OracleType.Number).Value=m_c22;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"kh_bieu_142");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_kh143(long m_id,int m_ma,string m_ngay,int m_c01,int m_c02,
			int m_c03,int m_c04,int m_c05,int m_c06,int m_c07,int m_c08,int m_c09,
			int m_c10,int m_c11,int m_c12,int m_c13,int m_c14,int m_c15,int m_c16,
			int m_c17,int m_c18,int m_c19,int m_c20,int m_c21,int m_c22,int m_userid)
		{
			sql="update kh_bieu_143 set ngay=:m_ngay,c01=:m_c01,c02=:m_c02,c03=:m_c03,c04=:m_c04,";
			sql+="c05=:m_c05,c06=:m_c06,c07=:m_c07,c08=:m_c08,c09=:m_c09,c10=:m_c10,";
			sql+="c11=:m_c11,c12=:m_c12,c13=:m_c13,c14=:m_c14,c15=:m_c15,c16=:m_c16,c17=:m_c17,";
			sql+="c18=:m_c18,c19=:m_c19,c20=:m_c20,c21=:m_c21,c22=:m_c22,";
			sql+="userid=:m_userid where id=:m_id and ma=:m_ma";
			con=new OracleConnection(sConn);

			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
				cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
				cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
				cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
				cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
				cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
				cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
				cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
				cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
				cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
				cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
				cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
				cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
				cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
				cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
				cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
				cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
				cmd.Parameters.Add("m_c18",OracleType.Number).Value=m_c18;
				cmd.Parameters.Add("m_c19",OracleType.Number).Value=m_c19;
				cmd.Parameters.Add("m_c20",OracleType.Number).Value=m_c20;
				cmd.Parameters.Add("m_c21",OracleType.Number).Value=m_c21;
				cmd.Parameters.Add("m_c22",OracleType.Number).Value=m_c22;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into kh_bieu_143(id,ma,ngay,c01,c02,c03,c04,c05,c06,c07,c08,c09,c10,c11,c12,c13,c14,c15,c16,c17,c18,c19,c20,c21,c22,userid,ngayud) values ";
					sql+="(:m_id,:m_ma,:m_ngay,:m_c01,:m_c02,:m_c03,:m_c04,:m_c05,:m_c06,:m_c07,:m_c08,:m_c09,:m_c10,:m_c11,:m_c12,:m_c13,:m_c14,:m_c15,:m_c16,:m_c17,:m_c18,:m_c19,:m_c20,:m_c21,:m_c22,:m_userid,sysdate)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
					cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
					cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
					cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
					cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
					cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
					cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
					cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
					cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
					cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
					cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
					cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
					cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
					cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
					cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
					cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
					cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
					cmd.Parameters.Add("m_c18",OracleType.Number).Value=m_c18;
					cmd.Parameters.Add("m_c19",OracleType.Number).Value=m_c19;
					cmd.Parameters.Add("m_c20",OracleType.Number).Value=m_c20;
					cmd.Parameters.Add("m_c21",OracleType.Number).Value=m_c21;
					cmd.Parameters.Add("m_c22",OracleType.Number).Value=m_c22;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"kh_bieu_143");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_kh144(long m_id,int m_ma,string m_ngay,int m_c01,int m_c02,
			int m_c03,int m_c04,int m_c05,int m_c06,int m_c07,int m_c08,int m_c09,
			int m_c10,int m_c11,int m_c12,int m_c13,int m_c14,int m_c15,int m_c16,
			int m_c17,int m_c18,int m_c19,int m_c20,int m_c21,int m_c22,int m_c23,
			int m_c24,int m_c25,int m_c26,int m_c27,int m_c28,int m_userid)
		{
			sql="update kh_bieu_144 set ngay=:m_ngay,c01=:m_c01,c02=:m_c02,c03=:m_c03,c04=:m_c04,";
			sql+="c05=:m_c05,c06=:m_c06,c07=:m_c07,c08=:m_c08,c09=:m_c09,c10=:m_c10,";
			sql+="c11=:m_c11,c12=:m_c12,c13=:m_c13,c14=:m_c14,c15=:m_c15,c16=:m_c16,c17=:m_c17,";
			sql+="c18=:m_c18,c19=:m_c19,c20=:m_c20,c21=:m_c21,c22=:m_c22,c23=:m_c23,";
			sql+="c24=:m_c24,c25=:m_c25,c26=:m_c26,c27=:m_c27,c28=:m_c28,userid=:m_userid where id=:m_id and ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
				cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
				cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
				cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
				cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
				cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
				cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
				cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
				cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
				cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
				cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
				cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
				cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
				cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
				cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
				cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
				cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
				cmd.Parameters.Add("m_c18",OracleType.Number).Value=m_c18;
				cmd.Parameters.Add("m_c19",OracleType.Number).Value=m_c19;
				cmd.Parameters.Add("m_c20",OracleType.Number).Value=m_c20;
				cmd.Parameters.Add("m_c21",OracleType.Number).Value=m_c21;
				cmd.Parameters.Add("m_c22",OracleType.Number).Value=m_c22;
				cmd.Parameters.Add("m_c23",OracleType.Number).Value=m_c23;
				cmd.Parameters.Add("m_c24",OracleType.Number).Value=m_c24;
				cmd.Parameters.Add("m_c25",OracleType.Number).Value=m_c25;
				cmd.Parameters.Add("m_c26",OracleType.Number).Value=m_c26;
				cmd.Parameters.Add("m_c27",OracleType.Number).Value=m_c27;
				cmd.Parameters.Add("m_c28",OracleType.Number).Value=m_c28;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into kh_bieu_144(id,ma,ngay,c01,c02,c03,c04,c05,c06,c07,c08,c09,c10,c11,c12,c13,c14,c15,c16,c17,c18,c19,c20,c21,c22,c23,c24,c25,c26,c27,c28,userid,ngayud) values ";
					sql+="(:m_id,:m_ma,:m_ngay,:m_c01,:m_c02,:m_c03,:m_c04,:m_c05,:m_c06,:m_c07,:m_c08,:m_c09,:m_c10,:m_c11,:m_c12,:m_c13,:m_c14,:m_c15,:m_c16,:m_c17,:m_c18,:m_c19,:m_c20,:m_c21,:m_c22,:m_c23,:m_c24,:m_c25,:m_c26,:m_c27,:m_c28,:m_userid,sysdate)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
					cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
					cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
					cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
					cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
					cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
					cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
					cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
					cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
					cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
					cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
					cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
					cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
					cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
					cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
					cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
					cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
					cmd.Parameters.Add("m_c18",OracleType.Number).Value=m_c18;
					cmd.Parameters.Add("m_c19",OracleType.Number).Value=m_c19;
					cmd.Parameters.Add("m_c20",OracleType.Number).Value=m_c20;
					cmd.Parameters.Add("m_c21",OracleType.Number).Value=m_c21;
					cmd.Parameters.Add("m_c22",OracleType.Number).Value=m_c22;
					cmd.Parameters.Add("m_c23",OracleType.Number).Value=m_c23;
					cmd.Parameters.Add("m_c24",OracleType.Number).Value=m_c24;
					cmd.Parameters.Add("m_c25",OracleType.Number).Value=m_c25;
					cmd.Parameters.Add("m_c26",OracleType.Number).Value=m_c26;
					cmd.Parameters.Add("m_c27",OracleType.Number).Value=m_c27;
					cmd.Parameters.Add("m_c28",OracleType.Number).Value=m_c28;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"kh_bieu_144");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		//ThanhCuong 09/04/2012
		public bool upd_kh144(long m_id,int m_ma,string m_ngay,int m_c01,int m_c02,
			int m_c03,int m_c04,int m_c05,int m_c06,int m_c07,int m_c08,int m_c09,
			int m_c10,int m_c11,int m_c12,int m_c13,int m_c14,int m_c15,int m_c16,
			int m_c17,int m_c18,int m_c19,int m_c20,int m_c21,int m_c22,int m_c23,
			int m_c24,int m_c25,int m_c26,int m_c27,int m_c28,int m_userid,string m_stt,int m_tuyen)
		{
			sql="update kh_bieu_144 set ngay=:m_ngay,c01=:m_c01,c02=:m_c02,c03=:m_c03,c04=:m_c04,";
			sql+="c05=:m_c05,c06=:m_c06,c07=:m_c07,c08=:m_c08,c09=:m_c09,c10=:m_c10,";
			sql+="c11=:m_c11,c12=:m_c12,c13=:m_c13,c14=:m_c14,c15=:m_c15,c16=:m_c16,c17=:m_c17,";
			sql+="c18=:m_c18,c19=:m_c19,c20=:m_c20,c21=:m_c21,c22=:m_c22,c23=:m_c23,";
			sql+="c24=:m_c24,c25=:m_c25,c26=:m_c26,c27=:m_c27,c28=:m_c28,userid=:m_userid where id=:m_id and ma=:m_ma and stt=:m_stt and tuyen=:m_tuyen";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
				cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
				cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
				cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
				cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
				cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
				cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
				cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
				cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
				cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
				cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
				cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
				cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
				cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
				cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
				cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
				cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
				cmd.Parameters.Add("m_c18",OracleType.Number).Value=m_c18;
				cmd.Parameters.Add("m_c19",OracleType.Number).Value=m_c19;
				cmd.Parameters.Add("m_c20",OracleType.Number).Value=m_c20;
				cmd.Parameters.Add("m_c21",OracleType.Number).Value=m_c21;
				cmd.Parameters.Add("m_c22",OracleType.Number).Value=m_c22;
				cmd.Parameters.Add("m_c23",OracleType.Number).Value=m_c23;
				cmd.Parameters.Add("m_c24",OracleType.Number).Value=m_c24;
				cmd.Parameters.Add("m_c25",OracleType.Number).Value=m_c25;
				cmd.Parameters.Add("m_c26",OracleType.Number).Value=m_c26;
				cmd.Parameters.Add("m_c27",OracleType.Number).Value=m_c27;
				cmd.Parameters.Add("m_c28",OracleType.Number).Value=m_c28;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				cmd.Parameters.Add("m_stt",OracleType.VarChar).Value=m_stt;
				cmd.Parameters.Add("m_tuyen",OracleType.Number).Value=m_tuyen;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into kh_bieu_144(id,ma,ngay,c01,c02,c03,c04,c05,c06,c07,c08,c09,c10,c11,c12,c13,c14,c15,c16,c17,c18,c19,c20,c21,c22,c23,c24,c25,c26,c27,c28,userid,ngayud,stt,tuyen) values ";
					sql+="(:m_id,:m_ma,:m_ngay,:m_c01,:m_c02,:m_c03,:m_c04,:m_c05,:m_c06,:m_c07,:m_c08,:m_c09,:m_c10,:m_c11,:m_c12,:m_c13,:m_c14,:m_c15,:m_c16,:m_c17,:m_c18,:m_c19,:m_c20,:m_c21,:m_c22,:m_c23,:m_c24,:m_c25,:m_c26,:m_c27,:m_c28,:m_userid,sysdate,:m_stt,:m_tuyen)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
					cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
					cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
					cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
					cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
					cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
					cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
					cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
					cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
					cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
					cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
					cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
					cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
					cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
					cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
					cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
					cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
					cmd.Parameters.Add("m_c18",OracleType.Number).Value=m_c18;
					cmd.Parameters.Add("m_c19",OracleType.Number).Value=m_c19;
					cmd.Parameters.Add("m_c20",OracleType.Number).Value=m_c20;
					cmd.Parameters.Add("m_c21",OracleType.Number).Value=m_c21;
					cmd.Parameters.Add("m_c22",OracleType.Number).Value=m_c22;
					cmd.Parameters.Add("m_c23",OracleType.Number).Value=m_c23;
					cmd.Parameters.Add("m_c24",OracleType.Number).Value=m_c24;
					cmd.Parameters.Add("m_c25",OracleType.Number).Value=m_c25;
					cmd.Parameters.Add("m_c26",OracleType.Number).Value=m_c26;
					cmd.Parameters.Add("m_c27",OracleType.Number).Value=m_c27;
					cmd.Parameters.Add("m_c28",OracleType.Number).Value=m_c28;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					cmd.Parameters.Add("m_stt",OracleType.VarChar).Value=m_stt;
					cmd.Parameters.Add("m_tuyen",OracleType.Number).Value=m_tuyen;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"kh_bieu_144");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}
		//End ThanhCuong 09/04/2012
		public bool upd_kh1451(long m_id,int m_ma,string m_ngay,int m_c01,int m_c02,
			int m_c03,int m_c04,int m_c05,int m_c06,int m_c07,int m_c08,int m_c09,
			int m_c10,int m_c11,int m_c12,int m_c13,int m_c14,int m_c15,int m_c16,
			int m_c17,int m_c18,int m_c19,int m_c20,int m_userid)
		{
			sql="update kh_bieu_1451 set ngay=:m_ngay,c01=:m_c01,c02=:m_c02,c03=:m_c03,c04=:m_c04,";
			sql+="c05=:m_c05,c06=:m_c06,c07=:m_c07,c08=:m_c08,c09=:m_c09,c10=:m_c10,";
			sql+="c11=:m_c11,c12=:m_c12,c13=:m_c13,c14=:m_c14,c15=:m_c15,c16=:m_c16,c17=:m_c17,";
			sql+="c18=:m_c18,c19=:m_c19,c20=:m_c20,userid=:m_userid where id=:m_id and ma=:m_ma";
			con=new OracleConnection(sConn);

			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
				cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
				cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
				cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
				cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
				cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
				cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
				cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
				cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
				cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
				cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
				cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
				cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
				cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
				cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
				cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
				cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
				cmd.Parameters.Add("m_c18",OracleType.Number).Value=m_c18;
				cmd.Parameters.Add("m_c19",OracleType.Number).Value=m_c19;
				cmd.Parameters.Add("m_c20",OracleType.Number).Value=m_c20;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into kh_bieu_1451(id,ma,ngay,c01,c02,c03,c04,c05,c06,c07,c08,c09,c10,c11,c12,c13,c14,c15,c16,c17,c18,c19,c20,userid,ngayud) values ";
					sql+="(:m_id,:m_ma,:m_ngay,:m_c01,:m_c02,:m_c03,:m_c04,:m_c05,:m_c06,:m_c07,:m_c08,:m_c09,:m_c10,:m_c11,:m_c12,:m_c13,:m_c14,:m_c15,:m_c16,:m_c17,:m_c18,:m_c19,:m_c20,:m_userid,sysdate)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
					cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
					cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
					cmd.Parameters.Add("m_c04",OracleType.Number).Value=m_c04;
					cmd.Parameters.Add("m_c05",OracleType.Number).Value=m_c05;
					cmd.Parameters.Add("m_c06",OracleType.Number).Value=m_c06;
					cmd.Parameters.Add("m_c07",OracleType.Number).Value=m_c07;
					cmd.Parameters.Add("m_c08",OracleType.Number).Value=m_c08;
					cmd.Parameters.Add("m_c09",OracleType.Number).Value=m_c09;
					cmd.Parameters.Add("m_c10",OracleType.Number).Value=m_c10;
					cmd.Parameters.Add("m_c11",OracleType.Number).Value=m_c11;
					cmd.Parameters.Add("m_c12",OracleType.Number).Value=m_c12;
					cmd.Parameters.Add("m_c13",OracleType.Number).Value=m_c13;
					cmd.Parameters.Add("m_c14",OracleType.Number).Value=m_c14;
					cmd.Parameters.Add("m_c15",OracleType.Number).Value=m_c15;
					cmd.Parameters.Add("m_c16",OracleType.Number).Value=m_c16;
					cmd.Parameters.Add("m_c17",OracleType.Number).Value=m_c17;
					cmd.Parameters.Add("m_c18",OracleType.Number).Value=m_c18;
					cmd.Parameters.Add("m_c19",OracleType.Number).Value=m_c19;
					cmd.Parameters.Add("m_c20",OracleType.Number).Value=m_c20;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"kh_bieu_1451");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_kh1452(long m_id,int m_ma,string m_ngay,int m_c01,int m_c02,
			int m_c03,int m_userid)
		{
			sql="update kh_bieu_1452 set ngay=:m_ngay,c01=:m_c01,c02=:m_c02,c03=:m_c03,";
			sql+="userid=:m_userid where id=:m_id and ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
				cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
				cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into kh_bieu_1452(id,ma,ngay,c01,c02,c03,userid,ngayud) values ";
					sql+="(:m_id,:m_ma,:m_ngay,:m_c01,:m_c02,:m_c03,:m_userid,sysdate)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_c01",OracleType.Number).Value=m_c01;
					cmd.Parameters.Add("m_c02",OracleType.Number).Value=m_c02;
					cmd.Parameters.Add("m_c03",OracleType.Number).Value=m_c03;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"kh_bieu_1452");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}
		#endregion

		#region import
		/// <summary>
		/// 
		/// </summary>
		public bool imp_benhandt(string m_mabn,long m_maql,string m_makp,string m_ngay,int m_dentu,int m_nhantu,int m_lanthu,int m_madoituong,string m_chandoan,string m_maicd,string m_mabs,string m_sovaovien,int m_loaiba,int m_userid)
		{
			sql="update benhandt set ";
			sql+="makp=:m_makp,";
			sql+="ngay=:m_ngay,dentu=:m_dentu,nhantu=:m_nhantu,";
			sql+="lanthu=:m_lanthu,madoituong=:m_madoituong,chandoan=:m_chandoan,maicd=:m_maicd,mabs=:m_mabs,";
			sql+="sovaovien=:m_sovaovien,";
			sql+="loaiba=:m_loaiba,userid=:m_userid where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_dentu",OracleType.Number).Value=m_dentu;
				cmd.Parameters.Add("m_nhantu",OracleType.Number).Value=m_nhantu;
				cmd.Parameters.Add("m_lanthu",OracleType.Number).Value=m_lanthu;
				cmd.Parameters.Add("m_madoituong",OracleType.Number).Value=m_madoituong;
				cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,254).Value=m_chandoan;
				cmd.Parameters.Add("m_maicd",OracleType.VarChar,9).Value=m_maicd;
				cmd.Parameters.Add("m_mabs",OracleType.VarChar,4).Value=m_mabs;
				cmd.Parameters.Add("m_sovaovien",OracleType.VarChar,10).Value=m_sovaovien;
				cmd.Parameters.Add("m_loaiba",OracleType.Number).Value=m_loaiba;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;

				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into benhandt(mabn,maql,makp,ngay,dentu,nhantu,lanthu,madoituong,chandoan,maicd,mabs,sovaovien,loaiba,userid,ngayud)";
					sql+=" values (:m_mabn,:m_maql,:m_makp,:m_ngay,:m_dentu,:m_nhantu,:m_lanthu,:m_madoituong,:m_chandoan,:m_maicd,:m_mabs,:m_sovaovien,:m_loaiba,:m_userid,sysdate)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar).Value=m_mabn;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_dentu",OracleType.Number).Value=m_dentu;
					cmd.Parameters.Add("m_nhantu",OracleType.Number).Value=m_nhantu;
					cmd.Parameters.Add("m_lanthu",OracleType.Number).Value=m_lanthu;
					cmd.Parameters.Add("m_madoituong",OracleType.Number).Value=m_madoituong;
					cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,254).Value=m_chandoan;
					cmd.Parameters.Add("m_maicd",OracleType.VarChar,9).Value=m_maicd;
					cmd.Parameters.Add("m_mabs",OracleType.VarChar,4).Value=m_mabs;
					cmd.Parameters.Add("m_sovaovien",OracleType.VarChar,10).Value=m_sovaovien;
					cmd.Parameters.Add("m_loaiba",OracleType.Number).Value=m_loaiba;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"i_benhan "+m_maql.ToString());
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool imp_nhapkhoa(long m_id,string m_mabn,long m_maql,string m_makp,
			int m_maba,string m_ngay,string m_tuoivao,string m_giuong,string m_khoachuyen,
			string m_chandoan,string m_maicd,string m_mabs,int m_lan,int m_userid)
		{
			sql="update nhapkhoa set makp=:m_makp,maba=:m_maba,ngay=:m_ngay,";
			sql+="tuoivao=:m_tuoivao,giuong=:m_giuong,khoachuyen=:m_khoachuyen,";
			sql+="chandoan=:m_chandoan,maicd=:m_maicd,mabs=:m_mabs,lan=:m_lan,";
			sql+="userid=:m_userid where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
			
				cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
				cmd.Parameters.Add("m_maba",OracleType.Number).Value=m_maba;
				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_tuoivao",OracleType.VarChar,4).Value=m_tuoivao;
				cmd.Parameters.Add("m_giuong",OracleType.VarChar,10).Value=m_giuong;
				cmd.Parameters.Add("m_khoachuyen",OracleType.VarChar,2).Value=m_khoachuyen;
				cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,254).Value=m_chandoan;
				cmd.Parameters.Add("m_maicd",OracleType.VarChar,9).Value=m_maicd;
				cmd.Parameters.Add("m_mabs",OracleType.VarChar,4).Value=m_mabs;
				cmd.Parameters.Add("m_lan",OracleType.Number).Value=m_lan;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into nhapkhoa(id,mabn,maql,makp,maba,ngay,tuoivao,giuong,khoachuyen,chandoan,maicd,mabs,lan,userid,ngayud)";
					sql+=" values (:m_id,:m_mabn,:m_maql,:m_makp,:m_maba,:m_ngay,:m_tuoivao,:m_giuong,:m_khoachuyen,:m_chandoan,:m_maicd,:m_mabs,:m_lan,:m_userid,sysdate)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar).Value=m_mabn;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
					cmd.Parameters.Add("m_maba",OracleType.Number).Value=m_maba;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_tuoivao",OracleType.VarChar,4).Value=m_tuoivao;
					cmd.Parameters.Add("m_giuong",OracleType.VarChar,10).Value=m_giuong;
					cmd.Parameters.Add("m_khoachuyen",OracleType.VarChar,2).Value=m_khoachuyen;
					cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,254).Value=m_chandoan;
					cmd.Parameters.Add("m_maicd",OracleType.VarChar,9).Value=m_maicd;
					cmd.Parameters.Add("m_mabs",OracleType.VarChar,4).Value=m_mabs;
					cmd.Parameters.Add("m_lan",OracleType.Number).Value=m_lan;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"i_nkhoa "+m_id.ToString());
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool imp_xuatkhoa(long m_id,string m_ngay,int m_ketqua,int m_ttlucrk,
			string m_chandoan,string m_maicd,string m_mabs,int m_bienchung,int m_taibien,int m_giaiphau,int m_userid)
		{
			sql="update xuatkhoa set ngay=:m_ngay,ketqua=:m_ketqua,ttlucrk=:m_ttlucrk,";
			sql+="chandoan=:m_chandoan,maicd=:m_maicd,mabs=:m_mabs,bienchung=:m_bienchung,";
			sql+="taibien=:m_taibien,giaiphau=:m_giaiphau,userid=:m_userid where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
			
				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_ketqua",OracleType.Number).Value=m_ketqua;
				cmd.Parameters.Add("m_ttlucrk",OracleType.Number).Value=m_ttlucrk;
				cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,254).Value=m_chandoan;
				cmd.Parameters.Add("m_maicd",OracleType.VarChar,9).Value=m_maicd;
				cmd.Parameters.Add("m_mabs",OracleType.VarChar,4).Value=m_mabs;
				cmd.Parameters.Add("m_bienchung",OracleType.Number).Value=m_bienchung;
				cmd.Parameters.Add("m_taibien",OracleType.Number).Value=m_taibien;
				cmd.Parameters.Add("m_giaiphau",OracleType.Number).Value=m_giaiphau;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into xuatkhoa(id,ngay,ketqua,ttlucrk,chandoan,maicd,mabs,bienchung,taibien,giaiphau,userid,ngayud)";
					sql+="values (:m_id,:m_ngay,:m_ketqua,:m_ttlucrk,:m_chandoan,:m_maicd,:m_mabs,:m_bienchung,:m_taibien,:m_giaiphau,:m_userid,sysdate)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_ketqua",OracleType.Number).Value=m_ketqua;
					cmd.Parameters.Add("m_ttlucrk",OracleType.Number).Value=m_ttlucrk;
					cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,254).Value=m_chandoan;
					cmd.Parameters.Add("m_maicd",OracleType.VarChar,9).Value=m_maicd;
					cmd.Parameters.Add("m_mabs",OracleType.VarChar,4).Value=m_mabs;
					cmd.Parameters.Add("m_bienchung",OracleType.Number).Value=m_bienchung;
					cmd.Parameters.Add("m_taibien",OracleType.Number).Value=m_taibien;
					cmd.Parameters.Add("m_giaiphau",OracleType.Number).Value=m_giaiphau;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"i_xkhoa "+m_id.ToString());
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool imp_xuatvien(string m_mabn,long m_maql,string m_makp,string m_ngay,int m_ketqua,int m_ttlucrv,
			string m_chandoan,string m_maicd,string m_mabs,string m_soluutru,int m_bienchung,int m_taibien,int m_giaiphau,int m_userid)
		{
			string sql="update xuatvien set makp=:m_makp,ngay=:m_ngay,";
			sql+="ketqua=:m_ketqua,ttlucrv=:m_ttlucrv,chandoan=:m_chandoan,";
			sql+="maicd=:m_maicd,mabs=:m_mabs,soluutru=:m_soluutru,bienchung=:m_bienchung,";
			sql+="taibien=:m_taibien,giaiphau=:m_giaiphau,userid=:m_userid";
			sql+=" where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
			
				cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_ketqua",OracleType.Number).Value=m_ketqua;
				cmd.Parameters.Add("m_ttlucrv",OracleType.Number).Value=m_ttlucrv;
				cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,254).Value=m_chandoan;
				cmd.Parameters.Add("m_maicd",OracleType.VarChar,9).Value=m_maicd;
				cmd.Parameters.Add("m_mabs",OracleType.VarChar,4).Value=m_mabs;
				cmd.Parameters.Add("m_soluutru",OracleType.VarChar,10).Value=m_soluutru;
				cmd.Parameters.Add("m_bienchung",OracleType.Number).Value=m_bienchung;
				cmd.Parameters.Add("m_taibien",OracleType.Number).Value=m_taibien;
				cmd.Parameters.Add("m_giaiphau",OracleType.Number).Value=m_giaiphau;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into xuatvien (mabn,maql,makp,ngay,ketqua,ttlucrv,chandoan,maicd,mabs,soluutru,bienchung,taibien,giaiphau,userid,ngayud)";
					sql+=" values (:m_mabn,:m_maql,:m_makp,:m_ngay,:m_ketqua,:m_ttlucrv,:m_chandoan,:m_maicd,:m_mabs,:m_soluutru,:m_bienchung,:m_taibien,:m_giaiphau,:m_userid,sysdate)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar).Value=m_mabn;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_ketqua",OracleType.Number).Value=m_ketqua;
					cmd.Parameters.Add("m_ttlucrv",OracleType.Number).Value=m_ttlucrv;
					cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,254).Value=m_chandoan;
					cmd.Parameters.Add("m_maicd",OracleType.VarChar,9).Value=m_maicd;
					cmd.Parameters.Add("m_mabs",OracleType.VarChar,4).Value=m_mabs;
					cmd.Parameters.Add("m_soluutru",OracleType.VarChar,10).Value=m_soluutru;
					cmd.Parameters.Add("m_bienchung",OracleType.Number).Value=m_bienchung;
					cmd.Parameters.Add("m_taibien",OracleType.Number).Value=m_taibien;
					cmd.Parameters.Add("m_giaiphau",OracleType.Number).Value=m_giaiphau;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"i_xvien "+m_maql.ToString());
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}
		#endregion

		public bool upd_baocao(string m_table,string m_ma,string m_ten)
		{
			sql="update "+m_table+" set ten=:m_ten where ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_ten",OracleType.NVarChar).Value=m_ten;
				cmd.Parameters.Add("m_ma",OracleType.VarChar).Value=m_ma;

				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+m_table+" (ma,ten) values (:m_ma,:m_ten)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_ma",OracleType.VarChar).Value=m_ma;
					cmd.Parameters.Add("m_ten",OracleType.NVarChar).Value=m_ten;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,m_table);
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_doituong(int m_madoituong,string m_doituong,int m_sothe,int m_ngay,int m_mabv,int m_mien,string m_field_gia,int m_trasau,int m_cholam,int m_khongin)
		{
			sql="update doituong set doituong=:m_doituong,sothe=:m_sothe,ngay=:m_ngay,mabv=:m_mabv,mien=:m_mien,field_gia=:m_field_gia,trasau=:m_trasau,cholam=:m_cholam,khongin=:m_khongin where madoituong=:m_madoituong";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_doituong",OracleType.NVarChar,30).Value=m_doituong;
				cmd.Parameters.Add("m_sothe",OracleType.Number).Value=m_sothe;
				cmd.Parameters.Add("m_ngay",OracleType.Number).Value=m_ngay;
				cmd.Parameters.Add("m_mabv",OracleType.Number).Value=m_mabv;
				cmd.Parameters.Add("m_mien",OracleType.Number).Value=m_mien;
				cmd.Parameters.Add("m_field_gia",OracleType.VarChar,10).Value=m_field_gia;
				cmd.Parameters.Add("m_trasau",OracleType.Number).Value=m_trasau;
				cmd.Parameters.Add("m_cholam",OracleType.Number).Value=m_cholam;
				cmd.Parameters.Add("m_khongin",OracleType.Number).Value=m_khongin;
				cmd.Parameters.Add("m_madoituong",OracleType.Number).Value=m_madoituong;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into doituong (madoituong,doituong,sothe,ngay,mabv,mien,field_gia,trasau,cholam,khongin) values (:m_madoituong,:m_doituong,:m_sothe,:m_ngay,:m_mabv,:m_mien,:m_field_gia,:m_trasau,:m_cholam,:m_khongin)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_madoituong",OracleType.Number).Value=m_madoituong;
					cmd.Parameters.Add("m_doituong",OracleType.NVarChar,30).Value=m_doituong;
					cmd.Parameters.Add("m_sothe",OracleType.Number).Value=m_sothe;
					cmd.Parameters.Add("m_ngay",OracleType.Number).Value=m_ngay;
					cmd.Parameters.Add("m_mabv",OracleType.Number).Value=m_mabv;
					cmd.Parameters.Add("m_mien",OracleType.Number).Value=m_mien;
					cmd.Parameters.Add("m_field_gia",OracleType.VarChar,10).Value=m_field_gia;
					cmd.Parameters.Add("m_trasau",OracleType.Number).Value=m_trasau;
					cmd.Parameters.Add("m_cholam",OracleType.Number).Value=m_cholam;
					cmd.Parameters.Add("m_khongin",OracleType.Number).Value=m_khongin;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"doituong");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_dmicd10(string m_ma)
		{
			sql="update dmicd10 set ma=:m_ma where ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_ma",OracleType.VarChar).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into dmicd10 (ma) values (:m_ma)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_ma",OracleType.VarChar).Value=m_ma;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"dmicd10");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_dmtuoi(int m_ma,string m_ten,int m_tu,int m_den)
		{
			sql="update dmtuoi set ten=:m_ten,tu=:m_tu,den=:m_den where ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_ten",OracleType.VarChar).Value=m_ten;
				cmd.Parameters.Add("m_tu",OracleType.Number).Value=m_tu;
				cmd.Parameters.Add("m_den",OracleType.Number).Value=m_den;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into dmtuoi (ma,ten,tu,den) values (:m_ma,:m_ten,:m_tu,:m_den)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ten",OracleType.VarChar).Value=m_ten;
					cmd.Parameters.Add("m_tu",OracleType.Number).Value=m_tu;
					cmd.Parameters.Add("m_den",OracleType.Number).Value=m_den;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"dmtuoi");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_dmpttt(string m_mapt,string m_mapttt,string m_noi_dung,
			string m_dacbiet,string m_loai1,string m_loai2,string m_loai3,
			int m_loaipt,int m_id_pttt,int m_id_muc)
		{
			sql="update dmpttt set noi_dung=:m_noi_dung,dacbiet=:m_dacbiet,loai1=:m_loai1,";
			sql+="loai2=:m_loai2,loai3=:m_loai3,loaipt=:m_loaipt,id_pttt=:m_id_pttt,id_muc=:m_id_muc";
			sql+=" where mapt=:m_mapt";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_noi_dung",OracleType.NVarChar).Value=m_noi_dung;
				cmd.Parameters.Add("m_dacbiet",OracleType.VarChar,1).Value=m_dacbiet;
				cmd.Parameters.Add("m_loai1",OracleType.VarChar,1).Value=m_loai1;
				cmd.Parameters.Add("m_loai2",OracleType.VarChar,1).Value=m_loai2;
				cmd.Parameters.Add("m_loai3",OracleType.VarChar,1).Value=m_loai3;
				cmd.Parameters.Add("m_loaipt",OracleType.Number).Value=m_loaipt;
				cmd.Parameters.Add("m_id_pttt",OracleType.Number).Value=m_id_pttt;
				cmd.Parameters.Add("m_id_muc",OracleType.Number).Value=m_id_muc;
				cmd.Parameters.Add("m_mapt",OracleType.VarChar,6).Value=m_mapt;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into dmpttt (mapt,mapttt,noi_dung,dacbiet,loai1,loai2,loai3,loaipt,id_pttt,id_muc) values (:m_mapt,:m_mapttt,:m_noi_dung,:m_dacbiet,:m_loai1,:m_loai2,:m_loai3,:m_loaipt,:m_id_pttt,:m_id_muc)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_mapt",OracleType.VarChar,6).Value=m_mapt;
					cmd.Parameters.Add("m_mapttt",OracleType.VarChar,9).Value=m_mapttt;
					cmd.Parameters.Add("m_noi_dung",OracleType.NVarChar).Value=m_noi_dung;
					cmd.Parameters.Add("m_dacbiet",OracleType.VarChar,1).Value=m_dacbiet;
					cmd.Parameters.Add("m_loai1",OracleType.VarChar,1).Value=m_loai1;
					cmd.Parameters.Add("m_loai2",OracleType.VarChar,1).Value=m_loai2;
					cmd.Parameters.Add("m_loai3",OracleType.VarChar,1).Value=m_loai3;
					cmd.Parameters.Add("m_loaipt",OracleType.Number).Value=m_loaipt;
					cmd.Parameters.Add("m_id_pttt",OracleType.Number).Value=m_id_pttt;
					cmd.Parameters.Add("m_id_muc",OracleType.Number).Value=m_id_muc;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"dmpttt");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public DataSet get_data_fox(string thumuc,string sql)
		{	
			string Connectstring="Provider=vfpoledb.1;Data Source="+thumuc+"\\;Collating Sequence=general";
			DataSet ds=new DataSet();
			try
			{
				OleDbConnection cn=new OleDbConnection(Connectstring);
				cn.Open();
				OleDbCommand dcmd=new OleDbCommand(sql,cn);
				dcmd.CommandType=CommandType.Text;
				OleDbDataAdapter da=new OleDbDataAdapter(dcmd);
				da.Fill(ds);
				cmd.Dispose();				
				cn.Dispose();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message.ToString().Trim(),sComputer,"?");
			}
			return ds;
		}

		public void execute_data_fox(string thumuc,string sql)
		{
			try
			{
				string Connectstring="Provider=vfpoledb.1;Data Source="+thumuc+"\\;Collating Sequence=general";
				OleDbConnection cn=new OleDbConnection(Connectstring);
				cn.Open();
				OleDbCommand dcmd=new OleDbCommand(sql,cn);
				dcmd.CommandType=CommandType.Text;
				dcmd.ExecuteNonQuery();
				cmd.Dispose();
				cn.Dispose();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message.ToString().Trim(),sComputer,"?");
			}
		}

		public string SqlStr(string sql)
		{
			XmlDocument doc=new XmlDocument();
			doc.Load("..\\..\\..\\xml\\maincode.xml");
			XmlNodeList nodeLst=doc.GetElementsByTagName(sql);
			return nodeLst.Item(0).InnerText;
		}

		public void execute_data_sql(string sql,string server,string database)
		{
			try
			{
				SqlConnection scon=new SqlConnection("Server="+server+";Database="+database+";Integrated Security=SSPI");
				scon.Open();
				SqlCommand scmd=new SqlCommand(sql,scon);
				scmd.CommandType=CommandType.Text;
				scmd.ExecuteNonQuery();
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim()+"-SQL: "+sql,sComputer,"?");
			}
		}

		public DataSet get_data_sql(string sql,string server,string database)
		{		
			DataSet sds=new DataSet();
			try
			{
				SqlConnection scon=new SqlConnection("Server="+server+";Database="+database+";Integrated Security=SSPI");
				scon.Open();
				SqlCommand scmd=new SqlCommand(sql,scon);
				scmd.CommandType=CommandType.Text;
				SqlDataAdapter sdest=new SqlDataAdapter(scmd);
				sdest.Fill(sds);	
				cmd.Dispose();				
				con.Close();con.Dispose();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim()+"-SQL:"+sql,sComputer,"?");
			}
			return sds;
		}

		public DataSet get_data_acc(string sql,string thumuc)
		{		
			try
			{
				if (ds!=null)
				{
					ds.Dispose();
					ds=null;
				}
				ds=new DataSet();
				string s="Provider=Microsoft.Jet.OLEDB.4.0;User Id=;Password=;Jet OLEDB:Database Password=links715501920;Data Source="+thumuc;
				OleDbConnection acon=new OleDbConnection(s);
				acon.Open();
				OleDbCommand acmd=new OleDbCommand(sql,acon);
				acmd.CommandType=CommandType.Text;
				OleDbDataAdapter adest=new OleDbDataAdapter(acmd);				
				adest.Fill(ds);	
				cmd.Dispose();				
				acon.Close();
				acon.Dispose();
			}
			catch(OleDbException ex)
			{
				upd_error(ex.Message.ToString().Trim()+ "- "+sql,sComputer,"?");
			}
			return ds;
		}

		#region timkiem
		public string Viettat(string matat)
		{
			try
			{
				sql="select daydu from btdvt where trim(matat)=:matat";
				con=new OracleConnection(sConn);
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("matat",OracleType.NVarChar).Value=matat.Trim().ToLower();
				dest=new OracleDataAdapter(cmd);
				ds=new DataSet();
				dest.Fill(ds);
				cmd.Dispose();
				con.Close();con.Dispose();
				return ds.Tables[0].Rows[0][0].ToString();
			}
			catch{return "";}
		}

		public string get_cicd10(string tenbenh)
		{
			if (tenbenh=="") return "";
			try
			{
				sql="select cicd10 from icd10 where trim(vviet)=:tenbenh";
				con=new OracleConnection(sConn);
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("tenbenh",OracleType.NVarChar).Value=Caps(tenbenh.Trim());
				dest=new OracleDataAdapter(cmd);
				ds=new DataSet();
				dest.Fill(ds);
				cmd.Dispose();
				con.Close();con.Dispose();
				return ds.Tables[0].Rows[0][0].ToString();
			}
			catch{return "";};
		}

		public string get_mapt(string tenpt)
		{
			if (tenpt=="") return "";
			try
			{
				sql="select loaipt,mapt from dmpttt where trim(noi_dung)=:tenpt";
				con=new OracleConnection(sConn);
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("tenpt",OracleType.NVarChar).Value=tenpt.Trim();
				dest=new OracleDataAdapter(cmd);
				ds=new DataSet();
				dest.Fill(ds);
				cmd.Dispose();
				con.Close();con.Dispose();
				return ds.Tables[0].Rows[0][0].ToString().Trim()+ds.Tables[0].Rows[0][1].ToString();
			}
			catch{return "";};
		}

		public string get_madstt(string tendstt)
		{
			if (tendstt=="") return "";
			try
			{
				sql="select mabv from dstt where trim(tenbv)=:tendstt";
				con=new OracleConnection(sConn);
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("tendstt",OracleType.NVarChar).Value=tendstt.Trim();
				dest=new OracleDataAdapter(cmd);
				ds=new DataSet();
				dest.Fill(ds);
				cmd.Dispose();
				con.Close();con.Dispose();
				return ds.Tables[0].Rows[0][0].ToString().Trim();
			}
			catch{return "";};
		}

		public DataSet get_TimTheMabn(string m_sothe, string m_mabn)
		{	
			DataSet ds1=new DataSet();
			try
			{
				//				m_hoten=Hoten_khongdau(m_hoten);
				sql="select distinct a.mabn,nvl(e.sothe,' ') as sothe,a.hoten,a.namsinh,decode(a.phai,0,'Nam','Nu') as phai,nvl(a.sonha,' ') sonha,nvl(a.thon,' ') thon,b.tentt,c.tenquan,d.tenpxa"+
					",nvl(to_char(e.tungay,'dd/mm/yyyy'),' ') as tungay,nvl(to_char(e.denngay,'dd/mm/yyyy'),' ') as denngay";
				sql+=" from btdbn a,btdtt b,btdquan c,btdpxa d,bhyt e where a.matt=b.matt and a.maqu=c.maqu";
				sql+=" and a.maphuongxa=d.maphuongxa and a.mabn=e.mabn and e.sothe=:m_sothe and (e.denngay>=sysdate or e.denngay is null) ";
				//				if (m_hoten!="") sql+=" and a.hotenkdau=:m_hoten";
				//				if (m_ngaysinh.Trim().Length==10) sql+=" and to_char(a.ngaysinh,'dd/mm/yyyy')=:m_ngaysinh";
				//				if (m_namsinh!="") sql+=" and a.namsinh=:m_namsinh";
				if (m_mabn!="") sql+=" and a.mabn<>:m_mabn";
				con=new OracleConnection(sConn);
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_sothe",OracleType.NVarChar,20).Value=m_sothe;
				//				if (m_ngaysinh.Trim().Length==10) cmd.Parameters.Add("m_ngaysinh",OracleType.VarChar,10).Value=m_ngaysinh;
				//				if (m_namsinh!="") cmd.Parameters.Add("m_namsinh",OracleType.VarChar).Value=m_namsinh;
				if (m_mabn!="") cmd.Parameters.Add("m_mabn",OracleType.VarChar).Value=m_mabn;
				dest=new OracleDataAdapter(cmd);
				dest.Fill(ds1);
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim(),sComputer,"TimTheMabn");
			}
			return ds1;
		}
		public DataSet get_Timmabn(string m_hoten,string m_ngaysinh,string m_namsinh,string m_mabn)
		{	
			DataSet ds1=new DataSet();
			try
			{
				m_hoten=Hoten_khongdau(m_hoten);
				sql="select distinct a.mabn,nvl(e.sothe,' ') as sothe,a.hoten,a.namsinh,decode(a.phai,0,'Nam','Nu') as phai,nvl(a.sonha,' ') sonha,nvl(a.thon,' ') thon,b.tentt,c.tenquan,d.tenpxa,a.nam";
				sql+=" from btdbn a,btdtt b,btdquan c,btdpxa d,bhyt e where a.matt=b.matt and a.maqu=c.maqu";
				sql+=" and a.maphuongxa=d.maphuongxa and a.mabn=e.mabn(+)";
				if (m_hoten!="") sql+=" and a.hotenkdau=:m_hoten";
				if (m_ngaysinh.Trim().Length==10) sql+=" and to_char(a.ngaysinh,'dd/mm/yyyy')=:m_ngaysinh";
				if (m_namsinh!="") sql+=" and a.namsinh=:m_namsinh";
				if (m_mabn!="") sql+=" and a.mabn<>:m_mabn";
				con=new OracleConnection(sConn);
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				if (m_hoten!="") cmd.Parameters.Add("m_hoten",OracleType.NVarChar).Value=m_hoten;
				if (m_ngaysinh.Trim().Length==10) cmd.Parameters.Add("m_ngaysinh",OracleType.VarChar,10).Value=m_ngaysinh;
				if (m_namsinh!="") cmd.Parameters.Add("m_namsinh",OracleType.VarChar).Value=m_namsinh;
				if (m_mabn!="") cmd.Parameters.Add("m_mabn",OracleType.VarChar).Value=m_mabn;
				dest=new OracleDataAdapter(cmd);
				dest.Fill(ds1);
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim(),sComputer,"Timmabn");
			}
			foreach(DataRow r in ds1.Tables[0].Select("sothe=' '"))
			{
				if(r["nam"].ToString().Trim()!="" && r["nam"].ToString().Trim().Length>=5)
				{
					DataSet lds= get_data_nam_dec(r["nam"].ToString(),"select sothe from xxx.bhyt where mabn='"+r["mabn"].ToString()+"'");
					if(lds!=null && lds.Tables.Count>0)
					{
						foreach(DataRow r1 in lds.Tables[0].Rows)
							r["sothe"]=r1["sothe"].ToString();
					}
				}
			}
			return ds1;
		}

		public DataSet get_Timhoten(string hoten,string ngaysinh,string namsinh,int phai,string sonha,string thon,string mann,string madantoc,string matt,string maqu,string maphuongxa,string dotuoi)
		{	
			//string m_dotuoi="";
			hoten=Hoten_khongdau(hoten);
			sql="SELECT a.MABN, a.HOTEN, a.NAMSINH, nvl(a.SONHA,' ') sonha,";
			sql+="nvl(a.THON,' ') thon, b.TENPXA, c.TENQUAN, d.TENTT, g.TENNN,a.nam ";
			sql+="FROM btdbn a,btdpxa b,btdquan c,btdtt d,btdnn_bv g ";
			sql+=" where a.maphuongxa=b.maphuongxa and a.maqu=c.maqu and a.matt=d.matt ";
			sql+=" and a.mann=g.mann ";
			if (dotuoi!="")
			{
				//ThanhCuong-25052011
				if (dotuoi.IndexOf("N") != -1)
				{
					int d1 = int.Parse(dotuoi.Substring(0, dotuoi.IndexOf("-")));
					int d2 = int.Parse(dotuoi.Substring(dotuoi.IndexOf("-") + 1,dotuoi.Length-(dotuoi.IndexOf("-") + 1)-1));
					sql += " and a.ngaysinh is not null and to_date(to_char(sysdate,'dd/mm/yyyy'),'dd/mm/yyyy')-to_date(to_char(a.ngaysinh,'dd/mm/yyyy'),'dd/mm/yyyy') between " + d1 + " and " + d2 ;//từ ngày dến ngay
				}
				else if (dotuoi.Trim() == "<1T")
				{
					sql += " and a.ngaysinh is not null and to_date(to_char(sysdate,'dd/mm/yyyy'),'dd/mm/yyyy')-to_date(to_char(a.ngaysinh,'dd/mm/yyyy'),'dd/mm/yyyy') between 0 and 365 ";//DUOI 1 TUOI
				}
				else if (dotuoi.IndexOf(">") != -1)
				{
					sql += " and to_number(to_char(sysdate,'yyyy'),'0000')-to_number(a.namsinh,'0000')>" + int.Parse(dotuoi.Substring(1)); 
				}
				else
				{
					int i1 = int.Parse(dotuoi.Substring(0, dotuoi.IndexOf("-")));
					int i2 = int.Parse(dotuoi.Substring(dotuoi.IndexOf("-") + 1));
					sql += " and to_number(to_char(sysdate,'yyyy'),'0000')-to_number(a.namsinh,'0000') between " + i1 + " and " + i2; 
				}
				//
				//				if (dotuoi.IndexOf(">")!=-1)
				//				{
				//					m_dotuoi=dotuoi.Substring(1);
				//					sql+=" and to_char(sysdate,'yyyy')-a.namsinh>"+int.Parse(m_dotuoi);
				//				}
				//				else 
				//				{
				//					int i1=int.Parse(dotuoi.Substring(0,dotuoi.IndexOf("-")));
				//					int i2=int.Parse(dotuoi.Substring(dotuoi.IndexOf("-")+1));
				//					sql+=" and to_char(sysdate,'yyyy')-a.namsinh between "+i1+" and "+i2;
				//				}
			}
			if (hoten!="") sql+=" and a.hotenkdau like '%"+hoten+"%'";
			if (ngaysinh.Trim().Length==10) sql+=" and to_char(a.ngaysinh,'dd/mm/yyyy')='"+ngaysinh+"'";
			if (namsinh!="") sql+=" and a.namsinh='"+namsinh+"'";
			if (phai!=-1) sql+=" and a.phai="+phai;
			if (sonha != "") sql += " and lower(trim(a.sonha))='" + sonha.Trim().ToLower() + "'";
			if (thon != "") sql += " and lower(trim(a.thon))='" + thon.Trim().ToLower() + "'";
			if (mann!="") sql+=" and a.mann='"+mann+"'";
			if (madantoc!="") sql+=" and a.madantoc='"+madantoc+"'";
			if (matt!="") sql+=" and a.matt='"+matt+"'";
			if (maqu!="")	sql+=" and a.maqu='"+maqu+"'";
			if (maphuongxa!="")	sql+=" and a.maphuongxa='"+maphuongxa+"'";
			sql+=" order by a.mabn";
			return get_data(sql);
		}

		public DataSet get_Timhoten1(string hoten,string ngaysinh,string namsinh,int phai,string sonha,string thon,string mann,string madantoc,string matt,string maqu,string maphuongxa,string dotuoi)
		{	
			string m_dotuoi="";
			hoten=Hoten_khongdau(hoten);
			sql="SELECT a.MABN, a.HOTEN, a.NAMSINH, nvl(a.SONHA,' ') sonha,";
			sql+="nvl(a.THON,' ') thon, b.TENPXA, c.TENQUAN, d.TENTT, g.TENNN,a.nam ";
			sql+="FROM btdbn a,btdpxa b,btdquan c,btdtt d,btdnn_bv g ";
			sql+=" where a.maphuongxa=b.maphuongxa and a.maqu=c.maqu and a.matt=d.matt ";
			sql+=" and a.mann=g.mann ";
			if (dotuoi!="")
			{
				if (dotuoi.IndexOf(">")!=-1)
				{
					m_dotuoi=dotuoi.Substring(1);
					sql+=" and to_char(sysdate,'yyyy')-a.namsinh>"+int.Parse(m_dotuoi);
				}
				else 
				{
					int i1=int.Parse(dotuoi.Substring(0,dotuoi.IndexOf("-")));
					int i2=int.Parse(dotuoi.Substring(dotuoi.IndexOf("-")+1));
					sql+=" and to_char(sysdate,'yyyy')-a.namsinh between "+i1+" and "+i2;
				}
			}
			if (hoten!="") sql+=" and a.hotenkdau like '%"+hoten+"%'";
			if (ngaysinh.Trim().Length==10) sql+=" and to_char(a.ngaysinh,'dd/mm/yyyy')='"+ngaysinh+"'";
			if (namsinh!="") sql+=" and a.namsinh='"+namsinh+"'";
			if (phai!=-1) sql+=" and a.phai="+phai;
			if (sonha != "") sql += " and lower(trim(a.sonha))='" + sonha.Trim().ToLower() + "'";
			if (thon != "") sql += " and lower(trim(a.thon))='" + thon.Trim().ToLower() + "'";
			if (mann!="") sql+=" and a.mann='"+mann+"'";
			if (madantoc!="") sql+=" and a.madantoc='"+madantoc+"'";
			if (matt!="") sql+=" and a.matt='"+matt+"'";
			if (maqu!="")	sql+=" and a.maqu='"+maqu+"'";
			if (maphuongxa!="")	sql+=" and a.maphuongxa='"+maphuongxa+"'";
			sql+=" order by a.mabn";
			return get_data(sql);
		}

		public DataSet get_Timkiem(string mabn,string hoten,string ngaysinh,string namsinh,int phai,string sonha,string thon,string mann,string madantoc,string matt,string maqu, 
			string maphuongxa,string dotuoi,string dt_nha,string dt_coquan,string dt_didong,string email)
		{	
			
			hoten=Hoten_khongdau(hoten);
			sql="SELECT a.MABN, a.HOTEN, a.NAMSINH, nvl(a.SONHA,' ') sonha,";
			sql+="nvl(a.THON,' ') thon, b.TENPXA, c.TENQUAN, d.TENTT, g.TENNN,";
			sql+="nvl(k.nha,' ') nha,nvl(k.coquan,' ') coquan,nvl(k.didong,' ') didong,nvl(k.email,' ') email,a.nam ";
			sql+="FROM btdbn a,btdpxa b,btdquan c,btdtt d,btdnn_bv g,dienthoai k ";
			sql+=" where a.maphuongxa=b.maphuongxa and a.maqu=c.maqu and a.matt=d.matt ";
			sql+=" and a.mann=g.mann and a.mabn=k.mabn(+) ";
			if (dotuoi!="")
			{
				//ThanhCuong-25052011
				if (dotuoi.IndexOf("N") != -1)
				{
					int d1 = int.Parse(dotuoi.Substring(0, dotuoi.IndexOf("-")));
					int d2 = int.Parse(dotuoi.Substring(dotuoi.IndexOf("-") + 1,dotuoi.Length-(dotuoi.IndexOf("-") + 1)-1));
					sql += " and a.ngaysinh is not null and to_date(to_char(sysdate,'dd/mm/yyyy'),'dd/mm/yyyy')-to_date(to_char(a.ngaysinh,'dd/mm/yyyy'),'dd/mm/yyyy') between " + d1 + " and " + d2 ;//từ ngày dến ngay
				}
				else if (dotuoi.Trim() == "<1T")
				{
					sql += " and a.ngaysinh is not null and to_date(to_char(sysdate,'dd/mm/yyyy'),'dd/mm/yyyy')-to_date(to_char(a.ngaysinh,'dd/mm/yyyy'),'dd/mm/yyyy') between 0 and 365 ";//DUOI 1 TUOI
				}
				else if (dotuoi.IndexOf(">") != -1)
				{
					sql += " and to_number(to_char(sysdate,'yyyy'),'0000')-to_number(a.namsinh,'0000')>" + int.Parse(dotuoi.Substring(1)); 
				}
				else
				{
					int i1 = int.Parse(dotuoi.Substring(0, dotuoi.IndexOf("-")));
					int i2 = int.Parse(dotuoi.Substring(dotuoi.IndexOf("-") + 1));
					sql += " and to_number(to_char(sysdate,'yyyy'),'0000')-to_number(a.namsinh,'0000') between " + i1 + " and " + i2; 
				}
				//
				//				if (dotuoi.IndexOf(">")!=-1)
				//				{
				//					m_dotuoi=dotuoi.Substring(1);
				//					sql+=" and to_char(sysdate,'yyyy')-a.namsinh>"+int.Parse(m_dotuoi);
				//				}
				//				else 
				//				{
				//					int i1=int.Parse(dotuoi.Substring(0,dotuoi.IndexOf("-")));
				//					int i2=int.Parse(dotuoi.Substring(dotuoi.IndexOf("-")+1));
				//					sql+=" and to_char(sysdate,'yyyy')-a.namsinh between "+i1+" and "+i2;
				//				}
			}
			if (mabn!="") sql+=" and a.mabn='"+mabn+"'";
			if (hoten!="") sql+=" and a.hotenkdau like '%"+hoten+"%'";
			if (ngaysinh.Trim().Length==10) sql+=" and to_char(a.ngaysinh,'dd/mm/yyyy')='"+ngaysinh+"'";
			if (namsinh!="") sql+=" and a.namsinh='"+namsinh+"'";
			if (phai!=-1) sql+=" and a.phai="+phai;
			if (sonha != "") sql += " and lower(trim(a.sonha))='" + sonha.Trim().ToLower() + "'";
			if (thon != "") sql += " and lower(trim(a.thon))='" + thon.Trim().ToLower() + "'";
			if (mann!="") sql+=" and a.mann='"+mann+"'";
			if (madantoc!="") sql+=" and a.madantoc='"+madantoc+"'";
			if (matt!="") sql+=" and a.matt='"+matt+"'";
			if (maqu!="")	sql+=" and a.maqu='"+maqu+"'";
			if (maphuongxa!="")	sql+=" and a.maphuongxa='"+maphuongxa+"'";
			if (dt_nha!="")	sql+=" and k.nha='"+dt_nha+"'";
			if (dt_coquan!="")	sql+=" and k.coquan='"+dt_coquan+"'";
			if (dt_didong!="")	sql+=" and k.didong='"+dt_didong+"'";
			if (email!="")	sql+=" and k.email='"+email+"'";
			sql+=" order by a.mabn";
			return get_data(sql);
		}

		public DataSet get_Timkiem1(string mabn,string hoten,string ngaysinh,string namsinh,int phai,string sonha,string thon,string mann,string madantoc,string matt,string maqu, 
			string maphuongxa,string dotuoi,string dt_nha,string dt_coquan,string dt_didong,string email)
		{	
			string m_dotuoi="";
			hoten=Hoten_khongdau(hoten);
			sql="SELECT a.MABN, a.HOTEN, a.NAMSINH, nvl(a.SONHA,' ') sonha,";
			sql+="nvl(a.THON,' ') thon, b.TENPXA, c.TENQUAN, d.TENTT, g.TENNN,";
			sql+="nvl(k.nha,' ') nha,nvl(k.coquan,' ') coquan,nvl(k.didong,' ') didong,nvl(k.email,' ') email,a.nam ";
			sql+="FROM btdbn a,btdpxa b,btdquan c,btdtt d,btdnn_bv g,dienthoai k ";
			sql+=" where a.maphuongxa=b.maphuongxa and a.maqu=c.maqu and a.matt=d.matt ";
			sql+=" and a.mann=g.mann and a.mabn=k.mabn(+) ";
			if (dotuoi!="")
			{
				if (dotuoi.IndexOf(">")!=-1)
				{
					m_dotuoi=dotuoi.Substring(1);
					sql+=" and to_char(sysdate,'yyyy')-a.namsinh>"+int.Parse(m_dotuoi);
				}
				else 
				{
					int i1=int.Parse(dotuoi.Substring(0,dotuoi.IndexOf("-")));
					int i2=int.Parse(dotuoi.Substring(dotuoi.IndexOf("-")+1));
					sql+=" and to_char(sysdate,'yyyy')-a.namsinh between "+i1+" and "+i2;
				}
			}
			if (mabn!="") sql+=" and a.mabn='"+mabn+"'";
			if (hoten!="") sql+=" and a.hotenkdau like '%"+hoten+"%'";
			if (ngaysinh.Trim().Length==10) sql+=" and to_char(a.ngaysinh,'dd/mm/yyyy')='"+ngaysinh+"'";
			if (namsinh!="") sql+=" and a.namsinh='"+namsinh+"'";
			if (phai!=-1) sql+=" and a.phai="+phai;
			if (sonha != "") sql += " and lower(trim(a.sonha))='" + sonha.Trim().ToLower() + "'";
			if (thon != "") sql += " and lower(trim(a.thon))='" + thon.Trim().ToLower() + "'";
			if (mann!="") sql+=" and a.mann='"+mann+"'";
			if (madantoc!="") sql+=" and a.madantoc='"+madantoc+"'";
			if (matt!="") sql+=" and a.matt='"+matt+"'";
			if (maqu!="")	sql+=" and a.maqu='"+maqu+"'";
			if (maphuongxa!="")	sql+=" and a.maphuongxa='"+maphuongxa+"'";
			if (dt_nha!="")	sql+=" and k.nha='"+dt_nha+"'";
			if (dt_coquan!="")	sql+=" and k.coquan='"+dt_coquan+"'";
			if (dt_didong!="")	sql+=" and k.didong='"+dt_didong+"'";
			if (email!="")	sql+=" and k.email='"+email+"'";
			sql+=" order by a.mabn";
			return get_data(sql);
		}

		public DataSet get_chitiet(DataSet ds,string mabn,string nam,string tu,string den)
		{
			ds.Clear();
			DataSet ret=ds.Copy();
			DataRow r1,r2;
			DataTable dt,dttt=get_data("select * from ttxk").Tables[0];
			string s_tu=ngayhienhanh_server.Substring(0,10),s_den=s_tu;
			sql="select to_char(a.ngay,'dd/mm/yyyy hh24:mi') as ngay,b.tenkp,' ' as giuong,' ' as tenbs,to_char(a.ngay,'yyyymmddhh24mi') as yymmdd ";
			sql+=" from xxx.tiepdon a,"+user+".btdkp_bv b where a.makp=b.makp and a.mabn='"+mabn+"'";
			if (tu!="" && den!="") sql+=" and to_date(a.ngay,'dd/mm/yy') between to_date('"+tu+"','dd/mm/yy') and to_date('"+den+"','dd/mm/yy')";
			if (tu!="" && den!="") dt=get_data_mmyy(sql,tu,den,false).Tables[0];
			else dt=get_data_nam_dec(nam,sql).Tables[0];
			foreach(DataRow r in dt.Select("true","yymmdd"))
			{
				s_tu=r["ngay"].ToString().Substring(0,10);
				r1=ds.Tables[0].NewRow();
				r1["ngay"]=r["ngay"].ToString();
				r1["tenkp"]=r["tenkp"].ToString();
				r1["giuong"]="";
				r1["tenbs"]="";
				r1["tinhtrang"]="Đăng ký khám bệnh";
				r1["chandoan"]="";
				r1["yymmdd"]=r["yymmdd"].ToString();
				ds.Tables[0].Rows.Add(r1);
				break;
			}
			if (tu=="" || den=="")
			{
				tu=s_tu;den=s_den;
			}
			sql="select to_char(a.ngay,'dd/mm/yyyy hh24:mi') as ngay,b.tenkp,' ' as giuong,c.hoten as tenbs,to_char(a.ngay,'yyyymmddhh24mi') as yymmdd,a.loaiba,a.chandoan ";
			sql+=" from xxx.benhandt a,btdkp_bv b,dmbs c where a.makp=b.makp and a.mabs=c.ma(+) and a.mabn='"+mabn+"'";
			sql+=" and to_date(a.ngay,'dd/mm/yy') between to_date('"+tu+"','dd/mm/yy') and to_date('"+den+"','dd/mm/yy')";
			if (tu!="" && den!="") dt=get_data_mmyy(sql,tu,den,false).Tables[0];
			else dt=get_data_nam_dec(nam,sql).Tables[0];
			foreach(DataRow r in dt.Select("true","yymmdd"))
			{
				r1=ds.Tables[0].NewRow();
				r1["ngay"]=r["ngay"].ToString();
				r1["tenkp"]=r["tenkp"].ToString();
				r1["giuong"]="";
				r1["tenbs"]=r["tenbs"].ToString();
				r1["tinhtrang"]=(r["loaiba"].ToString()=="3")?"Khám bệnh":(r["loaiba"].ToString()=="2")?"Điều trị ngoại trú":(r["loaiba"].ToString()=="4")?"Phòng lưu":"Điều trị nội trú";
				r1["chandoan"]=r["chandoan"].ToString();
				r1["yymmdd"]=r["yymmdd"].ToString();
				r1["stt"]=0;
				ds.Tables[0].Rows.Add(r1);
			}
			sql="select to_char(a.ngay,'dd/mm/yyyy hh24:mi') as ngay,b.tenkp,' ' as giuong,c.hoten as tenbs,to_char(a.ngay,'yyyymmddhh24mi') as yymmdd,a.loaiba,a.chandoan ";
			sql+=" from benhandt a,btdkp_bv b,dmbs c where a.makp=b.makp and a.mabs=c.ma(+) and a.mabn='"+mabn+"'";
			sql+=" and to_date(a.ngay,'dd/mm/yy') between to_date('"+tu+"','dd/mm/yy') and to_date('"+den+"','dd/mm/yy')";
			dt=get_data(sql).Tables[0];
			foreach(DataRow r in dt.Select("true","yymmdd"))
			{
				r1=ds.Tables[0].NewRow();
				r1["ngay"]=r["ngay"].ToString();
				r1["tenkp"]=r["tenkp"].ToString();
				r1["giuong"]="";
				r1["tenbs"]=r["tenbs"].ToString();
				r1["tinhtrang"]=(r["loaiba"].ToString()=="3")?"Khám bệnh":(r["loaiba"].ToString()=="2")?"Điều trị ngoại trú":(r["loaiba"].ToString()=="4")?"Phòng lưu":"Điều trị nội trú";
				r1["chandoan"]=r["chandoan"].ToString();
				r1["yymmdd"]=r["yymmdd"].ToString();
				r1["stt"]=0;
				ds.Tables[0].Rows.Add(r1);
			}
			sql="select to_char(a.ngay,'dd/mm/yyyy hh24:mi') as ngay,d.tenkp,a.giuong,e.hoten as tenbs,to_char(a.ngay,'yyyymmddhh24mi') as yymmdd,a.chandoan,";
			sql+="to_char(b.ngay,'dd/mm/yyyy hh24:mi') as ngayrk,nvl(b.ttlucrk,0) as ttlucrk,f.hoten as tenbsrk,to_char(b.ngay,'yyyymmddhh24mi') as yymmddrk,b.chandoan as chandoanrk";
			sql+=" from nhapkhoa a,xuatkhoa b,benhandt c,btdkp_bv d,dmbs e,dmbs f where a.maql=c.maql and a.makp=d.makp and a.mabs=e.ma and a.id=b.id(+) and b.mabs=f.ma(+) and a.mabn='"+mabn+"'";
			sql+=" and c.loaiba=1 and to_date(a.ngay,'dd/mm/yy') between to_date('"+tu+"','dd/mm/yy') and to_date('"+den+"','dd/mm/yy')";
			dt=get_data(sql).Tables[0];
			foreach(DataRow r in dt.Select("true","yymmdd"))
			{
				r1=ds.Tables[0].NewRow();
				r1["ngay"]=r["ngay"].ToString();
				r1["tenkp"]=r["tenkp"].ToString();
				r1["giuong"]=r["giuong"].ToString();
				r1["tenbs"]=r["tenbs"].ToString();
				r1["tinhtrang"]="Điều trị tại khoa";
				r1["chandoan"]=r["chandoan"].ToString();
				r1["yymmdd"]=r["yymmdd"].ToString();
				r1["stt"]=2;
				ds.Tables[0].Rows.Add(r1);
				if (r["ttlucrk"].ToString()!="0")
				{
					r2=getrowbyid(dttt,"ma="+int.Parse(r["ttlucrk"].ToString()));
					if (r2!=null)
					{
						r1=ds.Tables[0].NewRow();
						r1["ngay"]=r["ngayrk"].ToString();
						r1["tenkp"]=r["tenkp"].ToString();
						r1["giuong"]=r["giuong"].ToString();
						r1["tenbs"]=r["tenbsrk"].ToString();
						r1["tinhtrang"]=r2["ten"].ToString();
						r1["chandoan"]=r["chandoanrk"].ToString();
						r1["yymmdd"]=r["yymmddrk"].ToString();
						r1["stt"]=1;
						ds.Tables[0].Rows.Add(r1);
					}
				}
			}
			ret.Merge(ds.Tables[0].Select("true","yymmdd desc,stt desc"));
			return ret;
		}

		public DataSet get_Tiepdon(string tu,string den,string mabn,string hoten,string namsinh,
			int phai,string sonha,string thon,string mann,string madantoc,string matt,string maqu, 
			string maphuongxa,string makp,string madoituong,string dotuoi,string sothe,int userid,
			bool time,string dt_nha,string dt_coquan,string dt_didong,string email,string mabs,
			int loai,int bnmoi,int noitiepdon)
		{	
			string stime=(time)?"'dd/mm/yy hh24:mi'":"'dd/mm/yy'";
			if (time)
			{
				tu=tu+" "+sGiobaocao;
				den=den+" "+sGiobaocao;
			}
			hoten=Hoten_khongdau(hoten);
			sql="SELECT a.MABN, a.HOTEN,substr(f.tuoivao,1,3)||decode(substr(f.tuoivao,4,1),0,'TU',decode(substr(f.tuoivao,4,1),1,'TH',decode(substr(f.tuoivao,4,1),2,'NG','GI'))) tuoi, case when a.ngaysinh is null then a.namsinh else to_char(a.ngaysinh,'dd/mm/yy') end as namsinh, nvl(a.SONHA,' ') sonha,";
			sql+="nvl(a.THON,' ') thon, b.TENPXA, c.TENQUAN, d.TENTT, g.TENNN, to_char(f.ngay,'dd/mm/yyyy hh24:mi') AS ngay,e.TENKP,h.DOITUONG,f.SOVAOVIEN,nvl(i.sothe,' ') sothe,nvl(to_char(j.ngaysanh,'dd/mm/yyyy'),' ') ngaysanh,";
			sql+="nvl(k.nha,' ') nha,nvl(k.coquan,' ') coquan,nvl(k.didong,' ') didong,nvl(k.email,' ') email,nvl(y.hoten,' ') as tenbs,nvl(u.hoten,' ') as tenuser,to_char(f.ngay,'yyyymmddhh24mi') as yymmdd,f.sovaovien as sophieu,nvl(i.traituyen,0) as traituyen,'' as tentraituyen,f.madoituong,f.maql, f.done ";
			sql+="FROM xxx.tiepdon f,btdbn a,btdpxa b,btdquan c,btdtt d,btdnn_bv g,doituong h,btdkp_bv e,xxx.bhyt i ,xxx.ttkhamthai j,dienthoai k,xxx.lienhe x,dmbs y,dlogin u ";
			sql+=" where a.mabn=f.mabn and a.maphuongxa=b.maphuongxa and a.maqu=c.maqu and a.matt=d.matt and f.userid=u.id(+) ";
			sql+=" and a.mann=g.mann and f.madoituong=h.madoituong and f.makp=e.makp and f.maql=i.maql(+) ";
			sql+=" and f.noitiepdon="+noitiepdon;
			sql+=" and f.maql=j.maql(+)";
			sql+=" and f.mabn=k.mabn(+) and f.maql=x.maql(+) and x.mabs=y.ma(+)";
			if (makp!="") sql+=" and f.makp in ("+makp+")";
			if (tu!="") 
			{
				if (time)
					sql+=" and f.ngay between to_date('"+tu+"',"+stime+") and to_date('"+den+"',"+stime+")";
				else
					sql+=" and to_date(f.ngay,"+stime+") between to_date('"+tu+"',"+stime+") and to_date('"+den+"',"+stime+")";
			}
			if (dotuoi!="")
			{
				//ThanhCuong-25052011
				if (dotuoi.IndexOf("N") != -1)//(dotuoi.Trim() == "<28N")
				{
					int d1 = int.Parse(dotuoi.Substring(0, dotuoi.IndexOf("-")));
					int d2 = int.Parse(dotuoi.Substring(dotuoi.IndexOf("-") + 1,dotuoi.Length-(dotuoi.IndexOf("-") + 1)-1));
					sql += " and a.ngaysinh is not null and to_date(to_char(f.ngay,'dd/mm/yyyy'),'dd/mm/yyyy')-to_date(to_char(a.ngaysinh,'dd/mm/yyyy'),'dd/mm/yyyy') between " + d1 + " and " + d2 ;//từ ngày dến ngay
				}
				else if (dotuoi.Trim() == "<1T")
				{
					sql += " and a.ngaysinh is not null and to_date(to_char(f.ngay,'dd/mm/yyyy'),'dd/mm/yyyy')-to_date(to_char(a.ngaysinh,'dd/mm/yyyy'),'dd/mm/yyyy') between 0 and 365 ";//DUOI 1 TUOI
				}
				else if (dotuoi.IndexOf(">") != -1)
				{
					sql += " and to_number(to_char(f.ngay,'yyyy'),'0000')-to_number(a.namsinh,'0000')>" + int.Parse(dotuoi.Substring(1)); 
				}
				else
				{
					int i1 = int.Parse(dotuoi.Substring(0, dotuoi.IndexOf("-")));
					int i2 = int.Parse(dotuoi.Substring(dotuoi.IndexOf("-") + 1));
					sql += " and to_number(to_char(f.ngay,'yyyy'),'0000')-to_number(a.namsinh,'0000') between " + i1 + " and " + i2; 
				}
				//
				//				if (dotuoi.IndexOf(">")!=-1)
				//				{
				//					m_dotuoi=dotuoi.Substring(1);
				//					sql+=" and to_char(f.ngay,'yyyy')-a.namsinh>"+int.Parse(m_dotuoi);//sql+=" and to_char(sysdate,'yyyy')-a.namsinh>"+int.Parse(m_dotuoi);
				//				}
				//				else 
				//				{
				//					int i1=int.Parse(dotuoi.Substring(0,dotuoi.IndexOf("-")));
				//					int i2=int.Parse(dotuoi.Substring(dotuoi.IndexOf("-")+1));
				//					sql+=" and to_char(f.ngay,'yyyy')-a.namsinh between "+i1+" and "+i2;//sql+=" and to_char(sysdate,'yyyy')-a.namsinh between "+i1+" and "+i2;
				//				}
			}
			if (mabn!="") sql+=" and a.mabn='"+mabn+"'";
			if (hoten!="") sql+=" and a.hotenkdau='"+hoten+"'";
			if (namsinh!="") sql+=" and a.namsinh='"+namsinh+"'";
			if (phai!=-1) sql+=" and a.phai="+phai;
			if (sonha != "") sql += " and lower(trim(a.sonha))='" + sonha.Trim().ToLower() + "'";
			if (thon != "") sql += " and lower(trim(a.thon))='" + thon.Trim().ToLower() + "'";
			if (mann!="") sql+=" and a.mann='"+mann+"'";
			if (madantoc!="") sql+=" and a.madantoc='"+madantoc+"'";
			if (matt!="") sql+=" and a.matt='"+matt+"'";
			if (maqu!="")	sql+=" and a.maqu='"+maqu+"'";
			if (maphuongxa!="")	sql+=" and a.maphuongxa='"+maphuongxa+"'";
			if (madoituong!="")	sql+=" and f.madoituong="+madoituong;
			if (sothe!="")	sql+=" and i.sothe='"+sothe+"'";
			if (dt_nha!="")	sql+=" and k.nha='"+dt_nha+"'";
			if (dt_coquan!="")	sql+=" and k.coquan='"+dt_coquan+"'";
			if (dt_didong!="")	sql+=" and k.didong='"+dt_didong+"'";
			if (email!="")	sql+=" and k.email='"+email+"'";
			if (mabs!="")	sql+=" and x.mabs='"+mabs+"'";
			if (userid!=-1) sql+=" and f.userid="+userid;
			if (loai!=-1) sql+=" and x.loai="+loai;
			if (bnmoi!=-1) sql+=" and x.bnmoi="+bnmoi;
			sql+=" order by f.ngay";
			return get_data_mmyy(sql, tu.Substring(0,10), den.Substring(0,10), false);
		}

		public DataSet get_Khambenh(string tu,string den,string mabn,string hoten,string ngaysinh,
			int phai,string sonha,string thon,string mann,string madantoc,string matt,string maqu, 
			string maphuongxa,string makp,string sovaovien,string maicd,string madoituong,string dentu,
			string nhantu,string xutri,string dotuoi,bool icd,string soluutru,int userid,bool time,
			string mabs,int loai,int bnmoi,string loaidt)
		{				
			int v1=5,v2=2,i_nhom=nhom_duoc;
			string s_tunguyen="",s_thetunguyen=thetunguyen(i_nhom);
			if (s_thetunguyen!="" ) s_tunguyen=s_thetunguyen.Replace(",","','");
			string vitri=thetunguyen_vitri_ora(i_nhom);
			if (vitri.Length==3)
			{
				v1=int.Parse(vitri.Substring(0,1));v2=int.Parse(vitri.Substring(2,1));
			}
			string stime=(time)?"'dd/mm/yy hh24:mi'":"'dd/mm/yy'";
			if (time)
			{
				tu=tu+" "+sGiobaocao;
				den=den+" "+sGiobaocao;
			}
			hoten=Hoten_khongdau(hoten);
			sql="SELECT a.MABN, a.HOTEN,substr(k.tuoivao,1,3)||decode(substr(k.tuoivao,4,1),0,'TU',decode(substr(k.tuoivao,4,1),1,'TH',decode(substr(k.tuoivao,4,1),2,'NG','GI'))) tuoi, case when a.ngaysinh is null then a.namsinh else to_char(a.ngaysinh,'dd/mm/yy') end as namsinh, nvl(a.SONHA,' ') sonha,";
			sql+="nvl(a.THON,' ') thon, b.TENPXA, c.TENQUAN, d.TENTT, g.TENNN, to_char(f.ngay,'dd/mm/yyyy hh24:mi') AS ngay,";
			sql+="e.TENKP, h.DOITUONG, f.CHANDOAN, f.MAICD, f.SOVAOVIEN, i.TEN AS nhantu,j.TEN AS dentu, n.TEN AS xutri,m.soluutru,nvl(y.tenkp,' ') khoanhap,nvl(to_char(z.ngaysanh,'dd/mm/yyyy'),' ') ngaysanh,nvl(p.hoten,' ') tenbs,nvl(u.hoten,' ') as tenuser,nvl(l.sothe,' ') as sothe,";
			sql+="c2.tenbv";
			sql+=", decode(nvl(l.traituyen,0),0,'','x') as traituyen ";
			sql+="FROM xxx.benhandt f,btdbn a,btdpxa b,btdquan c,btdtt d,btdnn_bv g,doituong h,nhantu i,";
			sql+="dentu j,xxx.xuatvien m,xutrikb n,btdkp_bv e,xxx.lienhe k,xxx.xutrikbct x,btdkp_bv y,xxx.ttkhamthai z,";
			sql+="dmbs p,dlogin u,xxx.bhyt l,chuyenvien c1,tenvien c2 ";
			sql+="where a.MABN = f.MABN and a.MAPHUONGXA = b.MAPHUONGXA and a.MAQU = c.MAQU and f.userid=u.id(+) and f.maql=l.maql(+)";
			sql+="and a.MATT = d.MATT and a.MANN=g.MANN and f.MAQL=m.MAQL and f.MADOITUONG = h.MADOITUONG and f.NHANTU = i.MA ";
			sql+="and f.DENTU = j.MA and f.MAKP = e.MAKP and m.TTLUCRV = n.MA(+) and f.loaiba=3 and f.maql=k.maql and f.maql=x.maql(+) and x.makp=y.makp(+) and f.maql=z.maql(+) and f.mabs=p.ma(+) ";
			sql+="and f.maql=c1.maql(+) and c1.mabv=c2.mabv(+)";
			if (makp!="") sql+=" and f.makp in ("+makp+")";
			if (loaidt!="")
			{
				if (loaidt=="B") sql+=" and substr(l.sothe,"+v1+","+v2+") not in ('"+s_tunguyen.Substring(0,s_tunguyen.Length)+"')";
				else sql+=" and substr(l.sothe,"+v1+","+v2+") in ('"+s_tunguyen.Substring(0,s_tunguyen.Length)+"')";
			}
			if (icd) sql+=" and f.maicd in (select ma from dmicd10)";
			if (tu!="") 
			{
				if (time)
					sql+=" and f.ngay between to_date('"+tu+"',"+stime+") and to_date('"+den+"',"+stime+")";
				else
					sql+=" and to_date(f.ngay,"+stime+") between to_date('"+tu+"',"+stime+") and to_date('"+den+"',"+stime+")";
			}
			if (dotuoi!="")
			{
				//ThanhCuong-25052011
				if (dotuoi.IndexOf("N") != -1)
				{
					int d1 = int.Parse(dotuoi.Substring(0, dotuoi.IndexOf("-")));
					int d2 = int.Parse(dotuoi.Substring(dotuoi.IndexOf("-") + 1,dotuoi.Length-(dotuoi.IndexOf("-") + 1)-1));
					sql += " and a.ngaysinh is not null and to_date(to_char(f.ngay,'dd/mm/yyyy'),'dd/mm/yyyy')-to_date(to_char(a.ngaysinh,'dd/mm/yyyy'),'dd/mm/yyyy') between " + d1 + " and " + d2 ;//từ ngày dến ngay
				}
				else if (dotuoi.Trim() == "<1T")
				{
					sql += " and a.ngaysinh is not null and to_date(to_char(f.ngay,'dd/mm/yyyy'),'dd/mm/yyyy')-to_date(to_char(a.ngaysinh,'dd/mm/yyyy'),'dd/mm/yyyy') between 0 and 365 ";//DUOI 1 TUOI
				}
				else if (dotuoi.IndexOf(">") != -1)
				{
					sql += " and to_number(to_char(f.ngay,'yyyy'),'0000')-to_number(a.namsinh,'0000')>" + int.Parse(dotuoi.Substring(1)); 
				}
				else
				{
					int i1 = int.Parse(dotuoi.Substring(0, dotuoi.IndexOf("-")));
					int i2 = int.Parse(dotuoi.Substring(dotuoi.IndexOf("-") + 1));
					sql += " and to_number(to_char(f.ngay,'yyyy'),'0000')-to_number(a.namsinh,'0000') between " + i1 + " and " + i2; 
				}
				//
				//				if (dotuoi.IndexOf(">")!=-1)
				//				{
				//					m_dotuoi=dotuoi.Substring(1);
				//					sql+=" and to_char(f.ngay,'yyyy')-a.namsinh>"+int.Parse(m_dotuoi);//sql+=" and to_char(sysdate,'yyyy')-a.namsinh>"+int.Parse(m_dotuoi);
				//				}
				//				else 
				//				{
				//					int i1=int.Parse(dotuoi.Substring(0,dotuoi.IndexOf("-")));
				//					int i2=int.Parse(dotuoi.Substring(dotuoi.IndexOf("-")+1));
				//					sql+=" and to_char(f.ngay,'yyyy')-a.namsinh between "+i1+" and "+i2;//sql+=" and to_char(sysdate,'yyyy')-a.namsinh between "+i1+" and "+i2;
				//				}
			}
			if (mabn!="") sql+=" and a.mabn='"+mabn+"'";
			if (hoten!="") sql+=" and a.hotenkdau='"+hoten+"'";
			if (ngaysinh!="") sql+=" and to_char(a.ngaysinh,'dd/mm/yyyy')='"+ngaysinh+"'";
			if (phai!=-1) sql+=" and a.phai="+phai;
			if (sonha!="") sql+=" and lower(trim(a.sonha))='"+sonha+"'";
			if (thon!="") sql+=" and lower(trim(a.thon))='"+thon+"'";
			if (mann!="") sql+=" and a.mann='"+mann+"'";
			if (madantoc!="") sql+=" and a.madantoc='"+madantoc+"'";
			if (matt!="") sql+=" and a.matt='"+matt+"'";
			if (maqu!="")	sql+=" and a.maqu='"+maqu+"'";
			if (maphuongxa!="")	sql+=" and a.maphuongxa='"+maphuongxa+"'";
			if (userid!=-1) sql+=" and f.userid="+userid;
			if (sovaovien!="") sql+=" and f.sovaovien='"+sovaovien+"'";
			if (maicd!="")	sql+=" and f.maicd='"+maicd+"'";
			if (madoituong!="")	sql+=" and f.madoituong="+madoituong;
			if (dentu!="") sql+=" and f.dentu="+dentu;
			if (nhantu!="")	sql+=" and f.nhantu="+nhantu;
			if (xutri!="")	sql+=" and x.xutri like '%"+xutri.PadLeft(2,'0')+",%'";
			if (soluutru=="*") sql+=" and m.soluutru is not null";
			else if (soluutru!="")	sql+=" and m.soluutru='"+soluutru+"'";
			if (userid!=-1) sql+=" and f.userid="+userid;
			if (mabs!="")	sql+=" and f.mabs='"+mabs+"'";
			if (loai!=-1) sql+=" and k.loai="+loai;
			if (bnmoi!=-1) sql+=" and k.bnmoi="+bnmoi;
			sql+=" order by f.ngay";
			return get_data_mmyy(sql, tu.Substring(0,10), den.Substring(0,10), false);
		}



		public DataSet get_Khambenh(string tu,string den,string mabn,string hoten,string ngaysinh,
			int phai,string sonha,string thon,string mann,string madantoc,string matt,string maqu, 
			string maphuongxa,string makp,string sovaovien,string maicd,string madoituong,string dentu,
			string nhantu,string xutri,string dotuoi,bool icd,string soluutru,int userid,bool time,
			string mabs,int loai,int bnmoi,string loaidt,string quoctinh)
		{				
			int v1=5,v2=2,i_nhom=nhom_duoc;
			string s_tunguyen="",s_thetunguyen=thetunguyen(i_nhom);
			if (s_thetunguyen!="" ) s_tunguyen=s_thetunguyen.Replace(",","','");
			string vitri=thetunguyen_vitri_ora(i_nhom);
			if (vitri.Length==3)
			{
				v1=int.Parse(vitri.Substring(0,1));v2=int.Parse(vitri.Substring(2,1));
			}
			string m_dotuoi="",stime=(time)?"'dd/mm/yy hh24:mi'":"'dd/mm/yy'";
			if (time)
			{
				tu=tu+" "+sGiobaocao;
				den=den+" "+sGiobaocao;
			}
			hoten=Hoten_khongdau(hoten);
			sql="SELECT a.MABN, a.HOTEN,substr(k.tuoivao,1,3)||decode(substr(k.tuoivao,4,1),0,'TU',decode(substr(k.tuoivao,4,1),1,'TH',decode(substr(k.tuoivao,4,1),2,'NG','GI'))) tuoi, case when a.ngaysinh is null then a.namsinh else to_char(a.ngaysinh,'dd/mm/yy') end as namsinh, nvl(a.SONHA,' ') sonha,";
			sql+="nvl(a.THON,' ') thon, b.TENPXA, c.TENQUAN, d.TENTT, g.TENNN, to_char(f.ngay,'dd/mm/yyyy hh24:mi') AS ngay,";
			sql+="e.TENKP, h.DOITUONG, f.CHANDOAN, f.MAICD, f.SOVAOVIEN, i.TEN AS nhantu,j.TEN AS dentu, n.TEN AS xutri,m.soluutru,nvl(y.tenkp,' ') khoanhap,nvl(to_char(z.ngaysanh,'dd/mm/yyyy'),' ') ngaysanh,nvl(p.hoten,' ') tenbs,nvl(u.hoten,' ') as tenuser,nvl(l.sothe,' ') as sothe,";
			sql+="c2.tenbv";
			sql+=", decode(nvl(l.traituyen,0),0,'','x') as traituyen ";
			sql+="FROM xxx.benhandt f,btdbn a,btdpxa b,btdquan c,btdtt d,btdnn_bv g,doituong h,nhantu i,";
			sql+="dentu j,xxx.xuatvien m,xutrikb n,btdkp_bv e,xxx.lienhe k,xxx.xutrikbct x,btdkp_bv y,xxx.ttkhamthai z,";
			sql+="dmbs p,dlogin u,xxx.bhyt l,chuyenvien c1,tenvien c2,dmquocgia q,nuocngoai q1 ";
			sql+="where a.MABN = f.MABN and a.MAPHUONGXA = b.MAPHUONGXA and a.MAQU = c.MAQU and f.userid=u.id(+) and f.maql=l.maql(+)";
			sql+="and a.MATT = d.MATT and a.MANN=g.MANN and f.MAQL=m.MAQL and f.MADOITUONG = h.MADOITUONG and f.NHANTU = i.MA ";
			sql+="and f.DENTU = j.MA and f.MAKP = e.MAKP and m.TTLUCRV = n.MA(+) and f.loaiba=3 and f.maql=k.maql and f.maql=x.maql(+) and x.makp=y.makp(+) and f.maql=z.maql(+) and f.mabs=p.ma(+) ";
			sql+="and f.maql=c1.maql(+) and c1.mabv=c2.mabv(+) and a.mabn=q1.mabn(+) and q1.id_nuoc=q.ma(+)";
			if (makp!="") sql+=" and f.makp in ("+makp+")";
			if (loaidt!="")
			{
				if (loaidt=="B") sql+=" and substr(l.sothe,"+v1+","+v2+") not in ('"+s_tunguyen.Substring(0,s_tunguyen.Length)+"')";
				else sql+=" and substr(l.sothe,"+v1+","+v2+") in ('"+s_tunguyen.Substring(0,s_tunguyen.Length)+"')";
			}
			if (icd) sql+=" and f.maicd in (select ma from dmicd10)";
			if (tu!="") 
			{
				if (time)
					sql+=" and f.ngay between to_date('"+tu+"',"+stime+") and to_date('"+den+"',"+stime+")";
				else
					sql+=" and to_date(f.ngay,"+stime+") between to_date('"+tu+"',"+stime+") and to_date('"+den+"',"+stime+")";
			}
			if (dotuoi!="")
			{
				//ThanhCuong-25052011
				if (dotuoi.IndexOf("N") != -1)
				{
					int d1 = int.Parse(dotuoi.Substring(0, dotuoi.IndexOf("-")));
					int d2 = int.Parse(dotuoi.Substring(dotuoi.IndexOf("-") + 1,dotuoi.Length-(dotuoi.IndexOf("-") + 1)-1));
					sql += " and a.ngaysinh is not null and to_date(to_char(f.ngay,'dd/mm/yyyy'),'dd/mm/yyyy')-to_date(to_char(a.ngaysinh,'dd/mm/yyyy'),'dd/mm/yyyy') between " + d1 + " and " + d2 ;//từ ngày dến ngay
				}
				else if (dotuoi.Trim() == "<1T")
				{
					sql += " and a.ngaysinh is not null and to_date(to_char(f.ngay,'dd/mm/yyyy'),'dd/mm/yyyy')-to_date(to_char(a.ngaysinh,'dd/mm/yyyy'),'dd/mm/yyyy') between 0 and 365 ";//DUOI 1 TUOI
				}
				else if (dotuoi.IndexOf(">") != -1)
				{
					sql += " and to_number(to_char(f.ngay,'yyyy'),'0000')-to_number(a.namsinh,'0000')>" + int.Parse(dotuoi.Substring(1)); 
				}
				else
				{
					int i1 = int.Parse(dotuoi.Substring(0, dotuoi.IndexOf("-")));
					int i2 = int.Parse(dotuoi.Substring(dotuoi.IndexOf("-") + 1));
					sql += " and to_number(to_char(f.ngay,'yyyy'),'0000')-to_number(a.namsinh,'0000') between " + i1 + " and " + i2; 
				}
				//
				//				if (dotuoi.IndexOf(">")!=-1)
				//				{
				//					m_dotuoi=dotuoi.Substring(1);
				//					sql+=" and to_char(f.ngay,'yyyy')-a.namsinh>"+int.Parse(m_dotuoi);//sql+=" and to_char(sysdate,'yyyy')-a.namsinh>"+int.Parse(m_dotuoi);
				//				}
				//				else 
				//				{
				//					int i1=int.Parse(dotuoi.Substring(0,dotuoi.IndexOf("-")));
				//					int i2=int.Parse(dotuoi.Substring(dotuoi.IndexOf("-")+1));
				//					sql+=" and to_char(f.ngay,'yyyy')-a.namsinh between "+i1+" and "+i2;//sql+=" and to_char(sysdate,'yyyy')-a.namsinh between "+i1+" and "+i2;
				//				}
			}
			if (mabn!="") sql+=" and a.mabn='"+mabn+"'";
			if (hoten!="") sql+=" and a.hotenkdau='"+hoten+"'";
			if (ngaysinh!="") sql+=" and to_char(a.ngaysinh,'dd/mm/yyyy')='"+ngaysinh+"'";
			if (phai!=-1) sql+=" and a.phai="+phai;
			if (sonha!="") sql+=" and lower(trim(a.sonha))='"+sonha+"'";
			if (thon!="") sql+=" and lower(trim(a.thon))='"+thon+"'";
			if (mann!="") sql+=" and a.mann='"+mann+"'";
			if (madantoc!="") sql+=" and a.madantoc='"+madantoc+"'";
			if (matt!="") sql+=" and a.matt='"+matt+"'";
			if (maqu!="")	sql+=" and a.maqu='"+maqu+"'";
			if (maphuongxa!="")	sql+=" and a.maphuongxa='"+maphuongxa+"'";
			if (userid!=-1) sql+=" and f.userid="+userid;
			if (sovaovien!="") sql+=" and f.sovaovien='"+sovaovien+"'";
			if (maicd!="")	sql+=" and f.maicd='"+maicd+"'";
			if (madoituong!="")	sql+=" and f.madoituong="+madoituong;
			if (dentu!="") sql+=" and f.dentu="+dentu;
			if (nhantu!="")	sql+=" and f.nhantu="+nhantu;
			if (xutri!="")	sql+=" and x.xutri like '%"+xutri.PadLeft(2,'0')+",%'";
			if (soluutru=="*") sql+=" and m.soluutru is not null";
			if (quoctinh != "") sql+=" and q.ten like '%"+quoctinh+"%'"; 
			else if (soluutru!="")	sql+=" and m.soluutru='"+soluutru+"'";
			if (userid!=-1) sql+=" and f.userid="+userid;
			if (mabs!="")	sql+=" and f.mabs='"+mabs+"'";
			if (loai!=-1) sql+=" and k.loai="+loai;
			if (bnmoi!=-1) sql+=" and k.bnmoi="+bnmoi;
			sql+=" order by f.ngay";
			return get_data_mmyy(sql, tu.Substring(0,10), den.Substring(0,10), false);
		}


		public DataSet get_Vaongoaitru1(string tu,string den,string mabn,string hoten,string ngaysinh,
			int phai,string sonha,string thon,string mann,string madantoc,string matt,string maqu, 
			string maphuongxa,string makp,string sovaovien,string maicd,string madoituong,string dentu,
			string nhantu,string dotuoi,bool icd,int userid,bool time,int taikham)
		{	
			DataSet ret=new DataSet();
			string m_dotuoi="",stime=(time)?"'dd/mm/yy hh24:mi'":"'dd/mm/yy'";
			if (time)
			{
				tu=tu+" "+sGiobaocao;
				den=den+" "+sGiobaocao;
			}
			hoten=Hoten_khongdau(hoten);
			sql="select a.mabn,a.hoten,substr(k.tuoivao,1,3)||decode(substr(k.tuoivao,4,1),0,'TU',decode(substr(k.tuoivao,4,1),1,'TH',decode(substr(k.tuoivao,4,1),2,'NG','GI'))) tuoi,";
			sql+="case when a.ngaysinh is null then a.namsinh else to_char(a.ngaysinh,'dd/mm/yy') end as namsinh,nvl(a.sonha,' ') sonha,nvl(a.thon,' ') thon,b.tenpxa,c.tenquan,d.tentt,";
			sql+="g.tennn,to_char(f.ngay,'dd/mm/yyyy hh24:mi') as ngay,e.tenkp,h.doituong,";
			sql+="f.chandoan,f.maicd,f.sovaovien,i.ten as nhantu,j.ten as dentu,nvl(u.hoten,' ') as tenuser ";
			sql+="from btdbn a,btdpxa b,btdquan c,btdtt d,btdkp_bv e,benhandt f,";
			sql+="btdnn_bv g,doituong h,nhantu i,dentu j,lienhe k,dlogin u ";
			sql+="where a.mabn=f.mabn and a.maphuongxa=b.maphuongxa and a.maqu=c.maqu and a.matt=d.matt ";
			sql+="and f.makp=e.makp and a.mann=g.mann and f.madoituong=h.madoituong and f.userid=u.id(+) ";
			sql+="and f.nhantu=i.ma and f.dentu=j.ma and f.maql=k.maql and f.loaiba=2";
			if (icd) sql+=" and f.maicd in (select ma from dmicd10)";
			if (tu!="") 
			{
				if (time)
					sql+=" and f.ngay between to_date('"+tu+"',"+stime+") and to_date('"+den+"',"+stime+")";
				else
					sql+=" and to_date(f.ngay,"+stime+") between to_date('"+tu+"',"+stime+") and to_date('"+den+"',"+stime+")";
			}
			if (dotuoi!="")
			{
				if (dotuoi.IndexOf(">")!=-1)
				{
					m_dotuoi=dotuoi.Substring(1);
					sql+=" and to_char(f.ngay,'yyyy')-a.namsinh>"+int.Parse(m_dotuoi);//sql+=" and to_char(sysdate,'yyyy')-a.namsinh>"+int.Parse(m_dotuoi);
				}
				else 
				{
					int i1=int.Parse(dotuoi.Substring(0,dotuoi.IndexOf("-")));
					int i2=int.Parse(dotuoi.Substring(dotuoi.IndexOf("-")+1));
					sql+=" and to_char(f.ngay,'yyyy')-a.namsinh between "+i1+" and "+i2;//sql+=" and to_char(sysdate,'yyyy')-a.namsinh between "+i1+" and "+i2;
				}

			}
			if (mabn!="") sql+=" and a.mabn='"+mabn+"'";
			if (hoten!="") sql+=" and a.hotenkdau='"+hoten+"'";
			if (ngaysinh!="") sql+=" and to_char(a.ngaysinh,'dd/mm/yyyy')='"+ngaysinh+"'";
			if (phai!=-1) sql+=" and a.phai="+phai;
			if (sonha!="") sql+=" and lower(trim(a.sonha))='"+sonha+"'";
			if (thon!="") sql+=" and lower(trim(a.thon))='"+thon+"'";
			if (mann!="") sql+=" and a.mann='"+mann+"'";
			if (madantoc!="") sql+=" and a.madantoc='"+madantoc+"'";
			if (matt!="") sql+=" and a.matt='"+matt+"'";
			if (maqu!="")	sql+=" and a.maqu='"+maqu+"'";
			if (maphuongxa!="")	sql+=" and a.maphuongxa='"+maphuongxa+"'";
			if (makp!="") sql+=" and f.makp='"+makp+"'";
			if (sovaovien!="") sql+=" and f.sovaovien='"+sovaovien+"'";
			if (maicd!="")	sql+=" and f.maicd='"+maicd+"'";
			if (madoituong!="")	sql+=" and f.madoituong="+madoituong;
			if (dentu!="") sql+=" and f.dentu="+dentu;
			if (nhantu!="")	sql+=" and f.nhantu="+nhantu;
			if (userid!=-1) sql+=" and f.userid="+userid;
			ret=get_data(sql);
			if (taikham!=1)
			{
				sql="select a.mabn,a.hoten,substr(k.tuoivao,1,3)||decode(substr(k.tuoivao,4,1),0,'TU',decode(substr(k.tuoivao,4,1),1,'TH',decode(substr(k.tuoivao,4,1),2,'NG','GI'))) tuoi,";
				sql+="case when a.ngaysinh is null then a.namsinh else to_char(a.ngaysinh,'dd/mm/yy') end as namsinh,nvl(a.sonha,' ') sonha,nvl(a.thon,' ') thon,b.tenpxa,c.tenquan,d.tentt,";
				sql+="g.tennn,to_char(f.ngay,'dd/mm/yyyy hh24:mi') as ngay,e.tenkp,h.doituong,";
				sql+="f.chandoan,f.maicd,f.sovaovien,i.ten as nhantu,j.ten as dentu,nvl(u.hoten,' ') as tenuser ";
				sql+="from btdbn a,btdpxa b,btdquan c,btdtt d,btdkp_bv e,xxx.benhandt f,";
				sql+="btdnn_bv g,doituong h,nhantu i,dentu j,xxx.lienhe k,dlogin u ";
				sql+="where a.mabn=f.mabn and a.maphuongxa=b.maphuongxa and a.maqu=c.maqu and a.matt=d.matt ";
				sql+="and f.makp=e.makp and a.mann=g.mann and f.madoituong=h.madoituong and f.userid=u.id(+) ";
				sql+="and f.nhantu=i.ma and f.dentu=j.ma and f.maql=k.maql and f.loaiba=3 and f.mangtr<>0";
				if (icd) sql+=" and f.maicd in (select ma from dmicd10)";
				if (tu!="") 
				{
					if (time)
						sql+=" and f.ngay between to_date('"+tu+"',"+stime+") and to_date('"+den+"',"+stime+")";
					else
						sql+=" and to_date(f.ngay,"+stime+") between to_date('"+tu+"',"+stime+") and to_date('"+den+"',"+stime+")";
				}
				if (dotuoi!="")
				{
					if (dotuoi.IndexOf(">")!=-1)
					{
						m_dotuoi=dotuoi.Substring(1);
						sql+=" and to_char(f.ngay,'yyyy')-a.namsinh>"+int.Parse(m_dotuoi);//sql+=" and to_char(sysdate,'yyyy')-a.namsinh>"+int.Parse(m_dotuoi);
					}
					else 
					{
						int i1=int.Parse(dotuoi.Substring(0,dotuoi.IndexOf("-")));
						int i2=int.Parse(dotuoi.Substring(dotuoi.IndexOf("-")+1));
						sql+=" and to_char(f.ngay,'yyyy')-a.namsinh between "+i1+" and "+i2;//sql+=" and to_char(sysdate,'yyyy')-a.namsinh between "+i1+" and "+i2;
					}

				}
				if (mabn!="") sql+=" and a.mabn='"+mabn+"'";
				if (hoten!="") sql+=" and a.hotenkdau='"+hoten+"'";
				if (ngaysinh!="") sql+=" and to_char(a.ngaysinh,'dd/mm/yyyy')='"+ngaysinh+"'";
				if (phai!=-1) sql+=" and a.phai="+phai;
				if (sonha!="") sql+=" and lower(trim(a.sonha))='"+sonha+"'";
				if (thon!="") sql+=" and lower(trim(a.thon))='"+thon+"'";
				if (mann!="") sql+=" and a.mann='"+mann+"'";
				if (madantoc!="") sql+=" and a.madantoc='"+madantoc+"'";
				if (matt!="") sql+=" and a.matt='"+matt+"'";
				if (maqu!="")	sql+=" and a.maqu='"+maqu+"'";
				if (maphuongxa!="")	sql+=" and a.maphuongxa='"+maphuongxa+"'";
				if (makp!="") sql+=" and f.makp='"+makp+"'";
				if (sovaovien!="") sql+=" and f.sovaovien='"+sovaovien+"'";
				if (maicd!="")	sql+=" and f.maicd='"+maicd+"'";
				if (madoituong!="")	sql+=" and f.madoituong="+madoituong;
				if (dentu!="") sql+=" and f.dentu="+dentu;
				if (nhantu!="")	sql+=" and f.nhantu="+nhantu;
				if (userid!=-1) sql+=" and f.userid="+userid;
				ret.Merge(get_data_mmyy(sql,tu,den,false));
			}
			return ret;
		}

		public DataSet get_Vaongoaitru(string tu,string den,string mabn,string hoten,string ngaysinh,
			int phai,string sonha,string thon,string mann,string madantoc,string matt,string maqu, 
			string maphuongxa,string makp,string sovaovien,string maicd,string madoituong,string dentu,
			string nhantu,string dotuoi,bool icd,int userid,bool time,int taikham)
		{	
			DataSet ret=new DataSet();
			string m_dotuoi="",stime=(time)?"'dd/mm/yy hh24:mi'":"'dd/mm/yy'";
			if (time)
			{
				tu=tu+" "+sGiobaocao;
				den=den+" "+sGiobaocao;
			}
			hoten=Hoten_khongdau(hoten);
			sql="select a.mabn,a.hoten,substr(k.tuoivao,1,3)||decode(substr(k.tuoivao,4,1),0,'TU',decode(substr(k.tuoivao,4,1),1,'TH',decode(substr(k.tuoivao,4,1),2,'NG','GI'))) tuoi,";
			sql+="case when a.ngaysinh is null then a.namsinh else to_char(a.ngaysinh,'dd/mm/yy') end as namsinh,nvl(a.sonha,' ') sonha,nvl(a.thon,' ') thon,b.tenpxa,c.tenquan,d.tentt,";
			sql+="g.tennn,to_char(f.ngay,'dd/mm/yyyy hh24:mi') as ngay,e.tenkp,h.doituong,";
			sql+="f.chandoan,f.maicd,f.sovaovien,i.ten as nhantu,j.ten as dentu,nvl(u.hoten,' ') as tenuser ";
			sql+="from btdbn a,btdpxa b,btdquan c,btdtt d,btdkp_bv e,benhandt f,";
			sql+="btdnn_bv g,doituong h,nhantu i,dentu j,lienhe k,dlogin u ";
			sql+="where a.mabn=f.mabn and a.maphuongxa=b.maphuongxa and a.maqu=c.maqu and a.matt=d.matt ";
			sql+="and f.makp=e.makp and a.mann=g.mann and f.madoituong=h.madoituong and f.userid=u.id(+) ";
			sql+="and f.nhantu=i.ma and f.dentu=j.ma and f.maql=k.maql and f.loaiba=2";
			if (icd) sql+=" and f.maicd in (select ma from dmicd10)";
			if (tu!="") 
			{
				if (time)
					sql+=" and f.ngay between to_date('"+tu+"',"+stime+") and to_date('"+den+"',"+stime+")";
				else
					sql+=" and to_date(f.ngay,"+stime+") between to_date('"+tu+"',"+stime+") and to_date('"+den+"',"+stime+")";
			}
			if (dotuoi!="")
			{
				//ThanhCuong-25052011
				if (dotuoi.IndexOf("N") != -1)
				{
					int d1 = int.Parse(dotuoi.Substring(0, dotuoi.IndexOf("-")));
					int d2 = int.Parse(dotuoi.Substring(dotuoi.IndexOf("-") + 1,dotuoi.Length-(dotuoi.IndexOf("-") + 1)-1));
					sql += " and a.ngaysinh is not null and to_date(to_char(f.ngay,'dd/mm/yyyy'),'dd/mm/yyyy')-to_date(to_char(a.ngaysinh,'dd/mm/yyyy'),'dd/mm/yyyy') between " + d1 + " and " + d2 ;//từ ngày dến ngay
				}
				else if (dotuoi.Trim() == "<1T")
				{
					sql += " and a.ngaysinh is not null and to_date(to_char(f.ngay,'dd/mm/yyyy'),'dd/mm/yyyy')-to_date(to_char(a.ngaysinh,'dd/mm/yyyy'),'dd/mm/yyyy') between 0 and 365 ";//DUOI 1 TUOI
				}
				else if (dotuoi.IndexOf(">") != -1)
				{
					sql += " and to_number(to_char(f.ngay,'yyyy'),'0000')-to_number(a.namsinh,'0000')>" + int.Parse(dotuoi.Substring(1)); 
				}
				else
				{
					int i1 = int.Parse(dotuoi.Substring(0, dotuoi.IndexOf("-")));
					int i2 = int.Parse(dotuoi.Substring(dotuoi.IndexOf("-") + 1));
					sql += " and to_number(to_char(f.ngay,'yyyy'),'0000')-to_number(a.namsinh,'0000') between " + i1 + " and " + i2; 
				}
				//
				//				if (dotuoi.IndexOf(">")!=-1)
				//				{
				//					m_dotuoi=dotuoi.Substring(1);
				//					sql+=" and to_char(f.ngay,'yyyy')-a.namsinh>"+int.Parse(m_dotuoi);//sql+=" and to_char(sysdate,'yyyy')-a.namsinh>"+int.Parse(m_dotuoi);
				//				}
				//				else 
				//				{
				//					int i1=int.Parse(dotuoi.Substring(0,dotuoi.IndexOf("-")));
				//					int i2=int.Parse(dotuoi.Substring(dotuoi.IndexOf("-")+1));
				//					sql+=" and to_char(f.ngay,'yyyy')-a.namsinh between "+i1+" and "+i2;//sql+=" and to_char(sysdate,'yyyy')-a.namsinh between "+i1+" and "+i2;
				//				}
			}
			if (mabn!="") sql+=" and a.mabn='"+mabn+"'";
			if (hoten!="") sql+=" and a.hotenkdau='"+hoten+"'";
			if (ngaysinh!="") sql+=" and to_char(a.ngaysinh,'dd/mm/yyyy')='"+ngaysinh+"'";
			if (phai!=-1) sql+=" and a.phai="+phai;
			if (sonha!="") sql+=" and lower(trim(a.sonha))='"+sonha+"'";
			if (thon!="") sql+=" and lower(trim(a.thon))='"+thon+"'";
			if (mann!="") sql+=" and a.mann='"+mann+"'";
			if (madantoc!="") sql+=" and a.madantoc='"+madantoc+"'";
			if (matt!="") sql+=" and a.matt='"+matt+"'";
			if (maqu!="")	sql+=" and a.maqu='"+maqu+"'";
			if (maphuongxa!="")	sql+=" and a.maphuongxa='"+maphuongxa+"'";
			if (makp!="") sql+=" and f.makp='"+makp+"'";
			if (sovaovien!="") sql+=" and f.sovaovien='"+sovaovien+"'";
			if (maicd!="")	sql+=" and f.maicd='"+maicd+"'";
			if (madoituong!="")	sql+=" and f.madoituong="+madoituong;
			if (dentu!="") sql+=" and f.dentu="+dentu;
			if (nhantu!="")	sql+=" and f.nhantu="+nhantu;
			if (userid!=-1) sql+=" and f.userid="+userid;
			ret=get_data(sql);
			if (taikham!=1)
			{
				sql="select a.mabn,a.hoten,substr(k.tuoivao,1,3)||decode(substr(k.tuoivao,4,1),0,'TU',decode(substr(k.tuoivao,4,1),1,'TH',decode(substr(k.tuoivao,4,1),2,'NG','GI'))) tuoi,";
				sql+="case when a.ngaysinh is null then a.namsinh else to_char(a.ngaysinh,'dd/mm/yy') end as namsinh,nvl(a.sonha,' ') sonha,nvl(a.thon,' ') thon,b.tenpxa,c.tenquan,d.tentt,";
				sql+="g.tennn,to_char(f.ngay,'dd/mm/yyyy hh24:mi') as ngay,e.tenkp,h.doituong,";
				sql+="f.chandoan,f.maicd,f.sovaovien,i.ten as nhantu,j.ten as dentu,nvl(u.hoten,' ') as tenuser ";
				sql+="from btdbn a,btdpxa b,btdquan c,btdtt d,btdkp_bv e,xxx.benhandt f,";
				sql+="btdnn_bv g,doituong h,nhantu i,dentu j,xxx.lienhe k,dlogin u ";
				sql+="where a.mabn=f.mabn and a.maphuongxa=b.maphuongxa and a.maqu=c.maqu and a.matt=d.matt ";
				sql+="and f.makp=e.makp and a.mann=g.mann and f.madoituong=h.madoituong and f.userid=u.id(+) ";
				sql+="and f.nhantu=i.ma and f.dentu=j.ma and f.maql=k.maql and f.loaiba=3 and f.mangtr<>0";
				if (icd) sql+=" and f.maicd in (select ma from dmicd10)";
				if (tu!="") 
				{
					if (time)
						sql+=" and f.ngay between to_date('"+tu+"',"+stime+") and to_date('"+den+"',"+stime+")";
					else
						sql+=" and to_date(f.ngay,"+stime+") between to_date('"+tu+"',"+stime+") and to_date('"+den+"',"+stime+")";
				}
				if (dotuoi!="")
				{
					//ThanhCuong-25052011
					if (dotuoi.IndexOf("N") != -1)
					{
						int d1 = int.Parse(dotuoi.Substring(0, dotuoi.IndexOf("-")));
						int d2 = int.Parse(dotuoi.Substring(dotuoi.IndexOf("-") + 1,dotuoi.Length-(dotuoi.IndexOf("-") + 1)-1));
						sql += " and a.ngaysinh is not null and to_date(to_char(f.ngay,'dd/mm/yyyy'),'dd/mm/yyyy')-to_date(to_char(a.ngaysinh,'dd/mm/yyyy'),'dd/mm/yyyy') between " + d1 + " and " + d2 ;//từ ngày dến ngay
					}
					else if (dotuoi.Trim() == "<1T")
					{
						sql += " and a.ngaysinh is not null and to_date(to_char(f.ngay,'dd/mm/yyyy'),'dd/mm/yyyy')-to_date(to_char(a.ngaysinh,'dd/mm/yyyy'),'dd/mm/yyyy') between 0 and 365 ";//DUOI 1 TUOI
					}
					else if (dotuoi.IndexOf(">") != -1)
					{
						sql += " and to_number(to_char(f.ngay,'yyyy'),'0000')-to_number(a.namsinh,'0000')>" + int.Parse(dotuoi.Substring(1)); 
					}
					else
					{
						int i1 = int.Parse(dotuoi.Substring(0, dotuoi.IndexOf("-")));
						int i2 = int.Parse(dotuoi.Substring(dotuoi.IndexOf("-") + 1));
						sql += " and to_number(to_char(f.ngay,'yyyy'),'0000')-to_number(a.namsinh,'0000') between " + i1 + " and " + i2; 
					}
					//
					//					if (dotuoi.IndexOf(">")!=-1)
					//					{
					//						m_dotuoi=dotuoi.Substring(1);
					//						sql+=" and to_char(f.ngay,'yyyy')-a.namsinh>"+int.Parse(m_dotuoi);//sql+=" and to_char(sysdate,'yyyy')-a.namsinh>"+int.Parse(m_dotuoi);
					//					}
					//					else 
					//					{
					//						int i1=int.Parse(dotuoi.Substring(0,dotuoi.IndexOf("-")));
					//						int i2=int.Parse(dotuoi.Substring(dotuoi.IndexOf("-")+1));
					//						sql+=" and to_char(f.ngay,'yyyy')-a.namsinh between "+i1+" and "+i2;//sql+=" and to_char(sysdate,'yyyy')-a.namsinh between "+i1+" and "+i2;
					//					}
				}
				if (mabn!="") sql+=" and a.mabn='"+mabn+"'";
				if (hoten!="") sql+=" and a.hotenkdau='"+hoten+"'";
				if (ngaysinh!="") sql+=" and to_char(a.ngaysinh,'dd/mm/yyyy')='"+ngaysinh+"'";
				if (phai!=-1) sql+=" and a.phai="+phai;
				if (sonha!="") sql+=" and lower(trim(a.sonha))='"+sonha+"'";
				if (thon!="") sql+=" and lower(trim(a.thon))='"+thon+"'";
				if (mann!="") sql+=" and a.mann='"+mann+"'";
				if (madantoc!="") sql+=" and a.madantoc='"+madantoc+"'";
				if (matt!="") sql+=" and a.matt='"+matt+"'";
				if (maqu!="")	sql+=" and a.maqu='"+maqu+"'";
				if (maphuongxa!="")	sql+=" and a.maphuongxa='"+maphuongxa+"'";
				if (makp!="") sql+=" and f.makp='"+makp+"'";
				if (sovaovien!="") sql+=" and f.sovaovien='"+sovaovien+"'";
				if (maicd!="")	sql+=" and f.maicd='"+maicd+"'";
				if (madoituong!="")	sql+=" and f.madoituong="+madoituong;
				if (dentu!="") sql+=" and f.dentu="+dentu;
				if (nhantu!="")	sql+=" and f.nhantu="+nhantu;
				if (userid!=-1) sql+=" and f.userid="+userid;
				ret.Merge(get_data_mmyy(sql,tu,den,false));
			}
			return ret;
		}

		public DataSet get_Vaongoaitru1(string tu,string den,string mabn,string hoten,string ngaysinh,
			int phai,string sonha,string thon,string mann,string madantoc,string matt,string maqu, 
			string maphuongxa,string makp,string sovaovien,string maicd,string madoituong,string dentu,
			string nhantu,string dotuoi,bool icd,int userid,bool time,int taikham,string quoctich)
		{	
			DataSet ret=new DataSet();
			string m_dotuoi="",stime=(time)?"'dd/mm/yy hh24:mi'":"'dd/mm/yy'";
			if (time)
			{
				tu=tu+" "+sGiobaocao;
				den=den+" "+sGiobaocao;
			}
			hoten=Hoten_khongdau(hoten);
			sql="select a.mabn,a.hoten,substr(k.tuoivao,1,3)||decode(substr(k.tuoivao,4,1),0,'TU',decode(substr(k.tuoivao,4,1),1,'TH',decode(substr(k.tuoivao,4,1),2,'NG','GI'))) tuoi,";
			sql+="case when a.ngaysinh is null then a.namsinh else to_char(a.ngaysinh,'dd/mm/yy') end as namsinh,nvl(a.sonha,' ') sonha,nvl(a.thon,' ') thon,b.tenpxa,c.tenquan,d.tentt,";
			sql+="g.tennn,to_char(f.ngay,'dd/mm/yyyy hh24:mi') as ngay,e.tenkp,h.doituong,";
			sql+="f.chandoan,f.maicd,f.sovaovien,i.ten as nhantu,j.ten as dentu,nvl(u.hoten,' ') as tenuser ";
			sql+="from btdbn a,btdpxa b,btdquan c,btdtt d,btdkp_bv e,benhandt f,";
			sql+="btdnn_bv g,doituong h,nhantu i,dentu j,lienhe k,dlogin u,nuocngoai q1,dmquocgia q ";
			sql+="where a.mabn=f.mabn and a.maphuongxa=b.maphuongxa and a.maqu=c.maqu and a.matt=d.matt ";
			sql+="and f.makp=e.makp and a.mann=g.mann and f.madoituong=h.madoituong and f.userid=u.id(+) ";
			sql+="and f.nhantu=i.ma and f.dentu=j.ma and f.maql=k.maql and a.mabn=q1.mabn(+) and q1.id_nuoc=q.ma(+) and f.loaiba=2";
			if (icd) sql+=" and f.maicd in (select ma from dmicd10)";
			if (tu!="") 
			{
				if (time)
					sql+=" and f.ngay between to_date('"+tu+"',"+stime+") and to_date('"+den+"',"+stime+")";
				else
					sql+=" and to_date(f.ngay,"+stime+") between to_date('"+tu+"',"+stime+") and to_date('"+den+"',"+stime+")";
			}
			if (dotuoi!="")
			{
				if (dotuoi.IndexOf(">")!=-1)
				{
					m_dotuoi=dotuoi.Substring(1);
					sql+=" and to_char(f.ngay,'yyyy')-a.namsinh>"+int.Parse(m_dotuoi);//sql+=" and to_char(sysdate,'yyyy')-a.namsinh>"+int.Parse(m_dotuoi);
				}
				else 
				{
					int i1=int.Parse(dotuoi.Substring(0,dotuoi.IndexOf("-")));
					int i2=int.Parse(dotuoi.Substring(dotuoi.IndexOf("-")+1));
					sql+=" and to_char(f.ngay,'yyyy')-a.namsinh between "+i1+" and "+i2;//sql+=" and to_char(sysdate,'yyyy')-a.namsinh between "+i1+" and "+i2;
				}
			}
			if (mabn!="") sql+=" and a.mabn='"+mabn+"'";
			if (hoten!="") sql+=" and a.hotenkdau='"+hoten+"'";
			if (ngaysinh!="") sql+=" and to_char(a.ngaysinh,'dd/mm/yyyy')='"+ngaysinh+"'";
			if (phai!=-1) sql+=" and a.phai="+phai;
			if (sonha!="") sql+=" and lower(trim(a.sonha))='"+sonha+"'";
			if (thon!="") sql+=" and lower(trim(a.thon))='"+thon+"'";
			if (mann!="") sql+=" and a.mann='"+mann+"'";
			if (madantoc!="") sql+=" and a.madantoc='"+madantoc+"'";
			if (matt!="") sql+=" and a.matt='"+matt+"'";
			if (maqu!="")	sql+=" and a.maqu='"+maqu+"'";
			if (maphuongxa!="")	sql+=" and a.maphuongxa='"+maphuongxa+"'";
			if (makp!="") sql+=" and f.makp='"+makp+"'";
			if (sovaovien!="") sql+=" and f.sovaovien='"+sovaovien+"'";
			if (maicd!="")	sql+=" and f.maicd='"+maicd+"'";
			if (madoituong!="")	sql+=" and f.madoituong="+madoituong;
			if (dentu!="") sql+=" and f.dentu="+dentu;
			if (nhantu!="")	sql+=" and f.nhantu="+nhantu;
			if (quoctich != "") sql+= " and q.ten like '%"+quoctich+"%'";
			if (userid!=-1) sql+=" and f.userid="+userid;
			ret=get_data(sql);
			if (taikham!=1)
			{
				sql="select a.mabn,a.hoten,substr(k.tuoivao,1,3)||decode(substr(k.tuoivao,4,1),0,'TU',decode(substr(k.tuoivao,4,1),1,'TH',decode(substr(k.tuoivao,4,1),2,'NG','GI'))) tuoi,";
				sql+="case when a.ngaysinh is null then a.namsinh else to_char(a.ngaysinh,'dd/mm/yy') end as namsinh,nvl(a.sonha,' ') sonha,nvl(a.thon,' ') thon,b.tenpxa,c.tenquan,d.tentt,";
				sql+="g.tennn,to_char(f.ngay,'dd/mm/yyyy hh24:mi') as ngay,e.tenkp,h.doituong,";
				sql+="f.chandoan,f.maicd,f.sovaovien,i.ten as nhantu,j.ten as dentu,nvl(u.hoten,' ') as tenuser ";
				sql+="from btdbn a,btdpxa b,btdquan c,btdtt d,btdkp_bv e,xxx.benhandt f,";
				sql+="btdnn_bv g,doituong h,nhantu i,dentu j,xxx.lienhe k,dlogin u,nuocngoai q1, dmquocgia q ";
				sql+="where a.mabn=f.mabn and a.maphuongxa=b.maphuongxa and a.maqu=c.maqu and a.matt=d.matt ";
				sql+="and f.makp=e.makp and a.mann=g.mann and f.madoituong=h.madoituong and f.userid=u.id(+) ";
				sql+="and f.nhantu=i.ma and f.dentu=j.ma and f.maql=k.maql and a.mabn=q1.mabn and q1.id_nuoc=q.ma and f.loaiba=3 and f.mangtr<>0";
				if (icd) sql+=" and f.maicd in (select ma from dmicd10)";
				if (tu!="") 
				{
					if (time)
						sql+=" and f.ngay between to_date('"+tu+"',"+stime+") and to_date('"+den+"',"+stime+")";
					else
						sql+=" and to_date(f.ngay,"+stime+") between to_date('"+tu+"',"+stime+") and to_date('"+den+"',"+stime+")";
				}
				if (dotuoi!="")
				{
					if (dotuoi.IndexOf(">")!=-1)
					{
						m_dotuoi=dotuoi.Substring(1);
						sql+=" and to_char(f.ngay,'yyyy')-a.namsinh>"+int.Parse(m_dotuoi);//sql+=" and to_char(sysdate,'yyyy')-a.namsinh>"+int.Parse(m_dotuoi);
					}
					else 
					{
						int i1=int.Parse(dotuoi.Substring(0,dotuoi.IndexOf("-")));
						int i2=int.Parse(dotuoi.Substring(dotuoi.IndexOf("-")+1));
						sql+=" and to_char(f.ngay,'yyyy')-a.namsinh between "+i1+" and "+i2;//sql+=" and to_char(sysdate,'yyyy')-a.namsinh between "+i1+" and "+i2;
					}
				}
				if (mabn!="") sql+=" and a.mabn='"+mabn+"'";
				if (hoten!="") sql+=" and a.hotenkdau='"+hoten+"'";
				if (ngaysinh!="") sql+=" and to_char(a.ngaysinh,'dd/mm/yyyy')='"+ngaysinh+"'";
				if (phai!=-1) sql+=" and a.phai="+phai;
				if (sonha!="") sql+=" and lower(trim(a.sonha))='"+sonha+"'";
				if (thon!="") sql+=" and lower(trim(a.thon))='"+thon+"'";
				if (mann!="") sql+=" and a.mann='"+mann+"'";
				if (madantoc!="") sql+=" and a.madantoc='"+madantoc+"'";
				if (matt!="") sql+=" and a.matt='"+matt+"'";
				if (maqu!="")	sql+=" and a.maqu='"+maqu+"'";
				if (maphuongxa!="")	sql+=" and a.maphuongxa='"+maphuongxa+"'";
				if (makp!="") sql+=" and f.makp='"+makp+"'";
				if (sovaovien!="") sql+=" and f.sovaovien='"+sovaovien+"'";
				if (maicd!="")	sql+=" and f.maicd='"+maicd+"'";
				if (madoituong!="")	sql+=" and f.madoituong="+madoituong;
				if (dentu!="") sql+=" and f.dentu="+dentu;
				if (nhantu!="")	sql+=" and f.nhantu="+nhantu;
				if (quoctich != "") sql+= " and q.ten like '%"+quoctich+"%'";
				if (userid!=-1) sql+=" and f.userid="+userid;
				ret.Merge(get_data_mmyy(sql,tu,den,false));
			}
			return ret;
		}

		public DataSet get_Vaongoaitru(string tu,string den,string mabn,string hoten,string ngaysinh,
			int phai,string sonha,string thon,string mann,string madantoc,string matt,string maqu, 
			string maphuongxa,string makp,string sovaovien,string maicd,string madoituong,string dentu,
			string nhantu,string dotuoi,bool icd,int userid,bool time,int taikham,string quoctich)
		{	
			DataSet ret=new DataSet();
			string m_dotuoi="",stime=(time)?"'dd/mm/yy hh24:mi'":"'dd/mm/yy'";
			if (time)
			{
				tu=tu+" "+sGiobaocao;
				den=den+" "+sGiobaocao;
			}
			hoten=Hoten_khongdau(hoten);
			sql="select a.mabn,a.hoten,substr(k.tuoivao,1,3)||decode(substr(k.tuoivao,4,1),0,'TU',decode(substr(k.tuoivao,4,1),1,'TH',decode(substr(k.tuoivao,4,1),2,'NG','GI'))) tuoi,";
			sql+="case when a.ngaysinh is null then a.namsinh else to_char(a.ngaysinh,'dd/mm/yy') end as namsinh,nvl(a.sonha,' ') sonha,nvl(a.thon,' ') thon,b.tenpxa,c.tenquan,d.tentt,";
			sql+="g.tennn,to_char(f.ngay,'dd/mm/yyyy hh24:mi') as ngay,e.tenkp,h.doituong,";
			sql+="f.chandoan,f.maicd,f.sovaovien,i.ten as nhantu,j.ten as dentu,nvl(u.hoten,' ') as tenuser ";
			sql+="from btdbn a,btdpxa b,btdquan c,btdtt d,btdkp_bv e,benhandt f,";
			sql+="btdnn_bv g,doituong h,nhantu i,dentu j,lienhe k,dlogin u,nuocngoai q1,dmquocgia q ";
			sql+="where a.mabn=f.mabn and a.maphuongxa=b.maphuongxa and a.maqu=c.maqu and a.matt=d.matt ";
			sql+="and f.makp=e.makp and a.mann=g.mann and f.madoituong=h.madoituong and f.userid=u.id(+) ";
			sql+="and f.nhantu=i.ma and f.dentu=j.ma and f.maql=k.maql and a.mabn=q1.mabn(+) and q1.id_nuoc=q.ma(+) and f.loaiba=2";
			if (icd) sql+=" and f.maicd in (select ma from dmicd10)";
			if (tu!="") 
			{
				if (time)
					sql+=" and f.ngay between to_date('"+tu+"',"+stime+") and to_date('"+den+"',"+stime+")";
				else
					sql+=" and to_date(f.ngay,"+stime+") between to_date('"+tu+"',"+stime+") and to_date('"+den+"',"+stime+")";
			}
			if (dotuoi!="")
			{
				//ThanhCuong-25052011
				if (dotuoi.IndexOf("N") != -1)
				{
					int d1 = int.Parse(dotuoi.Substring(0, dotuoi.IndexOf("-")));
					int d2 = int.Parse(dotuoi.Substring(dotuoi.IndexOf("-") + 1,dotuoi.Length-(dotuoi.IndexOf("-") + 1)-1));
					sql += " and a.ngaysinh is not null and to_date(to_char(f.ngay,'dd/mm/yyyy'),'dd/mm/yyyy')-to_date(to_char(a.ngaysinh,'dd/mm/yyyy'),'dd/mm/yyyy') between " + d1 + " and " + d2 ;//từ ngày dến ngay
				}
				else if (dotuoi.Trim() == "<1T")
				{
					sql += " and a.ngaysinh is not null and to_date(to_char(f.ngay,'dd/mm/yyyy'),'dd/mm/yyyy')-to_date(to_char(a.ngaysinh,'dd/mm/yyyy'),'dd/mm/yyyy') between 0 and 365 ";//DUOI 1 TUOI
				}
				else if (dotuoi.IndexOf(">") != -1)
				{
					sql += " and to_number(to_char(f.ngay,'yyyy'),'0000')-to_number(a.namsinh,'0000')>" + int.Parse(dotuoi.Substring(1)); 
				}
				else
				{
					int i1 = int.Parse(dotuoi.Substring(0, dotuoi.IndexOf("-")));
					int i2 = int.Parse(dotuoi.Substring(dotuoi.IndexOf("-") + 1));
					sql += " and to_number(to_char(f.ngay,'yyyy'),'0000')-to_number(a.namsinh,'0000') between " + i1 + " and " + i2; 
				}
				//
			}
			if (mabn!="") sql+=" and a.mabn='"+mabn+"'";
			if (hoten!="") sql+=" and a.hotenkdau='"+hoten+"'";
			if (ngaysinh!="") sql+=" and to_char(a.ngaysinh,'dd/mm/yyyy')='"+ngaysinh+"'";
			if (phai!=-1) sql+=" and a.phai="+phai;
			if (sonha!="") sql+=" and lower(trim(a.sonha))='"+sonha+"'";
			if (thon!="") sql+=" and lower(trim(a.thon))='"+thon+"'";
			if (mann!="") sql+=" and a.mann='"+mann+"'";
			if (madantoc!="") sql+=" and a.madantoc='"+madantoc+"'";
			if (matt!="") sql+=" and a.matt='"+matt+"'";
			if (maqu!="")	sql+=" and a.maqu='"+maqu+"'";
			if (maphuongxa!="")	sql+=" and a.maphuongxa='"+maphuongxa+"'";
			if (makp!="") sql+=" and f.makp='"+makp+"'";
			if (sovaovien!="") sql+=" and f.sovaovien='"+sovaovien+"'";
			if (maicd!="")	sql+=" and f.maicd='"+maicd+"'";
			if (madoituong!="")	sql+=" and f.madoituong="+madoituong;
			if (dentu!="") sql+=" and f.dentu="+dentu;
			if (nhantu!="")	sql+=" and f.nhantu="+nhantu;
			if (quoctich != "") sql+= " and q.ten like '%"+quoctich+"%'";
			if (userid!=-1) sql+=" and f.userid="+userid;
			ret=get_data(sql);
			if (taikham!=1)
			{
				sql="select a.mabn,a.hoten,substr(k.tuoivao,1,3)||decode(substr(k.tuoivao,4,1),0,'TU',decode(substr(k.tuoivao,4,1),1,'TH',decode(substr(k.tuoivao,4,1),2,'NG','GI'))) tuoi,";
				sql+="case when a.ngaysinh is null then a.namsinh else to_char(a.ngaysinh,'dd/mm/yy') end as namsinh,nvl(a.sonha,' ') sonha,nvl(a.thon,' ') thon,b.tenpxa,c.tenquan,d.tentt,";
				sql+="g.tennn,to_char(f.ngay,'dd/mm/yyyy hh24:mi') as ngay,e.tenkp,h.doituong,";
				sql+="f.chandoan,f.maicd,f.sovaovien,i.ten as nhantu,j.ten as dentu,nvl(u.hoten,' ') as tenuser ";
				sql+="from btdbn a,btdpxa b,btdquan c,btdtt d,btdkp_bv e,xxx.benhandt f,";
				sql+="btdnn_bv g,doituong h,nhantu i,dentu j,xxx.lienhe k,dlogin u,nuocngoai q1, dmquocgia q ";
				sql+="where a.mabn=f.mabn and a.maphuongxa=b.maphuongxa and a.maqu=c.maqu and a.matt=d.matt ";
				sql+="and f.makp=e.makp and a.mann=g.mann and f.madoituong=h.madoituong and f.userid=u.id(+) ";
				sql+="and f.nhantu=i.ma and f.dentu=j.ma and f.maql=k.maql and a.mabn=q1.mabn and q1.id_nuoc=q.ma and f.loaiba=3 and f.mangtr<>0";
				if (icd) sql+=" and f.maicd in (select ma from dmicd10)";
				if (tu!="") 
				{
					if (time)
						sql+=" and f.ngay between to_date('"+tu+"',"+stime+") and to_date('"+den+"',"+stime+")";
					else
						sql+=" and to_date(f.ngay,"+stime+") between to_date('"+tu+"',"+stime+") and to_date('"+den+"',"+stime+")";
				}
				if (dotuoi!="")
				{
					//ThanhCuong-25052011
					if (dotuoi.IndexOf("N") != -1)
					{
						int d1 = int.Parse(dotuoi.Substring(0, dotuoi.IndexOf("-")));
						int d2 = int.Parse(dotuoi.Substring(dotuoi.IndexOf("-") + 1,dotuoi.Length-(dotuoi.IndexOf("-") + 1)-1));
						sql += " and a.ngaysinh is not null and to_date(to_char(f.ngay,'dd/mm/yyyy'),'dd/mm/yyyy')-to_date(to_char(a.ngaysinh,'dd/mm/yyyy'),'dd/mm/yyyy') between " + d1 + " and " + d2 ;//từ ngày dến ngay
					}
					else if (dotuoi.Trim() == "<1T")
					{
						sql += " and a.ngaysinh is not null and to_date(to_char(f.ngay,'dd/mm/yyyy'),'dd/mm/yyyy')-to_date(to_char(a.ngaysinh,'dd/mm/yyyy'),'dd/mm/yyyy') between 0 and 365 ";//DUOI 1 TUOI
					}
					else if (dotuoi.IndexOf(">") != -1)
					{
						sql += " and to_number(to_char(f.ngay,'yyyy'),'0000')-to_number(a.namsinh,'0000')>" + int.Parse(dotuoi.Substring(1)); 
					}
					else
					{
						int i1 = int.Parse(dotuoi.Substring(0, dotuoi.IndexOf("-")));
						int i2 = int.Parse(dotuoi.Substring(dotuoi.IndexOf("-") + 1));
						sql += " and to_number(to_char(f.ngay,'yyyy'),'0000')-to_number(a.namsinh,'0000') between " + i1 + " and " + i2; 
					}
					//
				}
				if (mabn!="") sql+=" and a.mabn='"+mabn+"'";
				if (hoten!="") sql+=" and a.hotenkdau='"+hoten+"'";
				if (ngaysinh!="") sql+=" and to_char(a.ngaysinh,'dd/mm/yyyy')='"+ngaysinh+"'";
				if (phai!=-1) sql+=" and a.phai="+phai;
				if (sonha!="") sql+=" and lower(trim(a.sonha))='"+sonha+"'";
				if (thon!="") sql+=" and lower(trim(a.thon))='"+thon+"'";
				if (mann!="") sql+=" and a.mann='"+mann+"'";
				if (madantoc!="") sql+=" and a.madantoc='"+madantoc+"'";
				if (matt!="") sql+=" and a.matt='"+matt+"'";
				if (maqu!="")	sql+=" and a.maqu='"+maqu+"'";
				if (maphuongxa!="")	sql+=" and a.maphuongxa='"+maphuongxa+"'";
				if (makp!="") sql+=" and f.makp='"+makp+"'";
				if (sovaovien!="") sql+=" and f.sovaovien='"+sovaovien+"'";
				if (maicd!="")	sql+=" and f.maicd='"+maicd+"'";
				if (madoituong!="")	sql+=" and f.madoituong="+madoituong;
				if (dentu!="") sql+=" and f.dentu="+dentu;
				if (nhantu!="")	sql+=" and f.nhantu="+nhantu;
				if (quoctich != "") sql+= " and q.ten like '%"+quoctich+"%'";
				if (userid!=-1) sql+=" and f.userid="+userid;
				ret.Merge(get_data_mmyy(sql,tu,den,false));
			}
			return ret;
		}

		public DataSet get_Taikham1(string tu,string den,string mabn,string hoten,string ngaysinh,
			int phai,string sonha,string thon,string mann,string madantoc,string matt,string maqu, 
			string maphuongxa,string makp,string sovaovien,string maicd,string madoituong,string dentu,
			string nhantu,string dotuoi,bool icd,int userid,bool time)
		{	
			string m_dotuoi="",stime=(time)?"'dd/mm/yy hh24:mi'":"'dd/mm/yy'";
			if (time)
			{
				tu=tu+" "+sGiobaocao;
				den=den+" "+sGiobaocao;
			}
			hoten=Hoten_khongdau(hoten);
			sql="select a.mabn,a.hoten,substr(k.tuoivao,1,3)||decode(substr(k.tuoivao,4,1),0,'TU',decode(substr(k.tuoivao,4,1),1,'TH',decode(substr(k.tuoivao,4,1),2,'NG','GI'))) tuoi,";
			sql+="case when a.ngaysinh is null then a.namsinh else to_char(a.ngaysinh,'dd/mm/yy') end as namsinh,nvl(a.sonha,' ') sonha,nvl(a.thon,' ') thon,b.tenpxa,c.tenquan,d.tentt,";
			sql+="g.tennn,to_char(f.ngay,'dd/mm/yyyy hh24:mi') as ngay,e.tenkp,h.doituong,";
			sql+="f.chandoan,f.maicd,f.sovaovien,i.ten as nhantu,j.ten as dentu,nvl(u.hoten,' ') as tenuser ";
			sql+="from btdbn a,btdpxa b,btdquan c,btdtt d,btdkp_bv e,xxx.benhandt f,";
			sql+="btdnn_bv g,doituong h,nhantu i,dentu j,xxx.lienhe k,dlogin u ";
			sql+="where a.mabn=f.mabn and a.maphuongxa=b.maphuongxa and a.maqu=c.maqu and a.matt=d.matt ";
			sql+="and f.makp=e.makp and a.mann=g.mann and f.madoituong=h.madoituong and f.userid=u.id(+) ";
			sql+="and f.nhantu=i.ma and f.dentu=j.ma and f.maql=k.maql";
			sql+=" and f.loaiba=3 and f.mangtr<>0";
			if (icd) sql+=" and f.maicd in (select ma from dmicd10)";
			if (tu!="") 
			{
				if (time)
					sql+=" and f.ngay between to_date('"+tu+"',"+stime+") and to_date('"+den+"',"+stime+")";
				else
					sql+=" and to_date(f.ngay,"+stime+") between to_date('"+tu+"',"+stime+") and to_date('"+den+"',"+stime+")";
			}
			if (dotuoi!="")
			{
				if (dotuoi.IndexOf(">")!=-1)
				{
					m_dotuoi=dotuoi.Substring(1);
					sql+=" and to_char(f.ngay,'yyyy')-a.namsinh>"+int.Parse(m_dotuoi);//sql+=" and to_char(sysdate,'yyyy')-a.namsinh>"+int.Parse(m_dotuoi);
				}
				else 
				{
					int i1=int.Parse(dotuoi.Substring(0,dotuoi.IndexOf("-")));
					int i2=int.Parse(dotuoi.Substring(dotuoi.IndexOf("-")+1));
					sql+=" and to_char(f.ngay,'yyyy')-a.namsinh between "+i1+" and "+i2;//sql+=" and to_char(sysdate,'yyyy')-a.namsinh between "+i1+" and "+i2;
				}
			}
			if (mabn!="") sql+=" and a.mabn='"+mabn+"'";
			if (hoten!="") sql+=" and a.hotenkdau='"+hoten+"'";
			if (ngaysinh!="") sql+=" and to_char(a.ngaysinh,'dd/mm/yyyy')='"+ngaysinh+"'";
			if (phai!=-1) sql+=" and a.phai="+phai;
			if (sonha!="") sql+=" and lower(trim(a.sonha))='"+sonha+"'";
			if (thon!="") sql+=" and lower(trim(a.thon))='"+thon+"'";
			if (mann!="") sql+=" and a.mann='"+mann+"'";
			if (madantoc!="") sql+=" and a.madantoc='"+madantoc+"'";
			if (matt!="") sql+=" and a.matt='"+matt+"'";
			if (maqu!="")	sql+=" and a.maqu='"+maqu+"'";
			if (maphuongxa!="")	sql+=" and a.maphuongxa='"+maphuongxa+"'";
			if (makp!="") sql+=" and f.makp='"+makp+"'";
			if (sovaovien!="") sql+=" and f.sovaovien='"+sovaovien+"'";
			if (maicd!="")	sql+=" and f.maicd='"+maicd+"'";
			if (madoituong!="")	sql+=" and f.madoituong="+madoituong;
			if (dentu!="") sql+=" and f.dentu="+dentu;
			if (nhantu!="")	sql+=" and f.nhantu="+nhantu;
			if (userid!=-1) sql+=" and f.userid="+userid;
			sql+=" order by f.ngay";
			return get_data_mmyy(sql,tu,den,false);
		}

		public DataSet get_Taikham(string tu,string den,string mabn,string hoten,string ngaysinh,
			int phai,string sonha,string thon,string mann,string madantoc,string matt,string maqu, 
			string maphuongxa,string makp,string sovaovien,string maicd,string madoituong,string dentu,
			string nhantu,string dotuoi,bool icd,int userid,bool time)
		{	
			string m_dotuoi="",stime=(time)?"'dd/mm/yy hh24:mi'":"'dd/mm/yy'";
			if (time)
			{
				tu=tu+" "+sGiobaocao;
				den=den+" "+sGiobaocao;
			}
			hoten=Hoten_khongdau(hoten);
			sql="select a.mabn,a.hoten,substr(k.tuoivao,1,3)||decode(substr(k.tuoivao,4,1),0,'TU',decode(substr(k.tuoivao,4,1),1,'TH',decode(substr(k.tuoivao,4,1),2,'NG','GI'))) tuoi,";
			sql+="case when a.ngaysinh is null then a.namsinh else to_char(a.ngaysinh,'dd/mm/yy') end as namsinh,nvl(a.sonha,' ') sonha,nvl(a.thon,' ') thon,b.tenpxa,c.tenquan,d.tentt,";
			sql+="g.tennn,to_char(f.ngay,'dd/mm/yyyy hh24:mi') as ngay,e.tenkp,h.doituong,";
			sql+="f.chandoan,f.maicd,f.sovaovien,i.ten as nhantu,j.ten as dentu,nvl(u.hoten,' ') as tenuser ";
			sql+="from btdbn a,btdpxa b,btdquan c,btdtt d,btdkp_bv e,xxx.benhandt f,";
			sql+="btdnn_bv g,doituong h,nhantu i,dentu j,xxx.lienhe k,dlogin u ";
			sql+="where a.mabn=f.mabn and a.maphuongxa=b.maphuongxa and a.maqu=c.maqu and a.matt=d.matt ";
			sql+="and f.makp=e.makp and a.mann=g.mann and f.madoituong=h.madoituong and f.userid=u.id(+) ";
			sql+="and f.nhantu=i.ma and f.dentu=j.ma and f.maql=k.maql";
			sql+=" and f.loaiba=3 and f.mangtr<>0";
			if (icd) sql+=" and f.maicd in (select ma from dmicd10)";
			if (tu!="") 
			{
				if (time)
					sql+=" and f.ngay between to_date('"+tu+"',"+stime+") and to_date('"+den+"',"+stime+")";
				else
					sql+=" and to_date(f.ngay,"+stime+") between to_date('"+tu+"',"+stime+") and to_date('"+den+"',"+stime+")";
			}
			if (dotuoi!="")
			{
				//ThanhCuong-25052011
				if (dotuoi.IndexOf("N") != -1)
				{
					int d1 = int.Parse(dotuoi.Substring(0, dotuoi.IndexOf("-")));
					int d2 = int.Parse(dotuoi.Substring(dotuoi.IndexOf("-") + 1,dotuoi.Length-(dotuoi.IndexOf("-") + 1)-1));
					sql += " and a.ngaysinh is not null and to_date(to_char(f.ngay,'dd/mm/yyyy'),'dd/mm/yyyy')-to_date(to_char(a.ngaysinh,'dd/mm/yyyy'),'dd/mm/yyyy') between " + d1 + " and " + d2 ;//từ ngày dến ngay
				}
				else if (dotuoi.Trim() == "<1T")
				{
					sql += " and a.ngaysinh is not null and to_date(to_char(f.ngay,'dd/mm/yyyy'),'dd/mm/yyyy')-to_date(to_char(a.ngaysinh,'dd/mm/yyyy'),'dd/mm/yyyy') between 0 and 365 ";//DUOI 1 TUOI
				}
				else if (dotuoi.IndexOf(">") != -1)
				{
					sql += " and to_number(to_char(f.ngay,'yyyy'),'0000')-to_number(a.namsinh,'0000')>" + int.Parse(dotuoi.Substring(1)); 
				}
				else
				{
					int i1 = int.Parse(dotuoi.Substring(0, dotuoi.IndexOf("-")));
					int i2 = int.Parse(dotuoi.Substring(dotuoi.IndexOf("-") + 1));
					sql += " and to_number(to_char(f.ngay,'yyyy'),'0000')-to_number(a.namsinh,'0000') between " + i1 + " and " + i2; 
				}
				//
			}
			if (mabn!="") sql+=" and a.mabn='"+mabn+"'";
			if (hoten!="") sql+=" and a.hotenkdau='"+hoten+"'";
			if (ngaysinh!="") sql+=" and to_char(a.ngaysinh,'dd/mm/yyyy')='"+ngaysinh+"'";
			if (phai!=-1) sql+=" and a.phai="+phai;
			if (sonha!="") sql+=" and lower(trim(a.sonha))='"+sonha+"'";
			if (thon!="") sql+=" and lower(trim(a.thon))='"+thon+"'";
			if (mann!="") sql+=" and a.mann='"+mann+"'";
			if (madantoc!="") sql+=" and a.madantoc='"+madantoc+"'";
			if (matt!="") sql+=" and a.matt='"+matt+"'";
			if (maqu!="")	sql+=" and a.maqu='"+maqu+"'";
			if (maphuongxa!="")	sql+=" and a.maphuongxa='"+maphuongxa+"'";
			if (makp!="") sql+=" and f.makp='"+makp+"'";
			if (sovaovien!="") sql+=" and f.sovaovien='"+sovaovien+"'";
			if (maicd!="")	sql+=" and f.maicd='"+maicd+"'";
			if (madoituong!="")	sql+=" and f.madoituong="+madoituong;
			if (dentu!="") sql+=" and f.dentu="+dentu;
			if (nhantu!="")	sql+=" and f.nhantu="+nhantu;
			if (userid!=-1) sql+=" and f.userid="+userid;
			sql+=" order by f.ngay";
			return get_data_mmyy(sql,tu,den,false);
		}

		public DataSet get_Rangoaitru1(string tu,string den,string mabn,string hoten,string ngaysinh,
			int phai,string sonha,string thon,string mann,string madantoc,string matt,string maqu, 
			string maphuongxa,string makp,string soluutru,string maicd,string madoituong,string ketqua,
			string ttlucrk,string dotuoi,bool icd,int userid,bool time)
		{	
			try
			{
				string m_dotuoi="",stime=(time)?"'dd/mm/yy hh24:mi'":"'dd/mm/yy'";
				if (time)
				{
					tu=tu+" "+sGiobaocao;
					den=den+" "+sGiobaocao;
				}
				hoten=Hoten_khongdau(hoten);
				sql="select a.mabn,a.hoten,substr(m.tuoivao,1,3)||decode(substr(m.tuoivao,4,1),0,'TU',decode(substr(m.tuoivao,4,1),1,'TH',decode(substr(m.tuoivao,4,1),2,'NG','GI'))) tuoi,";
				sql+="case when a.ngaysinh is null then a.namsinh else to_char(a.ngaysinh,'dd/mm/yy') end as namsinh,nvl(a.sonha,' ') sonha,nvl(a.thon,' ') thon,b.tenpxa,c.tenquan,d.tentt,";
				sql+="g.tennn,to_char(k.ngay,'dd/mm/yyyy hh24:mi') as ngayvk,e.tenkp,h.doituong,";
				sql+="l.chandoan,l.maicd,k.sovaovien,i.ten as ketqua,nvl(j.ten,'Nhap vien') as ttlucrk,";
				sql+=" nvl(v.sothe,' ') sothe,";//to_date(l.ngay,'dd/mm/yy')-to_date(k.ngay,'dd/mm/yy') ngaydt, ";
				sql+="to_char(l.ngay,'dd/mm/yyyy hh24:mi') as ngayrk,l.soluutru, ";
				sql+="to_date(l.ngay,'dd/mm/yy')-to_date(k.ngay,'dd/mm/yy') ngaydt,nvl(u.hoten,' ') as tenuser, l.done,l.paid  ";				
				sql+=", decode(nvl(v.traituyen,0),0,'','x') as traituyen ";
				sql+=", l.maql ";
				sql+="from btdbn a,btdpxa b,btdquan c,btdtt d,btdkp_bv e,";
				sql+="btdnn_bv g,doituong h,ketqua i,ttxk j,benhandt k,xuatvien l,lienhe m,dlogin u, bhyt v ";
				sql+="where a.mabn=l.mabn and k.maql=l.maql and a.maphuongxa=b.maphuongxa and a.maqu=c.maqu and a.matt=d.matt ";
				sql+="and k.makp=e.makp and a.mann=g.mann and k.madoituong=h.madoituong and l.userid=u.id(+) ";
				sql+="and l.ketqua=i.ma and l.ttlucrv=j.ma(+) and k.loaiba=2 and l.maql=m.maql ";
				sql+=" and k.maql=v.maql(+) and (v.sudung=1 or v.sudung is null)";
				if (icd) sql+=" and l.maicd in (select ma from dmicd10)";
				if (tu!="") 
				{
					if (time)
						sql+=" and l.ngay between to_date(:tu,"+stime+") and to_date(:den,"+stime+")";
					else
						sql+=" and to_date(l.ngay,"+stime+") between to_date(:tu,"+stime+") and to_date(:den,"+stime+")";
				}
				if (mabn!="") sql+=" and a.mabn=:mabn";
				if (hoten!="") sql+=" and a.hotenkdau=:hoten";
				if (ngaysinh!="") sql+=" and to_char(a.ngaysinh,'dd/mm/yyyy')=:ngaysinh";
				if (phai!=-1) sql+=" and a.phai=:phai";
				if (sonha!="") sql+=" and lower(trim(a.sonha))=:sonha";
				if (thon!="") sql+=" and lower(trim(a.thon))=:thon";
				if (mann!="") sql+=" and a.mann=:mann";
				if (madantoc!="") sql+=" and a.madantoc=:madantoc";
				if (matt!="") sql+=" and a.matt=:matt";
				if (maqu!="")	sql+=" and a.maqu=:maqu";
				if (maphuongxa!="")	sql+=" and a.maphuongxa=:maphuongxa";
				if (makp!="") sql+=" and k.makp=:makp";
				if (soluutru!="") sql+=" and l.soluutru=:soluutru";
				if (maicd!="")	sql+=" and l.maicd=:maicd";
				if (madoituong!="")	sql+=" and k.madoituong=:madoituong";
				if (ketqua!="") sql+=" and l.ketqua=:ketqua";
				if (ttlucrk!="") sql+=" and l.ttlucrv=:ttlucrk";
				if (userid!=-1) sql+=" and l.userid=:userid";
				if (dotuoi!="")
				{
					if (dotuoi.IndexOf(">")!=-1)
					{
						m_dotuoi=dotuoi.Substring(1);
						sql+=" and to_char(l.ngay,'yyyy')-a.namsinh>"+int.Parse(m_dotuoi);//sql+=" and to_char(sysdate,'yyyy')-a.namsinh>"+int.Parse(m_dotuoi);
					}
					else 
					{
						int i1=int.Parse(dotuoi.Substring(0,dotuoi.IndexOf("-")));
						int i2=int.Parse(dotuoi.Substring(dotuoi.IndexOf("-")+1));
						sql+=" and to_char(l.ngay,'yyyy')-a.namsinh between "+i1+" and "+i2;//sql+=" and to_char(sysdate,'yyyy')-a.namsinh between "+i1+" and "+i2;
					}
				}
				sql+=" order by l.ngay";
				con=new OracleConnection(sConn);
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				if (tu!="")
				{
					cmd.Parameters.Add("tu",OracleType.VarChar).Value=tu;
					cmd.Parameters.Add("den",OracleType.VarChar).Value=den;
				}
				if (mabn!="") cmd.Parameters.Add("mabn",OracleType.VarChar).Value=mabn;
				if (hoten!="") cmd.Parameters.Add("hoten",OracleType.NVarChar).Value=hoten;
				if (ngaysinh!="") cmd.Parameters.Add("ngaysinh",OracleType.VarChar).Value=ngaysinh;
				if (phai!=-1) cmd.Parameters.Add("phai",OracleType.Int16).Value=phai;
				if (sonha!="") cmd.Parameters.Add("sonha",OracleType.NVarChar).Value=sonha.Trim().ToLower();
				if (thon!="") cmd.Parameters.Add("thon",OracleType.NVarChar).Value=thon.Trim().ToLower();
				if (mann!="") cmd.Parameters.Add("mann",OracleType.VarChar).Value=mann;
				if (madantoc!="") cmd.Parameters.Add("madantoc",OracleType.VarChar).Value=madantoc;
				if (matt!="") cmd.Parameters.Add("matt",OracleType.VarChar).Value=matt;
				if (maqu!="") cmd.Parameters.Add("maqu",OracleType.VarChar).Value=maqu;
				if (maphuongxa!="")	cmd.Parameters.Add("maphuongxa",OracleType.VarChar).Value=maphuongxa;
				if (makp!="") cmd.Parameters.Add("makp",OracleType.VarChar).Value=makp;
				if (soluutru!="") cmd.Parameters.Add("soluutru",OracleType.VarChar).Value=soluutru;
				if (maicd!="")	cmd.Parameters.Add("maicd",OracleType.VarChar).Value=maicd;
				if (madoituong!="")	cmd.Parameters.Add("madoituong",OracleType.VarChar).Value=madoituong;
				if (ketqua!="") cmd.Parameters.Add("ketqua",OracleType.VarChar).Value=ketqua;
				if (ttlucrk!="")	cmd.Parameters.Add("ttlucrk",OracleType.VarChar).Value=ttlucrk;
				if (userid!=-1)	cmd.Parameters.Add("userid",OracleType.VarChar).Value=userid;
				//if (dotuoi!="")	cmd.Parameters.Add("m_dotuoi",OracleType.VarChar).Value=m_dotuoi;
				dest=new OracleDataAdapter(cmd);
				ds=new DataSet();
				dest.Fill(ds);
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim(),sComputer,"Rangtru");
			}
			return ds;
		}

		public DataSet get_Rangoaitru(string tu,string den,string mabn,string hoten,string ngaysinh,
			int phai,string sonha,string thon,string mann,string madantoc,string matt,string maqu, 
			string maphuongxa,string makp,string soluutru,string maicd,string madoituong,string ketqua,
			string ttlucrk,string dotuoi,bool icd,int userid,bool time)
		{	
			try
			{
				string m_dotuoi="",stime=(time)?"'dd/mm/yy hh24:mi'":"'dd/mm/yy'";
				if (time)
				{
					tu=tu+" "+sGiobaocao;
					den=den+" "+sGiobaocao;
				}
				hoten=Hoten_khongdau(hoten);
				sql="select a.mabn,a.hoten,substr(m.tuoivao,1,3)||decode(substr(m.tuoivao,4,1),0,'TU',decode(substr(m.tuoivao,4,1),1,'TH',decode(substr(m.tuoivao,4,1),2,'NG','GI'))) tuoi,";
				sql+="case when a.ngaysinh is null then a.namsinh else to_char(a.ngaysinh,'dd/mm/yy') end as namsinh,nvl(a.sonha,' ') sonha,nvl(a.thon,' ') thon,b.tenpxa,c.tenquan,d.tentt,";
				sql+="g.tennn,to_char(k.ngay,'dd/mm/yyyy hh24:mi') as ngayvk,e.tenkp,h.doituong,";
				sql+="l.chandoan,l.maicd,k.sovaovien,i.ten as ketqua,nvl(j.ten,'Nhap vien') as ttlucrk,";
				sql+=" nvl(v.sothe,' ') sothe,";//to_date(l.ngay,'dd/mm/yy')-to_date(k.ngay,'dd/mm/yy') ngaydt, ";
				sql+="to_char(l.ngay,'dd/mm/yyyy hh24:mi') as ngayrk,l.soluutru, ";
				sql+="to_date(l.ngay,'dd/mm/yy')-to_date(k.ngay,'dd/mm/yy') ngaydt,nvl(u.hoten,' ') as tenuser , l.done,l.paid  ";				
				sql+=", decode(nvl(v.traituyen,0),0,'','x') as traituyen ";
				sql+=", l.maql ";
				sql+="from btdbn a,btdpxa b,btdquan c,btdtt d,btdkp_bv e,";
				sql+="btdnn_bv g,doituong h,ketqua i,ttxk j,benhandt k,xuatvien l,lienhe m,dlogin u, bhyt v ";
				sql+="where a.mabn=l.mabn and k.maql=l.maql and a.maphuongxa=b.maphuongxa and a.maqu=c.maqu and a.matt=d.matt ";
				sql+="and k.makp=e.makp and a.mann=g.mann and k.madoituong=h.madoituong and l.userid=u.id(+) ";
				sql+="and l.ketqua=i.ma and l.ttlucrv=j.ma(+) and k.loaiba=2 and l.maql=m.maql";
				sql+=" and k.maql=v.maql(+) and (v.sudung=1 or v.sudung is null)";
				if (icd) sql+=" and l.maicd in (select ma from dmicd10)";
				if (tu!="") 
				{
					if (time)
						sql+=" and l.ngay between to_date(:tu,"+stime+") and to_date(:den,"+stime+")";
					else
						sql+=" and to_date(l.ngay,"+stime+") between to_date(:tu,"+stime+") and to_date(:den,"+stime+")";
				}
				if (mabn!="") sql+=" and a.mabn=:mabn";
				if (hoten!="") sql+=" and a.hotenkdau=:hoten";
				if (ngaysinh!="") sql+=" and to_char(a.ngaysinh,'dd/mm/yyyy')=:ngaysinh";
				if (phai!=-1) sql+=" and a.phai=:phai";
				if (sonha!="") sql+=" and lower(trim(a.sonha))=:sonha";
				if (thon!="") sql+=" and lower(trim(a.thon))=:thon";
				if (mann!="") sql+=" and a.mann=:mann";
				if (madantoc!="") sql+=" and a.madantoc=:madantoc";
				if (matt!="") sql+=" and a.matt=:matt";
				if (maqu!="")	sql+=" and a.maqu=:maqu";
				if (maphuongxa!="")	sql+=" and a.maphuongxa=:maphuongxa";
				if (makp!="") sql+=" and k.makp=:makp";
				if (soluutru!="") sql+=" and l.soluutru=:soluutru";
				if (maicd!="")	sql+=" and l.maicd=:maicd";
				if (madoituong!="")	sql+=" and k.madoituong=:madoituong";
				if (ketqua!="") sql+=" and l.ketqua=:ketqua";
				if (ttlucrk!="") sql+=" and l.ttlucrv=:ttlucrk";
				if (userid!=-1) sql+=" and l.userid=:userid";
				if (dotuoi!="")
				{
					//ThanhCuong-25052011
					if (dotuoi.IndexOf("N") != -1)
					{
						int d1 = int.Parse(dotuoi.Substring(0, dotuoi.IndexOf("-")));
						int d2 = int.Parse(dotuoi.Substring(dotuoi.IndexOf("-") + 1,dotuoi.Length-(dotuoi.IndexOf("-") + 1)-1));
						sql += " and a.ngaysinh is not null and to_date(to_char(l.ngay,'dd/mm/yyyy'),'dd/mm/yyyy')-to_date(to_char(a.ngaysinh,'dd/mm/yyyy'),'dd/mm/yyyy') between " + d1 + " and " + d2 ;//từ ngày dến ngay
					}
					else if (dotuoi.Trim() == "<1T")
					{
						sql += " and a.ngaysinh is not null and to_date(to_char(l.ngay,'dd/mm/yyyy'),'dd/mm/yyyy')-to_date(to_char(a.ngaysinh,'dd/mm/yyyy'),'dd/mm/yyyy') between 0 and 365 ";//DUOI 1 TUOI
					}
					else if (dotuoi.IndexOf(">") != -1)
					{
						sql += " and to_number(to_char(l.ngay,'yyyy'),'0000')-to_number(a.namsinh,'0000')>" + int.Parse(dotuoi.Substring(1)); 
					}
					else
					{
						int i1 = int.Parse(dotuoi.Substring(0, dotuoi.IndexOf("-")));
						int i2 = int.Parse(dotuoi.Substring(dotuoi.IndexOf("-") + 1));
						sql += " and to_number(to_char(l.ngay,'yyyy'),'0000')-to_number(a.namsinh,'0000') between " + i1 + " and " + i2; 
					}
					//
				}
				sql+=" order by l.ngay";
				con=new OracleConnection(sConn);
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				if (tu!="")
				{
					cmd.Parameters.Add("tu",OracleType.VarChar).Value=tu;
					cmd.Parameters.Add("den",OracleType.VarChar).Value=den;
				}
				if (mabn!="") cmd.Parameters.Add("mabn",OracleType.VarChar).Value=mabn;
				if (hoten!="") cmd.Parameters.Add("hoten",OracleType.NVarChar).Value=hoten;
				if (ngaysinh!="") cmd.Parameters.Add("ngaysinh",OracleType.VarChar).Value=ngaysinh;
				if (phai!=-1) cmd.Parameters.Add("phai",OracleType.Int16).Value=phai;
				if (sonha!="") cmd.Parameters.Add("sonha",OracleType.NVarChar).Value=sonha.Trim().ToLower();
				if (thon!="") cmd.Parameters.Add("thon",OracleType.NVarChar).Value=thon.Trim().ToLower();
				if (mann!="") cmd.Parameters.Add("mann",OracleType.VarChar).Value=mann;
				if (madantoc!="") cmd.Parameters.Add("madantoc",OracleType.VarChar).Value=madantoc;
				if (matt!="") cmd.Parameters.Add("matt",OracleType.VarChar).Value=matt;
				if (maqu!="") cmd.Parameters.Add("maqu",OracleType.VarChar).Value=maqu;
				if (maphuongxa!="")	cmd.Parameters.Add("maphuongxa",OracleType.VarChar).Value=maphuongxa;
				if (makp!="") cmd.Parameters.Add("makp",OracleType.VarChar).Value=makp;
				if (soluutru!="") cmd.Parameters.Add("soluutru",OracleType.VarChar).Value=soluutru;
				if (maicd!="")	cmd.Parameters.Add("maicd",OracleType.VarChar).Value=maicd;
				if (madoituong!="")	cmd.Parameters.Add("madoituong",OracleType.VarChar).Value=madoituong;
				if (ketqua!="") cmd.Parameters.Add("ketqua",OracleType.VarChar).Value=ketqua;
				if (ttlucrk!="")	cmd.Parameters.Add("ttlucrk",OracleType.VarChar).Value=ttlucrk;
				if (userid!=-1)	cmd.Parameters.Add("userid",OracleType.VarChar).Value=userid;
				//if (dotuoi!="")	cmd.Parameters.Add("m_dotuoi",OracleType.VarChar).Value=m_dotuoi;
				dest=new OracleDataAdapter(cmd);
				ds=new DataSet();
				dest.Fill(ds);
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim(),sComputer,"Rangtru");
			}
			return ds;
		}

		public DataSet get_Vaophongluu(string tu,string den,string mabn,string hoten,string ngaysinh,
			int phai,string sonha,string thon,string mann,string madantoc,string matt,string maqu, 
			string maphuongxa,string sovaovien,string maicd,string madoituong,string dentu,
			string nhantu,string dotuoi,bool icd,int userid,bool time)
		{	
			try
			{
				string m_dotuoi="",stime=(time)?"'dd/mm/yy hh24:mi'":"'dd/mm/yy'";
				if (time)
				{
					tu=tu+" "+sGiobaocao;
					den=den+" "+sGiobaocao;
				}
				hoten=Hoten_khongdau(hoten);
				sql="select a.mabn,a.hoten,substr(k.tuoivao,1,3)||decode(substr(k.tuoivao,4,1),0,'TU',decode(substr(k.tuoivao,4,1),1,'TH',decode(substr(k.tuoivao,4,1),2,'NG','GI'))) tuoi,";
				sql+="case when a.ngaysinh is null then a.namsinh else to_char(a.ngaysinh,'dd/mm/yy') end as namsinh,nvl(a.sonha,' ') sonha,nvl(a.thon,' ') thon,b.tenpxa,c.tenquan,d.tentt,";
				sql+="g.tennn,to_char(f.ngay,'dd/mm/yyyy hh24:mi') as ngay,e.tenkp,h.doituong,";
				sql+="f.chandoan,f.maicd,f.sovaovien,i.ten as nhantu,j.ten as dentu,nvl(u.hoten,' ') as tenuser ";
				sql+="from btdbn a,btdpxa b,btdquan c,btdtt d,btdkp_bv e,benhandt f,";
				sql+="btdnn_bv g,doituong h,nhantu i,dentu j,lienhe k,dlogin u ";
				sql+="where a.mabn=f.mabn and a.maphuongxa=b.maphuongxa and a.maqu=c.maqu and a.matt=d.matt ";
				sql+="and f.makp=e.makp and a.mann=g.mann and f.madoituong=h.madoituong and f.userid=u.id(+) ";
				sql+="and f.nhantu=i.ma and f.dentu=j.ma and f.loaiba=4 and f.maql=k.maql";
				if (icd) sql+=" and f.maicd in (select ma from dmicd10)";
				if (tu!="") 
				{
					if (time)
						sql+=" and f.ngay between to_date(:tu,"+stime+") and to_date(:den,"+stime+")";
					else
						sql+=" and to_date(f.ngay,"+stime+") between to_date(:tu,"+stime+") and to_date(:den,"+stime+")";
				}
				if (mabn!="") sql+=" and a.mabn=:mabn";
				if (hoten!="") sql+=" and a.hotenkdau=:hoten";
				if (ngaysinh!="") sql+=" and to_char(a.ngaysinh,'dd/mm/yyyy')=:ngaysinh";
				if (phai!=-1) sql+=" and a.phai=:phai";
				if (sonha!="") sql+=" and lower(trim(a.sonha))=:sonha";
				if (thon!="") sql+=" and lower(trim(a.thon))=:thon";
				if (mann!="") sql+=" and a.mann=:mann";
				if (madantoc!="") sql+=" and a.madantoc=:madantoc";
				if (matt!="") sql+=" and a.matt=:matt";
				if (maqu!="")	sql+=" and a.maqu=:maqu";
				if (maphuongxa!="")	sql+=" and a.maphuongxa=:maphuongxa";
				if (sovaovien!="") sql+=" and f.sovaovien=:sovaovien";
				if (maicd!="")	sql+=" and f.maicd=:maicd";
				if (madoituong!="")	sql+=" and f.madoituong=:madoituong";
				if (dentu!="") sql+=" and f.dentu=:dentu";
				if (nhantu!="")	sql+=" and f.nhantu=:nhantu";
				if (userid!=-1) sql+=" and f.userid=:userid";
				if (dotuoi!="")
				{
					//ThanhCuong-25052011
					if (dotuoi.IndexOf("N") != -1)//(dotuoi.Trim() == "<28N")
					{
						int d1 = int.Parse(dotuoi.Substring(0, dotuoi.IndexOf("-")));
						int d2 = int.Parse(dotuoi.Substring(dotuoi.IndexOf("-") + 1,dotuoi.Length-(dotuoi.IndexOf("-") + 1)-1));
						sql += " and a.ngaysinh is not null and to_date(to_char(f.ngay,'dd/mm/yyyy'),'dd/mm/yyyy')-to_date(to_char(a.ngaysinh,'dd/mm/yyyy'),'dd/mm/yyyy') between " + d1 + " and " + d2 ;//từ ngày dến ngay
					}
					else if (dotuoi.Trim() == "<1T")
					{
						sql += " and a.ngaysinh is not null and to_date(to_char(f.ngay,'dd/mm/yyyy'),'dd/mm/yyyy')-to_date(to_char(a.ngaysinh,'dd/mm/yyyy'),'dd/mm/yyyy') between 0 and 365 ";//DUOI 1 TUOI
					}
					else if (dotuoi.IndexOf(">") != -1)
					{
						sql += " and to_number(to_char(f.ngay,'yyyy'),'0000')-to_number(a.namsinh,'0000')>" + int.Parse(dotuoi.Substring(1)); 
					}
					else
					{
						int i1 = int.Parse(dotuoi.Substring(0, dotuoi.IndexOf("-")));
						int i2 = int.Parse(dotuoi.Substring(dotuoi.IndexOf("-") + 1));
						sql += " and to_number(to_char(f.ngay,'yyyy'),'0000')-to_number(a.namsinh,'0000') between " + i1 + " and " + i2; 
					}
					//
					//					if (dotuoi.IndexOf(">")!=-1)
					//					{
					//						m_dotuoi=dotuoi.Substring(1);
					//						sql+=" and to_char(f.ngay,'yyyy')-a.namsinh>"+int.Parse(m_dotuoi);//sql+=" and to_char(sysdate,'yyyy')-a.namsinh>"+int.Parse(m_dotuoi);
					//					}
					//					else 
					//					{
					//						int i1=int.Parse(dotuoi.Substring(0,dotuoi.IndexOf("-")));
					//						int i2=int.Parse(dotuoi.Substring(dotuoi.IndexOf("-")+1));
					//						sql+=" and to_char(f.ngay,'yyyy')-a.namsinh between "+i1+" and "+i2;//sql+=" and to_char(sysdate,'yyyy')-a.namsinh between "+i1+" and "+i2;
					//					}
				}
				sql+=" order by f.ngay";
				con=new OracleConnection(sConn);
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				if (tu!="")
				{
					cmd.Parameters.Add("tu",OracleType.VarChar).Value=tu;
					cmd.Parameters.Add("den",OracleType.VarChar).Value=den;
				}
				if (mabn!="") cmd.Parameters.Add("mabn",OracleType.VarChar).Value=mabn;
				if (hoten!="") cmd.Parameters.Add("hoten",OracleType.NVarChar).Value=hoten;
				if (ngaysinh!="") cmd.Parameters.Add("ngaysinh",OracleType.VarChar).Value=ngaysinh;
				if (phai!=-1) cmd.Parameters.Add("phai",OracleType.Int16).Value=phai;
				if (sonha!="") cmd.Parameters.Add("sonha",OracleType.NVarChar).Value=sonha.Trim().ToLower();
				if (thon!="") cmd.Parameters.Add("thon",OracleType.NVarChar).Value=thon.Trim().ToLower();
				if (mann!="") cmd.Parameters.Add("mann",OracleType.VarChar).Value=mann;
				if (madantoc!="") cmd.Parameters.Add("madantoc",OracleType.VarChar).Value=madantoc;
				if (matt!="") cmd.Parameters.Add("matt",OracleType.VarChar).Value=matt;
				if (maqu!="") cmd.Parameters.Add("maqu",OracleType.VarChar).Value=maqu;
				if (maphuongxa!="")	cmd.Parameters.Add("maphuongxa",OracleType.VarChar).Value=maphuongxa;
				if (sovaovien!="") cmd.Parameters.Add("sovaovien",OracleType.VarChar).Value=sovaovien;
				if (maicd!="")	cmd.Parameters.Add("maicd",OracleType.VarChar).Value=maicd;
				if (madoituong!="")	cmd.Parameters.Add("madoituong",OracleType.VarChar).Value=madoituong;
				if (dentu!="") cmd.Parameters.Add("dentu",OracleType.VarChar).Value=dentu;
				if (nhantu!="")	cmd.Parameters.Add("nhantu",OracleType.VarChar).Value=nhantu;
				if (userid!=-1)	cmd.Parameters.Add("userid",OracleType.VarChar).Value=userid;
				//if (dotuoi!="")	cmd.Parameters.Add("m_dotuoi",OracleType.VarChar).Value=m_dotuoi;
				dest=new OracleDataAdapter(cmd);
				ds=new DataSet();
				dest.Fill(ds);
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim(),sComputer,"Vaophongluu");
			}
			return ds;
		}

		public DataSet get_Raphongluu(string tu,string den,string mabn,string hoten,string ngaysinh,
			int phai,string sonha,string thon,string mann,string madantoc,string matt,string maqu, 
			string maphuongxa,string soluutru,string maicd,string madoituong,string ketqua,
			string ttlucrk,string dotuoi,bool icd,int userid,bool time)
		{	
			try
			{
				string m_dotuoi="",stime=(time)?"'dd/mm/yy hh24:mi'":"'dd/mm/yy'";
				if (time)
				{
					tu=tu+" "+sGiobaocao;
					den=den+" "+sGiobaocao;
				}
				hoten=Hoten_khongdau(hoten);
				sql="select a.mabn,a.hoten,substr(m.tuoivao,1,3)||decode(substr(m.tuoivao,4,1),0,'TU',decode(substr(m.tuoivao,4,1),1,'TH',decode(substr(m.tuoivao,4,1),2,'NG','GI'))) tuoi,";
				sql+="case when a.ngaysinh is null then a.namsinh else to_char(a.ngaysinh,'dd/mm/yy') end as namsinh,nvl(a.sonha,' ') sonha,nvl(a.thon,' ') thon,b.tenpxa,c.tenquan,d.tentt,";
				sql+="g.tennn,to_char(k.ngay,'dd/mm/yyyy hh24:mi') as ngayvk,e.tenkp,h.doituong,";
				sql+="l.chandoan,l.maicd,k.sovaovien,i.ten as ketqua,j.ten as ttlucrk,";
				sql+="to_char(l.ngay,'dd/mm/yyyy hh24:mi') as ngayrk,l.soluutru, ";
				sql+="to_date(l.ngay,'dd/mm/yy')-to_date(k.ngay,'dd/mm/yy') ngaydt,nvl(y.tenkp,' ') khoanhap,nvl(u.hoten,' ') as tenuser ";
				sql+="from btdbn a,btdpxa b,btdquan c,btdtt d,btdkp_bv e,";
				sql+="btdnn_bv g,doituong h,ketqua i,xutrikb j,benhandt k,xuatvien l,lienhe m,xutrikbct x,btdkp_bv y,dlogin u ";
				sql+="where a.mabn=l.mabn and k.maql=l.maql and a.maphuongxa=b.maphuongxa and a.maqu=c.maqu and a.matt=d.matt ";
				sql+="and k.makp=e.makp and a.mann=g.mann and k.madoituong=h.madoituong and l.userid=u.id(+) ";
				sql+="and l.ketqua=i.ma and l.ttlucrv=j.ma(+) and k.loaiba=4 and l.maql=m.maql and l.maql=x.maql(+) and x.makp=y.makp(+)";
				if (icd) sql+=" and l.maicd in (select ma from dmicd10)";
				if (tu!="") 
				{
					if (time)
						sql+=" and l.ngay between to_date(:tu,"+stime+") and to_date(:den,"+stime+")";
					else
						sql+=" and to_date(l.ngay,"+stime+") between to_date(:tu,"+stime+") and to_date(:den,"+stime+")";
				}
				if (mabn!="") sql+=" and a.mabn=:mabn";
				if (hoten!="") sql+=" and a.hotenkdau=:hoten";
				if (ngaysinh!="") sql+=" and to_char(a.ngaysinh,'dd/mm/yyyy')=:ngaysinh";
				if (phai!=-1) sql+=" and a.phai=:phai";
				if (sonha!="") sql+=" and lower(trim(a.sonha))=:sonha";
				if (thon!="") sql+=" and lower(trim(a.thon))=:thon";
				if (mann!="") sql+=" and a.mann=:mann";
				if (madantoc!="") sql+=" and a.madantoc=:madantoc";
				if (matt!="") sql+=" and a.matt=:matt";
				if (maqu!="")	sql+=" and a.maqu=:maqu";
				if (maphuongxa!="")	sql+=" and a.maphuongxa=:maphuongxa";
				if (soluutru!="") sql+=" and l.soluutru=:soluutru";
				if (maicd!="")	sql+=" and l.maicd=:maicd";
				if (madoituong!="")	sql+=" and k.madoituong=:madoituong";
				if (ketqua!="") sql+=" and l.ketqua=:ketqua";
				if (ttlucrk!="")	sql+=" and x.xutri like '%"+ttlucrk.PadLeft(2,'0')+",%'";
				if (userid!=-1) sql+=" and l.userid=:userid";
				if (dotuoi!="")
				{
					//ThanhCuong-25052011
					if (dotuoi.IndexOf("N") != -1)
					{
						int d1 = int.Parse(dotuoi.Substring(0, dotuoi.IndexOf("-")));
						int d2 = int.Parse(dotuoi.Substring(dotuoi.IndexOf("-") + 1,dotuoi.Length-(dotuoi.IndexOf("-") + 1)-1));
						sql += " and a.ngaysinh is not null and to_date(to_char(k.ngay,'dd/mm/yyyy'),'dd/mm/yyyy')-to_date(to_char(a.ngaysinh,'dd/mm/yyyy'),'dd/mm/yyyy') between " + d1 + " and " + d2 ;//từ ngày dến ngay
					}
					else if (dotuoi.Trim() == "<1T")
					{
						sql += " and a.ngaysinh is not null and to_date(to_char(k.ngay,'dd/mm/yyyy'),'dd/mm/yyyy')-to_date(to_char(a.ngaysinh,'dd/mm/yyyy'),'dd/mm/yyyy') between 0 and 365 ";//DUOI 1 TUOI
					}
					else if (dotuoi.IndexOf(">") != -1)
					{
						sql += " and to_number(to_char(k.ngay,'yyyy'),'0000')-to_number(a.namsinh,'0000')>" + int.Parse(dotuoi.Substring(1)); 
					}
					else
					{
						int i1 = int.Parse(dotuoi.Substring(0, dotuoi.IndexOf("-")));
						int i2 = int.Parse(dotuoi.Substring(dotuoi.IndexOf("-") + 1));
						sql += " and to_number(to_char(k.ngay,'yyyy'),'0000')-to_number(a.namsinh,'0000') between " + i1 + " and " + i2; 
					}
					//
					//					if (dotuoi.IndexOf(">")!=-1)
					//					{
					//						m_dotuoi=dotuoi.Substring(1);
					//						sql+=" and to_char(k.ngay,'yyyy')-a.namsinh>"+int.Parse(m_dotuoi);//sql+=" and to_char(sysdate,'yyyy')-a.namsinh>"+int.Parse(m_dotuoi);
					//					}
					//					else 
					//					{
					//						int i1=int.Parse(dotuoi.Substring(0,dotuoi.IndexOf("-")));
					//						int i2=int.Parse(dotuoi.Substring(dotuoi.IndexOf("-")+1));
					//						sql+=" and to_char(k.ngay,'yyyy')-a.namsinh between "+i1+" and "+i2;//sql+=" and to_char(sysdate,'yyyy')-a.namsinh between "+i1+" and "+i2;
					//					}
				}
				sql+=" order by l.ngay";
				con=new OracleConnection(sConn);
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				if (tu!="")
				{
					cmd.Parameters.Add("tu",OracleType.VarChar).Value=tu;
					cmd.Parameters.Add("den",OracleType.VarChar).Value=den;
				}
				if (mabn!="") cmd.Parameters.Add("mabn",OracleType.VarChar).Value=mabn;
				if (hoten!="") cmd.Parameters.Add("hoten",OracleType.NVarChar).Value=hoten;
				if (ngaysinh!="") cmd.Parameters.Add("ngaysinh",OracleType.VarChar).Value=ngaysinh;
				if (phai!=-1) cmd.Parameters.Add("phai",OracleType.Int16).Value=phai;
				if (sonha!="") cmd.Parameters.Add("sonha",OracleType.NVarChar).Value=sonha.Trim().ToLower();
				if (thon!="") cmd.Parameters.Add("thon",OracleType.NVarChar).Value=thon.Trim().ToLower();
				if (mann!="") cmd.Parameters.Add("mann",OracleType.VarChar).Value=mann;
				if (madantoc!="") cmd.Parameters.Add("madantoc",OracleType.VarChar).Value=madantoc;
				if (matt!="") cmd.Parameters.Add("matt",OracleType.VarChar).Value=matt;
				if (maqu!="") cmd.Parameters.Add("maqu",OracleType.VarChar).Value=maqu;
				if (maphuongxa!="")	cmd.Parameters.Add("maphuongxa",OracleType.VarChar).Value=maphuongxa;
				if (soluutru!="") cmd.Parameters.Add("soluutru",OracleType.VarChar).Value=soluutru;
				if (maicd!="")	cmd.Parameters.Add("maicd",OracleType.VarChar).Value=maicd;
				if (madoituong!="")	cmd.Parameters.Add("madoituong",OracleType.VarChar).Value=madoituong;
				if (ketqua!="") cmd.Parameters.Add("ketqua",OracleType.VarChar).Value=ketqua;
				//if (ttlucrk!="")	cmd.Parameters.Add("ttlucrk",OracleType.VarChar).Value=ttlucrk;
				if (userid!=-1)	cmd.Parameters.Add("userid",OracleType.VarChar).Value=userid;
				//if (dotuoi!="")	cmd.Parameters.Add("m_dotuoi",OracleType.VarChar).Value=m_dotuoi;
				dest=new OracleDataAdapter(cmd);
				ds=new DataSet();
				dest.Fill(ds);
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim(),sComputer,"Raphongluu");
			}
			return ds;
		}
		public DataSet get_Vaovien_bhyt(string tu,string den,string mabn,string hoten,string ngaysinh,
			int phai,string sonha,string thon,string mann,string madantoc,string matt,string maqu, 
			string maphuongxa,string makp,string sovaovien,string maicd,string madoituong,string dentu,
			string nhantu,string dotuoi,bool icd,string soluutru,int userid,bool time)
		{	
			try
			{
				string m_dotuoi="",stime=(time)?"'dd/mm/yy hh24:mi'":"'dd/mm/yy'";
				if (time)
				{
					tu=tu+" "+sGiobaocao;
					den=den+" "+sGiobaocao;
				}
				hoten=Hoten_khongdau(hoten);
				sql="select a.mabn,a.hoten,substr(k.tuoivao,1,3)||decode(substr(k.tuoivao,4,1),0,'TU',decode(substr(k.tuoivao,4,1),1,'TH',decode(substr(k.tuoivao,4,1),2,'NG','GI'))) tuoi,";
				sql+="case when a.ngaysinh is null then a.namsinh else to_char(a.ngaysinh,'dd/mm/yy') end as namsinh,nvl(a.sonha,' ') sonha,nvl(a.thon,' ') thon,b.tenpxa,c.tenquan,d.tentt,";
				sql+="g.tennn,to_char(f.ngay,'dd/mm/yyyy hh24:mi') as ngay,e.tenkp,h.doituong,";
				sql+="f.chandoan,f.maicd,f.sovaovien,i.ten as nhantu,j.ten as dentu, k.soluutru,nvl(u.hoten,' ') as tenuser ";
				sql+=",a.phai,d.sothe,to_char(d.tungay,'dd/mm/yyyy') tungay,to_char(d.denngay,'dd/mm/yyyy') denngay,l.tenbv KCB,to_char(nvl(d.ngaytrinh,f.ngay),'dd/mm/yyyy') ngaygiuthe ";
				sql+="from benhandt f,btdbn a,btdpxa b,btdquan c,btdtt d,btdkp_bv e,";
				sql+="btdnn_bv g,doituong h,nhantu i,dentu j,lienhe k,dlogin u,bhyt d,dmnoicapbhyt l ";
				sql+="where a.mabn=f.mabn and a.maphuongxa=b.maphuongxa and a.maqu=c.maqu and a.matt=d.matt ";
				sql+="and f.makp=e.makp and a.mann=g.mann and f.madoituong=h.madoituong and f.userid=u.id(+) ";
				sql+="and f.nhantu=i.ma and f.dentu=j.ma and f.loaiba=1 and f.maql=k.maql ";
				sql+="and f.maql=d.maql and f.mabn=d.mabn and d.mabv=l.mabv(+)";
				if (icd) sql+=" and f.maicd in (select ma from dmicd10)";
				if (tu!="") 
				{
					if (time)
						sql+=" and f.ngay between to_date(:tu,"+stime+") and to_date(:den,"+stime+")";
					else
						sql+=" and to_date(f.ngay,"+stime+") between to_date(:tu,"+stime+") and to_date(:den,"+stime+")";
				}
				if (mabn!="") sql+=" and a.mabn=:mabn";
				if (hoten!="") sql+=" and a.hotenkdau=:hoten";
				if (ngaysinh!="") sql+=" and to_char(a.ngaysinh,'dd/mm/yyyy')=:ngaysinh";
				if (phai!=-1) sql+=" and a.phai=:phai";
				if (sonha!="") sql+=" and lower(trim(a.sonha))=:sonha";
				if (thon!="") sql+=" and lower(trim(a.thon))=:thon";
				if (mann!="") sql+=" and a.mann=:mann";
				if (madantoc!="") sql+=" and a.madantoc=:madantoc";
				if (matt!="") sql+=" and a.matt=:matt";
				if (maqu!="")	sql+=" and a.maqu=:maqu";
				if (maphuongxa!="")	sql+=" and a.maphuongxa=:maphuongxa";
				if (makp!="") sql+=" and f.makp=:makp";
				if (sovaovien!="") sql+=" and f.sovaovien=:sovaovien";
				if (maicd!="")	sql+=" and f.maicd=:maicd";
				if (madoituong!="")	sql+=" and f.madoituong=:madoituong";
				if (dentu!="") sql+=" and f.dentu=:dentu";
				if (nhantu!="")	sql+=" and f.nhantu=:nhantu";
				if (soluutru=="*") sql+=" and k.soluutru is not null";
				else if (soluutru!="") sql+=" and k.soluutru=:soluutru";
				if (userid!=-1) sql+=" and f.userid=:userid";
				if (dotuoi!="")
				{
					//ThanhCuong-25052011
					if (dotuoi.IndexOf("N") != -1)
					{
						int d1 = int.Parse(dotuoi.Substring(0, dotuoi.IndexOf("-")));
						int d2 = int.Parse(dotuoi.Substring(dotuoi.IndexOf("-") + 1,dotuoi.Length-(dotuoi.IndexOf("-") + 1)-1));
						sql += " and a.ngaysinh is not null and to_date(to_char(f.ngay,'dd/mm/yyyy'),'dd/mm/yyyy')-to_date(to_char(a.ngaysinh,'dd/mm/yyyy'),'dd/mm/yyyy') between " + d1 + " and " + d2 ;//từ ngày dến ngay
					}
					else if (dotuoi.Trim() == "<1T")
					{
						sql += " and a.ngaysinh is not null and to_date(to_char(f.ngay,'dd/mm/yyyy'),'dd/mm/yyyy')-to_date(to_char(a.ngaysinh,'dd/mm/yyyy'),'dd/mm/yyyy') between 0 and 365 ";//DUOI 1 TUOI
					}
					else if (dotuoi.IndexOf(">") != -1)
					{
						sql += " and to_number(to_char(f.ngay,'yyyy'),'0000')-to_number(a.namsinh,'0000')>" + int.Parse(dotuoi.Substring(1)); 
					}
					else
					{
						int i1 = int.Parse(dotuoi.Substring(0, dotuoi.IndexOf("-")));
						int i2 = int.Parse(dotuoi.Substring(dotuoi.IndexOf("-") + 1));
						sql += " and to_number(to_char(f.ngay,'yyyy'),'0000')-to_number(a.namsinh,'0000') between " + i1 + " and " + i2; 
					}
					//
					//					if (dotuoi.IndexOf(">")!=-1)
					//					{
					//						m_dotuoi=dotuoi.Substring(1);
					//						sql+=" and to_char(f.ngay,'yyyy')-a.namsinh>"+int.Parse(m_dotuoi);//sql+=" and to_char(sysdate,'yyyy')-a.namsinh>"+int.Parse(m_dotuoi);
					//					}
					//					else 
					//					{
					//						int i1=int.Parse(dotuoi.Substring(0,dotuoi.IndexOf("-")));
					//						int i2=int.Parse(dotuoi.Substring(dotuoi.IndexOf("-")+1));
					//						sql+=" and to_char(f.ngay,'yyyy')-a.namsinh between "+i1+" and "+i2;//sql+=" and to_char(sysdate,'yyyy')-a.namsinh between "+i1+" and "+i2;
					//					}
				}
				sql+=" order by f.ngay";
				con=new OracleConnection(sConn);
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				if (tu!="")
				{
					cmd.Parameters.Add("tu",OracleType.VarChar).Value=tu;
					cmd.Parameters.Add("den",OracleType.VarChar).Value=den;
				}
				if (mabn!="") cmd.Parameters.Add("mabn",OracleType.VarChar).Value=mabn;
				if (hoten!="") cmd.Parameters.Add("hoten",OracleType.NVarChar).Value=hoten;
				if (ngaysinh!="") cmd.Parameters.Add("ngaysinh",OracleType.VarChar).Value=ngaysinh;
				if (phai!=-1) cmd.Parameters.Add("phai",OracleType.Int16).Value=phai;
				if (sonha!="") cmd.Parameters.Add("sonha",OracleType.NVarChar).Value=sonha.Trim().ToLower();
				if (thon!="") cmd.Parameters.Add("thon",OracleType.NVarChar).Value=thon.Trim().ToLower();
				if (mann!="") cmd.Parameters.Add("mann",OracleType.VarChar).Value=mann;
				if (madantoc!="") cmd.Parameters.Add("madantoc",OracleType.VarChar).Value=madantoc;
				if (matt!="") cmd.Parameters.Add("matt",OracleType.VarChar).Value=matt;
				if (maqu!="") cmd.Parameters.Add("maqu",OracleType.VarChar).Value=maqu;
				if (maphuongxa!="")	cmd.Parameters.Add("maphuongxa",OracleType.VarChar).Value=maphuongxa;
				if (makp!="") cmd.Parameters.Add("makp",OracleType.VarChar).Value=makp;
				if (sovaovien!="") cmd.Parameters.Add("sovaovien",OracleType.VarChar).Value=sovaovien;
				if (maicd!="")	cmd.Parameters.Add("maicd",OracleType.VarChar).Value=maicd;
				if (madoituong!="")	cmd.Parameters.Add("madoituong",OracleType.VarChar).Value=madoituong;
				if (dentu!="") cmd.Parameters.Add("dentu",OracleType.VarChar).Value=dentu;
				if (nhantu!="")	cmd.Parameters.Add("nhantu",OracleType.VarChar).Value=nhantu;
				if (soluutru!="" && soluutru!="*")	cmd.Parameters.Add("soluutru",OracleType.VarChar).Value=soluutru;
				if (userid!=-1)	cmd.Parameters.Add("userid",OracleType.VarChar).Value=userid;
				//if (dotuoi!="")	cmd.Parameters.Add("m_dotuoi",OracleType.VarChar).Value=m_dotuoi;
				dest=new OracleDataAdapter(cmd);
				ds=new DataSet();
				dest.Fill(ds);
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim(),sComputer,"Vaovien");
			}
			return ds;
		}


		public DataSet get_Vaovien(string tu,string den,string mabn,string hoten,string ngaysinh,
			int phai,string sonha,string thon,string mann,string madantoc,string matt,string maqu, 
			string maphuongxa,string makp,string sovaovien,string maicd,string madoituong,string dentu,
			string nhantu,string dotuoi,bool icd,string soluutru,int userid,bool time)
		{	
			try
			{
				string m_dotuoi="",stime=(time)?"'dd/mm/yy hh24:mi'":"'dd/mm/yy'";
				if (time)
				{
					tu=tu+" "+sGiobaocao;
					den=den+" "+sGiobaocao;
				}
				hoten=Hoten_khongdau(hoten);
				sql="select a.mabn,a.hoten,substr(k.tuoivao,1,3)||decode(substr(k.tuoivao,4,1),0,'TU',decode(substr(k.tuoivao,4,1),1,'TH',decode(substr(k.tuoivao,4,1),2,'NG','GI'))) tuoi,";
				sql+="case when a.ngaysinh is null then a.namsinh else to_char(a.ngaysinh,'dd/mm/yy') end as namsinh,nvl(a.sonha,' ') sonha,nvl(a.thon,' ') thon,b.tenpxa,c.tenquan,d.tentt,";
				sql+="g.tennn,to_char(f.ngay,'dd/mm/yyyy hh24:mi') as ngay,e.tenkp,h.doituong,";
				sql+="f.chandoan,f.maicd,f.sovaovien,i.ten as nhantu,j.ten as dentu, k.soluutru,nvl(u.hoten,' ') as tenuser ";
				sql+="from benhandt f,btdbn a,btdpxa b,btdquan c,btdtt d,btdkp_bv e,";
				sql+="btdnn_bv g,doituong h,nhantu i,dentu j,lienhe k,dlogin u ";
				sql+="where a.mabn=f.mabn and a.maphuongxa=b.maphuongxa and a.maqu=c.maqu and a.matt=d.matt ";
				sql+="and f.makp=e.makp and a.mann=g.mann and f.madoituong=h.madoituong and f.userid=u.id(+) ";
				sql+="and f.nhantu=i.ma and f.dentu=j.ma and f.loaiba=1 and f.maql=k.maql";
				if (icd) sql+=" and f.maicd in (select ma from dmicd10)";
				if (tu!="") 
				{
					if (time)
						sql+=" and f.ngay between to_date(:tu,"+stime+") and to_date(:den,"+stime+")";
					else
						sql+=" and to_date(f.ngay,"+stime+") between to_date(:tu,"+stime+") and to_date(:den,"+stime+")";
				}
				if (mabn!="") sql+=" and a.mabn=:mabn";
				if (hoten!="") sql+=" and a.hotenkdau=:hoten";
				if (ngaysinh!="") sql+=" and to_char(a.ngaysinh,'dd/mm/yyyy')=:ngaysinh";
				if (phai!=-1) sql+=" and a.phai=:phai";
				if (sonha!="") sql+=" and lower(trim(a.sonha))=:sonha";
				if (thon!="") sql+=" and lower(trim(a.thon))=:thon";
				if (mann!="") sql+=" and a.mann=:mann";
				if (madantoc!="") sql+=" and a.madantoc=:madantoc";
				if (matt!="") sql+=" and a.matt=:matt";
				if (maqu!="")	sql+=" and a.maqu=:maqu";
				if (maphuongxa!="")	sql+=" and a.maphuongxa=:maphuongxa";
				if (makp!="") sql+=" and f.makp=:makp";
				if (sovaovien!="") sql+=" and f.sovaovien=:sovaovien";
				if (maicd!="")	sql+=" and f.maicd=:maicd";
				if (madoituong!="")	sql+=" and f.madoituong=:madoituong";
				if (dentu!="") sql+=" and f.dentu=:dentu";
				if (nhantu!="")	sql+=" and f.nhantu=:nhantu";
				if (soluutru=="*") sql+=" and k.soluutru is not null";
				else if (soluutru!="") sql+=" and k.soluutru=:soluutru";
				if (userid!=-1) sql+=" and f.userid=:userid";
				if (dotuoi!="")
				{
					//ThanhCuong-25052011
					if (dotuoi.IndexOf("N") != -1)
					{
						int d1 = int.Parse(dotuoi.Substring(0, dotuoi.IndexOf("-")));
						int d2 = int.Parse(dotuoi.Substring(dotuoi.IndexOf("-") + 1,dotuoi.Length-(dotuoi.IndexOf("-") + 1)-1));
						sql += " and a.ngaysinh is not null and to_date(to_char(f.ngay,'dd/mm/yyyy'),'dd/mm/yyyy')-to_date(to_char(a.ngaysinh,'dd/mm/yyyy'),'dd/mm/yyyy') between " + d1 + " and " + d2 ;//từ ngày dến ngay
					}
					else if (dotuoi.Trim() == "<1T")
					{
						sql += " and a.ngaysinh is not null and to_date(to_char(f.ngay,'dd/mm/yyyy'),'dd/mm/yyyy')-to_date(to_char(a.ngaysinh,'dd/mm/yyyy'),'dd/mm/yyyy') between 0 and 365 ";//DUOI 1 TUOI
					}
					else if (dotuoi.IndexOf(">") != -1)
					{
						sql += " and to_number(to_char(f.ngay,'yyyy'),'0000')-to_number(a.namsinh,'0000')>" + int.Parse(dotuoi.Substring(1)); 
					}
					else
					{
						int i1 = int.Parse(dotuoi.Substring(0, dotuoi.IndexOf("-")));
						int i2 = int.Parse(dotuoi.Substring(dotuoi.IndexOf("-") + 1));
						sql += " and to_number(to_char(f.ngay,'yyyy'),'0000')-to_number(a.namsinh,'0000') between " + i1 + " and " + i2; 
					}
					//
					//					if (dotuoi.IndexOf(">")!=-1)
					//					{
					//						m_dotuoi=dotuoi.Substring(1);
					//						sql+=" and to_char(f.ngay,'yyyy')-a.namsinh>"+int.Parse(m_dotuoi);//sql+=" and to_char(sysdate,'yyyy')-a.namsinh>"+int.Parse(m_dotuoi);
					//					}
					//					else 
					//					{
					//						int i1=int.Parse(dotuoi.Substring(0,dotuoi.IndexOf("-")));
					//						int i2=int.Parse(dotuoi.Substring(dotuoi.IndexOf("-")+1));
					//						sql+=" and to_char(f.ngay,'yyyy')-a.namsinh between "+i1+" and "+i2;//sql+=" and to_char(sysdate,'yyyy')-a.namsinh between "+i1+" and "+i2;
					//					}
				}
				sql+=" order by f.ngay";
				con=new OracleConnection(sConn);
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				if (tu!="")
				{
					cmd.Parameters.Add("tu",OracleType.VarChar).Value=tu;
					cmd.Parameters.Add("den",OracleType.VarChar).Value=den;
				}
				if (mabn!="") cmd.Parameters.Add("mabn",OracleType.VarChar).Value=mabn;
				if (hoten!="") cmd.Parameters.Add("hoten",OracleType.NVarChar).Value=hoten;
				if (ngaysinh!="") cmd.Parameters.Add("ngaysinh",OracleType.VarChar).Value=ngaysinh;
				if (phai!=-1) cmd.Parameters.Add("phai",OracleType.Int16).Value=phai;
				if (sonha!="") cmd.Parameters.Add("sonha",OracleType.NVarChar).Value=sonha.Trim().ToLower();
				if (thon!="") cmd.Parameters.Add("thon",OracleType.NVarChar).Value=thon.Trim().ToLower();
				if (mann!="") cmd.Parameters.Add("mann",OracleType.VarChar).Value=mann;
				if (madantoc!="") cmd.Parameters.Add("madantoc",OracleType.VarChar).Value=madantoc;
				if (matt!="") cmd.Parameters.Add("matt",OracleType.VarChar).Value=matt;
				if (maqu!="") cmd.Parameters.Add("maqu",OracleType.VarChar).Value=maqu;
				if (maphuongxa!="")	cmd.Parameters.Add("maphuongxa",OracleType.VarChar).Value=maphuongxa;
				if (makp!="") cmd.Parameters.Add("makp",OracleType.VarChar).Value=makp;
				if (sovaovien!="") cmd.Parameters.Add("sovaovien",OracleType.VarChar).Value=sovaovien;
				if (maicd!="")	cmd.Parameters.Add("maicd",OracleType.VarChar).Value=maicd;
				if (madoituong!="")	cmd.Parameters.Add("madoituong",OracleType.VarChar).Value=madoituong;
				if (dentu!="") cmd.Parameters.Add("dentu",OracleType.VarChar).Value=dentu;
				if (nhantu!="")	cmd.Parameters.Add("nhantu",OracleType.VarChar).Value=nhantu;
				if (soluutru!="" && soluutru!="*")	cmd.Parameters.Add("soluutru",OracleType.VarChar).Value=soluutru;
				if (userid!=-1)	cmd.Parameters.Add("userid",OracleType.VarChar).Value=userid;
				//if (dotuoi!="")	cmd.Parameters.Add("m_dotuoi",OracleType.VarChar).Value=m_dotuoi;
				dest=new OracleDataAdapter(cmd);
				ds=new DataSet();
				dest.Fill(ds);
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim(),sComputer,"Vaovien");
			}
			return ds;
		}

		public DataSet get_Vaokhoa(string tu,string den,string mabn,string hoten,string ngaysinh,
			int phai,string sonha,string thon,string mann,string madantoc,string matt,string maqu, 
			string maphuongxa,string makp,string noichuyen,string sovaovien,string maicd,string madoituong,string dentu,
			string nhantu,string dotuoi,bool icd,int userid,bool time)
		{	
			try
			{
				string m_dotuoi="",stime=(time)?"'dd/mm/yy hh24:mi'":"'dd/mm/yy'";
				if (time)
				{
					tu=tu+" "+sGiobaocao;
					den=den+" "+sGiobaocao;
				}
				hoten=Hoten_khongdau(hoten);
				sql="select a.mabn,a.hoten,substr(f.tuoivao,1,3)||decode(substr(f.tuoivao,4,1),'0','TU',decode(substr(f.tuoivao,4,1),'1','TH',decode(substr(f.tuoivao,4,1),'2','NG','GI'))) as tuoi,";
				sql+="case when a.ngaysinh is null then a.namsinh else to_char(a.ngaysinh,'dd/mm/yy') end as namsinh,nvl(a.sonha,' ') sonha,nvl(a.thon,' ') thon,b.tenpxa,c.tenquan,d.tentt,";
				sql+="g.tennn,to_char(f.ngay,'dd/mm/yyyy hh24:mi') as ngay,e.tenkp,h.doituong,";
				sql+="f.chandoan,f.maicd,k.sovaovien,i.ten as nhantu,j.ten as dentu,f.giuong,l.tenkp as noichuyen,nvl(u.hoten,' ') as tenuser ";
				sql+="from nhapkhoa f,btdbn a,btdpxa b,btdquan c,btdtt d,btdkp_bv e,";
				sql+="btdnn_bv g,doituong h,nhantu i,dentu j,benhandt k,btdkp_bv l,dlogin u ";
				sql+="where a.mabn=f.mabn and f.maql=k.maql and a.maphuongxa=b.maphuongxa and a.maqu=c.maqu and a.matt=d.matt ";
				sql+="and f.makp=e.makp and a.mann=g.mann and k.madoituong=h.madoituong and f.userid=u.id(+) ";
				sql+="and k.nhantu=i.ma and k.dentu=j.ma and f.khoachuyen=l.makp and k.loaiba=1";
				if (icd) sql+=" and f.maicd in (select ma from dmicd10)";
				if (tu!="") 
				{
					if (time)
						sql+=" and f.ngay between to_date(:tu,"+stime+") and to_date(:den,"+stime+")";
					else
						sql+=" and to_date(f.ngay,"+stime+") between to_date(:tu,"+stime+") and to_date(:den,"+stime+")";
				}
				if (mabn!="") sql+=" and a.mabn=:mabn";
				if (hoten!="") sql+=" and a.hotenkdau=:hoten";
				if (ngaysinh!="") sql+=" and to_char(a.ngaysinh,'dd/mm/yyyy')=:ngaysinh";
				if (phai!=-1) sql+=" and a.phai=:phai";
				if (sonha!="") sql+=" and lower(trim(a.sonha))=:sonha";
				if (thon!="") sql+=" and lower(trim(a.thon))=:thon";
				if (mann!="") sql+=" and a.mann=:mann";
				if (madantoc!="") sql+=" and a.madantoc=:madantoc";
				if (matt!="") sql+=" and a.matt=:matt";
				if (maqu!="")	sql+=" and a.maqu=:maqu";
				if (maphuongxa!="")	sql+=" and a.maphuongxa=:maphuongxa";
				if (makp!="") sql+=" and f.makp=:makp";
				if (noichuyen!="") sql+=" and f.khoachuyen=:noichuyen";
				if (sovaovien!="") sql+=" and k.sovaovien=:sovaovien";
				if (maicd!="")	sql+=" and f.maicd=:maicd";
				if (madoituong!="")	sql+=" and k.madoituong=:madoituong";
				if (dentu!="") sql+=" and k.dentu=:dentu";
				if (nhantu!="")	sql+=" and k.nhantu=:nhantu";
				if (userid!=-1) sql+=" and f.userid=:userid";
				if (dotuoi!="")
				{
					//ThanhCuong-25052011
					if (dotuoi.IndexOf("N") != -1)//(dotuoi.Trim() == "<28N")
					{
						int d1 = int.Parse(dotuoi.Substring(0, dotuoi.IndexOf("-")));
						int d2 = int.Parse(dotuoi.Substring(dotuoi.IndexOf("-") + 1,dotuoi.Length-(dotuoi.IndexOf("-") + 1)-1));
						sql += " and a.ngaysinh is not null and to_date(to_char(f.ngay,'dd/mm/yyyy'),'dd/mm/yyyy')-to_date(to_char(a.ngaysinh,'dd/mm/yyyy'),'dd/mm/yyyy') between " + d1 + " and " + d2 ;//từ ngày dến ngay
					}
					else if (dotuoi.Trim() == "<1T")
					{
						sql += " and a.ngaysinh is not null and to_date(to_char(f.ngay,'dd/mm/yyyy'),'dd/mm/yyyy')-to_date(to_char(a.ngaysinh,'dd/mm/yyyy'),'dd/mm/yyyy') between 0 and 365 ";//DUOI 1 TUOI
					}
					else if (dotuoi.IndexOf(">") != -1)
					{
						sql += " and to_number(to_char(f.ngay,'yyyy'),'0000')-to_number(a.namsinh,'0000')>" + int.Parse(dotuoi.Substring(1)); 
					}
					else
					{
						int i1 = int.Parse(dotuoi.Substring(0, dotuoi.IndexOf("-")));
						int i2 = int.Parse(dotuoi.Substring(dotuoi.IndexOf("-") + 1));
						sql += " and to_number(to_char(f.ngay,'yyyy'),'0000')-to_number(a.namsinh,'0000') between " + i1 + " and " + i2; 
					}
					//
					//					if (dotuoi.IndexOf(">")!=-1)
					//					{
					//						m_dotuoi=dotuoi.Substring(1);
					//						sql+=" and to_char(f.ngay,'yyyy')-a.namsinh>"+int.Parse(m_dotuoi);//sql+=" and to_char(sysdate,'yyyy')-a.namsinh>"+int.Parse(m_dotuoi);
					//					}
					//					else 
					//					{
					//						int i1=int.Parse(dotuoi.Substring(0,dotuoi.IndexOf("-")));
					//						int i2=int.Parse(dotuoi.Substring(dotuoi.IndexOf("-")+1));
					//						sql+=" and to_char(f.ngay,'yyyy')-a.namsinh between "+i1+" and "+i2;//sql+=" and to_char(sysdate,'yyyy')-a.namsinh between "+i1+" and "+i2;
					//					}
				}
				sql+=" order by f.ngay";
				con=new OracleConnection(sConn);
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				if (tu!="")
				{
					cmd.Parameters.Add("tu",OracleType.VarChar).Value=tu;
					cmd.Parameters.Add("den",OracleType.VarChar).Value=den;
				}
				if (mabn!="") cmd.Parameters.Add("mabn",OracleType.VarChar).Value=mabn;
				if (hoten!="") cmd.Parameters.Add("hoten",OracleType.NVarChar).Value=hoten;
				if (ngaysinh!="") cmd.Parameters.Add("ngaysinh",OracleType.VarChar).Value=ngaysinh;
				if (phai!=-1) cmd.Parameters.Add("phai",OracleType.Int16).Value=phai;
				if (sonha!="") cmd.Parameters.Add("sonha",OracleType.NVarChar).Value=sonha.Trim().ToLower();
				if (thon!="") cmd.Parameters.Add("thon",OracleType.NVarChar).Value=thon.Trim().ToLower();
				if (mann!="") cmd.Parameters.Add("mann",OracleType.VarChar).Value=mann;
				if (madantoc!="") cmd.Parameters.Add("madantoc",OracleType.VarChar).Value=madantoc;
				if (matt!="") cmd.Parameters.Add("matt",OracleType.VarChar).Value=matt;
				if (maqu!="") cmd.Parameters.Add("maqu",OracleType.VarChar).Value=maqu;
				if (maphuongxa!="")	cmd.Parameters.Add("maphuongxa",OracleType.VarChar).Value=maphuongxa;
				if (makp!="") cmd.Parameters.Add("makp",OracleType.VarChar).Value=makp;
				if (noichuyen!="") cmd.Parameters.Add("noichuyen",OracleType.VarChar).Value=noichuyen;
				if (sovaovien!="") cmd.Parameters.Add("sovaovien",OracleType.VarChar).Value=sovaovien;
				if (maicd!="")	cmd.Parameters.Add("maicd",OracleType.VarChar).Value=maicd;
				if (madoituong!="")	cmd.Parameters.Add("madoituong",OracleType.VarChar).Value=madoituong;
				if (dentu!="") cmd.Parameters.Add("dentu",OracleType.VarChar).Value=dentu;
				if (nhantu!="")	cmd.Parameters.Add("nhantu",OracleType.VarChar).Value=nhantu;
				if (userid!=-1)	cmd.Parameters.Add("userid",OracleType.VarChar).Value=userid;
				//if (dotuoi!="")	cmd.Parameters.Add("m_dotuoi",OracleType.VarChar).Value=m_dotuoi;
				dest=new OracleDataAdapter(cmd);
				ds=new DataSet();
				dest.Fill(ds);
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim(),sComputer,"Vaokhoa");
			}
			return ds;
		}

		public DataSet get_Rakhoa(string tu,string den,string mabn,string hoten,string ngaysinh,
			int phai,string sonha,string thon,string mann,string madantoc,string matt,string maqu, 
			string maphuongxa,string makp,string sovaovien,string maicd,string madoituong,string ketqua,
			string ttlucrk,string dotuoi,bool icd,string maicdnn,bool icdnn,string mapttt,bool pttt,int userid,bool time)
		{	
			try
			{
				int iadd=iNgaydieutri_ngayra_ngayvao_1;//
				string m_dotuoi="",stime=(time)?"'dd/mm/yy hh24:mi'":"'dd/mm/yy'";
				if (time)
				{
					tu=tu+" "+sGiobaocao;
					den=den+" "+sGiobaocao;
				}
				execute_data("delete from t_pttt");
				execute_data("delete from t_cdnguyennhan");
				if (pttt || mapttt!="")
				{
					execute_data("delete from t_pttt");
					sql="insert into t_pttt select distinct c.maql,c.mapt,c.tenpt from nhapkhoa a,xuatkhoa b,pttt c where a.id=b.id and a.maql=c.maql";
					if (tu!="")
					{
						if (time) sql+=" and b.ngay between to_date('"+tu+"',"+stime+") and to_date('"+den+"',"+stime+")";
						else sql+=" and to_date(b.ngay,"+stime+") between to_date('"+tu+"',"+stime+") and to_date('"+den+"',"+stime+")";
					}
					if (mapttt!="") sql+=" and c.mapt='"+mapttt+"'";
					if (pttt) sql+=" and c.mapt in (select ma from bctheopttt)";
					execute_data(sql);
				}
				if (icdnn || maicdnn!="")
				{
					execute_data("delete from t_cdnguyennhan");
					sql="insert into t_cdnguyennhan select distinct c.maql,c.maicd,c.chandoan from benhandt a,xuatvien b,cdnguyennhan c where a.maql=b.maql and a.maql=c.maql";
					if (tu!="")
					{
						if (time) sql+=" and b.ngay between to_date('"+tu+"',"+stime+") and to_date('"+den+"',"+stime+")";
						else sql+=" and to_date(b.ngay,"+stime+") between to_date('"+tu+"',"+stime+") and to_date('"+den+"',"+stime+")";
					}
					if (maicdnn!="") sql+=" and c.maicd='"+maicdnn+"'";
					if (icdnn) sql+=" and c.maicd in (select ma from bctheoicd)";
					execute_data(sql);
				}
				hoten=Hoten_khongdau(hoten);
				sql="select rownum as stt,l.id,a.mabn,a.hoten,substr(f.tuoivao,1,3)||decode(substr(f.tuoivao,4,1),'0','TU',decode(substr(f.tuoivao,4,1),'1','TH',decode(substr(f.tuoivao,4,1),'2','NG','GI'))) as tuoi,";
				sql+="case when a.ngaysinh is null then a.namsinh else to_char(a.ngaysinh,'dd/mm/yy') end as namsinh,nvl(a.sonha,' ') sonha,nvl(a.thon,' ') thon,b.tenpxa,c.tenquan,d.tentt,";
				sql+="g.tennn,to_char(f.ngay,'dd/mm/yyyy hh24:mi') as ngayvk,e.tenkp,h.doituong,";
				sql+="l.chandoan,l.maicd,k.sovaovien,i.ten as ketqua,j.ten as ttlucrk,f.giuong,";
				sql+="to_char(l.ngay,'dd/mm/yyyy hh24:mi') as ngayrk,nvl(m.sothe,' ') sothe,";
				//sql+="to_date(l.ngay,'dd/mm/yy')-to_date(f.ngay,'dd/mm/yy')+decode(f.khoachuyen,'01',1,0) ngaydt, "; 				
				if (tu!="") 
				{
					sql+="to_date(l.ngay,'dd/mm/yy')-to_date(f.ngay,'dd/mm/yy')+decode(f.khoachuyen,'01',"+iadd+",0) as ngaydt,";
					sql+="trim(to_char(case when to_date('"+den.Substring(0,10)+"','dd/mm/yy')>to_date(l.ngay,'dd/mm/yy') then to_date(l.ngay,'dd/mm/yy') else to_date('"+den.Substring(0,10)+"','dd/mm/yy') end-case when to_date('"+tu.Substring(0,10)+"','dd/mm/yy')>to_date(f.ngay,'dd/mm/yy') then to_date('"+tu.Substring(0,10)+"','dd/mm/yy') else to_date(f.ngay,'dd/mm/yy') end+decode(f.khoachuyen,'01',1,0),'999999999')) as ngaytk,";
					//sql+="trim(to_char(case when to_date('"+den.Substring(0,10)+"','dd/mm/yy')>to_date(l.ngay,'dd/mm/yy') then l.ngay else to_date('"+den.Substring(0,10)+" 00:00','dd/mm/yyyy hh24:mi') end-case when to_date('"+tu.Substring(0,10)+"','dd/mm/yy')>to_date(f.ngay,'dd/mm/yy') then to_date('"+tu.Substring(0,10)+" 00:00','dd/mm/yyyy hh24:mi') else f.ngay end+decode(f.khoachuyen,'01',1,0),'999999999')) as ngaytk,";
					//sql+="to_date(l.ngay,'dd/mm/yy')-case when to_date('"+tu.Substring(0,10)+"','dd/mm/yy')>to_date(f.ngay,'dd/mm/yy') then to_date('"+tu.Substring(0,10)+"','dd/mm/yy') else to_date(f.ngay,'dd/mm/yy') end+decode(f.khoachuyen,'01',1,0) as ngaytk,";
				}
				else
				{
					sql+="trim(to_char(l.ngay-f.ngay+decode(f.khoachuyen,'01',"+iadd+",0),'999999999')) as ngaydt,";
					sql+="0 as ngaytk,";
				}
				sql+="nvl(x.tenpt,' ') tenpt,nvl(y.chandoan,' ') chandoannn,nvl(u.hoten,' ') as tenuser,k.sovaovien ";
				sql+="from xuatkhoa l,nhapkhoa f,btdbn a,btdpxa b,btdquan c,btdtt d,btdkp_bv e,";
				sql+="btdnn_bv g,doituong h,ketqua i,ttxk j,benhandt k,bhyt m,t_pttt x,t_cdnguyennhan y,dlogin u ";
				sql+="where a.mabn=f.mabn and f.maql=k.maql and f.id=l.id and a.maphuongxa=b.maphuongxa and a.maqu=c.maqu and a.matt=d.matt ";
				sql+="and f.makp=e.makp and a.mann=g.mann and k.madoituong=h.madoituong and l.userid=u.id(+) ";
				sql+="and l.ketqua=i.ma and l.ttlucrk=j.ma and k.loaiba=1 and f.maql=m.maql(+) and k.maql=x.maql(+) and k.maql=y.maql(+)";
				sql+=" and (m.sudung is null or m.sudung=1)";
				if (icd) sql+=" and l.maicd in (select ma from dmicd10)";
				if (pttt) sql+=" and x.mapt in (select ma from bctheopttt)";
				if (icdnn) sql+=" and y.maicd in (select ma from bctheoicd)";
				if (tu!="") 
				{
					if (time)
						sql+=" and l.ngay between to_date(:tu,"+stime+") and to_date(:den,"+stime+")";
					else
						sql+=" and to_date(l.ngay,"+stime+") between to_date(:tu,"+stime+") and to_date(:den,"+stime+")";
				}
				if (mabn!="") sql+=" and a.mabn=:mabn";
				if (hoten!="") sql+=" and a.hotenkdau=:hoten";
				//if (ngaysinh!="") sql+=" and to_char(a.ngaysinh,'dd/mm/yyyy')=:ngaysinh";
				if (ngaysinh!="") sql+=" and a.namsinh=:ngaysinh";
				if (phai!=-1) sql+=" and a.phai=:phai";
				if (sonha!="") sql+=" and lower(trim(a.sonha))=:sonha";
				if (thon!="") sql+=" and lower(trim(a.thon))=:thon";
				if (mann!="") sql+=" and a.mann=:mann";
				if (madantoc!="") sql+=" and a.madantoc=:madantoc";
				if (matt!="") sql+=" and a.matt=:matt";
				if (maqu!="")	sql+=" and a.maqu=:maqu";
				if (maphuongxa!="")	sql+=" and a.maphuongxa=:maphuongxa";
				if (makp!="") sql+=" and f.makp=:makp";
				if (sovaovien!="") sql+=" and k.sovaovien=:sovaovien";
				if (maicd!="")	sql+=" and l.maicd=:maicd";
				if (madoituong!="")	sql+=" and k.madoituong=:madoituong";
				if (ketqua!="") sql+=" and l.ketqua=:ketqua";
				if (ttlucrk!="") sql+=" and l.ttlucrk=:ttlucrk";
				if (mapttt!="") sql+=" and x.mapt=:mapttt";
				if (maicdnn!="") sql+=" and y.maicd=:maicdnn";
				if (userid!=-1) sql+=" and l.userid=:userid";
				if (dotuoi!="")
				{
					//ThanhCuong-25052011
					if (dotuoi.IndexOf("N") != -1)//(dotuoi.Trim() == "<28N")
					{
						int d1 = int.Parse(dotuoi.Substring(0, dotuoi.IndexOf("-")));
						int d2 = int.Parse(dotuoi.Substring(dotuoi.IndexOf("-") + 1,dotuoi.Length-(dotuoi.IndexOf("-") + 1)-1));
						sql += " and a.ngaysinh is not null and to_date(to_char(f.ngay,'dd/mm/yyyy'),'dd/mm/yyyy')-to_date(to_char(a.ngaysinh,'dd/mm/yyyy'),'dd/mm/yyyy') between " + d1 + " and " + d2 ;//từ ngày dến ngay
					}
					else if (dotuoi.Trim() == "<1T")
					{
						sql += " and a.ngaysinh is not null and to_date(to_char(f.ngay,'dd/mm/yyyy'),'dd/mm/yyyy')-to_date(to_char(a.ngaysinh,'dd/mm/yyyy'),'dd/mm/yyyy') between 0 and 365 ";//DUOI 1 TUOI
					}
					else if (dotuoi.IndexOf(">") != -1)
					{
						sql += " and to_number(to_char(f.ngay,'yyyy'),'0000')-to_number(a.namsinh,'0000')>" + int.Parse(dotuoi.Substring(1)); 
					}
					else
					{
						int i1 = int.Parse(dotuoi.Substring(0, dotuoi.IndexOf("-")));
						int i2 = int.Parse(dotuoi.Substring(dotuoi.IndexOf("-") + 1));
						sql += " and to_number(to_char(f.ngay,'yyyy'),'0000')-to_number(a.namsinh,'0000') between " + i1 + " and " + i2; 
					}
					//
					//					if (dotuoi.IndexOf(">")!=-1)
					//					{
					//						m_dotuoi=dotuoi.Substring(1);
					//						sql+=" and to_char(l.ngay,'yyyy')-a.namsinh>"+int.Parse(m_dotuoi);//sql+=" and to_char(sysdate,'yyyy')-a.namsinh>"+int.Parse(m_dotuoi);
					//					}
					//					else 
					//					{
					//						int i1=int.Parse(dotuoi.Substring(0,dotuoi.IndexOf("-")));
					//						int i2=int.Parse(dotuoi.Substring(dotuoi.IndexOf("-")+1));
					//						sql+=" and to_char(l.ngay,'yyyy')-a.namsinh between "+i1+" and "+i2;//sql+=" and to_char(sysdate,'yyyy')-a.namsinh between "+i1+" and "+i2;
					//					}
				}
				sql+=" order by l.ngay";
				con=new OracleConnection(sConn);
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				if (tu!="")
				{
					cmd.Parameters.Add("tu",OracleType.VarChar).Value=tu;
					cmd.Parameters.Add("den",OracleType.VarChar).Value=den;
				}
				if (mabn!="") cmd.Parameters.Add("mabn",OracleType.VarChar).Value=mabn;
				if (hoten!="") cmd.Parameters.Add("hoten",OracleType.NVarChar).Value=hoten;
				if (ngaysinh!="") cmd.Parameters.Add("ngaysinh",OracleType.VarChar).Value=ngaysinh;
				if (phai!=-1) cmd.Parameters.Add("phai",OracleType.Int16).Value=phai;
				if (sonha!="") cmd.Parameters.Add("sonha",OracleType.NVarChar).Value=sonha.Trim().ToLower();
				if (thon!="") cmd.Parameters.Add("thon",OracleType.NVarChar).Value=thon.Trim().ToLower();
				if (mann!="") cmd.Parameters.Add("mann",OracleType.VarChar).Value=mann;
				if (madantoc!="") cmd.Parameters.Add("madantoc",OracleType.VarChar).Value=madantoc;
				if (matt!="") cmd.Parameters.Add("matt",OracleType.VarChar).Value=matt;
				if (maqu!="") cmd.Parameters.Add("maqu",OracleType.VarChar).Value=maqu;
				if (maphuongxa!="")	cmd.Parameters.Add("maphuongxa",OracleType.VarChar).Value=maphuongxa;
				if (makp!="") cmd.Parameters.Add("makp",OracleType.VarChar).Value=makp;
				if (sovaovien!="") cmd.Parameters.Add("sovaovien",OracleType.VarChar).Value=sovaovien;
				if (maicd!="")	cmd.Parameters.Add("maicd",OracleType.VarChar).Value=maicd;
				if (madoituong!="")	cmd.Parameters.Add("madoituong",OracleType.VarChar).Value=madoituong;
				if (ketqua!="") cmd.Parameters.Add("ketqua",OracleType.VarChar).Value=ketqua;
				if (ttlucrk!="")	cmd.Parameters.Add("ttlucrk",OracleType.VarChar).Value=ttlucrk;
				if (mapttt!="")	cmd.Parameters.Add("mapttt",OracleType.VarChar).Value=mapttt;
				if (maicdnn!="")	cmd.Parameters.Add("maicdnn",OracleType.VarChar).Value=maicdnn;
				if (userid!=-1)	cmd.Parameters.Add("userid",OracleType.VarChar).Value=userid;
				//if (dotuoi!="")	cmd.Parameters.Add("m_dotuoi",OracleType.VarChar).Value=m_dotuoi;
				dest=new OracleDataAdapter(cmd);
				ds=new DataSet();
				dest.Fill(ds);
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim(),sComputer,"Rakhoa");
			}
			long id=0;
			foreach(DataRow r in ds.Tables[0].Select("true","id,stt"))
			{
				if (long.Parse(r["id"].ToString())!=id)	id=long.Parse(r["id"].ToString());
				else delrec(ds.Tables[0],"id="+id+" and stt<>"+long.Parse(r["stt"].ToString()));
			}
			ds.AcceptChanges();
			return ds;
		}
		public DataSet get_Ravien_giaophoi(string tu,string den,string mabn,string hoten,string ngaysinh,
			int phai,string sonha,string thon,string mann,string madantoc,string matt,string maqu, 
			string maphuongxa,string makp,string soluutru,string maicd,string madoituong,string ketqua,
			string ttlucrk,string dotuoi,bool icd,string maicdnn,bool icdnn,string mapttt,bool pttt,int userid,bool time,int chuyen)
		{	
			try
			{
				int iadd=iNgaydieutri_ngayra_ngayvao_1;
				string m_dotuoi="",stime=(time)?"'dd/mm/yy hh24:mi'":"'dd/mm/yy'";
				if (time)
				{
					tu=tu+" "+sGiobaocao;
					den=den+" "+sGiobaocao;
				}
				execute_data("delete from t_pttt");
				execute_data("delete from t_cdnguyennhan");
				if (pttt || mapttt!="")
				{
					execute_data("delete from t_pttt");
					sql="insert into t_pttt select distinct c.maql,c.mapt,c.tenpt from nhapkhoa a,xuatkhoa b,pttt c where a.id=b.id and a.maql=c.maql";
					if (tu!="")
					{
						if (time) sql+=" and b.ngay between to_date('"+tu+"',"+stime+") and to_date('"+den+"',"+stime+")";
						else sql+=" and to_date(b.ngay,"+stime+") between to_date('"+tu+"',"+stime+") and to_date('"+den+"',"+stime+")";
					}
					if (mapttt!="") sql+=" and c.mapt='"+mapttt+"'";
					if (pttt) sql+=" and c.mapt in (select ma from bctheopttt)";
					execute_data(sql);
				}
				if (icdnn || maicdnn!="")
				{
					execute_data("delete from t_cdnguyennhan");
					sql="insert into t_cdnguyennhan select distinct c.maql,c.maicd,c.chandoan from benhandt a,xuatvien b,cdnguyennhan c where a.maql=b.maql and a.maql=c.maql";
					if (tu!="")
					{
						if (time) sql+=" and b.ngay between to_date('"+tu+"',"+stime+") and to_date('"+den+"',"+stime+")";
						else sql+=" and to_date(b.ngay,"+stime+") between to_date('"+tu+"',"+stime+") and to_date('"+den+"',"+stime+")";
					}
					if (maicdnn!="") sql+=" and c.maicd='"+maicdnn+"'";
					if (icdnn) sql+=" and c.maicd in (select ma from bctheoicd)";
					execute_data(sql);
				}
				hoten=Hoten_khongdau(hoten);
				sql="select a.mabn,a.hoten,substr(m.tuoivao,1,3)||decode(substr(m.tuoivao,4,1),0,'TU',decode(substr(m.tuoivao,4,1),1,'TH',decode(substr(m.tuoivao,4,1),2,'NG','GI'))) tuoi,";
				sql+="case when a.ngaysinh is null then a.namsinh else to_char(a.ngaysinh,'dd/mm/yy') end as namsinh,nvl(a.sonha,' ') sonha,nvl(a.thon,' ') thon,b.tenpxa,c.tenquan,d.tentt,";
				sql+="g.tennn,to_char(k.ngay,'dd/mm/yyyy hh24:mi') as ngayvk,e.tenkp,h.doituong,";
				sql+="l.chandoan,l.maicd,k.sovaovien,i.ten as ketqua,j.ten as ttlucrk,";
				sql+=" nvl(n.sothe,' ') sothe,";//to_date(l.ngay,'dd/mm/yy')-to_date(k.ngay,'dd/mm/yy') ngaydt, ";
				sql+="to_char(l.ngay,'dd/mm/yyyy hh24:mi') as ngayrk,l.soluutru, ";				
				//sql+="trim(to_char(l.ngay-k.ngay+"+iadd+",'999999999')) as ngaydt,";
				sql+="to_date(l.ngay,'dd/mm/yy')-to_date(k.ngay,'dd/mm/yy')+"+iadd+" as ngaydt,";
				sql+="nvl(x.tenpt,' ') tenpt,nvl(y.chandoan,' ') chandoannn,nvl(u.hoten,' ') as tenuser,l.done,l.paid ";
				sql+=", decode(nvl(n.traituyen,0),0,'','x') as traituyen ";
				sql+=", l.maql,l.chuyen,to_char(l.ngaychuyen,'dd/mm/yyyy') ngaychuyen,e.makp ";
				sql+="from xuatvien l,benhandt k,btdbn a,btdpxa b,btdquan c,btdtt d,btdkp_bv e,";
				sql+="btdnn_bv g,doituong h,ketqua i,ttxk j,lienhe m,bhyt n,t_pttt x,t_cdnguyennhan y,dlogin u ";
				sql+="where a.mabn=l.mabn and k.maql=l.maql and a.maphuongxa=b.maphuongxa and a.maqu=c.maqu and a.matt=d.matt ";
				sql+="and l.makp=e.makp and a.mann=g.mann and k.madoituong=h.madoituong and l.userid=u.id(+) ";
				sql+="and l.ketqua=i.ma and l.ttlucrv=j.ma and k.loaiba=1 and l.maql=m.maql and l.maql=n.maql(+) and k.maql=x.maql(+) and k.maql=y.maql(+) ";
				sql+=" and (n.sudung is null or n.sudung=1)";
				if (chuyen<2) sql+=" and l.chuyen="+chuyen;
				if (icd) sql+=" and l.maicd in (select ma from dmicd10)";
				if (pttt) sql+=" and x.mapt in (select ma from bctheopttt)";
				if (icdnn) sql+=" and y.maicd in (select ma from bctheoicd)";
				if (tu!="") 
				{
					if (time)
						sql+=" and l.ngay between to_date(:tu,"+stime+") and to_date(:den,"+stime+")";
					else
						sql+=" and to_date(l.ngay,"+stime+") between to_date(:tu,"+stime+") and to_date(:den,"+stime+")";
				}
				if (mabn!="") sql+=" and a.mabn=:mabn";
				if (hoten!="") sql+=" and a.hotenkdau=:hoten";
				//if (ngaysinh!="") sql+=" and to_char(a.ngaysinh,'dd/mm/yyyy')=:ngaysinh";
				if (ngaysinh!="") sql+=" and a.namsinh=:ngaysinh";
				if (phai!=-1) sql+=" and a.phai=:phai";
				if (sonha!="") sql+=" and lower(trim(a.sonha))=:sonha";
				if (thon!="") sql+=" and lower(trim(a.thon))=:thon";
				if (mann!="") sql+=" and a.mann=:mann";
				if (madantoc!="") sql+=" and a.madantoc=:madantoc";
				if (matt!="") sql+=" and a.matt=:matt";
				if (maqu!="")	sql+=" and a.maqu=:maqu";
				if (maphuongxa!="")	sql+=" and a.maphuongxa=:maphuongxa";
				if (makp!="") sql+=" and l.makp in ('"+makp+"')";
				if (soluutru!="") sql+=" and l.soluutru=:soluutru";
				if (maicd!="")	sql+=" and l.maicd=:maicd";
				if (madoituong!="")	sql+=" and k.madoituong in('"+madoituong+"')";
				if (ketqua!="") sql+=" and l.ketqua=:ketqua";
				if (ttlucrk!="") sql+=" and l.ttlucrv=:ttlucrk";
				if (mapttt!="") sql+=" and x.mapt=:mapttt";
				if (maicdnn!="") sql+=" and y.maicd=:maicdnn";
				if (userid!=-1) sql+=" and l.userid=:userid";
				if (dotuoi!="")
				{
					//ThanhCuong-25052011
					if (dotuoi.IndexOf("N") != -1)//(dotuoi.Trim() == "<28N")
					{
						int d1 = int.Parse(dotuoi.Substring(0, dotuoi.IndexOf("-")));
						int d2 = int.Parse(dotuoi.Substring(dotuoi.IndexOf("-") + 1,dotuoi.Length-(dotuoi.IndexOf("-") + 1)-1));
						sql += " and a.ngaysinh is not null and to_date(to_char(k.ngay,'dd/mm/yyyy'),'dd/mm/yyyy')-to_date(to_char(a.ngaysinh,'dd/mm/yyyy'),'dd/mm/yyyy') between " + d1 + " and " + d2 ;//từ ngày dến ngay
					}
					else if (dotuoi.Trim() == "<1T")
					{
						sql += " and a.ngaysinh is not null and to_date(to_char(k.ngay,'dd/mm/yyyy'),'dd/mm/yyyy')-to_date(to_char(a.ngaysinh,'dd/mm/yyyy'),'dd/mm/yyyy') between 0 and 365 ";//DUOI 1 TUOI
					}
					else if (dotuoi.IndexOf(">") != -1)
					{
						sql += " and to_number(to_char(k.ngay,'yyyy'),'0000')-to_number(a.namsinh,'0000')>" + int.Parse(dotuoi.Substring(1)); 
					}
					else
					{
						int i1 = int.Parse(dotuoi.Substring(0, dotuoi.IndexOf("-")));
						int i2 = int.Parse(dotuoi.Substring(dotuoi.IndexOf("-") + 1));
						sql += " and to_number(to_char(k.ngay,'yyyy'),'0000')-to_number(a.namsinh,'0000') between " + i1 + " and " + i2; 
					}
				}
				sql+=" order by l.ngay";
				con=new OracleConnection(sConn);
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				if (tu!="")
				{
					cmd.Parameters.Add("tu",OracleType.VarChar).Value=tu;
					cmd.Parameters.Add("den",OracleType.VarChar).Value=den;
				}
				if (mabn!="") cmd.Parameters.Add("mabn",OracleType.VarChar).Value=mabn;
				if (hoten!="") cmd.Parameters.Add("hoten",OracleType.NVarChar).Value=hoten;
				if (ngaysinh!="") cmd.Parameters.Add("ngaysinh",OracleType.VarChar).Value=ngaysinh;
				if (phai!=-1) cmd.Parameters.Add("phai",OracleType.Int16).Value=phai;
				if (sonha!="") cmd.Parameters.Add("sonha",OracleType.NVarChar).Value=sonha.Trim().ToLower();
				if (thon!="") cmd.Parameters.Add("thon",OracleType.NVarChar).Value=thon.Trim().ToLower();
				if (mann!="") cmd.Parameters.Add("mann",OracleType.VarChar).Value=mann;
				if (madantoc!="") cmd.Parameters.Add("madantoc",OracleType.VarChar).Value=madantoc;
				if (matt!="") cmd.Parameters.Add("matt",OracleType.VarChar).Value=matt;
				if (maqu!="") cmd.Parameters.Add("maqu",OracleType.VarChar).Value=maqu;
				if (maphuongxa!="")	cmd.Parameters.Add("maphuongxa",OracleType.VarChar).Value=maphuongxa;
				//				if (makp!="") cmd.Parameters.Add("makp",OracleType.VarChar).Value=makp;
				if (soluutru!="") cmd.Parameters.Add("soluutru",OracleType.VarChar).Value=soluutru;
				if (maicd!="")	cmd.Parameters.Add("maicd",OracleType.VarChar).Value=maicd;
				//				if (madoituong!="")	cmd.Parameters.Add("madoituong",OracleType.VarChar).Value=madoituong;
				if (ketqua!="") cmd.Parameters.Add("ketqua",OracleType.VarChar).Value=ketqua;
				if (ttlucrk!="")	cmd.Parameters.Add("ttlucrk",OracleType.VarChar).Value=ttlucrk;
				if (mapttt!="")	cmd.Parameters.Add("mapttt",OracleType.VarChar).Value=mapttt;
				if (maicdnn!="")	cmd.Parameters.Add("maicdnn",OracleType.VarChar).Value=maicdnn;
				if (userid!=-1)	cmd.Parameters.Add("userid",OracleType.VarChar).Value=userid;
				//if (dotuoi!="")	cmd.Parameters.Add("m_dotuoi",OracleType.VarChar).Value=m_dotuoi;
				dest=new OracleDataAdapter(cmd);
				ds=new DataSet();
				dest.Fill(ds);
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim(),sComputer,"Ravien");
			}
			return ds;
		}

		public DataSet get_Ravien(string tu,string den,string mabn,string hoten,string ngaysinh,
			int phai,string sonha,string thon,string mann,string madantoc,string matt,string maqu, 
			string maphuongxa,string makp,string soluutru,string maicd,string madoituong,string ketqua,
			string ttlucrk,string dotuoi,bool icd,string maicdnn,bool icdnn,string mapttt,bool pttt,int userid,bool time)
		{	
			try
			{
				int iadd=iNgaydieutri_ngayra_ngayvao_1;
				string m_dotuoi="",stime=(time)?"'dd/mm/yy hh24:mi'":"'dd/mm/yy'";
				if (time)
				{
					tu=tu+" "+sGiobaocao;
					den=den+" "+sGiobaocao;
				}
				execute_data("delete from t_pttt");
				execute_data("delete from t_cdnguyennhan");
				if (pttt || mapttt!="")
				{
					execute_data("delete from t_pttt");
					sql="insert into t_pttt select distinct c.maql,c.mapt,c.tenpt from nhapkhoa a,xuatkhoa b,pttt c where a.id=b.id and a.maql=c.maql";
					if (tu!="")
					{
						if (time) sql+=" and b.ngay between to_date('"+tu+"',"+stime+") and to_date('"+den+"',"+stime+")";
						else sql+=" and to_date(b.ngay,"+stime+") between to_date('"+tu+"',"+stime+") and to_date('"+den+"',"+stime+")";
					}
					if (mapttt!="") sql+=" and c.mapt='"+mapttt+"'";
					if (pttt) sql+=" and c.mapt in (select ma from bctheopttt)";
					execute_data(sql);
				}
				if (icdnn || maicdnn!="")
				{
					execute_data("delete from t_cdnguyennhan");
					sql="insert into t_cdnguyennhan select distinct c.maql,c.maicd,c.chandoan from benhandt a,xuatvien b,cdnguyennhan c where a.maql=b.maql and a.maql=c.maql";
					if (tu!="")
					{
						if (time) sql+=" and b.ngay between to_date('"+tu+"',"+stime+") and to_date('"+den+"',"+stime+")";
						else sql+=" and to_date(b.ngay,"+stime+") between to_date('"+tu+"',"+stime+") and to_date('"+den+"',"+stime+")";
					}
					if (maicdnn!="") sql+=" and c.maicd='"+maicdnn+"'";
					if (icdnn) sql+=" and c.maicd in (select ma from bctheoicd)";
					execute_data(sql);
				}
				hoten=Hoten_khongdau(hoten);
				sql="select a.mabn,a.hoten,substr(m.tuoivao,1,3)||decode(substr(m.tuoivao,4,1),0,'TU',decode(substr(m.tuoivao,4,1),1,'TH',decode(substr(m.tuoivao,4,1),2,'NG','GI'))) tuoi,";
				sql+="case when a.ngaysinh is null then a.namsinh else to_char(a.ngaysinh,'dd/mm/yy') end as namsinh,nvl(a.sonha,' ') sonha,nvl(a.thon,' ') thon,b.tenpxa,c.tenquan,d.tentt,";
				sql+="g.tennn,to_char(k.ngay,'dd/mm/yyyy hh24:mi') as ngayvk,e.tenkp,h.doituong,";
				sql+="l.chandoan,l.maicd,k.sovaovien,i.ten as ketqua,j.ten as ttlucrk,";
				sql+=" nvl(n.sothe,' ') sothe,";//to_date(l.ngay,'dd/mm/yy')-to_date(k.ngay,'dd/mm/yy') ngaydt, ";
				sql+="to_char(l.ngay,'dd/mm/yyyy hh24:mi') as ngayrk,l.soluutru, ";				
				//sql+="trim(to_char(l.ngay-k.ngay+"+iadd+",'999999999')) as ngaydt,";
				sql+="to_date(l.ngay,'dd/mm/yy')-to_date(k.ngay,'dd/mm/yy')+"+iadd+" as ngaydt,";
				sql+="nvl(x.tenpt,' ') tenpt,nvl(y.chandoan,' ') chandoannn,nvl(u.hoten,' ') as tenuser,l.done,l.paid ";
				sql+=", decode(nvl(n.traituyen,0),0,'','x') as traituyen ";
				sql+=", l.maql ";
				sql+="from xuatvien l,benhandt k,btdbn a,btdpxa b,btdquan c,btdtt d,btdkp_bv e,";
				sql+="btdnn_bv g,doituong h,ketqua i,ttxk j,lienhe m,bhyt n,t_pttt x,t_cdnguyennhan y,dlogin u ";
				sql+="where a.mabn=l.mabn and k.maql=l.maql and a.maphuongxa=b.maphuongxa and a.maqu=c.maqu and a.matt=d.matt ";
				sql+="and l.makp=e.makp and a.mann=g.mann and k.madoituong=h.madoituong and l.userid=u.id(+) ";
				sql+="and l.ketqua=i.ma and l.ttlucrv=j.ma and k.loaiba=1 and l.maql=m.maql and l.maql=n.maql(+) and k.maql=x.maql(+) and k.maql=y.maql(+) ";
				sql+=" and (n.sudung is null or n.sudung=1)";
				if (icd) sql+=" and l.maicd in (select ma from dmicd10)";
				if (pttt) sql+=" and x.mapt in (select ma from bctheopttt)";
				if (icdnn) sql+=" and y.maicd in (select ma from bctheoicd)";
				if (tu!="") 
				{
					if (time)
						sql+=" and l.ngay between to_date(:tu,"+stime+") and to_date(:den,"+stime+")";
					else
						sql+=" and to_date(l.ngay,"+stime+") between to_date(:tu,"+stime+") and to_date(:den,"+stime+")";
				}
				if (mabn!="") sql+=" and a.mabn=:mabn";
				if (hoten!="") sql+=" and a.hotenkdau=:hoten";
				//if (ngaysinh!="") sql+=" and to_char(a.ngaysinh,'dd/mm/yyyy')=:ngaysinh";
				if (ngaysinh!="") sql+=" and a.namsinh=:ngaysinh";
				if (phai!=-1) sql+=" and a.phai=:phai";
				if (sonha!="") sql+=" and lower(trim(a.sonha))=:sonha";
				if (thon!="") sql+=" and lower(trim(a.thon))=:thon";
				if (mann!="") sql+=" and a.mann=:mann";
				if (madantoc!="") sql+=" and a.madantoc=:madantoc";
				if (matt!="") sql+=" and a.matt=:matt";
				if (maqu!="")	sql+=" and a.maqu=:maqu";
				if (maphuongxa!="")	sql+=" and a.maphuongxa=:maphuongxa";
				if (makp!="") sql+=" and l.makp=:makp";
				if (soluutru!="") sql+=" and l.soluutru=:soluutru";
				if (maicd!="")	sql+=" and l.maicd=:maicd";
				if (madoituong!="")	sql+=" and k.madoituong=:madoituong";
				if (ketqua!="") sql+=" and l.ketqua=:ketqua";
				if (ttlucrk!="") sql+=" and l.ttlucrv=:ttlucrk";
				if (mapttt!="") sql+=" and x.mapt=:mapttt";
				if (maicdnn!="") sql+=" and y.maicd=:maicdnn";
				if (userid!=-1) sql+=" and l.userid=:userid";
				if (dotuoi!="")
				{
					//ThanhCuong-25052011
					if (dotuoi.IndexOf("N") != -1)//(dotuoi.Trim() == "<28N")
					{
						int d1 = int.Parse(dotuoi.Substring(0, dotuoi.IndexOf("-")));
						int d2 = int.Parse(dotuoi.Substring(dotuoi.IndexOf("-") + 1,dotuoi.Length-(dotuoi.IndexOf("-") + 1)-1));
						sql += " and a.ngaysinh is not null and to_date(to_char(k.ngay,'dd/mm/yyyy'),'dd/mm/yyyy')-to_date(to_char(a.ngaysinh,'dd/mm/yyyy'),'dd/mm/yyyy') between " + d1 + " and " + d2 ;//từ ngày dến ngay
					}
					else if (dotuoi.Trim() == "<1T")
					{
						sql += " and a.ngaysinh is not null and to_date(to_char(k.ngay,'dd/mm/yyyy'),'dd/mm/yyyy')-to_date(to_char(a.ngaysinh,'dd/mm/yyyy'),'dd/mm/yyyy') between 0 and 365 ";//DUOI 1 TUOI
					}
					else if (dotuoi.IndexOf(">") != -1)
					{
						sql += " and to_number(to_char(k.ngay,'yyyy'),'0000')-to_number(a.namsinh,'0000')>" + int.Parse(dotuoi.Substring(1)); 
					}
					else
					{
						int i1 = int.Parse(dotuoi.Substring(0, dotuoi.IndexOf("-")));
						int i2 = int.Parse(dotuoi.Substring(dotuoi.IndexOf("-") + 1));
						sql += " and to_number(to_char(k.ngay,'yyyy'),'0000')-to_number(a.namsinh,'0000') between " + i1 + " and " + i2; 
					}
					//
					//					if (dotuoi.IndexOf(">")!=-1)
					//					{
					//						m_dotuoi=dotuoi.Substring(1);
					//						sql+=" and to_char(l.ngay,'yyyy')-a.namsinh>"+int.Parse(m_dotuoi);//sql+=" and to_char(sysdate,'yyyy')-a.namsinh>"+int.Parse(m_dotuoi);
					//					}
					//					else 
					//					{
					//						int i1=int.Parse(dotuoi.Substring(0,dotuoi.IndexOf("-")));
					//						int i2=int.Parse(dotuoi.Substring(dotuoi.IndexOf("-")+1));
					//						sql+=" and to_char(l.ngay,'yyyy')-a.namsinh between "+i1+" and "+i2;//sql+=" and to_char(sysdate,'yyyy')-a.namsinh between "+i1+" and "+i2;
					//					}
				}
				sql+=" order by l.ngay";
				con=new OracleConnection(sConn);
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				if (tu!="")
				{
					cmd.Parameters.Add("tu",OracleType.VarChar).Value=tu;
					cmd.Parameters.Add("den",OracleType.VarChar).Value=den;
				}
				if (mabn!="") cmd.Parameters.Add("mabn",OracleType.VarChar).Value=mabn;
				if (hoten!="") cmd.Parameters.Add("hoten",OracleType.NVarChar).Value=hoten;
				if (ngaysinh!="") cmd.Parameters.Add("ngaysinh",OracleType.VarChar).Value=ngaysinh;
				if (phai!=-1) cmd.Parameters.Add("phai",OracleType.Int16).Value=phai;
				if (sonha!="") cmd.Parameters.Add("sonha",OracleType.NVarChar).Value=sonha.Trim().ToLower();
				if (thon!="") cmd.Parameters.Add("thon",OracleType.NVarChar).Value=thon.Trim().ToLower();
				if (mann!="") cmd.Parameters.Add("mann",OracleType.VarChar).Value=mann;
				if (madantoc!="") cmd.Parameters.Add("madantoc",OracleType.VarChar).Value=madantoc;
				if (matt!="") cmd.Parameters.Add("matt",OracleType.VarChar).Value=matt;
				if (maqu!="") cmd.Parameters.Add("maqu",OracleType.VarChar).Value=maqu;
				if (maphuongxa!="")	cmd.Parameters.Add("maphuongxa",OracleType.VarChar).Value=maphuongxa;
				if (makp!="") cmd.Parameters.Add("makp",OracleType.VarChar).Value=makp;
				if (soluutru!="") cmd.Parameters.Add("soluutru",OracleType.VarChar).Value=soluutru;
				if (maicd!="")	cmd.Parameters.Add("maicd",OracleType.VarChar).Value=maicd;
				if (madoituong!="")	cmd.Parameters.Add("madoituong",OracleType.VarChar).Value=madoituong;
				if (ketqua!="") cmd.Parameters.Add("ketqua",OracleType.VarChar).Value=ketqua;
				if (ttlucrk!="")	cmd.Parameters.Add("ttlucrk",OracleType.VarChar).Value=ttlucrk;
				if (mapttt!="")	cmd.Parameters.Add("mapttt",OracleType.VarChar).Value=mapttt;
				if (maicdnn!="")	cmd.Parameters.Add("maicdnn",OracleType.VarChar).Value=maicdnn;
				if (userid!=-1)	cmd.Parameters.Add("userid",OracleType.VarChar).Value=userid;
				//if (dotuoi!="")	cmd.Parameters.Add("m_dotuoi",OracleType.VarChar).Value=m_dotuoi;
				dest=new OracleDataAdapter(cmd);
				ds=new DataSet();
				dest.Fill(ds);
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim(),sComputer,"Ravien");
			}
			return ds;
		}

		public DataSet get_Pttt_noitru(string tu,string den,string mabn,string hoten,string ngaysinh,
			int phai,string sonha,string thon,string mann,string madantoc,string matt,string maqu, 
			string maphuongxa,string makp,string sovaovien,string madoituong,string mapt,
			string tenbs,string tenphuongphap,string tinhhinh,string loaipt,string taibien,string tuvong,string dotuoi,int userid,bool time,bool mien)
		{	
			try
			{
				string m_dotuoi="",stime=(time)?"'dd/mm/yy hh24:mi'":"'dd/mm/yy'";
				if (time)
				{
					tu=tu+" "+sGiobaocao;
					den=den+" "+sGiobaocao;
				}
				hoten=Hoten_khongdau(hoten);
				sql="select a.mabn,a.hoten,substr(q.tuoivao,1,3)||decode(substr(q.tuoivao,4,1),0,'TU',decode(substr(q.tuoivao,4,1),1,'TH',decode(substr(q.tuoivao,4,1),2,'NG','GI'))) tuoi,";
				sql+="case when a.ngaysinh is null then a.namsinh else to_char(a.ngaysinh,'dd/mm/yy') end as namsinh,nvl(a.sonha,' ') sonha,nvl(a.thon,' ') thon,b.tenpxa,c.tenquan,d.tentt,";
				sql+="g.tennn,to_char(f.ngay,'dd/mm/yyyy hh24:mi') as ngay,e.tenkp,h.doituong,";
				sql+="f.tenpt,f.mapt,j.ten as loaipt,p.hoten as tenbs,k.ten as phuongphap,";
				sql+="m.ten as tinhhinh,n.ten as taibien,l.ten as tuvong,o.sovaovien,nvl(u.hoten,' ') as tenuser ";
				sql+="from btdbn a,btdpxa b,btdquan c,btdtt d,btdkp_bv e,pttt f,";
				sql+="btdnn_bv g,doituong h,dmpttt i,loaipttt j,dmmete k,tuvongpt l,tinhhinhpt m,taibienpt n,benhandt o,dmbs p,lienhe q,dlogin u ";
				sql+="where a.mabn=f.mabn and f.maql=o.maql and a.maphuongxa=b.maphuongxa and a.maqu=c.maqu and a.matt=d.matt ";
				sql+="and f.makp=e.makp and a.mann=g.mann and o.madoituong=h.madoituong ";
				sql+="and f.mapt=i.mapt and i.loaipt=j.ma and f.phuongphap=k.ma and f.userid=u.id(+) ";
				sql+="and f.tuvong=l.ma and f.tinhhinh=m.ma and f.taibien=n.ma and f.ptv=p.ma and f.maql=q.maql";
				if (mien) sql+=" and f.molaimien=1";
				if (tu!="") 
				{
					if (time)
						sql+=" and f.ngay between to_date(:tu,"+stime+") and to_date(:den,"+stime+")";
					else
						sql+=" and to_date(f.ngay,"+stime+") between to_date(:tu,"+stime+") and to_date(:den,"+stime+")";
				}
				if (mabn!="") sql+=" and a.mabn=:mabn";
				if (hoten!="") sql+=" and a.hotenkdau=:hoten";
				if (ngaysinh!="") sql+=" and to_char(a.ngaysinh,'dd/mm/yyyy')=:ngaysinh";
				if (phai!=-1) sql+=" and a.phai=:phai";
				if (sonha!="") sql+=" and lower(trim(a.sonha))=:sonha";
				if (thon!="") sql+=" and lower(trim(a.thon))=:thon";
				if (mann!="") sql+=" and a.mann=:mann";
				if (madantoc!="") sql+=" and a.madantoc=:madantoc";
				if (matt!="") sql+=" and a.matt=:matt";
				if (maqu!="")	sql+=" and a.maqu=:maqu";
				if (maphuongxa!="")	sql+=" and a.maphuongxa=:maphuongxa";
				if (makp!="") sql+=" and f.makp=:makp";
				if (sovaovien!="") sql+=" and o.sovaovien=:sovaovien";
				if (madoituong!="")	sql+=" and o.madoituong=:madoituong";
				if (mapt!="") sql+=" and f.mapt=:mapt";
				if (tenbs!="")	sql+=" and f.ptv=:tenbs";
				if (tenphuongphap!="")	sql+=" and f.phuongphap=:tenphuongphap";
				if (tinhhinh!="") sql+=" and f.tinhhinh=:tinhhinh";
				if (loaipt!="") sql+=" and i.loaipt=:loaipt";
				if (taibien!="") sql+=" and f.taibien=:taibien";
				if (tuvong!="") sql+=" and f.tuvong=:tuvong";
				if (userid!=-1) sql+=" and f.userid=:userid";
				if (dotuoi!="")
				{
					if (dotuoi.IndexOf(">")!=-1)
					{
						m_dotuoi=dotuoi.Substring(1);
						sql+=" and to_char(f.ngay,'yyyy')-a.namsinh>"+int.Parse(m_dotuoi);//sql+=" and to_char(sysdate,'yyyy')-a.namsinh>"+int.Parse(m_dotuoi);
					}
					else 
					{
						int i1=int.Parse(dotuoi.Substring(0,dotuoi.IndexOf("-")));
						int i2=int.Parse(dotuoi.Substring(dotuoi.IndexOf("-")+1));
						sql+=" and to_char(f.ngay,'yyyy')-a.namsinh between "+i1+" and "+i2;//sql+=" and to_char(sysdate,'yyyy')-a.namsinh between "+i1+" and "+i2;
					}
				}
				sql+=" order by f.ngay";
				con=new OracleConnection(sConn);
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				if (tu!="")
				{
					cmd.Parameters.Add("tu",OracleType.VarChar).Value=tu;
					cmd.Parameters.Add("den",OracleType.VarChar).Value=den;
				}
				if (mabn!="") cmd.Parameters.Add("mabn",OracleType.VarChar).Value=mabn;
				if (hoten!="") cmd.Parameters.Add("hoten",OracleType.NVarChar).Value=hoten;
				if (ngaysinh!="") cmd.Parameters.Add("ngaysinh",OracleType.VarChar).Value=ngaysinh;
				if (phai!=-1) cmd.Parameters.Add("phai",OracleType.Int16).Value=phai;
				if (sonha!="") cmd.Parameters.Add("sonha",OracleType.NVarChar).Value=sonha.Trim().ToLower();
				if (thon!="") cmd.Parameters.Add("thon",OracleType.NVarChar).Value=thon.Trim().ToLower();
				if (mann!="") cmd.Parameters.Add("mann",OracleType.VarChar).Value=mann;
				if (madantoc!="") cmd.Parameters.Add("madantoc",OracleType.VarChar).Value=madantoc;
				if (matt!="") cmd.Parameters.Add("matt",OracleType.VarChar).Value=matt;
				if (maqu!="") cmd.Parameters.Add("maqu",OracleType.VarChar).Value=maqu;
				if (maphuongxa!="")	cmd.Parameters.Add("maphuongxa",OracleType.VarChar).Value=maphuongxa;
				if (makp!="") cmd.Parameters.Add("makp",OracleType.VarChar).Value=makp;
				if (sovaovien!="") cmd.Parameters.Add("sovaovien",OracleType.VarChar).Value=sovaovien;
				if (madoituong!="")	cmd.Parameters.Add("madoituong",OracleType.VarChar).Value=madoituong;
				if (mapt!="") cmd.Parameters.Add("mapt",OracleType.VarChar).Value=mapt;
				if (tenbs!="")	cmd.Parameters.Add("tenbs",OracleType.VarChar).Value=tenbs;
				if (tenphuongphap!="") cmd.Parameters.Add("tenphuongphap",OracleType.VarChar).Value=tenphuongphap;
				if (tinhhinh!="") cmd.Parameters.Add("tinhhinh",OracleType.VarChar).Value=tinhhinh;
				if (loaipt!="") cmd.Parameters.Add("loaipt",OracleType.VarChar).Value=loaipt;
				if (taibien!="") cmd.Parameters.Add("taibien",OracleType.VarChar).Value=taibien;
				if (tuvong!="")  cmd.Parameters.Add("tuvong",OracleType.VarChar).Value=tuvong;
				if (userid!=-1)	cmd.Parameters.Add("userid",OracleType.VarChar).Value=userid;
				//if (dotuoi!="")	cmd.Parameters.Add("m_dotuoi",OracleType.VarChar).Value=m_dotuoi;
				dest=new OracleDataAdapter(cmd);
				ds=new DataSet();
				dest.Fill(ds);
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim(),sComputer,"PTTT");
			}
			return ds;
		}

		public DataSet get_Pttt_khambenh(string tu,string den,string mabn,string hoten,string ngaysinh,
			int phai,string sonha,string thon,string mann,string madantoc,string matt,string maqu, 
			string maphuongxa,string makp,string sovaovien,string madoituong,string mapt,
			string tenbs,string tenphuongphap,string tinhhinh,string loaipt,string taibien,string tuvong,string dotuoi,int userid,bool time,bool mien)
		{	
			string m_dotuoi="",stime=(time)?"'dd/mm/yy hh24:mi'":"'dd/mm/yy'";
			if (time)
			{
				tu=tu+" "+sGiobaocao;
				den=den+" "+sGiobaocao;
			}
			hoten=Hoten_khongdau(hoten);
			sql="select a.mabn,a.hoten,substr(q.tuoivao,1,3)||decode(substr(q.tuoivao,4,1),0,'TU',decode(substr(q.tuoivao,4,1),1,'TH',decode(substr(q.tuoivao,4,1),2,'NG','GI'))) tuoi,";
			sql+="case when a.ngaysinh is null then a.namsinh else to_char(a.ngaysinh,'dd/mm/yy') end as namsinh,nvl(a.sonha,' ') sonha,nvl(a.thon,' ') thon,b.tenpxa,c.tenquan,d.tentt,";
			sql+="g.tennn,to_char(f.ngay,'dd/mm/yyyy hh24:mi') as ngay,e.tenkp,h.doituong,";
			sql+="f.tenpt,f.mapt,j.ten as loaipt,p.hoten as tenbs,k.ten as phuongphap,";
			sql+="m.ten as tinhhinh,n.ten as taibien,l.ten as tuvong,o.sovaovien,nvl(u.hoten,' ') as tenuser ";
			sql+="from btdbn a,btdpxa b,btdquan c,btdtt d,btdkp_bv e,pttt f,";
			sql+="btdnn_bv g,doituong h,dmpttt i,loaipttt j,dmmete k,tuvongpt l,tinhhinhpt m,taibienpt n,xxx.benhandt o,dmbs p,xxx.lienhe q,dlogin u ";
			sql+="where a.mabn=f.mabn and f.maql=o.maql and a.maphuongxa=b.maphuongxa and a.maqu=c.maqu and a.matt=d.matt ";
			sql+="and f.makp=e.makp and a.mann=g.mann and o.madoituong=h.madoituong ";
			sql+="and f.mapt=i.mapt and i.loaipt=j.ma and f.phuongphap=k.ma and f.userid=u.id(+) ";
			sql+="and f.tuvong=l.ma and f.tinhhinh=m.ma and f.taibien=n.ma and f.ptv=p.ma and f.maql=q.maql";
			if (mien) sql+=" and f.molaimien=1";
			if (tu!="") 
			{
				if (time)
					sql+=" and f.ngay between to_date('"+tu+"',"+stime+") and to_date('"+den+"',"+stime+")";
				else
					sql+=" and to_date(f.ngay,"+stime+") between to_date('"+tu+"',"+stime+") and to_date('"+den+"',"+stime+")";
			}
			if (mabn!="") sql+=" and a.mabn='"+mabn+"'";
			if (hoten!="") sql+=" and a.hotenkdau='"+hoten+"'";
			if (ngaysinh!="") sql+=" and to_char(a.ngaysinh,'dd/mm/yyyy')='"+ngaysinh+"'";
			if (phai!=-1) sql+=" and a.phai="+phai;
			if (sonha!="") sql+=" and lower(trim(a.sonha))='"+sonha+"'";
			if (thon!="") sql+=" and lower(trim(a.thon))='"+thon+"'";
			if (mann!="") sql+=" and a.mann='"+mann+"'";
			if (madantoc!="") sql+=" and a.madantoc='"+madantoc+"'";
			if (matt!="") sql+=" and a.matt='"+matt+"'";
			if (maqu!="")	sql+=" and a.maqu='"+maqu+"'";
			if (maphuongxa!="")	sql+=" and a.maphuongxa='"+maphuongxa+"'";
			if (makp!="") sql+=" and f.makp='"+makp+"'";
			if (sovaovien!="") sql+=" and o.sovaovien='"+sovaovien+"'";
			if (madoituong!="")	sql+=" and o.madoituong="+madoituong;
			if (mapt!="") sql+=" and f.mapt='"+mapt+"'";
			if (tenbs!="")	sql+=" and f.ptv='"+tenbs+"'";
			if (tenphuongphap!="")	sql+=" and f.phuongphap='"+tenphuongphap+"'";
			if (tinhhinh!="") sql+=" and f.tinhhinh="+tinhhinh;
			if (loaipt!="") sql+=" and i.loaipt="+loaipt;
			if (taibien!="") sql+=" and f.taibien="+taibien;
			if (tuvong!="") sql+=" and f.tuvong="+tuvong;
			if (userid!=-1) sql+=" and f.userid="+userid;
			if (dotuoi!="")
			{
				if (dotuoi.IndexOf(">")!=-1)
				{
					m_dotuoi=dotuoi.Substring(1);
					sql+=" and to_char(f.ngay,'yyyy')-a.namsinh>"+int.Parse(m_dotuoi);//sql+=" and to_char(sysdate,'yyyy')-a.namsinh>"+int.Parse(m_dotuoi);
				}
				else 
				{
					int i1=int.Parse(dotuoi.Substring(0,dotuoi.IndexOf("-")));
					int i2=int.Parse(dotuoi.Substring(dotuoi.IndexOf("-")+1));
					sql+=" and to_char(f.ngay,'yyyy')-a.namsinh between "+i1+" and "+i2;//sql+=" and to_char(sysdate,'yyyy')-a.namsinh between "+i1+" and "+i2;
				}
			}
			sql+=" order by f.ngay";
			return get_data_mmyy(sql, tu.Substring(0,10), den.Substring(0,10), false);
		}

		public DataSet get_Pttt_tiepdon(string tu,string den,string mabn,string hoten,string ngaysinh,
			int phai,string sonha,string thon,string mann,string madantoc,string matt,string maqu, 
			string maphuongxa,string makp,string sovaovien,string madoituong,string mapt,
			string tenbs,string tenphuongphap,string tinhhinh,string loaipt,string taibien,string tuvong,string dotuoi,int userid,bool time,bool mien)
		{	
			string m_dotuoi="",stime=(time)?"'dd/mm/yy hh24:mi'":"'dd/mm/yy'";
			if (time)
			{
				tu=tu+" "+sGiobaocao;
				den=den+" "+sGiobaocao;
			}
			hoten=Hoten_khongdau(hoten);
			sql="select a.mabn,a.hoten,substr(o.tuoivao,1,3)||decode(substr(o.tuoivao,4,1),0,'TU',decode(substr(o.tuoivao,4,1),1,'TH',decode(substr(o.tuoivao,4,1),2,'NG','GI'))) tuoi,";
			sql+="case when a.ngaysinh is null then a.namsinh else to_char(a.ngaysinh,'dd/mm/yy') end as namsinh,nvl(a.sonha,' ') sonha,nvl(a.thon,' ') thon,b.tenpxa,c.tenquan,d.tentt,";
			sql+="g.tennn,to_char(f.ngay,'dd/mm/yyyy hh24:mi') as ngay,e.tenkp,h.doituong,";
			sql+="f.tenpt,f.mapt,j.ten as loaipt,p.hoten as tenbs,k.ten as phuongphap,";
			sql+="m.ten as tinhhinh,n.ten as taibien,l.ten as tuvong,o.sovaovien,nvl(u.hoten,' ') as tenuser ";
			sql+="from btdbn a,btdpxa b,btdquan c,btdtt d,btdkp_bv e,pttt f,";
			sql+="btdnn_bv g,doituong h,dmpttt i,loaipttt j,dmmete k,tuvongpt l,tinhhinhpt m,taibienpt n,xxx.tiepdon o,dmbs p,dlogin u ";
			sql+="where a.mabn=f.mabn and f.maql=o.maql and a.maphuongxa=b.maphuongxa and a.maqu=c.maqu and a.matt=d.matt ";
			sql+="and f.makp=e.makp and a.mann=g.mann and o.madoituong=h.madoituong ";
			sql+="and f.mapt=i.mapt and i.loaipt=j.ma and f.phuongphap=k.ma and f.userid=u.id(+) ";
			sql+="and f.tuvong=l.ma and f.tinhhinh=m.ma and f.taibien=n.ma and f.ptv=p.ma";
			if (mien) sql+=" and f.molaimien=1";
			if (tu!="") 
			{
				if (time)
					sql+=" and f.ngay between to_date('"+tu+"',"+stime+") and to_date('"+den+"',"+stime+")";
				else
					sql+=" and to_date(f.ngay,"+stime+") between to_date('"+tu+"',"+stime+") and to_date('"+den+"',"+stime+")";
			}
			if (mabn!="") sql+=" and a.mabn='"+mabn+"'";
			if (hoten!="") sql+=" and a.hotenkdau='"+hoten+"'";
			if (ngaysinh!="") sql+=" and to_char(a.ngaysinh,'dd/mm/yyyy')='"+ngaysinh+"'";
			if (phai!=-1) sql+=" and a.phai="+phai;
			if (sonha!="") sql+=" and lower(trim(a.sonha))='"+sonha+"'";
			if (thon!="") sql+=" and lower(trim(a.thon))='"+thon+"'";
			if (mann!="") sql+=" and a.mann='"+mann+"'";
			if (madantoc!="") sql+=" and a.madantoc='"+madantoc+"'";
			if (matt!="") sql+=" and a.matt='"+matt+"'";
			if (maqu!="")	sql+=" and a.maqu='"+maqu+"'";
			if (maphuongxa!="")	sql+=" and a.maphuongxa='"+maphuongxa+"'";
			if (makp!="") sql+=" and f.makp='"+makp+"'";
			if (sovaovien!="") sql+=" and o.sovaovien='"+sovaovien+"'";
			if (madoituong!="")	sql+=" and o.madoituong="+madoituong;
			if (mapt!="") sql+=" and f.mapt='"+mapt+"'";
			if (tenbs!="")	sql+=" and f.ptv='"+tenbs+"'";
			if (tenphuongphap!="")	sql+=" and f.phuongphap='"+tenphuongphap+"'";
			if (tinhhinh!="") sql+=" and f.tinhhinh="+tinhhinh;
			if (loaipt!="") sql+=" and i.loaipt="+loaipt;
			if (taibien!="") sql+=" and f.taibien="+taibien;
			if (tuvong!="") sql+=" and f.tuvong="+tuvong;
			if (userid!=-1) sql+=" and f.userid="+userid;
			if (dotuoi!="")
			{
				if (dotuoi.IndexOf(">")!=-1)
				{
					m_dotuoi=dotuoi.Substring(1);
					sql+=" and to_char(f.ngay,'yyyy')-a.namsinh>"+int.Parse(m_dotuoi);//sql+=" and to_char(sysdate,'yyyy')-a.namsinh>"+int.Parse(m_dotuoi);
				}
				else 
				{
					int i1=int.Parse(dotuoi.Substring(0,dotuoi.IndexOf("-")));
					int i2=int.Parse(dotuoi.Substring(dotuoi.IndexOf("-")+1));
					sql+=" and to_char(f.ngay,'yyyy')-a.namsinh between "+i1+" and "+i2;//sql+=" and to_char(sysdate,'yyyy')-a.namsinh between "+i1+" and "+i2;
				}
			}
			sql+=" order by f.ngay";
			return get_data_mmyy(sql, tu.Substring(0,10), den.Substring(0,10), false);
		}

		public DataSet get_Tannantt(string tu,string den,string mabn,string hoten,string ngaysinh,
			int phai,string thon,string mann,string madantoc,string matt,string maqu, 
			string maphuongxa,string dotuoi,string diadiem,string bophan,string nguyennhan,string ngodoc,string dienbien,
			string xutri,int userid,bool time)
		{	
			try
			{
				string m_dotuoi="",stime=(time)?"'dd/mm/yy hh24:mi'":"'dd/mm/yy'";
				if (time)
				{
					tu=tu+" "+sGiobaocao;
					den=den+" "+sGiobaocao;
				}
				hoten=Hoten_khongdau(hoten);
				sql="SELECT a.maql,a.MABN,t.HOTEN,case when t.ngaysinh is null then t.namsinh else to_char(t.ngaysinh,'dd/mm/yy') end as namsinh,c.TENNN,d.TEN as DIADIEM,e.TEN as BOPHAN, f.TEN as NGUYENNHAN, g.TEN as NGODOC,h.ten as DIENBIEN,i.TEN as XUTRI,a.thon,x.tentt,y.tenquan,z.tenpxa,trim(t.sonha)||' '||t.thon||' '||trim(z1.tenpxa)||','||trim(y1.tenquan)||','||x1.tentt as diachi,to_char(a.ngay,'dd/mm/yyyy hh24:mi') as ngay";
				sql+=" FROM TAINANTT a,BTDBN t,BTDNN_BV c,DMDIADIEM d,DMBOPHAN e,DMNGUYENNHAN f,DMDIENBIEN h,DMXUTRI i,DMNGODOC g,btdtt x,btdquan y,btdpxa z,btdtt x1,btdquan y1,btdpxa z1 ";
				sql+=" where a.mabn=t.mabn and t.MANN = c.MANN and a.DIADIEM = d.MA and a.BOPHAN = e.MA and a.NGUYENNHAN = f.MA and a.DIENBIEN = h.MA and a.XUTRI = i.MA and a.NGODOC = g.MA";
				sql+=" and a.matt=x.matt and a.maqu=y.maqu and a.maphuongxa=z.maphuongxa and t.matt=x1.matt and t.maqu=y1.maqu and t.maphuongxa=z1.maphuongxa";
				if (tu!="") 
				{
					if (time)
						sql+=" and a.ngay between to_date(:tu,"+stime+") and to_date(:den,"+stime+")";
					else
						sql+=" and to_date(a.ngay,"+stime+") between to_date(:tu,"+stime+") and to_date(:den,"+stime+")";
				}
				if (mabn!="") sql+=" and t.mabn=:mabn";
				if (hoten!="") sql+=" and t.hotenkdau=:hoten";
				if (ngaysinh!="") sql+=" and to_char(t.ngaysinh,'dd/mm/yyyy')=:ngaysinh";
				if (phai!=-1) sql+=" and t.phai=:phai";
				if (thon!="") sql+=" and a.thon=:thon";
				if (mann!="") sql+=" and t.mann=:mann";
				if (madantoc!="") sql+=" and t.madantoc=:madantoc";
				if (matt!="") sql+=" and a.matt=:matt";
				if (maqu!="")	sql+=" and a.maqu=:maqu";
				if (maphuongxa!="")	sql+=" and a.maphuongxa=:maphuongxa";
				if (diadiem!="")	sql+=" and a.diadiem=:diadiem";
				if (bophan!="") sql+=" and a.bophan=:bophan";
				if (nguyennhan!="")	sql+=" and a.nguyennhan=:nguyennhan";
				if (ngodoc!="")	sql+=" and a.ngodoc=:ngodoc";
				if (dienbien!="")	sql+=" and a.dienbien=:dienbien";
				if (xutri!="")	sql+=" and a.xutri=:xutri";
				if (userid!=-1) sql+=" and a.userid=:userid";
				if (dotuoi!="")
				{
					if (dotuoi.IndexOf(">")!=-1)
					{
						m_dotuoi=dotuoi.Substring(1);
						sql+=" and to_char(a.ngay,'yyyy')-t.namsinh>"+int.Parse(m_dotuoi);//sql+=" and to_char(sysdate,'yyyy')-t.namsinh>"+int.Parse(m_dotuoi);
					}
					else 
					{
						int i1=int.Parse(dotuoi.Substring(0,dotuoi.IndexOf("-")));
						int i2=int.Parse(dotuoi.Substring(dotuoi.IndexOf("-")+1));
						sql+=" and to_char(a.ngay,'yyyy')-t.namsinh between "+i1+" and "+i2;//sql+=" and to_char(sysdate,'yyyy')-t.namsinh between "+i1+" and "+i2;
					}
				}
				sql+=" order by a.ngay";
				con=new OracleConnection(sConn);
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				if (tu!="")
				{
					cmd.Parameters.Add("tu",OracleType.VarChar).Value=tu;
					cmd.Parameters.Add("den",OracleType.VarChar).Value=den;
				}
				if (mabn!="") cmd.Parameters.Add("mabn",OracleType.VarChar).Value=mabn;
				if (hoten!="") cmd.Parameters.Add("hoten",OracleType.NVarChar).Value=hoten;
				if (ngaysinh!="") cmd.Parameters.Add("ngaysinh",OracleType.VarChar).Value=ngaysinh;
				if (phai!=-1) cmd.Parameters.Add("phai",OracleType.Int16).Value=phai;
				if (thon!="") cmd.Parameters.Add("thon",OracleType.NVarChar).Value=thon;
				if (mann!="") cmd.Parameters.Add("mann",OracleType.VarChar).Value=mann;
				if (madantoc!="") cmd.Parameters.Add("madantoc",OracleType.VarChar).Value=madantoc;
				if (matt!="") cmd.Parameters.Add("matt",OracleType.VarChar).Value=matt;
				if (maqu!="") cmd.Parameters.Add("maqu",OracleType.VarChar).Value=maqu;
				if (maphuongxa!="")	cmd.Parameters.Add("maphuongxa",OracleType.VarChar).Value=maphuongxa;
				if (diadiem!="") cmd.Parameters.Add("diadiem",OracleType.VarChar).Value=diadiem;
				if (bophan!="") cmd.Parameters.Add("bophan",OracleType.VarChar).Value=bophan;
				if (nguyennhan!="")	cmd.Parameters.Add("nguyennhan",OracleType.VarChar).Value=nguyennhan;
				if (ngodoc!="")	cmd.Parameters.Add("ngodoc",OracleType.VarChar).Value=ngodoc;
				if (dienbien!="") cmd.Parameters.Add("dienbien",OracleType.VarChar).Value=dienbien;
				if (xutri!="")	cmd.Parameters.Add("xutri",OracleType.VarChar).Value=xutri;
				if (userid!=-1)	cmd.Parameters.Add("userid",OracleType.VarChar).Value=userid;
				//if (dotuoi!="")	cmd.Parameters.Add("m_dotuoi",OracleType.VarChar).Value=m_dotuoi;
				dest=new OracleDataAdapter(cmd);
				ds=new DataSet();
				dest.Fill(ds);
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim(),sComputer,"Tannantt");
			}
			return ds;
		}

		#endregion

		public bool Kiemtra_maicd(DataTable dt,string ma)
		{
			if (ma=="") return true;
			DataRow r=getrowbyid(dt,"cicd10='"+ma+"'");
			return r!=null;
		}

		public bool Kiemtra_tenbenh(DataTable dt,string ten)
		{
			if (ten=="" || !bChandoan_icd10) return true;
			DataRow r=getrowbyid(dt,"vviet='"+ten+"'");
			return r!=null;
		}

		public bool Kiemtra_mapt(DataTable dt,string ma)
		{
			if (ma=="") return true;
			DataRow r=getrowbyid(dt,"mapt='"+ma+"'");
			return r!=null;
		}

		public bool Kiemtra_tenpt(DataTable dt,string ten)
		{
			if (ten=="") return true;
			DataRow r=getrowbyid(dt,"noi_dung='"+ten+"'");
			return r!=null;
		}

		public bool Kiemtra_mann(string ma,int tuoi,int treem6,int treem15)
		{
			if (tuoi<treem6)
				sql="select * from btdnn_bv where mannbo='01'";
			else if (tuoi<treem15)
				sql="select * from btdnn_bv where mannbo in ('01','02')";
			else sql="select * from btdnn_bv where mannbo<>'01'";
			sql+=" and mann='"+ma+"'";
			ds=get_data(sql);
			return ds.Tables[0].Rows.Count!=0;
		}

		public bool Kiemtra_loaiba(int loaiba)
		{
			ds=get_data("select * from dmbenhan_bv where loaiba="+loaiba);
			return ds.Tables[0].Rows.Count!=0;
		}

		public long l_maql(string mabn)
		{
			ds=get_data("select maql from benhandt where mabn='"+mabn+"'"+" order by maql desc");
			if (ds.Tables[0].Rows.Count==0)
			{
				ds=get_data("select maql from tiepdon where mabn='"+mabn+"'"+" order by maql desc");
				if (ds.Tables[0].Rows.Count==0) return 0;
				else return long.Parse(ds.Tables[0].Rows[0][0].ToString());
			}
			else return long.Parse(ds.Tables[0].Rows[0][0].ToString());
		}

		public bool kiemtra_khamnhi(string ma)
		{
			ds=get_data("select makpbo from btdkp_bv where makp='"+ma+"'");
			if (ds.Tables[0].Rows.Count==0) return false;
			else return ds.Tables[0].Rows[0][0].ToString()=="17";
		}

		public decimal tienkham(bool m_nuocngoai,int m_mavp,int m_madoituong,string fie)
		{
			sql="select gia_th,gia_bh,gia_dv,gia_nn,gia_cs,vattu_th,vattu_bh,vattu_dv,vattu_nn,vattu_cs from v_giavp where id="+m_mavp;
			if(bDoituong_BHYT(m_madoituong))sql+=" and bhyt>0";//if(m_madoituong==1)sql+=" and bhyt>0";
			DataSet ds1=get_data(sql);
			if (ds1.Tables[0].Rows.Count>0)
			{
				decimal tygia=(fie.IndexOf("_nn")!=-1)?dTygia:1;
				return decimal.Parse(ds1.Tables[0].Rows[0][fie].ToString())*tygia;
			}
			return 0;
		}

		public long get_id_chidinh(string _mmyy,long m_maql,int m_mavp,int m_loai)
		{
			_mmyy=(_mmyy.Length==4)?_mmyy:mmyy(_mmyy);
			ds=get_data("select id from "+user+_mmyy+".v_chidinh where maql="+m_maql+" and mavp="+m_mavp+" and loai="+m_loai);
			if (ds.Tables[0].Rows.Count>0) return long.Parse(ds.Tables[0].Rows[0][0].ToString());
			else return 0;
		}

		public long get_id_vienphi(string mmyy,long m_maql,int m_mavp,int m_loaibn)
		{
			string xxx=user+mmyy;
			ds=get_data("select a.id from "+xxx+".v_vienphill a,"+xxx+".v_vienphict b where a.id=b.id and a.maql="+m_maql+" and b.mavp="+m_mavp+" and a.loaibn="+m_loaibn);
			if (ds.Tables[0].Rows.Count>0) return long.Parse(ds.Tables[0].Rows[0][0].ToString());
			else return 0;
		}

		public long get_id_vienphi(string mmyy,long m_maql,string m_ngay,int m_loaibn)
		{
			string xxx=user+mmyy;
			ds=get_data("select a.id from "+xxx+".v_vienphill a,"+xxx+".v_vienphict b where a.id=b.id and a.maql="+m_maql+" and to_char(a.ngay,'dd/mm/yyyy')='"+m_ngay.Substring(0,10)+"' and a.loaibn="+m_loaibn);
			if (ds.Tables[0].Rows.Count>0) return long.Parse(ds.Tables[0].Rows[0][0].ToString());
			else return 0;
		}

		public long get_id_tamung(string mmyy,long m_maql,string m_ngay,int m_loaibn)
		{
			ds=get_data("select id from "+user+mmyy+".v_tamung where maql="+m_maql+" and to_char(ngay,'dd/mm/yyyy')='"+m_ngay.Substring(0,10)+"' and loaibn="+m_loaibn);
			if (ds.Tables[0].Rows.Count>0) return long.Parse(ds.Tables[0].Rows[0][0].ToString());
			else return 0;
		}

		public int get_sobienlai(long m_id,int m_cong)
		{
			ds=get_data("select soghi from v_quyenso where id="+m_id);
			if (ds.Tables[0].Rows.Count==0) return 0;
			else return int.Parse(ds.Tables[0].Rows[0][0].ToString())+m_cong;
		}

		public void upd_sobienlai(long m_id,int m_sobienlai)
		{
			execute_data("update v_quyenso set soghi="+m_sobienlai+" where id="+m_id);
		}

		public bool kiemtra_bienlai(long m_id,int m_sobienlai)
		{
			ds=get_data("select * from v_quyenso where id="+m_id+" and "+m_sobienlai+" between tu and den");
			return ds.Tables[0].Rows.Count>0;
		}

		public void updrec (DataTable dt,long id,string sobienlai)
		{
			string exp="id="+id;
			DataRow[] dr = dt.Select(exp);
			if (dr.Length>0) dr[0]["soghi"] = sobienlai;
		}

		public string get_tenvp(int m_id)
		{
			ds=get_data("select ten from v_giavp where id="+m_id);
			if (ds.Tables[0].Rows.Count>0) return ds.Tables[0].Rows[0][0].ToString().Trim();
			else return "";
		}

		public long get_sokham(string m_ngay,string m_makp,int m_sokham)
		{
			if (!bMmyy(mmyy(m_ngay))) return 1;
			try
			{
				sql="select max(to_number(sovaovien)) from "+user+mmyy(m_ngay)+".tiepdon where to_char(ngay,'dd/mm/yyyy')='"+m_ngay+"'";
				if (m_sokham==2) sql+=" and makp='"+m_makp+"'";
				ds=get_data(sql);
				if (ds.Tables[0].Rows.Count==0) return 1;
				else
				{
					try
					{
						return long.Parse(ds.Tables[0].Rows[0][0].ToString())+1;
					}
					catch{return 1;}
				}
			}
			catch{return 1;}
		}
		public long get_idbankham(string m_ngay,string m_makp,int m_sokham)
		{
			if (!bMmyy(mmyy(m_ngay))) {return 0;}
			try
			{
				DataTable dtt1=new DataTable();
				dtt1=get_data("select id_bankham from "+user+mmyy(m_ngay)+".tiepdon where to_char(ngay,'dd/mm/yyyy')='"+m_ngay+"' and makp='"+m_makp+"' and sovaovien="+(m_sokham-1)).Tables[0];
				DataTable dtt2=new DataTable();
				dtt2=get_data("select * from dmbankham where makp='"+m_makp+"' order by id asc").Tables[0];
				bool bGiatri=false;
				long l_idbankham=0;//
				foreach(DataRow dr in dtt2.Rows)
				{
					if(m_sokham==1 || dtt1.Rows[0][0].ToString()=="0") {l_idbankham=long.Parse(dr["id"].ToString());break;}
					else 
					{
						if(bGiatri==true)
						{
							bGiatri=false;
							l_idbankham=long.Parse(dr["id"].ToString());
						}
						if(dr["id"].ToString()==dtt1.Rows[0][0].ToString())
						{
							bGiatri=true;
						}
						if(l_idbankham>0){break;}
					}
				}
				if(bGiatri==true){l_idbankham=long.Parse(dtt2.Rows[0]["id"].ToString());}
				return l_idbankham;
			}
			catch{return 0;}
		}

		public void updrec_chidinh(DataTable dt,long id,string ngay,string makp,string tenkp,int madoituong,string doituong,int mavp,string ten,string dvt,decimal soluong,decimal dongia,decimal vattu,int paid,int done,int tinhtrang,int thuchien,string ma)
		{
			string exp="id="+id;
			DataRow r = getrowbyid (dt,exp); 
			if ( r == null )
			{
				DataRow nrow = dt.NewRow ( ) ;
				nrow["id"] = id;
				nrow["ngay"] = ngay;
				nrow["makp"] = makp;
				nrow["tenkp"] = tenkp;
				nrow["madoituong"] = madoituong;
				nrow["doituong"] = doituong;
				nrow["mavp"] = mavp;
				nrow["ten"] = ten;
				nrow["dvt"] = dvt;
				nrow["soluong"] = soluong;
				nrow["dongia"] = dongia;
				nrow["vattu"] = vattu;
				nrow["paid"] = paid;
				nrow["done"] = done;
				nrow["tinhtrang"]=tinhtrang;
				nrow["thuchien"]=thuchien;
				nrow["ma"]=ma;
				dt.Rows.Add ( nrow ) ;
			}
			else
			{
				DataRow[] dr = dt.Select(exp);
				dr[0]["ngay"] = ngay;
				dr[0]["makp"] = makp;
				dr[0]["tenkp"] = tenkp;
				dr[0]["madoituong"] = madoituong;
				dr[0]["doituong"] = doituong;
				dr[0]["mavp"] = mavp;
				dr[0]["ten"] = ten;
				dr[0]["dvt"] = dvt;
				dr[0]["soluong"] = soluong;
				dr[0]["dongia"] = dongia;
				dr[0]["vattu"] = vattu;
				dr[0]["paid"] = paid;
				dr[0]["done"] = done;
				dr[0]["tinhtrang"]=tinhtrang;
				dr[0]["thuchien"]=thuchien;
				dr[0]["ma"]=ma;
			}
		}

		public void updrec_tamung(DataTable dt,long id,string ngay,string makp,string tenkp,int madoituong,string doituong,string ten,decimal sotien,int done)
		{
			string exp="id="+id;
			DataRow r = getrowbyid (dt,exp); 
			if ( r == null )
			{
				DataRow nrow = dt.NewRow ( ) ;
				nrow["id"] = id;
				nrow["ngay"] = ngay;
				nrow["makp"] = makp;
				nrow["tenkp"] = tenkp;
				nrow["madoituong"] = madoituong;
				nrow["doituong"] = doituong;
				nrow["ten"] = ten;
				nrow["sotien"] = sotien;
				nrow["done"] = done;
				dt.Rows.Add ( nrow ) ;
			}
			else
			{
				DataRow[] dr = dt.Select(exp);
				dr[0]["ngay"] = ngay;
				dr[0]["makp"] = makp;
				dr[0]["tenkp"] = tenkp;
				dr[0]["madoituong"] = madoituong;
				dr[0]["doituong"] = doituong;
				dr[0]["ten"] = ten;
				dr[0]["sotien"] = sotien;
				dr[0]["done"] = done;
			}
		}

		public void updrec_chidinh_bs(DataTable dt,long id,string ngay,string makp,string tenkp,int madoituong,string doituong,int mavp,
			string ten,string dvt,decimal soluong,decimal dongia,decimal vattu,int paid,int done,int tinhtrang,int thuchien,
			string ma,string mabs,string chandoan,int loaivp,string phong,string giuong,decimal lanthu,string ghichu,
			string hen,decimal cannang,decimal chieucao,string ketqua,string lydo)
		{
			string exp="id="+id;
			DataRow r = getrowbyid (dt,exp); 
			if ( r == null )
			{
				DataRow nrow = dt.NewRow ( ) ;
				nrow["id"] = id;
				nrow["ngay"] = ngay;
				nrow["makp"] = makp;
				nrow["tenkp"] = tenkp;
				nrow["madoituong"] = madoituong;
				nrow["doituong"] = doituong;
				nrow["mavp"] = mavp;
				nrow["ten"] = ten;
				nrow["dvt"] = dvt;
				nrow["soluong"] = soluong;
				nrow["dongia"] = dongia;
				nrow["vattu"] = vattu;
				nrow["paid"] = paid;
				nrow["done"] = done;
				nrow["tinhtrang"]=tinhtrang;
				nrow["thuchien"]=thuchien;
				nrow["ma"]=ma;
				nrow["mabs"]=mabs;
				nrow["chandoan"]=chandoan;
				nrow["loaivp"]=loaivp;
				nrow["phong"]=phong;
				nrow["giuong"]=giuong;
				nrow["lanthu"]=lanthu;
				nrow["ghichu"]=ghichu;
				nrow["hen"]=hen;
				nrow["cannang"]=cannang;
				nrow["chieucao"]=chieucao;
				nrow["ketqua"]=ketqua;
				nrow["lydo"]=lydo;
				dt.Rows.Add ( nrow ) ;
			}
			else
			{
				DataRow[] dr = dt.Select(exp);
				dr[0]["ngay"] = ngay;
				dr[0]["makp"] = makp;
				dr[0]["tenkp"] = tenkp;
				dr[0]["madoituong"] = madoituong;
				dr[0]["doituong"] = doituong;
				dr[0]["mavp"] = mavp;
				dr[0]["ten"] = ten;
				dr[0]["dvt"] = dvt;
				dr[0]["soluong"] = soluong;
				dr[0]["dongia"] = dongia;
				dr[0]["vattu"] = vattu;
				dr[0]["paid"] = paid;
				dr[0]["done"] = done;
				dr[0]["tinhtrang"]=tinhtrang;
				dr[0]["thuchien"]=thuchien;
				dr[0]["ma"]=ma;
				dr[0]["mabs"]=mabs;
				dr[0]["chandoan"]=chandoan;
				dr[0]["loaivp"]=loaivp;
				dr[0]["phong"]=phong;
				dr[0]["giuong"]=giuong;
				dr[0]["lanthu"]=lanthu;
				dr[0]["ghichu"]=ghichu;
				dr[0]["hen"]=hen;
				dr[0]["cannang"]=cannang;
				dr[0]["chieucao"]=chieucao;
				dr[0]["ketqua"]=ketqua;
				dr[0]["lydo"]=lydo;
			}
		}

		public void reprec (DataTable dt,string exp,int mavp,string ten,string dvt,decimal dongia,decimal vattu)
		{
			DataRow row = getrowbyid (dt,exp); 
			if ( row == null )
			{
				DataRow nrow = dt.NewRow ( ) ;
				nrow["mavp"] = mavp;
				nrow["ten"] = ten;
				nrow["dvt"] = dvt;
				nrow["dongia"] = dongia;
				nrow["vattu"]=vattu;
				dt.Rows.Add ( nrow ) ;
			}
			else
			{
				delrec(dt,exp);
			}
		}

		public void updrec_diung(DataTable dt,string mahc,string ten,int mucdo,string tenmucdo)
		{
			string exp="mahc='"+mahc+"'";
			DataRow r = getrowbyid (dt,exp); 
			if ( r == null )
			{
				DataRow nrow = dt.NewRow ( ) ;
				nrow["mahc"] = mahc;
				nrow["ten"] = ten;
				nrow["mucdo"] = mucdo;
				nrow["tenmucdo"] = tenmucdo;
				dt.Rows.Add ( nrow ) ;
			}
			else
			{
				DataRow[] dr = dt.Select(exp);
				dr[0]["ten"] = ten;
				dr[0]["mucdo"] = mucdo;
				dr[0]["tenmucdo"] = tenmucdo;
			}
		}

		public void updrec_toathuocll(DataTable dt,long id,string ngay,string makp,string mabs,string chandoan,string maicd,string ghichu)
		{
			string exp="id="+id;
			DataRow r = getrowbyid (dt,exp); 
			if ( r == null )
			{
				DataRow nrow = dt.NewRow ( ) ;
				nrow["id"] = id;
				nrow["ngay"] = ngay;
				nrow["makp"] = makp;
				nrow["mabs"] = mabs;
				nrow["chandoan"] = chandoan;
				nrow["maicd"] = maicd;
				nrow["ghichu"] = ghichu;
				dt.Rows.Add ( nrow ) ;
			}
			else
			{
				DataRow[] dr = dt.Select(exp);
				dr[0]["ngay"] = ngay;
				dr[0]["makp"] = makp;
				dr[0]["mabs"] = mabs;
				dr[0]["chandoan"] = chandoan;
				dr[0]["maicd"] = maicd;
				dr[0]["ghichu"] = ghichu;
			}
		}

		public void updrec_toathuocct(DataTable dt,long stt,long mabd,string ten,string dang,string tenhc,decimal soluong,string cachdung)
		{
			string exp="stt="+stt;
			DataRow r = getrowbyid (dt,exp); 
			if ( r == null )
			{
				DataRow nrow = dt.NewRow ( ) ;
				nrow["stt"] = stt;
				nrow["mabd"] = mabd;
				nrow["ten"] = ten;
				nrow["dang"] = dang;
				nrow["tenhc"] = tenhc;
				nrow["soluong"] = soluong;
				nrow["cachdung"] = cachdung;
				dt.Rows.Add ( nrow ) ;
			}
			else
			{
				DataRow[] dr = dt.Select(exp);
				dr[0]["mabd"] = mabd;
				dr[0]["ten"] = ten;
				dr[0]["dang"] = dang;
				dr[0]["tenhc"] = tenhc;
				dr[0]["soluong"] = soluong;
				dr[0]["cachdung"] = cachdung;
			}
		}

		public void updrec_toathuocct(DataTable dt,long stt,long mabd,string ten,string dang,string tenhc,decimal soluong,string cachdung, string duongdung)
		{
			string exp="stt="+stt;
			DataRow r = getrowbyid (dt,exp); 
			if ( r == null )
			{
				DataRow nrow = dt.NewRow ( ) ;
				nrow["stt"] = stt;
				nrow["mabd"] = mabd;
				nrow["ten"] = ten;
				nrow["dang"] = dang;
				nrow["tenhc"] = tenhc;
				nrow["soluong"] = soluong;
				nrow["cachdung"] = cachdung;
				nrow["duongdung"] = duongdung;
				dt.Rows.Add ( nrow ) ;
			}
			else
			{
				DataRow[] dr = dt.Select(exp);
				dr[0]["mabd"] = mabd;
				dr[0]["ten"] = ten;
				dr[0]["dang"] = dang;
				dr[0]["tenhc"] = tenhc;
				dr[0]["soluong"] = soluong;
				dr[0]["cachdung"] = cachdung;
				dr[0]["duongdung"] = duongdung;
			}
		}

		public void updrec_toathuocct(DataTable dt,long stt,long mabd,string ten,string dang,string tenhc,decimal soluong,string cachdung, string ghichu,decimal songay,  decimal c1,decimal c2,decimal c3,decimal c4, string duongdung)
		{
			string exp="stt="+stt;
			DataRow r = getrowbyid (dt,exp); 
			if ( r == null )
			{
				DataRow nrow = dt.NewRow ( ) ;
				nrow["stt"] = stt;
				nrow["mabd"] = mabd;
				nrow["ten"] = ten;
				nrow["dang"] = dang;
				nrow["tenhc"] = tenhc;
				nrow["soluong"] = soluong;
				nrow["cachdung"] = cachdung;
				nrow["ghichu"] = ghichu;
				nrow["songay"] = songay ;
				nrow["c1"] = c1;
				nrow["c2"] = c2;
				nrow["c3"] = c3;
				nrow["c4"] = c4;
				nrow["duongdung"] = duongdung;
				dt.Rows.Add ( nrow ) ;
			}
			else
			{
				DataRow[] dr = dt.Select(exp);
				dr[0]["mabd"] = mabd;
				dr[0]["ten"] = ten;
				dr[0]["dang"] = dang;
				dr[0]["tenhc"] = tenhc;
				dr[0]["soluong"] = soluong;
				dr[0]["cachdung"] = cachdung;

				dr[0]["ghichu"] = ghichu;
				dr[0]["songay"] = songay;
				dr[0]["c1"] = c1;
				dr[0]["c2"] = c2;
				dr[0]["c3"] = c3;
				dr[0]["c4"] = c4;
				dr[0]["duongdung"] = duongdung;
			}
		}
		public void updrec_vpkhoa(DataTable dt,string mabn,string hoten,long maql,long idkhoa)
		{
			string exp="idkhoa="+idkhoa;
			DataRow r = getrowbyid (dt,exp); 
			if ( r == null )
			{
				DataRow nrow = dt.NewRow ( ) ;
				nrow["mabn"] = mabn;
				nrow["hoten"] = hoten;
				nrow["maql"] = maql;
				nrow["idkhoa"] = idkhoa;
				dt.Rows.Add ( nrow ) ;
			}
			else
			{
				DataRow[] dr = dt.Select(exp);
				dr[0]["mabn"] = mabn;
				dr[0]["hoten"] = hoten;
				dr[0]["maql"] = maql;
				dr[0]["idkhoa"] = idkhoa;
			}
		}

		public string get_sothe(long m_maql)
		{
			ds=get_data("select sothe from bhyt where maql="+m_maql);
			if (ds.Tables[0].Rows.Count>0) return ds.Tables[0].Rows[0]["sothe"].ToString();
			else return "";
		}

		public string get_denngay(long m_maql)
		{
			ds=get_data("select to_char(denngay,'dd/mm/yyyy') denngay from bhyt where maql="+m_maql);
			if (ds.Tables[0].Rows.Count>0) return ds.Tables[0].Rows[0]["denngay"].ToString();
			else return "";
		}

		public bool upd_kyravien(int m_id,int m_stt,string m_chucvu,string m_hoten)
		{
			sql="update kyravien set stt=:m_stt,chucvu=:m_chucvu,hoten=:m_hoten where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
				cmd.Parameters.Add("m_chucvu",OracleType.NVarChar,50).Value=m_chucvu;
				cmd.Parameters.Add("m_hoten",OracleType.NVarChar,50).Value=m_hoten;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into kyravien (id,stt,chucvu,hoten) values (:m_id,:m_stt,:m_chucvu,:m_hoten)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
					cmd.Parameters.Add("m_chucvu",OracleType.NVarChar,50).Value=m_chucvu;
					cmd.Parameters.Add("m_hoten",OracleType.NVarChar,50).Value=m_hoten;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"kyravien");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_kyravien(int m_id,byte[] m_image)
		{
			sql="update kyravien set image=:m_image where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_image",OracleType.Blob,m_image.Length).Value=m_image;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.ExecuteNonQuery();
				cmd.Dispose();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"kyravien");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_giayravien(long m_maql,string m_dieutri,string m_loidan,int m_kyravien,int m_userid)
		{
			sql="update giayravien set lanin=lanin+1,dieutri=:m_dieutri,loidan=:m_loidan,kyravien=:m_kyravien,userid=:m_userid where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_dieutri",OracleType.NVarChar,254).Value=m_dieutri;
				cmd.Parameters.Add("m_loidan",OracleType.NVarChar,254).Value=m_loidan;
				cmd.Parameters.Add("m_kyravien",OracleType.Number).Value=m_kyravien;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into giayravien (maql,dieutri,loidan,kyravien,lanin,userid) values (:m_maql,:m_dieutri,:m_loidan,:m_kyravien,1,:m_userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_dieutri",OracleType.NVarChar,254).Value=m_dieutri;
					cmd.Parameters.Add("m_loidan",OracleType.NVarChar,254).Value=m_loidan;
					cmd.Parameters.Add("m_kyravien",OracleType.Number).Value=m_kyravien;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"giayravien");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_giayravien(long m_maql,string m_dieutri,string m_loidan,int m_kyravien,int m_userid,string m_benhly,
			int m_nhommau,string m_rh,string m_ngaytk,string m_taikham,string m_bskham,string m_chandoan)
		{
			sql="update giayravien set dieutri=:m_dieutri,loidan=:m_loidan,kyravien=:m_kyravien,";
			sql+="userid=:m_userid,benhly=:m_benhly,nhommau=:m_nhommau,rh=:m_rh,ngaytk=to_date(:m_ngaytk,'dd/mm/yyyy'),";
			sql+="taikham=:m_taikham,bskham=:m_bskham,chandoan=:m_chandoan where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_dieutri",OracleType.NVarChar,254).Value=m_dieutri;
				cmd.Parameters.Add("m_loidan",OracleType.NVarChar,254).Value=m_loidan;
				cmd.Parameters.Add("m_kyravien",OracleType.Number).Value=m_kyravien;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_benhly",OracleType.NVarChar,254).Value=m_benhly;
				cmd.Parameters.Add("m_nhommau",OracleType.Number).Value=m_nhommau;
				cmd.Parameters.Add("m_rh",OracleType.NVarChar,50).Value=m_rh;
				cmd.Parameters.Add("m_ngaytk",OracleType.VarChar,10).Value=m_ngaytk;
				cmd.Parameters.Add("m_taikham",OracleType.NVarChar,254).Value=m_taikham;
				cmd.Parameters.Add("m_bskham",OracleType.VarChar,4).Value=m_bskham;
				cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,254).Value=m_chandoan;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into giayravien (maql,dieutri,loidan,kyravien,lanin,userid,benhly,nhommau,rh,ngaytk,taikham,bskham,chandoan) values (:m_maql,:m_dieutri,:m_loidan,:m_kyravien,1,:m_userid,:m_benhly,:m_nhommau,:m_rh,to_date(:m_ngaytk,'dd/mm/yyyy'),:m_taikham,:m_bskham,:m_chandoan)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_dieutri",OracleType.NVarChar,254).Value=m_dieutri;
					cmd.Parameters.Add("m_loidan",OracleType.NVarChar,254).Value=m_loidan;
					cmd.Parameters.Add("m_kyravien",OracleType.Number).Value=m_kyravien;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					cmd.Parameters.Add("m_benhly",OracleType.NVarChar,254).Value=m_benhly;
					cmd.Parameters.Add("m_nhommau",OracleType.Number).Value=m_nhommau;
					cmd.Parameters.Add("m_rh",OracleType.NVarChar,50).Value=m_rh;
					cmd.Parameters.Add("m_ngaytk",OracleType.VarChar,10).Value=m_ngaytk;
					cmd.Parameters.Add("m_taikham",OracleType.NVarChar,254).Value=m_taikham;
					cmd.Parameters.Add("m_bskham",OracleType.VarChar,4).Value=m_bskham;
					cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,254).Value=m_chandoan;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"giayravien");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public void updrec_pttt_mau(DataTable dt,string ma,string mapt,string ten,string mabs,string makp,string noidung,int mavp,decimal ptv,decimal phu1,decimal phu2,decimal bsgayme,decimal ktvgayme,decimal hoisuc,decimal dungcu,string mapm,byte[] image1,byte[] image2)
		{
			string exp="ma='"+ma+"'";
			DataRow r = getrowbyid (dt,exp); 
			if ( r == null )
			{
				DataRow nrow = dt.NewRow ( ) ;
				nrow["ma"] = ma;
				nrow["mapt"]=mapt;
				nrow["ten"] =ten;
				nrow["mabs"]=mabs;
				nrow["makp"]=makp;
				nrow["mapm"]=mapm;
				nrow["noidung"]=noidung;
				nrow["mavp"]=mavp;
				nrow["ptv"]=ptv;
				nrow["phu1"]=phu1;
				nrow["phu2"]=phu2;
				nrow["bsgayme"]=bsgayme;
				nrow["ktvgayme"]=ktvgayme;
				nrow["hoisuc"]=hoisuc;
				nrow["dungcu"]=dungcu;
				nrow["image1"]=image1;
				nrow["image2"]=image2;
				dt.Rows.Add ( nrow ) ;
			}
			else
			{
				DataRow[] dr = dt.Select(exp);
				dr[0]["ma"] = ma;
				dr[0]["mapt"]=mapt;
				dr[0]["ten"] =ten;
				dr[0]["mabs"]=mabs;
				dr[0]["makp"]=makp;
				dr[0]["mapm"]=mapm;
				dr[0]["noidung"]=noidung;
				dr[0]["mavp"]=mavp;
				dr[0]["ptv"]=ptv;
				dr[0]["phu1"]=phu1;
				dr[0]["phu2"]=phu2;
				dr[0]["bsgayme"]=bsgayme;
				dr[0]["ktvgayme"]=ktvgayme;
				dr[0]["hoisuc"]=hoisuc;
				dr[0]["dungcu"]=dungcu;
				dr[0]["image1"]=image1;
				dr[0]["image2"]=image2;
			}
		}

		public void updrec_ravien(DataSet ds,int khu,string matt,string mabn,long maql,long idkhoa,string hoten,
			string namsinh,string phai,string diachi,int madoituong,string doituong,string sothe,decimal maphu,
			string tungay,string denngay,string noigioithieu,string noicap,string giuong,string makp,string tenkp,
			string ngayvao,string ngayra,string chandoan,string maicd,int sttnhom,string nhom,
			int sttloai,string loai,int ma,string ten,string dvt,decimal soluong,decimal sotien,decimal bhyt,
			decimal tamung,decimal bhytt0107,string nguoinha,int hinhthuc,int phuongphap,int ketqua,
			string soluutru,decimal dongia,string ngaypt,string tenpt,int loaiba,int done,string mabs,string tenbs,
			string tenuser,string image,string ghichu,string ngay1,string ngay2,string ngay3,
			string ngay,int kythuat,string sobienlaitamung,long idttrv,string kyhieu,string sobienlai,
			int traituyen,decimal giamua,decimal giaban, decimal giachenhlech)
		{
			string exp="khu="+khu+" and matt='"+matt+"' and makp='"+makp+"' and mabn='"+mabn+"' and madoituong="+madoituong+" and ma="+ma+" and dongia="+ Math.Round(dongia,2);
			if(ngay!="")exp+=" and ngay='"+ngay+"'";
			exp+=" and giachenhlech="+Math.Round(giachenhlech,2);
			exp+=" and idttrv="+idttrv+" and sothe='"+sothe+"'";
			if(ma==0) exp+=" and sttnhom="+sttnhom;
			DataRow r = getrowbyid (ds.Tables[0],exp); 
			if ( r == null )
			{
				DataRow r1 = ds.Tables[0].NewRow();
				r1["khu"]=khu;
				r1["matt"]=matt;
				r1["mabn"]=mabn;
				r1["maql"]=maql;
				r1["idkhoa"]=idkhoa;
				r1["hoten"]=hoten;
				r1["namsinh"]=namsinh;
				r1["phai"]=phai;
				r1["diachi"]=diachi;
				r1["madoituong"]=madoituong;
				r1["doituong"]=doituong;
				r1["sothe"]=sothe;
				r1["maphu"]=maphu;
				r1["tungay"]=tungay;
				r1["denngay"]=denngay;
				r1["noigioithieu"]=noigioithieu;
				r1["noicap"]=noicap;
				r1["giuong"]=giuong;
				r1["makp"]=makp;
				r1["tenkp"]=tenkp;
				r1["ngayvao"]=ngayvao;
				r1["ngayra"]=ngayra;
				r1["chandoan"]=chandoan;
				r1["maicd"]=maicd;
				r1["sttnhom"]=sttnhom;
				r1["nhom"]=nhom;
				r1["sttloai"]=sttloai;
				r1["loai"]=loai;
				r1["ma"]=ma;
				r1["ten"]=ten;
				r1["dvt"]=dvt;
				r1["soluong"]=soluong;
				r1["dongia"]=Math.Round(dongia,2);//dongia;
				r1["sotien"]=sotien;
				r1["bhyt"]=bhyt;
				r1["bhytt0107"]=bhytt0107;
				r1["tamung"]=tamung;
				r1["sbltamung"]=sobienlaitamung;
				r1["tcsotien"]=0;
				r1["dichso"]="";
				r1["bhyttra"]=0;
				r1["mien"]=0;
				r1["bntra"]=0;
				r1["dichsotra"]="";
				r1["nguoinha"]=nguoinha;
				r1["hinhthuc"]=hinhthuc;
				r1["phuongphap"]=phuongphap;
				r1["ketqua"]=ketqua;
				r1["soluutru"]=soluutru;
				r1["ngaypt"]=ngaypt;
				r1["tenpt"]=tenpt;
				r1["loaiba"]=loaiba;
				r1["done"]=done;
				r1["sophieu"]=0;
				r1["lanin"]=0;
				r1["mabs"]=mabs;
				r1["tenbs"]=tenbs;
				r1["tenuser"]=tenuser;
				r1["ghichu"]=ghichu;
				r1["ngay1"]=ngay1;
				r1["ngay2"]=ngay2;
				r1["ngay3"]=ngay3;
				r1["ngay"]=ngay;
				if (ngay!="") r1["yyyymmdd"]=ngay.Substring(6,4)+ngay.Substring(3,2)+ngay.Substring(0,2);
				if (image!="") r1["image"]=image;
				r1["kythuat"]=kythuat;
				r1["idttrv"]=idttrv;
				r1["kyhieu"]=kyhieu;
				r1["sobienlai"]=sobienlai;
				r1["traituyen"]=traituyen;				
				r1["gia_th"]=r1["gia_bh"]=r1["gia_dv"]=r1["gia_cs"]=r1["gia_nn"]=0;
				if (giamua!=0) r1["gia_th"]=giamua;
				if (giaban!=0) r1["gia_dv"]=giaban;
				r1["giachenhlech"]=Math.Round( giachenhlech,0);
				ds.Tables[0].Rows.Add(r1);
			}
			else
			{
				DataRow[] dr = ds.Tables[0].Select(exp);
				if (dr.Length>0)
				{
					dr[0]["soluong"]=decimal.Parse(dr[0]["soluong"].ToString())+soluong;
					dr[0]["sotien"]=decimal.Parse(dr[0]["sotien"].ToString())+sotien;
					dr[0]["bhyt"]=decimal.Parse(dr[0]["bhyt"].ToString())+bhyt;
					dr[0]["bhytt0107"]=decimal.Parse(dr[0]["bhytt0107"].ToString())+bhytt0107;
				}
			}
		}
		public void updrec_ravien(DataSet ds,int khu,string matt,string mabn,long maql,long idkhoa,string hoten,
			string namsinh,string phai,string diachi,int madoituong,string doituong,string sothe,decimal maphu,
			string tungay,string denngay,string noigioithieu,string noicap,string giuong,string makp,string tenkp,
			string ngayvao,string ngayra,string chandoan,string maicd,int sttnhom,string nhom,
			int sttloai,string loai,int ma,string ten,string dvt,decimal soluong,decimal sotien,decimal bhyt,
			decimal tamung,decimal bhytt0107,string nguoinha,int hinhthuc,int phuongphap,int ketqua,
			string soluutru,decimal dongia,string ngaypt,string tenpt,int loaiba,int done,string mabs,string tenbs,
			string tenuser,string image,string ghichu,string ngay1,string ngay2,string ngay3,
			string ngay,int kythuat,string sobienlaitamung,long idttrv,string kyhieu,string sobienlai,
			int traituyen,decimal giamua,decimal giaban, decimal giachenhlech, decimal idchidinh,decimal id_ktcao, int vuottran,string ngayvv,string ngayrv)
		{
			
			//ds.WriteXml("xx.xml",XmlWriteMode.WriteSchema);
			string exp="khu="+khu+" and matt='"+matt+"' and makp='"+makp+"' and mabn='"+mabn+"' and madoituong="+madoituong+" and ma="+ma+" and dongia="+ Math.Round(dongia,2);
			if(ngay!="")exp+=" and ngay='"+ngay+"'";
			exp+=" and giachenhlech="+Math.Round(giachenhlech,2);
			exp+=" and idttrv="+idttrv+" and sothe='"+sothe+"' and id_ktcao="+id_ktcao;
			if(ma==0) exp+=" and sttnhom="+sttnhom;
			DataRow r = getrowbyid (ds.Tables[0],exp); 
			if ( r == null )
			{
				DataRow r1 = ds.Tables[0].NewRow();
				r1["khu"]=khu;
				r1["matt"]=matt;
				r1["mabn"]=mabn;
				r1["maql"]=maql;
				r1["idkhoa"]=idkhoa;
				r1["hoten"]=hoten;
				r1["namsinh"]=namsinh;
				r1["phai"]=phai;
				r1["diachi"]=diachi;
				r1["madoituong"]=madoituong;
				r1["doituong"]=doituong;
				r1["sothe"]=sothe;
				r1["maphu"]=maphu;
				r1["tungay"]=tungay;
				r1["denngay"]=denngay;
				r1["noigioithieu"]=noigioithieu;
				r1["noicap"]=noicap;
				r1["giuong"]=giuong;
				r1["makp"]=makp;
				r1["tenkp"]=tenkp;
				r1["ngayvao"]=ngayvao;
				r1["ngayra"]=ngayra;
				r1["chandoan"]=chandoan;
				r1["maicd"]=maicd;
				r1["sttnhom"]=sttnhom;
				r1["nhom"]=nhom;
				r1["sttloai"]=sttloai;
				r1["loai"]=loai;
				r1["ma"]=ma;
				r1["ten"]=ten;
				r1["dvt"]=dvt;
				r1["soluong"]=soluong;
				r1["dongia"]=Math.Round(dongia,2);//dongia;
				r1["sotien"]=sotien;
				r1["bhyt"]=bhyt;
				r1["bhytt0107"]=bhytt0107;
				r1["tamung"]=tamung;
				r1["sbltamung"]=sobienlaitamung;
				r1["tcsotien"]=0;
				r1["dichso"]="";
				r1["bhyttra"]=0;
				r1["mien"]=0;
				r1["bntra"]=0;
				r1["dichsotra"]="";
				r1["nguoinha"]=nguoinha;
				r1["hinhthuc"]=hinhthuc;
				r1["phuongphap"]=phuongphap;
				r1["ketqua"]=ketqua;
				r1["soluutru"]=soluutru;
				r1["ngaypt"]=ngaypt;
				r1["tenpt"]=tenpt;
				r1["loaiba"]=loaiba;
				r1["done"]=done;
				r1["sophieu"]=0;
				r1["lanin"]=0;
				r1["mabs"]=mabs;
				r1["tenbs"]=tenbs;
				r1["tenuser"]=tenuser;
				r1["ghichu"]=ghichu;
				r1["ngay1"]=ngay1;
				r1["ngay2"]=ngay2;
				r1["ngay3"]=ngay3;
				r1["ngay"]=ngay;
				if (ngay!="") r1["yyyymmdd"]=ngay.Substring(6,4)+ngay.Substring(3,2)+ngay.Substring(0,2);
				if (image!="") r1["image"]=image;
				r1["kythuat"]=kythuat;
				r1["idttrv"]=idttrv;
				r1["kyhieu"]=kyhieu;
				r1["sobienlai"]=sobienlai;
				r1["traituyen"]=traituyen;				
				r1["gia_th"]=r1["gia_bh"]=r1["gia_dv"]=r1["gia_cs"]=r1["gia_nn"]=0;
				if (giamua!=0) r1["gia_th"]=giamua;
				if (giaban!=0) r1["gia_dv"]=giaban;
				r1["giachenhlech"]=Math.Round( giachenhlech,0);
				try
				{
					r1["id"]=idchidinh;
					r1["id_ktcao"]=id_ktcao;
				}
				catch{}
				try
				{
					r1["vuottran"]=vuottran;
				}
				catch{}
				try
				{
					r1["ngayvv"]=ngayvv;
					r1["ngayrv"]=ngayrv;
				}
				catch{}
				ds.Tables[0].Rows.Add(r1);
			}
			else
			{
				DataRow[] dr = ds.Tables[0].Select(exp);
				if (dr.Length>0)
				{
					dr[0]["soluong"]=decimal.Parse(dr[0]["soluong"].ToString())+soluong;
					dr[0]["sotien"]=decimal.Parse(dr[0]["sotien"].ToString())+sotien;
					dr[0]["bhyt"]=decimal.Parse(dr[0]["bhyt"].ToString())+bhyt;
					dr[0]["bhytt0107"]=decimal.Parse(dr[0]["bhytt0107"].ToString())+bhytt0107;
				}
			}
		}


		public void updrec_ravien(DataSet ds,int khu,string matt,string mabn,long maql,long idkhoa,string hoten,
			string namsinh,string phai,string diachi,int madoituong,string doituong,string sothe,decimal maphu,
			string tungay,string denngay,string noigioithieu,string noicap,string giuong,string makp,string tenkp,
			string ngayvao,string ngayra,string chandoan,string maicd,int sttnhom,string nhom,
			int sttloai,string loai,int ma,string ten,string dvt,decimal soluong,decimal sotien,decimal bhyt,
			decimal tamung,decimal bhytt0107,string nguoinha,int hinhthuc,int phuongphap,int ketqua,
			string soluutru,decimal dongia,string ngaypt,string tenpt,int loaiba,int done,string mabs,string tenbs,
			string tenuser,string image,string ghichu,string ngay1,string ngay2,string ngay3,
			string ngay,int kythuat,string sobienlaitamung,int traituyen, decimal giachenhlech,decimal id_ktcao,decimal idchidinh)
		{
			string exp="khu="+khu+" and matt='"+matt+"' and makp='"+makp+"' and mabn='"+mabn+"' and madoituong="+madoituong+" and ma="+ma+" and dongia="+Math.Round( dongia,2)+" and ngay='"+ngay+"'";
			if(ma==0) exp+=" and sttnhom="+sttnhom;
			exp+=" and giachenhlech="+Math.Round(giachenhlech,2);
			DataRow r = getrowbyid (ds.Tables[0],exp); 
			if ( r == null )
			{
				DataRow r1 = ds.Tables[0].NewRow();
				r1["khu"]=khu;
				r1["matt"]=matt;
				r1["mabn"]=mabn;
				r1["maql"]=maql;
				r1["idkhoa"]=idkhoa;
				r1["hoten"]=hoten;
				r1["namsinh"]=namsinh;
				r1["phai"]=phai;
				r1["diachi"]=diachi;
				r1["madoituong"]=madoituong;
				r1["doituong"]=doituong;
				r1["sothe"]=sothe;
				r1["maphu"]=maphu;
				r1["tungay"]=tungay;
				r1["denngay"]=denngay;
				r1["noigioithieu"]=noigioithieu;
				r1["noicap"]=noicap;
				r1["giuong"]=giuong;
				r1["makp"]=makp;
				r1["tenkp"]=tenkp;
				r1["ngayvao"]=ngayvao;
				r1["ngayra"]=ngayra;
				r1["chandoan"]=chandoan;
				r1["maicd"]=maicd;
				r1["sttnhom"]=sttnhom;
				r1["nhom"]=nhom;
				r1["sttloai"]=sttloai;
				r1["loai"]=loai;
				r1["ma"]=ma;
				r1["ten"]=ten;
				r1["dvt"]=dvt;
				r1["soluong"]=soluong;
				r1["dongia"]=Math.Round(dongia,2);//dongia;
				r1["sotien"]=sotien;
				r1["bhyt"]=bhyt;
				r1["bhytt0107"]=bhytt0107;
				r1["tamung"]=tamung;
				r1["sbltamung"]=sobienlaitamung;
				r1["tcsotien"]=0;
				r1["dichso"]="";
				r1["bhyttra"]=0;
				r1["mien"]=0;
				r1["bntra"]=0;
				r1["dichsotra"]="";
				r1["nguoinha"]=nguoinha;
				r1["hinhthuc"]=hinhthuc;
				r1["phuongphap"]=phuongphap;
				r1["ketqua"]=ketqua;
				r1["soluutru"]=soluutru;
				r1["ngaypt"]=ngaypt;
				r1["tenpt"]=tenpt;
				r1["loaiba"]=loaiba;
				r1["done"]=done;
				r1["sophieu"]=0;
				r1["lanin"]=0;
				r1["mabs"]=mabs;
				r1["tenbs"]=tenbs;
				r1["tenuser"]=tenuser;
				try{r1["tlchitra"]=tenuser;} 
				catch {}//ThanhCuong-05072011
				r1["ghichu"]=ghichu;
				r1["ngay1"]=ngay1;
				r1["ngay2"]=ngay2;
				r1["ngay3"]=ngay3;
				r1["ngay"]=ngay;
				if (ngay!="") r1["yyyymmdd"]=ngay.Substring(6,4)+ngay.Substring(3,2)+ngay.Substring(0,2);
				if (image!="") r1["image"]=image;
				r1["kythuat"]=kythuat;
				r1["traituyen"]=traituyen;
				r1["giachenhlech"]=Math.Round( giachenhlech,0);
				try
				{
					r1["id_ktcao"]=id_ktcao;
					r1["idchidinh"]=idchidinh;
				}
				catch{}
				ds.Tables[0].Rows.Add(r1);
			}
			else
			{
				DataRow[] dr = ds.Tables[0].Select(exp);
				if (dr.Length>0)
				{
					dr[0]["soluong"]=decimal.Parse(dr[0]["soluong"].ToString())+soluong;
					dr[0]["sotien"]=decimal.Parse(dr[0]["sotien"].ToString())+sotien;
					dr[0]["bhyt"]=decimal.Parse(dr[0]["bhyt"].ToString())+bhyt;
					dr[0]["bhytt0107"]=decimal.Parse(dr[0]["bhytt0107"].ToString())+bhytt0107;
				}
			}
		}


		public void updrec_ravien(DataSet ds,int khu,string matt,string mabn,long maql,long idkhoa,string hoten,
			string namsinh,string phai,string diachi,int madoituong,string doituong,string sothe,decimal maphu,
			string tungay,string denngay,string noigioithieu,string noicap,string giuong,string makp,string tenkp,
			string ngayvao,string ngayra,string chandoan,string maicd,int sttnhom,string nhom,
			int sttloai,string loai,int ma,string ten,string dvt,decimal soluong,decimal sotien,decimal bhyt,
			decimal tamung,decimal bhytt0107,string nguoinha,int hinhthuc,int phuongphap,int ketqua,
			string soluutru,decimal dongia,string ngaypt,string tenpt,int loaiba,int done,string mabs,string tenbs,
			string tenuser,string image,string ghichu,string ngay1,string ngay2,string ngay3,
			string ngay,int kythuat,string sobienlaitamung,int traituyen, decimal giachenhlech,decimal id_ktcao,decimal idchidinh,decimal sttt)
		{
			string exp="khu="+khu+" and matt='"+matt+"' and makp='"+makp+"' and mabn='"+mabn+"' and madoituong="+madoituong+" and ma="+ma+" and dongia="+Math.Round( dongia,2)+" and ngay='"+ngay+"'";
			if(ma==0) exp+=" and sttnhom="+sttnhom;
			exp+=" and giachenhlech="+Math.Round(giachenhlech,2);
			DataRow r = getrowbyid (ds.Tables[0],exp); 
			if ( r == null )
			{
				DataRow r1 = ds.Tables[0].NewRow();
				r1["khu"]=khu;
				r1["matt"]=matt;
				r1["mabn"]=mabn;
				r1["maql"]=maql;
				r1["idkhoa"]=idkhoa;
				r1["hoten"]=hoten;
				r1["namsinh"]=namsinh;
				r1["phai"]=phai;
				r1["diachi"]=diachi;
				r1["madoituong"]=madoituong;
				r1["doituong"]=doituong;
				r1["sothe"]=sothe;
				r1["maphu"]=maphu;
				r1["tungay"]=tungay;
				r1["denngay"]=denngay;
				r1["noigioithieu"]=noigioithieu;
				r1["noicap"]=noicap;
				r1["giuong"]=giuong;
				r1["makp"]=makp;
				r1["tenkp"]=tenkp;
				r1["ngayvao"]=ngayvao;
				r1["ngayra"]=ngayra;
				r1["chandoan"]=chandoan;
				r1["maicd"]=maicd;
				r1["sttnhom"]=sttnhom;
				r1["nhom"]=nhom;
				r1["sttloai"]=sttloai;
				r1["loai"]=loai;
				r1["ma"]=ma;
				r1["ten"]=ten;
				r1["dvt"]=dvt;
				r1["soluong"]=soluong;
				r1["dongia"]=Math.Round(dongia,2);//dongia;
				r1["sotien"]=sotien;
				r1["bhyt"]=bhyt;
				r1["bhytt0107"]=bhytt0107;
				r1["tamung"]=tamung;
				r1["sbltamung"]=sobienlaitamung;
				r1["tcsotien"]=0;
				r1["dichso"]="";
				r1["bhyttra"]=0;
				r1["mien"]=0;
				r1["bntra"]=0;
				r1["dichsotra"]="";
				r1["nguoinha"]=nguoinha;
				r1["hinhthuc"]=hinhthuc;
				r1["phuongphap"]=phuongphap;
				r1["ketqua"]=ketqua;
				r1["soluutru"]=soluutru;
				r1["ngaypt"]=ngaypt;
				r1["tenpt"]=tenpt;
				r1["loaiba"]=loaiba;
				r1["done"]=done;
				r1["sophieu"]=0;
				r1["lanin"]=0;
				r1["mabs"]=mabs;
				r1["tenbs"]=tenbs;
				r1["tenuser"]=tenuser;
				try{r1["tlchitra"]=tenuser;} 
				catch {}//ThanhCuong-05072011
				r1["ghichu"]=ghichu;
				r1["ngay1"]=ngay1;
				r1["ngay2"]=ngay2;
				r1["ngay3"]=ngay3;
				r1["ngay"]=ngay;
				if (ngay!="") r1["yyyymmdd"]=ngay.Substring(6,4)+ngay.Substring(3,2)+ngay.Substring(0,2);
				if (image!="") r1["image"]=image;
				r1["kythuat"]=kythuat;
				r1["traituyen"]=traituyen;
				r1["giachenhlech"]=Math.Round( giachenhlech,0);
				try
				{
					r1["id_ktcao"]=id_ktcao;
					r1["idchidinh"]=idchidinh;
				}
				catch{}
				try
				{
					r1["sttt"]=sttt;
				}
				catch{}
				ds.Tables[0].Rows.Add(r1);
			}
			else
			{
				DataRow[] dr = ds.Tables[0].Select(exp);
				if (dr.Length>0)
				{
					dr[0]["soluong"]=decimal.Parse(dr[0]["soluong"].ToString())+soluong;
					dr[0]["sotien"]=decimal.Parse(dr[0]["sotien"].ToString())+sotien;
					dr[0]["bhyt"]=decimal.Parse(dr[0]["bhyt"].ToString())+bhyt;
					dr[0]["bhytt0107"]=decimal.Parse(dr[0]["bhytt0107"].ToString())+bhytt0107;
				}
			}
		}


		public void updrec_ravien(DataSet ds,int khu,string matt,string mabn,long maql,long idkhoa,string hoten,
			string namsinh,string phai,string diachi,int madoituong,string doituong,string sothe,decimal maphu,
			string tungay,string denngay,string noigioithieu,string noicap,string giuong,string makp,string tenkp,
			string ngayvao,string ngayra,string chandoan,string maicd,int sttnhom,string nhom,
			int sttloai,string loai,int ma,string ten,string dvt,decimal soluong,decimal sotien,decimal bhyt,
			decimal tamung,decimal bhytt0107,string nguoinha,int hinhthuc,int phuongphap,int ketqua,
			string soluutru,decimal dongia,string ngaypt,string tenpt,int loaiba,int done,string mabs,string tenbs,
			string tenuser,string image,string ghichu,string ngay1,string ngay2,string ngay3,
			string ngay,int kythuat,string sobienlaitamung,int traituyen, decimal giachenhlech)
		{
			string exp="khu="+khu+" and matt='"+matt+"' and makp='"+makp+"' and mabn='"+mabn+"' and madoituong="+madoituong+" and ma="+ma+" and dongia="+Math.Round( dongia,2)+" and ngay='"+ngay+"'";
			if(ma==0) exp+=" and sttnhom="+sttnhom;
			exp+=" and giachenhlech="+Math.Round(giachenhlech,2);
			DataRow r = getrowbyid (ds.Tables[0],exp); 
			if ( r == null )
			{
				DataRow r1 = ds.Tables[0].NewRow();
				r1["khu"]=khu;
				r1["matt"]=matt;
				r1["mabn"]=mabn;
				r1["maql"]=maql;
				r1["idkhoa"]=idkhoa;
				r1["hoten"]=hoten;
				r1["namsinh"]=namsinh;
				r1["phai"]=phai;
				r1["diachi"]=diachi;
				r1["madoituong"]=madoituong;
				r1["doituong"]=doituong;
				r1["sothe"]=sothe;
				r1["maphu"]=maphu;
				r1["tungay"]=tungay;
				r1["denngay"]=denngay;
				r1["noigioithieu"]=noigioithieu;
				r1["noicap"]=noicap;
				r1["giuong"]=giuong;
				r1["makp"]=makp;
				r1["tenkp"]=tenkp;
				r1["ngayvao"]=ngayvao;
				r1["ngayra"]=ngayra;
				r1["chandoan"]=chandoan;
				r1["maicd"]=maicd;
				r1["sttnhom"]=sttnhom;
				r1["nhom"]=nhom;
				r1["sttloai"]=sttloai;
				r1["loai"]=loai;
				r1["ma"]=ma;
				r1["ten"]=ten;
				r1["dvt"]=dvt;
				r1["soluong"]=soluong;
				r1["dongia"]=Math.Round(dongia,2);//dongia;
				r1["sotien"]=sotien;
				r1["bhyt"]=bhyt;
				r1["bhytt0107"]=bhytt0107;
				r1["tamung"]=tamung;
				r1["sbltamung"]=sobienlaitamung;
				r1["tcsotien"]=0;
				r1["dichso"]="";
				r1["bhyttra"]=0;
				r1["mien"]=0;
				r1["bntra"]=0;
				r1["dichsotra"]="";
				r1["nguoinha"]=nguoinha;
				r1["hinhthuc"]=hinhthuc;
				r1["phuongphap"]=phuongphap;
				r1["ketqua"]=ketqua;
				r1["soluutru"]=soluutru;
				r1["ngaypt"]=ngaypt;
				r1["tenpt"]=tenpt;
				r1["loaiba"]=loaiba;
				r1["done"]=done;
				r1["sophieu"]=0;
				r1["lanin"]=0;
				r1["mabs"]=mabs;
				r1["tenbs"]=tenbs;
				r1["tenuser"]=tenuser;
				try{r1["tlchitra"]=tenuser;} 
				catch {}//ThanhCuong-05072011
				r1["ghichu"]=ghichu;
				r1["ngay1"]=ngay1;
				r1["ngay2"]=ngay2;
				r1["ngay3"]=ngay3;
				r1["ngay"]=ngay;
				if (ngay!="") r1["yyyymmdd"]=ngay.Substring(6,4)+ngay.Substring(3,2)+ngay.Substring(0,2);
				if (image!="") r1["image"]=image;
				r1["kythuat"]=kythuat;
				r1["traituyen"]=traituyen;
				r1["giachenhlech"]=Math.Round( giachenhlech,0);
				ds.Tables[0].Rows.Add(r1);
			}
			else
			{
				DataRow[] dr = ds.Tables[0].Select(exp);
				if (dr.Length>0)
				{
					dr[0]["soluong"]=decimal.Parse(dr[0]["soluong"].ToString())+soluong;
					dr[0]["sotien"]=decimal.Parse(dr[0]["sotien"].ToString())+sotien;
					dr[0]["bhyt"]=decimal.Parse(dr[0]["bhyt"].ToString())+bhyt;
					dr[0]["bhytt0107"]=decimal.Parse(dr[0]["bhytt0107"].ToString())+bhytt0107;
				}
			}
		}

		public void updrec_ravien(DataSet ds,int khu,string matt,string mabn,long maql,long idkhoa,string hoten,
			string namsinh,string phai,string diachi,int madoituong,string doituong,string sothe,decimal maphu,
			string tungay,string denngay,string noigioithieu,string noicap,string giuong,string makp,string tenkp,
			string ngayvao,string ngayra,string chandoan,string maicd,int sttnhom,string nhom,
			int sttloai,string loai,int ma,string ten,string dvt,decimal soluong,decimal sotien,decimal bhyt,
			decimal tamung,decimal bhytt0107,string nguoinha,int hinhthuc,int phuongphap,int ketqua,
			string soluutru,decimal dongia,string ngaypt,string tenpt,int loaiba,int done,string mabs,string tenbs,
			string tenuser,string image,string ghichu,string ngay1,string ngay2,string ngay3,
			string ngay,int kythuat,string sobienlaitamung,int traituyen, decimal giachenhlech,int nhantu)
		{
			string exp="khu="+khu+" and matt='"+matt+"' and makp='"+makp+"' and mabn='"+mabn+"' and madoituong="+madoituong+" and ma="+ma+" and dongia="+Math.Round( dongia,2)+" and ngay='"+ngay+"'";
			if(ma==0) exp+=" and sttnhom="+sttnhom;
			exp+=" and giachenhlech="+Math.Round(giachenhlech,2);
			DataRow r = getrowbyid (ds.Tables[0],exp); 
			if ( r == null )
			{
				DataRow r1 = ds.Tables[0].NewRow();
				r1["khu"]=khu;
				r1["matt"]=matt;
				r1["mabn"]=mabn;
				r1["maql"]=maql;
				r1["idkhoa"]=idkhoa;
				r1["hoten"]=hoten;
				r1["namsinh"]=namsinh;
				r1["phai"]=phai;
				r1["diachi"]=diachi;
				r1["madoituong"]=madoituong;
				r1["doituong"]=doituong;
				r1["sothe"]=sothe;
				r1["maphu"]=maphu;
				r1["tungay"]=tungay;
				r1["denngay"]=denngay;
				r1["noigioithieu"]=noigioithieu;
				r1["noicap"]=noicap;
				r1["giuong"]=giuong;
				r1["makp"]=makp;
				r1["tenkp"]=tenkp;
				r1["ngayvao"]=ngayvao;
				r1["ngayra"]=ngayra;
				r1["chandoan"]=chandoan;
				r1["maicd"]=maicd;
				r1["sttnhom"]=sttnhom;
				r1["nhom"]=nhom;
				r1["sttloai"]=sttloai;
				r1["loai"]=loai;
				r1["ma"]=ma;
				r1["ten"]=ten;
				r1["dvt"]=dvt;
				r1["soluong"]=soluong;
				r1["dongia"]=Math.Round(dongia,2);//dongia;
				r1["sotien"]=sotien;
				r1["bhyt"]=bhyt;
				r1["bhytt0107"]=bhytt0107;
				r1["tamung"]=tamung;
				r1["sbltamung"]=sobienlaitamung;
				r1["tcsotien"]=0;
				r1["dichso"]="";
				r1["bhyttra"]=0;
				r1["mien"]=0;
				r1["bntra"]=0;
				r1["dichsotra"]="";
				r1["nguoinha"]=nguoinha;
				r1["hinhthuc"]=hinhthuc;
				r1["phuongphap"]=phuongphap;
				r1["ketqua"]=ketqua;
				r1["soluutru"]=soluutru;
				r1["ngaypt"]=ngaypt;
				r1["tenpt"]=tenpt;
				r1["loaiba"]=loaiba;
				r1["done"]=done;
				r1["sophieu"]=0;
				r1["lanin"]=0;
				r1["mabs"]=mabs;
				r1["tenbs"]=tenbs;
				r1["tenuser"]=tenuser;
				try{r1["tlchitra"]=tenuser;} 
				catch {}//ThanhCuong-05072011
				r1["ghichu"]=ghichu;
				r1["ngay1"]=ngay1;
				r1["ngay2"]=ngay2;
				r1["ngay3"]=ngay3;
				r1["ngay"]=ngay;
				if (ngay!="") r1["yyyymmdd"]=ngay.Substring(6,4)+ngay.Substring(3,2)+ngay.Substring(0,2);
				if (image!="") r1["image"]=image;
				r1["kythuat"]=kythuat;
				r1["traituyen"]=traituyen;
				r1["giachenhlech"]=Math.Round( giachenhlech,0);
				r1["nhantu"]=nhantu;
				ds.Tables[0].Rows.Add(r1);
			}
			else
			{
				DataRow[] dr = ds.Tables[0].Select(exp);
				if (dr.Length>0)
				{
					dr[0]["soluong"]=decimal.Parse(dr[0]["soluong"].ToString())+soluong;
					dr[0]["sotien"]=decimal.Parse(dr[0]["sotien"].ToString())+sotien;
					dr[0]["bhyt"]=decimal.Parse(dr[0]["bhyt"].ToString())+bhyt;
					dr[0]["bhytt0107"]=decimal.Parse(dr[0]["bhytt0107"].ToString())+bhytt0107;
				}
			}
		}

		public void updrec_ravien(DataSet ds,string mabn,long maql,long idkhoa,string hoten,string namsinh,string phai,string diachi,int madoituong,string doituong,string sothe,
			string tungay,string denngay,string noigioithieu,string noicap,string giuong,string makp,string tenkp,string ngayvao,string ngayra,string chandoan,string maicd,string nguoinha,
			int hinhthuc,int phuongphap,int ketqua,string soluutru,string mabs,string tenbs,string tenuser,bool b1khu,string ngay1,string ngay2,string ngay3,int traituyen)
		{
			DataRow r1 = ds.Tables[0].NewRow();
			r1["mabn"]=mabn;
			r1["maql"]=maql;
			r1["idkhoa"]=idkhoa;
			r1["hoten"]=hoten;
			r1["namsinh"]=namsinh;
			r1["phai"]=phai;
			r1["diachi"]=diachi;
			r1["madoituong"]=madoituong;
			r1["doituong"]=doituong;
			r1["sothe"]=sothe;
			r1["tungay"]=tungay;
			r1["denngay"]=denngay;
			r1["noigioithieu"]=noigioithieu;
			r1["noicap"]=noicap;
			r1["giuong"]=giuong;
			r1["makp"]=makp;
			r1["tenkp"]=tenkp;
			r1["ngayvao"]=ngayvao;
			r1["ngayra"]=ngayra;
			r1["chandoan"]=chandoan;
			r1["maicd"]=maicd;
			r1["nguoinha"]=nguoinha;
			r1["hinhthuc"]=hinhthuc;
			r1["phuongphap"]=phuongphap;
			r1["ketqua"]=ketqua;
			r1["soluutru"]=soluutru;
			r1["mabs"]=mabs;
			r1["tenbs"]=tenbs;
			r1["tenuser"]=tenuser;
			r1["motkhu"]=(b1khu)?1:0;
			r1["ngay1"]=ngay1;
			r1["ngay2"]=ngay2;
			r1["ngay3"]=ngay3;
			r1["traituyen"]=traituyen;
			ds.Tables[0].Rows.Add (r1) ;
		}

		public string get_noicap(long maql)
		{
			ds=get_data("select b.tenbv from bhyt a,dmnoicapbhyt b where a.mabv=b.mabv and a.maql="+maql);
			if (ds.Tables[0].Rows.Count>0) return ds.Tables[0].Rows[0]["tenbv"].ToString();
			else return "";
		}

		public string get_noigioithieu(long maql)
		{
			ds=get_data("select b.tenbv from noigioithieu a,dstt b where a.mabv=b.mabv and a.maql="+maql);
			if (ds.Tables[0].Rows.Count>0) return ds.Tables[0].Rows[0]["tenbv"].ToString();
			else return "";
		}
		public string get_noigioithieu(long maql,string s_mmyy)
		{
			string _sql="select b.tenbv from "+user+s_mmyy+".noigioithieu a,dstt b where a.mabv=b.mabv and a.maql="+maql;
			_sql+=" union all select b.tenbv from noigioithieu a,dstt b where a.mabv=b.mabv and a.maql="+maql;
			ds=get_data(_sql);
			if (ds.Tables[0].Rows.Count>0) return ds.Tables[0].Rows[0]["tenbv"].ToString();
			else return "";
		}

		public string get_manoicap(long maql)
		{
			ds=get_data("select mabv from bhyt where maql="+maql);
			if (ds.Tables[0].Rows.Count>0) return ds.Tables[0].Rows[0]["mabv"].ToString();
			else return "";
		}

		public string get_manoigioithieu(long maql)
		{
			ds=get_data("select mabv from noigioithieu where maql="+maql);
			if (ds.Tables[0].Rows.Count>0) return ds.Tables[0].Rows[0]["mabv"].ToString();
			else return "";
		}

		public string get_doituong(int khu,string mabn,long maql,long idkhoa,string tu,string den,string makp,DataTable dtkp,int done,bool bVienphi_phongluu,int loaiba,string sothe)
		{			
			string ret="",usr=userid;
			int i_makp=0,be=0;
			DataRow r1;
			DateTime dt1=StringToDate(tu).AddDays(-iNgaykiemke);
			DateTime dt2=StringToDate(den).AddDays(iNgaykiemke);
			int y1=dt1.Year,m1=dt1.Month;
			int y2=dt2.Year,m2=dt2.Month;
			int itu,iden;
			string mmyy="",xxx,xxxd;
			bool bndot=bThanhtoan_ndot || loaiba==2;
			bool bCapve=bCapve_noitru,bNgtr=bBHYTngtr_noitru;
			DataSet dsdt=new DataSet();
			long maql_phongluu=(bVienphi_phongluu)?get_maql_phongluu(maql):0;
			for(int i=y1;i<=y2;i++)
			{
				itu=(i==y1)?m1:1;
				iden=(i==y2)?m2:12;
				for(int j=itu;j<=iden;j++)
				{
					mmyy=j.ToString().PadLeft(2,'0')+i.ToString().Substring(2,2);
					xxxd=user+"d"+mmyy;
					xxx=user+mmyy;
					if (dbMmyy(mmyy))
					{
						r1=getrowbyid(dtkp,"makp='"+makp+"'");
						if (r1!=null) i_makp=int.Parse(r1["id"].ToString());
						sql="select distinct a.madoituong from "+xxxd+".d_tienthuoc a,"+usr+".d_duockp b,"+usr+".btdkp_bv c,"+usr+".doituong d";
						sql+=" where a.makp=b.id and b.makp=c.makp(+) and a.madoituong=d.madoituong and d.khongin=0 and a.mabn='"+mabn+"'";
						if (maql!=0 && loaiba!=2) sql+=" and a.maql="+maql;
						if (bndot) sql+=" and to_date(a.ngay,'dd/mm/yy') between to_date('"+tu.Substring(0,10)+"','dd/mm/yy') and to_date('"+den.Substring(0,10)+"','dd/mm/yy')";
						if (i_makp!=0) sql+=" and a.makp="+i_makp;
						//if (done!=2) sql+=" and a.done="+done;
						if (done == 0 || done == 2) sql += " and (a.done=0 and a.idttrv=0)";
						else if (done == 1) sql += " and a.done=" + done;
						if (khu!=0) sql+=" and c.khu="+khu;
						if (be==0) dsdt=get_data(sql);
						else dsdt.Merge(get_data(sql));
						be++;
						if (maql_phongluu!=0)
						{
							sql="select distinct a.madoituong from "+xxxd+".d_tienthuoc a,"+usr+".d_duockp b,"+usr+".btdkp_bv c,"+usr+".doituong d";
							sql+=" where a.makp=b.id and b.makp=c.makp(+) and a.madoituong=d.madoituong and d.khongin=0 and a.mabn='"+mabn+"'";
							sql+=" and a.maql="+maql_phongluu;
							//if (done!=2) sql+=" and a.done="+done;
							if (done == 0 || done == 2) sql += " and (a.done=0 and a.idttrv=0)";
							else if (done == 1) sql += " and a.done=" + done;
							//if (khu!=0) sql+=" and c.khu="+khu;
							dsdt.Merge(get_data(sql));
						}
						if (bCapve || loaiba==2)
						{
							sql="select distinct b.madoituong from "+xxxd+".bhytkb a,"+xxxd+".bhytthuoc b,"+usr+".btdkp_bv c,"+usr+".doituong d";
							sql+=" where a.id=b.id and a.makp=c.makp(+) and b.madoituong=d.madoituong and d.khongin=0 and a.mabn='"+mabn+"'";
							if (maql!=0 && loaiba!=2) sql+=" and a.maql="+maql;
							sql+=" and to_date(a.ngay,'dd/mm/yy') between to_date('"+tu.Substring(0,10)+"','dd/mm/yy') and to_date('"+den.Substring(0,10)+"','dd/mm/yy')";
							if (khu!=0) sql+=" and c.khu="+khu;
							dsdt.Merge(get_data(sql));
						}
						if (bNgtr && loaiba!=2)
						{
							sql="select distinct a.maphu as madoituong from "+xxxd+".bhytkb a,"+usr+".btdkp_bv c,"+usr+".doituong d";
							sql+=" where a.makp=c.makp(+) and a.maphu=d.madoituong and d.khongin=0 and a.mabn='"+mabn+"'";
							sql+=" and a.maphu in ("+sMaDoituong_BHYT().Trim(',')+")";//sql+=" and a.maphu =1";
							sql+=" and to_date(a.ngay,'dd/mm/yy') between to_date('"+tu.Substring(0,10)+"','dd/mm/yy') and to_date('"+tu.Substring(0,10)+"','dd/mm/yy')";
							if (khu!=0) sql+=" and c.khu="+khu;
							dsdt.Merge(get_data(sql));
						}
					}
					if (bMmyy(mmyy))
					{
						r1=getrowbyid(dtkp,"makp='"+makp+"'");
						if (r1!=null) i_makp=int.Parse(r1["id"].ToString());
						sql="select distinct a.madoituong from "+xxx+".v_vpkhoa a,"+usr+".btdkp_bv c,"+usr+".doituong d";
						sql+=" where a.makp=c.makp(+) and a.madoituong=d.madoituong and d.khongin=0 and a.mabn='"+mabn+"'";
						if (maql!=0 && loaiba!=2) sql+=" and a.maql="+maql;
						if (bndot) sql+=" and to_date(a.ngay,'dd/mm/yy') between to_date('"+tu.Substring(0,10)+"','dd/mm/yy') and to_date('"+den.Substring(0,10)+"','dd/mm/yy')";
						if (makp!="") sql+=" and a.makp='"+makp+"'";
						//if (done!=2) sql+=" and a.done="+done;
						if (done == 0 || done == 2) sql += " and (a.done=0 and a.idttrv=0)";
						else if (done == 1) sql += " and a.done=" + done;
						if (khu!=0) sql+=" and c.khu="+khu;
						if (be==0) dsdt=get_data(sql);
						else 
						{
							try
							{
								dsdt.Merge(get_data(sql));
							}
							catch{}
						}
						be++;
						if (bCapve || done == 2)
						{
							sql="select distinct a.madoituong from "+xxx+".v_chidinh a,"+usr+".btdkp_bv c,"+usr+".doituong d";
							sql+=" where a.makp=c.makp(+) and a.madoituong=d.madoituong and d.khongin=0 and a.mabn='"+mabn+"'";
							//if (done!=2) sql+=" and a.paid="+done;
							if (done == 0 || done == 2) sql += " and (a.paid=0 or a.idttrv=0)";
							else if (done == 1) sql += " and a.paid=" + done;
							sql+=" and a.mabn='"+mabn+"' and a.maql<>"+maql;
							sql+=" and to_date(a.ngay,'dd/mm/yy') between to_date('"+tu.Substring(0,10)+"','dd/mm/yy') and to_date('"+den.Substring(0,10)+"','dd/mm/yy')";
							if (be==0) dsdt=get_data(sql);
							else 
							{
								try
								{
									dsdt.Merge(get_data(sql));
								}
								catch{}
							}
						}
						if (bChidinh_vienphi)
						{
							sql="select distinct a.madoituong from "+xxx+".v_chidinh a,"+usr+".btdkp_bv c,"+usr+".doituong d";
							sql+=" where a.makp=c.makp(+) and a.madoituong=d.madoituong and d.khongin=0 and a.mabn='"+mabn+"'";
							//if (done!=2) sql+=" and a.paid="+done;
							if (done == 0 || done == 2) sql += " and (a.paid=0 or a.idttrv=0)";
							else if (done == 1) sql += " and a.paid=" + done;
							if (maql!=0 && loaiba!=2) sql+=" and a.maql="+maql;
							if (bndot) sql+=" and to_date(a.ngay,'dd/mm/yy') between to_date('"+tu.Substring(0,10)+"','dd/mm/yy') and to_date('"+den.Substring(0,10)+"','dd/mm/yy')";
							if (makp!="") sql+=" and a.makp='"+makp+"'";
							if (khu!=0) sql+=" and c.khu="+khu;
							if (be==0) dsdt=get_data(sql);
							else 
							{
								try
								{
									dsdt.Merge(get_data(sql));
								}
								catch{}
							}
						}
						if (maql_phongluu!=0)
						{
							sql="select distinct a.madoituong from "+xxx+".v_vpkhoa a,"+usr+".btdkp_bv c,"+usr+".doituong d";
							sql+=" where a.makp=c.makp(+) and a.madoituong=d.madoituong and d.khongin=0 and a.mabn='"+mabn+"'";
							sql+=" and a.maql="+maql_phongluu;
							if (done == 0 || done == 2) sql += " and (a.done=0 and a.idttrv=0)";
							else if (done == 1) sql += " and a.done=" + done;
							//if (done!=2) sql+=" and a.done="+done;
							//if (khu!=0) sql+=" and c.khu="+khu;
							dsdt.Merge(get_data(sql));
							if (bChidinh_vienphi)
							{
								sql="select distinct a.madoituong from "+xxx+".v_chidinh a,"+usr+".btdkp_bv c,"+usr+".doituong d";
								sql+=" where a.makp=c.makp(+) and a.madoituong=d.madoituong and d.khongin=0 and a.mabn='"+mabn+"'";
								//if (done!=2) sql+=" and a.paid="+done;
								if (done == 0 || done == 2) sql += " and (a.paid=0 and a.idttrv=0)";
								else if (done == 1) sql += " and a.paid=" + done;
								sql+=" and a.maql="+maql_phongluu;
								//if (khu!=0) sql+=" and c.khu="+khu;
								dsdt.Merge(get_data(sql));
							}
						}
						//tam ung
						sql="select distinct a.madoituong from "+xxx+".v_tamung a where mabn='"+mabn+"' and maql in("+maql+","+maql_phongluu+")";
						if (done == 0 || done == 2) sql += " and (a.done=0)";
						else if (done == 1) sql += " and a.done=" + done;
						try
						{
							dsdt.Merge(get_data(sql));
						}
						catch{}
					}
				}
			}
			int tunguyen=iTunguyen;
			int nhom_khac=Nhom_khac;
			long tien_khac=Tienkhac;
			if (dsdt.Tables[0].Rows.Count>0)
			{
				foreach(DataRow r in dsdt.Tables[0].Rows) if (r["madoituong"].ToString().Trim()!="") ret+=r["madoituong"].ToString().Trim()+",";
				if (bChenhlech && bDoituong_co_chenhlech(ret.Trim().Trim(',')) && ret.IndexOf(tunguyen.ToString()+",")==-1) ret+=tunguyen.ToString()+",";
			}
			if (tien_khac!=0 && nhom_khac!=0)
			{
				if (ret.IndexOf("2,")==-1) ret+="2,";
			}
			int maphu=(sothe.ToString().Trim()!="")?get_maphu_noitru(sothe.ToString(),nhom_duoc,den.Substring(0,10)):0;
			if (maphu!=0) 
			{
				if (ret.IndexOf(tunguyen.ToString()+",")==-1) ret+=tunguyen.ToString()+",";
			}		
			if (loaiba==1 && done==2)
			{
				if (bPhonggiuong && bGiuong_block)
				{
					sql="select a.mabn,a.id,a.makp,a.idkhoa,to_char(a.tu,'dd/mm/yyyy hh24:mi') as tu,a.dongia,a.idgiuong,a.madoituong,c.dichvu";
					sql+=" from theodoigiuong a,dmgiuong b,dmphong c where a.idgiuong=b.id and b.idphong=c.id ";
					sql+=" and maql="+maql;
					sql+=" and a.soluong=0";
					foreach(DataRow r in get_data(sql).Tables[0].Rows)
						if (ret.IndexOf(r["madoituong"].ToString()+",")==-1) ret+=r["madoituong"].ToString()+",";
				}
			}
			string sHaophi=iHaophi.ToString();
			try
			{
				if(dTienAn>0 && (sothe.Substring(0,2).ToString()=="CN" || sothe.Substring(0,2).ToString()=="HN") && ret.IndexOf("1,")==-1) {ret+="1,";}
			}
			catch{}
			if (bCapve && ret.IndexOf("2,")==-1) {ret+="2,";}
			return (bHaophi_thanhtoan)?ret+""+sHaophi+",":ret.Replace(sHaophi+",","");
		}

		public bool upd_ttkhamthai(string m_mabn,long m_maql,string m_para,string m_kinhcc,string m_ngaysanh,string m_dacdiem)
		{
			sql="update ttkhamthai set para=:m_para";
			if (m_kinhcc!="") sql+=",kinhcc=:m_kinhcc";
			if (m_ngaysanh!="") sql+=",ngaysanh=:m_ngaysanh";
			sql+=",dacdiem=:m_dacdiem where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_para",OracleType.VarChar,8).Value=m_para;
				if (m_kinhcc!="") cmd.Parameters.Add("m_kinhcc",OracleType.DateTime).Value=StringToDateTime(m_kinhcc);
				if (m_ngaysanh!="")	cmd.Parameters.Add("m_ngaysanh",OracleType.DateTime).Value=StringToDateTime(m_ngaysanh);
				cmd.Parameters.Add("m_dacdiem",OracleType.NVarChar,254).Value=m_dacdiem;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into ttkhamthai(mabn,maql,para,";
					if (m_kinhcc!="") sql+="kinhcc,";
					if (m_ngaysanh!="") sql+="ngaysanh,";
					sql+="dacdiem)";
					sql+=" values (:m_mabn,:m_maql,:m_para,";
					if (m_kinhcc!="") sql+=":m_kinhcc,";
					if (m_ngaysanh!="") sql+=":m_ngaysanh,";
					sql+=":m_dacdiem)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_para",OracleType.VarChar,8).Value=m_para;
					if (m_kinhcc!="") cmd.Parameters.Add("m_kinhcc",OracleType.DateTime).Value=StringToDateTime(m_kinhcc);
					if (m_ngaysanh!="")	cmd.Parameters.Add("m_ngaysanh",OracleType.DateTime).Value=StringToDateTime(m_ngaysanh);
					cmd.Parameters.Add("m_dacdiem",OracleType.NVarChar,254).Value=m_dacdiem;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ttkhamthai "+m_maql.ToString());
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ddsosinh(string m_mabn,long m_maql,int m_apgar1,int m_apgar5,int m_apgar10,int m_cannang,int m_cao,int m_vongdau,string m_manv1,string m_manv2,int m_conthu,string m_hoten,int m_duthang,int m_thang,int m_tuan,string m_ditatbs,string m_mass,int m_cachthucde,string m_xuly)
		{
			sql="update ddsosinh set mabn=:m_mabn,apgar1=:m_apgar1,apgar5=:m_apgar5,";
			sql+="apgar10=:m_apgar10,cannang=:m_cannang,";
			sql+="cao=:m_cao,vongdau=:m_vongdau,manv1=:m_manv1,manv2=:m_manv2,";
			sql+="conthu=:m_conthu,hoten=:m_hoten,duthang=:m_duthang,thang=:m_thang,";
			sql+="tuan=:m_tuan,ditatbs=:m_ditatbs,mass=:m_mass,cachthucde=:m_cachthucde,xuly=:m_xuly where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
				cmd.Parameters.Add("m_apgar1",OracleType.Number).Value=m_apgar1;
				cmd.Parameters.Add("m_apgar5",OracleType.Number).Value=m_apgar5;
				cmd.Parameters.Add("m_apgar10",OracleType.Number).Value=m_apgar10;
				cmd.Parameters.Add("m_cannang",OracleType.Number).Value=m_cannang;
				cmd.Parameters.Add("m_cao",OracleType.Number).Value=m_cao;
				cmd.Parameters.Add("m_vongdau",OracleType.Number).Value=m_vongdau;
				cmd.Parameters.Add("m_manv1",OracleType.VarChar,4).Value=m_manv1;
				cmd.Parameters.Add("m_manv2",OracleType.VarChar,4).Value=m_manv2;
				cmd.Parameters.Add("m_conthu",OracleType.Number).Value=m_conthu;
				cmd.Parameters.Add("m_hoten",OracleType.NVarChar,50).Value=m_hoten;
				cmd.Parameters.Add("m_duthang",OracleType.Number).Value=m_duthang;
				cmd.Parameters.Add("m_thang",OracleType.Number).Value=m_thang;
				cmd.Parameters.Add("m_tuan",OracleType.Number).Value=m_tuan;
				cmd.Parameters.Add("m_ditatbs",OracleType.VarChar,10).Value=m_ditatbs;
				cmd.Parameters.Add("m_mass",OracleType.VarChar,8).Value=m_mass;
				cmd.Parameters.Add("m_cachthucde",OracleType.Number).Value=m_cachthucde;
				cmd.Parameters.Add("m_xuly",OracleType.NVarChar,254).Value=m_xuly;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into ddsosinh(mabn,maql,apgar1,apgar5,apgar10,cannang,cao,vongdau,manv1,manv2,conthu,hoten,duthang,thang,tuan,ditatbs,mass,cachthucde,xuly) values ";
					sql+="(:m_mabn,:m_maql,:m_apgar1,:m_apgar5,:m_apgar10,:m_cannang,:m_cao,:m_vongdau,:m_manv1,:m_manv2,:m_conthu,:m_hoten,:m_duthang,:m_thang,:m_tuan,:m_ditatbs,:m_mass,:m_cachthucde,:m_xuly)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_apgar1",OracleType.Number).Value=m_apgar1;
					cmd.Parameters.Add("m_apgar5",OracleType.Number).Value=m_apgar5;
					cmd.Parameters.Add("m_apgar10",OracleType.Number).Value=m_apgar10;
					cmd.Parameters.Add("m_cannang",OracleType.Number).Value=m_cannang;
					cmd.Parameters.Add("m_cao",OracleType.Number).Value=m_cao;
					cmd.Parameters.Add("m_vongdau",OracleType.Number).Value=m_vongdau;
					cmd.Parameters.Add("m_manv1",OracleType.VarChar,4).Value=m_manv1;
					cmd.Parameters.Add("m_manv2",OracleType.VarChar,4).Value=m_manv2;
					cmd.Parameters.Add("m_conthu",OracleType.Number).Value=m_conthu;
					cmd.Parameters.Add("m_hoten",OracleType.NVarChar,50).Value=m_hoten;
					cmd.Parameters.Add("m_duthang",OracleType.Number).Value=m_duthang;
					cmd.Parameters.Add("m_thang",OracleType.Number).Value=m_thang;
					cmd.Parameters.Add("m_tuan",OracleType.Number).Value=m_tuan;
					cmd.Parameters.Add("m_ditatbs",OracleType.VarChar,10).Value=m_ditatbs;
					cmd.Parameters.Add("m_mass",OracleType.VarChar,8).Value=m_mass;
					cmd.Parameters.Add("m_cachthucde",OracleType.Number).Value=m_cachthucde;
					cmd.Parameters.Add("m_xuly",OracleType.NVarChar,254).Value=m_xuly;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ddsosinh");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ddsosinh(string m_mabn,long m_maql,int m_apgar1,int m_apgar5,int m_apgar10,int m_cannang,int m_cao,int m_vongdau,string m_manv1,string m_manv2,int m_conthu,string m_hoten,int m_duthang,int m_thang,int m_tuan,string m_ditatbs,string m_mass,int m_cachthucde,string m_xuly,int m_sochungsinh,string m_quyenso,int m_lansinh,int m_soconsong,string m_suckhoe)
		{
			sql="update ddsosinh set mabn=:m_mabn,apgar1=:m_apgar1,apgar5=:m_apgar5,";
			sql+="apgar10=:m_apgar10,cannang=:m_cannang,";
			sql+="cao=:m_cao,vongdau=:m_vongdau,manv1=:m_manv1,manv2=:m_manv2,";
			sql+="conthu=:m_conthu,hoten=:m_hoten,duthang=:m_duthang,thang=:m_thang,";
			sql+="tuan=:m_tuan,ditatbs=:m_ditatbs,mass=:m_mass,cachthucde=:m_cachthucde,xuly=:m_xuly,sochungsinh=:m_sochungsinh,quyensochungsinh=:m_quyenso,lansinh=:m_lansinh,soconsong=:m_soconsong,suckhoe=:m_suckhoe where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
				cmd.Parameters.Add("m_apgar1",OracleType.Number).Value=m_apgar1;
				cmd.Parameters.Add("m_apgar5",OracleType.Number).Value=m_apgar5;
				cmd.Parameters.Add("m_apgar10",OracleType.Number).Value=m_apgar10;
				cmd.Parameters.Add("m_cannang",OracleType.Number).Value=m_cannang;
				cmd.Parameters.Add("m_cao",OracleType.Number).Value=m_cao;
				cmd.Parameters.Add("m_vongdau",OracleType.Number).Value=m_vongdau;
				cmd.Parameters.Add("m_manv1",OracleType.VarChar,4).Value=m_manv1;
				cmd.Parameters.Add("m_manv2",OracleType.VarChar,4).Value=m_manv2;
				cmd.Parameters.Add("m_conthu",OracleType.Number).Value=m_conthu;
				cmd.Parameters.Add("m_hoten",OracleType.NVarChar,50).Value=m_hoten;
				cmd.Parameters.Add("m_duthang",OracleType.Number).Value=m_duthang;
				cmd.Parameters.Add("m_thang",OracleType.Number).Value=m_thang;
				cmd.Parameters.Add("m_tuan",OracleType.Number).Value=m_tuan;
				cmd.Parameters.Add("m_ditatbs",OracleType.VarChar,10).Value=m_ditatbs;
				cmd.Parameters.Add("m_mass",OracleType.VarChar,8).Value=m_mass;
				cmd.Parameters.Add("m_cachthucde",OracleType.Number).Value=m_cachthucde;
				cmd.Parameters.Add("m_xuly",OracleType.NVarChar,254).Value=m_xuly;
				cmd.Parameters.Add("m_sochungsinh",OracleType.Number).Value=m_sochungsinh;
				cmd.Parameters.Add("m_quyenso",OracleType.NVarChar,254).Value=m_quyenso;
				cmd.Parameters.Add("m_lansinh",OracleType.Number).Value=m_lansinh;
				cmd.Parameters.Add("m_soconsong",OracleType.Number).Value=m_soconsong;
				cmd.Parameters.Add("m_suckhoe",OracleType.NVarChar,254).Value=m_suckhoe;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into ddsosinh(mabn,maql,apgar1,apgar5,apgar10,cannang,cao,vongdau,manv1,manv2,conthu,hoten,duthang,thang,tuan,ditatbs,mass,cachthucde,xuly,sochungsinh,quyensochungsinh,lansinh,soconsong,suckhoe) values ";
					sql+="(:m_mabn,:m_maql,:m_apgar1,:m_apgar5,:m_apgar10,:m_cannang,:m_cao,:m_vongdau,:m_manv1,:m_manv2,:m_conthu,:m_hoten,:m_duthang,:m_thang,:m_tuan,:m_ditatbs,:m_mass,:m_cachthucde,:m_xuly,:m_sochungsinh,:m_quyenso,:m_lansinh,:m_soconsong,:m_suckhoe)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_apgar1",OracleType.Number).Value=m_apgar1;
					cmd.Parameters.Add("m_apgar5",OracleType.Number).Value=m_apgar5;
					cmd.Parameters.Add("m_apgar10",OracleType.Number).Value=m_apgar10;
					cmd.Parameters.Add("m_cannang",OracleType.Number).Value=m_cannang;
					cmd.Parameters.Add("m_cao",OracleType.Number).Value=m_cao;
					cmd.Parameters.Add("m_vongdau",OracleType.Number).Value=m_vongdau;
					cmd.Parameters.Add("m_manv1",OracleType.VarChar,4).Value=m_manv1;
					cmd.Parameters.Add("m_manv2",OracleType.VarChar,4).Value=m_manv2;
					cmd.Parameters.Add("m_conthu",OracleType.Number).Value=m_conthu;
					cmd.Parameters.Add("m_hoten",OracleType.NVarChar,50).Value=m_hoten;
					cmd.Parameters.Add("m_duthang",OracleType.Number).Value=m_duthang;
					cmd.Parameters.Add("m_thang",OracleType.Number).Value=m_thang;
					cmd.Parameters.Add("m_tuan",OracleType.Number).Value=m_tuan;
					cmd.Parameters.Add("m_ditatbs",OracleType.VarChar,10).Value=m_ditatbs;
					cmd.Parameters.Add("m_mass",OracleType.VarChar,8).Value=m_mass;
					cmd.Parameters.Add("m_cachthucde",OracleType.Number).Value=m_cachthucde;
					cmd.Parameters.Add("m_xuly",OracleType.NVarChar,254).Value=m_xuly;
					cmd.Parameters.Add("m_sochungsinh",OracleType.Number).Value=m_sochungsinh;
					cmd.Parameters.Add("m_quyenso",OracleType.NVarChar,254).Value=m_quyenso;
					cmd.Parameters.Add("m_lansinh",OracleType.Number).Value=m_lansinh;
					cmd.Parameters.Add("m_soconsong",OracleType.Number).Value=m_soconsong;
					cmd.Parameters.Add("m_suckhoe",OracleType.NVarChar,254).Value=m_suckhoe;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ddsosinh");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ddsosinh(string m_mabn,long m_maql,int m_apgar1,int m_apgar5,int m_apgar10,int m_cannang,int m_cao,int m_vongdau,string m_manv1,string m_manv2,int m_conthu,string m_hoten,int m_duthang,int m_thang,int m_tuan,string m_ditatbs,string m_mass,int m_cachthucde,string m_xuly,string m_kieuthe,decimal m_mach,string m_huyetap,decimal m_nhietdo,decimal m_nhiptho)
		{
			sql="update ddsosinh set mabn=:m_mabn,apgar1=:m_apgar1,apgar5=:m_apgar5,";
			sql+="apgar10=:m_apgar10,cannang=:m_cannang,";
			sql+="cao=:m_cao,vongdau=:m_vongdau,manv1=:m_manv1,manv2=:m_manv2,";
			sql+="conthu=:m_conthu,hoten=:m_hoten,duthang=:m_duthang,thang=:m_thang,";
			sql+="tuan=:m_tuan,ditatbs=:m_ditatbs,mass=:m_mass,cachthucde=:m_cachthucde,xuly=:m_xuly,";
			sql+="kieuthe=:m_kieuthe,mach=:m_mach,huyetap=:m_huyetap,nhietdo=:m_nhietdo,nhiptho=:m_nhiptho";
			sql+=" where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
				cmd.Parameters.Add("m_apgar1",OracleType.Number).Value=m_apgar1;
				cmd.Parameters.Add("m_apgar5",OracleType.Number).Value=m_apgar5;
				cmd.Parameters.Add("m_apgar10",OracleType.Number).Value=m_apgar10;
				cmd.Parameters.Add("m_cannang",OracleType.Number).Value=m_cannang;
				cmd.Parameters.Add("m_cao",OracleType.Number).Value=m_cao;
				cmd.Parameters.Add("m_vongdau",OracleType.Number).Value=m_vongdau;
				cmd.Parameters.Add("m_manv1",OracleType.VarChar,4).Value=m_manv1;
				cmd.Parameters.Add("m_manv2",OracleType.VarChar,4).Value=m_manv2;
				cmd.Parameters.Add("m_conthu",OracleType.Number).Value=m_conthu;
				cmd.Parameters.Add("m_hoten",OracleType.NVarChar,50).Value=m_hoten;
				cmd.Parameters.Add("m_duthang",OracleType.Number).Value=m_duthang;
				cmd.Parameters.Add("m_thang",OracleType.Number).Value=m_thang;
				cmd.Parameters.Add("m_tuan",OracleType.Number).Value=m_tuan;
				cmd.Parameters.Add("m_ditatbs",OracleType.VarChar,10).Value=m_ditatbs;
				cmd.Parameters.Add("m_mass",OracleType.VarChar,8).Value=m_mass;
				cmd.Parameters.Add("m_cachthucde",OracleType.Number).Value=m_cachthucde;
				cmd.Parameters.Add("m_xuly",OracleType.NVarChar,254).Value=m_xuly;
				cmd.Parameters.Add("m_kieuthe",OracleType.NVarChar,50).Value=m_kieuthe;
				cmd.Parameters.Add("m_mach",OracleType.Number).Value=m_mach;
				cmd.Parameters.Add("m_huyetap",OracleType.VarChar,7).Value=m_huyetap;
				cmd.Parameters.Add("m_nhietdo",OracleType.Number).Value=m_nhietdo;
				cmd.Parameters.Add("m_nhiptho",OracleType.Number).Value=m_nhiptho;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into ddsosinh(mabn,maql,apgar1,apgar5,apgar10,cannang,cao,vongdau,manv1,manv2,conthu,hoten,duthang,thang,tuan,ditatbs,mass,cachthucde,xuly,kieuthe,mach,huyetap,nhietdo,nhiptho) values ";
					sql+="(:m_mabn,:m_maql,:m_apgar1,:m_apgar5,:m_apgar10,:m_cannang,:m_cao,:m_vongdau,:m_manv1,:m_manv2,:m_conthu,:m_hoten,:m_duthang,:m_thang,:m_tuan,:m_ditatbs,:m_mass,:m_cachthucde,:m_xuly,:m_kieuthe,:m_mach,:m_huyetap,:m_nhietdo,:m_nhiptho)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_apgar1",OracleType.Number).Value=m_apgar1;
					cmd.Parameters.Add("m_apgar5",OracleType.Number).Value=m_apgar5;
					cmd.Parameters.Add("m_apgar10",OracleType.Number).Value=m_apgar10;
					cmd.Parameters.Add("m_cannang",OracleType.Number).Value=m_cannang;
					cmd.Parameters.Add("m_cao",OracleType.Number).Value=m_cao;
					cmd.Parameters.Add("m_vongdau",OracleType.Number).Value=m_vongdau;
					cmd.Parameters.Add("m_manv1",OracleType.VarChar,4).Value=m_manv1;
					cmd.Parameters.Add("m_manv2",OracleType.VarChar,4).Value=m_manv2;
					cmd.Parameters.Add("m_conthu",OracleType.Number).Value=m_conthu;
					cmd.Parameters.Add("m_hoten",OracleType.NVarChar,50).Value=m_hoten;
					cmd.Parameters.Add("m_duthang",OracleType.Number).Value=m_duthang;
					cmd.Parameters.Add("m_thang",OracleType.Number).Value=m_thang;
					cmd.Parameters.Add("m_tuan",OracleType.Number).Value=m_tuan;
					cmd.Parameters.Add("m_ditatbs",OracleType.VarChar,10).Value=m_ditatbs;
					cmd.Parameters.Add("m_mass",OracleType.VarChar,8).Value=m_mass;
					cmd.Parameters.Add("m_cachthucde",OracleType.Number).Value=m_cachthucde;
					cmd.Parameters.Add("m_xuly",OracleType.NVarChar,254).Value=m_xuly;
					cmd.Parameters.Add("m_kieuthe",OracleType.NVarChar,50).Value=m_kieuthe;
					cmd.Parameters.Add("m_mach",OracleType.Number).Value=m_mach;
					cmd.Parameters.Add("m_huyetap",OracleType.VarChar,7).Value=m_huyetap;
					cmd.Parameters.Add("m_nhietdo",OracleType.Number).Value=m_nhietdo;
					cmd.Parameters.Add("m_nhiptho",OracleType.Number).Value=m_nhiptho;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ddsosinh");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_sukien(string m_mabn,long m_matiepdon,int m_noitiepdon,long m_macap)
		{
			sql="update sukien set mabn=:m_mabn ";
			sql+="where matiepdon=:m_matiepdon and noitiepdon=:m_noitiepdon and macap=:m_macap";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
				cmd.Parameters.Add("m_matiepdon",OracleType.Number).Value=m_matiepdon;
				cmd.Parameters.Add("m_noitiepdon",OracleType.Number).Value=m_noitiepdon;
				cmd.Parameters.Add("m_macap",OracleType.Number).Value=m_macap;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into sukien(mabn,matiepdon,noitiepdon,macap) values ";
					sql+="(:m_mabn,:m_matiepdon,:m_noitiepdon,:m_macap)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
					cmd.Parameters.Add("m_matiepdon",OracleType.Number).Value=m_matiepdon;
					cmd.Parameters.Add("m_noitiepdon",OracleType.Number).Value=m_noitiepdon;
					cmd.Parameters.Add("m_macap",OracleType.Number).Value=m_macap;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"sukien");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_dmnoitiepdon(int m_id,string m_ten,int m_chophep)
		{
			sql="update dmnoitiepdon set ten=:m_ten,chophep=:m_chophep where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_ten",OracleType.NVarChar,100).Value=m_ten;
				cmd.Parameters.Add("m_chophep",OracleType.Number).Value=m_chophep;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into dmnoitiepdon(id,ten,chophep) values ";
					sql+="(:m_id,:m_ten,:m_chophep)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ten",OracleType.NVarChar,100).Value=m_ten;
					cmd.Parameters.Add("m_chophep",OracleType.Number).Value=m_chophep;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"dmnoitiepdon");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}
		
		public bool bTiepdon(int id)
		{
			return get_data("select * from dmnoitiepdon where id="+id+" and chophep=1").Tables[0].Rows.Count>0;
		}

		public bool upd_btdpmo(string m_ma,string m_ten,string m_makp)
		{
			sql="update btdpmo set ten=:m_ten,makp=:m_makp where ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_ten",OracleType.NVarChar,254).Value=m_ten;
				cmd.Parameters.Add("m_makp",OracleType.VarChar,500).Value=m_makp;
				cmd.Parameters.Add("m_ma",OracleType.VarChar,2).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into btdpmo (ma,ten,makp) values (:m_ma,:m_ten,:m_makp)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_ma",OracleType.VarChar,2).Value=m_ma;
					cmd.Parameters.Add("m_ten",OracleType.NVarChar,254).Value=m_ten;
					cmd.Parameters.Add("m_makp",OracleType.VarChar,500).Value=m_makp;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"btdpmo");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public string sothe(int madoituong)
		{
			ds=get_data("select sothe,ngay,mabv,mien from doituong where madoituong="+madoituong);
			if (ds.Tables[0].Rows.Count>0) return ds.Tables[0].Rows[0]["sothe"].ToString().Trim().PadLeft(2,'0')+ds.Tables[0].Rows[0]["ngay"].ToString().Trim()+ds.Tables[0].Rows[0]["mabv"].ToString().Trim()+ds.Tables[0].Rows[0]["mien"].ToString().Trim();
			else return "00000";
		}

		public bool sothe(int madoituong, string sothe)
		{
			int i = 0; bool ret = false;
			string s1 = "", s2 = "", s3 = "'", dau = ",+;.", so = "0123456789";
			ds = get_data("select dai from doituong where madoituong=" + madoituong);
			if (ds.Tables[0].Rows.Count > 0) s1=ds.Tables[0].Rows[0]["dai"].ToString().Trim();
			if (s1 != "")
			{
				while (i < s1.Length)
				{
					if (dau.IndexOf(s1.Substring(i, 1)) != -1)
					{
						if (s2 != "") s3 += s2.PadLeft(2, '0') + "','";
						s2 = "";
					}
					else if (so.IndexOf(s1.Substring(i, 1)) != -1) s2 += s1.Substring(i, 1);
					i++;
				}
				if (s2 != "") s3 += s2.PadLeft(2, '0') + "','";
				s3 = (s3.Length > 1) ? s3.Substring(0, s3.Length - 2) : "";
				ret = s3.IndexOf("'" + sothe.Length.ToString().PadLeft(2, '0') + "'") != -1;
			}
			else
			{
				ret=true;
			}
			return ret;
		}

		public long get_tiepdon(string mabn,string ngay)
		{
			if (!bMmyy(mmyy(ngay))) {return 0;}
			sql="select mavaovien from "+user+mmyy(ngay)+".tiepdon where mabn='"+mabn+"' and to_char(ngay,'dd/mm/yyyy')='"+ngay.Substring(0,10)+"'";
			if(!bChuyenchiphi_PK_vao_cc) {sql+=" and makp<>'99'";}
			sql+=" order by noitiepdon desc,ngay desc";
			ds=get_data(sql);
			if (ds.Tables[0].Rows.Count>0) {return long.Parse(ds.Tables[0].Rows[0]["mavaovien"].ToString());}
			else 
			{
				sql="select mavaovien from "+user+".tiepdon where mabn='"+mabn+"' and to_char(ngay,'dd/mm/yyyy')='"+ngay.Substring(0,10)+"' and noitiepdon=16";
				if(!bChuyenchiphi_PK_vao_cc) {sql+=" and makp<>'99'";}
				sql+=" order by noitiepdon desc,ngay desc";
				ds=get_data(sql);//hen
				if (ds.Tables[0].Rows.Count>0) {return long.Parse(ds.Tables[0].Rows[0]["mavaovien"].ToString());}
				else {return 0;}
			}
			//ct Cu: la lay maql, trong truong hop BN kham nhieu phogn kham thi matiep don se bi sai
		}
		// nam 04/06/2012
		public long xutri_ngoaitru(string mabn,string ngay)
		{
			try
			{
				if (!bMmyy(mmyy(ngay))) 
					return 0;
				
				else 
				{
					string sql_1=("select xutri from "+user+mmyy(ngay)+".benhandt a," +user+mmyy(ngay)+".xutrikbct b where a.mabn='"+mabn+"' and a.maql=b.maql and to_char(a.ngay,'dd/mm/yyyy')='"+ngay.Substring(0,10)+"'");
					ds=get_data("select xutri from "+user+mmyy(ngay)+".benhandt a," +user+mmyy(ngay)+".xutrikbct b where a.mabn='"+mabn+"' and a.maql=b.maql and to_char(a.ngay,'dd/mm/yyyy')='"+ngay.Substring(0,10)+"'");
				
					if (ds.Tables[0].Rows.Count!=0) 

					{
						if(ds.Tables[0].Rows[0]["xutri"].ToString()!="")
							return long.Parse(ds.Tables[0].Rows[0]["xutri"].ToString());
						else return 0;
					}	
					else 
						return 0;
				}
			}
			catch{return 0;}
		}
		// end nam

		public long get_tiepdon_ngaygio(string mabn,string ngay_gio)
		{
			if (!bMmyy(mmyy(ngay_gio))) return 0;
			ds=get_data("select mavaovien from "+user+mmyy(ngay_gio)+".tiepdon where mabn='"+mabn+"' and to_char(ngay,'dd/mm/yyyy hh24:mi')='"+ngay_gio+"' order by noitiepdon desc,ngay desc");
			if (ds.Tables[0].Rows.Count>0) return long.Parse(ds.Tables[0].Rows[0]["mavaovien"].ToString());
			else 
			{
				ds=get_data("select mavaovien from "+user+".tiepdon where mabn='"+mabn+"' and to_char(ngay,'dd/mm/yyyy hh24:mi')='"+ngay_gio+"' and noitiepdon=16 order by noitiepdon desc,ngay desc");//hen
				if (ds.Tables[0].Rows.Count>0) return long.Parse(ds.Tables[0].Rows[0]["mavaovien"].ToString());
				else return 0;
			}
			//ct Cu: la lay maql, trong truong hop BN kham nhieu phogn kham thi matiep don se bi sai
		}

		public long get_tiepdon(string mabn,string ngay,int songay)
		{
			string tu=(songay==0)?ngay:DateToString("dd/MM/yyyy",StringToDate(ngay).AddDays(-1*songay));
			long ret=0;
			ds=get_data_mmyy("select maql,noitiepdon,to_char(ngay,'yyyymmddhh24mi') as ngay from xxx.tiepdon where mabn='"+mabn+"' and to_date(ngay,'dd/mm/yy') between to_date('"+tu+"','dd/mm/yy') and to_date('"+ngay+"','dd/mm/yy') and madoituong in("+sMaDoituong_BHYT().Trim(',')+")",tu,ngay,false);
			if (ds.Tables[0].Rows.Count>0)
			{
				foreach(DataRow r in ds.Tables[0].Select("true","noitiepdon desc,ngay desc"))
				{
					ret=long.Parse(r["maql"].ToString());
					break;
				}
			}
			return ret;
		}

		public long get_tiepdon(string mabn,string ngay,int songay, int madoituong)
		{
			string tu=(songay==0)?ngay:DateToString("dd/MM/yyyy",StringToDate(ngay).AddDays(-1*songay));
			long ret=0;
			ds=get_data_mmyy("select mavaovien as maql,noitiepdon,to_char(ngay,'yyyymmddhh24mi') as ngay from xxx.tiepdon where mabn='"+mabn+"' and to_date(ngay,'dd/mm/yy') between to_date('"+tu+"','dd/mm/yy') and to_date('"+ngay+"','dd/mm/yy') and madoituong="+madoituong,tu,ngay,false);
			if (ds.Tables[0].Rows.Count>0)
			{
				foreach(DataRow r in ds.Tables[0].Select("true","noitiepdon desc,ngay desc"))
				{
					ret=long.Parse(r["maql"].ToString());
					break;
				}
			}
			return ret;
		}

		public bool upd_btdbndctt(string m_mabn,string m_diachi)
		{
			sql="update btdbndctt set diachi=:m_diachi where mabn=:m_mabn";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_diachi",OracleType.NVarChar,254).Value=m_diachi;
				cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into btdbndctt(mabn,diachi) values ";
					sql+="(:m_mabn,:m_diachi)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
					cmd.Parameters.Add("m_diachi",OracleType.NVarChar,254).Value=m_diachi;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"btdbndctt");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public string get_lydokham(long maql)
		{
			ds=get_data("select lydo from lydokham where maql="+maql);
			if (ds.Tables[0].Rows.Count>0) return ds.Tables[0].Rows[0]["lydo"].ToString();
			else return "";
		}

		public int get_honnhan(long maql)
		{
			ds=get_data("select honnhan from lienhe where maql="+maql);
			if (ds.Tables[0].Rows.Count>0) return int.Parse(ds.Tables[0].Rows[0]["honnhan"].ToString());
			else return 0;
		}

		public DataSet get_ttravien_ct_thuoc_vp(DataSet ds,DataRow [] dr
			,DataRow [] drss,DataTable dtkp,DataTable dtbd,DataTable dtvp
			,string makp,bool bVienphi_phongluu,int loaiba,string makp_rv
			,bool bThanhtoanndot,bool ngia,bool bTheongay,string ngayvaovien)
		{			
			ds.Clear();			
			bool bTTRV_theokhoa=bThanhtoan_theokhoa;
			bool bSothengayhuong=bSothe_ngay_huong;
			bool bMau38_Full=bInPhieuThanhtoanravien_daydu;
			DataRow r1,r2;
			DataRow [] r3;
			DataTable tmp;
			sql="select 0 as loai,id,bhyt,to_char(ngayud,'yyyymmddhh24mi') as ngaygio,to_char(ngayud,'yyyymmdd') as ngay,gia_bh from d_dmbd_luu";
			sql+=" union all ";
			sql+="select 1 as loai,id,bhyt,to_char(ngayud,'yyyymmddhh24mi') as ngaygio,to_char(ngayud,'yyyymmdd') as ngay,gia_bh from d_dmbd";
			DataTable dtbdfull=get_data(sql).Tables[0];
			tc_tamung=0;
			b_tatca_sobienlaitamung="";
			string _maql="", s_mabd="", s_mabd_chenhlech="";
			bool bKhongchiphi=true;
			for(int i=0;i<dr.Length;i++)
			{
				if ((bDoituong_BHYT (int.Parse(dr[i]["madoituong"].ToString()))||bDoituong_BHYT(int.Parse(dr[i]["madoituongvao"].ToString()))) && _maql.ToString().IndexOf(dr[i]["maql"].ToString()+",")==-1) _maql+=dr[i]["maql"].ToString()+",";
				//if ((dr[i]["madoituong"].ToString()=="1" || dr[i]["madoituongvao"].ToString()=="1") && _maql.ToString().IndexOf(dr[i]["maql"].ToString()+",")==-1) _maql+=dr[i]["maql"].ToString()+",";
			}
			DataTable dtbhyt=new DataTable();
			bool bBhyt=false,b701424=Mabv_so==701424,bchenhlech_giavp=bChenhlech_giavp,bCont,bchenhlech_tructiep=bChenhlech_tructiep,bchenhlech_traituyen=bChenhlech_traituyen;
			if (_maql!="")
			{
				sql="select a.maql,a.sothe,to_char(a.tungay,'dd/mm/yyyy') as tungay,to_char(a.denngay,'dd/mm/yyyy') as denngay,";
				sql+="to_char(a.tungay,'yyyymmdd') as tu,to_char(a.denngay,'yyyymmdd') as den,";
				sql+="to_char(a.ngay1,'dd/mm/yyyy') as ngay1,to_char(a.ngay2,'dd/mm/yyyy') as ngay2,to_char(a.ngay3,'dd/mm/yyyy') as ngay3,b.tenbv||'^'||a.mabv||'^'||c.ten as tenbv ";
				sql+=" from bhyt a,dmnoicapbhyt b, dmnoicap c where a.mabv=b.mabv(+) and a.manoicap=c.id(+) and a.maql in ("+_maql.Substring(0,_maql.Length-1)+")";
				sql+=" order by a.tungay,a.denngay";
				dtbhyt=get_data(sql).Tables[0];
				bBhyt=true;
			}
			bool bgia_bh_quydinh_giamua = bGia_bh_quydinh_giamua;
			string chenhlech="";
			DataTable dtdt=get_data("select * from doituong").Tables[0];
			foreach(DataRow r in dtdt.Select("chenhlech=1")) chenhlech+=r["madoituong"].ToString().Trim()+",";
			bool bRavien_hc=bRavien_hcbd,bHaophi_vp=bHaophi_vienphi;			
			if (bHaophi_thanhtoan)
			{
				r1=getrowbyid(dtdt,"madoituong="+iHaophi);
				if (r1==null)
				{
					r2=dtdt.NewRow();
					r2["madoituong"]=iHaophi;
					r2["doituong"]="Hao phí";
					r2["sothe"]=0;
					r2["ngay"]=0;
					r2["mabv"]=0;
					r2["mien"]=1;
					r2["field_gia"]="gia_th";
					r2["trasau"]=0;
					r2["cholam"]=0;
					dtdt.Rows.Add(r2);
				}
			}
			
			string s_doituong="Thu phí",s_mabn="",s_idvienphi="",tmp_idvienphi="";
			string s_madt="",s_dtuong="",s_ten="",s_tenkp="",s_denngay="",s_tungay="",s_dkkcb="",s_sothe="",str;
			decimal dg1,dg2,dongia,tamung=0,sotien=0,bhyt=0,mien=0,st1,st2,giamua=0,dg1k,dg2k,st1k,st2k,st;
			
			string ngayserver=ngayhienhanh_server,s_mmyy=mmyy(ngayserver),f1,f2,mmyy_server=s_mmyy,ngay1="",ngay2="",ngay3="",ngayvao="",xxx;
			if (!bMmyy(s_mmyy))
			{
				LibDuoc.AccessData d=new LibDuoc.AccessData();
				d.tao_user_mmyy(s_mmyy,0);
			}
			upd_capsotoa(mmyy_server,loaiba,ngayserver,0,0);
			long idkhoa=0,maql=0,idvienphi=0,maql_phongluu=0,mavaovien=0;
			b_sobienlaitamung="";
			bool bChenhlechdv=bChenhlech,bCapve=bCapve_noitru||bCapve_Phongluu,bNgtr=false,bNgtr_ntr=bBHYTngtr_noitru,bndot=bThanhtoanndot || loaiba==2,bKhu=bThanhtoan_khu,bDenngay,bTungay,bChenhlech_dt=bChenhlech_doituong,bTtngay=(bTheongay)?true:bThanhtoan_ngay;
			int i_madoituongvao=0,i_tunguyen=iTunguyen,i_madt=0,i_haophi=iHaophi,maphu=0,nhom=nhom_duoc,kythuat=-1,noitiepdon=1;
			decimal iBhyt=0;
			r1=getrowbyid(dtdt,"madoituong="+i_tunguyen);
			if (r1!=null) s_doituong=r1["doituong"].ToString();
			long maql_save=0,maql_pk=0;
			decimal mucbhquidinh=muc_bhquidinh,muckhongqua=ck2_ca3_26,stc=0;
			int phantrambhyt=phantram_bhyt;
			bool nhom1,nhom2;
			string huong100=huong_100+"+"+cc1_te1,huong100kqua=huong_100_khongqua+"+"+ck2_ca3,huong95kqua=bt4_hn4_ht5;
			bool bgia_bh_quydinh=bGia_bh_quydinh;
			decimal giaban;
			//
			decimal d_sotien_ktcao=0, d_sotien_ktcao_dinhmuc=ck2_ca3_26;
			bool bFound_ktcao_vuot=false, bCLktcao=false;
			//
			for(int i=0;i<dr.Length;i++)
			{		
				//
				i_tunguyen=iTunguyen_doituong_(int.Parse(dr[i]["madoituong"].ToString()));// ma doi tuong tu nguyen theo tung doi tuong vao
				//
				tamung=0;ngayvao=dr[i]["ngayvao"].ToString();
				s_denngay=dr[i]["denngay"].ToString();s_tungay=dr[i]["tungay"].ToString();s_sothe=dr[i]["sothe"].ToString();
				s_dkkcb=dr[i]["noicap"].ToString();
				d_sotien_ktcao=0;bFound_ktcao_vuot=false;
				if (dr[i]["denngay"].ToString().Length>20)
				{
					s_denngay=dr[i]["denngay"].ToString();
					s_denngay=s_denngay.Substring(s_denngay.IndexOf("^")+2,10);
					s_tungay=dr[i]["denngay"].ToString().Substring(0,10);
				}
				r1=getrowbyid(dtkp,"makp='"+dr[i]["makp"].ToString()+"'");				
				i_madoituongvao=int.Parse(dr[i]["madoituongvao"].ToString());
				if (bndot || dr[i]["motkhu"].ToString()=="0") idkhoa=long.Parse(dr[i]["idkhoa"].ToString());
				maql=long.Parse(dr[i]["maql"].ToString());
				mavaovien=0;
				if (bCapve)
				{
					foreach(DataRow row in get_data("select matiepdon from sukien where matiepdon>0 and macap="+maql+" order by noitiepdon").Tables[0].Rows)
					{
						mavaovien=long.Parse(row["matiepdon"].ToString());
						break;
					}
					if (mavaovien!=0 && loaiba==4)
					{
						if (get_data("select b.* from "+user+mmyy(dr[i]["ngayra"].ToString())+".benhandt a,xutrikbct b where a.maql=b.maql and a.mabn='"+dr[i]["mabn"].ToString()+"' and a.mavaovien="+mavaovien+" and b.xutri like '%04,%'").Tables[0].Rows.Count==0)
							mavaovien=maql;
					}
				}				
				if (bNgtr_ntr && loaiba!=3)
				{	
					if (bMmyy(ngayvao))
					{	
						xxx=user+mmyy(ngayvao);
						noitiepdon=(loaiba==1)?Nhanbenh:(loaiba==2)?Ngoaitru:Phongluu;
						str="select a.mavaovien from "+xxx+".benhandt a,"+xxx+".xutrikbct b where a.maql=b.maql and a.mabn='"+dr[i]["mabn"].ToString()+"' and to_char(a.ngay,'dd/mm/yyyy')='"+ngayvao.Substring(0,10)+"'";
						if (loaiba==1)str+=" and b.xutri like '%05%'";
						else if (loaiba==2) str+=" and b.xutri like '%02%'";
						else str+=" and b.xutri like '%04%'";
						foreach(DataRow row in get_data(str).Tables[0].Rows)
							maql_pk=long.Parse(row["mavaovien"].ToString());						
						if (maql_pk!=0) bNgtr=get_data("select * from sukien where matiepdon>0 and macap="+maql+" and noitiepdon="+noitiepdon+" and matiepdon="+maql_pk).Tables[0].Rows.Count>0;
					}
				}
				if (maql!=maql_save)
				{
					tamung=0;sotien=0;bhyt=0;mien=0;tc_tamung=0;
					maql_save=maql;b_sobienlaitamung="";b_tatca_sobienlaitamung="";
				}
				if (bVienphi_phongluu && loaiba!=4)
				{		
					string _mapl="";
					foreach(DataRow row in get_data("select * from sukien where macap="+maql+" and noitiepdon=4").Tables[0].Rows)
					{
						_mapl+=row["matiepdon"].ToString()+",";
					}
					if (_mapl!="")
					{
						foreach(DataRow row in get_data("select to_char(ngay,'dd/mm/yyyy hh24:mi') as ngayvao from benhandt where maql in ("+_mapl.Substring(0,_mapl.Length-1)+") and loaiba=4").Tables[0].Rows)
						{
							ngayvao=row["ngayvao"].ToString();
							break;
						}
					}
					//binh
					maql_phongluu=get_maql_phongluu(maql);					
					//
				}
				else maql_phongluu=0;				
				if (maql_phongluu==maql) maql_phongluu=0;
				if (dr[i]["done"].ToString()=="0" && int.Parse(dr[i]["madoituong"].ToString())!=i_haophi)
				{
					s_idvienphi=get_id_thvp((int.Parse(dr[i]["motkhu"].ToString())==1)?0:int.Parse(dr[i]["khu"].ToString()),dr[i]["mabn"].ToString(),maql,idkhoa,dr[i]["ngayvao"].ToString(),dr[i]["ngayra"].ToString(),ngayserver,bTheongay);
					if (s_idvienphi!="")
					{
						s_mmyy=s_idvienphi.Substring(0,4);
						idvienphi=long.Parse(s_idvienphi.Substring(4));
						if (s_mabn!=dr[i]["mabn"].ToString())
						{
							s_mabn=dr[i]["mabn"].ToString();
							tmp_idvienphi=idvienphi.ToString()+",";
							//if (!bTheongay) 
							execute_data("delete from "+user+s_mmyy+".v_thvpct where done=0 and id="+idvienphi);
						}
						else if (tmp_idvienphi !="" && tmp_idvienphi.IndexOf(idvienphi.ToString()+",")<0)
						{
							tmp_idvienphi+=idvienphi.ToString()+",";
							//if (!bTheongay) 
							execute_data("delete from "+user+s_mmyy+".v_thvpct where done=0 and id="+idvienphi);
						}
						//
					}
					else 
					{
						s_mmyy=mmyy_server;
						s_mabn=dr[i]["mabn"].ToString();
						idvienphi=get_id_thvp();
						tmp_idvienphi+=idvienphi.ToString()+",";
					}
				}
				tamung+=get_tamung_ct((int.Parse(dr[i]["motkhu"].ToString())==1)?0:int.Parse(dr[i]["khu"].ToString())
					,dr[i]["mabn"].ToString(),maql,idkhoa
					,dr[i]["ngayvao"].ToString(),dr[i]["ngayra"].ToString()
					,(makp=="")?"":dr[i]["makp"].ToString()
					,int.Parse(dr[i]["madoituong"].ToString())
					,int.Parse(dr[i]["done"].ToString()),maql_phongluu
					,loaiba,dr[i]["maso"].ToString(),bTheongay,ngayvaovien);			
				bKhongchiphi=tamung>0;
				if (tamung==0 && b701424 && b_sobienlaitamung.IndexOf("Hoàn trả")==-1) tamung+=get_tamung_ct_424((int.Parse(dr[i]["motkhu"].ToString())==1)?0:int.Parse(dr[i]["khu"].ToString()),dr[i]["mabn"].ToString(),maql,idkhoa,dr[i]["ngayvao"].ToString(),dr[i]["ngayra"].ToString(),(makp=="")?"":dr[i]["makp"].ToString(),int.Parse(dr[i]["madoituong"].ToString()),int.Parse(dr[i]["done"].ToString()),maql_phongluu,loaiba,dr[i]["maso"].ToString());
				tc_tamung+=tamung;
				if(b_tatca_sobienlaitamung.IndexOf(b_sobienlaitamung)<0) b_tatca_sobienlaitamung+=b_sobienlaitamung;
				#region Thuoc

				if (!bBosolieuduoc)
				{
					tmp=get_thuoc_ct((int.Parse(dr[i]["motkhu"].ToString())==1)?0:int.Parse(dr[i]["khu"].ToString())
						,dr[i]["mabn"].ToString(),maql,idkhoa
						,dr[i]["ngayvao"].ToString(),dr[i]["ngayra"].ToString()
						,(makp=="" || r1==null)?0:int.Parse(r1["id"].ToString())
						,int.Parse(dr[i]["madoituong"].ToString())
						,int.Parse(dr[i]["done"].ToString()),maql_phongluu
						,bChenhlechdv,bCapve,bNgtr,loaiba,dr[i]["makp"].ToString()
						,mavaovien,dr[i]["maso"].ToString(),bTheongay
						,bThanhtoanndot,bTTRV_theokhoa,ngayvaovien);
					if (tmp!=null)
					{
						foreach(DataRow r in tmp.Rows)
						{		
							bKhongchiphi=false;
							if(s_mabd.IndexOf(r["mabd"].ToString()+",")<0)s_mabd+=r["mabd"].ToString()+",";
							r2=getrowbyid(dtbd,"id="+int.Parse(r["mabd"].ToString()));
							if (r2!=null)
							{
								ngay1=dr[i]["ngay1"].ToString().Trim();
								ngay2=dr[i]["ngay2"].ToString().Trim();
								ngay3=dr[i]["ngay3"].ToString().Trim();
								if (bBhyt)
								{
									r3=dtbhyt.Select("maql="+maql+" and den>="+r["ngay"].ToString().Substring(6,4)+r["ngay"].ToString().Substring(3,2)+r["ngay"].ToString().Substring(0,2),"den");
									if (r3.Length>0)
									{
										s_tungay=r3[0]["tungay"].ToString();
										s_denngay=r3[0]["denngay"].ToString();
										s_sothe=r3[0]["sothe"].ToString();
										s_dkkcb=r3[0]["tenbv"].ToString();
										ngay1=r3[0]["ngay1"].ToString().Trim();
										ngay2=r3[0]["ngay2"].ToString().Trim();
										ngay3=r3[0]["ngay3"].ToString().Trim();
									}
								}
								DataRow rkp=getrowbyid(dtkp,"makp='"+r["makp"].ToString()+"'");
								if(rkp!=null)s_tenkp=rkp["ten"].ToString();
								else s_tenkp=dr[i]["tenkp"].ToString();
								s_madt=dr[i]["madoituong"].ToString().Trim();
								iBhyt=(s_madt=="1")?get_bhyt(dtbdfull,long.Parse(r["mabd"].ToString()),r["ngay"].ToString()):0;
								i_madt=int.Parse(s_madt);
								s_dtuong=dr[i]["doituong"].ToString();
								kythuat=int.Parse(r2["kythuat"].ToString());
								
								//								if (kythuat==1 && bDoituong_BHYT(i_madt,dtdt))//if (kythuat==1 && i_madt==1)
								//								{	
								//									//kythuat=2;
								//									maphu=(dr[i]["sothe"].ToString().Trim()!="")?get_maphu_noitru(dr[i]["sothe"].ToString(),nhom,dr[i]["ngayra"].ToString().Substring(0,10)):0;
								//									//if (maphu!=0)
								//									//{
								//										kythuat=-1;
								//										if (ngay3!="")
								//										{
								//											if (!bNgay(r["ngay"].ToString(),ngay3))
								//											{
								//												i_madt=i_tunguyen;
								//												r1=getrowbyid(dtdt,"madoituong="+i_madt);
								//												if (r1!=null) s_dtuong=r1["doituong"].ToString();
								//												kythuat=-1;
								//											}
								//											else kythuat=2;
								//										}										
								//									//}
								//								}
								//								else kythuat=-1;
								//
								if (bRavien_hc)
								{
									if (r2["tenhc"].ToString()!="") s_ten=r2["tenhc"].ToString().Trim()+"["+r2["tenbd"].ToString().Trim()+"]";
									else s_ten=r2["tenbd"].ToString();
								}
								else s_ten=r2["ten"].ToString();
								dongia=decimal.Parse(r["dongia"].ToString());
								dg1=dongia;dg2=0;st2=0;st1=decimal.Parse(r["sotien"].ToString());
								bDenngay=true;bTungay=true;
								giamua=decimal.Parse(r["giamua"].ToString());
								if(giamua==0)giamua=dongia;
								
								if (s_denngay.Trim().Length==10) bDenngay=bNgay(s_denngay,r["ngay"].ToString().Substring(0,10));
								if (s_tungay.Trim().Length==10) bTungay=bNgay(r["ngay"].ToString().Substring(0,10),s_tungay);
								bCont=(bTungay && bDenngay && bChenhlechdv  
									&& chenhlech.IndexOf(i_madoituongvao.ToString().Trim()+",")!=-1 
									&& chenhlech.IndexOf(s_madt.ToString().Trim()+",")!=-1 //BBBB
									&& decimal.Parse(r2["bhyt"].ToString())>0); 
								//&& r["loai"].ToString().Trim()=="1");// chi tinh chenh lech thuoc khi khai bao doi tuong tinh theo gia ban: bbbb - bo ra
								if (bChenhlech_dt) bCont=bCont && s_madt==i_tunguyen.ToString().Trim();
								giaban=decimal.Parse(r["giaban"].ToString());
								if (bCont && bgia_bh_quydinh)
								{
									if (bgia_bh_quydinh_giamua) giaban=dongia;//giamua;
									r1=getrowbyid(dtbdfull,"id="+long.Parse(r["mabd"].ToString()));
									if (r1!=null)
									{
										if (decimal.Parse(r1["gia_bh"].ToString())>0)
											giamua=Math.Min(giamua,decimal.Parse(r1["gia_bh"].ToString()));
									}
								}								
								bCont=bCont && Math.Round(giaban,2)-Math.Round(giamua,2)>1;//Math.Round(giaban,2)!=Math.Round(giamua,2);
								if (bchenhlech_traituyen && int.Parse(dr[i]["traituyen"].ToString())==0) bCont=false;
								
								if (bCont)
								{
									i_madt=i_madoituongvao;
									r1=getrowbyid(dtdt,"madoituong="+i_madt);
									if (r1!=null) s_dtuong=r1["doituong"].ToString();
									dg1=giamua;
									st1=decimal.Parse(r["soluong"].ToString())*dg1;
								}
								else if (bDoituong_BHYT(int.Parse(s_madt),dtdt) && iBhyt!=0)//else if (s_madt=="1" && iBhyt!=0)// && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))
								{
									if (iBhyt!=100) s_ten+=" BHYT thanh toán "+iBhyt.ToString()+" %";//r2["bhyt"].ToString().Trim()+" %";
									dg1=dongia*iBhyt/100;//dongia*decimal.Parse(r2["bhyt"].ToString())/100;
									st1=decimal.Parse(r["soluong"].ToString())*dg1;//decimal.Parse(r["bhyt"].ToString());
									//dg1=dongia;
								}
								//								}
								//
								//
								#region Tinh KT Cao CHO THUOC VAT TU Y TE	
								dg1k=dg2k=st1k=st2k=0;	bCLktcao=false;
								if (kythuat!=-1 && bDoituong_BHYT(i_madt,dtdt) && st1>mucbhquidinh)//if (kythuat==1 && i_madt==1)
								{
																
									st1k=st1;dg1k=dg1;
									maphu=(dr[i]["sothe"].ToString().Trim()!="")?get_maphu_noitru(dr[i]["sothe"].ToString(),nhom,dr[i]["ngayra"].ToString().Substring(0,10)):0;
									if (maphu==0)//bhyt 100%
									{
										int atyle=100;
										nhom1=get_nhom(dr[i]["sothe"].ToString(),huong100,nhom);//xac dinh nhung the huong 100%
										if (!nhom1)
										{
											//if (st1>muckhongqua)
											//{
											nhom2=get_nhom(dr[i]["sothe"].ToString(),huong100kqua,nhom);//huong 100 khong qua dinh muc
											if (nhom2 && st1>muckhongqua)
											{
												//												st1k=muckhongqua;//vuot dinh muc thi sotien=so tien dinh muc
												//												dg1k=st1k/decimal.Parse(r["soluong"].ToString());//
												//												st2k=st1-st1k;//chenh lech = so tien - sotien dinh muc
												//												dg2k=st2k/decimal.Parse(r["soluong"].ToString());
												st=st1;
												d_sotien_ktcao+=st;
												if(st<=muckhongqua && d_sotien_ktcao<=muckhongqua)
												{
													bCLktcao=false;
													st1k=st1;dg1k=dg1;
													st2k=0;dg2k=0;
													//binh thuong:
												}
												else if(st<=muckhongqua && d_sotien_ktcao>muckhongqua)
												{
													decimal tmpst=st1;
													st1k=(d_sotien_ktcao-muckhongqua>st)?0:(st-(d_sotien_ktcao-muckhongqua));
													st1k=Math.Round(st1k*(100/atyle),0);//lay nguoc lai st chua co bhyt
													dg1k=Math.Round(st1k/decimal.Parse(r["soluong"].ToString()),3);
													st2k=tmpst-st1k;
													dg2k=Math.Round(st2k/decimal.Parse(r["soluong"].ToString()),3);
													bCLktcao=true;
											
												}
												else if(st1>d_sotien_ktcao_dinhmuc)
												{
													decimal tmpst=st1;
													st1k=(d_sotien_ktcao-d_sotien_ktcao_dinhmuc>st1)?0:(st-(d_sotien_ktcao-d_sotien_ktcao_dinhmuc));
													st1k=Math.Round(st1k*(100/atyle),0);//lay nguoc lai st chua co bhyt
													dg1k=Math.Round(st1k/decimal.Parse(r["soluong"].ToString()),3);
													st2k=tmpst-st1k;
													dg2k=Math.Round(st2k/decimal.Parse(r["soluong"].ToString()),3);
													bCLktcao=true;
												}
											}
											else 
											{
												int tmp_phantrambhyt=phantrambhyt;
												if(dr[i]["sothe"].ToString().Length==15||dr[i]["sothe"].ToString().Length==20)
												{
													tmp_phantrambhyt=(maphu==0)?100:(maphu==1)?80:95;
												}
												st = st1 * tmp_phantrambhyt / 100;//huong khong qua 60%
												d_sotien_ktcao+=st;

												if (d_sotien_ktcao < mucbhquidinh)//if (st < mucbhquidinh)
												{
													st1k = mucbhquidinh;
													dg1k = st1k / decimal.Parse(r["soluong"].ToString());
													st2k = st1 - st1k;
													dg2k = st2k / decimal.Parse(r["soluong"].ToString());
												}
												else if (d_sotien_ktcao > muckhongqua)//else if (st > muckhongqua)
												{
													st1k = muckhongqua;//60% vuot qua dinh muc thi so tien=so tien dinh muc
													dg1k = st1k / decimal.Parse(r["soluong"].ToString());
													st2k = st1 - st1k;// chenh lech = so tien - so tien dinh muc
													dg2k = st2k / decimal.Parse(r["soluong"].ToString());
												}
												else
												{
													//													st1k = st1 * tmp_phantrambhyt / 100;// trong pham vi: thi huong 60%= phantrambhyt
													//													dg1k = st1k / decimal.Parse(r["soluong"].ToString());
													//													st2k = st1 - st1k;//chenh lech = phan con lai = (100 -60)* so tien/100
													//													dg2k = st2k / decimal.Parse(r["soluong"].ToString());
													if(st<=muckhongqua && d_sotien_ktcao<=muckhongqua)
													{
														bCLktcao=false;
														st1k=st1;dg1k=dg1;
														st2k=0;dg2k=0;
														//binh thuong:
													}
													else if(st<=muckhongqua && d_sotien_ktcao>muckhongqua)
													{
														decimal tmpst=st1;
														st1k=(d_sotien_ktcao-muckhongqua>st)?0:(st-(d_sotien_ktcao-muckhongqua));
														st1k=Math.Round(st1k*(100/atyle),0);//lay nguoc lai st chua co bhyt
														dg1k=Math.Round(st1k/decimal.Parse(r["soluong"].ToString()),3);
														st2k=tmpst-st1k;
														dg2k=Math.Round(st2k/decimal.Parse(r["soluong"].ToString()),3);
														bCLktcao=true;
											
													}
													else if(st1>d_sotien_ktcao_dinhmuc)
													{
														decimal tmpst=st1;
														st1k=(d_sotien_ktcao-d_sotien_ktcao_dinhmuc>st1)?0:(st-(d_sotien_ktcao-d_sotien_ktcao_dinhmuc));
														st1k=Math.Round(st1k*(100/atyle),0);//lay nguoc lai st chua co bhyt
														dg1k=Math.Round(st1k/decimal.Parse(r["soluong"].ToString()),3);
														st2k=tmpst-st1k;
														dg2k=Math.Round(st2k/decimal.Parse(r["soluong"].ToString()),3);
														bCLktcao=true;
													}
												}
											}
											//}
										}
									}									
									else
									{
										decimal atyle=(maphu==1)?80:(maphu==0)?100:95;
										st=st1*atyle/100;
										//										if (st>muckhongqua)
										//										{
										//											st1k=muckhongqua*atyle/100;
										//											dg1k=st1k/decimal.Parse(r["soluong"].ToString());
										//											st2k=st1-st1k;
										//											dg2k=st2k/decimal.Parse(r["soluong"].ToString());
										//										}
										//
										d_sotien_ktcao+=st;
										//
										bFound_ktcao_vuot= d_sotien_ktcao>muckhongqua;
										if(st<=muckhongqua && d_sotien_ktcao<=muckhongqua)
										{
											bCLktcao=false;
											st1k=st1;dg1k=dg1;
											st2k=0;dg2k=0;
											//binh thuong:
										}
										else if(st<=muckhongqua && d_sotien_ktcao>muckhongqua)
										{
											decimal tmpst=st1;
											st1k=(d_sotien_ktcao-muckhongqua>st)?0:(st-(d_sotien_ktcao-muckhongqua));
											st1k=Math.Round(st1k*(100/atyle),0);//lay nguoc lai st chua co bhyt
											dg1k=Math.Round(st1k/decimal.Parse(r["soluong"].ToString()),3);
											st2k=tmpst-st1k;
											dg2k=Math.Round(st2k/decimal.Parse(r["soluong"].ToString()),3);
											bCLktcao=true;
											
										}
										else if(st1>d_sotien_ktcao_dinhmuc)
										{
											decimal tmpst=st1;
											st1k=(d_sotien_ktcao-d_sotien_ktcao_dinhmuc>st1)?0:(st-(d_sotien_ktcao-d_sotien_ktcao_dinhmuc));
											st1k=Math.Round(st1k*(100/atyle),0);//lay nguoc lai st chua co bhyt
											dg1k=Math.Round(st1k/decimal.Parse(r["soluong"].ToString()),3);
											st2k=tmpst-st1k;
											dg2k=Math.Round(st2k/decimal.Parse(r["soluong"].ToString()),3);
											bCLktcao=true;
										}
									}
									dg1=dg1k; st1=st1k;
									dg2=dg2k; st2=st2k;
									bCLktcao=true;
								}
								#endregion  Tinh KT Cao - thuoc - vat tu
								//
								//
								//Tim gia chenh lech																
								dg2=(bCLktcao)?dg2k:0;
								if (bCont)//co chenh lech
								{
									dg2+=Math.Round(giaban,0)-Math.Round(giamua,0);//giaban-giamua;									
									
								}
								else if (bDoituong_BHYT(int.Parse(s_madt),dtdt) && iBhyt!=0)//else if (s_madt=="1" && iBhyt!=0)//decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))
								{
									decimal bn2=100-iBhyt;
									dg2+=dongia*bn2/100;
								}
								//
								
								updrec_ravien(ds,int.Parse(dr[i]["khu"].ToString()),dr[i]["mabn"].ToString(),dr[i]["mabn"].ToString(),long.Parse(dr[i]["maql"].ToString()),long.Parse(dr[i]["idkhoa"].ToString()),dr[i]["hoten"].ToString(),dr[i]["namsinh"].ToString(),dr[i]["phai"].ToString(),
									dr[i]["diachi"].ToString(),i_madt,s_dtuong,s_sothe,iBhyt,s_tungay,s_denngay,dr[i]["noigioithieu"].ToString(),s_dkkcb,
									dr[i]["giuong"].ToString(),r["makp"].ToString() + ((bTtngay) ? " : " + r["ngay"].ToString() : ""),s_tenkp.Trim()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),ngayvao,dr[i]["ngayra"].ToString(),dr[i]["chandoan"].ToString(),dr[i]["maicd"].ToString(),int.Parse(r2["sttnhom"].ToString()),
									r2["nhom"].ToString(),int.Parse(r2["sttloai"].ToString()),r2["loai"].ToString(),int.Parse(r["mabd"].ToString()),
									s_ten,r2["dvt"].ToString(),decimal.Parse(r["soluong"].ToString()),
									st1,
									(iBhyt!=0)?st1:0,tamung,decimal.Parse(r["bhytt0107"].ToString()),dr[i]["nguoinha"].ToString(),int.Parse(dr[i]["hinhthuc"].ToString()),int.Parse(dr[i]["phuongphap"].ToString()),int.Parse(dr[i]["ketqua"].ToString()),dr[i]["soluutru"].ToString(),
									dg1,dr[i]["ngaypt"].ToString(),dr[i]["tenpt"].ToString(),loaiba,int.Parse(dr[i]["done"].ToString()),dr[i]["mabs"].ToString(),dr[i]["tenbs"].ToString(),dr[i]["tenuser"].ToString(),dr[i]["image"].ToString(),dr[i]["ghichu"].ToString(),ngay1,ngay2,ngay3,(bTtngay)?r["ngay"].ToString():"",kythuat,
									b_sobienlaitamung,(r["idttrv"].ToString()!="")?long.Parse(r["idttrv"].ToString()):0,"","",int.Parse(dr[i]["traituyen"].ToString()),giamua,giaban,dg2);
							
								if (dr[i]["done"].ToString()=="0" && (int.Parse(dr[i]["madoituong"].ToString())!=i_haophi || (int.Parse(dr[i]["madoituong"].ToString())==i_haophi && bHaophi_vp)))
									upd_thvpct(s_mmyy,idvienphi,r["ngay"].ToString(),r["makp"].ToString(),i_madt,long.Parse(r["mabd"].ToString()),decimal.Parse(r["soluong"].ToString()),dg1,st1,0,s_sothe);
								
								//
								
								
								dg2=(bCLktcao)?dg2k:0;
								st2=(bCLktcao)?st2k:0;

								if (bCont)
								{
									//
									if(s_mabd_chenhlech.IndexOf(r["mabd"].ToString()+",")<0)s_mabd_chenhlech+=r["mabd"].ToString()+",";
									//
									s_madt=i_tunguyen.ToString();
									i_madt=int.Parse(s_madt);
									r1=getrowbyid(dtdt,"madoituong="+i_madt);
									if (r1!=null) s_dtuong=r1["doituong"].ToString();
									s_ten+=" BN thanh toán chênh lệch ";
									
									dg2+=Math.Round(giaban,0)-Math.Round(giamua,0);//giaban-giamua;
									st2+=decimal.Parse(r["soluong"].ToString())*dg2;
									
								}
								else if (bDoituong_BHYT(int.Parse(s_madt),dtdt) && iBhyt!=0)//else if (s_madt=="1" && iBhyt!=0)//decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))
								{
									i_madt=i_tunguyen;
									s_dtuong=s_doituong;
									s_ten=r2["ten"].ToString();
									dg1=dongia*iBhyt/100;
									decimal bn=100-iBhyt;
									if (iBhyt!=100) s_ten+=" BN thanh toán "+bn.ToString().Trim()+" %";
									dg2+=dongia*bn/100;
									st2+=decimal.Parse(r["sotien"].ToString())-decimal.Parse(r["soluong"].ToString())*dg1;
									//dg2=dongia;//???
								}
								else if(bCLktcao && dg2>0)
								{
									i_madt=i_tunguyen;
									s_dtuong=s_doituong;
									s_ten=r2["ten"].ToString();
									s_ten+=" BN thanh toán chênh lệch KT Cao ";									
								}
								
								if (dg2>0 && st2>0)
								{
									updrec_ravien(ds,int.Parse(dr[i]["khu"].ToString()),dr[i]["mabn"].ToString(),dr[i]["mabn"].ToString(),long.Parse(dr[i]["maql"].ToString()),long.Parse(dr[i]["idkhoa"].ToString()),dr[i]["hoten"].ToString(),dr[i]["namsinh"].ToString(),dr[i]["phai"].ToString(),
										dr[i]["diachi"].ToString(),i_madt,s_dtuong,s_sothe,iBhyt,s_tungay,s_denngay,dr[i]["noigioithieu"].ToString(),s_dkkcb,
										dr[i]["giuong"].ToString(),r["makp"].ToString()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),s_tenkp.Trim()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),ngayvao,dr[i]["ngayra"].ToString(),dr[i]["chandoan"].ToString(),dr[i]["maicd"].ToString(),int.Parse(r2["sttnhom"].ToString()),
										r2["nhom"].ToString(),int.Parse(r2["sttloai"].ToString()),r2["loai"].ToString(),int.Parse(r["mabd"].ToString()),
										s_ten,r2["dvt"].ToString(),decimal.Parse(r["soluong"].ToString()),
										st2,
										(iBhyt!=0)?st2:0,0,decimal.Parse(r["bhytt0107"].ToString()),dr[i]["nguoinha"].ToString(),int.Parse(dr[i]["hinhthuc"].ToString()),int.Parse(dr[i]["phuongphap"].ToString()),int.Parse(dr[i]["ketqua"].ToString()),dr[i]["soluutru"].ToString(),
										dg2,dr[i]["ngaypt"].ToString(),dr[i]["tenpt"].ToString(),loaiba,int.Parse(dr[i]["done"].ToString()),dr[i]["mabs"].ToString(),dr[i]["tenbs"].ToString(),dr[i]["tenuser"].ToString(),dr[i]["image"].ToString(),dr[i]["ghichu"].ToString(),ngay1,ngay2,ngay3,
										(bTtngay)?r["ngay"].ToString():"",kythuat,b_sobienlaitamung,(r["idttrv"].ToString()!="")?long.Parse(r["idttrv"].ToString()):0,"","",int.Parse(dr[i]["traituyen"].ToString()),giamua,giaban,-1);					

									if (dr[i]["done"].ToString()=="0"  && int.Parse(dr[i]["madoituong"].ToString())!=i_haophi)
										upd_thvpct(s_mmyy,idvienphi,r["ngay"].ToString(),r["makp"].ToString(),i_madt,long.Parse(r["mabd"].ToString()),decimal.Parse(r["soluong"].ToString()),dg2,st2,0,s_sothe);
								}
								if (dr[i]["done"].ToString()=="0" && (int.Parse(dr[i]["madoituong"].ToString())!=i_haophi || (int.Parse(dr[i]["madoituong"].ToString())==i_haophi && bHaophi_vp)))
								{
									sotien+=decimal.Parse(r["sotien"].ToString());
									bhyt+=(iBhyt!=0)?st1+st2:0;//decimal.Parse(r["bhyt"].ToString());
								}
							}
						}
					}
				}
				#endregion Thuoc
				#region Vienphi
				tmp=get_vienphi_ct((int.Parse(dr[i]["motkhu"].ToString())==1)?0:int.Parse(dr[i]["khu"].ToString())
					,dr[i]["mabn"].ToString(),maql,idkhoa
					,dr[i]["ngayvao"].ToString(),dr[i]["ngayra"].ToString()
					,(makp=="")?"":dr[i]["makp"].ToString()
					,int.Parse(dr[i]["madoituong"].ToString())
					,int.Parse(dr[i]["done"].ToString()),maql_phongluu
					,bCapve,bNgtr,loaiba,makp_rv,mavaovien
					,dr[i]["maso"].ToString(),bTheongay,bThanhtoanndot
					,bTTRV_theokhoa,ngayvaovien);
				if (tmp!=null)
				{
					foreach(DataRow r in tmp.Select("true","yymmdd"))
					{
						bKhongchiphi=false;
						DataRow rkp=getrowbyid(dtkp,"makp='"+r["makp"].ToString()+"'");
						if(rkp!=null)s_tenkp=rkp["ten"].ToString();
						else s_tenkp=dr[i]["tenkp"].ToString();
						r2=getrowbyid(dtvp,"id="+int.Parse(r["mavp"].ToString()));
						maphu=0;nhom1=nhom2=false;
						if (r2!=null)
						{
							iBhyt=int.Parse(r2["bhyt"].ToString());
							ngay1=dr[i]["ngay1"].ToString().Trim();
							ngay2=dr[i]["ngay2"].ToString().Trim();
							ngay3=dr[i]["ngay3"].ToString().Trim();
							if (bBhyt)
							{
								r3=dtbhyt.Select("maql="+maql+" and den>="+r["ngay"].ToString().Substring(6,4)+r["ngay"].ToString().Substring(3,2)+r["ngay"].ToString().Substring(0,2),"den");
								if (r3.Length>0)
								{
									s_tungay=r3[0]["tungay"].ToString();
									s_denngay=r3[0]["denngay"].ToString();
									s_sothe=r3[0]["sothe"].ToString();
									s_dkkcb=r3[0]["tenbv"].ToString();
									ngay1=r3[0]["ngay1"].ToString().Trim();
									ngay2=r3[0]["ngay2"].ToString().Trim();
									ngay3=r3[0]["ngay3"].ToString().Trim();
								}
							}
							s_madt=dr[i]["madoituong"].ToString();
							i_madt=int.Parse(s_madt);
							s_dtuong=dr[i]["doituong"].ToString();
							kythuat=int.Parse(r2["kythuat"].ToString());
							if (kythuat!=-1 && bDoituong_BHYT(i_madt,dtdt) && bSothengayhuong)//if (kythuat!=-1 && i_madt==1)
							{
								maphu=(dr[i]["sothe"].ToString().Trim()!="")?get_maphu_noitru(dr[i]["sothe"].ToString(),nhom,dr[i]["ngayra"].ToString().Substring(0,10)):0;
								//if (maphu!=0)
								//{									
								if (ngay1+ngay2+ngay3!="")
								{
									if ((!bNgay(r["ngay"].ToString(),ngay1) && kythuat==0) ||
										(!bNgay(r["ngay"].ToString(),ngay2) && kythuat==1) ||
										(!bNgay(r["ngay"].ToString(),ngay3) && kythuat==2))
									{
										i_madt=i_tunguyen;
										r1=getrowbyid(dtdt,"madoituong="+i_madt);
										if (r1!=null) s_dtuong=r1["doituong"].ToString();
										//											kythuat=-1;
									}										
								}
								//									else kythuat=-1;
								//}
							}
							s_ten=r2["ten"].ToString();
							if (decimal.Parse(r["sotien"].ToString())-decimal.Parse(r["vattu"].ToString())>0 && decimal.Parse(r["vattu"].ToString())>0)
							{
								stc=decimal.Parse(r["sotien"].ToString())-decimal.Parse(r["vattu"].ToString());
								s_ten+="[Tiền công: "+stc.ToString().Trim()+",Tiền vật tư: "+r["vattu"].ToString().Trim()+"]";
							}
							f1="th";f2="th";
							//
							dongia=decimal.Parse(r["dongia"].ToString());
							dg1=dongia;dg2=0;st2=0;st1=decimal.Parse(r["sotien"].ToString());
							sql=(bChenhlech_dt)?"madoituong="+i_madoituongvao:"madoituong="+i_madt;
							r1=getrowbyid(dtdt,sql);
							if (r1!=null) f1=r1["field_gia"].ToString().Trim().Substring(r1["field_gia"].ToString().Trim().IndexOf("_")+1);
							sql=(bChenhlech_dt)?"madoituong="+i_madt:"madoituong="+i_tunguyen;
							r1=getrowbyid(dtdt,sql);
							if (r1!=null) f2=r1["field_gia"].ToString().Trim().Substring(r1["field_gia"].ToString().Trim().IndexOf("_")+1);
							bDenngay=true;bTungay=true;
							if (s_denngay.Trim().Length==10) bDenngay=bNgay(s_denngay,r["ngay"].ToString().Substring(0,10));
							if (s_tungay.Trim().Length==10) bTungay=bNgay(r["ngay"].ToString().Substring(0,10),s_tungay);

							#region chenhlech
							bCont=(bchenhlech_tructiep)?false:bChenhlechdv;
							if (bchenhlech_giavp) bCont=bCont && r2["chenhlech"].ToString()=="1";
							bCont=bCont && chenhlech.IndexOf(i_madoituongvao.ToString().Trim()+",")!=-1 
								&& decimal.Parse(r2["bhyt"].ToString())>0 
								&& decimal.Parse(r2["gia_"+f1.Trim()].ToString())<=decimal.Parse(r2["gia_"+f2.Trim()].ToString())
								&& bTungay && bDenngay;
							if (bchenhlech_traituyen && int.Parse(dr[i]["traituyen"].ToString())==0) bCont=false;
							if (bCont && (loaiba==1 || loaiba==4))
							{
								if (bChenhlech_dt)
								{
									if (s_madt==i_tunguyen.ToString().Trim())
									{
										i_madt=i_madoituongvao;
										r1=getrowbyid(dtdt,"madoituong="+i_madt);
										if (r1!=null) s_dtuong=r1["doituong"].ToString();
										dg1=decimal.Parse(r2["gia_"+f1.Trim()].ToString())+decimal.Parse(r2["vattu_"+f1.Trim()].ToString());
										st1=decimal.Parse(r["soluong"].ToString())*dg1;
									}
									else if (bDoituong_BHYT(int.Parse(s_madt),dtdt) && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))//else if (s_madt=="1" && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))
									{
										s_ten+=" BHYT thanh toán "+r2["bhyt"].ToString().Trim()+" %";
										dg1=dongia*decimal.Parse(r2["bhyt"].ToString())/100;
										st1=decimal.Parse(r["bhyt"].ToString());
									}
								}
								else
								{
									if (f1!=f2)
									{
										i_madt=i_madoituongvao;
										r1=getrowbyid(dtdt,"madoituong="+i_madt);
										if (r1!=null) s_dtuong=r1["doituong"].ToString();
										dg1=decimal.Parse(r2["gia_"+f1.Trim()].ToString())+decimal.Parse(r2["vattu_"+f1.Trim()].ToString());
										st1=decimal.Parse(r["soluong"].ToString())*dg1;
									}
									else if (bDoituong_BHYT(int.Parse(s_madt),dtdt) && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))//else if (s_madt=="1" && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))
									{
										s_ten+=" BHYT thanh toán "+r2["bhyt"].ToString().Trim()+" %";
										dg1=dongia*decimal.Parse(r2["bhyt"].ToString())/100;
										st1=decimal.Parse(r["bhyt"].ToString());
									}				
								}
							}
							else if (bDoituong_BHYT(int.Parse(s_madt),dtdt) && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))//else if (s_madt=="1" && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))
							{
								s_ten+=" BHYT thanh toán "+r2["bhyt"].ToString().Trim()+" %";
								dg1=dongia*decimal.Parse(r2["bhyt"].ToString())/100;
								st1=decimal.Parse(r["bhyt"].ToString());
							}				
							#endregion

							#region muc dich vu ky thuat cao
							dg1k=dg2k=st1k=st2k=0;							
							if (kythuat!=-1 && bDoituong_BHYT(i_madt,dtdt) && st1>mucbhquidinh)//if (kythuat!=-1 && i_madt==1 && st1>mucbhquidinh)//bbbb
							{
								
								#region Tinh KT Cao theo cong van cu
								//: cach tinh theo cong van cu
								st1k=st1;dg1k=dg1;
								if (maphu==0)//bhyt 100%
								{
									int atyle=100;
									nhom1=get_nhom(dr[i]["sothe"].ToString(),huong100,nhom);//xac dinh nhung the huong 100%
									if (!nhom1)
									{
										//if (st1>muckhongqua)
										//{
										nhom2=get_nhom(dr[i]["sothe"].ToString(),huong100kqua,nhom);//huong 100 khong qua dinh muc
										if (nhom2 && st1>muckhongqua)
										{
											//												st1k=muckhongqua;//vuot dinh muc thi sotien=so tien dinh muc
											//												dg1k=st1k/decimal.Parse(r["soluong"].ToString());//
											//												st2k=st1-st1k;//chenh lech = so tien - sotien dinh muc
											//												dg2k=st2k/decimal.Parse(r["soluong"].ToString());

											st=st1;
											d_sotien_ktcao+=st;
											if(st<=muckhongqua && d_sotien_ktcao<=muckhongqua)
											{
												bCLktcao=false;
												st1k=st1;dg1k=dg1;
												st2k=0;dg2k=0;
												//binh thuong:
											}
											else if(st<=muckhongqua && d_sotien_ktcao>muckhongqua)
											{
												decimal tmpst=st1;
												st1k=(d_sotien_ktcao-muckhongqua>st)?0:(st-(d_sotien_ktcao-muckhongqua));
												st1k=Math.Round(st1k*(100/atyle),0);//lay nguoc lai st chua co bhyt
												dg1k=Math.Round(st1k/decimal.Parse(r["soluong"].ToString()),3);
												st2k=tmpst-st1k;
												dg2k=Math.Round(st2k/decimal.Parse(r["soluong"].ToString()),3);
												bCLktcao=true;
											
											}
											else if(st1>d_sotien_ktcao_dinhmuc)
											{
												decimal tmpst=st1;
												st1k=(d_sotien_ktcao-d_sotien_ktcao_dinhmuc>st1)?0:(st-(d_sotien_ktcao-d_sotien_ktcao_dinhmuc));
												st1k=Math.Round(st1k*(100/atyle),0);//lay nguoc lai st chua co bhyt
												dg1k=Math.Round(st1k/decimal.Parse(r["soluong"].ToString()),3);
												st2k=tmpst-st1k;
												dg2k=Math.Round(st2k/decimal.Parse(r["soluong"].ToString()),3);
												bCLktcao=true;
											}
										}
										else 
										{
											int tmp_phantrambhyt=phantrambhyt;
											if(dr[i]["sothe"].ToString().Length==15||dr[i]["sothe"].ToString().Length==20)
											{
												tmp_phantrambhyt=(maphu==0)?100:(maphu==1)?80:95;
											}
											st = st1 * tmp_phantrambhyt / 100;//huong khong qua 60%
											d_sotien_ktcao+=st;
											//
											if (st < mucbhquidinh)
											{
												st1k = mucbhquidinh;
												dg1k = st1k / decimal.Parse(r["soluong"].ToString());
												st2k = st1 - st1k;
												dg2k = st2k / decimal.Parse(r["soluong"].ToString());
											}
											else if (st > muckhongqua)
											{
												st1k = muckhongqua;//60% vuot qua dinh muc thi so tien=so tien dinh muc
												dg1k = st1k / decimal.Parse(r["soluong"].ToString());
												st2k = st1 - st1k;// chenh lech = so tien - so tien dinh muc
												dg2k = st2k / decimal.Parse(r["soluong"].ToString());
											}
											else
											{
												//													st1k = st1 * tmp_phantrambhyt / 100;// trong pham vi: thi huong 60%= phantrambhyt
												//													dg1k = st1k / decimal.Parse(r["soluong"].ToString());
												//													st2k = st1 - st1k;//chenh lech = phan con lai = (100 -60)* so tien/100
												//													dg2k = st2k / decimal.Parse(r["soluong"].ToString());
												if(st<=muckhongqua && d_sotien_ktcao<=muckhongqua)
												{
													bCLktcao=false;
													st1k=st1;dg1k=dg1;
													st2k=0;dg2k=0;
													//binh thuong:
												}
												else if(st<=muckhongqua && d_sotien_ktcao>muckhongqua)
												{
													decimal tmpst=st1;
													st1k=(d_sotien_ktcao-muckhongqua>st)?0:(st-(d_sotien_ktcao-muckhongqua));
													st1k=Math.Round(st1k*(100/atyle),0);//lay nguoc lai st chua co bhyt
													dg1k=Math.Round(st1k/decimal.Parse(r["soluong"].ToString()),3);
													st2k=tmpst-st1k;
													dg2k=Math.Round(st2k/decimal.Parse(r["soluong"].ToString()),3);
													bCLktcao=true;
											
												}
												else if(st1>d_sotien_ktcao_dinhmuc)
												{
													decimal tmpst=st1;
													st1k=(d_sotien_ktcao-d_sotien_ktcao_dinhmuc>st1)?0:(st-(d_sotien_ktcao-d_sotien_ktcao_dinhmuc));
													st1k=Math.Round(st1k*(100/atyle),0);//lay nguoc lai st chua co bhyt
													dg1k=Math.Round(st1k/decimal.Parse(r["soluong"].ToString()),3);
													st2k=tmpst-st1k;
													dg2k=Math.Round(st2k/decimal.Parse(r["soluong"].ToString()),3);
													bCLktcao=true;
												}
											}
										}
										//}
									}
								}
								else
								{
									decimal atyle=(maphu==1)?80:(maphu==0)?100:95;
									st=st1*atyle/100;
									//									if (st>muckhongqua)
									//									{
									//										st1k=muckhongqua*atyle/100;
									//										dg1k=st1k/decimal.Parse(r["soluong"].ToString());
									//										st2k=st1-st1k;
									//										dg2k=st2k/decimal.Parse(r["soluong"].ToString());
									//									}
									//
									d_sotien_ktcao+=st;
									//
									bFound_ktcao_vuot= d_sotien_ktcao>muckhongqua;
									if(st<=muckhongqua && d_sotien_ktcao<=muckhongqua)
									{
										bCLktcao=false;
										st1k=st1;dg1k=dg1;
										st2k=0;dg2k=0;
										//binh thuong:
									}
									else if(st<=muckhongqua && d_sotien_ktcao>muckhongqua)
									{
										decimal tmpst=st1;
										st1k=(d_sotien_ktcao-muckhongqua>st)?0:(st-(d_sotien_ktcao-muckhongqua));
										st1k=Math.Round(st1k*(100/atyle),0);//lay nguoc lai st chua co bhyt
										dg1k=Math.Round(st1k/decimal.Parse(r["soluong"].ToString()),3);
										st2k=tmpst-st1k;
										dg2k=Math.Round(st2k/decimal.Parse(r["soluong"].ToString()),3);
										bCLktcao=true;
											
									}
									else if(st1>d_sotien_ktcao_dinhmuc)
									{
										decimal tmpst=st1;
										st1k=(d_sotien_ktcao-d_sotien_ktcao_dinhmuc>st1)?0:(st-(d_sotien_ktcao-d_sotien_ktcao_dinhmuc));
										st1k=Math.Round(st1k*(100/atyle),0);//lay nguoc lai st chua co bhyt
										dg1k=Math.Round(st1k/decimal.Parse(r["soluong"].ToString()),3);
										st2k=tmpst-st1k;
										dg2k=Math.Round(st2k/decimal.Parse(r["soluong"].ToString()),3);
										bCLktcao=true;
									}
								}
								#endregion  Tinh KT Cao theo cong van cu																
								
								//
								updrec_ravien(ds,int.Parse(dr[i]["khu"].ToString()),dr[i]["mabn"].ToString(),dr[i]["mabn"].ToString(),long.Parse(dr[i]["maql"].ToString()),long.Parse(dr[i]["idkhoa"].ToString()),dr[i]["hoten"].ToString(),dr[i]["namsinh"].ToString(),dr[i]["phai"].ToString(),
									dr[i]["diachi"].ToString(),i_madt,s_dtuong,s_sothe,iBhyt,s_tungay,s_denngay,dr[i]["noigioithieu"].ToString(),s_dkkcb,
									dr[i]["giuong"].ToString(),r["makp"].ToString()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),s_tenkp.Trim()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),ngayvao,dr[i]["ngayra"].ToString(),dr[i]["chandoan"].ToString(),dr[i]["maicd"].ToString(),int.Parse(r2["sttnhom"].ToString()),
									r2["nhom"].ToString(),int.Parse(r2["sttloai"].ToString()),r2["loai"].ToString(),int.Parse(r["mavp"].ToString()),
									s_ten,r2["dvt"].ToString(),decimal.Parse(r["soluong"].ToString()),
									st1k,
									decimal.Parse(r["bhyt"].ToString()),tamung,decimal.Parse(r["bhytt0107"].ToString()),dr[i]["nguoinha"].ToString(),int.Parse(dr[i]["hinhthuc"].ToString()),int.Parse(dr[i]["phuongphap"].ToString()),int.Parse(dr[i]["ketqua"].ToString()),dr[i]["soluutru"].ToString(),
									dg1k,dr[i]["ngaypt"].ToString(),dr[i]["tenpt"].ToString(),loaiba,int.Parse(dr[i]["done"].ToString()),dr[i]["mabs"].ToString(),dr[i]["tenbs"].ToString(),dr[i]["tenuser"].ToString(),dr[i]["image"].ToString(),dr[i]["ghichu"].ToString(),ngay1,ngay2,ngay3,(bTtngay)?r["ngay"].ToString():"",kythuat,b_sobienlaitamung,(r["idttrv"].ToString()!="")?long.Parse(r["idttrv"].ToString()):0,"","",int.Parse(dr[i]["traituyen"].ToString()),0,0,dg2k);

								if (dr[i]["done"].ToString()=="0" && (int.Parse(dr[i]["madoituong"].ToString())!=i_haophi || (int.Parse(dr[i]["madoituong"].ToString())==i_haophi && bHaophi_vp)))
									upd_thvpct(s_mmyy,idvienphi,r["ngay"].ToString(),r["makp"].ToString(),i_madt,long.Parse(r["mavp"].ToString()),decimal.Parse(r["soluong"].ToString()),dg1k,st1k,(r["vattu"].ToString().Trim()=="")?0:decimal.Parse(r["vattu"].ToString()),s_sothe);
								
								if (dg2k!=0)
								{									
									s_ten += " BN thanh toán chênh lệch "+((kythuat==0)?"kỹ thuật cao":"chăm sóc thai sản,sinh đẻ");
									r1=getrowbyid(dtdt,"madoituong="+i_tunguyen);
									if (r1!=null) s_dtuong=r1["doituong"].ToString();
									updrec_ravien(ds,int.Parse(dr[i]["khu"].ToString()),dr[i]["mabn"].ToString(),dr[i]["mabn"].ToString(),long.Parse(dr[i]["maql"].ToString()),long.Parse(dr[i]["idkhoa"].ToString()),dr[i]["hoten"].ToString(),dr[i]["namsinh"].ToString(),dr[i]["phai"].ToString(),
										dr[i]["diachi"].ToString(),i_tunguyen,s_dtuong,s_sothe,iBhyt,s_tungay,s_denngay,dr[i]["noigioithieu"].ToString(),s_dkkcb,
										dr[i]["giuong"].ToString(),r["makp"].ToString()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),s_tenkp.Trim()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),ngayvao,dr[i]["ngayra"].ToString(),dr[i]["chandoan"].ToString(),dr[i]["maicd"].ToString(),int.Parse(r2["sttnhom"].ToString()),
										r2["nhom"].ToString(),int.Parse(r2["sttloai"].ToString()),r2["loai"].ToString(),int.Parse(r["mavp"].ToString()),
										s_ten,r2["dvt"].ToString(),decimal.Parse(r["soluong"].ToString()),
										st2k,
										decimal.Parse(r["bhyt"].ToString()),0,decimal.Parse(r["bhytt0107"].ToString()),dr[i]["nguoinha"].ToString(),int.Parse(dr[i]["hinhthuc"].ToString()),int.Parse(dr[i]["phuongphap"].ToString()),int.Parse(dr[i]["ketqua"].ToString()),dr[i]["soluutru"].ToString(),
										dg2k,dr[i]["ngaypt"].ToString(),dr[i]["tenpt"].ToString(),loaiba,int.Parse(dr[i]["done"].ToString()),dr[i]["mabs"].ToString(),dr[i]["tenbs"].ToString(),dr[i]["tenuser"].ToString(),dr[i]["image"].ToString(),dr[i]["ghichu"].ToString(),ngay1,ngay2,ngay3,(bTtngay)?r["ngay"].ToString():"",kythuat,b_sobienlaitamung,(r["idttrv"].ToString()!="")?long.Parse(r["idttrv"].ToString()):0,"","",int.Parse(dr[i]["traituyen"].ToString()),0,0,-1);
									if (dr[i]["done"].ToString()=="0" && int.Parse(dr[i]["madoituong"].ToString())!=i_haophi)
										upd_thvpct(s_mmyy,idvienphi,r["ngay"].ToString(),r["makp"].ToString(),i_tunguyen,long.Parse(r["mavp"].ToString()),decimal.Parse(r["soluong"].ToString()),dg2k,st2k,decimal.Parse(r["vattu"].ToString()),s_sothe);
								}
							}
							else
							{
								updrec_ravien(ds,int.Parse(dr[i]["khu"].ToString()),dr[i]["mabn"].ToString(),dr[i]["mabn"].ToString(),long.Parse(dr[i]["maql"].ToString()),long.Parse(dr[i]["idkhoa"].ToString()),dr[i]["hoten"].ToString(),dr[i]["namsinh"].ToString(),dr[i]["phai"].ToString(),
									dr[i]["diachi"].ToString(),i_madt,s_dtuong,s_sothe,iBhyt,s_tungay,s_denngay,dr[i]["noigioithieu"].ToString(),s_dkkcb,
									dr[i]["giuong"].ToString(),r["makp"].ToString()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),s_tenkp.Trim()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),ngayvao,dr[i]["ngayra"].ToString(),dr[i]["chandoan"].ToString(),dr[i]["maicd"].ToString(),int.Parse(r2["sttnhom"].ToString()),
									r2["nhom"].ToString(),int.Parse(r2["sttloai"].ToString()),r2["loai"].ToString(),int.Parse(r["mavp"].ToString()),
									s_ten,r2["dvt"].ToString(),decimal.Parse(r["soluong"].ToString()),
									st1,
									decimal.Parse(r["bhyt"].ToString()),tamung,decimal.Parse(r["bhytt0107"].ToString()),dr[i]["nguoinha"].ToString(),int.Parse(dr[i]["hinhthuc"].ToString()),int.Parse(dr[i]["phuongphap"].ToString()),int.Parse(dr[i]["ketqua"].ToString()),dr[i]["soluutru"].ToString(),
									dg1,dr[i]["ngaypt"].ToString(),dr[i]["tenpt"].ToString(),loaiba,int.Parse(dr[i]["done"].ToString()),dr[i]["mabs"].ToString(),dr[i]["tenbs"].ToString(),dr[i]["tenuser"].ToString(),dr[i]["image"].ToString(),dr[i]["ghichu"].ToString(),ngay1,ngay2,ngay3,(bTtngay)?r["ngay"].ToString():"",kythuat,b_sobienlaitamung,(r["idttrv"].ToString()!="")?long.Parse(r["idttrv"].ToString()):0,"","",int.Parse(dr[i]["traituyen"].ToString()),0,0,(r["giachenhlech"].ToString()==""?0:decimal.Parse(r["giachenhlech"].ToString())));

								if (dr[i]["done"].ToString()=="0" && (int.Parse(dr[i]["madoituong"].ToString())!=i_haophi || (int.Parse(dr[i]["madoituong"].ToString())==i_haophi && bHaophi_vp)))
									upd_thvpct(s_mmyy,idvienphi,r["ngay"].ToString(),r["makp"].ToString(),i_madt,long.Parse(r["mavp"].ToString()),decimal.Parse(r["soluong"].ToString()),dg1,st1,(r["vattu"].ToString().Trim()=="")?0:decimal.Parse(r["vattu"].ToString()),s_sothe);
							}
							#endregion

							#region chenhlech
							dg2=0;
							bCont=(bchenhlech_tructiep)?false:bChenhlechdv;
							if (bchenhlech_giavp) bCont=bCont && r2["chenhlech"].ToString()=="1";
							bCont=bCont && chenhlech.IndexOf(i_madoituongvao.ToString().Trim()+",")!=-1 
								&& decimal.Parse(r2["bhyt"].ToString())>0 
								&& decimal.Parse(r2["gia_"+f1.Trim()].ToString())<decimal.Parse(r2["gia_"+f2.Trim()].ToString())
								&& bTungay && bDenngay;
							if (bchenhlech_traituyen && int.Parse(dr[i]["traituyen"].ToString())==0) bCont=false;
							if (bCont && (loaiba==1 || loaiba==4))
							{
								if (bChenhlech_dt)
								{
									if (s_madt==i_tunguyen.ToString().Trim())
									{
										s_madt=i_tunguyen.ToString();
										i_madt=int.Parse(s_madt);
										r1=getrowbyid(dtdt,"madoituong="+i_madt);
										if (r1!=null) s_dtuong=r1["doituong"].ToString();
										s_ten+=" BN thanh toán chênh lệch ";
										dg2=decimal.Parse(r2["gia_"+f2.Trim()].ToString())+decimal.Parse(r2["vattu_"+f2.Trim()].ToString())-dg1;
										st2=decimal.Parse(r["soluong"].ToString())*dg2;
									}
									else if (bDoituong_BHYT(int.Parse(s_madt),dtdt) && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))//else if (s_madt=="1" && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))
									{
										s_madt=i_tunguyen.ToString();
										i_madt=int.Parse(s_madt);
										r1=getrowbyid(dtdt,"madoituong="+i_madt);
										if (r1!=null) s_dtuong=r1["doituong"].ToString();
										s_ten=r2["ten"].ToString();
										decimal bn=100-decimal.Parse(r2["bhyt"].ToString());
										s_ten+=" BN thanh toán "+bn.ToString().Trim()+" %";
										dg2=dongia*bn/100;
										st2=decimal.Parse(r["sotien"].ToString())-decimal.Parse(r["bhyt"].ToString());
									}
								}
								else
								{
									if (f1!=f2)
									{
										s_madt=i_tunguyen.ToString();
										i_madt=int.Parse(s_madt);
										r1=getrowbyid(dtdt,"madoituong="+i_madt);
										if (r1!=null) s_dtuong=r1["doituong"].ToString();
										s_ten+=" BN thanh toán chênh lệch ";
										dg2=decimal.Parse(r2["gia_"+f2.Trim()].ToString())+decimal.Parse(r2["vattu_"+f2.Trim()].ToString())-dg1;
										st2=decimal.Parse(r["soluong"].ToString())*dg2;
									}
									else if (bDoituong_BHYT(int.Parse(s_madt),dtdt) && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))//else if (s_madt=="1" && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))
									{
										s_madt=i_tunguyen.ToString();
										i_madt=int.Parse(s_madt);
										r1=getrowbyid(dtdt,"madoituong="+i_madt);
										if (r1!=null) s_dtuong=r1["doituong"].ToString();
										s_ten=r2["ten"].ToString();
										decimal bn=100-decimal.Parse(r2["bhyt"].ToString());
										s_ten+=" BN thanh toán "+bn.ToString().Trim()+" %";
										dg2=dongia*bn/100;
										st2=decimal.Parse(r["sotien"].ToString())-decimal.Parse(r["bhyt"].ToString());
									}

								}
							}
							else if (bDoituong_BHYT(int.Parse(s_madt),dtdt) && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))//else if (s_madt=="1" && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))
							{
								s_madt=i_tunguyen.ToString();
								i_madt=int.Parse(s_madt);
								r1=getrowbyid(dtdt,"madoituong="+i_madt);
								if (r1!=null) s_dtuong=r1["doituong"].ToString();
								s_ten=r2["ten"].ToString();
								decimal bn=100-decimal.Parse(r2["bhyt"].ToString());
								s_ten+=" BN thanh toán "+bn.ToString().Trim()+" %";
								dg2=dongia*bn/100;
								st2=decimal.Parse(r["sotien"].ToString())-decimal.Parse(r["bhyt"].ToString());
							}

							#endregion

							if (dg2>0)
							{
								updrec_ravien(ds,int.Parse(dr[i]["khu"].ToString()),dr[i]["mabn"].ToString(),dr[i]["mabn"].ToString(),long.Parse(dr[i]["maql"].ToString()),long.Parse(dr[i]["idkhoa"].ToString()),dr[i]["hoten"].ToString(),dr[i]["namsinh"].ToString(),dr[i]["phai"].ToString(),
									dr[i]["diachi"].ToString(),i_madt,s_dtuong,s_sothe,iBhyt,s_tungay,s_denngay,dr[i]["noigioithieu"].ToString(),s_dkkcb,
									dr[i]["giuong"].ToString(),r["makp"].ToString()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),s_tenkp.Trim()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),ngayvao,dr[i]["ngayra"].ToString(),dr[i]["chandoan"].ToString(),dr[i]["maicd"].ToString(),int.Parse(r2["sttnhom"].ToString()),
									r2["nhom"].ToString(),int.Parse(r2["sttloai"].ToString()),r2["loai"].ToString(),int.Parse(r["mavp"].ToString()),
									s_ten,r2["dvt"].ToString(),decimal.Parse(r["soluong"].ToString()),
									st2,
									decimal.Parse(r["bhyt"].ToString()),0,decimal.Parse(r["bhytt0107"].ToString()),dr[i]["nguoinha"].ToString(),int.Parse(dr[i]["hinhthuc"].ToString()),int.Parse(dr[i]["phuongphap"].ToString()),int.Parse(dr[i]["ketqua"].ToString()),dr[i]["soluutru"].ToString(),
									dg2,dr[i]["ngaypt"].ToString(),dr[i]["tenpt"].ToString(),loaiba,int.Parse(dr[i]["done"].ToString()),dr[i]["mabs"].ToString(),dr[i]["tenbs"].ToString(),dr[i]["tenuser"].ToString(),dr[i]["image"].ToString(),dr[i]["ghichu"].ToString(),ngay1,ngay2,ngay3,(bTtngay)?r["ngay"].ToString():"",kythuat,b_sobienlaitamung,(r["idttrv"].ToString()!="")?long.Parse(r["idttrv"].ToString()):0,"","",int.Parse(dr[i]["traituyen"].ToString()),0,0,-1);
								if (dr[i]["done"].ToString()=="0" && int.Parse(dr[i]["madoituong"].ToString())!=i_haophi)
									upd_thvpct(s_mmyy,idvienphi,r["ngay"].ToString(),r["makp"].ToString(),i_madt,long.Parse(r["mavp"].ToString()),decimal.Parse(r["soluong"].ToString()),dg2,st2,decimal.Parse(r["vattu"].ToString()),s_sothe);
							}
							if (dr[i]["done"].ToString()=="0" && (int.Parse(dr[i]["madoituong"].ToString())!=i_haophi || (int.Parse(dr[i]["madoituong"].ToString())==i_haophi && bHaophi_vp)))
							{									
								sotien+=decimal.Parse(r["sotien"].ToString());
								bhyt+=decimal.Parse(r["bhyt"].ToString());
							}
						}
					}
				}
				#endregion Vienphi
				if (dr[i]["done"].ToString()=="0"  && ((bHaophi_vienphi==false && int.Parse(dr[i]["madoituong"].ToString())!=i_haophi)||bHaophi_vienphi==true) )
				{
					if (bDoituong_BHYT(dr[i]["madoituong"].ToString())) //if (dr[i]["madoituong"].ToString()=="1") //bhyt
					{
						if (dr[i]["maphu"].ToString()=="0") // Ko cung chi tra
						{
							bhyt=sotien;sotien=0;
						}
						else sotien=sotien-bhyt;
					}
					else if (mien_doituong(int.Parse(dr[i]["madoituong"].ToString()),dtdt)) //mien
					{
						mien=sotien;sotien=0;bhyt=0;
					}
					else bhyt=0;
					if (sotien+mien+bhyt+tamung!=0) upd_thvpll(s_mmyy,idvienphi,dr[i]["mabn"].ToString(),maql,idkhoa,dr[i]["ngayvao"].ToString(),dr[i]["ngayra"].ToString(),dr[i]["giuong"].ToString(),dr[i]["makp"].ToString(),dr[i]["chandoan"].ToString(),dr[i]["maicd"].ToString(),sotien,tamung,bhyt,mien,int.Parse(dr[i]["khu"].ToString()));
					if (mien+bhyt!=0 && s_sothe!="" && s_sothe.Length<=20) upd_thvpbhyt(s_mmyy,idvienphi,s_sothe,int.Parse(dr[i]["maphu"].ToString()),get_manoigioithieu(maql),get_manoicap(maql),int.Parse(dr[i]["traituyen"].ToString()));//dr[i]["sothe"].ToString().Trim()
					//if (s_sothe!="" && dr[i]["madoituong"].ToString()=="1") upd_thvpbhyt(s_mmyy,idvienphi,s_sothe,int.Parse(dr[i]["maphu"].ToString()),get_manoigioithieu(maql),get_manoicap(maql));//dr[i]["sothe"].ToString().Trim()
				}

				if (bKhongchiphi ||( ds.Tables[0].Rows.Count==0 && tamung>0))
				{					
					updrec_ravien(ds,int.Parse(dr[i]["khu"].ToString()),dr[i]["mabn"].ToString(),dr[i]["mabn"].ToString(),long.Parse(dr[i]["maql"].ToString()),long.Parse(dr[i]["idkhoa"].ToString()),dr[i]["hoten"].ToString(),dr[i]["namsinh"].ToString(),dr[i]["phai"].ToString(),
						dr[i]["diachi"].ToString(),i_madt,s_dtuong,dr[i]["sothe"].ToString(),int.Parse(dr[i]["maphu"].ToString()),dr[i]["tungay"].ToString(),dr[i]["denngay"].ToString(),dr[i]["noigioithieu"].ToString(),s_dkkcb,
						dr[i]["giuong"].ToString(),makp,s_tenkp,dr[i]["ngayvao"].ToString(),dr[i]["ngayra"].ToString(),dr[i]["chandoan"].ToString(),dr[i]["maicd"].ToString(),0,
						"",0,"",0,"","",0,0,0,tamung,0,dr[i]["nguoinha"].ToString(),int.Parse(dr[i]["hinhthuc"].ToString()),int.Parse(dr[i]["phuongphap"].ToString()),int.Parse(dr[i]["ketqua"].ToString()),dr[i]["soluutru"].ToString(),
						0,dr[i]["ngaypt"].ToString(),dr[i]["tenpt"].ToString(),loaiba,int.Parse(dr[i]["done"].ToString()),dr[i]["mabs"].ToString(),dr[i]["tenbs"].ToString(),dr[i]["tenuser"].ToString(),dr[i]["image"].ToString(),dr[i]["ghichu"].ToString(),dr[i]["ngay1"].ToString(),dr[i]["ngay2"].ToString(),dr[i]["ngay3"].ToString(),(bTtngay)?dr[i]["ngayvao"].ToString():"",-1,b_sobienlaitamung,0,"","",int.Parse(dr[i]["traituyen"].ToString()),0,0,0);
				}
			}
			#region sosinh
			idkhoa=0;maql=0;idvienphi=0;maql_phongluu=0;
			for(int i=0;i<drss.Length;i++)
			{				
				r1=getrowbyid(dtkp,"makp='"+drss[i]["makp"].ToString()+"'");				
				i_madoituongvao=int.Parse(drss[i]["madoituongvao"].ToString());
				tamung=0;sotien=0;bhyt=0;mien=0;
				if (bndot || bKhu) idkhoa=long.Parse(drss[i]["idkhoa"].ToString());
				maql=long.Parse(drss[i]["maql"].ToString());
				if (bVienphi_phongluu) maql_phongluu=get_maql_phongluu(maql);
				else maql_phongluu=0;
				if (maql_phongluu==maql) maql_phongluu=0;
				if (drss[i]["done"].ToString()=="0"  && int.Parse(drss[i]["madoituong"].ToString())!=i_haophi)
				{
					s_idvienphi=get_id_thvp((int.Parse(drss[i]["motkhu"].ToString())==1)?0:int.Parse(drss[i]["khu"].ToString()),drss[i]["mame"].ToString(),long.Parse(drss[i]["maqlme"].ToString()),long.Parse(drss[i]["idkhoame"].ToString()),drss[i]["ngayvaome"].ToString(),drss[i]["ngayra"].ToString(),ngayserver,bTheongay);
					if (s_idvienphi=="") 
					{
						s_mmyy=mmyy_server;
						idvienphi=get_id_thvp();
					}
					else
					{
						s_mmyy=s_idvienphi.Substring(0,4);
						idvienphi=long.Parse(s_idvienphi.Substring(4));
					}
				}
				tamung=get_tamung_ct((int.Parse(drss[i]["motkhu"].ToString())==1)?0:int.Parse(drss[i]["khu"].ToString())
					,drss[i]["mabn"].ToString(),maql,idkhoa
					,drss[i]["ngayvao"].ToString(),drss[i]["ngayra"].ToString()
					,(makp=="")?"":drss[i]["makp"].ToString()
					,int.Parse(drss[i]["madoituong"].ToString())
					,int.Parse(drss[i]["done"].ToString()),maql_phongluu
					,loaiba,drss[i]["maso"].ToString(),bTheongay,ngayvaovien);
				tc_tamung+=tamung;
				if (!bBosolieuduoc)
				{
					#region Thuoc_ss
					tmp=get_thuoc_ct((int.Parse(drss[i]["motkhu"].ToString())==1)?0:int.Parse(drss[i]["khu"].ToString())
						,drss[i]["mabn"].ToString(),maql,idkhoa
						,drss[i]["ngayvao"].ToString(),drss[i]["ngayra"].ToString()
						,(makp=="" || r1==null)?0:int.Parse(r1["id"].ToString())
						,int.Parse(drss[i]["madoituong"].ToString())
						,int.Parse(drss[i]["done"].ToString()),maql_phongluu
						,bChenhlechdv,bCapve,bNgtr,loaiba
						,drss[i]["makp"].ToString(),0,drss[i]["maso"].ToString()
						,bTheongay,bThanhtoanndot,bTTRV_theokhoa,ngayvaovien);
					if (tmp!=null)
					{
						foreach(DataRow r in tmp.Rows)
						{													
							r2=getrowbyid(dtbd,"id="+int.Parse(r["mabd"].ToString()));
							if (r2!=null)
							{
								//
								if(s_mabd.IndexOf(r["mabd"].ToString()+",")<0)s_mabd+=r["mabd"].ToString()+",";
								//
								iBhyt=int.Parse(r2["bhyt"].ToString());
								DataRow rkp=getrowbyid(dtkp,"makp='"+r["makp"].ToString()+"'");
								if(rkp!=null)s_tenkp=rkp["ten"].ToString();
								else s_tenkp=drss[i]["tenkp"].ToString();
								s_madt=drss[i]["madoituong"].ToString().Trim();
								i_madt=int.Parse(s_madt);
								s_dtuong=drss[i]["doituong"].ToString();
								s_ten=r2["ten"].ToString();
								dongia=decimal.Parse(r["dongia"].ToString());
								dg1=dongia;dg2=0;st2=0;st1=decimal.Parse(r["sotien"].ToString());
								if (bChenhlechdv && s_madt==i_tunguyen.ToString().Trim() && chenhlech.IndexOf(i_madoituongvao.ToString().Trim()+",")!=-1 && decimal.Parse(r2["bhyt"].ToString())>0 && r["loai"].ToString().Trim()=="1" && Math.Round(decimal.Parse(r["giaban"].ToString()),2)!=Math.Round(decimal.Parse(r["giamua"].ToString()),2))
								{
									i_madt=i_madoituongvao;
									r1=getrowbyid(dtdt,"madoituong="+i_madt);
									if (r1!=null) s_dtuong=r1["doituong"].ToString();
									dg1=decimal.Parse(r["giamua"].ToString());
									st1=decimal.Parse(r["soluong"].ToString())*dg1;
								}
								else if (bDoituong_BHYT(int.Parse(s_madt),dtdt) && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))//else if (s_madt=="1" && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))
								{
									s_ten+=" BHYT thanh toán "+r2["bhyt"].ToString().Trim()+" %";
									dg1=dongia*decimal.Parse(r2["bhyt"].ToString())/100;
									st1=decimal.Parse(r["bhyt"].ToString());
								}
								dg2=0;
								if (bChenhlechdv && s_madt==i_tunguyen.ToString().Trim() && chenhlech.IndexOf(i_madoituongvao.ToString().Trim()+",")!=-1 && decimal.Parse(r2["bhyt"].ToString())>0 && r["loai"].ToString().Trim()=="1" && Math.Round(decimal.Parse(r["giaban"].ToString()),2)!=Math.Round(decimal.Parse(r["giamua"].ToString()),2))
								{
									dg2=decimal.Parse(r["giaban"].ToString())-decimal.Parse(r["giamua"].ToString());
								}
								updrec_ravien(ds,int.Parse(drss[i]["khu"].ToString()),drss[i]["mame"].ToString(),drss[i]["mabn"].ToString(),long.Parse(drss[i]["maql"].ToString()),long.Parse(drss[i]["idkhoa"].ToString()),drss[i]["hoten"].ToString(),drss[i]["namsinh"].ToString(),drss[i]["phai"].ToString(),
									drss[i]["diachi"].ToString(),i_madt,s_dtuong,"",iBhyt,drss[i]["tungay"].ToString(),drss[i]["denngay"].ToString(),drss[i]["noigioithieu"].ToString(),drss[i]["noicap"].ToString(),
									drss[i]["giuong"].ToString(),r["makp"].ToString()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),s_tenkp.Trim()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),drss[i]["ngayvao"].ToString(),drss[i]["ngayra"].ToString(),drss[i]["chandoan"].ToString(),drss[i]["maicd"].ToString(),int.Parse(r2["sttnhom"].ToString()),
									r2["nhom"].ToString(),int.Parse(r2["sttloai"].ToString()),r2["loai"].ToString(),int.Parse(r["mabd"].ToString()),
									s_ten,r2["dvt"].ToString(),decimal.Parse(r["soluong"].ToString()),
									st1,
									decimal.Parse(r["bhyt"].ToString()),tamung,decimal.Parse(r["bhytt0107"].ToString()),drss[i]["nguoinha"].ToString(),int.Parse(drss[i]["hinhthuc"].ToString()),int.Parse(drss[i]["phuongphap"].ToString()),int.Parse(drss[i]["ketqua"].ToString()),drss[i]["soluutru"].ToString(),
									dg1,drss[i]["ngaypt"].ToString(),drss[i]["tenpt"].ToString(),loaiba,int.Parse(drss[i]["done"].ToString()),drss[i]["mabs"].ToString(),drss[i]["tenbs"].ToString(),drss[i]["tenuser"].ToString(),drss[i]["image"].ToString(),drss[i]["ghichu"].ToString(),drss[i]["ngay1"].ToString(),drss[i]["ngay2"].ToString(),drss[i]["ngay3"].ToString(),(bTtngay)?r["ngay"].ToString():"",-1,b_sobienlaitamung,int.Parse(drss[i]["traituyen"].ToString()),dg2);

								if (drss[i]["done"].ToString()=="0" && (int.Parse(drss[i]["madoituong"].ToString())!=i_haophi || (int.Parse(drss[i]["madoituong"].ToString())==i_haophi && bHaophi_vp)))
									upd_thvpct(s_mmyy,idvienphi,r["ngay"].ToString(),r["makp"].ToString(),i_madt,long.Parse(r["mabd"].ToString()),decimal.Parse(r["soluong"].ToString()),dg1,st1,0,"");

								if (bChenhlechdv && s_madt==i_tunguyen.ToString().Trim() && chenhlech.IndexOf(i_madoituongvao.ToString().Trim()+",")!=-1 && decimal.Parse(r2["bhyt"].ToString())>0 && r["loai"].ToString().Trim()=="1" && Math.Round(decimal.Parse(r["giaban"].ToString()),2)!=Math.Round(decimal.Parse(r["giamua"].ToString()),2))
								{
									//
									if(s_mabd_chenhlech.IndexOf(r["mabd"].ToString()+",")<0)s_mabd_chenhlech+=r["mabd"].ToString()+",";
									//
									i_madt=int.Parse(s_madt);
									r1=getrowbyid(dtdt,"madoituong="+i_madt);
									if (r1!=null) s_dtuong=r1["doituong"].ToString();
									s_ten+=" BN thanh toán chênh lệch ";
									dg2=decimal.Parse(r["giaban"].ToString())-decimal.Parse(r["giamua"].ToString());
									st2=decimal.Parse(r["soluong"].ToString())*dg2;
								}
								else if (bDoituong_BHYT(int.Parse(s_madt),dtdt) && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))//else if (s_madt=="1" && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))
								{
									i_madt=i_tunguyen;
									s_dtuong=s_doituong;
									s_ten=r2["ten"].ToString();
									decimal bn=100-decimal.Parse(r2["bhyt"].ToString());
									s_ten+=" BN thanh toán "+bn.ToString().Trim()+" %";
									dg2=dongia*bn/100;
									st2=decimal.Parse(r["sotien"].ToString())-decimal.Parse(r["bhyt"].ToString());
								}
								
								if (dg2>0)
								{
									updrec_ravien(ds,int.Parse(drss[i]["khu"].ToString()),drss[i]["mame"].ToString(),drss[i]["mabn"].ToString(),long.Parse(drss[i]["maql"].ToString()),long.Parse(drss[i]["idkhoa"].ToString()),drss[i]["hoten"].ToString(),drss[i]["namsinh"].ToString(),drss[i]["phai"].ToString(),
										drss[i]["diachi"].ToString(),i_madt,s_dtuong,"",iBhyt,drss[i]["tungay"].ToString(),drss[i]["denngay"].ToString(),drss[i]["noigioithieu"].ToString(),drss[i]["noicap"].ToString(),
										drss[i]["giuong"].ToString(),r["makp"].ToString()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),s_tenkp.Trim()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),drss[i]["ngayvao"].ToString(),drss[i]["ngayra"].ToString(),drss[i]["chandoan"].ToString(),drss[i]["maicd"].ToString(),int.Parse(r2["sttnhom"].ToString()),
										r2["nhom"].ToString(),int.Parse(r2["sttloai"].ToString()),r2["loai"].ToString(),int.Parse(r["mabd"].ToString()),
										s_ten,r2["dvt"].ToString(),decimal.Parse(r["soluong"].ToString()),
										st2,
										decimal.Parse(r["bhyt"].ToString()),tamung,decimal.Parse(r["bhytt0107"].ToString()),drss[i]["nguoinha"].ToString(),int.Parse(drss[i]["hinhthuc"].ToString()),int.Parse(drss[i]["phuongphap"].ToString()),int.Parse(drss[i]["ketqua"].ToString()),drss[i]["soluutru"].ToString(),
										dg2,drss[i]["ngaypt"].ToString(),drss[i]["tenpt"].ToString(),loaiba,int.Parse(drss[i]["done"].ToString()),drss[i]["mabs"].ToString(),drss[i]["tenbs"].ToString(),drss[i]["tenuser"].ToString(),drss[i]["image"].ToString(),drss[i]["ghichu"].ToString(),drss[i]["ngay1"].ToString(),drss[i]["ngay2"].ToString(),drss[i]["ngay3"].ToString(),(bTtngay)?r["ngay"].ToString():"",-1,b_sobienlaitamung,(r["idttrv"].ToString()!="")?long.Parse(r["idttrv"].ToString()):0,"","",int.Parse(drss[i]["traituyen"].ToString()),0,0,0);
									if (drss[i]["done"].ToString()=="0"  && int.Parse(drss[i]["madoituong"].ToString())!=i_haophi)
										upd_thvpct(s_mmyy,idvienphi,r["ngay"].ToString(),r["makp"].ToString(),i_madt,long.Parse(r["mabd"].ToString()),decimal.Parse(r["soluong"].ToString()),dg2,st2,0,"");
								}
								if (drss[i]["done"].ToString()=="0" && (int.Parse(drss[i]["madoituong"].ToString())!=i_haophi || (int.Parse(drss[i]["madoituong"].ToString())==i_haophi && bHaophi_vp)))
								{
									sotien+=decimal.Parse(r["sotien"].ToString());
									bhyt+=decimal.Parse(r["bhyt"].ToString());
								}
							}
						}
					}
					#endregion Thuoc_ss
				}
				#region  Vienphi_ss
				tmp=get_vienphi_ct((int.Parse(drss[i]["motkhu"].ToString())==1)?0:int.Parse(drss[i]["khu"].ToString())
					,drss[i]["mabn"].ToString(),maql,idkhoa
					,drss[i]["ngayvao"].ToString(),drss[i]["ngayra"].ToString()
					,(makp=="")?"":drss[i]["makp"].ToString()
					,int.Parse(drss[i]["madoituong"].ToString())
					,int.Parse(drss[i]["done"].ToString()),maql_phongluu,bCapve
					,bNgtr,loaiba,makp_rv,0,drss[i]["maso"].ToString(),bTheongay
					,bThanhtoanndot,bTTRV_theokhoa,ngayvaovien);
				if (tmp!=null)
				{
					foreach(DataRow r in tmp.Rows)
					{
						DataRow rkp=getrowbyid(dtkp,"makp='"+r["makp"].ToString()+"'");
						if(rkp!=null)s_tenkp=rkp["ten"].ToString();
						else s_tenkp=drss[i]["tenkp"].ToString();
						r2=getrowbyid(dtvp,"id="+int.Parse(r["mavp"].ToString()));
						if (r2!=null)
						{
							iBhyt=int.Parse(r2["bhyt"].ToString());
							s_madt=drss[i]["madoituong"].ToString();
							i_madt=int.Parse(s_madt);
							s_dtuong=drss[i]["doituong"].ToString();
							s_ten=r2["ten"].ToString();
							f1="th";f2="th";
							//
							dongia=decimal.Parse(r["dongia"].ToString());
							dg1=dongia;dg2=0;st2=0;st1=decimal.Parse(r["sotien"].ToString());
							r1=getrowbyid(dtdt,"madoituong in("+sMaDoituong_BHYT().Trim().Trim(',')+")");//r1=getrowbyid(dtdt,"madoituong=1");
							if (r1!=null) f1=r1["field_gia"].ToString().Trim().Substring(r1["field_gia"].ToString().Trim().IndexOf("_")+1);
							r1=getrowbyid(dtdt,"madoituong="+i_madt);
							if (r1!=null) f2=r1["field_gia"].ToString().Trim().Substring(r1["field_gia"].ToString().Trim().IndexOf("_")+1);
							if (bChenhlechdv && s_madt==i_tunguyen.ToString().Trim() && chenhlech.IndexOf(i_madoituongvao.ToString().Trim()+",")!=-1 && decimal.Parse(r2["bhyt"].ToString())>0 && decimal.Parse(r2["gia_"+f1.Trim()].ToString())<=decimal.Parse(r2["gia_"+f2.Trim()].ToString()))
							{
								i_madt=i_madoituongvao;
								r1=getrowbyid(dtdt,"madoituong="+i_madt);
								if (r1!=null) s_dtuong=r1["doituong"].ToString();
								dg1=decimal.Parse(r2["gia_"+f1.Trim()].ToString())+decimal.Parse(r2["vattu_"+f1.Trim()].ToString());
								st1=decimal.Parse(r["soluong"].ToString())*dg1;
							}
							else if (bDoituong_BHYT(int.Parse(s_madt),dtdt) && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))//else if (s_madt=="1" && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))
							{
								s_ten+=" BHYT thanh toán "+r2["bhyt"].ToString().Trim()+" %";
								dg1=dongia*decimal.Parse(r2["bhyt"].ToString())/100;
								st1=decimal.Parse(r["bhyt"].ToString());
							}	
							//
							dg2=0;
							if (bChenhlechdv && s_madt==i_tunguyen.ToString().Trim() && chenhlech.IndexOf(i_madoituongvao.ToString().Trim()+",")!=-1 && decimal.Parse(r2["bhyt"].ToString())>0 && decimal.Parse(r2["gia_"+f1.Trim()].ToString())<decimal.Parse(r2["gia_"+f2.Trim()].ToString()))
							{
								dg2=decimal.Parse(r2["gia_"+f2.Trim()].ToString())+decimal.Parse(r2["vattu_"+f2.Trim()].ToString())-dg1;
							}
							else if (bDoituong_BHYT(int.Parse(s_madt),dtdt) && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))//else if (s_madt=="1" && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))
							{
								decimal bn2=100-decimal.Parse(r2["bhyt"].ToString());
								dg2=dongia*bn2/100;
							}
							//
							updrec_ravien(ds,int.Parse(drss[i]["khu"].ToString()),drss[i]["mame"].ToString(),drss[i]["mabn"].ToString(),long.Parse(drss[i]["maql"].ToString()),long.Parse(drss[i]["idkhoa"].ToString()),drss[i]["hoten"].ToString(),drss[i]["namsinh"].ToString(),drss[i]["phai"].ToString(),
								drss[i]["diachi"].ToString(),i_madt,s_dtuong,"",iBhyt,drss[i]["tungay"].ToString(),drss[i]["denngay"].ToString(),drss[i]["noigioithieu"].ToString(),drss[i]["noicap"].ToString(),
								drss[i]["giuong"].ToString(),r["makp"].ToString()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),s_tenkp.Trim()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),drss[i]["ngayvao"].ToString(),drss[i]["ngayra"].ToString(),drss[i]["chandoan"].ToString(),drss[i]["maicd"].ToString(),int.Parse(r2["sttnhom"].ToString()),
								r2["nhom"].ToString(),int.Parse(r2["sttloai"].ToString()),r2["loai"].ToString(),int.Parse(r["mavp"].ToString()),
								s_ten,r2["dvt"].ToString(),decimal.Parse(r["soluong"].ToString()),
								st1,
								decimal.Parse(r["bhyt"].ToString()),tamung,decimal.Parse(r["bhytt0107"].ToString()),drss[i]["nguoinha"].ToString(),int.Parse(drss[i]["hinhthuc"].ToString()),int.Parse(drss[i]["phuongphap"].ToString()),int.Parse(drss[i]["ketqua"].ToString()),drss[i]["soluutru"].ToString(),
								dg1,drss[i]["ngaypt"].ToString(),drss[i]["tenpt"].ToString(),loaiba,int.Parse(drss[i]["done"].ToString()),drss[i]["mabs"].ToString(),drss[i]["tenbs"].ToString(),drss[i]["tenuser"].ToString(),drss[i]["image"].ToString(),drss[i]["ghichu"].ToString(),drss[i]["ngay1"].ToString(),drss[i]["ngay2"].ToString(),drss[i]["ngay3"].ToString(),(bTtngay)?r["ngay"].ToString():"",-1,b_sobienlaitamung,int.Parse(drss[i]["traituyen"].ToString()),dg2);

							if (drss[i]["done"].ToString()=="0" && (int.Parse(drss[i]["madoituong"].ToString())!=i_haophi || (int.Parse(drss[i]["madoituong"].ToString())==i_haophi && bHaophi_vp)))
								upd_thvpct(s_mmyy,idvienphi,r["ngay"].ToString(),r["makp"].ToString(),i_madt,long.Parse(r["mavp"].ToString()),decimal.Parse(r["soluong"].ToString()),dg1,st1,decimal.Parse(r["vattu"].ToString()),"");
							
							//
							dg2=0;
							if (bChenhlechdv && s_madt==i_tunguyen.ToString().Trim() && chenhlech.IndexOf(i_madoituongvao.ToString().Trim()+",")!=-1 && decimal.Parse(r2["bhyt"].ToString())>0 && decimal.Parse(r2["gia_"+f1.Trim()].ToString())<decimal.Parse(r2["gia_"+f2.Trim()].ToString()))
							{
								i_madt=int.Parse(s_madt);
								r1=getrowbyid(dtdt,"madoituong="+i_madt);
								if (r1!=null) s_dtuong=r1["doituong"].ToString();
								s_ten+=" BN thanh toán chênh lệch ";
								dg2=decimal.Parse(r2["gia_"+f2.Trim()].ToString())+decimal.Parse(r2["vattu_"+f2.Trim()].ToString())-dg1;
								st2=decimal.Parse(r["soluong"].ToString())*dg2;
							}
							else if (bDoituong_BHYT(int.Parse(s_madt),dtdt) && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))//else if (s_madt=="1" && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))
							{
								s_ten=r2["ten"].ToString();
								decimal bn=100-decimal.Parse(r2["bhyt"].ToString());
								s_ten+=" BN thanh toán "+bn.ToString().Trim()+" %";
								dg2=dongia*bn/100;
								st2=decimal.Parse(r["sotien"].ToString())-decimal.Parse(r["bhyt"].ToString());
							}
							if (dg2>0)
							{
								updrec_ravien(ds,int.Parse(drss[i]["khu"].ToString()),drss[i]["mame"].ToString(),drss[i]["mabn"].ToString(),long.Parse(drss[i]["maql"].ToString()),long.Parse(drss[i]["idkhoa"].ToString()),drss[i]["hoten"].ToString(),drss[i]["namsinh"].ToString(),drss[i]["phai"].ToString(),
									drss[i]["diachi"].ToString(),i_madt,s_dtuong,"",iBhyt,drss[i]["tungay"].ToString(),drss[i]["denngay"].ToString(),drss[i]["noigioithieu"].ToString(),drss[i]["noicap"].ToString(),
									drss[i]["giuong"].ToString(),r["makp"].ToString()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),s_tenkp.Trim()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),drss[i]["ngayvao"].ToString(),drss[i]["ngayra"].ToString(),drss[i]["chandoan"].ToString(),drss[i]["maicd"].ToString(),int.Parse(r2["sttnhom"].ToString()),
									r2["nhom"].ToString(),int.Parse(r2["sttloai"].ToString()),r2["loai"].ToString(),int.Parse(r["mavp"].ToString()),
									s_ten,r2["dvt"].ToString(),decimal.Parse(r["soluong"].ToString()),
									st2,
									decimal.Parse(r["bhyt"].ToString()),tamung,decimal.Parse(r["bhytt0107"].ToString()),drss[i]["nguoinha"].ToString(),int.Parse(drss[i]["hinhthuc"].ToString()),int.Parse(drss[i]["phuongphap"].ToString()),int.Parse(drss[i]["ketqua"].ToString()),drss[i]["soluutru"].ToString(),
									dg2,drss[i]["ngaypt"].ToString(),drss[i]["tenpt"].ToString(),loaiba,int.Parse(drss[i]["done"].ToString()),drss[i]["mabs"].ToString(),drss[i]["tenbs"].ToString(),drss[i]["tenuser"].ToString(),drss[i]["image"].ToString(),drss[i]["ghichu"].ToString(),drss[i]["ngay1"].ToString(),drss[i]["ngay2"].ToString(),drss[i]["ngay3"].ToString(),(bTtngay)?r["ngay"].ToString():"",-1,b_sobienlaitamung,(r["idttrv"].ToString()!="")?long.Parse(r["idttrv"].ToString()):0,"","",int.Parse(drss[i]["traituyen"].ToString()),0,0,-1);
								if (drss[i]["done"].ToString()=="0"  && int.Parse(drss[i]["madoituong"].ToString())!=i_haophi)
									upd_thvpct(s_mmyy,idvienphi,r["ngay"].ToString(),r["makp"].ToString(),i_madt,long.Parse(r["mavp"].ToString()),decimal.Parse(r["soluong"].ToString()),dg2,st2,decimal.Parse(r["vattu"].ToString()),"");
							}
							if (drss[i]["done"].ToString()=="0" && (int.Parse(drss[i]["madoituong"].ToString())!=i_haophi || (int.Parse(drss[i]["madoituong"].ToString())==i_haophi && bHaophi_vp)))
							{									
								sotien+=decimal.Parse(r["sotien"].ToString());
								bhyt+=decimal.Parse(r["bhyt"].ToString());
							}
						}
					}
				}
				#endregion Vienphi_ss
				if (drss[i]["done"].ToString()=="0" && ((bHaophi_vienphi==false && int.Parse(dr[i]["madoituong"].ToString())!=i_haophi)||bHaophi_vienphi==true) ) //&& int.Parse(drss[i]["madoituong"].ToString())!=i_haophi)
				{
					if (bDoituong_BHYT(int.Parse(drss[i]["madoituong"].ToString()),dtdt))//if (drss[i]["madoituong"].ToString()=="1") //bhyt
					{
						if (drss[i]["maphu"].ToString()=="0") // Ko cung chi tra
						{
							bhyt=sotien;sotien=0;
						}
						else sotien=sotien-bhyt;
					}
					else if (mien_doituong(int.Parse(drss[i]["madoituong"].ToString()),dtdt)) //mien
					{
						mien=sotien;sotien=0;bhyt=0;
					}
					else bhyt=0;
					if (get_data("select * from "+user+s_mmyy+".v_thvpll where id="+idvienphi).Tables[0].Rows.Count==0)
						upd_thvpll(s_mmyy,idvienphi,drss[i]["mame"].ToString(),long.Parse(drss[i]["maqlme"].ToString()),long.Parse(drss[i]["idkhoame"].ToString()),drss[i]["ngayvaome"].ToString(),drss[i]["ngayrame"].ToString(),drss[i]["giuong"].ToString(),drss[i]["makpme"].ToString(),drss[i]["chandoanme"].ToString(),drss[i]["maicdme"].ToString(),sotien,tamung,bhyt,mien,int.Parse(drss[i]["khu"].ToString()));
					else execute_data("update "+user+s_mmyy+".v_thvpll set sotien=sotien+"+sotien+",bhyt=bhyt+"+bhyt+",mien=mien+"+mien+",tamung=tamung+"+tamung+" where id="+idvienphi);
				}
			}
			#endregion
			if (ds.Tables[0].Rows.Count==0 && tamung>0)
			{
				for(int i=0;i<dr.Length;i++)
					updrec_ravien(ds,int.Parse(dr[i]["khu"].ToString()),dr[i]["mabn"].ToString(),dr[i]["mabn"].ToString(),long.Parse(dr[i]["maql"].ToString()),long.Parse(dr[i]["idkhoa"].ToString()),dr[i]["hoten"].ToString(),dr[i]["namsinh"].ToString(),dr[i]["phai"].ToString(),
						dr[i]["diachi"].ToString(),i_madt,s_dtuong,dr[i]["sothe"].ToString(),int.Parse(dr[i]["maphu"].ToString()),dr[i]["tungay"].ToString(),dr[i]["denngay"].ToString(),dr[i]["noigioithieu"].ToString(),s_dkkcb,
						dr[i]["giuong"].ToString(),makp,s_tenkp,dr[i]["ngayvao"].ToString(),dr[i]["ngayra"].ToString(),dr[i]["chandoan"].ToString(),dr[i]["maicd"].ToString(),0,
						"",0,"",0,"","",0,0,0,tamung,0,dr[i]["nguoinha"].ToString(),int.Parse(dr[i]["hinhthuc"].ToString()),int.Parse(dr[i]["phuongphap"].ToString()),int.Parse(dr[i]["ketqua"].ToString()),dr[i]["soluutru"].ToString(),
						0,dr[i]["ngaypt"].ToString(),dr[i]["tenpt"].ToString(),loaiba,int.Parse(dr[i]["done"].ToString()),dr[i]["mabs"].ToString(),dr[i]["tenbs"].ToString(),dr[i]["tenuser"].ToString(),dr[i]["image"].ToString(),dr[i]["ghichu"].ToString(),dr[i]["ngay1"].ToString(),dr[i]["ngay2"].ToString(),dr[i]["ngay3"].ToString(),(bTtngay)?dr[i]["ngayvao"].ToString():"",-1,b_sobienlaitamung,0,"","",int.Parse(dr[i]["traituyen"].ToString()),0,0,0);
			}
			if(bMau38_Full)
			{
				DataSet ads1=get_data("select stt, ma, ten from "+user+".v_nhomvp ");			
				foreach(DataRow adr in ads1.Tables[0].Rows)
				{
					for(int i=0;i<dr.Length;i++)
					{
						DataRow []a_dr=ds.Tables[0].Select("madoituong="+dr[i]["madoituong"].ToString());
						if(a_dr.Length>0)
						{
							string s_exp=" madoituong="+dr[i]["madoituong"].ToString()+" and sttnhom="+adr["stt"].ToString();
							DataRow adr1=getrowbyid(ds.Tables[0],s_exp);
							if(adr1==null)
							{
								updrec_ravien(ds,int.Parse(dr[i]["khu"].ToString()),dr[i]["mabn"].ToString(),dr[i]["mabn"].ToString(),long.Parse(dr[i]["maql"].ToString()),long.Parse(dr[i]["idkhoa"].ToString()),dr[i]["hoten"].ToString(),dr[i]["namsinh"].ToString(),dr[i]["phai"].ToString(),
									dr[i]["diachi"].ToString(),int.Parse(dr[i]["madoituong"].ToString()),dr[i]["doituong"].ToString(),dr[i]["sothe"].ToString(),int.Parse(dr[i]["maphu"].ToString()),dr[i]["tungay"].ToString(),dr[i]["denngay"].ToString(),dr[i]["noigioithieu"].ToString(),s_dkkcb,
									dr[i]["giuong"].ToString(),makp,s_tenkp,dr[i]["ngayvao"].ToString(),dr[i]["ngayra"].ToString(),dr[i]["chandoan"].ToString(),dr[i]["maicd"].ToString(),int.Parse(adr["stt"].ToString()),
									adr["ten"].ToString(),0,"",0,"","",0,0,0,0,0,dr[i]["nguoinha"].ToString(),int.Parse(dr[i]["hinhthuc"].ToString()),int.Parse(dr[i]["phuongphap"].ToString()),int.Parse(dr[i]["ketqua"].ToString()),dr[i]["soluutru"].ToString(),
									0,dr[i]["ngaypt"].ToString(),dr[i]["tenpt"].ToString(),loaiba,int.Parse(dr[i]["done"].ToString()),dr[i]["mabs"].ToString(),dr[i]["tenbs"].ToString(),dr[i]["tenuser"].ToString(),dr[i]["image"].ToString(),dr[i]["ghichu"].ToString(),dr[i]["ngay1"].ToString(),dr[i]["ngay2"].ToString(),dr[i]["ngay3"].ToString(),(bTtngay)?dr[i]["ngayvao"].ToString():"",-1,b_sobienlaitamung,0,"","",int.Parse(dr[i]["traituyen"].ToString()),0,0,0);
							}
						}
					}
				}
			}
			if (ngia)
			{
				foreach(DataRow r in dtbd.Select("id in ("+(s_mabd.Trim().Trim(',')==""?"0":s_mabd.Trim().Trim(','))+")"))//foreach(DataRow r in dtbd.Rows)
				{
					r1=getrowbyid(dtvp,"id="+long.Parse(r["id"].ToString()));
					if (r1==null)
					{
						r2=dtvp.NewRow();
						r2["id"]=r["id"].ToString();
						r2["ma"]=r["ma"].ToString();
						r2["ten"]=r["ten"].ToString();
						r2["dvt"]=r["dvt"].ToString();
						r2["sttloai"]=r["sttloai"].ToString();
						r2["loai"]=r["loai"].ToString();
						r2["sttnhom"]=r["sttnhom"].ToString();
						r2["nhom"]=r["nhom"].ToString();
						r2["bhyt"]=r["bhyt"].ToString();
						r2["gia_th"]=r2["gia_bh"]=r2["gia_dv"]=r2["gia_nn"]=r2["gia_cs"]=r["gia_bh"].ToString();
						r2["vattu_th"]=r2["vattu_bh"]=r2["vattu_dv"]=r2["vattu_nn"]=r2["vattu_cs"]=0;
						r2["kythuat"]=r["kythuat"].ToString();
						if(s_mabd_chenhlech.IndexOf(r["id"].ToString()+",")<0)r2["chenhlech"]=0;
						else r2["chenhlech"]=1;
						r2["vuottuyen"]=-1;
						dtvp.Rows.Add(r2);
					}
				}
			}
			
			return sort_ttravien_ct(mmyy_server,ngayserver,loaiba,dtdt,ds.Tables[0].Select("true","khu,matt,mabn,sothe,madoituong,yyyymmdd,sttnhom,tenkp,ten"),makp_rv,ngia,dtvp,ds.Tables[0],i_madoituongvao);//,ten"));
		}

		//dùng làm điều kiện: nếu BN co 2 the BHYT và chuyển từ PL vào nội trú, thì chỉ lấy 1 lần chi phí PL.
		int ii_madoituong=0;
		bool bPhongluu=false;
		//
		
		public DataSet get_ttravien_ct(DataSet ds,DataRow [] dr,DataRow [] drss
			,DataTable dtkp,DataTable dtbd,DataTable dtvp,string makp
			,bool bVienphi_phongluu,int loaiba,string makp_rv,bool bThanhtoanndot
			,bool ngia,bool bTheongay,string ngayvaovien)
		{	
			//linh
			int soledongiakhithanhtoan=SoLeDonGiaKhiThanhToan;
			string s_theduochuongcpvc=MaDoiTuongTheHuong100CPVC;
			try{ds.Tables[0].Columns.Add("VUOTTRAN",typeof(decimal)).DefaultValue=0;}
			catch{}
			ds.Clear();			
			bool bTTRV_theokhoa=bThanhtoan_theokhoa;
			bool bSothengayhuong=bSothe_ngay_huong;
			bool bMau38_Full=bInPhieuThanhtoanravien_daydu;
			bool bTienthuoc_tinhchenhlech=bThanhtoanchenhlech_thuoc;
			bool bktCao_ttDV=bktCao_tinhtungDV;
			DataRow r1,r2;
			DataRow [] r3;
			DataTable tmp;
			sql="select 0 as loai,id,bhyt,to_char(ngayud,'yyyymmddhh24mi') as ngaygio,to_char(ngayud,'yyyymmdd') as ngay,gia_bh from d_dmbd_luu";
			sql+=" union all ";
			sql+="select 1 as loai,id,bhyt,to_char(ngayud,'yyyymmddhh24mi') as ngaygio,to_char(ngayud,'yyyymmdd') as ngay,gia_bh from d_dmbd";
			DataTable dtbdfull=get_data(sql).Tables[0];
			DataTable dtkpm=new DataTable();
			dtkpm=get_data("select * from btdkp_bv").Tables[0];
			tc_tamung=0;
			b_tatca_sobienlaitamung="";
			string _maql="", s_mabd="", s_mabd_chenhlech="";
			string s_ngaytrinh="",s_ngayduyet="", s_ngaygiahan="";
			bool bKhongchiphi=true;
			string m_madoituong_inttrv="";
			for(int i=0;i<dr.Length;i++)
			{
				if ((bDoituong_BHYT (int.Parse(dr[i]["madoituong"].ToString()))||bDoituong_BHYT(int.Parse(dr[i]["madoituongvao"].ToString()))) && _maql.ToString().IndexOf(dr[i]["maql"].ToString()+",")==-1) _maql+=dr[i]["maql"].ToString()+",";
				//if ((dr[i]["madoituong"].ToString()=="1" || dr[i]["madoituongvao"].ToString()=="1") && _maql.ToString().IndexOf(dr[i]["maql"].ToString()+",")==-1) _maql+=dr[i]["maql"].ToString()+",";				
			}
			DataTable dtbhyt=new DataTable();
			bool bBhyt=false,b701424=Mabv_so==701424,bchenhlech_giavp=bChenhlech_giavp,bCont,bchenhlech_tructiep=bChenhlech_tructiep,bchenhlech_traituyen=bChenhlech_traituyen;
			if (_maql!="")
			{
				sql="select a.maql,a.sothe,to_char(a.tungay,'dd/mm/yyyy') as tungay,to_char(a.denngay,'dd/mm/yyyy') as denngay,";
				sql+="to_char(a.tungay,'yyyymmdd') as tu,to_char(a.denngay,'yyyymmdd') as den,";
				sql+="to_char(a.ngay1,'dd/mm/yyyy') as ngay1,to_char(a.ngay2,'dd/mm/yyyy') as ngay2,to_char(a.ngay3,'dd/mm/yyyy') as ngay3,b.tenbv||'^'||a.mabv||'^'||c.ten as tenbv ";
				sql+=" ,to_char(a.ngaytrinh,'dd/mm/yyyy') as ngaytrinh, to_char(a.ngayduyet,'dd/mm/yyyy') as ngayduyet, to_char(a.ngaygiahan,'dd/mm/yyyy') as ngaygiahan ";
				sql+=" from bhyt a,dmnoicapbhyt b, dmnoicap c where a.mabv=b.mabv(+) and a.manoicap=c.id(+) and a.maql in ("+_maql.Substring(0,_maql.Length-1)+")";
				sql+=" order by a.tungay,a.denngay";
				dtbhyt=get_data(sql).Tables[0];
				bBhyt=true;
			}
			bool bgia_bh_quydinh_giamua = bGia_bh_quydinh_giamua;
			string chenhlech="";
			DataTable dtdt=get_data("select * from doituong").Tables[0];
			foreach(DataRow r in dtdt.Select("chenhlech=1")) chenhlech+=r["madoituong"].ToString().Trim()+",";
			bool bRavien_hc=bRavien_hcbd,bHaophi_vp=bHaophi_vienphi;			
			if (bHaophi_thanhtoan)
			{
				r1=getrowbyid(dtdt,"madoituong="+iHaophi);
				if (r1==null)
				{
					r2=dtdt.NewRow();
					r2["madoituong"]=iHaophi;
					r2["doituong"]="Hao phí";
					r2["sothe"]=0;
					r2["ngay"]=0;
					r2["mabv"]=0;
					r2["mien"]=1;
					r2["field_gia"]="gia_th";
					r2["trasau"]=0;
					r2["cholam"]=0;
					dtdt.Rows.Add(r2);
				}
			}
			
			string s_doituong="Thu phí",s_mabn="",s_idvienphi="",tmp_idvienphi="";
			string s_madt="",s_dtuong="",s_ten="",s_tenkp="",s_denngay="",s_tungay="",s_dkkcb="",s_sothe="",str;
			decimal dg1,dg2,dongia,tamung=0,sotien=0,bhyt=0,mien=0,st1,st2,giamua=0,dg1k,dg2k,st1k,st2k,st;
			
			string ngayserver=ngayhienhanh_server,s_mmyy=mmyy(ngayserver),f1,f2,mmyy_server=s_mmyy,ngay1="",ngay2="",ngay3="",ngayvao="",xxx;
			if (!bMmyy(s_mmyy))
			{
				LibDuoc.AccessData d=new LibDuoc.AccessData();
				d.tao_user_mmyy(s_mmyy,0);
			}
			upd_capsotoa(mmyy_server,loaiba,ngayserver,0,0);
			long idkhoa=0,maql=0,idvienphi=0,maql_phongluu=0,mavaovien=0;
			b_sobienlaitamung="";
			bool bChenhlechdv=bChenhlech,bCapve=bCapve_noitru||bCapve_Phongluu,bNgtr=false,bNgtr_ntr=bBHYTngtr_noitru,bndot=bThanhtoanndot || loaiba==2,bKhu=bThanhtoan_khu,bDenngay,bTungay,bChenhlech_dt=bChenhlech_doituong,bTtngay=(bTheongay)?true:bThanhtoan_ngay;
			int i_madoituongvao=0,i_tunguyen=iTunguyen,i_madt=0,i_haophi=iHaophi,maphu=0,nhom=nhom_duoc,kythuat=-1,noitiepdon=1;
			decimal iBhyt=0;
			r1=getrowbyid(dtdt,"madoituong="+i_tunguyen);
			if (r1!=null) s_doituong=r1["doituong"].ToString();
			long maql_save=0,maql_pk=0;
			decimal mucbhquidinh=muc_bhquidinh,muckhongqua=ck2_ca3_26,stc=0;
			int phantrambhyt=100;//phantram_bhyt;
			bool nhom1,nhom2;
			string huong100=huong_100+"+"+cc1_te1, huong100kqua=huong_100_khongqua+"+"+ck2_ca3,huong95kqua=bt4_hn4_ht5;
			bool bgia_bh_quydinh=bGia_bh_quydinh;
			decimal giaban;
			//
			decimal d_sotien_ktcao=0, d_sotien_ktcao_dinhmuc=ck2_ca3_26;
			bool bFound_ktcao_vuot=false, bCLktcao=false;
			//
			int temp=0;
			for(int i=0;i<dr.Length;i++)
			{		
				//
				if(dr[i]["done"].ToString()=="0"){m_madoituong_inttrv=(dr[i]["chon"].ToString().ToLower()=="true")?","+dr[i]["madoituong"].ToString()+",":",0,";}//binh 070611: && 
				i_tunguyen=iTunguyen_doituong_(int.Parse(dr[i]["madoituong"].ToString()));// ma doi tuong tu nguyen theo tung doi tuong vao
				//
				tamung=0;
				//ThanhCuong-08062011_xử lý ngày vào của bệnh nhân có 2 thẻ bhyt thì ngày vào của thẻ thứ 2 > ngày ra của thẻ thứ 1 và bắt đầu từ 00:00
				ngayvao=dr[i]["ngayvao"].ToString();
				if(temp>0 && int.Parse(dr[i]["madoituong"].ToString())==1) 
				{
					ngayvao=ngayvao.Substring(0,10)+" 00:00";
				}
				temp=temp+1;
				//
				s_denngay=dr[i]["denngay"].ToString();s_tungay=dr[i]["tungay"].ToString();s_sothe=dr[i]["sothe"].ToString();
				s_dkkcb=dr[i]["noicap"].ToString();
				d_sotien_ktcao=0;bFound_ktcao_vuot=false;
				if (dr[i]["denngay"].ToString().Length>20)
				{
					string tmp_dn=s_denngay;
					s_denngay=dr[i]["denngay"].ToString();
					s_denngay=s_denngay.Substring(s_denngay.IndexOf("^")+2,10);
					s_tungay=dr[i]["denngay"].ToString().Substring(0,10);
					//
					string []a_ngaybhyt=tmp_dn.Split('^');
					for(int ij=2;ij<a_ngaybhyt.Length;ij++)
					{
						s_tungay+="^"+a_ngaybhyt[ij].Trim();//tungay^ngaytrinh^ngayduyet^ngayggiahan
					}
					
					//
				}
				r1=getrowbyid(dtkp,"makp='"+dr[i]["makp"].ToString()+"'");				
				i_madoituongvao=int.Parse(dr[i]["madoituongvao"].ToString());
				if (bndot || dr[i]["motkhu"].ToString()=="0") idkhoa=long.Parse(dr[i]["idkhoa"].ToString());
				maql=long.Parse(dr[i]["maql"].ToString());
				mavaovien=0;
				if (bCapve)
				{
					foreach(DataRow row in get_data("select matiepdon from sukien where matiepdon>0 and macap="+maql+" order by noitiepdon").Tables[0].Rows)
					{
						mavaovien=long.Parse(row["matiepdon"].ToString());
						break;
					}
					//					if (mavaovien!=0 && loaiba==4)
					//					{
					//						if (get_data("select b.* from "+user+mmyy(dr[i]["ngayra"].ToString())+".benhandt a,xutrikbct b where a.maql=b.maql and a.mabn='"+dr[i]["mabn"].ToString()+"' and a.mavaovien="+mavaovien+" and b.xutri like '%04,%'").Tables[0].Rows.Count==0)
					//							mavaovien=maql;
					//					}
				}				
				if (bNgtr_ntr && loaiba!=3)
				{	
					if (bMmyy(ngayvao))
					{	
						xxx=user+mmyy(ngayvao);
						noitiepdon=(loaiba==1)?Nhanbenh:(loaiba==2)?Ngoaitru:Phongluu;
						str="select a.mavaovien from "+xxx+".benhandt a,"+xxx+".xutrikbct b where a.maql=b.maql and a.mabn='"+dr[i]["mabn"].ToString()+"' and to_char(a.ngay,'dd/mm/yyyy')='"+ngayvao.Substring(0,10)+"'";
						if (loaiba==1)str+=" and b.xutri like '%05%'";
						else if (loaiba==2) str+=" and b.xutri like '%02%'";
						else str+=" and b.xutri like '%04%'";
						foreach(DataRow row in get_data(str).Tables[0].Rows)
							maql_pk=long.Parse(row["mavaovien"].ToString());						
						if (maql_pk!=0) bNgtr=get_data("select * from sukien where macap="+maql+" and noitiepdon="+noitiepdon+" and matiepdon="+maql_pk).Tables[0].Rows.Count>0;
					}
				}
				if (maql!=maql_save)
				{
					tamung=0;sotien=0;bhyt=0;mien=0;tc_tamung=0;
					maql_save=maql;b_sobienlaitamung="";b_tatca_sobienlaitamung="";
				}
				if (bVienphi_phongluu && loaiba!=4)
				{		
					string _mapl="";
					foreach(DataRow row in get_data("select * from sukien where macap="+maql+" and noitiepdon=4").Tables[0].Rows)
					{
						_mapl+=row["matiepdon"].ToString()+",";
					}
					if (_mapl!="")
					{
						foreach(DataRow row in get_data("select to_char(ngay,'dd/mm/yyyy hh24:mi') as ngayvao from benhandt where maql in ("+_mapl.Substring(0,_mapl.Length-1)+") and loaiba=4").Tables[0].Rows)
						{
							ngayvao=row["ngayvao"].ToString();
							break;
						}
					}
					//binh
					maql_phongluu=get_maql_phongluu(maql);					
					//
				}
				else maql_phongluu=0;				
				if (maql_phongluu==maql) maql_phongluu=0;
				if (dr[i]["done"].ToString()=="0" && int.Parse(dr[i]["madoituong"].ToString())!=i_haophi)
				{
					s_idvienphi=get_id_thvp((int.Parse(dr[i]["motkhu"].ToString())==1)?0:int.Parse(dr[i]["khu"].ToString()),dr[i]["mabn"].ToString(),maql,idkhoa,dr[i]["ngayvao"].ToString(),dr[i]["ngayra"].ToString(),ngayserver,bTheongay);
					if (s_idvienphi!="")
					{
						s_mmyy=s_idvienphi.Substring(0,4);
						idvienphi=long.Parse(s_idvienphi.Substring(4));
						if (s_mabn!=dr[i]["mabn"].ToString())
						{
							s_mabn=dr[i]["mabn"].ToString();
							tmp_idvienphi=idvienphi.ToString()+",";
							//if (!bTheongay) 
							execute_data("delete from "+user+s_mmyy+".v_thvpct where done=0 and id="+idvienphi);
						}
						else if (tmp_idvienphi !="" && tmp_idvienphi.IndexOf(idvienphi.ToString()+",")<0)
						{
							tmp_idvienphi+=idvienphi.ToString()+",";
							//if (!bTheongay) 
							execute_data("delete from "+user+s_mmyy+".v_thvpct where done=0 and id="+idvienphi);
						}
						//
					}
					else 
					{
						s_mmyy=mmyy_server;
						s_mabn=dr[i]["mabn"].ToString();
						idvienphi=get_id_thvp();
						tmp_idvienphi+=idvienphi.ToString()+",";
					}
				}
				tamung+=get_tamung_ct((int.Parse(dr[i]["motkhu"].ToString())==1)?0:int.Parse(dr[i]["khu"].ToString())
					,dr[i]["mabn"].ToString(),maql,idkhoa
					,dr[i]["ngayvao"].ToString(),dr[i]["ngayra"].ToString()
					,(makp=="")?"":dr[i]["makp"].ToString()
					,int.Parse(dr[i]["madoituong"].ToString())
					,int.Parse(dr[i]["done"].ToString()),maql_phongluu
					,loaiba,dr[i]["maso"].ToString(),bTheongay,ngayvaovien);			
				bKhongchiphi=tamung>0;
				if (tamung==0 && b701424 && b_sobienlaitamung.IndexOf("Hoàn trả")==-1) tamung+=get_tamung_ct_424((int.Parse(dr[i]["motkhu"].ToString())==1)?0:int.Parse(dr[i]["khu"].ToString()),dr[i]["mabn"].ToString(),maql,idkhoa,dr[i]["ngayvao"].ToString(),dr[i]["ngayra"].ToString(),(makp=="")?"":dr[i]["makp"].ToString(),int.Parse(dr[i]["madoituong"].ToString()),int.Parse(dr[i]["done"].ToString()),maql_phongluu,loaiba,dr[i]["maso"].ToString());
				tc_tamung+=tamung;
				if(b_tatca_sobienlaitamung.IndexOf(b_sobienlaitamung)<0) b_tatca_sobienlaitamung+=b_sobienlaitamung;
				
				if (dr[i]["done"].ToString()=="0"  && ((bHaophi_vienphi==false && int.Parse(dr[i]["madoituong"].ToString())!=i_haophi)||bHaophi_vienphi==true) )//&& int.Parse(dr[i]["madoituong"].ToString())!=i_haophi)
				{
					if (bDoituong_BHYT(dr[i]["madoituong"].ToString())) //if (dr[i]["madoituong"].ToString()=="1") //bhyt
					{
						if (dr[i]["maphu"].ToString()=="0") // Ko cung chi tra
						{
							bhyt=sotien;sotien=0;
						}
						else sotien=sotien-bhyt;
					}
					else if (mien_doituong(int.Parse(dr[i]["madoituong"].ToString()),dtdt)) //mien
					{
						mien=sotien;sotien=0;bhyt=0;
					}
					else bhyt=0;
					if (sotien+mien+bhyt+tamung!=0) upd_thvpll(s_mmyy,idvienphi,dr[i]["mabn"].ToString(),maql,idkhoa,dr[i]["ngayvao"].ToString(),dr[i]["ngayra"].ToString(),dr[i]["giuong"].ToString(),dr[i]["makp"].ToString(),dr[i]["chandoan"].ToString(),dr[i]["maicd"].ToString(),sotien,tamung,bhyt,mien,int.Parse(dr[i]["khu"].ToString()));
					if (mien+bhyt!=0 && s_sothe!="" && s_sothe.Length<=20) upd_thvpbhyt(s_mmyy,idvienphi,s_sothe,int.Parse(dr[i]["maphu"].ToString()),get_manoigioithieu(maql),get_manoicap(maql),int.Parse(dr[i]["traituyen"].ToString()));//dr[i]["sothe"].ToString().Trim()
					//if (s_sothe!="" && dr[i]["madoituong"].ToString()=="1") upd_thvpbhyt(s_mmyy,idvienphi,s_sothe,int.Parse(dr[i]["maphu"].ToString()),get_manoigioithieu(maql),get_manoicap(maql));//dr[i]["sothe"].ToString().Trim()
				}
				//thuoc
				DataTable dtthuocct=new DataTable();
				dtthuocct=get_thuoc_ct((int.Parse(dr[i]["motkhu"].ToString())==1)?0:int.Parse(dr[i]["khu"].ToString())
					,dr[i]["mabn"].ToString(),maql,idkhoa
					,dr[i]["ngayvao"].ToString(),dr[i]["ngayra"].ToString()
					,(makp=="" || r1==null)?0:int.Parse(r1["id"].ToString())
					,int.Parse(dr[i]["madoituong"].ToString())
					,int.Parse(dr[i]["done"].ToString()),maql_phongluu
					,bChenhlechdv,bCapve,bNgtr,loaiba,dr[i]["makp"].ToString()
					,mavaovien,dr[i]["maso"].ToString(),bTheongay,bThanhtoanndot
					,bTTRV_theokhoa,ngayvaovien);
				//
				#region Vienphi
				//				dtthuocct.DataSet.WriteXml("thuocxml.xml",XmlWriteMode.WriteSchema);
				tmp=get_vienphi_ct((int.Parse(dr[i]["motkhu"].ToString())==1)?0:int.Parse(dr[i]["khu"].ToString()),dr[i]["mabn"].ToString(),maql,idkhoa,dr[i]["ngayvao"].ToString(),dr[i]["ngayra"].ToString(),(makp=="")?"":dr[i]["makp"].ToString(),int.Parse(dr[i]["madoituong"].ToString()),int.Parse(dr[i]["done"].ToString()),maql_phongluu,bCapve,bNgtr,loaiba,makp_rv,mavaovien,dr[i]["maso"].ToString(),bTheongay,bThanhtoanndot,bTTRV_theokhoa,ngayvaovien);
				if (tmp!=null)
				{
					tmp.DataSet.WriteXml("vienphixml.xml",XmlWriteMode.WriteSchema);
					//datarow[] dr là mảng chứa các dòng theo đối tượng thanh toán.ví dụ:bn có thể thanh toán theo thu phí,bhyt,hao phí,miễn.....					
					//duyệt từng dòng giá viện phí.
					foreach(DataRow r in tmp.Select("true","yymmdd"))
					{
						bKhongchiphi=false;
						//lọc theo makp.
						DataRow rkp=getrowbyid(dtkpm,"makp='"+r["makp"].ToString()+"'");
						//nếu có makp trong btdkp_bv thì lấy tên kp,
						if(rkp!=null)s_tenkp=rkp["tenkp"].ToString();//Thuy lấy tên kp từ btdkp_bv thay vì lấy tên từ d_duockp như trước->sai report
						else s_tenkp=dr[i]["tenkp"].ToString();//nếu không tìm thấy makp thì lấy makp mặc định trong chi phí.
						//
						//lấy id viện phí trong table v_giavp.
						r2=getrowbyid(dtvp,"id="+int.Parse(r["mavp"].ToString()));
						maphu=0;nhom1=nhom2=false;
						if (r2!=null)//nếu tồn tại id viện phí này...
						{
							#region lấy toàn bộ thông tin thẻ bhyt
							iBhyt=int.Parse(r2["bhyt"].ToString());//tỷ lệ bhyt.
							ngay1=dr[i]["ngay1"].ToString().Trim();//ngày 1
							ngay2=dr[i]["ngay2"].ToString().Trim();//ngày 2
							ngay3=dr[i]["ngay3"].ToString().Trim();//ngày 3
							if (bBhyt)//nếu là bhyt...
							{
								//lấy dữ liệu từ table bhyt theo maql và đến ngày >=ngay trong thanh toán viện phí.
								r3=dtbhyt.Select("maql="+maql+" and den>="+r["ngay"].ToString().Substring(6,4)+r["ngay"].ToString().Substring(3,2)+r["ngay"].ToString().Substring(0,2),"den");
								if (r3.Length>0)//nếu có dữ liệu...
								{
									//gán lại từng giá trị của thông tin bhyt theo table bhyt.
									s_tungay=r3[0]["tungay"].ToString();//từ ngày.
									s_denngay=r3[0]["denngay"].ToString();//đến ngày.
									s_sothe=r3[0]["sothe"].ToString();//số thẻ
									s_dkkcb=r3[0]["tenbv"].ToString();//tên bv dkkcb
									ngay1=r3[0]["ngay1"].ToString().Trim();//ngày 1
									ngay2=r3[0]["ngay2"].ToString().Trim();//ngày 2
									ngay3=r3[0]["ngay3"].ToString().Trim();//ngày 3
									s_ngaytrinh=r3[0]["ngaytrinh"].ToString();//ngày trình thẻ
									s_ngayduyet=r3[0]["ngayduyet"].ToString();//ngày duyệt thẻ
									s_ngaygiahan=r3[0]["ngaygiahan"].ToString();//gia hạn đến ngày.
									s_tungay+="^"+s_ngaytrinh+"^"+s_ngayduyet+"^"+s_ngaygiahan;//...
								}
							}
							s_madt=dr[i]["madoituong"].ToString();//gán lại madoituong theo đối tượng thanh toán ban đầu truyền vào.
							i_madt=int.Parse(s_madt);//đổi madoituong sang kiểu số.
							s_dtuong=dr[i]["doituong"].ToString();//lấy tên đối tượng.
							#endregion
							
							kythuat=int.Parse(r2["kythuat"].ToString());//lấy field kĩ thuật(0:kĩ thuật cao. 2:thuốc k thải ghép. 1:chăm sóc thai sản. -1:bình thường.
							//nếu chi phí không phải là kĩ thuật bình thường(kythuat!=-1)
							//và là đối tượng bhyt
							//và (đúng là ngày được hưởng chăm sóc,thuốc đặc trị.)chọn option E10
							if (kythuat!=-1 && bDoituong_BHYT(i_madt,dtdt) && bSothengayhuong)
							{
								//lấy mã phụ nội trú theo số thẻ bhyt,điều kiện số thẻ,nhóm,ngày ra viện.
								maphu=(dr[i]["sothe"].ToString().Trim()!="")?get_maphu_noitru(dr[i]["sothe"].ToString(),nhom,dr[i]["ngayra"].ToString().Substring(0,10)):0;
								//
								#region nếu có nhập giá trị 1 trong 3 ngày trên thẻ bhyt thì....
								if (ngay1+ngay2+ngay3!="")
								{
									if ((!bNgay(r["ngay"].ToString(),ngay1) && kythuat==0) //kiểm tra đúng ngày hưởng kĩ thuật cao
										||(!bNgay(r["ngay"].ToString(),ngay2) && kythuat==1) //kiểm tra ngày dc hưởng chăm sóc,
										||(!bNgay(r["ngay"].ToString(),ngay3) && kythuat==2))//kiểm tra ngày hưởng thuốc k,thải ghép.
									{
										i_madt=i_tunguyen;//gán id đối tượng tự nguyện vào đối tượng sẽ thanh toán.
										s_madt=i_madt.ToString();//gán theo madoituong.
										r1=getrowbyid(dtdt,"madoituong="+i_madt);
										if (r1!=null) s_dtuong=r1["doituong"].ToString();//lấy lại tên đối tượng thanh toán.
										
									}										
								}
								#endregion
							}
							s_ten=r2["ten"].ToString();//lấy tên viện phí.
							#region lấy tên tiền công và vật tư.
							//nếu là cuộc mổ thứ 2 thì lấy tên khác tên trong danh mục viện phí.
							if(r["cuocmothu2"].ToString()=="1") s_ten+=" [mổ thứ 2 hưởng 50%]";
							//
							if (decimal.Parse(r["sotien"].ToString())-decimal.Parse(r["vattu"].ToString())>0 //nếu số tiền viện phí trừ tiền vật tư kèm theo mà lớn hơn 0
								&& decimal.Parse(r["vattu"].ToString())>0)//và tiền vật tư lớn hơn 0.
							{
								stc=decimal.Parse(r["sotien"].ToString())-decimal.Parse(r["vattu"].ToString());//tiền công.
								s_ten+="[Tiền công: "+stc.ToString().Trim()+",Tiền vật tư: "+r["vattu"].ToString().Trim()+"]";//tên tiền công.
							}
							#endregion														
							//
							dongia=decimal.Parse(r["dongia"].ToString());//đơn giá.
							dg1=dongia;dg2=0;st2=0;
							st1=decimal.Parse(r["sotien"].ToString());//số tiền.
							#region lấy field giá
							f1="th";//field gia 1
							f2="th";//field gia 2
							//nếu G39. theo đối tượng. thì f1 lấy đối tượng vào.
							//ngược lại: lấy đối tượng thanh toán.
							sql=(bChenhlech_dt)?"madoituong="+i_madoituongvao:"madoituong="+i_madt;
							r1=getrowbyid(dtdt,sql);
							//lấy field giá trong khai báo đối tượng.
							if (r1!=null) f1=r1["field_gia"].ToString().Trim().Substring(r1["field_gia"].ToString().Trim().IndexOf("_")+1);
							//
							//nếu G39. theo đối tượng. thì f2 lấy đối tượng thanh toán.
							//ngược lại: lấy đối tượng tự nguyện.
							sql=(bChenhlech_dt)?"madoituong="+i_madt:"madoituong="+i_tunguyen;
							r1=getrowbyid(dtdt,sql);
							//lấy field giá trong khai báo đối tượng.
							if (r1!=null) f2=r1["field_gia"].ToString().Trim().Substring(r1["field_gia"].ToString().Trim().IndexOf("_")+1);
							//
							#endregion

							bDenngay=true;bTungay=true;//....
							if (s_denngay.Trim().Length==10) bDenngay=bNgay(s_denngay,r["ngay"].ToString().Substring(0,10));
							if (s_tungay.Trim().Length==10) bTungay=bNgay(r["ngay"].ToString().Substring(0,10),s_tungay);
							
							
							#region chenhlech
							//chênh lệch theo dịch vụ.
							bCont=bChenhlechdv;//bCont=(bchenhlech_tructiep)?false:bChenhlechdv;//do them field v_chidinh.dachenhlech -- nen bo dieu kien nay
							//
							//G40. Giá dịch vụ phải khai chênh lệch
							if (bchenhlech_giavp)
							{
								//nếu có đánh dấu chênh lệch của giá viện phí.
								bCont=bCont && r2["chenhlech"].ToString()=="1";
							}
							//kiểm tra mã đối tượng có đánh dấu tính chênh lệch?
							bCont=bCont && chenhlech.IndexOf(i_madoituongvao.ToString().Trim()+",")!=-1 
								&& decimal.Parse(r2["bhyt"].ToString())>0 //có đánh dấu đối tượng bhyt
								&& decimal.Parse(r2["gia_"+f1.Trim()].ToString())<=decimal.Parse(r2["gia_"+f2.Trim()].ToString())//giá đối tượng <= giá thanh toán.
								&& bTungay && bDenngay;

							if (bchenhlech_traituyen //G38. Thanh toán chênh lệch chỉ áp dụng trái tuyến
								&& int.Parse(dr[i]["traituyen"].ToString())==0) bCont=false;//đúng tuyến
							
							bCont=bCont //có tính chênh lệch
								&& r["dachenhlech"].ToString()=="0";//1: đã tính chênh lệch lúc chỉ định. 0: chưa tính chênh lệch(hoặc không tính chênh lệch).
							//nếu có chênh lệch và loại bệnh án nội trú hoặc phòng lưu
							if (bCont && (loaiba==1 || loaiba==4))
							{
								//đối tượng có tính chênh lệch 
								//hoặc chưa tính chênh lệch và giá viện phí có tính chênh lệch.
								if (bChenhlech_dt || (r["dachenhlech"].ToString()=="0" && r2["chenhlech"].ToString()=="1"))
								{
									//nếu là đối tượng tự nguyện(tự chi trả).
									//hoặc kiểm tra madoituong có phải là đối tượng có tính chênh lệch.
									if (s_madt==i_tunguyen.ToString().Trim() || bDoituong_co_chenhlech(s_madt))  
									{
										
										i_madt=i_madoituongvao;//id doituong = doi tuong vao.
										r1=getrowbyid(dtdt,"madoituong="+i_madt);//lấy đối tượng theo id doituong.
										if (r1!=null) 
										{
											s_dtuong=r1["doituong"].ToString();//tên đối tượng.
											f1=r1["field_gia"].ToString().Replace("gia_","");//lấy 2 kí tự cuối của field giá.
										}
										//lấy đơn giá(giá + vật tư) theo đối tượng.
										dg1=decimal.Parse(r2["gia_"+f1.Trim()].ToString())
											+decimal.Parse(r2["vattu_"+f1.Trim()].ToString())//giá vật tư.
											;
										//số tiền=đơn giá * số lượng.
										st1=decimal.Parse(r["soluong"].ToString())*dg1;
									}
										//nếu là đối tượng bhyt
										//và số tiền khác bhyt chi trả.
									else if (bDoituong_BHYT(int.Parse(s_madt),dtdt) 
										&& decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))
									{
										//đổi lại tên viện phí.
										s_ten+=" BHYT thanh toán "+r2["bhyt"].ToString().Trim()+" %";
										dg1=dongia*decimal.Parse(r2["bhyt"].ToString())/100;//tính tiền theo tỷ lệ bhyt chi trả trong v_giavp.
										st1=decimal.Parse(r["bhyt"].ToString());//số tiền bhyt trả.
									}
								}
								else//đối tượng không tính chênh lệch.
								{
									//nếu đơn giá tính theo đối tượng vào và đối tượng thanh toán khác nhau.
									if (f1!=f2)
									{
										i_madt=i_madoituongvao;//id doituong = doi tuong vao.
										r1=getrowbyid(dtdt,"madoituong="+i_madt);//lấy đối tượng theo id doituong.
										if (r1!=null) s_dtuong=r1["doituong"].ToString();
										dg1=decimal.Parse(r2["gia_"+f1.Trim()].ToString())+decimal.Parse(r2["vattu_"+f1.Trim()].ToString());
										st1=decimal.Parse(r["soluong"].ToString())*dg1;
									}
									else if (bDoituong_BHYT(int.Parse(s_madt),dtdt) //nếu là đối tượng bhyt.
										&& decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))//số tiền != tiền bhyt trả.
									{
										s_ten+=" BHYT thanh toán "+r2["bhyt"].ToString().Trim()+" %";//gán lại tên viện phí.
										dg1=dongia*decimal.Parse(r2["bhyt"].ToString())/100;//đơn giá theo tỷ lệ bhyt trả
										st1=decimal.Parse(r["bhyt"].ToString());//số tiền bhyt trả.
									}				
								}
							}
							else if (bDoituong_BHYT(int.Parse(s_madt),dtdt) //đối tượng bhyt
								&& decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))//tổng tiền khác tiền bhyt trả.
							{
								s_ten+=" BHYT thanh toán "+r2["bhyt"].ToString().Trim()+" %";
								dg1=dongia*decimal.Parse(r2["bhyt"].ToString())/100;//tính lại đơn giá theo tỷ lệ bhyt.
								st1=decimal.Parse(r["bhyt"].ToString());//số tiền bhyt trả.
							}				
							#endregion

							#region muc dich vu ky thuat cao
							dg1k=dg2k=st1k=st2k=0;
							int vuottran=0;
							if (kythuat!=-1 //khác kĩ thuật thông thường
								&& bDoituong_BHYT(i_madt,dtdt) //đối tượng bhyt
								&& st1>mucbhquidinh)//số tiền > mức bhyt của kĩ thuật cao.
							{
								decimal i_tt_ktcao=0;
								string s_tenktcao_chung="";
								#region tính kỹ thuật cao theo từng dịch vụ(cấu hình thông số)
								if(bktCao_ttDV)
								{
									s_tenktcao_chung="Tổng chi phí của dịch vụ kỹ thuật cao: "+s_ten;
									i_tt_ktcao+=decimal.Parse(r["sotien"].ToString());//số tiền kĩ thuật cao
									if(m_madoituong_inttrv=="" //không chọn đối tượng in chi phí nào
										|| m_madoituong_inttrv.IndexOf(","+dr[i]["madoituong"].ToString()+",")>=0)//hoặc có chọn đối tượng của dv kĩ thuật cao có trong đối tượng in chi phí
									{
										//binh 070611: do khi chon chuyen so lieu vp, nhung khong chon het doi tuong, chi chon 1 dtuong de in (thuong in lai)
										//Khi do SL chuyen xuong vp chi chuyen doi tuong duoc chon --> do do thieu so lieu
										//
										updrec_ravien(ds,int.Parse(dr[i]["khu"].ToString()),dr[i]["mabn"].ToString(),dr[i]["mabn"].ToString(),long.Parse(dr[i]["maql"].ToString()),long.Parse(dr[i]["idkhoa"].ToString()),dr[i]["hoten"].ToString(),dr[i]["namsinh"].ToString(),dr[i]["phai"].ToString(),
											dr[i]["diachi"].ToString(),i_madt,s_dtuong,s_sothe,iBhyt,s_tungay,s_denngay,dr[i]["noigioithieu"].ToString(),s_dkkcb,
											dr[i]["giuong"].ToString(),r["makp"].ToString()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),s_tenkp.Trim()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),ngayvao,dr[i]["ngayra"].ToString(),dr[i]["chandoan"].ToString(),dr[i]["maicd"].ToString(),int.Parse(r2["sttnhom"].ToString()),
											r2["nhom"].ToString(),int.Parse(r2["sttloai"].ToString()),r2["loai"].ToString(),int.Parse(r["mavp"].ToString()),
											s_ten,r2["dvt"].ToString(),decimal.Parse(r["soluong"].ToString()),
											0,
											decimal.Parse(r["bhyt"].ToString()),tamung,decimal.Parse(r["bhytt0107"].ToString()),dr[i]["nguoinha"].ToString(),int.Parse(dr[i]["hinhthuc"].ToString()),int.Parse(dr[i]["phuongphap"].ToString()),int.Parse(dr[i]["ketqua"].ToString()),dr[i]["soluutru"].ToString(),
											dg1,dr[i]["ngaypt"].ToString(),dr[i]["tenpt"].ToString(),loaiba,int.Parse(dr[i]["done"].ToString()),dr[i]["mabs"].ToString(),dr[i]["tenbs"].ToString(),dr[i]["tenuser"].ToString(),dr[i]["image"].ToString(),dr[i]["ghichu"].ToString(),ngay1,ngay2,ngay3,(bTtngay)?r["ngay"].ToString():"",kythuat,b_sobienlaitamung,(r["idttrv"].ToString()!="")?long.Parse(r["idttrv"].ToString()):0,"","",int.Parse(dr[i]["traituyen"].ToString()),0,0,(bCLktcao||ngia)?dg2k:0,decimal.Parse(r["id"].ToString()),0,vuottran,"","");
									}
									if (dr[i]["done"].ToString()=="0" && (int.Parse(dr[i]["madoituong"].ToString())!=i_haophi || (int.Parse(dr[i]["madoituong"].ToString())==i_haophi && bHaophi_vp)))
									{
										//update vào thvpct
										upd_thvpct(s_mmyy,idvienphi,r["ngay"].ToString(),r["makp"].ToString(),i_madt,long.Parse(r["mavp"].ToString()),decimal.Parse(r["soluong"].ToString()),dg1,st1,0,s_sothe);
									}
									if(dtthuocct.Rows.Count>0)
									{
										//duyệt từng dòng trong danh sách chi phí thuốc.
										foreach(DataRow rr3 in dtthuocct.Rows)
										{
											//nếu id chi phí là kỹ thuật cao
											if(r["id"].ToString()==rr3["id_ktcao"].ToString())
											{
												DataRow rr2;
												bKhongchiphi=false;
												//nếu mabd chưa có trong chuỗi thì cộng thêm vào.
												if(s_mabd.IndexOf(rr3["mabd"].ToString()+",")<0)
													s_mabd+=rr3["mabd"].ToString()+",";
												//lấy thông tin biệt dược theo id.
												rr2=getrowbyid(dtbd,"id="+int.Parse(rr3["mabd"].ToString()));
												if (rr2!=null)
												{
													ngay1=dr[i]["ngay1"].ToString().Trim();//ngày 1
													ngay2=dr[i]["ngay2"].ToString().Trim();//ngày 2
													ngay3=dr[i]["ngay3"].ToString().Trim();//ngày 3
													if (bBhyt)
													{
														#region lay thong tin the bhyt
														r3=dtbhyt.Select("maql="+maql+" and den>="+rr3["ngay"].ToString().Substring(6,4)+rr3["ngay"].ToString().Substring(3,2)+rr3["ngay"].ToString().Substring(0,2),"den");
														if (r3.Length>0)
														{
															s_tungay=r3[0]["tungay"].ToString();
															s_denngay=r3[0]["denngay"].ToString();
															s_sothe=r3[0]["sothe"].ToString();
															s_dkkcb=r3[0]["tenbv"].ToString();
															ngay1=r3[0]["ngay1"].ToString().Trim();
															ngay2=r3[0]["ngay2"].ToString().Trim();
															ngay3=r3[0]["ngay3"].ToString().Trim();
															s_ngaytrinh=r3[0]["ngaytrinh"].ToString();
															s_ngayduyet=r3[0]["ngayduyet"].ToString();
															s_ngaygiahan=r3[0]["ngaygiahan"].ToString();
															s_tungay+="^"+s_ngaytrinh+"^"+s_ngayduyet+"^"+s_ngaygiahan;
														}
														#endregion
													}
													//lấy tên khoa phòng.
													DataRow rrkp=getrowbyid(dtkp,"makp='"+rr3["makp"].ToString()+"'");
													if(rrkp!=null)s_tenkp=rrkp["ten"].ToString();
													else s_tenkp=dr[i]["tenkp"].ToString();
													//lấy tên đối tượng.
													s_madt=dr[i]["madoituong"].ToString().Trim();
													iBhyt=(s_madt=="1")?get_bhyt(dtbdfull,long.Parse(rr3["mabd"].ToString()),rr3["ngay"].ToString()):0;
													i_madt=int.Parse(s_madt);
													s_dtuong=dr[i]["doituong"].ToString();
													kythuat=int.Parse(rr3["kythuat"].ToString());//
													//
													if (bSothengayhuong && kythuat!=-1 && bDoituong_BHYT(i_madt,dtdt))
													{
														bool bChuaduochuong=false;
														if(ngay1=="" && kythuat==0) bChuaduochuong=true;
														else if(ngay2=="" && kythuat==1) bChuaduochuong=true;
														else if (ngay3=="" && kythuat==2) bChuaduochuong=true;
														if (bChuaduochuong 
															|| (kythuat==2 && ngay3!="" && !bNgay(rr3["ngay"].ToString(),ngay3))
															||(kythuat==0 && ngay1!="" && !bNgay(rr3["ngay"].ToString(),ngay1) )
															||(kythuat==1 && ngay2!="" && !bNgay(rr3["ngay"].ToString(),ngay2)))
														{										
															i_madt=i_tunguyen;
															s_madt=i_madt.ToString();
															r1=getrowbyid(dtdt,"madoituong="+i_madt);
															if (r1!=null) s_dtuong=r1["doituong"].ToString();
														}
														//}
													}
																	
													//
													if (bRavien_hc)
													{
														if (rr2["tenhc"].ToString()!="") s_ten=rr2["tenhc"].ToString().Trim()+"["+rr2["tenbd"].ToString().Trim()+"]";
														else s_ten=rr2["tenbd"].ToString();
													}
													else s_ten=rr2["ten"].ToString();
													dongia=decimal.Parse(rr3["dongia"].ToString());
													dg1=dongia;dg2=0;st2=0;st1=decimal.Parse(rr3["sotien"].ToString());
													bDenngay=true;bTungay=true;
													giamua=decimal.Parse(rr3["giamua"].ToString());//
													if(giamua==0)giamua=dongia;
													i_tt_ktcao+=decimal.Parse(rr3["sotien"].ToString());
													if (s_denngay.Trim().Length==10) bDenngay=bNgay(s_denngay,rr3["ngay"].ToString().Substring(0,10));
													if (s_tungay.Trim().Length==10) bTungay=bNgay(rr3["ngay"].ToString().Substring(0,10),s_tungay);
													bCont=(bTungay && bDenngay && bChenhlechdv  
														&& chenhlech.IndexOf(i_madoituongvao.ToString().Trim()+",")!=-1 
														&& chenhlech.IndexOf(s_madt.ToString().Trim()+",")!=-1 //BBBB
														&& decimal.Parse(rr2["bhyt"].ToString())>0); 
													//&& r["loai"].ToString().Trim()=="1");// chi tinh chenh lech thuoc khi khai bao doi tuong tinh theo gia ban: bbbb - bo ra
													if (bChenhlech_dt) bCont=bCont && s_madt==i_tunguyen.ToString().Trim();
													bCont=bCont && bTienthuoc_tinhchenhlech;
													giaban=decimal.Parse(rr3["giaban"].ToString());
													if (bCont && bgia_bh_quydinh)
													{
														if(bGia_bh_quydinh_giamua) giaban=dongia;//giamua;
														r1=getrowbyid(dtbdfull,"id="+long.Parse(rr3["mabd"].ToString()));
														if (r1!=null)
														{
															if (decimal.Parse(r1["gia_bh"].ToString())>0)
															{											
																giamua=Math.Min(giamua,decimal.Parse(r1["gia_bh"].ToString()));											
															}
														}
													}								
													bCont=bCont && Math.Round(giaban,2)-Math.Round(giamua,2)>1;///Math.Round(giaban,2)!=Math.Round(giamua,2);
													if (bchenhlech_traituyen && int.Parse(dr[i]["traituyen"].ToString())==0) bCont=false;
																		
													if (bCont)
													{
														i_madt=i_madoituongvao;
														r1=getrowbyid(dtdt,"madoituong="+i_madt);
														if (r1!=null) s_dtuong=r1["doituong"].ToString();
														dg1=giamua;
														st1=decimal.Parse(rr3["soluong"].ToString())*dg1;
													}
													else if (bDoituong_BHYT(int.Parse(s_madt),dtdt) && iBhyt!=0)//else if (s_madt=="1" && iBhyt!=0)// && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))
													{
														if (iBhyt!=100) s_ten+=" BHYT thanh toán "+iBhyt.ToString()+" %";//r2["bhyt"].ToString().Trim()+" %";
														//dg1=dongia*iBhyt/100;
														dg1=dongia;
														st1=decimal.Parse(rr3["soluong"].ToString())*(dongia*iBhyt/100);
														//dg1=dongia;
													}
													if(m_madoituong_inttrv=="" || m_madoituong_inttrv.IndexOf(","+dr[i]["madoituong"].ToString()+",")>=0)
													{
														//binh 070611: do khi chon chuyen so lieu vp, nhung khong chon het doi tuong, chi chon 1 dtuong de in (thuong in lai)
														//Khi do SL chuyen xuong vp chi chuyen doi tuong duoc chon --> do do thieu so lieu
														//
														updrec_ravien(ds,int.Parse(dr[i]["khu"].ToString()),dr[i]["mabn"].ToString(),dr[i]["mabn"].ToString(),long.Parse(dr[i]["maql"].ToString()),long.Parse(dr[i]["idkhoa"].ToString()),dr[i]["hoten"].ToString(),dr[i]["namsinh"].ToString(),dr[i]["phai"].ToString(),
															dr[i]["diachi"].ToString(),i_madt,s_dtuong,s_sothe,iBhyt,s_tungay,s_denngay,dr[i]["noigioithieu"].ToString(),s_dkkcb,
															dr[i]["giuong"].ToString(),rr3["makp"].ToString() + ((bTtngay) ? " : " + rr3["ngay"].ToString() : ""),s_tenkp.Trim()+ ((bTtngay) ? " : " + rr3["ngay"].ToString() : ""),ngayvao,dr[i]["ngayra"].ToString(),dr[i]["chandoan"].ToString(),dr[i]["maicd"].ToString(),int.Parse(rr2["sttnhom"].ToString()),
															rr2["nhom"].ToString(),int.Parse(rr2["sttloai"].ToString()),rr2["loai"].ToString(),int.Parse(rr3["mabd"].ToString()),
															s_ten,rr2["dvt"].ToString(),decimal.Parse(rr3["soluong"].ToString()),
															0,
															0,tamung,decimal.Parse(rr3["bhytt0107"].ToString()),dr[i]["nguoinha"].ToString(),int.Parse(dr[i]["hinhthuc"].ToString()),int.Parse(dr[i]["phuongphap"].ToString()),int.Parse(dr[i]["ketqua"].ToString()),dr[i]["soluutru"].ToString(),
															dg1,dr[i]["ngaypt"].ToString(),dr[i]["tenpt"].ToString(),loaiba,int.Parse(dr[i]["done"].ToString()),dr[i]["mabs"].ToString(),dr[i]["tenbs"].ToString(),dr[i]["tenuser"].ToString(),dr[i]["image"].ToString(),dr[i]["ghichu"].ToString(),ngay1,ngay2,ngay3,(bTtngay)?rr3["ngay"].ToString():"",0,
															b_sobienlaitamung,(rr3["idttrv"].ToString()!="")?long.Parse(rr3["idttrv"].ToString()):0,"","",int.Parse(dr[i]["traituyen"].ToString()),giamua,giaban,(bCLktcao||ngia)?dg2:0,0,(rr3["id_ktcao"].ToString()==null || rr3["id_ktcao"].ToString()=="")? 0:decimal.Parse(rr3["id_ktcao"].ToString()),vuottran,"","");
													}
													if (dr[i]["done"].ToString()=="0" && (int.Parse(dr[i]["madoituong"].ToString())!=i_haophi || (int.Parse(dr[i]["madoituong"].ToString())==i_haophi && bHaophi_vp)))
													{
														upd_thvpct(s_mmyy,idvienphi,rr3["ngay"].ToString(),rr3["makp"].ToString(),i_madt,long.Parse(rr3["mabd"].ToString()),decimal.Parse(rr3["soluong"].ToString()),dg1,0,0,s_sothe);
														execute_data(" update "+user+s_mmyy+".v_thvpct set id_ktcao="+rr3["id_ktcao"].ToString()+" where id="+idvienphi+" and mavp="+long.Parse(rr3["mabd"].ToString())+" and makp='"+rr3["makp"].ToString()+"'");
													}	
												}
											}
										}
									}
									kythuat=0;
								}
							
								#endregion
								#region Tinh KT Cao theo cong van cu
								//: cach tinh theo cong van cu
								st1k=st1;dg1k=dg1;
								if(bktCao_ttDV) 
								{
									st1k=i_tt_ktcao;dg1k=i_tt_ktcao;
								}
								if (maphu==0)//bhyt 100%
								{
									int atyle=100;
									nhom1=get_nhom(dr[i]["sothe"].ToString(),huong100,nhom);//xac dinh nhung the huong 100%
									if (!nhom1)
									{
										//if (st1>muckhongqua)
										//{
										nhom2=get_nhom(dr[i]["sothe"].ToString(),huong100kqua,nhom);//huong 100 khong qua dinh muc
										if (nhom2 && st1>muckhongqua)
										{
											//												st1k=muckhongqua;//vuot dinh muc thi sotien=so tien dinh muc
											//												dg1k=st1k/decimal.Parse(r["soluong"].ToString());//
											//												st2k=st1-st1k;//chenh lech = so tien - sotien dinh muc
											//												dg2k=st2k/decimal.Parse(r["soluong"].ToString());
											//thanhcuong
											if(bktCao_ttDV)
											{
												st1=st1k;dg1=dg1k;
											}
												
											//
											st=st1;
											if(bktCao_ttDV)
											{
												d_sotien_ktcao=st;
											}
											else d_sotien_ktcao+=st;
											//
												
											if(st<=muckhongqua && d_sotien_ktcao<=muckhongqua)
											{
												bCLktcao=false;
												st1k=st1;dg1k=dg1;
												st2k=0;dg2k=0;
												//binh thuong:
											}
											else if(st<=muckhongqua && d_sotien_ktcao>muckhongqua)
											{
												decimal tmpst=st1;
												st1k=(d_sotien_ktcao-muckhongqua>st)?0:(st-(d_sotien_ktcao-muckhongqua));
												st1k=Math.Round(st1k*(100/atyle),0);//lay nguoc lai st chua co bhyt
												dg1k=Math.Round(st1k/decimal.Parse(r["soluong"].ToString()),3);
												st2k=tmpst-st1k;
												dg2k=Math.Round(st2k/decimal.Parse(r["soluong"].ToString()),3);
												bCLktcao=true;
											
											}
											else if(st1>d_sotien_ktcao_dinhmuc)
											{
												decimal tmpst=st1;
												st1k=(d_sotien_ktcao-d_sotien_ktcao_dinhmuc>st1)?0:(st-(d_sotien_ktcao-d_sotien_ktcao_dinhmuc));
												st1k=Math.Round(st1k*(100/atyle),0);//lay nguoc lai st chua co bhyt
												dg1k=Math.Round(st1k/decimal.Parse(r["soluong"].ToString()),3);
												st2k=tmpst-st1k;
												dg2k=Math.Round(st2k/decimal.Parse(r["soluong"].ToString()),3);
												vuottran=1;
												bCLktcao=true;
											}
										}
										else 
										{
											int tmp_phantrambhyt=phantrambhyt;
											if(dr[i]["sothe"].ToString().Length==15||dr[i]["sothe"].ToString().Length==20)
											{
												tmp_phantrambhyt=(maphu==0)?100:(maphu==1)?80:95;
											}
											//thanhcuong
											if(bktCao_ttDV) 
											{
												st1=st1k;dg1=dg1k;
											}
											//
											st = st1 * tmp_phantrambhyt / 100;//huong khong qua 60%
											if(bktCao_ttDV)
											{
												d_sotien_ktcao=st;
											}
											else d_sotien_ktcao+=st;
												
											//
											if (st < mucbhquidinh)
											{
												st1k = mucbhquidinh;
												dg1k = st1k / decimal.Parse(r["soluong"].ToString());
												st2k = st1 - st1k;
												dg2k = st2k / decimal.Parse(r["soluong"].ToString());
												bCLktcao=true;
											}
											else if (st > muckhongqua)
											{
												st1k = muckhongqua;//60% vuot qua dinh muc thi so tien=so tien dinh muc
												dg1k = st1k / decimal.Parse(r["soluong"].ToString());
												st2k = st1 - st1k;// chenh lech = so tien - so tien dinh muc
												dg2k = st2k / decimal.Parse(r["soluong"].ToString());
												vuottran=1;
												bCLktcao=true;
											}
											else
											{
												//													st1k = st1 * tmp_phantrambhyt / 100;// trong pham vi: thi huong 60%= phantrambhyt
												//													dg1k = st1k / decimal.Parse(r["soluong"].ToString());
												//													st2k = st1 - st1k;//chenh lech = phan con lai = (100 -60)* so tien/100
												//													dg2k = st2k / decimal.Parse(r["soluong"].ToString());
												if(st<=muckhongqua && d_sotien_ktcao<=muckhongqua)
												{
													bCLktcao=false;
													st1k=st1;dg1k=dg1;
													st2k=0;dg2k=0;
													//binh thuong:
												}
												else if(st<=muckhongqua && d_sotien_ktcao>muckhongqua)
												{
													decimal tmpst=st1;
													st1k=(d_sotien_ktcao-muckhongqua>st)?0:(st-(d_sotien_ktcao-muckhongqua));
													st1k=Math.Round(st1k*(100/atyle),0);//lay nguoc lai st chua co bhyt
													dg1k=Math.Round(st1k/decimal.Parse(r["soluong"].ToString()),3);
													st2k=tmpst-st1k;
													dg2k=Math.Round(st2k/decimal.Parse(r["soluong"].ToString()),3);
													bCLktcao=true;
											
												}
												else if(st1>d_sotien_ktcao_dinhmuc)
												{
													decimal tmpst=st1;
													st1k=(d_sotien_ktcao-d_sotien_ktcao_dinhmuc>st1)?0:(st-(d_sotien_ktcao-d_sotien_ktcao_dinhmuc));
													st1k=Math.Round(st1k*(100/atyle),0);//lay nguoc lai st chua co bhyt
													dg1k=Math.Round(st1k/decimal.Parse(r["soluong"].ToString()),3);
													st2k=tmpst-st1k;
													dg2k=Math.Round(st2k/decimal.Parse(r["soluong"].ToString()),3);
													vuottran=1;
													bCLktcao=true;
												}
											}
										}
										//}
									}
								}
								else
								{
									//
									
									//
									decimal atyle=(maphu==1)?80:(maphu==0)?100:95;
									//thanhcuong
									if(bktCao_ttDV) 
									{
										st1=st1k;dg1=dg1k;
									}
									//
									st=st1*atyle/100;
									//
									if(bktCao_ttDV) d_sotien_ktcao=st;
									else d_sotien_ktcao+=st;
									
									//
									bFound_ktcao_vuot= d_sotien_ktcao>muckhongqua;
									if(st<=muckhongqua && d_sotien_ktcao<=muckhongqua)
									{
										bCLktcao=false;
										st1k=st1;dg1k=dg1;
										st2k=0;dg2k=0;
										//binh thuong:
									}
									else if(st<=muckhongqua && d_sotien_ktcao>muckhongqua)
									{
										decimal tmpst=st1;
										st1k=(d_sotien_ktcao-muckhongqua>st)?0:(st-(d_sotien_ktcao-muckhongqua));
										st1k=Math.Round(st1k*(100/atyle),0);//lay nguoc lai st chua co bhyt
										dg1k=Math.Round(st1k/decimal.Parse(r["soluong"].ToString()),3);
										st2k=tmpst-st1k;
										dg2k=Math.Round(st2k/decimal.Parse(r["soluong"].ToString()),3);
										bCLktcao=true;
											
									}
									else if(st1>d_sotien_ktcao_dinhmuc)
									{
										decimal tmpst=st1;
										st1k=(d_sotien_ktcao-d_sotien_ktcao_dinhmuc>st1)?0:(st-(d_sotien_ktcao-d_sotien_ktcao_dinhmuc));
										st1k=Math.Round(st1k*(100/atyle),0);//lay nguoc lai st chua co bhyt
										dg1k=Math.Round(st1k/decimal.Parse(r["soluong"].ToString()),3);
										st2k=tmpst-st1k;
										dg2k=Math.Round(st2k/decimal.Parse(r["soluong"].ToString()),3);
										vuottran=1;
										bCLktcao=true;
									}
								}
								#endregion  Tinh KT Cao theo cong van cu																
								
								//
								if(m_madoituong_inttrv=="" || m_madoituong_inttrv.IndexOf(","+dr[i]["madoituong"].ToString()+",")>=0)
								{
									//binh 070611: do khi chon chuyen so lieu vp, nhung khong chon het doi tuong, chi chon 1 dtuong de in (thuong in lai)
									//Khi do SL chuyen xuong vp chi chuyen doi tuong duoc chon --> do do thieu so lieu
									//
									if(bktCao_ttDV)
									{
										updrec_ravien(ds,int.Parse(dr[i]["khu"].ToString()),dr[i]["mabn"].ToString(),dr[i]["mabn"].ToString(),long.Parse(dr[i]["maql"].ToString()),long.Parse(dr[i]["idkhoa"].ToString()),dr[i]["hoten"].ToString(),dr[i]["namsinh"].ToString(),dr[i]["phai"].ToString(),
											dr[i]["diachi"].ToString(),i_madt,s_dtuong,s_sothe,iBhyt,s_tungay,s_denngay,dr[i]["noigioithieu"].ToString(),s_dkkcb,
											dr[i]["giuong"].ToString(),r["makp"].ToString()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),s_tenkp.Trim()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),ngayvao,dr[i]["ngayra"].ToString(),dr[i]["chandoan"].ToString(),dr[i]["maicd"].ToString(),int.Parse(r2["sttnhom"].ToString()),
											r2["nhom"].ToString(),int.Parse(r2["sttloai"].ToString()),r2["loai"].ToString(),int.Parse(r["mavp"].ToString()),
											s_tenktcao_chung,r2["dvt"].ToString(),1,
											st1k,
											decimal.Parse(r["bhyt"].ToString()),tamung,decimal.Parse(r["bhytt0107"].ToString()),dr[i]["nguoinha"].ToString(),int.Parse(dr[i]["hinhthuc"].ToString()),int.Parse(dr[i]["phuongphap"].ToString()),int.Parse(dr[i]["ketqua"].ToString()),dr[i]["soluutru"].ToString(),
											dg1k,dr[i]["ngaypt"].ToString(),dr[i]["tenpt"].ToString(),loaiba,int.Parse(dr[i]["done"].ToString()),dr[i]["mabs"].ToString(),dr[i]["tenbs"].ToString(),dr[i]["tenuser"].ToString(),dr[i]["image"].ToString(),dr[i]["ghichu"].ToString(),ngay1,ngay2,ngay3,(bTtngay)?r["ngay"].ToString():"",kythuat,b_sobienlaitamung,(r["idttrv"].ToString()!="")?long.Parse(r["idttrv"].ToString()):0,"","",int.Parse(dr[i]["traituyen"].ToString()),0,0,(bCLktcao||ngia)?dg2k:0,decimal.Parse(r["id"].ToString()),0,vuottran,"","");
									}
									else
									{

										updrec_ravien(ds,int.Parse(dr[i]["khu"].ToString()),dr[i]["mabn"].ToString(),dr[i]["mabn"].ToString(),long.Parse(dr[i]["maql"].ToString()),long.Parse(dr[i]["idkhoa"].ToString()),dr[i]["hoten"].ToString(),dr[i]["namsinh"].ToString(),dr[i]["phai"].ToString(),
											dr[i]["diachi"].ToString(),i_madt,s_dtuong,s_sothe,iBhyt,s_tungay,s_denngay,dr[i]["noigioithieu"].ToString(),s_dkkcb,
											dr[i]["giuong"].ToString(),r["makp"].ToString()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),s_tenkp.Trim()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),ngayvao,dr[i]["ngayra"].ToString(),dr[i]["chandoan"].ToString(),dr[i]["maicd"].ToString(),int.Parse(r2["sttnhom"].ToString()),
											r2["nhom"].ToString(),int.Parse(r2["sttloai"].ToString()),r2["loai"].ToString(),int.Parse(r["mavp"].ToString()),
											s_ten,r2["dvt"].ToString(),decimal.Parse(r["soluong"].ToString()),
											st1k,
											decimal.Parse(r["bhyt"].ToString()),tamung,decimal.Parse(r["bhytt0107"].ToString()),dr[i]["nguoinha"].ToString(),int.Parse(dr[i]["hinhthuc"].ToString()),int.Parse(dr[i]["phuongphap"].ToString()),int.Parse(dr[i]["ketqua"].ToString()),dr[i]["soluutru"].ToString(),
											dg1k,dr[i]["ngaypt"].ToString(),dr[i]["tenpt"].ToString(),loaiba,int.Parse(dr[i]["done"].ToString()),dr[i]["mabs"].ToString(),dr[i]["tenbs"].ToString(),dr[i]["tenuser"].ToString(),dr[i]["image"].ToString(),dr[i]["ghichu"].ToString(),ngay1,ngay2,ngay3,(bTtngay)?r["ngay"].ToString():"",kythuat,b_sobienlaitamung,(r["idttrv"].ToString()!="")?long.Parse(r["idttrv"].ToString()):0,"","",int.Parse(dr[i]["traituyen"].ToString()),0,0,(bCLktcao||ngia)?dg2k:0,decimal.Parse(r["id"].ToString()),0,vuottran,"","");
									}								
								}
								if (dr[i]["done"].ToString()=="0" && (int.Parse(dr[i]["madoituong"].ToString())!=i_haophi || (int.Parse(dr[i]["madoituong"].ToString())==i_haophi && bHaophi_vp)))
								{
									if(bktCao_ttDV) upd_thvpct(s_mmyy,idvienphi,r["ngay"].ToString(),r["makp"].ToString(),i_madt,long.Parse(r["mavp"].ToString()),1,dg1k,st1k,(r["vattu"].ToString().Trim()=="")?0:decimal.Parse(r["vattu"].ToString()),s_sothe);
									else upd_thvpct(s_mmyy,idvienphi,r["ngay"].ToString(),r["makp"].ToString(),i_madt,long.Parse(r["mavp"].ToString()),decimal.Parse(r["soluong"].ToString()),dg1k,st1k,(r["vattu"].ToString().Trim()=="")?0:decimal.Parse(r["vattu"].ToString()),s_sothe);
									
								}
								
								if (dg2k!=0)
								{									
									s_ten += " BN thanh toán chênh lệch "+((kythuat==0)?"kỹ thuật cao":"chăm sóc thai sản,sinh đẻ");
									s_tenktcao_chung += " BN thanh toán chênh lệch "+((kythuat==0)?"kỹ thuật cao":"chăm sóc thai sản,sinh đẻ");
									r1=getrowbyid(dtdt,"madoituong="+i_tunguyen);
									if (r1!=null) s_dtuong=r1["doituong"].ToString();
									if(m_madoituong_inttrv=="" || m_madoituong_inttrv.IndexOf(","+dr[i]["madoituong"].ToString()+",")>=0)
									{
										//binh 070611: do khi chon chuyen so lieu vp, nhung khong chon het doi tuong, chi chon 1 dtuong de in (thuong in lai)
										//Khi do SL chuyen xuong vp chi chuyen doi tuong duoc chon --> do do thieu so lieu
										//
										if(bktCao_ttDV)
										{
											updrec_ravien(ds,int.Parse(dr[i]["khu"].ToString()),dr[i]["mabn"].ToString(),dr[i]["mabn"].ToString(),long.Parse(dr[i]["maql"].ToString()),long.Parse(dr[i]["idkhoa"].ToString()),dr[i]["hoten"].ToString(),dr[i]["namsinh"].ToString(),dr[i]["phai"].ToString(),
												dr[i]["diachi"].ToString(),i_tunguyen,s_dtuong,s_sothe,iBhyt,s_tungay,s_denngay,dr[i]["noigioithieu"].ToString(),s_dkkcb,
												dr[i]["giuong"].ToString(),r["makp"].ToString()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),s_tenkp.Trim()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),ngayvao,dr[i]["ngayra"].ToString(),dr[i]["chandoan"].ToString(),dr[i]["maicd"].ToString(),int.Parse(r2["sttnhom"].ToString()),
												r2["nhom"].ToString(),int.Parse(r2["sttloai"].ToString()),r2["loai"].ToString(),int.Parse(r["mavp"].ToString()),
												s_tenktcao_chung,r2["dvt"].ToString(),1,
												st2k,
												decimal.Parse(r["bhyt"].ToString()),0,decimal.Parse(r["bhytt0107"].ToString()),dr[i]["nguoinha"].ToString(),int.Parse(dr[i]["hinhthuc"].ToString()),int.Parse(dr[i]["phuongphap"].ToString()),int.Parse(dr[i]["ketqua"].ToString()),dr[i]["soluutru"].ToString(),
												dg2k,dr[i]["ngaypt"].ToString(),dr[i]["tenpt"].ToString(),loaiba,int.Parse(dr[i]["done"].ToString()),dr[i]["mabs"].ToString(),dr[i]["tenbs"].ToString(),dr[i]["tenuser"].ToString(),dr[i]["image"].ToString(),dr[i]["ghichu"].ToString(),ngay1,ngay2,ngay3,(bTtngay)?r["ngay"].ToString():"",kythuat,b_sobienlaitamung,(r["idttrv"].ToString()!="")?long.Parse(r["idttrv"].ToString()):0,"","",int.Parse(dr[i]["traituyen"].ToString()),0,0,(bCLktcao?-1:0),decimal.Parse(r["id"].ToString()),0,vuottran,"","");
										}
										else
										{
											updrec_ravien(ds,int.Parse(dr[i]["khu"].ToString()),dr[i]["mabn"].ToString(),dr[i]["mabn"].ToString(),long.Parse(dr[i]["maql"].ToString()),long.Parse(dr[i]["idkhoa"].ToString()),dr[i]["hoten"].ToString(),dr[i]["namsinh"].ToString(),dr[i]["phai"].ToString(),
												dr[i]["diachi"].ToString(),i_tunguyen,s_dtuong,s_sothe,iBhyt,s_tungay,s_denngay,dr[i]["noigioithieu"].ToString(),s_dkkcb,
												dr[i]["giuong"].ToString(),r["makp"].ToString()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),s_tenkp.Trim()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),ngayvao,dr[i]["ngayra"].ToString(),dr[i]["chandoan"].ToString(),dr[i]["maicd"].ToString(),int.Parse(r2["sttnhom"].ToString()),
												r2["nhom"].ToString(),int.Parse(r2["sttloai"].ToString()),r2["loai"].ToString(),int.Parse(r["mavp"].ToString()),
												s_ten,r2["dvt"].ToString(),decimal.Parse(r["soluong"].ToString()),
												st2k,
												decimal.Parse(r["bhyt"].ToString()),0,decimal.Parse(r["bhytt0107"].ToString()),dr[i]["nguoinha"].ToString(),int.Parse(dr[i]["hinhthuc"].ToString()),int.Parse(dr[i]["phuongphap"].ToString()),int.Parse(dr[i]["ketqua"].ToString()),dr[i]["soluutru"].ToString(),
												dg2k,dr[i]["ngaypt"].ToString(),dr[i]["tenpt"].ToString(),loaiba,int.Parse(dr[i]["done"].ToString()),dr[i]["mabs"].ToString(),dr[i]["tenbs"].ToString(),dr[i]["tenuser"].ToString(),dr[i]["image"].ToString(),dr[i]["ghichu"].ToString(),ngay1,ngay2,ngay3,(bTtngay)?r["ngay"].ToString():"",kythuat,b_sobienlaitamung,(r["idttrv"].ToString()!="")?long.Parse(r["idttrv"].ToString()):0,"","",int.Parse(dr[i]["traituyen"].ToString()),0,0,(bCLktcao?-1:0),decimal.Parse(r["id"].ToString()),0,vuottran,"","");
										}									
									}
									if (dr[i]["done"].ToString()=="0" && int.Parse(dr[i]["madoituong"].ToString())!=i_haophi)
									{
										if(bktCao_ttDV) upd_thvpct(s_mmyy,idvienphi,r["ngay"].ToString(),r["makp"].ToString(),i_tunguyen,long.Parse(r["mavp"].ToString()),1,dg2k,st2k,decimal.Parse(r["vattu"].ToString()),s_sothe);
										else upd_thvpct(s_mmyy,idvienphi,r["ngay"].ToString(),r["makp"].ToString(),i_tunguyen,long.Parse(r["mavp"].ToString()),decimal.Parse(r["soluong"].ToString()),dg2k,st2k,decimal.Parse(r["vattu"].ToString()),s_sothe);
										
									}
								}
								
							}
							else
							{
								if(m_madoituong_inttrv=="" || m_madoituong_inttrv.IndexOf(","+dr[i]["madoituong"].ToString()+",")>=0)
								{
									//binh 070611: do khi chon chuyen so lieu vp, nhung khong chon het doi tuong, chi chon 1 dtuong de in (thuong in lai)
									//Khi do SL chuyen xuong vp chi chuyen doi tuong duoc chon --> do do thieu so lieu
									//
									updrec_ravien(ds,int.Parse(dr[i]["khu"].ToString()),dr[i]["mabn"].ToString(),dr[i]["mabn"].ToString(),long.Parse(dr[i]["maql"].ToString()),long.Parse(dr[i]["idkhoa"].ToString()),dr[i]["hoten"].ToString(),dr[i]["namsinh"].ToString(),dr[i]["phai"].ToString(),
										dr[i]["diachi"].ToString(),i_madt,s_dtuong,s_sothe,iBhyt,s_tungay,s_denngay,dr[i]["noigioithieu"].ToString(),s_dkkcb,
										dr[i]["giuong"].ToString(),r["makp"].ToString()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),s_tenkp.Trim()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),ngayvao,dr[i]["ngayra"].ToString(),dr[i]["chandoan"].ToString(),dr[i]["maicd"].ToString(),int.Parse(r2["sttnhom"].ToString()),
										r2["nhom"].ToString(),int.Parse(r2["sttloai"].ToString()),r2["loai"].ToString(),int.Parse(r["mavp"].ToString()),
										s_ten,r2["dvt"].ToString(),decimal.Parse(r["soluong"].ToString()),
										st1,
										decimal.Parse(r["bhyt"].ToString()),tamung,decimal.Parse(r["bhytt0107"].ToString()),dr[i]["nguoinha"].ToString(),int.Parse(dr[i]["hinhthuc"].ToString()),int.Parse(dr[i]["phuongphap"].ToString()),int.Parse(dr[i]["ketqua"].ToString()),dr[i]["soluutru"].ToString(),
										dg1,dr[i]["ngaypt"].ToString(),dr[i]["tenpt"].ToString(),loaiba,int.Parse(dr[i]["done"].ToString()),dr[i]["mabs"].ToString(),dr[i]["tenbs"].ToString(),dr[i]["tenuser"].ToString(),dr[i]["image"].ToString(),dr[i]["ghichu"].ToString(),ngay1,ngay2,ngay3,(bTtngay)?r["ngay"].ToString():"",kythuat,b_sobienlaitamung,(r["idttrv"].ToString()!="")?long.Parse(r["idttrv"].ToString()):0,"","",int.Parse(dr[i]["traituyen"].ToString()),0,0,(r["giachenhlech"].ToString()==""?0:decimal.Parse(r["giachenhlech"].ToString())),(r["id"].ToString()==null || r["id"].ToString()=="")? 0:decimal.Parse(r["id"].ToString()),0,0,"","");
								}
								if (dr[i]["done"].ToString()=="0" && (int.Parse(dr[i]["madoituong"].ToString())!=i_haophi || (int.Parse(dr[i]["madoituong"].ToString())==i_haophi && bHaophi_vp)))
									upd_thvpct(s_mmyy,idvienphi,r["ngay"].ToString(),r["makp"].ToString(),i_madt,long.Parse(r["mavp"].ToString()),decimal.Parse(r["soluong"].ToString()),dg1,st1,(r["vattu"].ToString().Trim()=="")?0:decimal.Parse(r["vattu"].ToString()),s_sothe);
							}
							#endregion

							#region chenhlech
							dg2=0;//??????
							bCont=bChenhlechdv;//chênh lệch theo dịch vụ
							if (bchenhlech_giavp)//chenh lech theo gia vien phi
							{
								bCont=bCont && r2["chenhlech"].ToString()=="1";
							}
							bCont=bCont && chenhlech.IndexOf(i_madoituongvao.ToString().Trim()+",")!=-1 
								&& decimal.Parse(r2["bhyt"].ToString())>0 
								&& decimal.Parse(r2["gia_"+f1.Trim()].ToString())<decimal.Parse(r2["gia_"+f2.Trim()].ToString())
								&& bTungay && bDenngay;
							if (bchenhlech_traituyen && int.Parse(dr[i]["traituyen"].ToString())==0) bCont=false;
							bCont=bCont && r["dachenhlech"].ToString()=="0";
							if (bCont && (loaiba==1 || loaiba==4))
							{
								if (bChenhlech_dt || (r["dachenhlech"].ToString()=="0" && r2["chenhlech"].ToString()=="1"))
								{
									if (s_madt==i_tunguyen.ToString().Trim() || bDoituong_co_chenhlech(s_madt))
									{
										s_madt=i_tunguyen.ToString();
										i_madt=int.Parse(s_madt);
										r1=getrowbyid(dtdt,"madoituong="+i_madt);
										if (r1!=null) s_dtuong=r1["doituong"].ToString();
										s_ten+=" BN thanh toán chênh lệch ";
										dg2=decimal.Parse(r2["gia_"+f2.Trim()].ToString())+decimal.Parse(r2["vattu_"+f2.Trim()].ToString())-dg1;
										st2=decimal.Parse(r["soluong"].ToString())*dg2;
									}
									else if (bDoituong_BHYT(int.Parse(s_madt),dtdt) && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))//else if (s_madt=="1" && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))
									{
										s_madt=i_tunguyen.ToString();
										i_madt=int.Parse(s_madt);
										r1=getrowbyid(dtdt,"madoituong="+i_madt);
										if (r1!=null) s_dtuong=r1["doituong"].ToString();
										s_ten=r2["ten"].ToString();
										decimal bn=100-decimal.Parse(r2["bhyt"].ToString());
										s_ten+=" BN thanh toán "+bn.ToString().Trim()+" %";
										dg2=dongia*bn/100;
										st2=decimal.Parse(r["sotien"].ToString())-decimal.Parse(r["bhyt"].ToString());
									}
								}
								else
								{
									if (f1!=f2)
									{
										s_madt=i_tunguyen.ToString();
										i_madt=int.Parse(s_madt);
										r1=getrowbyid(dtdt,"madoituong="+i_madt);
										if (r1!=null) s_dtuong=r1["doituong"].ToString();
										s_ten+=" BN thanh toán chênh lệch ";
										dg2=decimal.Parse(r2["gia_"+f2.Trim()].ToString())+decimal.Parse(r2["vattu_"+f2.Trim()].ToString())-dg1;
										st2=decimal.Parse(r["soluong"].ToString())*dg2;
									}
									else if (bDoituong_BHYT(int.Parse(s_madt),dtdt) && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))//else if (s_madt=="1" && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))
									{
										s_madt=i_tunguyen.ToString();
										i_madt=int.Parse(s_madt);
										r1=getrowbyid(dtdt,"madoituong="+i_madt);
										if (r1!=null) s_dtuong=r1["doituong"].ToString();
										s_ten=r2["ten"].ToString();
										decimal bn=100-decimal.Parse(r2["bhyt"].ToString());
										s_ten+=" BN thanh toán "+bn.ToString().Trim()+" %";
										dg2=dongia*bn/100;
										st2=decimal.Parse(r["sotien"].ToString())-decimal.Parse(r["bhyt"].ToString());
									}

								}
							}
							else if (bDoituong_BHYT(int.Parse(s_madt),dtdt) && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))//else if (s_madt=="1" && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))
							{
								s_madt=i_tunguyen.ToString();
								i_madt=int.Parse(s_madt);
								r1=getrowbyid(dtdt,"madoituong="+i_madt);
								if (r1!=null) s_dtuong=r1["doituong"].ToString();
								s_ten=r2["ten"].ToString();
								decimal bn=100-decimal.Parse(r2["bhyt"].ToString());
								s_ten+=" BN thanh toán "+bn.ToString().Trim()+" %";
								dg2=dongia*bn/100;
								st2=decimal.Parse(r["sotien"].ToString())-decimal.Parse(r["bhyt"].ToString());
							}

							#endregion

							if (dg2>0)
							{
								if(m_madoituong_inttrv=="" || m_madoituong_inttrv.IndexOf(","+dr[i]["madoituong"].ToString()+",")>=0)
								{
									//binh 070611: do khi chon chuyen so lieu vp, nhung khong chon het doi tuong, chi chon 1 dtuong de in (thuong in lai)
									//Khi do SL chuyen xuong vp chi chuyen doi tuong duoc chon --> do do thieu so lieu
									//
									updrec_ravien(ds,int.Parse(dr[i]["khu"].ToString()),dr[i]["mabn"].ToString(),dr[i]["mabn"].ToString(),long.Parse(dr[i]["maql"].ToString()),long.Parse(dr[i]["idkhoa"].ToString()),dr[i]["hoten"].ToString(),dr[i]["namsinh"].ToString(),dr[i]["phai"].ToString(),
										dr[i]["diachi"].ToString(),i_madt,s_dtuong,s_sothe,iBhyt,s_tungay,s_denngay,dr[i]["noigioithieu"].ToString(),s_dkkcb,
										dr[i]["giuong"].ToString(),r["makp"].ToString()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),s_tenkp.Trim()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),ngayvao,dr[i]["ngayra"].ToString(),dr[i]["chandoan"].ToString(),dr[i]["maicd"].ToString(),int.Parse(r2["sttnhom"].ToString()),
										r2["nhom"].ToString(),int.Parse(r2["sttloai"].ToString()),r2["loai"].ToString(),int.Parse(r["mavp"].ToString()),
										s_ten,r2["dvt"].ToString(),decimal.Parse(r["soluong"].ToString()),
										st2,
										decimal.Parse(r["bhyt"].ToString()),0,decimal.Parse(r["bhytt0107"].ToString()),dr[i]["nguoinha"].ToString(),int.Parse(dr[i]["hinhthuc"].ToString()),int.Parse(dr[i]["phuongphap"].ToString()),int.Parse(dr[i]["ketqua"].ToString()),dr[i]["soluutru"].ToString(),
										dg2,dr[i]["ngaypt"].ToString(),dr[i]["tenpt"].ToString(),loaiba,int.Parse(dr[i]["done"].ToString()),dr[i]["mabs"].ToString(),dr[i]["tenbs"].ToString(),dr[i]["tenuser"].ToString(),dr[i]["image"].ToString(),dr[i]["ghichu"].ToString(),ngay1,ngay2,ngay3,(bTtngay)?r["ngay"].ToString():"",kythuat,b_sobienlaitamung,(r["idttrv"].ToString()!="")?long.Parse(r["idttrv"].ToString()):0,"","",int.Parse(dr[i]["traituyen"].ToString()),0,0,(bCLktcao?-1:0),(r["id"].ToString()==null || r["id"].ToString()=="")? 0:decimal.Parse(r["id"].ToString()),0,0,"","");
								}
								if (dr[i]["done"].ToString()=="0" && int.Parse(dr[i]["madoituong"].ToString())!=i_haophi)
									upd_thvpct(s_mmyy,idvienphi,r["ngay"].ToString(),r["makp"].ToString(),i_madt,long.Parse(r["mavp"].ToString()),decimal.Parse(r["soluong"].ToString()),dg2,st2,decimal.Parse(r["vattu"].ToString()),s_sothe);
							}
							if (dr[i]["done"].ToString()=="0" && (int.Parse(dr[i]["madoituong"].ToString())!=i_haophi || (int.Parse(dr[i]["madoituong"].ToString())==i_haophi && bHaophi_vp)))
							{									
								sotien+=decimal.Parse(r["sotien"].ToString());
								bhyt+=decimal.Parse(r["bhyt"].ToString());
							}
						}
					}
				}
				//ds.WriteXml("xx.xml",XmlWriteMode.WriteSchema);
				#endregion Vienphi

				#region Thuoc

				if (!bBosolieuduoc)
				{
					//tmp=get_thuoc_ct((int.Parse(dr[i]["motkhu"].ToString())==1)?0:int.Parse(dr[i]["khu"].ToString()),dr[i]["mabn"].ToString(),maql,idkhoa,dr[i]["ngayvao"].ToString(),dr[i]["ngayra"].ToString(),(makp=="" || r1==null)?0:int.Parse(r1["id"].ToString()),int.Parse(dr[i]["madoituong"].ToString()),int.Parse(dr[i]["done"].ToString()),maql_phongluu,bChenhlechdv,bCapve,bNgtr,loaiba,dr[i]["makp"].ToString(),mavaovien,dr[i]["maso"].ToString(),bTheongay,bThanhtoanndot,bTTRV_theokhoa);
					tmp.Clear();
					tmp=dtthuocct.Copy();
					if (tmp!=null)
					{
						DataSet dsttt=new DataSet();
						dsttt.Tables.Add(tmp.Copy());
						//dsttt.WriteXml("thuocxml.xml",XmlWriteMode.WriteSchema);
						string exs="id_ktcao=0";
						if(int.Parse(dr[i]["madoituong"].ToString())!=1) exs="";
						foreach(DataRow r in tmp.Select(exs))
						{		
							bKhongchiphi=false;
							if(s_mabd.IndexOf(r["mabd"].ToString()+",")<0)s_mabd+=r["mabd"].ToString()+",";
							r2=getrowbyid(dtbd,"id="+int.Parse(r["mabd"].ToString()));
							if (r2!=null)
							{
								ngay1=dr[i]["ngay1"].ToString().Trim();
								ngay2=dr[i]["ngay2"].ToString().Trim();
								ngay3=dr[i]["ngay3"].ToString().Trim();
								if (bBhyt)
								{
									r3=dtbhyt.Select("maql="+maql+" and den>="+r["ngay"].ToString().Substring(6,4)+r["ngay"].ToString().Substring(3,2)+r["ngay"].ToString().Substring(0,2),"den");
									if (r3.Length>0)
									{
										s_tungay=r3[0]["tungay"].ToString();
										s_denngay=r3[0]["denngay"].ToString();
										s_sothe=r3[0]["sothe"].ToString();
										s_dkkcb=r3[0]["tenbv"].ToString();
										ngay1=r3[0]["ngay1"].ToString().Trim();
										ngay2=r3[0]["ngay2"].ToString().Trim();
										ngay3=r3[0]["ngay3"].ToString().Trim();
										s_ngaytrinh=r3[0]["ngaytrinh"].ToString();
										s_ngayduyet=r3[0]["ngayduyet"].ToString();
										s_ngaygiahan=r3[0]["ngaygiahan"].ToString();
										s_tungay+="^"+s_ngaytrinh+"^"+s_ngayduyet+"^"+s_ngaygiahan;
									}
								}
								DataRow rkp=getrowbyid(dtkp,"makp='"+r["makp"].ToString()+"'");
								if(rkp!=null)s_tenkp=rkp["ten"].ToString();
								else s_tenkp=dr[i]["tenkp"].ToString();
								s_madt=dr[i]["madoituong"].ToString().Trim();
								iBhyt=(s_madt=="1")?get_bhyt(dtbdfull,long.Parse(r["mabd"].ToString()),r["ngay"].ToString()):0;
								i_madt=int.Parse(s_madt);
								s_dtuong=dr[i]["doituong"].ToString();
								kythuat=int.Parse(r["kythuat"].ToString());//kythuat=int.Parse(r2["kythuat"].ToString());
								//
								if (bSothengayhuong && kythuat!=-1 && bDoituong_BHYT(i_madt,dtdt))//if (kythuat==1 && i_madt==1)
								{
									bool bChuaduochuong=false;
									if(ngay1=="" && kythuat==0) bChuaduochuong=true;
									else if(ngay2=="" && kythuat==1) bChuaduochuong=true;
									else if (ngay3=="" && kythuat==2) bChuaduochuong=true;
									if (bChuaduochuong || (kythuat==2 && ngay3!="" && !bNgay(r["ngay"].ToString(),ngay3))||(kythuat==0 && ngay1!="" && !bNgay(r["ngay"].ToString(),ngay1) )||(kythuat==1 && ngay2!="" && !bNgay(r["ngay"].ToString(),ngay2)))
									{										
										i_madt=i_tunguyen;
										s_madt=i_madt.ToString();
										r1=getrowbyid(dtdt,"madoituong="+i_madt);
										if (r1!=null) s_dtuong=r1["doituong"].ToString();
									}
									//}
								}
							
								//
								if (bRavien_hc)
								{
									if (r2["tenhc"].ToString()!="") s_ten=r2["tenhc"].ToString().Trim()+"["+r2["tenbd"].ToString().Trim()+"]";
									else s_ten=r2["tenbd"].ToString();
								}
								else s_ten=r2["ten"].ToString();
								dongia=decimal.Parse(r["dongia"].ToString());
								dg1=dongia;dg2=0;st2=0;st1=decimal.Parse(r["sotien"].ToString());
								bDenngay=true;bTungay=true;
								giamua=decimal.Parse(r["giamua"].ToString());//
								if(giamua==0)giamua=dongia;
								
								if (s_denngay.Trim().Length==10) bDenngay=bNgay(s_denngay,r["ngay"].ToString().Substring(0,10));
								if (s_tungay.Trim().Length==10) bTungay=bNgay(r["ngay"].ToString().Substring(0,10),s_tungay);
								bCont=(bTungay && bDenngay && bChenhlechdv  
									&& chenhlech.IndexOf(i_madoituongvao.ToString().Trim()+",")!=-1 
									&& chenhlech.IndexOf(s_madt.ToString().Trim()+",")!=-1 //BBBB
									&& decimal.Parse(r2["bhyt"].ToString())>0); 
								//&& r["loai"].ToString().Trim()=="1");// chi tinh chenh lech thuoc khi khai bao doi tuong tinh theo gia ban: bbbb - bo ra
								if (bChenhlech_dt) bCont=bCont && s_madt==i_tunguyen.ToString().Trim();
								bCont=bCont && bTienthuoc_tinhchenhlech;
								giaban=decimal.Parse(r["giaban"].ToString());
								if (bCont && bgia_bh_quydinh)
								{
									if(bGia_bh_quydinh_giamua) giaban=dongia;//giamua;
									r1=getrowbyid(dtbdfull,"id="+long.Parse(r["mabd"].ToString()));
									if (r1!=null)
									{
										if (decimal.Parse(r1["gia_bh"].ToString())>0)
										{											
											giamua=Math.Min(giamua,decimal.Parse(r1["gia_bh"].ToString()));											
										}
									}
								}								
								bCont=bCont && Math.Round(giaban,2)-Math.Round(giamua,2)>1;///Math.Round(giaban,2)!=Math.Round(giamua,2);
								if (bchenhlech_traituyen && int.Parse(dr[i]["traituyen"].ToString())==0) bCont=false;
								
								if (bCont)
								{
									i_madt=i_madoituongvao;
									r1=getrowbyid(dtdt,"madoituong="+i_madt);
									if (r1!=null) s_dtuong=r1["doituong"].ToString();
									dg1=giamua;
									st1=decimal.Parse(r["soluong"].ToString())*dg1;
								}
								else if (bDoituong_BHYT(int.Parse(s_madt),dtdt) && iBhyt!=0)//else if (s_madt=="1" && iBhyt!=0)// && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))
								{
									if (iBhyt!=100) s_ten+=" BHYT thanh toán "+iBhyt.ToString()+" %";//r2["bhyt"].ToString().Trim()+" %";
									//dg1=dongia*iBhyt/100;
									dg1=dongia;
									st1=decimal.Parse(r["soluong"].ToString())*(dongia*iBhyt/100);
									//dg1=dongia;
								}
								//								}
								//
								//
								#region Tinh KT Cao CHO THUOC VAT TU Y TE	
								dg1k=dg2k=st1k=st2k=0;	bCLktcao=false;
								
								if (kythuat!=-1 && bDoituong_BHYT(i_madt,dtdt) && st1>mucbhquidinh)//if (kythuat==1 && i_madt==1)
								{	
									if(!bktCao_ttDV)
									{
										st1k=st1;dg1k=dg1;
										maphu=(dr[i]["sothe"].ToString().Trim()!="")?get_maphu_noitru(dr[i]["sothe"].ToString(),nhom,dr[i]["ngayra"].ToString().Substring(0,10)):0;
										if (maphu==0)//bhyt 100%
										{
											int atyle=100;
											nhom1=get_nhom(dr[i]["sothe"].ToString(),huong100,nhom);//xac dinh nhung the huong 100%
											if (!nhom1)
											{
												//if (st1>muckhongqua)
												//{
												nhom2=get_nhom(dr[i]["sothe"].ToString(),huong100kqua,nhom);//huong 100 khong qua dinh muc
												if (nhom2 && st1>muckhongqua)
												{
													st=st1;
													d_sotien_ktcao+=st;
													if(st<=muckhongqua && d_sotien_ktcao<=muckhongqua)
													{
														bCLktcao=false;
														st1k=st1;dg1k=dg1;
														st2k=0;dg2k=0;
														//binh thuong:
													}
													else if(st<=muckhongqua && d_sotien_ktcao>muckhongqua)
													{
														decimal tmpst=st1;
														st1k=(d_sotien_ktcao-muckhongqua>st)?0:(st-(d_sotien_ktcao-muckhongqua));
														st1k=Math.Round(st1k*(100/atyle),0);//lay nguoc lai st chua co bhyt
														dg1k=Math.Round(st1k/decimal.Parse(r["soluong"].ToString()),3);
														st2k=tmpst-st1k;
														dg2k=Math.Round(st2k/decimal.Parse(r["soluong"].ToString()),3);
														bCLktcao=true;
											
													}
													else if(st1>d_sotien_ktcao_dinhmuc)
													{
														decimal tmpst=st1;
														st1k=(d_sotien_ktcao-d_sotien_ktcao_dinhmuc>st1)?0:(st-(d_sotien_ktcao-d_sotien_ktcao_dinhmuc));
														st1k=Math.Round(st1k*(100/atyle),0);//lay nguoc lai st chua co bhyt
														dg1k=Math.Round(st1k/decimal.Parse(r["soluong"].ToString()),3);
														st2k=tmpst-st1k;
														dg2k=Math.Round(st2k/decimal.Parse(r["soluong"].ToString()),3);
														bCLktcao=true;
													}
												}
												else 
												{
													int tmp_phantrambhyt=phantrambhyt;
													if(dr[i]["sothe"].ToString().Length==15||dr[i]["sothe"].ToString().Length==20)
													{
														tmp_phantrambhyt=(maphu==0)?100:(maphu==1)?80:95;
													}
													st = st1 * tmp_phantrambhyt / 100;//huong khong qua 60%
													d_sotien_ktcao+=st;

													if (d_sotien_ktcao < mucbhquidinh)//if (st < mucbhquidinh)
													{
														st1k = mucbhquidinh;
														dg1k = st1k / decimal.Parse(r["soluong"].ToString());
														st2k = st1 - st1k;
														dg2k = st2k / decimal.Parse(r["soluong"].ToString());
														bCLktcao=true;
													}
													else if (d_sotien_ktcao > muckhongqua)//else if (st > muckhongqua)
													{
														//													st1k = muckhongqua;//60% vuot qua dinh muc thi so tien=so tien dinh muc
														//													dg1k = st1k / decimal.Parse(r["soluong"].ToString());
														//													st2k = st1 - st1k;// chenh lech = so tien - so tien dinh muc
														//													dg2k = st2k / decimal.Parse(r["soluong"].ToString());
														decimal tmpst=st1;
														st1k=(d_sotien_ktcao-muckhongqua>st)?0:(st-(d_sotien_ktcao-muckhongqua));
														st1k=Math.Round(st1k*(100/atyle),0);//lay nguoc lai st chua co bhyt
														dg1k=Math.Round(st1k/decimal.Parse(r["soluong"].ToString()),3);
														st2k=tmpst-st1k;
														dg2k=Math.Round(st2k/decimal.Parse(r["soluong"].ToString()),3);
														bCLktcao=true;
													}
													else
													{
														if(st<=muckhongqua && d_sotien_ktcao<=muckhongqua)
														{
															bCLktcao=false;
															st1k=st1;dg1k=dg1;
															st2k=0;dg2k=0;
															//binh thuong:
														}
														else if(st<=muckhongqua && d_sotien_ktcao>muckhongqua)
														{
															decimal tmpst=st1;
															st1k=(d_sotien_ktcao-muckhongqua>st)?0:(st-(d_sotien_ktcao-muckhongqua));
															st1k=Math.Round(st1k*(100/atyle),0);//lay nguoc lai st chua co bhyt
															dg1k=Math.Round(st1k/decimal.Parse(r["soluong"].ToString()),3);
															st2k=tmpst-st1k;
															dg2k=Math.Round(st2k/decimal.Parse(r["soluong"].ToString()),3);
															bCLktcao=true;
											
														}
														else if(st1>d_sotien_ktcao_dinhmuc)
														{
															decimal tmpst=st1;
															st1k=(d_sotien_ktcao-d_sotien_ktcao_dinhmuc>st1)?0:(st-(d_sotien_ktcao-d_sotien_ktcao_dinhmuc));
															st1k=Math.Round(st1k*(100/atyle),0);//lay nguoc lai st chua co bhyt
															dg1k=Math.Round(st1k/decimal.Parse(r["soluong"].ToString()),3);
															st2k=tmpst-st1k;
															dg2k=Math.Round(st2k/decimal.Parse(r["soluong"].ToString()),3);
															bCLktcao=true;
														}
													}
												}
												//}
											}
										}									
										else
										{
											decimal atyle=(maphu==1)?80:(maphu==0)?100:95;
											st=st1*atyle/100;
											//
											d_sotien_ktcao+=st;
											//
											bFound_ktcao_vuot= d_sotien_ktcao>muckhongqua;
											if(st<=muckhongqua && d_sotien_ktcao<=muckhongqua)
											{
												bCLktcao=false;
												st1k=st1;dg1k=dg1;
												st2k=0;dg2k=0;
												//binh thuong:
											}
											else if(st<=muckhongqua && d_sotien_ktcao>muckhongqua)
											{
												decimal tmpst=st1;
												st1k=(d_sotien_ktcao-muckhongqua>st)?0:(st-(d_sotien_ktcao-muckhongqua));
												st1k=Math.Round(st1k*(100/atyle),0);//lay nguoc lai st chua co bhyt
												dg1k=Math.Round(st1k/decimal.Parse(r["soluong"].ToString()),3);
												st2k=tmpst-st1k;
												dg2k=Math.Round(st2k/decimal.Parse(r["soluong"].ToString()),3);
												bCLktcao=true;
											
											}
											else if(st1>d_sotien_ktcao_dinhmuc)
											{
												decimal tmpst=st1;
												st1k=(d_sotien_ktcao-d_sotien_ktcao_dinhmuc>st1)?0:(st-(d_sotien_ktcao-d_sotien_ktcao_dinhmuc));
												st1k=Math.Round(st1k*(100/atyle),0);//lay nguoc lai st chua co bhyt
												dg1k=Math.Round(st1k/decimal.Parse(r["soluong"].ToString()),3);
												st2k=tmpst-st1k;
												dg2k=Math.Round(st2k/decimal.Parse(r["soluong"].ToString()),3);
												bCLktcao=true;
											}
										}
										dg1=dg1k; st1=st1k;
										dg2=dg2k; st2=st2k;
										//bCLktcao=true;
									}
								}
								#endregion  Tinh KT Cao - thuoc - vat tu
								//
								//
								//Tim gia chenh lech																
								dg2=(bCLktcao)?dg2k:0;
								if (bCont)//co chenh lech
								{
									dg2+=Math.Round(giaban,0)-Math.Round(giamua,0);
									if(kythuat!=-1 && dg2>0 && dongia==giamua)bCLktcao=true;
								}
								//								else if (bDoituong_BHYT(int.Parse(s_madt),dtdt) && iBhyt!=0)//else if (s_madt=="1" && iBhyt!=0)//decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))
								//								{
								//									decimal bn2=100-iBhyt;
								//									//dg2+=dongia*bn2/100;
								//									dg2+=dongia;
								//								}
								//
								if(m_madoituong_inttrv=="" || m_madoituong_inttrv.IndexOf(","+dr[i]["madoituong"].ToString()+",")>=0)
								{
									//binh 070611: do khi chon chuyen so lieu vp, nhung khong chon het doi tuong, chi chon 1 dtuong de in (thuong in lai)
									//Khi do SL chuyen xuong vp chi chuyen doi tuong duoc chon --> do do thieu so lieu
									//
									updrec_ravien(ds,int.Parse(dr[i]["khu"].ToString()),dr[i]["mabn"].ToString(),dr[i]["mabn"].ToString(),long.Parse(dr[i]["maql"].ToString()),long.Parse(dr[i]["idkhoa"].ToString()),dr[i]["hoten"].ToString(),dr[i]["namsinh"].ToString(),dr[i]["phai"].ToString(),
										dr[i]["diachi"].ToString(),i_madt,s_dtuong,s_sothe,iBhyt,s_tungay,s_denngay,dr[i]["noigioithieu"].ToString(),s_dkkcb,
										dr[i]["giuong"].ToString(),r["makp"].ToString() + ((bTtngay) ? " : " + r["ngay"].ToString() : ""),s_tenkp.Trim()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),ngayvao,dr[i]["ngayra"].ToString(),dr[i]["chandoan"].ToString(),dr[i]["maicd"].ToString(),int.Parse(r2["sttnhom"].ToString()),
										r2["nhom"].ToString(),int.Parse(r2["sttloai"].ToString()),r2["loai"].ToString(),int.Parse(r["mabd"].ToString()),
										s_ten,r2["dvt"].ToString(),decimal.Parse(r["soluong"].ToString()),
										st1,
										(iBhyt!=0)?st1:0,tamung,decimal.Parse(r["bhytt0107"].ToString()),dr[i]["nguoinha"].ToString(),int.Parse(dr[i]["hinhthuc"].ToString()),int.Parse(dr[i]["phuongphap"].ToString()),int.Parse(dr[i]["ketqua"].ToString()),dr[i]["soluutru"].ToString(),
										dg1,dr[i]["ngaypt"].ToString(),dr[i]["tenpt"].ToString(),loaiba,int.Parse(dr[i]["done"].ToString()),dr[i]["mabs"].ToString(),dr[i]["tenbs"].ToString(),dr[i]["tenuser"].ToString(),dr[i]["image"].ToString(),dr[i]["ghichu"].ToString(),ngay1,ngay2,ngay3,(bTtngay)?r["ngay"].ToString():"",kythuat,
										b_sobienlaitamung,(r["idttrv"].ToString()!="")?long.Parse(r["idttrv"].ToString()):0,"","",int.Parse(dr[i]["traituyen"].ToString()),giamua,giaban,(bCLktcao||ngia)?dg2:0,0,(r["id_ktcao"].ToString()==null || r["id_ktcao"].ToString()=="")? 0:decimal.Parse(r["id_ktcao"].ToString()),0,"","");
								}
								if (dr[i]["done"].ToString()=="0" && (int.Parse(dr[i]["madoituong"].ToString())!=i_haophi || (int.Parse(dr[i]["madoituong"].ToString())==i_haophi && bHaophi_vp)))
								{
									upd_thvpct(s_mmyy,idvienphi,r["ngay"].ToString(),r["makp"].ToString(),i_madt,long.Parse(r["mabd"].ToString()),decimal.Parse(r["soluong"].ToString()),dg1,st1,0,s_sothe);
									if(r["id_ktcao"].ToString()!="0") execute_data(" update "+user+s_mmyy+".v_thvpct set id_ktcao="+r["id_ktcao"].ToString()+" where id="+idvienphi+" and mavp="+long.Parse(r["mabd"].ToString())+" and makp='"+r["makp"].ToString()+"'");
								}
								
								//
								
								
								dg2=(bCLktcao)?dg2k:0;
								st2=(bCLktcao)?st2k:0;

								if (bCont)
								{
									//
									if(s_mabd_chenhlech.IndexOf(r["mabd"].ToString()+",")<0)s_mabd_chenhlech+=r["mabd"].ToString()+",";
									//
									s_madt=i_tunguyen.ToString();
									i_madt=int.Parse(s_madt);
									r1=getrowbyid(dtdt,"madoituong="+i_madt);
									if (r1!=null) s_dtuong=r1["doituong"].ToString();
									s_ten+=" BN thanh toán chênh lệch ";									
									
									dg2+=Math.Round(giaban,0)-Math.Round(giamua,0);//giaban-giamua;
									st2+=decimal.Parse(r["soluong"].ToString())*dg2;
									
								}
								else if (bDoituong_BHYT(int.Parse(s_madt),dtdt) && iBhyt!=0)//else if (s_madt=="1" && iBhyt!=0)//decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))
								{
									i_madt=i_tunguyen;
									s_dtuong=s_doituong;
									s_ten=r2["ten"].ToString();
									dg1=dongia*iBhyt/100;
									decimal bn=100-iBhyt;
									if (iBhyt!=100) 
									{
										s_ten+=" BN thanh toán "+bn.ToString().Trim()+" %";
										//dg2+=dongia*bn/100;
										dg2+=dongia;
										st2+=decimal.Parse(r["sotien"].ToString())-decimal.Parse(r["soluong"].ToString())*(dongia*bn/100);
									}
									else 
									{
										dg2+=dongia*bn/100;
										st2+=decimal.Parse(r["sotien"].ToString())-decimal.Parse(r["soluong"].ToString())*dg2;
									}
									
									//dg2=dongia;//???
								}
								else if(bCLktcao && dg2>0)
								{
									i_madt=i_tunguyen;
									s_dtuong=s_doituong;
									s_ten=r2["ten"].ToString();
									s_ten+=" BN thanh toán chênh lệch KT Cao ";									
								}
								
								if (dg2!=0 && st2!=0)
								{
									if(m_madoituong_inttrv=="" || m_madoituong_inttrv.IndexOf(","+dr[i]["madoituong"].ToString()+",")>=0)
									{
										//binh 070611: do khi chon chuyen so lieu vp, nhung khong chon het doi tuong, chi chon 1 dtuong de in (thuong in lai)
										//Khi do SL chuyen xuong vp chi chuyen doi tuong duoc chon --> do do thieu so lieu
										//
										updrec_ravien(ds,int.Parse(dr[i]["khu"].ToString()),dr[i]["mabn"].ToString(),dr[i]["mabn"].ToString(),long.Parse(dr[i]["maql"].ToString()),long.Parse(dr[i]["idkhoa"].ToString()),dr[i]["hoten"].ToString(),dr[i]["namsinh"].ToString(),dr[i]["phai"].ToString(),
											dr[i]["diachi"].ToString(),i_madt,s_dtuong,s_sothe,iBhyt,s_tungay,s_denngay,dr[i]["noigioithieu"].ToString(),s_dkkcb,
											dr[i]["giuong"].ToString(),r["makp"].ToString()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),s_tenkp.Trim()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),ngayvao,dr[i]["ngayra"].ToString(),dr[i]["chandoan"].ToString(),dr[i]["maicd"].ToString(),int.Parse(r2["sttnhom"].ToString()),
											r2["nhom"].ToString(),int.Parse(r2["sttloai"].ToString()),r2["loai"].ToString(),int.Parse(r["mabd"].ToString()),
											s_ten,r2["dvt"].ToString(),decimal.Parse(r["soluong"].ToString()),
											st2,
											(iBhyt!=0)?st2:0,0,decimal.Parse(r["bhytt0107"].ToString()),dr[i]["nguoinha"].ToString(),int.Parse(dr[i]["hinhthuc"].ToString()),int.Parse(dr[i]["phuongphap"].ToString()),int.Parse(dr[i]["ketqua"].ToString()),dr[i]["soluutru"].ToString(),
											dg2,dr[i]["ngaypt"].ToString(),dr[i]["tenpt"].ToString(),loaiba,int.Parse(dr[i]["done"].ToString()),dr[i]["mabs"].ToString(),dr[i]["tenbs"].ToString(),dr[i]["tenuser"].ToString(),dr[i]["image"].ToString(),dr[i]["ghichu"].ToString(),ngay1,ngay2,ngay3,
											(bTtngay)?r["ngay"].ToString():"",kythuat,b_sobienlaitamung,(r["idttrv"].ToString()!="")?long.Parse(r["idttrv"].ToString()):0,"","",int.Parse(dr[i]["traituyen"].ToString()),giamua,giaban,(bCLktcao||ngia?-1:0),0,(r["id_ktcao"].ToString()==null || r["id_ktcao"].ToString()=="")? 0:decimal.Parse(r["id_ktcao"].ToString()),0,"","");
									}
									if (dr[i]["done"].ToString()=="0"  && int.Parse(dr[i]["madoituong"].ToString())!=i_haophi)
									{
										upd_thvpct(s_mmyy,idvienphi,r["ngay"].ToString(),r["makp"].ToString(),i_madt,long.Parse(r["mabd"].ToString()),decimal.Parse(r["soluong"].ToString()),dg2,st2,0,s_sothe);
										if(r["id_ktcao"].ToString()!="0") execute_data(" update "+user+s_mmyy+".v_thvpct set id_ktcao="+r["id_ktcao"].ToString()+" where id="+idvienphi+" and mavp="+long.Parse(r["mabd"].ToString())+" and makp='"+r["makp"].ToString()+"'");
									}
								}
								if (dr[i]["done"].ToString()=="0" && (int.Parse(dr[i]["madoituong"].ToString())!=i_haophi || (int.Parse(dr[i]["madoituong"].ToString())==i_haophi && bHaophi_vp)))
								{
									sotien+=decimal.Parse(r["sotien"].ToString());
									bhyt+=(iBhyt!=0)?st1+st2:0;//decimal.Parse(r["bhyt"].ToString());
								}
							}
						}
					}
					//ds.WriteXml("xx.xml",XmlWriteMode.WriteSchema);
				}
				#endregion Thuoc
				if (dr[i]["done"].ToString()=="0"  && ((bHaophi_vienphi==false && int.Parse(dr[i]["madoituong"].ToString())!=i_haophi)||bHaophi_vienphi==true) )//&& int.Parse(dr[i]["madoituong"].ToString())!=i_haophi)
				{
					if (bDoituong_BHYT(dr[i]["madoituong"].ToString())) //if (dr[i]["madoituong"].ToString()=="1") //bhyt
					{
						if (dr[i]["maphu"].ToString()=="0") // Ko cung chi tra
						{
							bhyt=sotien;sotien=0;
						}
						else sotien=sotien-bhyt;
					}
					else if (mien_doituong(int.Parse(dr[i]["madoituong"].ToString()),dtdt)) //mien
					{
						mien=sotien;sotien=0;bhyt=0;
					}
					else bhyt=0;
					if (sotien+mien+bhyt+tamung!=0) upd_thvpll(s_mmyy,idvienphi,dr[i]["mabn"].ToString(),maql,idkhoa,dr[i]["ngayvao"].ToString(),dr[i]["ngayra"].ToString(),dr[i]["giuong"].ToString(),dr[i]["makp"].ToString(),dr[i]["chandoan"].ToString(),dr[i]["maicd"].ToString(),sotien,tamung,bhyt,mien,int.Parse(dr[i]["khu"].ToString()));
					if (mien+bhyt!=0 && s_sothe!="" && s_sothe.Length<=20) upd_thvpbhyt(s_mmyy,idvienphi,s_sothe,int.Parse(dr[i]["maphu"].ToString()),get_manoigioithieu(maql),get_manoicap(maql),int.Parse(dr[i]["traituyen"].ToString()));//dr[i]["sothe"].ToString().Trim()
					//if (s_sothe!="" && dr[i]["madoituong"].ToString()=="1") upd_thvpbhyt(s_mmyy,idvienphi,s_sothe,int.Parse(dr[i]["maphu"].ToString()),get_manoigioithieu(maql),get_manoicap(maql));//dr[i]["sothe"].ToString().Trim()
				}

				if (bKhongchiphi ||( ds.Tables[0].Rows.Count==0 && tamung>0))
				{				
					if(m_madoituong_inttrv=="" || m_madoituong_inttrv.IndexOf(","+dr[i]["madoituong"].ToString()+",")>=0)
					{
						//binh 070611: do khi chon chuyen so lieu vp, nhung khong chon het doi tuong, chi chon 1 dtuong de in (thuong in lai)
						//Khi do SL chuyen xuong vp chi chuyen doi tuong duoc chon --> do do thieu so lieu
						//
						updrec_ravien(ds,int.Parse(dr[i]["khu"].ToString()),dr[i]["mabn"].ToString(),dr[i]["mabn"].ToString(),long.Parse(dr[i]["maql"].ToString()),long.Parse(dr[i]["idkhoa"].ToString()),dr[i]["hoten"].ToString(),dr[i]["namsinh"].ToString(),dr[i]["phai"].ToString(),
							dr[i]["diachi"].ToString(),i_madt,s_dtuong,dr[i]["sothe"].ToString(),int.Parse(dr[i]["maphu"].ToString()),dr[i]["tungay"].ToString(),dr[i]["denngay"].ToString(),dr[i]["noigioithieu"].ToString(),s_dkkcb,
							dr[i]["giuong"].ToString(),makp,s_tenkp,dr[i]["ngayvao"].ToString(),dr[i]["ngayra"].ToString(),dr[i]["chandoan"].ToString(),dr[i]["maicd"].ToString(),0,
							"",0,"",0,"","",0,0,0,tamung,0,dr[i]["nguoinha"].ToString(),int.Parse(dr[i]["hinhthuc"].ToString()),int.Parse(dr[i]["phuongphap"].ToString()),int.Parse(dr[i]["ketqua"].ToString()),dr[i]["soluutru"].ToString(),
							0,dr[i]["ngaypt"].ToString(),dr[i]["tenpt"].ToString(),loaiba,int.Parse(dr[i]["done"].ToString()),dr[i]["mabs"].ToString(),dr[i]["tenbs"].ToString(),dr[i]["tenuser"].ToString(),dr[i]["image"].ToString(),dr[i]["ghichu"].ToString(),dr[i]["ngay1"].ToString(),dr[i]["ngay2"].ToString(),dr[i]["ngay3"].ToString(),(bTtngay)?dr[i]["ngayvao"].ToString():"",-1,b_sobienlaitamung,0,"","",int.Parse(dr[i]["traituyen"].ToString()),0,0,0,0,0,0,"","");
					}
				}
			}
			#region sosinh
			idkhoa=0;maql=0;idvienphi=0;maql_phongluu=0;m_madoituong_inttrv="";
			for(int i=0;i<drss.Length;i++)
			{
				//ThanhCuong-07072011-thêm m_madoituong_inttrv của sơ sinh để in chi phí
				if(drss[i]["done"].ToString()=="0"){m_madoituong_inttrv=(drss[i]["chon"].ToString().ToLower()=="true")?","+drss[i]["madoituong"].ToString()+",":",0,";}//ThanhCuong-07072011
				//
				r1=getrowbyid(dtkp,"makp='"+drss[i]["makp"].ToString()+"'");				
				i_madoituongvao=int.Parse(drss[i]["madoituongvao"].ToString());
				tamung=0;sotien=0;bhyt=0;mien=0;
				if (bndot || bKhu) idkhoa=long.Parse(drss[i]["idkhoa"].ToString());
				maql=long.Parse(drss[i]["maql"].ToString());
				if (bVienphi_phongluu) maql_phongluu=get_maql_phongluu(maql);
				else maql_phongluu=0;
				if (maql_phongluu==maql) maql_phongluu=0;
				if (drss[i]["done"].ToString()=="0"  && int.Parse(drss[i]["madoituong"].ToString())!=i_haophi)
				{
					s_idvienphi=get_id_thvp((int.Parse(drss[i]["motkhu"].ToString())==1)?0:int.Parse(drss[i]["khu"].ToString()),drss[i]["mame"].ToString(),long.Parse(drss[i]["maqlme"].ToString()),long.Parse(drss[i]["idkhoame"].ToString()),drss[i]["ngayvaome"].ToString(),drss[i]["ngayra"].ToString(),ngayserver,bTheongay);
					if (s_idvienphi=="") 
					{
						s_mmyy=mmyy_server;
						idvienphi=get_id_thvp();
					}
					else
					{
						s_mmyy=s_idvienphi.Substring(0,4);
						idvienphi=long.Parse(s_idvienphi.Substring(4));
					}
				}
				tamung=get_tamung_ct((int.Parse(drss[i]["motkhu"].ToString())==1)?0:int.Parse(drss[i]["khu"].ToString()),drss[i]["mabn"].ToString(),maql,idkhoa,drss[i]["ngayvao"].ToString(),drss[i]["ngayra"].ToString(),(makp=="")?"":drss[i]["makp"].ToString(),int.Parse(drss[i]["madoituong"].ToString()),int.Parse(drss[i]["done"].ToString()),maql_phongluu,loaiba,drss[i]["maso"].ToString(),bTheongay,ngayvaovien);
				tc_tamung+=tamung;
				if (!bBosolieuduoc)
				{
					#region Thuoc_ss
					tmp=get_thuoc_ct((int.Parse(drss[i]["motkhu"].ToString())==1)?0:int.Parse(drss[i]["khu"].ToString()),drss[i]["mabn"].ToString(),maql,idkhoa,drss[i]["ngayvao"].ToString(),drss[i]["ngayra"].ToString(),(makp=="" || r1==null)?0:int.Parse(r1["id"].ToString()),int.Parse(drss[i]["madoituong"].ToString()),int.Parse(drss[i]["done"].ToString()),maql_phongluu,bChenhlechdv,bCapve,bNgtr,loaiba,drss[i]["makp"].ToString(),0,drss[i]["maso"].ToString(),bTheongay,bThanhtoanndot,bTTRV_theokhoa,ngayvaovien);
					if (tmp!=null)
					{
						foreach(DataRow r in tmp.Rows)
						{													
							r2=getrowbyid(dtbd,"id="+int.Parse(r["mabd"].ToString()));
							if (r2!=null)
							{
								//
								if(s_mabd.IndexOf(r["mabd"].ToString()+",")<0)s_mabd+=r["mabd"].ToString()+",";
								//
								iBhyt=int.Parse(r2["bhyt"].ToString());
								DataRow rkp=getrowbyid(dtkp,"makp='"+r["makp"].ToString()+"'");
								if(rkp!=null)s_tenkp=rkp["ten"].ToString();
								else s_tenkp=drss[i]["tenkp"].ToString();
								s_madt=drss[i]["madoituong"].ToString().Trim();
								i_madt=int.Parse(s_madt);
								s_dtuong=drss[i]["doituong"].ToString();
								s_ten=r2["ten"].ToString();
								dongia=decimal.Parse(r["dongia"].ToString());
								dg1=dongia;dg2=0;st2=0;st1=decimal.Parse(r["sotien"].ToString());
								if (bChenhlechdv && s_madt==i_tunguyen.ToString().Trim() && chenhlech.IndexOf(i_madoituongvao.ToString().Trim()+",")!=-1 && decimal.Parse(r2["bhyt"].ToString())>0 && r["loai"].ToString().Trim()=="1" && Math.Round(decimal.Parse(r["giaban"].ToString()),2)!=Math.Round(decimal.Parse(r["giamua"].ToString()),2))
								{
									i_madt=i_madoituongvao;
									r1=getrowbyid(dtdt,"madoituong="+i_madt);
									if (r1!=null) s_dtuong=r1["doituong"].ToString();
									dg1=decimal.Parse(r["giamua"].ToString());
									st1=decimal.Parse(r["soluong"].ToString())*dg1;
								}
								else if (bDoituong_BHYT(int.Parse(s_madt),dtdt) && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))//else if (s_madt=="1" && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))
								{
									s_ten+=" BHYT thanh toán "+r2["bhyt"].ToString().Trim()+" %";
									dg1=dongia*decimal.Parse(r2["bhyt"].ToString())/100;
									st1=decimal.Parse(r["bhyt"].ToString());
								}
								dg2=0;
								if (bChenhlechdv && s_madt==i_tunguyen.ToString().Trim() && chenhlech.IndexOf(i_madoituongvao.ToString().Trim()+",")!=-1 && decimal.Parse(r2["bhyt"].ToString())>0 && r["loai"].ToString().Trim()=="1" && Math.Round(decimal.Parse(r["giaban"].ToString()),2)!=Math.Round(decimal.Parse(r["giamua"].ToString()),2))
								{
									dg2=decimal.Parse(r["giaban"].ToString())-decimal.Parse(r["giamua"].ToString());
								}
								if(m_madoituong_inttrv=="" || m_madoituong_inttrv.IndexOf(","+drss[i]["madoituong"].ToString()+",")>=0)
								{
									//binh 070611: do khi chon chuyen so lieu vp, nhung khong chon het doi tuong, chi chon 1 dtuong de in (thuong in lai)
									//Khi do SL chuyen xuong vp chi chuyen doi tuong duoc chon --> do do thieu so lieu
									//ThanhCuong-06072011-Thêm mã thẻ của trẻ em drss[i]["sothe"].ToString()
									updrec_ravien(ds,int.Parse(drss[i]["khu"].ToString()),drss[i]["mame"].ToString(),drss[i]["mabn"].ToString(),long.Parse(drss[i]["maql"].ToString()),long.Parse(drss[i]["idkhoa"].ToString()),drss[i]["hoten"].ToString(),drss[i]["namsinh"].ToString(),drss[i]["phai"].ToString(),
										drss[i]["diachi"].ToString(),i_madt,s_dtuong,drss[i]["sothe"].ToString(),iBhyt,drss[i]["tungay"].ToString(),drss[i]["denngay"].ToString(),drss[i]["noigioithieu"].ToString(),drss[i]["noicap"].ToString(),
										drss[i]["giuong"].ToString(),r["makp"].ToString()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),s_tenkp.Trim()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),drss[i]["ngayvao"].ToString(),drss[i]["ngayra"].ToString(),drss[i]["chandoan"].ToString(),drss[i]["maicd"].ToString(),int.Parse(r2["sttnhom"].ToString()),
										r2["nhom"].ToString(),int.Parse(r2["sttloai"].ToString()),r2["loai"].ToString(),int.Parse(r["mabd"].ToString()),
										s_ten,r2["dvt"].ToString(),decimal.Parse(r["soluong"].ToString()),
										st1,
										decimal.Parse(r["bhyt"].ToString()),tamung,decimal.Parse(r["bhytt0107"].ToString()),drss[i]["nguoinha"].ToString(),int.Parse(drss[i]["hinhthuc"].ToString()),int.Parse(drss[i]["phuongphap"].ToString()),int.Parse(drss[i]["ketqua"].ToString()),drss[i]["soluutru"].ToString(),
										dg1,drss[i]["ngaypt"].ToString(),drss[i]["tenpt"].ToString(),loaiba,int.Parse(drss[i]["done"].ToString()),drss[i]["mabs"].ToString(),drss[i]["tenbs"].ToString(),drss[i]["tenuser"].ToString(),drss[i]["image"].ToString(),drss[i]["ghichu"].ToString(),drss[i]["ngay1"].ToString(),drss[i]["ngay2"].ToString(),drss[i]["ngay3"].ToString(),(bTtngay)?r["ngay"].ToString():"",-1,b_sobienlaitamung,int.Parse(drss[i]["traituyen"].ToString()),dg2);
								}
								if (drss[i]["done"].ToString()=="0" && (int.Parse(drss[i]["madoituong"].ToString())!=i_haophi || (int.Parse(drss[i]["madoituong"].ToString())==i_haophi && bHaophi_vp)))
									upd_thvpct(s_mmyy,idvienphi,r["ngay"].ToString(),r["makp"].ToString(),i_madt,long.Parse(r["mabd"].ToString()),decimal.Parse(r["soluong"].ToString()),dg1,st1,0,"");

								if (bChenhlechdv && s_madt==i_tunguyen.ToString().Trim() && chenhlech.IndexOf(i_madoituongvao.ToString().Trim()+",")!=-1 && decimal.Parse(r2["bhyt"].ToString())>0 && r["loai"].ToString().Trim()=="1" && Math.Round(decimal.Parse(r["giaban"].ToString()),2)!=Math.Round(decimal.Parse(r["giamua"].ToString()),2))
								{
									//
									if(s_mabd_chenhlech.IndexOf(r["mabd"].ToString()+",")<0)s_mabd_chenhlech+=r["mabd"].ToString()+",";
									//
									i_madt=int.Parse(s_madt);
									r1=getrowbyid(dtdt,"madoituong="+i_madt);
									if (r1!=null) s_dtuong=r1["doituong"].ToString();
									s_ten+=" BN thanh toán chênh lệch ";
									dg2=decimal.Parse(r["giaban"].ToString())-decimal.Parse(r["giamua"].ToString());
									st2=decimal.Parse(r["soluong"].ToString())*dg2;
								}
								else if (bDoituong_BHYT(int.Parse(s_madt),dtdt) && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))//else if (s_madt=="1" && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))
								{
									i_madt=i_tunguyen;
									s_dtuong=s_doituong;
									s_ten=r2["ten"].ToString();
									decimal bn=100-decimal.Parse(r2["bhyt"].ToString());
									s_ten+=" BN thanh toán "+bn.ToString().Trim()+" %";
									dg2=dongia*bn/100;
									st2=decimal.Parse(r["sotien"].ToString())-decimal.Parse(r["bhyt"].ToString());
								}
								
								if (dg2>0)
								{
									if(m_madoituong_inttrv=="" || m_madoituong_inttrv.IndexOf(","+drss[i]["madoituong"].ToString()+",")>=0)
									{
										//binh 070611: do khi chon chuyen so lieu vp, nhung khong chon het doi tuong, chi chon 1 dtuong de in (thuong in lai)
										//Khi do SL chuyen xuong vp chi chuyen doi tuong duoc chon --> do do thieu so lieu
										//ThanhCuong-06072011-Thêm mã thẻ của trẻ em drss[i]["sothe"].ToString()
										updrec_ravien(ds,int.Parse(drss[i]["khu"].ToString()),drss[i]["mame"].ToString(),drss[i]["mabn"].ToString(),long.Parse(drss[i]["maql"].ToString()),long.Parse(drss[i]["idkhoa"].ToString()),drss[i]["hoten"].ToString(),drss[i]["namsinh"].ToString(),drss[i]["phai"].ToString(),
											drss[i]["diachi"].ToString(),i_madt,s_dtuong,drss[i]["sothe"].ToString(),iBhyt,drss[i]["tungay"].ToString(),drss[i]["denngay"].ToString(),drss[i]["noigioithieu"].ToString(),drss[i]["noicap"].ToString(),
											drss[i]["giuong"].ToString(),r["makp"].ToString()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),s_tenkp.Trim()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),drss[i]["ngayvao"].ToString(),drss[i]["ngayra"].ToString(),drss[i]["chandoan"].ToString(),drss[i]["maicd"].ToString(),int.Parse(r2["sttnhom"].ToString()),
											r2["nhom"].ToString(),int.Parse(r2["sttloai"].ToString()),r2["loai"].ToString(),int.Parse(r["mabd"].ToString()),
											s_ten,r2["dvt"].ToString(),decimal.Parse(r["soluong"].ToString()),
											st2,
											decimal.Parse(r["bhyt"].ToString()),tamung,decimal.Parse(r["bhytt0107"].ToString()),drss[i]["nguoinha"].ToString(),int.Parse(drss[i]["hinhthuc"].ToString()),int.Parse(drss[i]["phuongphap"].ToString()),int.Parse(drss[i]["ketqua"].ToString()),drss[i]["soluutru"].ToString(),
											dg2,drss[i]["ngaypt"].ToString(),drss[i]["tenpt"].ToString(),loaiba,int.Parse(drss[i]["done"].ToString()),drss[i]["mabs"].ToString(),drss[i]["tenbs"].ToString(),drss[i]["tenuser"].ToString(),drss[i]["image"].ToString(),drss[i]["ghichu"].ToString(),drss[i]["ngay1"].ToString(),drss[i]["ngay2"].ToString(),drss[i]["ngay3"].ToString(),(bTtngay)?r["ngay"].ToString():"",-1,b_sobienlaitamung,(r["idttrv"].ToString()!="")?long.Parse(r["idttrv"].ToString()):0,"","",int.Parse(drss[i]["traituyen"].ToString()),0,0,0);
									}
									if (drss[i]["done"].ToString()=="0"  && int.Parse(drss[i]["madoituong"].ToString())!=i_haophi)
										upd_thvpct(s_mmyy,idvienphi,r["ngay"].ToString(),r["makp"].ToString(),i_madt,long.Parse(r["mabd"].ToString()),decimal.Parse(r["soluong"].ToString()),dg2,st2,0,"");
								}
								if (drss[i]["done"].ToString()=="0" && (int.Parse(drss[i]["madoituong"].ToString())!=i_haophi || (int.Parse(drss[i]["madoituong"].ToString())==i_haophi && bHaophi_vp)))
								{
									sotien+=decimal.Parse(r["sotien"].ToString());
									bhyt+=decimal.Parse(r["bhyt"].ToString());
								}
							}
						}
					}
					#endregion Thuoc_ss
				}
				#region  Vienphi_ss
				tmp=get_vienphi_ct((int.Parse(drss[i]["motkhu"].ToString())==1)?0:int.Parse(drss[i]["khu"].ToString()),drss[i]["mabn"].ToString(),maql,idkhoa,drss[i]["ngayvao"].ToString(),drss[i]["ngayra"].ToString(),(makp=="")?"":drss[i]["makp"].ToString(),int.Parse(drss[i]["madoituong"].ToString()),int.Parse(drss[i]["done"].ToString()),maql_phongluu,bCapve,bNgtr,loaiba,makp_rv,0,drss[i]["maso"].ToString(),bTheongay,bThanhtoanndot,bTTRV_theokhoa,ngayvaovien);
				if (tmp!=null)
				{
					foreach(DataRow r in tmp.Rows)
					{
						DataRow rkp=getrowbyid(dtkp,"makp='"+r["makp"].ToString()+"'");
						if(rkp!=null)s_tenkp=rkp["ten"].ToString();
						else s_tenkp=drss[i]["tenkp"].ToString();
						r2=getrowbyid(dtvp,"id="+int.Parse(r["mavp"].ToString()));
						if (r2!=null)
						{
							iBhyt=int.Parse(r2["bhyt"].ToString());
							s_madt=drss[i]["madoituong"].ToString();
							i_madt=int.Parse(s_madt);
							s_dtuong=drss[i]["doituong"].ToString();
							s_ten=r2["ten"].ToString();
							f1="th";f2="th";
							//
							dongia=decimal.Parse(r["dongia"].ToString());
							dg1=dongia;dg2=0;st2=0;st1=decimal.Parse(r["sotien"].ToString());
							r1=getrowbyid(dtdt,"madoituong in("+sMaDoituong_BHYT().Trim().Trim(',')+")");//r1=getrowbyid(dtdt,"madoituong=1");
							if (r1!=null) f1=r1["field_gia"].ToString().Trim().Substring(r1["field_gia"].ToString().Trim().IndexOf("_")+1);
							r1=getrowbyid(dtdt,"madoituong="+i_madt);
							if (r1!=null) f2=r1["field_gia"].ToString().Trim().Substring(r1["field_gia"].ToString().Trim().IndexOf("_")+1);
							if (bChenhlechdv && s_madt==i_tunguyen.ToString().Trim() && chenhlech.IndexOf(i_madoituongvao.ToString().Trim()+",")!=-1 && decimal.Parse(r2["bhyt"].ToString())>0 && decimal.Parse(r2["gia_"+f1.Trim()].ToString())<=decimal.Parse(r2["gia_"+f2.Trim()].ToString()))
							{
								i_madt=i_madoituongvao;
								r1=getrowbyid(dtdt,"madoituong="+i_madt);
								if (r1!=null) s_dtuong=r1["doituong"].ToString();
								dg1=decimal.Parse(r2["gia_"+f1.Trim()].ToString())+decimal.Parse(r2["vattu_"+f1.Trim()].ToString());
								st1=decimal.Parse(r["soluong"].ToString())*dg1;
							}
							else if (bDoituong_BHYT(int.Parse(s_madt),dtdt) && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))//else if (s_madt=="1" && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))
							{
								s_ten+=" BHYT thanh toán "+r2["bhyt"].ToString().Trim()+" %";
								dg1=dongia*decimal.Parse(r2["bhyt"].ToString())/100;
								st1=decimal.Parse(r["bhyt"].ToString());
							}	
							//
							dg2=0;
							if (bChenhlechdv && s_madt==i_tunguyen.ToString().Trim() && chenhlech.IndexOf(i_madoituongvao.ToString().Trim()+",")!=-1 && decimal.Parse(r2["bhyt"].ToString())>0 && decimal.Parse(r2["gia_"+f1.Trim()].ToString())<decimal.Parse(r2["gia_"+f2.Trim()].ToString()))
							{
								dg2=decimal.Parse(r2["gia_"+f2.Trim()].ToString())+decimal.Parse(r2["vattu_"+f2.Trim()].ToString())-dg1;
							}
							else if (bDoituong_BHYT(int.Parse(s_madt),dtdt) && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))//else if (s_madt=="1" && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))
							{
								decimal bn2=100-decimal.Parse(r2["bhyt"].ToString());
								dg2=dongia*bn2/100;
							}
							//
							if(m_madoituong_inttrv=="" || m_madoituong_inttrv.IndexOf(","+drss[i]["madoituong"].ToString()+",")>=0)
							{
								//binh 070611: do khi chon chuyen so lieu vp, nhung khong chon het doi tuong, chi chon 1 dtuong de in (thuong in lai)
								//Khi do SL chuyen xuong vp chi chuyen doi tuong duoc chon --> do do thieu so lieu
								//ThanhCuong-06072011-Thêm mã thẻ của trẻ em drss[i]["sothe"].ToString()
								updrec_ravien(ds,int.Parse(drss[i]["khu"].ToString()),drss[i]["mame"].ToString(),drss[i]["mabn"].ToString(),long.Parse(drss[i]["maql"].ToString()),long.Parse(drss[i]["idkhoa"].ToString()),drss[i]["hoten"].ToString(),drss[i]["namsinh"].ToString(),drss[i]["phai"].ToString(),
									drss[i]["diachi"].ToString(),i_madt,s_dtuong,drss[i]["sothe"].ToString(),iBhyt,drss[i]["tungay"].ToString(),drss[i]["denngay"].ToString(),drss[i]["noigioithieu"].ToString(),drss[i]["noicap"].ToString(),
									drss[i]["giuong"].ToString(),r["makp"].ToString()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),s_tenkp.Trim()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),drss[i]["ngayvao"].ToString(),drss[i]["ngayra"].ToString(),drss[i]["chandoan"].ToString(),drss[i]["maicd"].ToString(),int.Parse(r2["sttnhom"].ToString()),
									r2["nhom"].ToString(),int.Parse(r2["sttloai"].ToString()),r2["loai"].ToString(),int.Parse(r["mavp"].ToString()),
									s_ten,r2["dvt"].ToString(),decimal.Parse(r["soluong"].ToString()),
									st1,
									decimal.Parse(r["bhyt"].ToString()),tamung,decimal.Parse(r["bhytt0107"].ToString()),drss[i]["nguoinha"].ToString(),int.Parse(drss[i]["hinhthuc"].ToString()),int.Parse(drss[i]["phuongphap"].ToString()),int.Parse(drss[i]["ketqua"].ToString()),drss[i]["soluutru"].ToString(),
									dg1,drss[i]["ngaypt"].ToString(),drss[i]["tenpt"].ToString(),loaiba,int.Parse(drss[i]["done"].ToString()),drss[i]["mabs"].ToString(),drss[i]["tenbs"].ToString(),drss[i]["tenuser"].ToString(),drss[i]["image"].ToString(),drss[i]["ghichu"].ToString(),drss[i]["ngay1"].ToString(),drss[i]["ngay2"].ToString(),drss[i]["ngay3"].ToString(),(bTtngay)?r["ngay"].ToString():"",-1,b_sobienlaitamung,int.Parse(drss[i]["traituyen"].ToString()),dg2);
							}
							if (drss[i]["done"].ToString()=="0" && (int.Parse(drss[i]["madoituong"].ToString())!=i_haophi || (int.Parse(drss[i]["madoituong"].ToString())==i_haophi && bHaophi_vp)))
								upd_thvpct(s_mmyy,idvienphi,r["ngay"].ToString(),r["makp"].ToString(),i_madt,long.Parse(r["mavp"].ToString()),decimal.Parse(r["soluong"].ToString()),dg1,st1,decimal.Parse(r["vattu"].ToString()),"");
							
							//
							dg2=0;
							if (bChenhlechdv && s_madt==i_tunguyen.ToString().Trim() && chenhlech.IndexOf(i_madoituongvao.ToString().Trim()+",")!=-1 && decimal.Parse(r2["bhyt"].ToString())>0 && decimal.Parse(r2["gia_"+f1.Trim()].ToString())<decimal.Parse(r2["gia_"+f2.Trim()].ToString()))
							{
								i_madt=int.Parse(s_madt);
								r1=getrowbyid(dtdt,"madoituong="+i_madt);
								if (r1!=null) s_dtuong=r1["doituong"].ToString();
								s_ten+=" BN thanh toán chênh lệch ";
								dg2=decimal.Parse(r2["gia_"+f2.Trim()].ToString())+decimal.Parse(r2["vattu_"+f2.Trim()].ToString())-dg1;
								st2=decimal.Parse(r["soluong"].ToString())*dg2;
							}
							else if (bDoituong_BHYT(int.Parse(s_madt),dtdt) && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))//else if (s_madt=="1" && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))
							{
								s_ten=r2["ten"].ToString();
								decimal bn=100-decimal.Parse(r2["bhyt"].ToString());
								s_ten+=" BN thanh toán "+bn.ToString().Trim()+" %";
								dg2=dongia*bn/100;
								st2=decimal.Parse(r["sotien"].ToString())-decimal.Parse(r["bhyt"].ToString());
							}
							if (dg2>0)
							{
								if(m_madoituong_inttrv=="" || m_madoituong_inttrv.IndexOf(","+drss[i]["madoituong"].ToString()+",")>=0)
								{
									//binh 070611: do khi chon chuyen so lieu vp, nhung khong chon het doi tuong, chi chon 1 dtuong de in (thuong in lai)
									//Khi do SL chuyen xuong vp chi chuyen doi tuong duoc chon --> do do thieu so lieu
									//ThanhCuong-06072011-Thêm mã thẻ của trẻ em drss[i]["sothe"].ToString()
									updrec_ravien(ds,int.Parse(drss[i]["khu"].ToString()),drss[i]["mame"].ToString(),drss[i]["mabn"].ToString(),long.Parse(drss[i]["maql"].ToString()),long.Parse(drss[i]["idkhoa"].ToString()),drss[i]["hoten"].ToString(),drss[i]["namsinh"].ToString(),drss[i]["phai"].ToString(),
										drss[i]["diachi"].ToString(),i_madt,s_dtuong,drss[i]["sothe"].ToString(),iBhyt,drss[i]["tungay"].ToString(),drss[i]["denngay"].ToString(),drss[i]["noigioithieu"].ToString(),drss[i]["noicap"].ToString(),
										drss[i]["giuong"].ToString(),r["makp"].ToString()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),s_tenkp.Trim()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),drss[i]["ngayvao"].ToString(),drss[i]["ngayra"].ToString(),drss[i]["chandoan"].ToString(),drss[i]["maicd"].ToString(),int.Parse(r2["sttnhom"].ToString()),
										r2["nhom"].ToString(),int.Parse(r2["sttloai"].ToString()),r2["loai"].ToString(),int.Parse(r["mavp"].ToString()),
										s_ten,r2["dvt"].ToString(),decimal.Parse(r["soluong"].ToString()),
										st2,
										decimal.Parse(r["bhyt"].ToString()),tamung,decimal.Parse(r["bhytt0107"].ToString()),drss[i]["nguoinha"].ToString(),int.Parse(drss[i]["hinhthuc"].ToString()),int.Parse(drss[i]["phuongphap"].ToString()),int.Parse(drss[i]["ketqua"].ToString()),drss[i]["soluutru"].ToString(),
										dg2,drss[i]["ngaypt"].ToString(),drss[i]["tenpt"].ToString(),loaiba,int.Parse(drss[i]["done"].ToString()),drss[i]["mabs"].ToString(),drss[i]["tenbs"].ToString(),drss[i]["tenuser"].ToString(),drss[i]["image"].ToString(),drss[i]["ghichu"].ToString(),drss[i]["ngay1"].ToString(),drss[i]["ngay2"].ToString(),drss[i]["ngay3"].ToString(),(bTtngay)?r["ngay"].ToString():"",-1,b_sobienlaitamung,(r["idttrv"].ToString()!="")?long.Parse(r["idttrv"].ToString()):0,"","",int.Parse(drss[i]["traituyen"].ToString()),0,0,-1);
								}
								if (drss[i]["done"].ToString()=="0"  && int.Parse(drss[i]["madoituong"].ToString())!=i_haophi)
									upd_thvpct(s_mmyy,idvienphi,r["ngay"].ToString(),r["makp"].ToString(),i_madt,long.Parse(r["mavp"].ToString()),decimal.Parse(r["soluong"].ToString()),dg2,st2,decimal.Parse(r["vattu"].ToString()),"");
							}
							if (drss[i]["done"].ToString()=="0" && (int.Parse(drss[i]["madoituong"].ToString())!=i_haophi || (int.Parse(drss[i]["madoituong"].ToString())==i_haophi && bHaophi_vp)))
							{									
								sotien+=decimal.Parse(r["sotien"].ToString());
								bhyt+=decimal.Parse(r["bhyt"].ToString());
							}
						}
					}
				}
				#endregion Vienphi_ss
				if (drss[i]["done"].ToString()=="0" && ((bHaophi_vienphi==false && int.Parse(dr[i]["madoituong"].ToString())!=i_haophi)||bHaophi_vienphi==true) )//&& int.Parse(drss[i]["madoituong"].ToString())!=i_haophi)
				{
					if (bDoituong_BHYT(int.Parse(drss[i]["madoituong"].ToString()),dtdt))//if (drss[i]["madoituong"].ToString()=="1") //bhyt
					{
						if (drss[i]["maphu"].ToString()=="0") // Ko cung chi tra
						{
							bhyt=sotien;sotien=0;
						}
						else sotien=sotien-bhyt;
					}
					else if (mien_doituong(int.Parse(drss[i]["madoituong"].ToString()),dtdt)) //mien
					{
						mien=sotien;sotien=0;bhyt=0;
					}
					else bhyt=0;
					if (get_data("select * from "+user+s_mmyy+".v_thvpll where id="+idvienphi).Tables[0].Rows.Count==0)
						upd_thvpll(s_mmyy,idvienphi,drss[i]["mame"].ToString(),long.Parse(drss[i]["maqlme"].ToString()),long.Parse(drss[i]["idkhoame"].ToString()),drss[i]["ngayvaome"].ToString(),drss[i]["ngayrame"].ToString(),drss[i]["giuong"].ToString(),drss[i]["makpme"].ToString(),drss[i]["chandoanme"].ToString(),drss[i]["maicdme"].ToString(),sotien,tamung,bhyt,mien,int.Parse(drss[i]["khu"].ToString()));
					else execute_data("update "+user+s_mmyy+".v_thvpll set sotien=sotien+"+sotien+",bhyt=bhyt+"+bhyt+",mien=mien+"+mien+",tamung=tamung+"+tamung+" where id="+idvienphi);
				}
			}
			#endregion
			if (ds.Tables[0].Rows.Count==0 && tamung>0)
			{
				for(int i=0;i<dr.Length;i++)
				{
					if(m_madoituong_inttrv=="" || m_madoituong_inttrv.IndexOf(","+dr[i]["madoituong"].ToString()+",")>=0)
					{
						//binh 070611: do khi chon chuyen so lieu vp, nhung khong chon het doi tuong, chi chon 1 dtuong de in (thuong in lai)
						//Khi do SL chuyen xuong vp chi chuyen doi tuong duoc chon --> do do thieu so lieu
						//
						updrec_ravien(ds,int.Parse(dr[i]["khu"].ToString()),dr[i]["mabn"].ToString(),dr[i]["mabn"].ToString(),long.Parse(dr[i]["maql"].ToString()),long.Parse(dr[i]["idkhoa"].ToString()),dr[i]["hoten"].ToString(),dr[i]["namsinh"].ToString(),dr[i]["phai"].ToString(),
							dr[i]["diachi"].ToString(),i_madt,s_dtuong,dr[i]["sothe"].ToString(),int.Parse(dr[i]["maphu"].ToString()),dr[i]["tungay"].ToString(),dr[i]["denngay"].ToString(),dr[i]["noigioithieu"].ToString(),s_dkkcb,
							dr[i]["giuong"].ToString(),makp,s_tenkp,dr[i]["ngayvao"].ToString(),dr[i]["ngayra"].ToString(),dr[i]["chandoan"].ToString(),dr[i]["maicd"].ToString(),0,
							"",0,"",0,"","",0,0,0,tamung,0,dr[i]["nguoinha"].ToString(),int.Parse(dr[i]["hinhthuc"].ToString()),int.Parse(dr[i]["phuongphap"].ToString()),int.Parse(dr[i]["ketqua"].ToString()),dr[i]["soluutru"].ToString(),
							0,dr[i]["ngaypt"].ToString(),dr[i]["tenpt"].ToString(),loaiba,int.Parse(dr[i]["done"].ToString()),dr[i]["mabs"].ToString(),dr[i]["tenbs"].ToString(),dr[i]["tenuser"].ToString(),dr[i]["image"].ToString(),dr[i]["ghichu"].ToString(),dr[i]["ngay1"].ToString(),dr[i]["ngay2"].ToString(),dr[i]["ngay3"].ToString(),(bTtngay)?dr[i]["ngayvao"].ToString():"",-1,b_sobienlaitamung,0,"","",int.Parse(dr[i]["traituyen"].ToString()),0,0,0);
					}
				}
			}
			if(bMau38_Full)
			{
				DataSet ads1=get_data("select stt, ma, ten from "+user+".v_nhomvp ");			
				foreach(DataRow adr in ads1.Tables[0].Rows)
				{
					for(int i=0;i<dr.Length;i++)
					{
						DataRow []a_dr=ds.Tables[0].Select("madoituong="+dr[i]["madoituong"].ToString());
						if(a_dr.Length>0)
						{
							string s_exp=" madoituong="+dr[i]["madoituong"].ToString()+" and sttnhom="+adr["stt"].ToString();
							DataRow adr1=getrowbyid(ds.Tables[0],s_exp);
							if(adr1==null)
							{
								if(m_madoituong_inttrv=="" || m_madoituong_inttrv.IndexOf(","+dr[i]["madoituong"].ToString()+",")>=0)
								{
									//binh 070611: do khi chon chuyen so lieu vp, nhung khong chon het doi tuong, chi chon 1 dtuong de in (thuong in lai)
									//Khi do SL chuyen xuong vp chi chuyen doi tuong duoc chon --> do do thieu so lieu
									//
									updrec_ravien(ds,int.Parse(dr[i]["khu"].ToString()),dr[i]["mabn"].ToString(),dr[i]["mabn"].ToString(),long.Parse(dr[i]["maql"].ToString()),long.Parse(dr[i]["idkhoa"].ToString()),dr[i]["hoten"].ToString(),dr[i]["namsinh"].ToString(),dr[i]["phai"].ToString(),
										dr[i]["diachi"].ToString(),int.Parse(dr[i]["madoituong"].ToString()),dr[i]["doituong"].ToString(),dr[i]["sothe"].ToString(),int.Parse(dr[i]["maphu"].ToString()),dr[i]["tungay"].ToString(),dr[i]["denngay"].ToString(),dr[i]["noigioithieu"].ToString(),s_dkkcb,
										dr[i]["giuong"].ToString(),makp,s_tenkp,dr[i]["ngayvao"].ToString(),dr[i]["ngayra"].ToString(),dr[i]["chandoan"].ToString(),dr[i]["maicd"].ToString(),int.Parse(adr["stt"].ToString()),
										adr["ten"].ToString(),0,"",0,"","",0,0,0,0,0,dr[i]["nguoinha"].ToString(),int.Parse(dr[i]["hinhthuc"].ToString()),int.Parse(dr[i]["phuongphap"].ToString()),int.Parse(dr[i]["ketqua"].ToString()),dr[i]["soluutru"].ToString(),
										0,dr[i]["ngaypt"].ToString(),dr[i]["tenpt"].ToString(),loaiba,int.Parse(dr[i]["done"].ToString()),dr[i]["mabs"].ToString(),dr[i]["tenbs"].ToString(),dr[i]["tenuser"].ToString(),dr[i]["image"].ToString(),dr[i]["ghichu"].ToString(),dr[i]["ngay1"].ToString(),dr[i]["ngay2"].ToString(),dr[i]["ngay3"].ToString(),(bTtngay)?dr[i]["ngayvao"].ToString():"",-1,b_sobienlaitamung,0,"","",int.Parse(dr[i]["traituyen"].ToString()),0,0,0);
								}
							}
						}
					}
				}
			}
			if (ngia)
			{
				foreach(DataRow r in dtbd.Select("id in ("+(s_mabd.Trim().Trim(',')==""?"0":s_mabd.Trim().Trim(','))+")"))//foreach(DataRow r in dtbd.Rows)
				{
					r1=getrowbyid(dtvp,"id="+long.Parse(r["id"].ToString()));
					if (r1==null)
					{
						r2=dtvp.NewRow();
						r2["id"]=r["id"].ToString();
						r2["ma"]=r["ma"].ToString();
						r2["ten"]=r["ten"].ToString();
						r2["dvt"]=r["dvt"].ToString();
						r2["sttloai"]=r["sttloai"].ToString();
						r2["loai"]=r["loai"].ToString();
						r2["sttnhom"]=r["sttnhom"].ToString();
						r2["nhom"]=r["nhom"].ToString();
						r2["bhyt"]=r["bhyt"].ToString();
						r2["gia_th"]=r2["gia_bh"]=r2["gia_dv"]=r2["gia_nn"]=r2["gia_cs"]=r["gia_bh"].ToString();
						r2["vattu_th"]=r2["vattu_bh"]=r2["vattu_dv"]=r2["vattu_nn"]=r2["vattu_cs"]=0;
						r2["kythuat"]=r["kythuat"].ToString();
						if(s_mabd_chenhlech.IndexOf(r["id"].ToString()+",")<0)r2["chenhlech"]=0;
						else r2["chenhlech"]=1;
						r2["vuottuyen"]=-1;
						dtvp.Rows.Add(r2);
					}
				}
			}
			
			//ds.WriteXml("xxx.xml",XmlWriteMode.WriteSchema);
			return sort_ttravien_ct(mmyy_server,ngayserver,loaiba,dtdt,ds.Tables[0].Select("true","khu,matt,mabn,sothe,madoituong,yyyymmdd,sttnhom,tenkp,ten"),makp_rv,ngia,dtvp,ds.Tables[0],i_madoituongvao);//,ten"));
		}


		public DataSet get_ttravien_ct(DataSet ds,DataRow [] dr,DataRow [] drss,DataTable dtkp,DataTable dtbd,DataTable dtvp,string makp,bool bVienphi_phongluu,int loaiba,string makp_rv,bool bThanhtoanndot,bool ngia,bool bTheongay,string tNgaydt,string ngayvaovien)
		{	
			//linh
			int soledongiakhithanhtoan=SoLeDonGiaKhiThanhToan;
			string s_theduochuongcpvc=MaDoiTuongTheHuong100CPVC;
			try{ds.Tables[0].Columns.Add("VUOTTRAN",typeof(decimal)).DefaultValue=0;}
			catch{}
			ds.Clear();			
			bool bTTRV_theokhoa=bThanhtoan_theokhoa;
			bool bSothengayhuong=bSothe_ngay_huong;
			bool bMau38_Full=bInPhieuThanhtoanravien_daydu;
			bool bTienthuoc_tinhchenhlech=bThanhtoanchenhlech_thuoc;
			bool bktCao_ttDV=bktCao_tinhtungDV;
			DataRow r1,r2;
			DataRow [] r3;
			DataTable tmp;
			sql="select 0 as loai,id,bhyt,to_char(ngayud,'yyyymmddhh24mi') as ngaygio,to_char(ngayud,'yyyymmdd') as ngay,gia_bh from d_dmbd_luu";
			sql+=" union all ";
			sql+="select 1 as loai,id,bhyt,to_char(ngayud,'yyyymmddhh24mi') as ngaygio,to_char(ngayud,'yyyymmdd') as ngay,gia_bh from d_dmbd";
			DataTable dtbdfull=get_data(sql).Tables[0];
			tc_tamung=0;
			b_tatca_sobienlaitamung="";
			string _maql="", s_mabd="", s_mabd_chenhlech="";
			string s_ngaytrinh="",s_ngayduyet="", s_ngaygiahan="";
			bool bKhongchiphi=true;
			string m_madoituong_inttrv="";
			for(int i=0;i<dr.Length;i++)
			{
				if ((bDoituong_BHYT (int.Parse(dr[i]["madoituong"].ToString()))||bDoituong_BHYT(int.Parse(dr[i]["madoituongvao"].ToString()))) && _maql.ToString().IndexOf(dr[i]["maql"].ToString()+",")==-1) _maql+=dr[i]["maql"].ToString()+",";
				//if ((dr[i]["madoituong"].ToString()=="1" || dr[i]["madoituongvao"].ToString()=="1") && _maql.ToString().IndexOf(dr[i]["maql"].ToString()+",")==-1) _maql+=dr[i]["maql"].ToString()+",";				
			}
			DataTable dtbhyt=new DataTable();
			DataTable dtkpm=new DataTable();
			dtkpm=get_data("select * from btdkp_bv").Tables[0];
			bool bBhyt=false,b701424=Mabv_so==701424,bchenhlech_giavp=bChenhlech_giavp,bCont,bchenhlech_tructiep=bChenhlech_tructiep,bchenhlech_traituyen=bChenhlech_traituyen;
			if (_maql!="")
			{
				sql="select a.maql,a.sothe,to_char(a.tungay,'dd/mm/yyyy') as tungay,nvl(to_char(a.ngaygiahan,'dd/mm/yyyy'),to_char(a.denngay,'dd/mm/yyyy')) as denngay,";
				sql+="to_char(a.tungay,'yyyymmdd') as tu,to_char(a.denngay,'yyyymmdd') as den,";
				sql+="to_char(a.ngay1,'dd/mm/yyyy') as ngay1,to_char(a.ngay2,'dd/mm/yyyy') as ngay2,to_char(a.ngay3,'dd/mm/yyyy') as ngay3,b.tenbv||'^'||a.mabv||'^'||c.ten as tenbv ";
				sql+=" ,to_char(a.ngaytrinh,'dd/mm/yyyy') as ngaytrinh, to_char(a.ngayduyet,'dd/mm/yyyy') as ngayduyet, to_char(a.ngaygiahan,'dd/mm/yyyy') as ngaygiahan ";
				sql+=" from bhyt a,dmnoicapbhyt b, dmnoicap c where a.mabv=b.mabv(+) and a.manoicap=c.id(+) and a.maql in ("+_maql.Substring(0,_maql.Length-1)+")";
				sql+=" order by a.tungay,a.denngay";
				dtbhyt=get_data(sql).Tables[0];
				bBhyt=true;
			}
			bool bgia_bh_quydinh_giamua = bGia_bh_quydinh_giamua;
			string chenhlech="";
			DataTable dtdt=get_data("select * from doituong").Tables[0];
			foreach(DataRow r in dtdt.Select("chenhlech=1")) chenhlech+=r["madoituong"].ToString().Trim()+",";
			bool bRavien_hc=bRavien_hcbd,bHaophi_vp=bHaophi_vienphi;			
			if (bHaophi_thanhtoan)
			{
				r1=getrowbyid(dtdt,"madoituong="+iHaophi);
				if (r1==null)
				{
					r2=dtdt.NewRow();
					r2["madoituong"]=iHaophi;
					r2["doituong"]="Hao phí";
					r2["sothe"]=0;
					r2["ngay"]=0;
					r2["mabv"]=0;
					r2["mien"]=1;
					r2["field_gia"]="gia_th";
					r2["trasau"]=0;
					r2["cholam"]=0;
					dtdt.Rows.Add(r2);
				}
			}
			
			string s_doituong="Thu phí",s_mabn="",s_idvienphi="",tmp_idvienphi="";
			string s_madt="",s_dtuong="",s_ten="",s_tenkp="",s_denngay="",s_tungay="",s_dkkcb="",s_sothe="",str;
			decimal dg1,dg2,dongia,tamung=0,sotien=0,bhyt=0,mien=0,st1,st2,giamua=0,dg1k,dg2k,st1k,st2k,st;
			
			string ngayserver=ngayhienhanh_server,s_mmyy=mmyy(ngayserver),f1,f2,mmyy_server=s_mmyy,ngay1="",ngay2="",ngay3="",ngayvao="",xxx;
			if (!bMmyy(s_mmyy))
			{
				LibDuoc.AccessData d=new LibDuoc.AccessData();
				d.tao_user_mmyy(s_mmyy,0);
			}
			upd_capsotoa(mmyy_server,loaiba,ngayserver,0,0);
			long idkhoa=0,maql=0,idvienphi=0,maql_phongluu=0,mavaovien=0;
			b_sobienlaitamung="";
			bool bChenhlechdv=bChenhlech,bCapve=bCapve_noitru||bCapve_Phongluu,bNgtr=false,bNgtr_ntr=bBHYTngtr_noitru,bndot=bThanhtoanndot || loaiba==2,bKhu=bThanhtoan_khu,bDenngay,bTungay,bChenhlech_dt=bChenhlech_doituong,bTtngay=(bTheongay)?true:bThanhtoan_ngay;
			int i_madoituongvao=0,i_tunguyen=iTunguyen,i_madt=0,i_haophi=iHaophi,maphu=0,nhom=nhom_duoc,kythuat=-1,noitiepdon=1;
			decimal iBhyt=0;
			r1=getrowbyid(dtdt,"madoituong="+i_tunguyen);
			if (r1!=null) s_doituong=r1["doituong"].ToString();
			long maql_save=0,maql_pk=0;
			decimal mucbhquidinh=muc_bhquidinh,muckhongqua=ck2_ca3_26,stc=0;
			int phantrambhyt=100;//phantram_bhyt;
			bool nhom1,nhom2;
			string huong100=huong_100+"+"+cc1_te1, huong100kqua=huong_100_khongqua+"+"+ck2_ca3,huong95kqua=bt4_hn4_ht5;
			bool bgia_bh_quydinh=bGia_bh_quydinh;
			decimal giaban;
			//
			decimal d_sotien_ktcao=0, d_sotien_ktcao_dinhmuc=ck2_ca3_26;
			bool bFound_ktcao_vuot=false, bCLktcao=false;
			//
			int iNhomTA=iNhomvptienan;decimal d_hotroTA=dTienAn;
			int temp=0;
			ii_madoituong=0;
			int iTA=0;
			for(int i=0;i<dr.Length;i++)
			{
				iTA++;
				if(ii_madoituong==int.Parse(dr[i]["madoituong"].ToString())) bPhongluu=true;
				else bPhongluu=false;
				//
				if(dr[i]["done"].ToString()=="0"){m_madoituong_inttrv=(dr[i]["chon"].ToString().ToLower()=="true")?","+dr[i]["madoituong"].ToString()+",":",0,";}//binh 070611: && 
				i_tunguyen=iTunguyen_doituong_(int.Parse(dr[i]["madoituong"].ToString()));// ma doi tuong tu nguyen theo tung doi tuong vao
				//
				tamung=0;
				//ThanhCuong-08062011_xử lý ngày vào của bệnh nhân có 2 thẻ bhyt thì ngày vào của thẻ thứ 2 > ngày ra của thẻ thứ 1 và bắt đầu từ 00:00
				ngayvao=dr[i]["ngayvao"].ToString();
				if(temp>0 && int.Parse(dr[i]["madoituong"].ToString())==1) 
				{
					ngayvao=ngayvao.Substring(0,10)+" 00:00";
				}
				temp=temp+1;
				//
				s_denngay=dr[i]["denngay"].ToString();s_tungay=dr[i]["tungay"].ToString();s_sothe=dr[i]["sothe"].ToString();
				s_dkkcb=dr[i]["noicap"].ToString();
				d_sotien_ktcao=0;bFound_ktcao_vuot=false;
				if (dr[i]["denngay"].ToString().Length>20)
				{
					string tmp_dn=s_denngay;
					s_denngay=dr[i]["denngay"].ToString();
					s_denngay=s_denngay.Substring(s_denngay.IndexOf("^")+2,10);
					s_tungay=dr[i]["denngay"].ToString().Substring(0,10);
					//
					string []a_ngaybhyt=tmp_dn.Split('^');
					for(int ij=2;ij<a_ngaybhyt.Length;ij++)
					{
						s_tungay+="^"+a_ngaybhyt[ij].Trim();//tungay^ngaytrinh^ngayduyet^ngayggiahan
					}
					
					//
				}
				r1=getrowbyid(dtkp,"makp='"+dr[i]["makp"].ToString()+"'");				
				i_madoituongvao=int.Parse(dr[i]["madoituongvao"].ToString());
				if (bndot || dr[i]["motkhu"].ToString()=="0") idkhoa=long.Parse(dr[i]["idkhoa"].ToString());
				maql=long.Parse(dr[i]["maql"].ToString());
				mavaovien=0;
				if (bCapve)
				{
					foreach(DataRow row in get_data("select matiepdon from sukien where matiepdon>0 and macap="+maql+" order by noitiepdon").Tables[0].Rows)
					{
						mavaovien=long.Parse(row["matiepdon"].ToString());
						break;
					}
					
				}				
				if (bNgtr_ntr && loaiba!=3)
				{	
					if (bMmyy(ngayvao))
					{	
						xxx=user+mmyy(ngayvao);
						noitiepdon=(loaiba==1)?Nhanbenh:(loaiba==2)?Ngoaitru:Phongluu;
						str="select a.mavaovien from "+xxx+".benhandt a,"+xxx+".xutrikbct b where a.maql=b.maql and a.mabn='"+dr[i]["mabn"].ToString()+"' and to_char(a.ngay,'dd/mm/yyyy')='"+ngayvao.Substring(0,10)+"'";
						if (loaiba==1)str+=" and b.xutri like '%05%'";
						else if (loaiba==2) str+=" and b.xutri like '%02%'";
						else str+=" and b.xutri like '%04%'";
						foreach(DataRow row in get_data(str).Tables[0].Rows)
							maql_pk=long.Parse(row["mavaovien"].ToString());						
						if (maql_pk!=0) bNgtr=get_data("select * from sukien where macap="+maql+" and noitiepdon="+noitiepdon+" and matiepdon="+maql_pk).Tables[0].Rows.Count>0;
					}
				}
				if (maql!=maql_save)
				{
					tamung=0;sotien=0;bhyt=0;mien=0;tc_tamung=0;
					maql_save=maql;b_sobienlaitamung="";b_tatca_sobienlaitamung="";
				}
				if (bVienphi_phongluu && loaiba!=4)
				{		
					
					//binh
					maql_phongluu=get_maql_phongluu(maql);					
					//
					if (maql_phongluu!=0)
					{
						foreach(DataRow row in get_data("select to_char(ngay,'dd/mm/yyyy hh24:mi') as ngayvao from benhandt where maql in ("+maql_phongluu+") and loaiba=4").Tables[0].Rows)
						{
							ngayvao=row["ngayvao"].ToString();
							break;
						}
					}
				}
				else maql_phongluu=0;				
				if (maql_phongluu==maql) maql_phongluu=0;
				if (dr[i]["done"].ToString()=="0" && int.Parse(dr[i]["madoituong"].ToString())!=i_haophi)
				{
					s_idvienphi=get_id_thvp((int.Parse(dr[i]["motkhu"].ToString())==1)?0:int.Parse(dr[i]["khu"].ToString()),dr[i]["mabn"].ToString(),maql,idkhoa,dr[i]["ngayvao"].ToString(),dr[i]["ngayra"].ToString(),ngayserver,bTheongay);
					if (s_idvienphi!="")
					{
						s_mmyy=s_idvienphi.Substring(0,4);
						idvienphi=long.Parse(s_idvienphi.Substring(4));
						if (s_mabn!=dr[i]["mabn"].ToString())
						{
							s_mabn=dr[i]["mabn"].ToString();
							tmp_idvienphi=idvienphi.ToString()+",";
							//if (!bTheongay) 
							execute_data("delete from "+user+s_mmyy+".v_thvpct where done=0 and id="+idvienphi);
						}
						else if (tmp_idvienphi !="" && tmp_idvienphi.IndexOf(idvienphi.ToString()+",")<0)
						{
							tmp_idvienphi+=idvienphi.ToString()+",";
							//if (!bTheongay) 
							execute_data("delete from "+user+s_mmyy+".v_thvpct where done=0 and id="+idvienphi);
						}
						//
					}
					else 
					{
						s_mmyy=mmyy_server;
						s_mabn=dr[i]["mabn"].ToString();
						idvienphi=get_id_thvp();
						tmp_idvienphi+=idvienphi.ToString()+",";
					}
				}
				tamung+=get_tamung_ct((int.Parse(dr[i]["motkhu"].ToString())==1)?0:int.Parse(dr[i]["khu"].ToString()),dr[i]["mabn"].ToString(),maql,idkhoa,dr[i]["ngayvao"].ToString(),dr[i]["ngayra"].ToString(),(makp=="")?"":dr[i]["makp"].ToString(),int.Parse(dr[i]["madoituong"].ToString()),int.Parse(dr[i]["done"].ToString()),maql_phongluu,loaiba,dr[i]["maso"].ToString(),bTheongay,ngayvaovien);			
				bKhongchiphi=tamung>0;
				if (tamung==0 && b701424 && b_sobienlaitamung.IndexOf("Hoàn trả")==-1) tamung+=get_tamung_ct_424((int.Parse(dr[i]["motkhu"].ToString())==1)?0:int.Parse(dr[i]["khu"].ToString()),dr[i]["mabn"].ToString(),maql,idkhoa,dr[i]["ngayvao"].ToString(),dr[i]["ngayra"].ToString(),(makp=="")?"":dr[i]["makp"].ToString(),int.Parse(dr[i]["madoituong"].ToString()),int.Parse(dr[i]["done"].ToString()),maql_phongluu,loaiba,dr[i]["maso"].ToString());
				tc_tamung+=tamung;
				if(b_tatca_sobienlaitamung.IndexOf(b_sobienlaitamung)<0) b_tatca_sobienlaitamung+=b_sobienlaitamung;
				
				if (dr[i]["done"].ToString()=="0"  && ((bHaophi_vienphi==false && int.Parse(dr[i]["madoituong"].ToString())!=i_haophi)||bHaophi_vienphi==true) )//&& int.Parse(dr[i]["madoituong"].ToString())!=i_haophi)
				{
					if (bDoituong_BHYT(dr[i]["madoituong"].ToString())) //if (dr[i]["madoituong"].ToString()=="1") //bhyt
					{
						if (dr[i]["maphu"].ToString()=="0") // Ko cung chi tra
						{
							bhyt=sotien;sotien=0;
						}
						else sotien=sotien-bhyt;
					}
					else if (mien_doituong(int.Parse(dr[i]["madoituong"].ToString()),dtdt)) //mien
					{
						mien=sotien;sotien=0;bhyt=0;
					}
					else bhyt=0;
					if (sotien+mien+bhyt+tamung!=0) 
					{
						if(mavaovien==0){mavaovien=get_mavaovien(maql);}
						if(mavaovien==0){mavaovien=get_mavaovien(maql,s_mmyy);}
						upd_thvpll(s_mmyy,idvienphi,dr[i]["mabn"].ToString(),maql,idkhoa,dr[i]["ngayvao"].ToString(),dr[i]["ngayra"].ToString(),dr[i]["giuong"].ToString(),dr[i]["makp"].ToString(),dr[i]["chandoan"].ToString(),dr[i]["maicd"].ToString(),sotien,tamung,bhyt,mien,int.Parse(dr[i]["khu"].ToString()));
						execute_data("update "+user+s_mmyy+".v_thvpll set mavaovien="+mavaovien+" where mabn='"+dr[i]["mabn"].ToString()+"' and id="+idvienphi);
					}
					if (mien+bhyt!=0 && s_sothe!="" && s_sothe.Length<=20) {upd_thvpbhyt(s_mmyy,idvienphi,s_sothe,int.Parse(dr[i]["maphu"].ToString()),get_manoigioithieu(maql),get_manoicap(maql),int.Parse(dr[i]["traituyen"].ToString()));}//dr[i]["sothe"].ToString().Trim()
					//if (s_sothe!="" && dr[i]["madoituong"].ToString()=="1") upd_thvpbhyt(s_mmyy,idvienphi,s_sothe,int.Parse(dr[i]["maphu"].ToString()),get_manoigioithieu(maql),get_manoicap(maql));//dr[i]["sothe"].ToString().Trim()
				}
				//thuoc
				DataTable dttmp=new DataTable();
				dttmp=get_thuoc_ct((int.Parse(dr[i]["motkhu"].ToString())==1)?0:int.Parse(dr[i]["khu"].ToString()),dr[i]["mabn"].ToString(),maql,idkhoa,dr[i]["ngayvao"].ToString(),dr[i]["ngayra"].ToString(),(makp=="" || r1==null)?0:int.Parse(r1["id"].ToString()),int.Parse(dr[i]["madoituong"].ToString()),int.Parse(dr[i]["done"].ToString()),maql_phongluu,bChenhlechdv,bCapve,bNgtr,loaiba,dr[i]["makp"].ToString(),mavaovien,dr[i]["maso"].ToString(),bTheongay,bThanhtoanndot,bTTRV_theokhoa,ngayvaovien);
				//
				//gam 23/02/2012
				#region Vienphi
				//dttmp.DataSet.WriteXml("thuocxml.xml",XmlWriteMode.WriteSchema);
				tmp=get_vienphi_ct((int.Parse(dr[i]["motkhu"].ToString())==1)?0:int.Parse(dr[i]["khu"].ToString()),dr[i]["mabn"].ToString(),maql,idkhoa,dr[i]["ngayvao"].ToString(),dr[i]["ngayra"].ToString(),(makp=="")?"":dr[i]["makp"].ToString(),int.Parse(dr[i]["madoituong"].ToString()),int.Parse(dr[i]["done"].ToString()),maql_phongluu,bCapve,bNgtr,loaiba,makp_rv,mavaovien,dr[i]["maso"].ToString(),bTheongay,bThanhtoanndot,bTTRV_theokhoa,ngayvaovien);
				//tmp.DataSet.WriteXml("vienphi.xml",XmlWriteMode.WriteSchema);
				DataSet dsTA=new DataSet();
				string sThehongheo_cn="";
				try
				{
					sThehongheo_cn=s_sothe.Substring(0,2).ToString();
				}
				catch{}
				if(decimal.Parse(tNgaydt.ToString())>0 && d_hotroTA>0 && iTA==1 && (sThehongheo_cn=="CN" || sThehongheo_cn=="HN"))
				{
					try
					{
						string sStrTA="select 0 idttrv,to_char(sysdate,'yymmdd') yymmdd,to_char(sysdate,'dd/mm/yyyy') ngay,'"+dr[i]["makp"].ToString()+"' makp,a.id mavp,a.gia_th as dongia,"+
							tNgaydt+" soluong,a.gia_th*"+tNgaydt+" sotien,0 bhytt0107,a.gia_th*"+tNgaydt+" bhyt,0 vattu, a.id_loai , 0 giachenhlech, 1 dachenhlech, 0 cuocmothu2,0 id "+
							"from "+userid+".v_giavp a where id_loai in(select id id_loai from v_loaivp where id_nhom="+iNhomvptienan+") and gia_th>0 and hide=0";
						dsTA=get_data(sStrTA);
						if(dsTA.Tables[0].Rows.Count>0)
						{
							dsTA.Merge(tmp);
							dsTA.AcceptChanges();
						}
					}
					catch{}
				}
				try
				{
					if(dsTA.Tables[0].Rows.Count>0)
					{
						tmp.Clear();
						tmp=dsTA.Tables[0].Copy();
					}
				}
				catch{}
				if (tmp!=null)
				{
					//					tmp.DataSet.WriteXml("vienphixml.xml",XmlWriteMode.WriteSchema);
					foreach(DataRow r in tmp.Select("true","yymmdd"))
					{
						bKhongchiphi=false;
						DataRow rkp=getrowbyid(dtkpm,"makp='"+r["makp"].ToString()+"'");
						//if(rkp!=null)s_tenkp=rkp["ten"].ToString();
						if(rkp!=null)s_tenkp=rkp["tenkp"].ToString();//Thuy 22.02.2012
						else s_tenkp=dr[i]["tenkp"].ToString();
						r2=getrowbyid(dtvp,"id="+int.Parse(r["mavp"].ToString()));
						maphu=0;nhom1=nhom2=false;
						if (r2!=null)
						{
							iBhyt=int.Parse(r2["bhyt"].ToString());
							ngay1=dr[i]["ngay1"].ToString().Trim();
							ngay2=dr[i]["ngay2"].ToString().Trim();
							ngay3=dr[i]["ngay3"].ToString().Trim();
							if (bBhyt)
							{
								r3=dtbhyt.Select("maql="+maql+" and den>="+r["ngay"].ToString().Substring(6,4)+r["ngay"].ToString().Substring(3,2)+r["ngay"].ToString().Substring(0,2),"den");
								if (r3.Length>0)
								{
									s_tungay=r3[0]["tungay"].ToString();
									s_denngay=r3[0]["denngay"].ToString();
									s_sothe=r3[0]["sothe"].ToString();
									s_dkkcb=r3[0]["tenbv"].ToString();
									ngay1=r3[0]["ngay1"].ToString().Trim();
									ngay2=r3[0]["ngay2"].ToString().Trim();
									ngay3=r3[0]["ngay3"].ToString().Trim();
									s_ngaytrinh=r3[0]["ngaytrinh"].ToString();
									s_ngayduyet=r3[0]["ngayduyet"].ToString();
									s_ngaygiahan=r3[0]["ngaygiahan"].ToString();
									s_tungay+="^"+s_ngaytrinh+"^"+s_ngayduyet+"^"+s_ngaygiahan;
								}
							}
							s_madt=dr[i]["madoituong"].ToString();
							i_madt=int.Parse(s_madt);
							s_dtuong=dr[i]["doituong"].ToString();
							kythuat=int.Parse(r2["kythuat"].ToString());
							if (kythuat!=-1 && bDoituong_BHYT(i_madt,dtdt) && bSothengayhuong)//if (kythuat!=-1 && i_madt==1)
							{
								maphu=(dr[i]["sothe"].ToString().Trim()!="")?get_maphu_noitru(dr[i]["sothe"].ToString(),nhom,dr[i]["ngayra"].ToString().Substring(0,10)):0;
								//if (maphu!=0)
								//{									
								if (ngay1+ngay2+ngay3!="")
								{
									if ((!bNgay(r["ngay"].ToString(),ngay1) && kythuat==0) ||
										(!bNgay(r["ngay"].ToString(),ngay2) && kythuat==1) ||
										(!bNgay(r["ngay"].ToString(),ngay3) && kythuat==2))
									{
										i_madt=i_tunguyen;
										s_madt=i_madt.ToString();
										r1=getrowbyid(dtdt,"madoituong="+i_madt);
										if (r1!=null) s_dtuong=r1["doituong"].ToString();
										//											kythuat=-1;
									}										
								}
								//									else kythuat=-1;
								//}
							}
							s_ten=r2["ten"].ToString();
							if(r["cuocmothu2"].ToString()=="1") s_ten+=" [mổ thứ 2 hưởng 50%]";
							if (decimal.Parse(r["sotien"].ToString())-decimal.Parse(r["vattu"].ToString())>0 && decimal.Parse(r["vattu"].ToString())>0)
							{
								stc=decimal.Parse(r["sotien"].ToString())-decimal.Parse(r["vattu"].ToString());
								s_ten+="[Tiền công: "+stc.ToString().Trim()+",Tiền vật tư: "+r["vattu"].ToString().Trim()+"]";
							}
							f1="th";f2="th";
							//
							dongia=decimal.Parse(r["dongia"].ToString());
							dg1=dongia;dg2=0;st2=0;st1=decimal.Parse(r["sotien"].ToString());
							sql=(bChenhlech_dt)?"madoituong="+i_madoituongvao:"madoituong="+i_madt;
							r1=getrowbyid(dtdt,sql);
							if (r1!=null) f1=r1["field_gia"].ToString().Trim().Substring(r1["field_gia"].ToString().Trim().IndexOf("_")+1);
							sql=(bChenhlech_dt)?"madoituong="+i_madt:"madoituong="+i_tunguyen;
							r1=getrowbyid(dtdt,sql);
							if (r1!=null) f2=r1["field_gia"].ToString().Trim().Substring(r1["field_gia"].ToString().Trim().IndexOf("_")+1);
							bDenngay=true;bTungay=true;
							if (s_denngay.Trim().Length==10) bDenngay=bNgay(s_denngay,r["ngay"].ToString().Substring(0,10));
							if (s_tungay.Trim().Length==10) bTungay=bNgay(r["ngay"].ToString().Substring(0,10),s_tungay);

							#region chenhlech
							bCont=bChenhlechdv;//bCont=(bchenhlech_tructiep)?false:bChenhlechdv;//do them field v_chidinh.dachenhlech -- nen bo dieu kien nay
							
							if (bchenhlech_giavp) bCont=bCont && r2["chenhlech"].ToString()=="1";
							bCont=bCont && chenhlech.IndexOf(i_madoituongvao.ToString().Trim()+",")!=-1 
								&& decimal.Parse(r2["bhyt"].ToString())>0 
								&& decimal.Parse(r2["gia_"+f1.Trim()].ToString())<=decimal.Parse(r2["gia_"+f2.Trim()].ToString())
								&& bTungay && bDenngay;
							if (bchenhlech_traituyen && int.Parse(dr[i]["traituyen"].ToString())==0) bCont=false;
							bCont=bCont && r["dachenhlech"].ToString()=="0";
							//ds.WriteXml("thuocxml.xml",XmlWriteMode.WriteSchema);
							if (bCont && (loaiba==1 || loaiba==4))
							{
								if (bChenhlech_dt || (r["dachenhlech"].ToString()=="0" && r2["chenhlech"].ToString()=="1"))
								{
									if (s_madt==i_tunguyen.ToString().Trim() || bDoituong_co_chenhlech(s_madt))  
									{
										i_madt=i_madoituongvao;
										r1=getrowbyid(dtdt,"madoituong="+i_madt);
										if (r1!=null) {s_dtuong=r1["doituong"].ToString();f1=r1["field_gia"].ToString().Replace("gia_","");}
										dg1=decimal.Parse(r2["gia_"+f1.Trim()].ToString())+decimal.Parse(r2["vattu_"+f1.Trim()].ToString());
										st1=decimal.Parse(r["soluong"].ToString())*dg1;
									}
									else if (bDoituong_BHYT(int.Parse(s_madt),dtdt) && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))//else if (s_madt=="1" && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))
									{
										s_ten+=" BHYT thanh toán "+r2["bhyt"].ToString().Trim()+" %";
										dg1=dongia*decimal.Parse(r2["bhyt"].ToString())/100;
										st1=decimal.Parse(r["bhyt"].ToString());
									}
								}
								else
								{
									if (f1!=f2)
									{
										i_madt=i_madoituongvao;
										r1=getrowbyid(dtdt,"madoituong="+i_madt);
										if (r1!=null) s_dtuong=r1["doituong"].ToString();
										dg1=decimal.Parse(r2["gia_"+f1.Trim()].ToString())+decimal.Parse(r2["vattu_"+f1.Trim()].ToString());
										st1=decimal.Parse(r["soluong"].ToString())*dg1;
									}
									else if (bDoituong_BHYT(int.Parse(s_madt),dtdt) && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))//else if (s_madt=="1" && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))
									{
										s_ten+=" BHYT thanh toán "+r2["bhyt"].ToString().Trim()+" %";
										dg1=dongia*decimal.Parse(r2["bhyt"].ToString())/100;
										st1=decimal.Parse(r["bhyt"].ToString());
									}				
								}
							}
							else if (bDoituong_BHYT(int.Parse(s_madt),dtdt) && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))//else if (s_madt=="1" && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))
							{
								s_ten+=" BHYT thanh toán "+r2["bhyt"].ToString().Trim()+" %";
								dg1=dongia*decimal.Parse(r2["bhyt"].ToString())/100;
								st1=decimal.Parse(r["bhyt"].ToString());
							}				
							#endregion

							#region muc dich vu ky thuat cao
							dg1k=dg2k=st1k=st2k=0;
							int vuottran=0;
							if (kythuat!=-1 && bDoituong_BHYT(i_madt,dtdt) && st1>mucbhquidinh)//if (kythuat!=-1 && i_madt==1 && st1>mucbhquidinh)//bbbb
							{
								decimal i_tt_ktcao=0;
								string s_tenktcao_chung="";
								bool bgoi=false;
								int i_sttnhom_ktc=int.Parse(r2["sttnhom"].ToString());
								string s_nhom_ktc=r2["nhom"].ToString();
								string s_makp_ktc=r["makp"].ToString()+ ((bTtngay) ? " : " + r["ngay"].ToString() : "");
								string s_tenkp_ktc=s_tenkp.Trim()+ ((bTtngay) ? " : " + r["ngay"].ToString() : "");
								#region thanhcuong tính ky thuat cao theo công thức của BV Nghệ An 01/11/2011
								if(bktCao_ttDV)
								{
									//s_tenktcao_chung="Tổng chi phí của dịch vụ kỹ thuật cao: "+s_ten;
									s_tenktcao_chung=s_ten;
									i_tt_ktcao+=decimal.Parse(r["sotien"].ToString());
									
									if(dttmp.Rows.Count>0)
									{
										int s=1;
										foreach(DataRow rr3 in dttmp.Rows)
										{
											if(r["id"].ToString()==rr3["id_ktcao"].ToString())
											{
												bgoi=true;
												if(s==1)
												{
													if(m_madoituong_inttrv=="" || m_madoituong_inttrv.IndexOf(","+dr[i]["madoituong"].ToString()+",")>=0)
													{
														updrec_ravien(ds,int.Parse(dr[i]["khu"].ToString()),dr[i]["mabn"].ToString(),dr[i]["mabn"].ToString(),long.Parse(dr[i]["maql"].ToString()),long.Parse(dr[i]["idkhoa"].ToString()),dr[i]["hoten"].ToString(),dr[i]["namsinh"].ToString(),dr[i]["phai"].ToString(),
															dr[i]["diachi"].ToString(),i_madt,s_dtuong,s_sothe,iBhyt,s_tungay,s_denngay,dr[i]["noigioithieu"].ToString(),s_dkkcb,
															dr[i]["giuong"].ToString(),r["makp"].ToString()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),s_tenkp.Trim()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),ngayvao,dr[i]["ngayra"].ToString(),dr[i]["chandoan"].ToString(),dr[i]["maicd"].ToString(),int.Parse(r2["sttnhom"].ToString()),
															r2["nhom"].ToString(),int.Parse(r2["sttloai"].ToString()),r2["loai"].ToString(),int.Parse(r["mavp"].ToString()),
															s_ten,r2["dvt"].ToString(),decimal.Parse(r["soluong"].ToString()),
															0,
															decimal.Parse(r["bhyt"].ToString()),tamung,decimal.Parse(r["bhytt0107"].ToString()),dr[i]["nguoinha"].ToString(),int.Parse(dr[i]["hinhthuc"].ToString()),int.Parse(dr[i]["phuongphap"].ToString()),int.Parse(dr[i]["ketqua"].ToString()),dr[i]["soluutru"].ToString(),
															dg1,dr[i]["ngaypt"].ToString(),dr[i]["tenpt"].ToString(),loaiba,int.Parse(dr[i]["done"].ToString()),dr[i]["mabs"].ToString(),dr[i]["tenbs"].ToString(),dr[i]["tenuser"].ToString(),dr[i]["image"].ToString(),dr[i]["ghichu"].ToString(),ngay1,ngay2,ngay3,(bTtngay)?r["ngay"].ToString():"",kythuat,b_sobienlaitamung,(r["idttrv"].ToString()!="")?long.Parse(r["idttrv"].ToString()):0,"","",int.Parse(dr[i]["traituyen"].ToString()),0,0,(bCLktcao||ngia)?dg2k:0,decimal.Parse(r["id"].ToString()),0,vuottran,dr[i]["ngayvv"].ToString(),dr[i]["ngayrv"].ToString());
													}
													if (dr[i]["done"].ToString()=="0" && (int.Parse(dr[i]["madoituong"].ToString())!=i_haophi || (int.Parse(dr[i]["madoituong"].ToString())==i_haophi && bHaophi_vp)))
													{
														upd_thvpct(s_mmyy,idvienphi,r["ngay"].ToString(),r["makp"].ToString(),i_madt,long.Parse(r["mavp"].ToString()),decimal.Parse(r["soluong"].ToString()),dg1,0,0,s_sothe,decimal.Parse(r["id"].ToString()));
														execute_data(" update "+user+s_mmyy+".v_thvpct set ktcao=1 where id="+idvienphi+" and mavp="+long.Parse(r["mavp"].ToString())+" and makp='"+r["makp"].ToString()+"' and to_char(ngay,'dd/mm/yyyy')='"+r["ngay"].ToString()+"' and madoituong="+i_madt+" and dongia="+dg1);
													}
													s=2;
												}
												DataRow rr2;
												bKhongchiphi=false;
												if(s_mabd.IndexOf(rr3["mabd"].ToString()+",")<0)s_mabd+=rr3["mabd"].ToString()+",";
												rr2=getrowbyid(dtbd,"id="+int.Parse(rr3["mabd"].ToString()));
												if (rr2!=null)
												{
													ngay1=dr[i]["ngay1"].ToString().Trim();
													ngay2=dr[i]["ngay2"].ToString().Trim();
													ngay3=dr[i]["ngay3"].ToString().Trim();
													if (bBhyt)
													{
														r3=dtbhyt.Select("maql="+maql+" and den>="+rr3["ngay"].ToString().Substring(6,4)+rr3["ngay"].ToString().Substring(3,2)+rr3["ngay"].ToString().Substring(0,2),"den");
														if (r3.Length>0)
														{
															s_tungay=r3[0]["tungay"].ToString();
															s_denngay=r3[0]["denngay"].ToString();
															s_sothe=r3[0]["sothe"].ToString();
															s_dkkcb=r3[0]["tenbv"].ToString();
															ngay1=r3[0]["ngay1"].ToString().Trim();
															ngay2=r3[0]["ngay2"].ToString().Trim();
															ngay3=r3[0]["ngay3"].ToString().Trim();
															s_ngaytrinh=r3[0]["ngaytrinh"].ToString();
															s_ngayduyet=r3[0]["ngayduyet"].ToString();
															s_ngaygiahan=r3[0]["ngaygiahan"].ToString();
															s_tungay+="^"+s_ngaytrinh+"^"+s_ngayduyet+"^"+s_ngaygiahan;
														}
													}
													DataRow rrkp=getrowbyid(dtkpm,"makp='"+rr3["makp"].ToString()+"'");
													if(rrkp!=null)s_tenkp=rrkp["tenkp"].ToString();
													else s_tenkp=dr[i]["tenkp"].ToString();
													s_madt=dr[i]["madoituong"].ToString().Trim();
													iBhyt=(s_madt=="1")?get_bhyt(dtbdfull,long.Parse(rr3["mabd"].ToString()),rr3["ngay"].ToString()):0;
													i_madt=int.Parse(s_madt);
													s_dtuong=dr[i]["doituong"].ToString();
													//													kythuat=int.Parse(rr3["kythuat"].ToString());//kythuat=int.Parse(r2["kythuat"].ToString());
													//
													if (bSothengayhuong && kythuat!=-1 && bDoituong_BHYT(i_madt,dtdt))//if (kythuat==1 && i_madt==1)
													{
														bool bChuaduochuong=false;
														if(ngay1=="" && kythuat==0) bChuaduochuong=true;
														else if(ngay2=="" && kythuat==1) bChuaduochuong=true;
														else if (ngay3=="" && kythuat==2) bChuaduochuong=true;
														if (bChuaduochuong || (kythuat==2 && ngay3!="" && !bNgay(rr3["ngay"].ToString(),ngay3))||(kythuat==0 && ngay1!="" && !bNgay(rr3["ngay"].ToString(),ngay1) )||(kythuat==1 && ngay2!="" && !bNgay(rr3["ngay"].ToString(),ngay2)))
														{										
															i_madt=i_tunguyen;
															s_madt=i_madt.ToString();
															r1=getrowbyid(dtdt,"madoituong="+i_madt);
															if (r1!=null) s_dtuong=r1["doituong"].ToString();
														}
														//}
													}
																	
													//
													if (bRavien_hc)
													{
														if (rr2["tenhc"].ToString()!="") s_ten=rr2["tenhc"].ToString().Trim()+"["+rr2["tenbd"].ToString().Trim()+"]";
														else s_ten=rr2["tenbd"].ToString();
													}
													else s_ten=rr2["ten"].ToString();
													dongia=decimal.Parse(rr3["dongia"].ToString());
													dg1=dongia;dg2=0;st2=0;st1=decimal.Parse(rr3["sotien"].ToString());
													bDenngay=true;bTungay=true;
													giamua=decimal.Parse(rr3["giamua"].ToString());//
													//
													i_tt_ktcao+=decimal.Parse(rr3["sotien"].ToString());
													//
													if(giamua==0)giamua=dongia;
													if (s_denngay.Trim().Length==10) bDenngay=bNgay(s_denngay,rr3["ngay"].ToString().Substring(0,10));
													if (s_tungay.Trim().Length==10) bTungay=bNgay(rr3["ngay"].ToString().Substring(0,10),s_tungay);
													bCont=(bTungay && bDenngay && bChenhlechdv  
														&& chenhlech.IndexOf(i_madoituongvao.ToString().Trim()+",")!=-1 
														&& chenhlech.IndexOf(s_madt.ToString().Trim()+",")!=-1 //BBBB
														&& decimal.Parse(rr2["bhyt"].ToString())>0); 
													//&& r["loai"].ToString().Trim()=="1");// chi tinh chenh lech thuoc khi khai bao doi tuong tinh theo gia ban: bbbb - bo ra
													if (bChenhlech_dt) bCont=bCont && s_madt==i_tunguyen.ToString().Trim();
													bCont=bCont && bTienthuoc_tinhchenhlech;
													giaban=decimal.Parse(rr3["giaban"].ToString());
													if (bCont && bgia_bh_quydinh)
													{
														if(bGia_bh_quydinh_giamua) giaban=dongia;//giamua;
														r1=getrowbyid(dtbdfull,"id="+long.Parse(rr3["mabd"].ToString()));
														if (r1!=null)
														{
															if (decimal.Parse(r1["gia_bh"].ToString())>0)
															{											
																giamua=Math.Min(giamua,decimal.Parse(r1["gia_bh"].ToString()));											
															}
														}
													}								
													bCont=bCont && Math.Round(giaban,2)-Math.Round(giamua,2)>1;///Math.Round(giaban,2)!=Math.Round(giamua,2);
													if (bchenhlech_traituyen && int.Parse(dr[i]["traituyen"].ToString())==0) bCont=false;
																		
													if (bCont)
													{
														i_madt=i_madoituongvao;
														r1=getrowbyid(dtdt,"madoituong="+i_madt);
														if (r1!=null) s_dtuong=r1["doituong"].ToString();
														dg1=giamua;
														st1=decimal.Parse(rr3["soluong"].ToString())*dg1;
													}
													else if (bDoituong_BHYT(int.Parse(s_madt),dtdt) && iBhyt!=0)//else if (s_madt=="1" && iBhyt!=0)// && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))
													{
														if (iBhyt!=100) s_ten+=" BHYT thanh toán "+iBhyt.ToString()+" %";//r2["bhyt"].ToString().Trim()+" %";
														//dg1=dongia*iBhyt/100;
														dg1=dongia;
														st1=decimal.Parse(rr3["soluong"].ToString())*(dongia*iBhyt/100);
														//dg1=dongia;
													}
													
													if(m_madoituong_inttrv=="" || m_madoituong_inttrv.IndexOf(","+dr[i]["madoituong"].ToString()+",")>=0)
													{
														//binh 070611: do khi chon chuyen so lieu vp, nhung khong chon het doi tuong, chi chon 1 dtuong de in (thuong in lai)
														//Khi do SL chuyen xuong vp chi chuyen doi tuong duoc chon --> do do thieu so lieu
														//
														updrec_ravien(ds,int.Parse(dr[i]["khu"].ToString()),dr[i]["mabn"].ToString(),dr[i]["mabn"].ToString(),long.Parse(dr[i]["maql"].ToString()),long.Parse(dr[i]["idkhoa"].ToString()),dr[i]["hoten"].ToString(),dr[i]["namsinh"].ToString(),dr[i]["phai"].ToString(),
															dr[i]["diachi"].ToString(),i_madt,s_dtuong,s_sothe,iBhyt,s_tungay,s_denngay,dr[i]["noigioithieu"].ToString(),s_dkkcb,
															dr[i]["giuong"].ToString(),s_makp_ktc,s_tenkp_ktc,ngayvao,dr[i]["ngayra"].ToString(),dr[i]["chandoan"].ToString(),dr[i]["maicd"].ToString(),i_sttnhom_ktc,//int.Parse(rr2["sttnhom"].ToString()),
															s_nhom_ktc,int.Parse(rr2["sttloai"].ToString()),rr2["loai"].ToString(),int.Parse(rr3["mabd"].ToString()),
															s_ten,rr2["dvt"].ToString(),decimal.Parse(rr3["soluong"].ToString()),
															0,
															0,tamung,decimal.Parse(rr3["bhytt0107"].ToString()),dr[i]["nguoinha"].ToString(),int.Parse(dr[i]["hinhthuc"].ToString()),int.Parse(dr[i]["phuongphap"].ToString()),int.Parse(dr[i]["ketqua"].ToString()),dr[i]["soluutru"].ToString(),
															dg1,dr[i]["ngaypt"].ToString(),dr[i]["tenpt"].ToString(),loaiba,int.Parse(dr[i]["done"].ToString()),dr[i]["mabs"].ToString(),dr[i]["tenbs"].ToString(),dr[i]["tenuser"].ToString(),dr[i]["image"].ToString(),dr[i]["ghichu"].ToString(),ngay1,ngay2,ngay3,(bTtngay)?rr3["ngay"].ToString():"",0,
															b_sobienlaitamung,(rr3["idttrv"].ToString()!="")?long.Parse(rr3["idttrv"].ToString()):0,"","",int.Parse(dr[i]["traituyen"].ToString()),giamua,giaban,(bCLktcao||ngia)?dg2:0,0,(rr3["id_ktcao"].ToString()==null || rr3["id_ktcao"].ToString()=="")? 0:decimal.Parse(rr3["id_ktcao"].ToString()),0,dr[i]["ngayvv"].ToString(),dr[i]["ngayrv"].ToString());
													}
													if (dr[i]["done"].ToString()=="0" && (int.Parse(dr[i]["madoituong"].ToString())!=i_haophi || (int.Parse(dr[i]["madoituong"].ToString())==i_haophi && bHaophi_vp)))
													{
														upd_thvpct(s_mmyy,idvienphi,rr3["ngay"].ToString(),rr3["makp"].ToString(),i_madt,long.Parse(rr3["mabd"].ToString()),decimal.Parse(rr3["soluong"].ToString()),dg1,0,0,s_sothe,decimal.Parse(rr3["id_ktcao"].ToString()));
														execute_data(" update "+user+s_mmyy+".v_thvpct set ktcao=1 where id="+idvienphi+" and mavp="+long.Parse(rr3["mabd"].ToString())+" and id_ktcao="+rr3["id_ktcao"].ToString()+" and makp='"+rr3["makp"].ToString()+"' and to_char(ngay,'dd/mm/yyyy')='"+rr3["ngay"].ToString()+"' and madoituong="+i_madt+" and dongia="+dg1);
													}	
												}
											}
										}

									}
								}
								#endregion
								//								else
								//								{
								#region Tinh KT Cao theo cong van cu
								//: cach tinh theo cong van cu
								st1k=st1;dg1k=dg1;
								if(bktCao_ttDV) 
								{
									st1k=i_tt_ktcao;dg1k=i_tt_ktcao;
								}
								#endregion  Tinh KT Cao theo cong van cu																
								if(bgoi){s_tenktcao_chung="Tổng chi phí của dịch vụ kỹ thuật cao: "+s_ten;}
								i_madt=int.Parse(dr[i]["madoituong"].ToString());
								if(m_madoituong_inttrv=="" || m_madoituong_inttrv.IndexOf(","+dr[i]["madoituong"].ToString()+",")>=0)
								{
									//binh 070611: do khi chon chuyen so lieu vp, nhung khong chon het doi tuong, chi chon 1 dtuong de in (thuong in lai)
									//Khi do SL chuyen xuong vp chi chuyen doi tuong duoc chon --> do do thieu so lieu
									//
									
									if(bktCao_ttDV)
									{
										updrec_ravien(ds,int.Parse(dr[i]["khu"].ToString()),dr[i]["mabn"].ToString(),dr[i]["mabn"].ToString(),long.Parse(dr[i]["maql"].ToString()),long.Parse(dr[i]["idkhoa"].ToString()),dr[i]["hoten"].ToString(),dr[i]["namsinh"].ToString(),dr[i]["phai"].ToString(),
											dr[i]["diachi"].ToString(),i_madt,s_dtuong,s_sothe,iBhyt,s_tungay,s_denngay,dr[i]["noigioithieu"].ToString(),s_dkkcb,
											dr[i]["giuong"].ToString(),s_makp_ktc,s_tenkp_ktc,ngayvao,dr[i]["ngayra"].ToString(),dr[i]["chandoan"].ToString(),dr[i]["maicd"].ToString(),int.Parse(r2["sttnhom"].ToString()),
											r2["nhom"].ToString(),int.Parse(r2["sttloai"].ToString()),r2["loai"].ToString(),int.Parse(r["mavp"].ToString()),
											s_tenktcao_chung,r2["dvt"].ToString(),1,
											st1k,
											decimal.Parse(r["bhyt"].ToString()),tamung,decimal.Parse(r["bhytt0107"].ToString()),dr[i]["nguoinha"].ToString(),int.Parse(dr[i]["hinhthuc"].ToString()),int.Parse(dr[i]["phuongphap"].ToString()),int.Parse(dr[i]["ketqua"].ToString()),dr[i]["soluutru"].ToString(),
											dg1k,dr[i]["ngaypt"].ToString(),dr[i]["tenpt"].ToString(),loaiba,int.Parse(dr[i]["done"].ToString()),dr[i]["mabs"].ToString(),dr[i]["tenbs"].ToString(),dr[i]["tenuser"].ToString(),dr[i]["image"].ToString(),dr[i]["ghichu"].ToString(),ngay1,ngay2,ngay3,(bTtngay)?r["ngay"].ToString():"",kythuat,b_sobienlaitamung,(r["idttrv"].ToString()!="")?long.Parse(r["idttrv"].ToString()):0,"","",int.Parse(dr[i]["traituyen"].ToString()),0,0,(bCLktcao||ngia)?dg2k:0,decimal.Parse(r["id"].ToString()),0,vuottran,dr[i]["ngayvv"].ToString(),dr[i]["ngayrv"].ToString());
									}
									else
									{

										updrec_ravien(ds,int.Parse(dr[i]["khu"].ToString()),dr[i]["mabn"].ToString(),dr[i]["mabn"].ToString(),long.Parse(dr[i]["maql"].ToString()),long.Parse(dr[i]["idkhoa"].ToString()),dr[i]["hoten"].ToString(),dr[i]["namsinh"].ToString(),dr[i]["phai"].ToString(),
											dr[i]["diachi"].ToString(),i_madt,s_dtuong,s_sothe,iBhyt,s_tungay,s_denngay,dr[i]["noigioithieu"].ToString(),s_dkkcb,
											dr[i]["giuong"].ToString(),r["makp"].ToString()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),s_tenkp.Trim()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),ngayvao,dr[i]["ngayra"].ToString(),dr[i]["chandoan"].ToString(),dr[i]["maicd"].ToString(),int.Parse(r2["sttnhom"].ToString()),
											r2["nhom"].ToString(),int.Parse(r2["sttloai"].ToString()),r2["loai"].ToString(),int.Parse(r["mavp"].ToString()),
											s_ten,r2["dvt"].ToString(),decimal.Parse(r["soluong"].ToString()),
											st1k,
											decimal.Parse(r["bhyt"].ToString()),tamung,decimal.Parse(r["bhytt0107"].ToString()),dr[i]["nguoinha"].ToString(),int.Parse(dr[i]["hinhthuc"].ToString()),int.Parse(dr[i]["phuongphap"].ToString()),int.Parse(dr[i]["ketqua"].ToString()),dr[i]["soluutru"].ToString(),
											dg1k,dr[i]["ngaypt"].ToString(),dr[i]["tenpt"].ToString(),loaiba,int.Parse(dr[i]["done"].ToString()),dr[i]["mabs"].ToString(),dr[i]["tenbs"].ToString(),dr[i]["tenuser"].ToString(),dr[i]["image"].ToString(),dr[i]["ghichu"].ToString(),ngay1,ngay2,ngay3,(bTtngay)?r["ngay"].ToString():"",kythuat,b_sobienlaitamung,(r["idttrv"].ToString()!="")?long.Parse(r["idttrv"].ToString()):0,"","",int.Parse(dr[i]["traituyen"].ToString()),0,0,(bCLktcao||ngia)?dg2k:0,decimal.Parse(r["id"].ToString()),0,vuottran,dr[i]["ngayvv"].ToString(),dr[i]["ngayrv"].ToString());
									}								
								}
								if (dr[i]["done"].ToString()=="0" && (int.Parse(dr[i]["madoituong"].ToString())!=i_haophi || (int.Parse(dr[i]["madoituong"].ToString())==i_haophi && bHaophi_vp)))
								{
									if(bktCao_ttDV) 
									{
										upd_thvpct(s_mmyy,idvienphi,r["ngay"].ToString(),r["makp"].ToString(),i_madt,long.Parse(r["mavp"].ToString()),1,dg1k,st1k,(r["vattu"].ToString().Trim()=="")?0:decimal.Parse(r["vattu"].ToString()),s_sothe,0);
										execute_data("update "+user+s_mmyy+".v_thvpct set ktcao=1 where id="+idvienphi+" and makp='"+r["makp"].ToString()+"' and to_char(ngay,'dd/mm/yyyy')='"+r["ngay"].ToString()+"' and madoituong="+i_madt+" and mavp="+r["mavp"].ToString()+" and dongia="+dg1k);
									}
									else 
									{
										upd_thvpct(s_mmyy,idvienphi,r["ngay"].ToString(),r["makp"].ToString(),i_madt,long.Parse(r["mavp"].ToString()),decimal.Parse(r["soluong"].ToString()),dg1k,st1k,(r["vattu"].ToString().Trim()=="")?0:decimal.Parse(r["vattu"].ToString()),s_sothe,0);
										//										execute_data("update "+user+s_mmyy+".v_thvpct set ktcao=1 where id="+idvienphi+" and makp='"+r["makp"].ToString()+"' and to_char(ngay,'dd/mm/yyyy')='"+r["ngay"].ToString()+"' and madoituong="+i_madt+" and mavp="+r["mavp"].ToString()+" and dongia="+dg1k);
									}
									
								}
								
								if (dg2k!=0)
								{									
									s_ten += " BN thanh toán chênh lệch "+((kythuat==0)?"kỹ thuật cao":"chăm sóc thai sản,sinh đẻ");
									s_tenktcao_chung += " BN thanh toán chênh lệch "+((kythuat==0)?"kỹ thuật cao":"chăm sóc thai sản,sinh đẻ");
									r1=getrowbyid(dtdt,"madoituong="+i_tunguyen);
									if (r1!=null) s_dtuong=r1["doituong"].ToString();
									if(m_madoituong_inttrv=="" || m_madoituong_inttrv.IndexOf(","+dr[i]["madoituong"].ToString()+",")>=0)
									{
										//binh 070611: do khi chon chuyen so lieu vp, nhung khong chon het doi tuong, chi chon 1 dtuong de in (thuong in lai)
										//Khi do SL chuyen xuong vp chi chuyen doi tuong duoc chon --> do do thieu so lieu
										//
										if(bktCao_ttDV)
										{
											updrec_ravien(ds,int.Parse(dr[i]["khu"].ToString()),dr[i]["mabn"].ToString(),dr[i]["mabn"].ToString(),long.Parse(dr[i]["maql"].ToString()),long.Parse(dr[i]["idkhoa"].ToString()),dr[i]["hoten"].ToString(),dr[i]["namsinh"].ToString(),dr[i]["phai"].ToString(),
												dr[i]["diachi"].ToString(),i_tunguyen,s_dtuong,s_sothe,iBhyt,s_tungay,s_denngay,dr[i]["noigioithieu"].ToString(),s_dkkcb,
												dr[i]["giuong"].ToString(),r["makp"].ToString()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),s_tenkp.Trim()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),ngayvao,dr[i]["ngayra"].ToString(),dr[i]["chandoan"].ToString(),dr[i]["maicd"].ToString(),int.Parse(r2["sttnhom"].ToString()),
												r2["nhom"].ToString(),int.Parse(r2["sttloai"].ToString()),r2["loai"].ToString(),int.Parse(r["mavp"].ToString()),
												s_tenktcao_chung,r2["dvt"].ToString(),1,
												st2k,
												decimal.Parse(r["bhyt"].ToString()),0,decimal.Parse(r["bhytt0107"].ToString()),dr[i]["nguoinha"].ToString(),int.Parse(dr[i]["hinhthuc"].ToString()),int.Parse(dr[i]["phuongphap"].ToString()),int.Parse(dr[i]["ketqua"].ToString()),dr[i]["soluutru"].ToString(),
												dg2k,dr[i]["ngaypt"].ToString(),dr[i]["tenpt"].ToString(),loaiba,int.Parse(dr[i]["done"].ToString()),dr[i]["mabs"].ToString(),dr[i]["tenbs"].ToString(),dr[i]["tenuser"].ToString(),dr[i]["image"].ToString(),dr[i]["ghichu"].ToString(),ngay1,ngay2,ngay3,(bTtngay)?r["ngay"].ToString():"",kythuat,b_sobienlaitamung,(r["idttrv"].ToString()!="")?long.Parse(r["idttrv"].ToString()):0,"","",int.Parse(dr[i]["traituyen"].ToString()),0,0,(bCLktcao?-1:0),decimal.Parse(r["id"].ToString()),0,vuottran,dr[i]["ngayvv"].ToString(),dr[i]["ngayrv"].ToString());
										}
										else
										{
											updrec_ravien(ds,int.Parse(dr[i]["khu"].ToString()),dr[i]["mabn"].ToString(),dr[i]["mabn"].ToString(),long.Parse(dr[i]["maql"].ToString()),long.Parse(dr[i]["idkhoa"].ToString()),dr[i]["hoten"].ToString(),dr[i]["namsinh"].ToString(),dr[i]["phai"].ToString(),
												dr[i]["diachi"].ToString(),i_tunguyen,s_dtuong,s_sothe,iBhyt,s_tungay,s_denngay,dr[i]["noigioithieu"].ToString(),s_dkkcb,
												dr[i]["giuong"].ToString(),r["makp"].ToString()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),s_tenkp.Trim()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),ngayvao,dr[i]["ngayra"].ToString(),dr[i]["chandoan"].ToString(),dr[i]["maicd"].ToString(),int.Parse(r2["sttnhom"].ToString()),
												r2["nhom"].ToString(),int.Parse(r2["sttloai"].ToString()),r2["loai"].ToString(),int.Parse(r["mavp"].ToString()),
												s_ten,r2["dvt"].ToString(),decimal.Parse(r["soluong"].ToString()),
												st2k,
												decimal.Parse(r["bhyt"].ToString()),0,decimal.Parse(r["bhytt0107"].ToString()),dr[i]["nguoinha"].ToString(),int.Parse(dr[i]["hinhthuc"].ToString()),int.Parse(dr[i]["phuongphap"].ToString()),int.Parse(dr[i]["ketqua"].ToString()),dr[i]["soluutru"].ToString(),
												dg2k,dr[i]["ngaypt"].ToString(),dr[i]["tenpt"].ToString(),loaiba,int.Parse(dr[i]["done"].ToString()),dr[i]["mabs"].ToString(),dr[i]["tenbs"].ToString(),dr[i]["tenuser"].ToString(),dr[i]["image"].ToString(),dr[i]["ghichu"].ToString(),ngay1,ngay2,ngay3,(bTtngay)?r["ngay"].ToString():"",kythuat,b_sobienlaitamung,(r["idttrv"].ToString()!="")?long.Parse(r["idttrv"].ToString()):0,"","",int.Parse(dr[i]["traituyen"].ToString()),0,0,(bCLktcao?-1:0),decimal.Parse(r["id"].ToString()),0,vuottran,dr[i]["ngayvv"].ToString(),dr[i]["ngayrv"].ToString());
										}									
									}
									if (dr[i]["done"].ToString()=="0" && int.Parse(dr[i]["madoituong"].ToString())!=i_haophi)
									{
										if(bktCao_ttDV) 
										{
											upd_thvpct(s_mmyy,idvienphi,r["ngay"].ToString(),r["makp"].ToString(),i_tunguyen,long.Parse(r["mavp"].ToString()),1,dg2k,st2k,decimal.Parse(r["vattu"].ToString()),s_sothe,0);
											execute_data("update "+user+s_mmyy+".v_thvpct set ktcao=1 where id="+idvienphi+" and makp='"+r["makp"].ToString()+" and to_char(ngay,'dd/mm/yyyy')='"+r["ngay"].ToString()+"' and madoituong="+i_tunguyen+" and mavp="+r["mavp"].ToString()+" and dongia="+dg2k);
										}
										else 
										{
											upd_thvpct(s_mmyy,idvienphi,r["ngay"].ToString(),r["makp"].ToString(),i_tunguyen,long.Parse(r["mavp"].ToString()),decimal.Parse(r["soluong"].ToString()),dg2k,st2k,decimal.Parse(r["vattu"].ToString()),s_sothe,0);
											//											execute_data("update "+user+s_mmyy+".v_thvpct set ktcao=1 where id="+idvienphi+" and makp='"+r["makp"].ToString()+" and to_char(ngay,'dd/mm/yyyy')='"+r["ngay"].ToString()+"' and madoituong="+i_tunguyen+" and mavp="+r["mavp"].ToString()+" and dongia="+dg2k);
										}
										
									}
								}
								//								}
								//								kythuat=0;
							}
							else
							{
								i_madt=int.Parse(dr[i]["madoituong"].ToString());
								if(m_madoituong_inttrv=="" || m_madoituong_inttrv.IndexOf(","+dr[i]["madoituong"].ToString()+",")>=0)
								{
									//binh 070611: do khi chon chuyen so lieu vp, nhung khong chon het doi tuong, chi chon 1 dtuong de in (thuong in lai)
									//Khi do SL chuyen xuong vp chi chuyen doi tuong duoc chon --> do do thieu so lieu
									//
									updrec_ravien(ds,int.Parse(dr[i]["khu"].ToString()),dr[i]["mabn"].ToString(),dr[i]["mabn"].ToString(),long.Parse(dr[i]["maql"].ToString()),long.Parse(dr[i]["idkhoa"].ToString()),dr[i]["hoten"].ToString(),dr[i]["namsinh"].ToString(),dr[i]["phai"].ToString(),
										dr[i]["diachi"].ToString(),i_madt,s_dtuong,s_sothe,iBhyt,s_tungay,s_denngay,dr[i]["noigioithieu"].ToString(),s_dkkcb,
										dr[i]["giuong"].ToString(),r["makp"].ToString()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),s_tenkp.Trim()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),ngayvao,dr[i]["ngayra"].ToString(),dr[i]["chandoan"].ToString(),dr[i]["maicd"].ToString(),int.Parse(r2["sttnhom"].ToString()),
										r2["nhom"].ToString(),int.Parse(r2["sttloai"].ToString()),r2["loai"].ToString(),int.Parse(r["mavp"].ToString()),
										s_ten,r2["dvt"].ToString(),decimal.Parse(r["soluong"].ToString()),
										st1,
										decimal.Parse(r["bhyt"].ToString()),tamung,decimal.Parse(r["bhytt0107"].ToString()),dr[i]["nguoinha"].ToString(),int.Parse(dr[i]["hinhthuc"].ToString()),int.Parse(dr[i]["phuongphap"].ToString()),int.Parse(dr[i]["ketqua"].ToString()),dr[i]["soluutru"].ToString(),
										dg1,dr[i]["ngaypt"].ToString(),dr[i]["tenpt"].ToString(),loaiba,int.Parse(dr[i]["done"].ToString()),dr[i]["mabs"].ToString(),dr[i]["tenbs"].ToString(),dr[i]["tenuser"].ToString(),dr[i]["image"].ToString(),dr[i]["ghichu"].ToString(),ngay1,ngay2,ngay3,(bTtngay)?r["ngay"].ToString():"",kythuat,b_sobienlaitamung,(r["idttrv"].ToString()!="")?long.Parse(r["idttrv"].ToString()):0,"","",int.Parse(dr[i]["traituyen"].ToString()),0,0,(r["giachenhlech"].ToString()==""?0:decimal.Parse(r["giachenhlech"].ToString())),(r["id"].ToString()==null || r["id"].ToString()=="")? 0:decimal.Parse(r["id"].ToString()),0,0,dr[i]["ngayvv"].ToString(),dr[i]["ngayrv"].ToString());
								}
								if (dr[i]["done"].ToString()=="0" && (int.Parse(dr[i]["madoituong"].ToString())!=i_haophi || (int.Parse(dr[i]["madoituong"].ToString())==i_haophi && bHaophi_vp)))
								{
									upd_thvpct(s_mmyy,idvienphi,r["ngay"].ToString(),r["makp"].ToString(),i_madt,long.Parse(r["mavp"].ToString()),decimal.Parse(r["soluong"].ToString()),dg1,st1,(r["vattu"].ToString().Trim()=="")?0:decimal.Parse(r["vattu"].ToString()),s_sothe,0);
								}
							}
							#endregion

							#region chenhlech
							dg2=0;
							bCont=bChenhlechdv;//bCont=(bchenhlech_tructiep)?false:bChenhlechdv;
							if (bchenhlech_giavp) bCont=bCont && r2["chenhlech"].ToString()=="1";
							bCont=bCont && chenhlech.IndexOf(i_madoituongvao.ToString().Trim()+",")!=-1 
								&& decimal.Parse(r2["bhyt"].ToString())>0 
								&& decimal.Parse(r2["gia_"+f1.Trim()].ToString())<decimal.Parse(r2["gia_"+f2.Trim()].ToString())
								&& bTungay && bDenngay;
							if (bchenhlech_traituyen && int.Parse(dr[i]["traituyen"].ToString())==0) bCont=false;
							bCont=bCont && r["dachenhlech"].ToString()=="0";
							if (bCont && (loaiba==1 || loaiba==4))
							{
								if (bChenhlech_dt || (r["dachenhlech"].ToString()=="0" && r2["chenhlech"].ToString()=="1"))
								{
									if (s_madt==i_tunguyen.ToString().Trim() || bDoituong_co_chenhlech(s_madt))
									{
										s_madt=i_tunguyen.ToString();
										i_madt=int.Parse(s_madt);
										r1=getrowbyid(dtdt,"madoituong="+i_madt);
										if (r1!=null) s_dtuong=r1["doituong"].ToString();
										s_ten+=" BN thanh toán chênh lệch ";
										dg2=decimal.Parse(r2["gia_"+f2.Trim()].ToString())+decimal.Parse(r2["vattu_"+f2.Trim()].ToString())-dg1;
										st2=decimal.Parse(r["soluong"].ToString())*dg2;
									}
									else if (bDoituong_BHYT(int.Parse(s_madt),dtdt) && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))//else if (s_madt=="1" && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))
									{
										s_madt=i_tunguyen.ToString();
										i_madt=int.Parse(s_madt);
										r1=getrowbyid(dtdt,"madoituong="+i_madt);
										if (r1!=null) s_dtuong=r1["doituong"].ToString();
										s_ten=r2["ten"].ToString();
										decimal bn=100-decimal.Parse(r2["bhyt"].ToString());
										s_ten+=" BN thanh toán "+bn.ToString().Trim()+" %";
										dg2=dongia*bn/100;
										st2=decimal.Parse(r["sotien"].ToString())-decimal.Parse(r["bhyt"].ToString());
									}
								}
								else
								{
									if (f1!=f2)
									{
										s_madt=i_tunguyen.ToString();
										i_madt=int.Parse(s_madt);
										r1=getrowbyid(dtdt,"madoituong="+i_madt);
										if (r1!=null) s_dtuong=r1["doituong"].ToString();
										s_ten+=" BN thanh toán chênh lệch ";
										dg2=decimal.Parse(r2["gia_"+f2.Trim()].ToString())+decimal.Parse(r2["vattu_"+f2.Trim()].ToString())-dg1;
										st2=decimal.Parse(r["soluong"].ToString())*dg2;
									}
									else if (bDoituong_BHYT(int.Parse(s_madt),dtdt) && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))//else if (s_madt=="1" && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))
									{
										s_madt=i_tunguyen.ToString();
										i_madt=int.Parse(s_madt);
										r1=getrowbyid(dtdt,"madoituong="+i_madt);
										if (r1!=null) s_dtuong=r1["doituong"].ToString();
										s_ten=r2["ten"].ToString();
										decimal bn=100-decimal.Parse(r2["bhyt"].ToString());
										s_ten+=" BN thanh toán "+bn.ToString().Trim()+" %";
										dg2=dongia*bn/100;
										st2=decimal.Parse(r["sotien"].ToString())-decimal.Parse(r["bhyt"].ToString());
									}

								}
							}
							else if (bDoituong_BHYT(int.Parse(s_madt),dtdt) && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))//else if (s_madt=="1" && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))
							{
								s_madt=i_tunguyen.ToString();
								i_madt=int.Parse(s_madt);
								r1=getrowbyid(dtdt,"madoituong="+i_madt);
								if (r1!=null) s_dtuong=r1["doituong"].ToString();
								s_ten=r2["ten"].ToString();
								decimal bn=100-decimal.Parse(r2["bhyt"].ToString());
								s_ten+=" BN thanh toán "+bn.ToString().Trim()+" %";
								dg2=dongia*bn/100;
								st2=decimal.Parse(r["sotien"].ToString())-decimal.Parse(r["bhyt"].ToString());
							}

							#endregion

							if (dg2>0)
							{
								i_madt=int.Parse(dr[i]["madoituong"].ToString());
								if(m_madoituong_inttrv=="" || m_madoituong_inttrv.IndexOf(","+dr[i]["madoituong"].ToString()+",")>=0)
								{
									//binh 070611: do khi chon chuyen so lieu vp, nhung khong chon het doi tuong, chi chon 1 dtuong de in (thuong in lai)
									//Khi do SL chuyen xuong vp chi chuyen doi tuong duoc chon --> do do thieu so lieu
									//
									updrec_ravien(ds,int.Parse(dr[i]["khu"].ToString()),dr[i]["mabn"].ToString(),dr[i]["mabn"].ToString(),long.Parse(dr[i]["maql"].ToString()),long.Parse(dr[i]["idkhoa"].ToString()),dr[i]["hoten"].ToString(),dr[i]["namsinh"].ToString(),dr[i]["phai"].ToString(),
										dr[i]["diachi"].ToString(),i_madt,s_dtuong,s_sothe,iBhyt,s_tungay,s_denngay,dr[i]["noigioithieu"].ToString(),s_dkkcb,
										dr[i]["giuong"].ToString(),r["makp"].ToString()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),s_tenkp.Trim()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),ngayvao,dr[i]["ngayra"].ToString(),dr[i]["chandoan"].ToString(),dr[i]["maicd"].ToString(),int.Parse(r2["sttnhom"].ToString()),
										r2["nhom"].ToString(),int.Parse(r2["sttloai"].ToString()),r2["loai"].ToString(),int.Parse(r["mavp"].ToString()),
										s_ten,r2["dvt"].ToString(),decimal.Parse(r["soluong"].ToString()),
										st2,
										decimal.Parse(r["bhyt"].ToString()),0,decimal.Parse(r["bhytt0107"].ToString()),dr[i]["nguoinha"].ToString(),int.Parse(dr[i]["hinhthuc"].ToString()),int.Parse(dr[i]["phuongphap"].ToString()),int.Parse(dr[i]["ketqua"].ToString()),dr[i]["soluutru"].ToString(),
										dg2,dr[i]["ngaypt"].ToString(),dr[i]["tenpt"].ToString(),loaiba,int.Parse(dr[i]["done"].ToString()),dr[i]["mabs"].ToString(),dr[i]["tenbs"].ToString(),dr[i]["tenuser"].ToString(),dr[i]["image"].ToString(),dr[i]["ghichu"].ToString(),ngay1,ngay2,ngay3,(bTtngay)?r["ngay"].ToString():"",kythuat,b_sobienlaitamung,(r["idttrv"].ToString()!="")?long.Parse(r["idttrv"].ToString()):0,"","",int.Parse(dr[i]["traituyen"].ToString()),0,0,(bCLktcao?-1:0),(r["id"].ToString()==null || r["id"].ToString()=="")? 0:decimal.Parse(r["id"].ToString()),0,0,dr[i]["ngayvv"].ToString(),dr[i]["ngayrv"].ToString());
								}
								if (dr[i]["done"].ToString()=="0" && int.Parse(dr[i]["madoituong"].ToString())!=i_haophi)
									upd_thvpct(s_mmyy,idvienphi,r["ngay"].ToString(),r["makp"].ToString(),i_madt,long.Parse(r["mavp"].ToString()),decimal.Parse(r["soluong"].ToString()),dg2,st2,decimal.Parse(r["vattu"].ToString()),s_sothe,0);
							}
							if (dr[i]["done"].ToString()=="0" && (int.Parse(dr[i]["madoituong"].ToString())!=i_haophi || (int.Parse(dr[i]["madoituong"].ToString())==i_haophi && bHaophi_vp)))
							{									
								sotien+=decimal.Parse(r["sotien"].ToString());
								bhyt+=decimal.Parse(r["bhyt"].ToString());
							}
						}
					}
					
				}
				#endregion Vienphi

				#region Thuoc

				if (!bBosolieuduoc)
				{
					//tmp=get_thuoc_ct((int.Parse(dr[i]["motkhu"].ToString())==1)?0:int.Parse(dr[i]["khu"].ToString()),dr[i]["mabn"].ToString(),maql,idkhoa,dr[i]["ngayvao"].ToString(),dr[i]["ngayra"].ToString(),(makp=="" || r1==null)?0:int.Parse(r1["id"].ToString()),int.Parse(dr[i]["madoituong"].ToString()),int.Parse(dr[i]["done"].ToString()),maql_phongluu,bChenhlechdv,bCapve,bNgtr,loaiba,dr[i]["makp"].ToString(),mavaovien,dr[i]["maso"].ToString(),bTheongay,bThanhtoanndot,bTTRV_theokhoa);
					try
					{
						tmp.Clear();
					}
					catch{tmp=null;}
					try
					{
						tmp=dttmp.Copy();
					}
					catch{tmp=null;}

					if (tmp!=null)
					{
						DataSet dsttt=new DataSet();
						dsttt.Tables.Add(tmp.Copy());
						//dsttt.WriteXml("thuocxml.xml",XmlWriteMode.WriteSchema);
						string exs="id_ktcao=0";
						if(int.Parse(dr[i]["madoituong"].ToString())!=1) exs="";
						foreach(DataRow r in tmp.Select(exs))
						{		
							bKhongchiphi=false;
							if(s_mabd.IndexOf(r["mabd"].ToString()+",")<0)s_mabd+=r["mabd"].ToString()+",";
							r2=getrowbyid(dtbd,"id="+int.Parse(r["mabd"].ToString()));
							if (r2!=null)
							{
								ngay1=dr[i]["ngay1"].ToString().Trim();
								ngay2=dr[i]["ngay2"].ToString().Trim();
								ngay3=dr[i]["ngay3"].ToString().Trim();
								if (bBhyt)
								{
									r3=dtbhyt.Select("maql="+maql+" and den>="+r["ngay"].ToString().Substring(6,4)+r["ngay"].ToString().Substring(3,2)+r["ngay"].ToString().Substring(0,2),"den");
									if (r3.Length>0)
									{
										s_tungay=r3[0]["tungay"].ToString();
										s_denngay=r3[0]["denngay"].ToString();
										s_sothe=r3[0]["sothe"].ToString();
										s_dkkcb=r3[0]["tenbv"].ToString();
										ngay1=r3[0]["ngay1"].ToString().Trim();
										ngay2=r3[0]["ngay2"].ToString().Trim();
										ngay3=r3[0]["ngay3"].ToString().Trim();
										s_ngaytrinh=r3[0]["ngaytrinh"].ToString();
										s_ngayduyet=r3[0]["ngayduyet"].ToString();
										s_ngaygiahan=r3[0]["ngaygiahan"].ToString();
										s_tungay+="^"+s_ngaytrinh+"^"+s_ngayduyet+"^"+s_ngaygiahan;
									}
								}
								DataRow rkp=getrowbyid(dtkpm,"makp='"+r["makp"].ToString()+"'");
								//if(rkp!=null)s_tenkp=rkp["ten"].ToString();
								if(rkp!=null)s_tenkp=rkp["tenkp"].ToString();//Thuy 15.02.2012
								else s_tenkp=dr[i]["tenkp"].ToString();
								s_madt=dr[i]["madoituong"].ToString().Trim();
								iBhyt=(s_madt=="1")?get_bhyt(dtbdfull,long.Parse(r["mabd"].ToString()),r["ngay"].ToString()):0;
								i_madt=int.Parse(s_madt);
								s_dtuong=dr[i]["doituong"].ToString();
								kythuat=int.Parse(r["kythuat"].ToString());//kythuat=int.Parse(r2["kythuat"].ToString());
								//
								if (bSothengayhuong && kythuat!=-1 && bDoituong_BHYT(i_madt,dtdt))//if (kythuat==1 && i_madt==1)
								{
									bool bChuaduochuong=false;
									if(ngay1=="" && kythuat==0) bChuaduochuong=true;
									else if(ngay2=="" && kythuat==1) bChuaduochuong=true;
									else if (ngay3=="" && kythuat==2) bChuaduochuong=true;
									if (bChuaduochuong || (kythuat==2 && ngay3!="" && !bNgay(r["ngay"].ToString(),ngay3))||(kythuat==0 && ngay1!="" && !bNgay(r["ngay"].ToString(),ngay1) )||(kythuat==1 && ngay2!="" && !bNgay(r["ngay"].ToString(),ngay2)))
									{										
										i_madt=i_tunguyen;
										s_madt=i_madt.ToString();
										r1=getrowbyid(dtdt,"madoituong="+i_madt);
										if (r1!=null) s_dtuong=r1["doituong"].ToString();
									}
									//}
								}
							
								//
								if (bRavien_hc)
								{
									if (r2["tenhc"].ToString()!="") s_ten=r2["tenhc"].ToString().Trim()+"["+r2["tenbd"].ToString().Trim()+"]";
									else s_ten=r2["tenbd"].ToString();
								}
								else s_ten=r2["ten"].ToString();
								dongia=decimal.Parse(r["dongia"].ToString());
								dg1=dongia;dg2=0;st2=0;st1=decimal.Parse(r["sotien"].ToString());
								bDenngay=true;bTungay=true;
								giamua=decimal.Parse(r["giamua"].ToString());//
								if(giamua==0)giamua=dongia;
								
								if (s_denngay.Trim().Length==10) bDenngay=bNgay(s_denngay,r["ngay"].ToString().Substring(0,10));
								if (s_tungay.Trim().Length==10) bTungay=bNgay(r["ngay"].ToString().Substring(0,10),s_tungay);
								bCont=(bTungay && bDenngay && bChenhlechdv  
									&& chenhlech.IndexOf(i_madoituongvao.ToString().Trim()+",")!=-1 
									&& chenhlech.IndexOf(s_madt.ToString().Trim()+",")!=-1 //BBBB
									&& decimal.Parse(r2["bhyt"].ToString())>0); 
								//&& r["loai"].ToString().Trim()=="1");// chi tinh chenh lech thuoc khi khai bao doi tuong tinh theo gia ban: bbbb - bo ra
								if (bChenhlech_dt) bCont=bCont && s_madt==i_tunguyen.ToString().Trim();
								bCont=bCont && bTienthuoc_tinhchenhlech;
								giaban=decimal.Parse(r["giaban"].ToString());
								if (bCont && bgia_bh_quydinh)
								{
									if(bGia_bh_quydinh_giamua) giaban=dongia;//giamua;
									r1=getrowbyid(dtbdfull,"id="+long.Parse(r["mabd"].ToString()));
									if (r1!=null)
									{
										if (decimal.Parse(r1["gia_bh"].ToString())>0)
										{											
											giamua=Math.Min(giamua,decimal.Parse(r1["gia_bh"].ToString()));											
										}
									}
								}								
								bCont=bCont && Math.Round(giaban,2)-Math.Round(giamua,2)>1;///Math.Round(giaban,2)!=Math.Round(giamua,2);
								if (bchenhlech_traituyen && int.Parse(dr[i]["traituyen"].ToString())==0) bCont=false;
								
								if (bCont)
								{
									i_madt=i_madoituongvao;
									r1=getrowbyid(dtdt,"madoituong="+i_madt);
									if (r1!=null) s_dtuong=r1["doituong"].ToString();
									dg1=giamua;
									st1=decimal.Parse(r["soluong"].ToString())*dg1;
								}
								else if (bDoituong_BHYT(int.Parse(s_madt),dtdt) && iBhyt!=0)//else if (s_madt=="1" && iBhyt!=0)// && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))
								{
									if (iBhyt!=100) s_ten+=" BHYT thanh toán "+iBhyt.ToString()+" %";//r2["bhyt"].ToString().Trim()+" %";
									//dg1=dongia*iBhyt/100;
									dg1=dongia;
									st1=decimal.Parse(r["soluong"].ToString())*(dongia*iBhyt/100);
									//dg1=dongia;
								}
								//								}
								//
								//
								#region Tinh KT Cao CHO THUOC VAT TU Y TE	
								dg1k=dg2k=st1k=st2k=0;	bCLktcao=false;
								
								if (kythuat!=-1 && bDoituong_BHYT(i_madt,dtdt) && st1>mucbhquidinh)//if (kythuat==1 && i_madt==1)
								{	
									if(!bktCao_ttDV)
									{
										st1k=st1;dg1k=dg1;
										maphu=(dr[i]["sothe"].ToString().Trim()!="")?get_maphu_noitru(dr[i]["sothe"].ToString(),nhom,dr[i]["ngayra"].ToString().Substring(0,10)):0;
										if (maphu==0)//bhyt 100%
										{
											int atyle=100;
											nhom1=get_nhom(dr[i]["sothe"].ToString(),huong100,nhom);//xac dinh nhung the huong 100%
											if (!nhom1)
											{
												//if (st1>muckhongqua)
												//{
												nhom2=get_nhom(dr[i]["sothe"].ToString(),huong100kqua,nhom);//huong 100 khong qua dinh muc
												if (nhom2 && st1>muckhongqua)
												{
													st=st1;
													d_sotien_ktcao+=st;
													if(st<=muckhongqua && d_sotien_ktcao<=muckhongqua)
													{
														bCLktcao=false;
														st1k=st1;dg1k=dg1;
														st2k=0;dg2k=0;
														//binh thuong:
													}
													else if(st<=muckhongqua && d_sotien_ktcao>muckhongqua)
													{
														decimal tmpst=st1;
														st1k=(d_sotien_ktcao-muckhongqua>st)?0:(st-(d_sotien_ktcao-muckhongqua));
														st1k=Math.Round(st1k*(100/atyle),0);//lay nguoc lai st chua co bhyt
														dg1k=Math.Round(st1k/decimal.Parse(r["soluong"].ToString()),3);
														st2k=tmpst-st1k;
														dg2k=Math.Round(st2k/decimal.Parse(r["soluong"].ToString()),3);
														bCLktcao=true;
											
													}
													else if(st1>d_sotien_ktcao_dinhmuc)
													{
														decimal tmpst=st1;
														st1k=(d_sotien_ktcao-d_sotien_ktcao_dinhmuc>st1)?0:(st-(d_sotien_ktcao-d_sotien_ktcao_dinhmuc));
														st1k=Math.Round(st1k*(100/atyle),0);//lay nguoc lai st chua co bhyt
														dg1k=Math.Round(st1k/decimal.Parse(r["soluong"].ToString()),3);
														st2k=tmpst-st1k;
														dg2k=Math.Round(st2k/decimal.Parse(r["soluong"].ToString()),3);
														bCLktcao=true;
													}
												}
												else 
												{
													int tmp_phantrambhyt=phantrambhyt;
													if(dr[i]["sothe"].ToString().Length==15||dr[i]["sothe"].ToString().Length==20)
													{
														tmp_phantrambhyt=(maphu==0)?100:(maphu==1)?80:95;
													}
													st = st1 * tmp_phantrambhyt / 100;//huong khong qua 60%
													d_sotien_ktcao+=st;

													if (d_sotien_ktcao < mucbhquidinh)//if (st < mucbhquidinh)
													{
														st1k = mucbhquidinh;
														dg1k = st1k / decimal.Parse(r["soluong"].ToString());
														st2k = st1 - st1k;
														dg2k = st2k / decimal.Parse(r["soluong"].ToString());
														bCLktcao=true;
													}
													else if (d_sotien_ktcao > muckhongqua)//else if (st > muckhongqua)
													{
														//													st1k = muckhongqua;//60% vuot qua dinh muc thi so tien=so tien dinh muc
														//													dg1k = st1k / decimal.Parse(r["soluong"].ToString());
														//													st2k = st1 - st1k;// chenh lech = so tien - so tien dinh muc
														//													dg2k = st2k / decimal.Parse(r["soluong"].ToString());
														decimal tmpst=st1;
														st1k=(d_sotien_ktcao-muckhongqua>st)?0:(st-(d_sotien_ktcao-muckhongqua));
														st1k=Math.Round(st1k*(100/atyle),0);//lay nguoc lai st chua co bhyt
														dg1k=Math.Round(st1k/decimal.Parse(r["soluong"].ToString()),3);
														st2k=tmpst-st1k;
														dg2k=Math.Round(st2k/decimal.Parse(r["soluong"].ToString()),3);
														bCLktcao=true;
													}
													else
													{
														if(st<=muckhongqua && d_sotien_ktcao<=muckhongqua)
														{
															bCLktcao=false;
															st1k=st1;dg1k=dg1;
															st2k=0;dg2k=0;
															//binh thuong:
														}
														else if(st<=muckhongqua && d_sotien_ktcao>muckhongqua)
														{
															decimal tmpst=st1;
															st1k=(d_sotien_ktcao-muckhongqua>st)?0:(st-(d_sotien_ktcao-muckhongqua));
															st1k=Math.Round(st1k*(100/atyle),0);//lay nguoc lai st chua co bhyt
															dg1k=Math.Round(st1k/decimal.Parse(r["soluong"].ToString()),3);
															st2k=tmpst-st1k;
															dg2k=Math.Round(st2k/decimal.Parse(r["soluong"].ToString()),3);
															bCLktcao=true;
											
														}
														else if(st1>d_sotien_ktcao_dinhmuc)
														{
															decimal tmpst=st1;
															st1k=(d_sotien_ktcao-d_sotien_ktcao_dinhmuc>st1)?0:(st-(d_sotien_ktcao-d_sotien_ktcao_dinhmuc));
															st1k=Math.Round(st1k*(100/atyle),0);//lay nguoc lai st chua co bhyt
															dg1k=Math.Round(st1k/decimal.Parse(r["soluong"].ToString()),3);
															st2k=tmpst-st1k;
															dg2k=Math.Round(st2k/decimal.Parse(r["soluong"].ToString()),3);
															bCLktcao=true;
														}
													}
												}
												//}
											}
										}									
										else
										{
											decimal atyle=(maphu==1)?80:(maphu==0)?100:95;
											st=st1*atyle/100;
											//
											d_sotien_ktcao+=st;
											//
											bFound_ktcao_vuot= d_sotien_ktcao>muckhongqua;
											if(st<=muckhongqua && d_sotien_ktcao<=muckhongqua)
											{
												bCLktcao=false;
												st1k=st1;dg1k=dg1;
												st2k=0;dg2k=0;
												//binh thuong:
											}
											else if(st<=muckhongqua && d_sotien_ktcao>muckhongqua)
											{
												decimal tmpst=st1;
												st1k=(d_sotien_ktcao-muckhongqua>st)?0:(st-(d_sotien_ktcao-muckhongqua));
												st1k=Math.Round(st1k*(100/atyle),0);//lay nguoc lai st chua co bhyt
												dg1k=Math.Round(st1k/decimal.Parse(r["soluong"].ToString()),3);
												st2k=tmpst-st1k;
												dg2k=Math.Round(st2k/decimal.Parse(r["soluong"].ToString()),3);
												bCLktcao=true;
											
											}
											else if(st1>d_sotien_ktcao_dinhmuc)
											{
												decimal tmpst=st1;
												st1k=(d_sotien_ktcao-d_sotien_ktcao_dinhmuc>st1)?0:(st-(d_sotien_ktcao-d_sotien_ktcao_dinhmuc));
												st1k=Math.Round(st1k*(100/atyle),0);//lay nguoc lai st chua co bhyt
												dg1k=Math.Round(st1k/decimal.Parse(r["soluong"].ToString()),3);
												st2k=tmpst-st1k;
												dg2k=Math.Round(st2k/decimal.Parse(r["soluong"].ToString()),3);
												bCLktcao=true;
											}
										}
										dg1=dg1k; st1=st1k;
										dg2=dg2k; st2=st2k;
										//bCLktcao=true;
									}
								}
								#endregion  Tinh KT Cao - thuoc - vat tu
								//
								//
								//Tim gia chenh lech																
								dg2=(bCLktcao)?dg2k:0;
								if (bCont)//co chenh lech
								{
									dg2+=Math.Round(giaban,0)-Math.Round(giamua,0);
									if(kythuat!=-1 && dg2>0 && dongia==giamua)bCLktcao=true;
								}
								i_madt=int.Parse(dr[i]["madoituong"].ToString());
								if(m_madoituong_inttrv=="" || m_madoituong_inttrv.IndexOf(","+dr[i]["madoituong"].ToString()+",")>=0)
								{
									//binh 070611: do khi chon chuyen so lieu vp, nhung khong chon het doi tuong, chi chon 1 dtuong de in (thuong in lai)
									//Khi do SL chuyen xuong vp chi chuyen doi tuong duoc chon --> do do thieu so lieu
									//
									updrec_ravien(ds,int.Parse(dr[i]["khu"].ToString()),dr[i]["mabn"].ToString(),dr[i]["mabn"].ToString(),long.Parse(dr[i]["maql"].ToString()),long.Parse(dr[i]["idkhoa"].ToString()),dr[i]["hoten"].ToString(),dr[i]["namsinh"].ToString(),dr[i]["phai"].ToString(),
										dr[i]["diachi"].ToString(),i_madt,s_dtuong,s_sothe,iBhyt,s_tungay,s_denngay,dr[i]["noigioithieu"].ToString(),s_dkkcb,
										dr[i]["giuong"].ToString(),r["makp"].ToString() + ((bTtngay) ? " : " + r["ngay"].ToString() : ""),s_tenkp.Trim()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),ngayvao,dr[i]["ngayra"].ToString(),dr[i]["chandoan"].ToString(),dr[i]["maicd"].ToString(),int.Parse(r2["sttnhom"].ToString()),
										r2["nhom"].ToString(),int.Parse(r2["sttloai"].ToString()),r2["loai"].ToString(),int.Parse(r["mabd"].ToString()),
										s_ten,r2["dvt"].ToString(),decimal.Parse(r["soluong"].ToString()),
										st1,
										(iBhyt!=0)?st1:0,tamung,decimal.Parse(r["bhytt0107"].ToString()),dr[i]["nguoinha"].ToString(),int.Parse(dr[i]["hinhthuc"].ToString()),int.Parse(dr[i]["phuongphap"].ToString()),int.Parse(dr[i]["ketqua"].ToString()),dr[i]["soluutru"].ToString(),
										dg1,dr[i]["ngaypt"].ToString(),dr[i]["tenpt"].ToString(),loaiba,int.Parse(dr[i]["done"].ToString()),dr[i]["mabs"].ToString(),dr[i]["tenbs"].ToString(),dr[i]["tenuser"].ToString(),dr[i]["image"].ToString(),dr[i]["ghichu"].ToString(),ngay1,ngay2,ngay3,(bTtngay)?r["ngay"].ToString():"",kythuat,
										b_sobienlaitamung,(r["idttrv"].ToString()!="")?long.Parse(r["idttrv"].ToString()):0,"","",int.Parse(dr[i]["traituyen"].ToString()),giamua,giaban,(bCLktcao||ngia)?dg2:0,0,(r["id_ktcao"].ToString()==null || r["id_ktcao"].ToString()=="")? 0:decimal.Parse(r["id_ktcao"].ToString()),0,dr[i]["ngayvv"].ToString(),dr[i]["ngayrv"].ToString());
								}
								if (dr[i]["done"].ToString()=="0" && (int.Parse(dr[i]["madoituong"].ToString())!=i_haophi || (int.Parse(dr[i]["madoituong"].ToString())==i_haophi && bHaophi_vp)))
								{
									upd_thvpct(s_mmyy,idvienphi,r["ngay"].ToString(),r["makp"].ToString(),i_madt,long.Parse(r["mabd"].ToString()),decimal.Parse(r["soluong"].ToString()),dg1,st1,0,s_sothe,0);
									if(r["id_ktcao"].ToString()!="0") execute_data(" update "+user+s_mmyy+".v_thvpct set id_ktcao="+r["id_ktcao"].ToString()+" where id="+idvienphi+" and mavp="+long.Parse(r["mabd"].ToString())+" and makp='"+r["makp"].ToString()+"'");
								}
								
								//
								
								
								dg2=(bCLktcao)?dg2k:0;
								st2=(bCLktcao)?st2k:0;

								if (bCont)
								{
									//
									if(s_mabd_chenhlech.IndexOf(r["mabd"].ToString()+",")<0)s_mabd_chenhlech+=r["mabd"].ToString()+",";
									//
									s_madt=i_tunguyen.ToString();
									i_madt=int.Parse(s_madt);
									r1=getrowbyid(dtdt,"madoituong="+i_madt);
									if (r1!=null) s_dtuong=r1["doituong"].ToString();
									s_ten+=" BN thanh toán chênh lệch ";									
									
									dg2+=Math.Round(giaban,0)-Math.Round(giamua,0);//giaban-giamua;
									st2+=decimal.Parse(r["soluong"].ToString())*dg2;
									
								}
								else if (bDoituong_BHYT(int.Parse(s_madt),dtdt) && iBhyt!=0)//else if (s_madt=="1" && iBhyt!=0)//decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))
								{
									i_madt=i_tunguyen;
									s_dtuong=s_doituong;
									s_ten=r2["ten"].ToString();
									dg1=dongia*iBhyt/100;
									decimal bn=100-iBhyt;
									if (iBhyt!=100) 
									{
										s_ten+=" BN thanh toán "+bn.ToString().Trim()+" %";
										//dg2+=dongia*bn/100;
										dg2+=dongia;
										st2+=decimal.Parse(r["sotien"].ToString())-decimal.Parse(r["soluong"].ToString())*(dongia*bn/100);
									}
									else 
									{
										dg2+=dongia*bn/100;
										st2+=decimal.Parse(r["sotien"].ToString())-decimal.Parse(r["soluong"].ToString())*dg2;
									}
									
									//dg2=dongia;//???
								}
								else if(bCLktcao && dg2>0)
								{
									i_madt=i_tunguyen;
									s_dtuong=s_doituong;
									s_ten=r2["ten"].ToString();
									s_ten+=" BN thanh toán chênh lệch KT Cao ";									
								}
								
								if (dg2!=0 && st2!=0)
								{
									i_madt=int.Parse(dr[i]["madoituong"].ToString());
									if(m_madoituong_inttrv=="" || m_madoituong_inttrv.IndexOf(","+dr[i]["madoituong"].ToString()+",")>=0)
									{
										//binh 070611: do khi chon chuyen so lieu vp, nhung khong chon het doi tuong, chi chon 1 dtuong de in (thuong in lai)
										//Khi do SL chuyen xuong vp chi chuyen doi tuong duoc chon --> do do thieu so lieu
										//
										updrec_ravien(ds,int.Parse(dr[i]["khu"].ToString()),dr[i]["mabn"].ToString(),dr[i]["mabn"].ToString(),long.Parse(dr[i]["maql"].ToString()),long.Parse(dr[i]["idkhoa"].ToString()),dr[i]["hoten"].ToString(),dr[i]["namsinh"].ToString(),dr[i]["phai"].ToString(),
											dr[i]["diachi"].ToString(),i_madt,s_dtuong,s_sothe,iBhyt,s_tungay,s_denngay,dr[i]["noigioithieu"].ToString(),s_dkkcb,
											dr[i]["giuong"].ToString(),r["makp"].ToString()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),s_tenkp.Trim()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),ngayvao,dr[i]["ngayra"].ToString(),dr[i]["chandoan"].ToString(),dr[i]["maicd"].ToString(),int.Parse(r2["sttnhom"].ToString()),
											r2["nhom"].ToString(),int.Parse(r2["sttloai"].ToString()),r2["loai"].ToString(),int.Parse(r["mabd"].ToString()),
											s_ten,r2["dvt"].ToString(),decimal.Parse(r["soluong"].ToString()),
											st2,
											(iBhyt!=0)?st2:0,0,decimal.Parse(r["bhytt0107"].ToString()),dr[i]["nguoinha"].ToString(),int.Parse(dr[i]["hinhthuc"].ToString()),int.Parse(dr[i]["phuongphap"].ToString()),int.Parse(dr[i]["ketqua"].ToString()),dr[i]["soluutru"].ToString(),
											dg2,dr[i]["ngaypt"].ToString(),dr[i]["tenpt"].ToString(),loaiba,int.Parse(dr[i]["done"].ToString()),dr[i]["mabs"].ToString(),dr[i]["tenbs"].ToString(),dr[i]["tenuser"].ToString(),dr[i]["image"].ToString(),dr[i]["ghichu"].ToString(),ngay1,ngay2,ngay3,
											(bTtngay)?r["ngay"].ToString():"",kythuat,b_sobienlaitamung,(r["idttrv"].ToString()!="")?long.Parse(r["idttrv"].ToString()):0,"","",int.Parse(dr[i]["traituyen"].ToString()),giamua,giaban,(bCLktcao||ngia?-1:0),0,(r["id_ktcao"].ToString()==null || r["id_ktcao"].ToString()=="")? 0:decimal.Parse(r["id_ktcao"].ToString()),0,dr[i]["ngayvv"].ToString(),dr[i]["ngayrv"].ToString());
									}
									if (dr[i]["done"].ToString()=="0"  && int.Parse(dr[i]["madoituong"].ToString())!=i_haophi)
									{
										upd_thvpct(s_mmyy,idvienphi,r["ngay"].ToString(),r["makp"].ToString(),i_madt,long.Parse(r["mabd"].ToString()),decimal.Parse(r["soluong"].ToString()),dg2,st2,0,s_sothe,0);
										if(r["id_ktcao"].ToString()!="0") execute_data(" update "+user+s_mmyy+".v_thvpct set id_ktcao="+r["id_ktcao"].ToString()+" where id="+idvienphi+" and mavp="+long.Parse(r["mabd"].ToString())+" and makp='"+r["makp"].ToString()+"'");
									}
								}
								if (dr[i]["done"].ToString()=="0" && (int.Parse(dr[i]["madoituong"].ToString())!=i_haophi || (int.Parse(dr[i]["madoituong"].ToString())==i_haophi && bHaophi_vp)))
								{
									sotien+=decimal.Parse(r["sotien"].ToString());
									bhyt+=(iBhyt!=0)?st1+st2:0;//decimal.Parse(r["bhyt"].ToString());
								}
							}
						}
					}
				}
				#endregion Thuoc
				if (dr[i]["done"].ToString()=="0"  && ((bHaophi_vienphi==false && int.Parse(dr[i]["madoituong"].ToString())!=i_haophi)||bHaophi_vienphi==true) )//&& int.Parse(dr[i]["madoituong"].ToString())!=i_haophi)
				{
					if (bDoituong_BHYT(dr[i]["madoituong"].ToString())) //if (dr[i]["madoituong"].ToString()=="1") //bhyt
					{
						if (dr[i]["maphu"].ToString()=="0") // Ko cung chi tra
						{
							bhyt=sotien;sotien=0;
						}
						else sotien=sotien-bhyt;
					}
					else if (mien_doituong(int.Parse(dr[i]["madoituong"].ToString()),dtdt)) //mien
					{
						mien=sotien;sotien=0;bhyt=0;
					}
					else {bhyt=0;}
					if (sotien+mien+bhyt+tamung!=0) 
					{
						if(mavaovien==0){mavaovien=get_mavaovien(maql);}
						if(mavaovien==0){mavaovien=get_mavaovien(maql,s_mmyy);}
						upd_thvpll(s_mmyy,idvienphi,dr[i]["mabn"].ToString(),maql,idkhoa,dr[i]["ngayvao"].ToString(),dr[i]["ngayra"].ToString(),dr[i]["giuong"].ToString(),dr[i]["makp"].ToString(),dr[i]["chandoan"].ToString(),dr[i]["maicd"].ToString(),sotien,tamung,bhyt,mien,int.Parse(dr[i]["khu"].ToString()));
						execute_data("update "+user+s_mmyy+".v_thvpll set mavaovien="+mavaovien+" where mabn='"+dr[i]["mabn"].ToString()+"' and id="+idvienphi);
					}
					if (mien+bhyt!=0 && s_sothe!="" && s_sothe.Length<=20) {upd_thvpbhyt(s_mmyy,idvienphi,s_sothe,int.Parse(dr[i]["maphu"].ToString()),get_manoigioithieu(maql),get_manoicap(maql),int.Parse(dr[i]["traituyen"].ToString()));}//dr[i]["sothe"].ToString().Trim()
					//if (s_sothe!="" && dr[i]["madoituong"].ToString()=="1") upd_thvpbhyt(s_mmyy,idvienphi,s_sothe,int.Parse(dr[i]["maphu"].ToString()),get_manoigioithieu(maql),get_manoicap(maql));//dr[i]["sothe"].ToString().Trim()
				}

				if (bKhongchiphi ||( ds.Tables[0].Rows.Count==0 && tamung>0))
				{
					i_madt=int.Parse(dr[i]["madoituong"].ToString());
					if(m_madoituong_inttrv=="" || m_madoituong_inttrv.IndexOf(","+dr[i]["madoituong"].ToString()+",")>=0)
					{
						//binh 070611: do khi chon chuyen so lieu vp, nhung khong chon het doi tuong, chi chon 1 dtuong de in (thuong in lai)
						//Khi do SL chuyen xuong vp chi chuyen doi tuong duoc chon --> do do thieu so lieu
						//
						try
						{
							r3=dtbhyt.Select("maql="+dr[i]["maql"].ToString(),"den desc");
							if (r3.Length>0)
							{
								s_sothe=r3[0]["sothe"].ToString();
							}
						}
						catch{}
						//
						updrec_ravien(ds,int.Parse(dr[i]["khu"].ToString()),dr[i]["mabn"].ToString(),dr[i]["mabn"].ToString(),long.Parse(dr[i]["maql"].ToString()),long.Parse(dr[i]["idkhoa"].ToString()),dr[i]["hoten"].ToString(),dr[i]["namsinh"].ToString(),dr[i]["phai"].ToString(),
							dr[i]["diachi"].ToString(),i_madt,s_dtuong,s_sothe,int.Parse(dr[i]["maphu"].ToString()),dr[i]["tungay"].ToString(),dr[i]["denngay"].ToString(),dr[i]["noigioithieu"].ToString(),s_dkkcb,
							dr[i]["giuong"].ToString(),makp,s_tenkp,dr[i]["ngayvao"].ToString(),dr[i]["ngayra"].ToString(),dr[i]["chandoan"].ToString(),dr[i]["maicd"].ToString(),0,
							"",0,"",0,"","",0,0,0,tamung,0,dr[i]["nguoinha"].ToString(),int.Parse(dr[i]["hinhthuc"].ToString()),int.Parse(dr[i]["phuongphap"].ToString()),int.Parse(dr[i]["ketqua"].ToString()),dr[i]["soluutru"].ToString(),
							0,dr[i]["ngaypt"].ToString(),dr[i]["tenpt"].ToString(),loaiba,int.Parse(dr[i]["done"].ToString()),dr[i]["mabs"].ToString(),dr[i]["tenbs"].ToString(),dr[i]["tenuser"].ToString(),dr[i]["image"].ToString(),dr[i]["ghichu"].ToString(),dr[i]["ngay1"].ToString(),dr[i]["ngay2"].ToString(),dr[i]["ngay3"].ToString(),(bTtngay)?dr[i]["ngayvao"].ToString():"",-1,b_sobienlaitamung,0,"","",int.Parse(dr[i]["traituyen"].ToString()),0,0,0,0,0,0,dr[i]["ngayvv"].ToString(),dr[i]["ngayrv"].ToString());
					}
				}
				ii_madoituong=int.Parse(dr[i]["madoituong"].ToString());
			}
			#region sosinh
			idkhoa=0;maql=0;idvienphi=0;maql_phongluu=0;m_madoituong_inttrv="";
			for(int i=0;i<drss.Length;i++)
			{
				//ThanhCuong-07072011-thêm m_madoituong_inttrv của sơ sinh để in chi phí
				if(drss[i]["done"].ToString()=="0"){m_madoituong_inttrv=(drss[i]["chon"].ToString().ToLower()=="true")?","+drss[i]["madoituong"].ToString()+",":",0,";}//ThanhCuong-07072011
				//
				r1=getrowbyid(dtkp,"makp='"+drss[i]["makp"].ToString()+"'");				
				i_madoituongvao=int.Parse(drss[i]["madoituongvao"].ToString());
				tamung=0;sotien=0;bhyt=0;mien=0;
				if (bndot || bKhu) idkhoa=long.Parse(drss[i]["idkhoa"].ToString());
				maql=long.Parse(drss[i]["maql"].ToString());
				if (bVienphi_phongluu) maql_phongluu=get_maql_phongluu(maql);
				else maql_phongluu=0;
				if (maql_phongluu==maql) maql_phongluu=0;
				if (drss[i]["done"].ToString()=="0"  && int.Parse(drss[i]["madoituong"].ToString())!=i_haophi)
				{
					s_idvienphi=get_id_thvp((int.Parse(drss[i]["motkhu"].ToString())==1)?0:int.Parse(drss[i]["khu"].ToString()),drss[i]["mame"].ToString(),long.Parse(drss[i]["maqlme"].ToString()),long.Parse(drss[i]["idkhoame"].ToString()),drss[i]["ngayvaome"].ToString(),drss[i]["ngayra"].ToString(),ngayserver,bTheongay);
					if (s_idvienphi=="") 
					{
						s_mmyy=mmyy_server;
						idvienphi=get_id_thvp();
					}
					else
					{
						s_mmyy=s_idvienphi.Substring(0,4);
						idvienphi=long.Parse(s_idvienphi.Substring(4));
					}
				}
				tamung=get_tamung_ct((int.Parse(drss[i]["motkhu"].ToString())==1)?0:int.Parse(drss[i]["khu"].ToString()),drss[i]["mabn"].ToString(),maql,idkhoa,drss[i]["ngayvao"].ToString(),drss[i]["ngayra"].ToString(),(makp=="")?"":drss[i]["makp"].ToString(),int.Parse(drss[i]["madoituong"].ToString()),int.Parse(drss[i]["done"].ToString()),maql_phongluu,loaiba,drss[i]["maso"].ToString(),bTheongay,ngayvaovien);
				tc_tamung+=tamung;
				if (!bBosolieuduoc)
				{
					#region Thuoc_ss
					tmp=get_thuoc_ct((int.Parse(drss[i]["motkhu"].ToString())==1)?0:int.Parse(drss[i]["khu"].ToString()),drss[i]["mabn"].ToString(),maql,idkhoa,drss[i]["ngayvao"].ToString(),drss[i]["ngayra"].ToString(),(makp=="" || r1==null)?0:int.Parse(r1["id"].ToString()),int.Parse(drss[i]["madoituong"].ToString()),int.Parse(drss[i]["done"].ToString()),maql_phongluu,bChenhlechdv,bCapve,bNgtr,loaiba,drss[i]["makp"].ToString(),0,drss[i]["maso"].ToString(),bTheongay,bThanhtoanndot,bTTRV_theokhoa,ngayvaovien);
					if (tmp!=null)
					{
						foreach(DataRow r in tmp.Rows)
						{													
							r2=getrowbyid(dtbd,"id="+int.Parse(r["mabd"].ToString()));
							if (r2!=null)
							{
								//
								if(s_mabd.IndexOf(r["mabd"].ToString()+",")<0)s_mabd+=r["mabd"].ToString()+",";
								//
								iBhyt=int.Parse(r2["bhyt"].ToString());
								DataRow rkp=getrowbyid(dtkpm,"makp='"+r["makp"].ToString()+"'");
								//if(rkp!=null)s_tenkp=rkp["ten"].ToString();
								if(rkp!=null)s_tenkp=rkp["tenkp"].ToString();//Thuy 15.02.2012
								else s_tenkp=drss[i]["tenkp"].ToString();
								s_madt=drss[i]["madoituong"].ToString().Trim();
								i_madt=int.Parse(s_madt);
								s_dtuong=drss[i]["doituong"].ToString();
								s_ten=r2["ten"].ToString();
								dongia=decimal.Parse(r["dongia"].ToString());
								dg1=dongia;dg2=0;st2=0;st1=decimal.Parse(r["sotien"].ToString());
								if (bChenhlechdv && s_madt==i_tunguyen.ToString().Trim() && chenhlech.IndexOf(i_madoituongvao.ToString().Trim()+",")!=-1 && decimal.Parse(r2["bhyt"].ToString())>0 && r["loai"].ToString().Trim()=="1" && Math.Round(decimal.Parse(r["giaban"].ToString()),2)!=Math.Round(decimal.Parse(r["giamua"].ToString()),2))
								{
									i_madt=i_madoituongvao;
									r1=getrowbyid(dtdt,"madoituong="+i_madt);
									if (r1!=null) s_dtuong=r1["doituong"].ToString();
									dg1=decimal.Parse(r["giamua"].ToString());
									st1=decimal.Parse(r["soluong"].ToString())*dg1;
								}
								else if (bDoituong_BHYT(int.Parse(s_madt),dtdt) && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))//else if (s_madt=="1" && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))
								{
									s_ten+=" BHYT thanh toán "+r2["bhyt"].ToString().Trim()+" %";
									dg1=dongia*decimal.Parse(r2["bhyt"].ToString())/100;
									st1=decimal.Parse(r["bhyt"].ToString());
								}
								dg2=0;
								if (bChenhlechdv && s_madt==i_tunguyen.ToString().Trim() && chenhlech.IndexOf(i_madoituongvao.ToString().Trim()+",")!=-1 && decimal.Parse(r2["bhyt"].ToString())>0 && r["loai"].ToString().Trim()=="1" && Math.Round(decimal.Parse(r["giaban"].ToString()),2)!=Math.Round(decimal.Parse(r["giamua"].ToString()),2))
								{
									dg2=decimal.Parse(r["giaban"].ToString())-decimal.Parse(r["giamua"].ToString());
								}
								if(m_madoituong_inttrv=="" || m_madoituong_inttrv.IndexOf(","+drss[i]["madoituong"].ToString()+",")>=0)
								{
									//binh 070611: do khi chon chuyen so lieu vp, nhung khong chon het doi tuong, chi chon 1 dtuong de in (thuong in lai)
									//Khi do SL chuyen xuong vp chi chuyen doi tuong duoc chon --> do do thieu so lieu
									//ThanhCuong-06072011-Thêm mã thẻ của trẻ em drss[i]["sothe"].ToString()
									updrec_ravien(ds,int.Parse(drss[i]["khu"].ToString()),drss[i]["mame"].ToString(),drss[i]["mabn"].ToString(),long.Parse(drss[i]["maql"].ToString()),long.Parse(drss[i]["idkhoa"].ToString()),drss[i]["hoten"].ToString(),drss[i]["namsinh"].ToString(),drss[i]["phai"].ToString(),
										drss[i]["diachi"].ToString(),i_madt,s_dtuong,drss[i]["sothe"].ToString(),iBhyt,drss[i]["tungay"].ToString(),drss[i]["denngay"].ToString(),drss[i]["noigioithieu"].ToString(),drss[i]["noicap"].ToString(),
										drss[i]["giuong"].ToString(),r["makp"].ToString()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),s_tenkp.Trim()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),drss[i]["ngayvao"].ToString(),drss[i]["ngayra"].ToString(),drss[i]["chandoan"].ToString(),drss[i]["maicd"].ToString(),int.Parse(r2["sttnhom"].ToString()),
										r2["nhom"].ToString(),int.Parse(r2["sttloai"].ToString()),r2["loai"].ToString(),int.Parse(r["mabd"].ToString()),
										s_ten,r2["dvt"].ToString(),decimal.Parse(r["soluong"].ToString()),
										st1,
										decimal.Parse(r["bhyt"].ToString()),tamung,decimal.Parse(r["bhytt0107"].ToString()),drss[i]["nguoinha"].ToString(),int.Parse(drss[i]["hinhthuc"].ToString()),int.Parse(drss[i]["phuongphap"].ToString()),int.Parse(drss[i]["ketqua"].ToString()),drss[i]["soluutru"].ToString(),
										dg1,drss[i]["ngaypt"].ToString(),drss[i]["tenpt"].ToString(),loaiba,int.Parse(drss[i]["done"].ToString()),drss[i]["mabs"].ToString(),drss[i]["tenbs"].ToString(),drss[i]["tenuser"].ToString(),drss[i]["image"].ToString(),drss[i]["ghichu"].ToString(),drss[i]["ngay1"].ToString(),drss[i]["ngay2"].ToString(),drss[i]["ngay3"].ToString(),(bTtngay)?r["ngay"].ToString():"",-1,b_sobienlaitamung,int.Parse(drss[i]["traituyen"].ToString()),dg2);
								}
								if (drss[i]["done"].ToString()=="0" && (int.Parse(drss[i]["madoituong"].ToString())!=i_haophi || (int.Parse(drss[i]["madoituong"].ToString())==i_haophi && bHaophi_vp)))
									upd_thvpct(s_mmyy,idvienphi,r["ngay"].ToString(),r["makp"].ToString(),i_madt,long.Parse(r["mabd"].ToString()),decimal.Parse(r["soluong"].ToString()),dg1,st1,0,"");

								if (bChenhlechdv && s_madt==i_tunguyen.ToString().Trim() && chenhlech.IndexOf(i_madoituongvao.ToString().Trim()+",")!=-1 && decimal.Parse(r2["bhyt"].ToString())>0 && r["loai"].ToString().Trim()=="1" && Math.Round(decimal.Parse(r["giaban"].ToString()),2)!=Math.Round(decimal.Parse(r["giamua"].ToString()),2))
								{
									//
									if(s_mabd_chenhlech.IndexOf(r["mabd"].ToString()+",")<0)s_mabd_chenhlech+=r["mabd"].ToString()+",";
									//
									i_madt=int.Parse(s_madt);
									r1=getrowbyid(dtdt,"madoituong="+i_madt);
									if (r1!=null) s_dtuong=r1["doituong"].ToString();
									s_ten+=" BN thanh toán chênh lệch ";
									dg2=decimal.Parse(r["giaban"].ToString())-decimal.Parse(r["giamua"].ToString());
									st2=decimal.Parse(r["soluong"].ToString())*dg2;
								}
								else if (bDoituong_BHYT(int.Parse(s_madt),dtdt) && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))//else if (s_madt=="1" && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))
								{
									i_madt=i_tunguyen;
									s_dtuong=s_doituong;
									s_ten=r2["ten"].ToString();
									decimal bn=100-decimal.Parse(r2["bhyt"].ToString());
									s_ten+=" BN thanh toán "+bn.ToString().Trim()+" %";
									dg2=dongia*bn/100;
									st2=decimal.Parse(r["sotien"].ToString())-decimal.Parse(r["bhyt"].ToString());
								}
								
								if (dg2>0)
								{
									if(m_madoituong_inttrv=="" || m_madoituong_inttrv.IndexOf(","+drss[i]["madoituong"].ToString()+",")>=0)
									{
										//binh 070611: do khi chon chuyen so lieu vp, nhung khong chon het doi tuong, chi chon 1 dtuong de in (thuong in lai)
										//Khi do SL chuyen xuong vp chi chuyen doi tuong duoc chon --> do do thieu so lieu
										//ThanhCuong-06072011-Thêm mã thẻ của trẻ em drss[i]["sothe"].ToString()
										updrec_ravien(ds,int.Parse(drss[i]["khu"].ToString()),drss[i]["mame"].ToString(),drss[i]["mabn"].ToString(),long.Parse(drss[i]["maql"].ToString()),long.Parse(drss[i]["idkhoa"].ToString()),drss[i]["hoten"].ToString(),drss[i]["namsinh"].ToString(),drss[i]["phai"].ToString(),
											drss[i]["diachi"].ToString(),i_madt,s_dtuong,drss[i]["sothe"].ToString(),iBhyt,drss[i]["tungay"].ToString(),drss[i]["denngay"].ToString(),drss[i]["noigioithieu"].ToString(),drss[i]["noicap"].ToString(),
											drss[i]["giuong"].ToString(),r["makp"].ToString()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),s_tenkp.Trim()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),drss[i]["ngayvao"].ToString(),drss[i]["ngayra"].ToString(),drss[i]["chandoan"].ToString(),drss[i]["maicd"].ToString(),int.Parse(r2["sttnhom"].ToString()),
											r2["nhom"].ToString(),int.Parse(r2["sttloai"].ToString()),r2["loai"].ToString(),int.Parse(r["mabd"].ToString()),
											s_ten,r2["dvt"].ToString(),decimal.Parse(r["soluong"].ToString()),
											st2,
											decimal.Parse(r["bhyt"].ToString()),tamung,decimal.Parse(r["bhytt0107"].ToString()),drss[i]["nguoinha"].ToString(),int.Parse(drss[i]["hinhthuc"].ToString()),int.Parse(drss[i]["phuongphap"].ToString()),int.Parse(drss[i]["ketqua"].ToString()),drss[i]["soluutru"].ToString(),
											dg2,drss[i]["ngaypt"].ToString(),drss[i]["tenpt"].ToString(),loaiba,int.Parse(drss[i]["done"].ToString()),drss[i]["mabs"].ToString(),drss[i]["tenbs"].ToString(),drss[i]["tenuser"].ToString(),drss[i]["image"].ToString(),drss[i]["ghichu"].ToString(),drss[i]["ngay1"].ToString(),drss[i]["ngay2"].ToString(),drss[i]["ngay3"].ToString(),(bTtngay)?r["ngay"].ToString():"",-1,b_sobienlaitamung,(r["idttrv"].ToString()!="")?long.Parse(r["idttrv"].ToString()):0,"","",int.Parse(drss[i]["traituyen"].ToString()),0,0,0);
									}
									if (drss[i]["done"].ToString()=="0"  && int.Parse(drss[i]["madoituong"].ToString())!=i_haophi)
										upd_thvpct(s_mmyy,idvienphi,r["ngay"].ToString(),r["makp"].ToString(),i_madt,long.Parse(r["mabd"].ToString()),decimal.Parse(r["soluong"].ToString()),dg2,st2,0,"");
								}
								if (drss[i]["done"].ToString()=="0" && (int.Parse(drss[i]["madoituong"].ToString())!=i_haophi || (int.Parse(drss[i]["madoituong"].ToString())==i_haophi && bHaophi_vp)))
								{
									sotien+=decimal.Parse(r["sotien"].ToString());
									bhyt+=decimal.Parse(r["bhyt"].ToString());
								}
							}
						}
					}
					#endregion Thuoc_ss
				}
				#region  Vienphi_ss
				tmp=get_vienphi_ct((int.Parse(drss[i]["motkhu"].ToString())==1)?0:int.Parse(drss[i]["khu"].ToString()),drss[i]["mabn"].ToString(),maql,idkhoa,drss[i]["ngayvao"].ToString(),drss[i]["ngayra"].ToString(),(makp=="")?"":drss[i]["makp"].ToString(),int.Parse(drss[i]["madoituong"].ToString()),int.Parse(drss[i]["done"].ToString()),maql_phongluu,bCapve,bNgtr,loaiba,makp_rv,0,drss[i]["maso"].ToString(),bTheongay,bThanhtoanndot,bTTRV_theokhoa,ngayvaovien);
				if (tmp!=null)
				{
					//					tmp.DataSet.WriteXml("vienphixml.xml",XmlWriteMode.WriteSchema);
					foreach(DataRow r in tmp.Rows)
					{
						DataRow rkp=getrowbyid(dtkpm,"makp='"+r["makp"].ToString()+"'");
						//if(rkp!=null)s_tenkp=rkp["ten"].ToString();
						if(rkp!=null)s_tenkp=rkp["tenkp"].ToString();//Thuy 15.02.2012
						else s_tenkp=drss[i]["tenkp"].ToString();
						r2=getrowbyid(dtvp,"id="+int.Parse(r["mavp"].ToString()));
						if (r2!=null)
						{
							iBhyt=int.Parse(r2["bhyt"].ToString());
							s_madt=drss[i]["madoituong"].ToString();
							i_madt=int.Parse(s_madt);
							s_dtuong=drss[i]["doituong"].ToString();
							s_ten=r2["ten"].ToString();
							f1="th";f2="th";
							//
							dongia=decimal.Parse(r["dongia"].ToString());
							dg1=dongia;dg2=0;st2=0;st1=decimal.Parse(r["sotien"].ToString());
							r1=getrowbyid(dtdt,"madoituong in("+sMaDoituong_BHYT().Trim().Trim(',')+")");//r1=getrowbyid(dtdt,"madoituong=1");
							if (r1!=null) f1=r1["field_gia"].ToString().Trim().Substring(r1["field_gia"].ToString().Trim().IndexOf("_")+1);
							r1=getrowbyid(dtdt,"madoituong="+i_madt);
							if (r1!=null) f2=r1["field_gia"].ToString().Trim().Substring(r1["field_gia"].ToString().Trim().IndexOf("_")+1);
							if (bChenhlechdv && s_madt==i_tunguyen.ToString().Trim() && chenhlech.IndexOf(i_madoituongvao.ToString().Trim()+",")!=-1 && decimal.Parse(r2["bhyt"].ToString())>0 && decimal.Parse(r2["gia_"+f1.Trim()].ToString())<=decimal.Parse(r2["gia_"+f2.Trim()].ToString()))
							{
								i_madt=i_madoituongvao;
								r1=getrowbyid(dtdt,"madoituong="+i_madt);
								if (r1!=null) s_dtuong=r1["doituong"].ToString();
								dg1=decimal.Parse(r2["gia_"+f1.Trim()].ToString())+decimal.Parse(r2["vattu_"+f1.Trim()].ToString());
								st1=decimal.Parse(r["soluong"].ToString())*dg1;
							}
							else if (bDoituong_BHYT(int.Parse(s_madt),dtdt) && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))//else if (s_madt=="1" && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))
							{
								s_ten+=" BHYT thanh toán "+r2["bhyt"].ToString().Trim()+" %";
								dg1=dongia*decimal.Parse(r2["bhyt"].ToString())/100;
								st1=decimal.Parse(r["bhyt"].ToString());
							}	
							//
							dg2=0;
							if (bChenhlechdv && s_madt==i_tunguyen.ToString().Trim() && chenhlech.IndexOf(i_madoituongvao.ToString().Trim()+",")!=-1 && decimal.Parse(r2["bhyt"].ToString())>0 && decimal.Parse(r2["gia_"+f1.Trim()].ToString())<decimal.Parse(r2["gia_"+f2.Trim()].ToString()))
							{
								dg2=decimal.Parse(r2["gia_"+f2.Trim()].ToString())+decimal.Parse(r2["vattu_"+f2.Trim()].ToString())-dg1;
							}
							else if (bDoituong_BHYT(int.Parse(s_madt),dtdt) && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))//else if (s_madt=="1" && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))
							{
								decimal bn2=100-decimal.Parse(r2["bhyt"].ToString());
								dg2=dongia*bn2/100;
							}
							//
							if(m_madoituong_inttrv=="" || m_madoituong_inttrv.IndexOf(","+drss[i]["madoituong"].ToString()+",")>=0)
							{
								//binh 070611: do khi chon chuyen so lieu vp, nhung khong chon het doi tuong, chi chon 1 dtuong de in (thuong in lai)
								//Khi do SL chuyen xuong vp chi chuyen doi tuong duoc chon --> do do thieu so lieu
								//ThanhCuong-06072011-Thêm mã thẻ của trẻ em drss[i]["sothe"].ToString()
								updrec_ravien(ds,int.Parse(drss[i]["khu"].ToString()),drss[i]["mame"].ToString(),drss[i]["mabn"].ToString(),long.Parse(drss[i]["maql"].ToString()),long.Parse(drss[i]["idkhoa"].ToString()),drss[i]["hoten"].ToString(),drss[i]["namsinh"].ToString(),drss[i]["phai"].ToString(),
									drss[i]["diachi"].ToString(),i_madt,s_dtuong,drss[i]["sothe"].ToString(),iBhyt,drss[i]["tungay"].ToString(),drss[i]["denngay"].ToString(),drss[i]["noigioithieu"].ToString(),drss[i]["noicap"].ToString(),
									drss[i]["giuong"].ToString(),r["makp"].ToString()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),s_tenkp.Trim()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),drss[i]["ngayvao"].ToString(),drss[i]["ngayra"].ToString(),drss[i]["chandoan"].ToString(),drss[i]["maicd"].ToString(),int.Parse(r2["sttnhom"].ToString()),
									r2["nhom"].ToString(),int.Parse(r2["sttloai"].ToString()),r2["loai"].ToString(),int.Parse(r["mavp"].ToString()),
									s_ten,r2["dvt"].ToString(),decimal.Parse(r["soluong"].ToString()),
									st1,
									decimal.Parse(r["bhyt"].ToString()),tamung,decimal.Parse(r["bhytt0107"].ToString()),drss[i]["nguoinha"].ToString(),int.Parse(drss[i]["hinhthuc"].ToString()),int.Parse(drss[i]["phuongphap"].ToString()),int.Parse(drss[i]["ketqua"].ToString()),drss[i]["soluutru"].ToString(),
									dg1,drss[i]["ngaypt"].ToString(),drss[i]["tenpt"].ToString(),loaiba,int.Parse(drss[i]["done"].ToString()),drss[i]["mabs"].ToString(),drss[i]["tenbs"].ToString(),drss[i]["tenuser"].ToString(),drss[i]["image"].ToString(),drss[i]["ghichu"].ToString(),drss[i]["ngay1"].ToString(),drss[i]["ngay2"].ToString(),drss[i]["ngay3"].ToString(),(bTtngay)?r["ngay"].ToString():"",-1,b_sobienlaitamung,int.Parse(drss[i]["traituyen"].ToString()),dg2);
							}
							if (drss[i]["done"].ToString()=="0" && (int.Parse(drss[i]["madoituong"].ToString())!=i_haophi || (int.Parse(drss[i]["madoituong"].ToString())==i_haophi && bHaophi_vp)))
								upd_thvpct(s_mmyy,idvienphi,r["ngay"].ToString(),r["makp"].ToString(),i_madt,long.Parse(r["mavp"].ToString()),decimal.Parse(r["soluong"].ToString()),dg1,st1,decimal.Parse(r["vattu"].ToString()),"");
							
							//
							dg2=0;
							if (bChenhlechdv && s_madt==i_tunguyen.ToString().Trim() && chenhlech.IndexOf(i_madoituongvao.ToString().Trim()+",")!=-1 && decimal.Parse(r2["bhyt"].ToString())>0 && decimal.Parse(r2["gia_"+f1.Trim()].ToString())<decimal.Parse(r2["gia_"+f2.Trim()].ToString()))
							{
								i_madt=int.Parse(s_madt);
								r1=getrowbyid(dtdt,"madoituong="+i_madt);
								if (r1!=null) s_dtuong=r1["doituong"].ToString();
								s_ten+=" BN thanh toán chênh lệch ";
								dg2=decimal.Parse(r2["gia_"+f2.Trim()].ToString())+decimal.Parse(r2["vattu_"+f2.Trim()].ToString())-dg1;
								st2=decimal.Parse(r["soluong"].ToString())*dg2;
							}
							else if (bDoituong_BHYT(int.Parse(s_madt),dtdt) && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))//else if (s_madt=="1" && decimal.Parse(r["sotien"].ToString())!=decimal.Parse(r["bhyt"].ToString()))
							{
								s_ten=r2["ten"].ToString();
								decimal bn=100-decimal.Parse(r2["bhyt"].ToString());
								s_ten+=" BN thanh toán "+bn.ToString().Trim()+" %";
								dg2=dongia*bn/100;
								st2=decimal.Parse(r["sotien"].ToString())-decimal.Parse(r["bhyt"].ToString());
							}
							if (dg2>0)
							{
								if(m_madoituong_inttrv=="" || m_madoituong_inttrv.IndexOf(","+drss[i]["madoituong"].ToString()+",")>=0)
								{
									//binh 070611: do khi chon chuyen so lieu vp, nhung khong chon het doi tuong, chi chon 1 dtuong de in (thuong in lai)
									//Khi do SL chuyen xuong vp chi chuyen doi tuong duoc chon --> do do thieu so lieu
									//ThanhCuong-06072011-Thêm mã thẻ của trẻ em drss[i]["sothe"].ToString()
									updrec_ravien(ds,int.Parse(drss[i]["khu"].ToString()),drss[i]["mame"].ToString(),drss[i]["mabn"].ToString(),long.Parse(drss[i]["maql"].ToString()),long.Parse(drss[i]["idkhoa"].ToString()),drss[i]["hoten"].ToString(),drss[i]["namsinh"].ToString(),drss[i]["phai"].ToString(),
										drss[i]["diachi"].ToString(),i_madt,s_dtuong,drss[i]["sothe"].ToString(),iBhyt,drss[i]["tungay"].ToString(),drss[i]["denngay"].ToString(),drss[i]["noigioithieu"].ToString(),drss[i]["noicap"].ToString(),
										drss[i]["giuong"].ToString(),r["makp"].ToString()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),s_tenkp.Trim()+ ((bTtngay) ? " : " + r["ngay"].ToString() : ""),drss[i]["ngayvao"].ToString(),drss[i]["ngayra"].ToString(),drss[i]["chandoan"].ToString(),drss[i]["maicd"].ToString(),int.Parse(r2["sttnhom"].ToString()),
										r2["nhom"].ToString(),int.Parse(r2["sttloai"].ToString()),r2["loai"].ToString(),int.Parse(r["mavp"].ToString()),
										s_ten,r2["dvt"].ToString(),decimal.Parse(r["soluong"].ToString()),
										st2,
										decimal.Parse(r["bhyt"].ToString()),tamung,decimal.Parse(r["bhytt0107"].ToString()),drss[i]["nguoinha"].ToString(),int.Parse(drss[i]["hinhthuc"].ToString()),int.Parse(drss[i]["phuongphap"].ToString()),int.Parse(drss[i]["ketqua"].ToString()),drss[i]["soluutru"].ToString(),
										dg2,drss[i]["ngaypt"].ToString(),drss[i]["tenpt"].ToString(),loaiba,int.Parse(drss[i]["done"].ToString()),drss[i]["mabs"].ToString(),drss[i]["tenbs"].ToString(),drss[i]["tenuser"].ToString(),drss[i]["image"].ToString(),drss[i]["ghichu"].ToString(),drss[i]["ngay1"].ToString(),drss[i]["ngay2"].ToString(),drss[i]["ngay3"].ToString(),(bTtngay)?r["ngay"].ToString():"",-1,b_sobienlaitamung,(r["idttrv"].ToString()!="")?long.Parse(r["idttrv"].ToString()):0,"","",int.Parse(drss[i]["traituyen"].ToString()),0,0,-1);
								}
								if (drss[i]["done"].ToString()=="0"  && int.Parse(drss[i]["madoituong"].ToString())!=i_haophi)
									upd_thvpct(s_mmyy,idvienphi,r["ngay"].ToString(),r["makp"].ToString(),i_madt,long.Parse(r["mavp"].ToString()),decimal.Parse(r["soluong"].ToString()),dg2,st2,decimal.Parse(r["vattu"].ToString()),"");
							}
							if (drss[i]["done"].ToString()=="0" && (int.Parse(drss[i]["madoituong"].ToString())!=i_haophi || (int.Parse(drss[i]["madoituong"].ToString())==i_haophi && bHaophi_vp)))
							{									
								sotien+=decimal.Parse(r["sotien"].ToString());
								bhyt+=decimal.Parse(r["bhyt"].ToString());
							}
						}
					}
				}
				#endregion Vienphi_ss
				if (drss[i]["done"].ToString()=="0" && ((bHaophi_vienphi==false && int.Parse(drss[i]["madoituong"].ToString())!=i_haophi)||bHaophi_vienphi==true) )//&& int.Parse(drss[i]["madoituong"].ToString())!=i_haophi)
				{
					if (bDoituong_BHYT(int.Parse(drss[i]["madoituong"].ToString()),dtdt))//if (drss[i]["madoituong"].ToString()=="1") //bhyt
					{
						if (drss[i]["maphu"].ToString()=="0") // Ko cung chi tra
						{
							bhyt=sotien;sotien=0;
						}
						else sotien=sotien-bhyt;
					}
					else if (mien_doituong(int.Parse(drss[i]["madoituong"].ToString()),dtdt)) //mien
					{
						mien=sotien;sotien=0;bhyt=0;
					}
					else bhyt=0;
					if (get_data("select * from "+user+s_mmyy+".v_thvpll where id="+idvienphi).Tables[0].Rows.Count==0)
						upd_thvpll(s_mmyy,idvienphi,drss[i]["mame"].ToString(),long.Parse(drss[i]["maqlme"].ToString()),long.Parse(drss[i]["idkhoame"].ToString()),drss[i]["ngayvaome"].ToString(),drss[i]["ngayrame"].ToString(),drss[i]["giuong"].ToString(),drss[i]["makpme"].ToString(),drss[i]["chandoanme"].ToString(),drss[i]["maicdme"].ToString(),sotien,tamung,bhyt,mien,int.Parse(drss[i]["khu"].ToString()));
					else execute_data("update "+user+s_mmyy+".v_thvpll set sotien=sotien+"+sotien+",bhyt=bhyt+"+bhyt+",mien=mien+"+mien+",tamung=tamung+"+tamung+" where id="+idvienphi);
				}
			}
			#endregion
			//ds.WriteXml("xx.xml",XmlWriteMode.WriteSchema);
			if (ds.Tables[0].Rows.Count==0 && tamung>0)
			{
				for(int i=0;i<dr.Length;i++)
				{
					if(m_madoituong_inttrv=="" || m_madoituong_inttrv.IndexOf(","+dr[i]["madoituong"].ToString()+",")>=0)
					{
						//binh 070611: do khi chon chuyen so lieu vp, nhung khong chon het doi tuong, chi chon 1 dtuong de in (thuong in lai)
						//Khi do SL chuyen xuong vp chi chuyen doi tuong duoc chon --> do do thieu so lieu
						//
						updrec_ravien(ds,int.Parse(dr[i]["khu"].ToString()),dr[i]["mabn"].ToString(),dr[i]["mabn"].ToString(),long.Parse(dr[i]["maql"].ToString()),long.Parse(dr[i]["idkhoa"].ToString()),dr[i]["hoten"].ToString(),dr[i]["namsinh"].ToString(),dr[i]["phai"].ToString(),
							dr[i]["diachi"].ToString(),i_madt,s_dtuong,dr[i]["sothe"].ToString(),int.Parse(dr[i]["maphu"].ToString()),dr[i]["tungay"].ToString(),dr[i]["denngay"].ToString(),dr[i]["noigioithieu"].ToString(),s_dkkcb,
							dr[i]["giuong"].ToString(),makp,s_tenkp,dr[i]["ngayvao"].ToString(),dr[i]["ngayra"].ToString(),dr[i]["chandoan"].ToString(),dr[i]["maicd"].ToString(),0,
							"",0,"",0,"","",0,0,0,tamung,0,dr[i]["nguoinha"].ToString(),int.Parse(dr[i]["hinhthuc"].ToString()),int.Parse(dr[i]["phuongphap"].ToString()),int.Parse(dr[i]["ketqua"].ToString()),dr[i]["soluutru"].ToString(),
							0,dr[i]["ngaypt"].ToString(),dr[i]["tenpt"].ToString(),loaiba,int.Parse(dr[i]["done"].ToString()),dr[i]["mabs"].ToString(),dr[i]["tenbs"].ToString(),dr[i]["tenuser"].ToString(),dr[i]["image"].ToString(),dr[i]["ghichu"].ToString(),dr[i]["ngay1"].ToString(),dr[i]["ngay2"].ToString(),dr[i]["ngay3"].ToString(),(bTtngay)?dr[i]["ngayvao"].ToString():"",-1,b_sobienlaitamung,0,"","",int.Parse(dr[i]["traituyen"].ToString()),0,0,0);
					}
				}
			}
			if(bMau38_Full)
			{
				DataSet ads1=get_data("select stt, ma, ten from "+user+".v_nhomvp ");			
				foreach(DataRow adr in ads1.Tables[0].Rows)
				{
					for(int i=0;i<dr.Length;i++)
					{
						DataRow []a_dr=ds.Tables[0].Select("madoituong="+dr[i]["madoituong"].ToString());
						if(a_dr.Length>0)
						{
							string s_exp=" madoituong="+dr[i]["madoituong"].ToString()+" and sttnhom="+adr["stt"].ToString();
							DataRow adr1=getrowbyid(ds.Tables[0],s_exp);
							if(adr1==null)
							{
								if(m_madoituong_inttrv=="" || m_madoituong_inttrv.IndexOf(","+dr[i]["madoituong"].ToString()+",")>=0)
								{
									//binh 070611: do khi chon chuyen so lieu vp, nhung khong chon het doi tuong, chi chon 1 dtuong de in (thuong in lai)
									//Khi do SL chuyen xuong vp chi chuyen doi tuong duoc chon --> do do thieu so lieu
									//
									updrec_ravien(ds,int.Parse(dr[i]["khu"].ToString()),dr[i]["mabn"].ToString(),dr[i]["mabn"].ToString(),long.Parse(dr[i]["maql"].ToString()),long.Parse(dr[i]["idkhoa"].ToString()),dr[i]["hoten"].ToString(),dr[i]["namsinh"].ToString(),dr[i]["phai"].ToString(),
										dr[i]["diachi"].ToString(),int.Parse(dr[i]["madoituong"].ToString()),dr[i]["doituong"].ToString(),dr[i]["sothe"].ToString(),int.Parse(dr[i]["maphu"].ToString()),dr[i]["tungay"].ToString(),dr[i]["denngay"].ToString(),dr[i]["noigioithieu"].ToString(),s_dkkcb,
										dr[i]["giuong"].ToString(),makp,s_tenkp,dr[i]["ngayvao"].ToString(),dr[i]["ngayra"].ToString(),dr[i]["chandoan"].ToString(),dr[i]["maicd"].ToString(),int.Parse(adr["stt"].ToString()),
										adr["ten"].ToString(),0,"",0,"","",0,0,0,0,0,dr[i]["nguoinha"].ToString(),int.Parse(dr[i]["hinhthuc"].ToString()),int.Parse(dr[i]["phuongphap"].ToString()),int.Parse(dr[i]["ketqua"].ToString()),dr[i]["soluutru"].ToString(),
										0,dr[i]["ngaypt"].ToString(),dr[i]["tenpt"].ToString(),loaiba,int.Parse(dr[i]["done"].ToString()),dr[i]["mabs"].ToString(),dr[i]["tenbs"].ToString(),dr[i]["tenuser"].ToString(),dr[i]["image"].ToString(),dr[i]["ghichu"].ToString(),dr[i]["ngay1"].ToString(),dr[i]["ngay2"].ToString(),dr[i]["ngay3"].ToString(),(bTtngay)?dr[i]["ngayvao"].ToString():"",-1,b_sobienlaitamung,0,"","",int.Parse(dr[i]["traituyen"].ToString()),0,0,0);
								}
							}
						}
					}
				}
			}
			if (ngia)
			{
				foreach(DataRow r in dtbd.Select("id in ("+(s_mabd.Trim().Trim(',')==""?"0":s_mabd.Trim().Trim(','))+")"))//foreach(DataRow r in dtbd.Rows)
				{
					r1=getrowbyid(dtvp,"id="+long.Parse(r["id"].ToString()));
					if (r1==null)
					{
						r2=dtvp.NewRow();
						r2["id"]=r["id"].ToString();
						r2["ma"]=r["ma"].ToString();
						r2["ten"]=r["ten"].ToString();
						r2["dvt"]=r["dvt"].ToString();
						r2["sttloai"]=r["sttloai"].ToString();
						r2["loai"]=r["loai"].ToString();
						r2["sttnhom"]=r["sttnhom"].ToString();
						r2["nhom"]=r["nhom"].ToString();
						r2["bhyt"]=r["bhyt"].ToString();
						r2["gia_th"]=r2["gia_bh"]=r2["gia_dv"]=r2["gia_nn"]=r2["gia_cs"]=r["gia_bh"].ToString();
						r2["vattu_th"]=r2["vattu_bh"]=r2["vattu_dv"]=r2["vattu_nn"]=r2["vattu_cs"]=0;
						r2["kythuat"]=r["kythuat"].ToString();
						if(s_mabd_chenhlech.IndexOf(r["id"].ToString()+",")<0)r2["chenhlech"]=0;
						else r2["chenhlech"]=1;
						r2["vuottuyen"]=-1;
						dtvp.Rows.Add(r2);
					}
				}
			}
			
			//ds.WriteXml("xx.xml",XmlWriteMode.WriteSchema);
			return sort_ttravien_ct(mmyy_server,ngayserver,loaiba,dtdt,ds.Tables[0].Select("true","khu,matt,mabn,sothe,madoituong,yyyymmdd,sttnhom,tenkp,ten"),makp_rv,ngia,dtvp,ds.Tables[0],i_madoituongvao,tNgaydt);//,ten"));
		}


		
		private decimal get_bhyt(DataTable dt,long mabd,string ngay)
		{
			decimal ret=0;ngay=ngay.Substring(6,4)+ngay.Substring(3,2)+ngay.Substring(0,2);
			sql="id="+mabd+" and loai=1 and ngay<="+ngay;
			DataRow [] dr=dt.Select(sql,"ngaygio");
			if (dr.Length>0) ret=decimal.Parse(dr[0]["bhyt"].ToString());
			else
			{
				sql="id="+mabd+" and loai=0";
				dr=dt.Select(sql,"ngaygio desc");
				for(int i=0;i<dr.Length;i++)
				{
					if (long.Parse(dr[i]["ngay"].ToString())<=long.Parse(ngay))
					{
						ret=decimal.Parse(dr[i]["bhyt"].ToString());
						break;
					}
				}
			}
			return ret;
		}
		#region cao vu 31/05/2013
		public string get_mavaovien_noitru(string mabn,string ngaygiovaovien)
		{
			string sMavaovien="";
			try
			{
				sMavaovien=get_data("select mavaovien from benhandt where mabn='"+mabn
					+"' and to_date(to_char(ngay,'dd/mm/yyyy hh24:mi'),'dd/mm/yyyy hh24:mi')"
					+" = to_date('"+ngaygiovaovien+"','dd/mm/yyyy hh24:mi') order by ngay desc").Tables[0].Rows[0][0].ToString();
			}
			catch{}
			return sMavaovien;
		}
		public string get_mavaovien_noitru(string maql)
		{
			string sMavaovien="";
			try
			{
				sMavaovien=get_data("select mavaovien from benhandt where maql="+maql).Tables[0].Rows[0][0].ToString();
			}
			catch{}
			return sMavaovien;
		}
		#endregion
		private DataTable get_thuoc_ct(int khu,string mabn,long maql,long idkhoa
			,string tu,string den,int makp,int madoituong,int done
			,long maql_phongluu,bool bChenhlechdv,bool bCapve,bool bNgtr
			,int loaiba,string smakp,long mavaovien,string maso,bool bTheongay
			, bool bTTRV_Ndot, bool bTTRV_Theokhoa,string ngayvaovien)
		{	
			#region cao vu 30/05/2013
			
			string sMavaovien="";
			if(bVP_ChuyenPhongKham_NoiTru)
			{
				sMavaovien=get_mavaovien_noitru(mabn,ngayvaovien);
				//sMavaovien=get_mavaovien(maql).ToString();
			}
			#endregion
			//linh lam tron số lẻ
			DataSet dst=new DataSet();
			bool bPL_capve=bCapve_Phongluu;
			bool bPK_capve=bBHYTngtr_noitru;			
			DateTime dt1=StringToDate(tu).AddDays(-iNgaykiemke);
			DateTime dt2=StringToDate(den).AddDays(iNgaykiemke);
			int y1=dt1.Year,m1=dt1.Month;
			int y2=dt2.Year,m2=dt2.Month;
			int itu,iden,be=0;
			string mmyy="",xxx,ngayvaoPL="";
			bool b701424=Mabv_so==701424;
			bool bLamtron=bThanhtoan_tronsoluong;
			if (maso!="" && maql_phongluu!=0) {maso=maso.Replace(maql_phongluu.ToString()+",","");}
			if (maql_phongluu!=0)
			{
				foreach(DataRow row in get_data("select to_char(ngay,'dd/mm/yyyy hh24:mi') as ngayvao from benhandt where maql in ("+maql_phongluu+") and loaiba=4").Tables[0].Rows)
				{
					ngayvaoPL=row["ngayvao"].ToString();
					break;
				}
			}
			for(int i=y1;i<=y2;i++)
			{
				itu=(i==y1)?m1:1;
				iden=(i==y2)?m2:12;
				for(int j=itu;j<=iden;j++)
				{
					mmyy=j.ToString().PadLeft(2,'0')+i.ToString().Substring(2,2);
					xxx=user+"d"+mmyy;
					if (dbMmyy(mmyy))
					{
						#region tienthuoc
						if (loaiba==2 && b701424) b701424=true;
						else
						{
							sql="select a.idttrv,to_char(a.ngay,'yymmdd') yymmdd,";
							if (bChenhlechdv && !bGia_bh_quydinh) sql+="c.loai,round(decode(x.giaban,0,a.giamua,b.giaban),"+i_Soledongiakhithanhtoan.ToString()+") giamua,round(a.giaban,"+i_Soledongiakhithanhtoan.ToString()+") giaban,";
							else if (bChenhlechdv && bGia_bh_quydinh) sql+="c.loai,round(decode(x.giaban,0,b.gia_bh,b.giaban),"+i_Soledongiakhithanhtoan.ToString()+") giamua,round(a.giaban,"+i_Soledongiakhithanhtoan.ToString()+") as giaban,";
							else sql+="0 as loai,0 as giamua,0 as giaban,";
							sql+="to_char(a.ngay,'dd/mm/yyyy') ngay,";
							sql+="case when d.makp is null then '"+smakp+"' else d.makp end as makp,";
							sql+="a.mabd,round(decode(c.loai,0,decode(x.giaban,0,a.giamua,b.giaban),a.giaban),"+i_Soledongiakhithanhtoan.ToString()+") as dongia,";
							if (bLamtron)
							{
								sql+="sum(decode(b.lamtron,1,ceil(a.soluong),a.soluong)) as soluong,";
								sql+="sum(case when c.loai=0 then decode(b.lamtron,1,ceil(a.soluong),a.soluong)*round(decode(x.giaban,0,a.giamua,b.giaban),"+i_Soledongiakhithanhtoan.ToString()+") else decode(b.lamtron,1,ceil(a.soluong),a.soluong)*round(a.giaban,"+i_Soledongiakhithanhtoan.ToString()+") end) sotien,";
								sql+="sum(0) bhytt0107,";
								sql+="sum(case when c.loai=0 then ";
								sql+="case when a.madoituong=1 or y.bhyt=1 then decode(b.lamtron,1,ceil(a.soluong),a.soluong)*round(decode(x.giaban,0,a.giamua,b.giaban),"+i_Soledongiakhithanhtoan.ToString()+")*b.bhyt/100 else 0 end ";
								sql+="else case when a.madoituong=1 or y.bhyt=1 then decode(b.lamtron,1,ceil(a.soluong),a.soluong)*round(a.giaban,"+i_Soledongiakhithanhtoan.ToString()+")*b.bhyt/100 else 0 end  end) bhyt";
							}
							else
							{
								sql+="sum(a.soluong) soluong,sum(case when c.loai=0 then a.soluong*round(decode(x.giaban,0,a.giamua,b.giaban),"+i_Soledongiakhithanhtoan.ToString()+") else a.soluong*round(a.giaban,"+i_Soledongiakhithanhtoan.ToString()+") end) sotien,";
								sql+="sum(0) bhytt0107,";
								sql+="sum(case when c.loai=0 then ";
								sql+="case when a.madoituong=1 or y.bhyt=1 then a.soluong*round(decode(x.giaban,0,a.giamua,b.giaban),"+i_Soledongiakhithanhtoan.ToString()+")*b.bhyt/100 else 0 end ";
								sql+="else case when a.madoituong=1 or y.bhyt=1 then a.soluong*round(a.giaban,"+i_Soledongiakhithanhtoan.ToString()+")*b.bhyt/100 else 0 end  end) bhyt";
							}
							sql+=", case when a.kythuat=-2 then b.kythuat else a.kythuat end as kythuat,a.id_ktcao ";//binh 280611
							sql+=" from "+xxx+".d_tienthuoc a,"+userid+".d_dmbd b,"+userid+".d_doituong c,"+userid+".d_duockp d,"+userid+".btdkp_bv e,"+user+".d_dmnhom x, "+user+".doituong y ";
							sql+=" where a.mabd=b.id and b.manhom=x.id and a.madoituong=c.madoituong and a.madoituong=y.madoituong and a.makp=d.id(+) and d.makp=e.makp(+) and a.mabn='"+mabn+"'";
							if (loaiba==2)
							{
								sql+=" and a.maql<>"+maql_phongluu+" and to_date(a.ngay,'dd/mm/yy') between to_date('"+tu.Substring(0,10)+"','dd/mm/yy') and to_date('"+den.Substring(0,10)+"','dd/mm/yy')";
							}
							else if (idkhoa!=0 && bTTRV_Theokhoa) 
							{
								sql+=" and a.idkhoa="+idkhoa;
								sql+=" and to_date(a.ngay,'dd/mm/yy') between to_date('"+tu.Substring(0,10)+"','dd/mm/yy') and to_date('"+den.Substring(0,10)+"','dd/mm/yy')";
							}
							else if(bTTRV_Ndot)
							{
								sql+=" and to_date(a.ngay,'dd/mm/yy') between to_date('"+tu.Substring(0,10)+"','dd/mm/yy') and to_date('"+den.Substring(0,10)+"','dd/mm/yy')";
							}
							if (bTheongay) sql+=" and to_date(a.ngay,'dd/mm/yy') between to_date('"+tu.Substring(0,10)+"','dd/mm/yy') and to_date('"+den.Substring(0,10)+"','dd/mm/yy')";
							#region cao vu 30/05/2013
							if(sMavaovien!="")
							{
								sql+=" and a.mavaovien in ("+sMavaovien.Trim(',')+")";
							}
							else
							{
								if (maso!="") sql+=" and a.maql in ("+maso.Substring(0,maso.Trim().Length-1)+")";
								else sql+=" and a.maql="+maql;
							}
							
							#endregion
							sql+=" and a.madoituong="+madoituong;
								
							if (done == 0 || done == 2) sql += " and (a.done=0 and a.idttrv=0)";
							else if (done == 1) sql += " and a.done=" + done;

							if (makp!=0) sql+=" and a.makp="+makp;
							if (khu!=0) sql+=" and e.khu="+khu;
							sql+=" group by a.idttrv,to_char(a.ngay,'yymmdd'),";
							if (bChenhlechdv && !bGia_bh_quydinh) sql+="c.loai,round(decode(x.giaban,0,a.giamua,b.giaban),"+i_Soledongiakhithanhtoan.ToString()+"),round(a.giaban,"+i_Soledongiakhithanhtoan.ToString()+"),";
							else if (bChenhlechdv && bGia_bh_quydinh) sql+="c.loai,round(decode(x.giaban,0,b.gia_bh,b.giaban),"+i_Soledongiakhithanhtoan.ToString()+"),round(a.giaban,"+i_Soledongiakhithanhtoan.ToString()+"),";
							else sql+="0,0,0,";
							sql+="to_char(a.ngay,'dd/mm/yyyy'),";
							sql+="case when d.makp is null then '"+smakp+"' else d.makp end,";
							sql+="a.mabd,round(decode(c.loai,0,decode(x.giaban,0,a.giamua,b.giaban),a.giaban),"+i_Soledongiakhithanhtoan.ToString()+")";
							sql+=", case when a.kythuat=-2 then b.kythuat else a.kythuat end,a.id_ktcao ";//binh 280611
							if (be==0 || dst==null) dst=get_data(sql);
							else 
							{
								DataSet dstmp=get_data(sql);
								if(dstmp!=null)
								{
									dst.Merge(dstmp);
								}
							}
							be++;
							if (maql_phongluu!=0 && !bPhongluu && be<=1)// && loaiba!=2)
							{
								sql="select a.idttrv,to_char(a.ngay,'yymmdd') yymmdd,";
								if (bChenhlechdv && !bGia_bh_quydinh) sql+="c.loai,round(decode(x.giaban,0,a.giamua,b.giaban),"+i_Soledongiakhithanhtoan.ToString()+") giamua,round(a.giaban,"+i_Soledongiakhithanhtoan.ToString()+") as giaban,";
								else if (bChenhlechdv && bGia_bh_quydinh) sql+="c.loai,round(decode(x.giaban,0,b.gia_bh,b.giaban),"+i_Soledongiakhithanhtoan.ToString()+") giamua,round(a.giaban,"+i_Soledongiakhithanhtoan.ToString()+") as giaban,";
								else sql+="0 as loai,0 as giamua,0 as giaban,";
								sql+="to_char(a.ngay,'dd/mm/yyyy') ngay,";
								sql+="case when d.makp is null then '"+smakp+"' else d.makp end as makp,";
								sql+="a.mabd,round(decode(c.loai,0,decode(x.giaban,0,a.giamua,b.giaban),a.giaban),"+i_Soledongiakhithanhtoan.ToString()+") as dongia,";
								if (bLamtron)
								{
									sql+="sum(decode(b.lamtron,1,ceil(a.soluong),a.soluong)) as soluong,";
									sql+="sum(case when c.loai=0 then decode(b.lamtron,1,ceil(a.soluong),a.soluong)*round(decode(x.giaban,0,a.giamua,b.giaban),"+i_Soledongiakhithanhtoan.ToString()+") else decode(b.lamtron,1,ceil(a.soluong),a.soluong)*round(a.giaban,"+i_Soledongiakhithanhtoan.ToString()+") end) sotien,";
									sql+="sum(0) bhytt0107,";
									sql+="sum(case when c.loai=0 then ";
									sql+="case when a.madoituong=1 or y.bhyt=1 then decode(b.lamtron,1,ceil(a.soluong),a.soluong)*round(decode(x.giaban,0,a.giamua,b.giaban),"+i_Soledongiakhithanhtoan.ToString()+")*b.bhyt/100 else 0 end ";
									sql+="else case when a.madoituong=1 or y.bhyt=1 then decode(b.lamtron,1,ceil(a.soluong),a.soluong)*round(a.giaban,"+i_Soledongiakhithanhtoan.ToString()+")*b.bhyt/100 else 0 end  end) bhyt";
								}
								else
								{
									sql+="sum(a.soluong) soluong,sum(case when c.loai=0 then a.soluong*round(decode(x.giaban,0,a.giamua,b.giaban),"+i_Soledongiakhithanhtoan.ToString()+") else a.soluong*round(a.giaban,"+i_Soledongiakhithanhtoan.ToString()+") end) sotien,";
									sql+="sum(0) bhytt0107,";
									sql+="sum(case when c.loai=0 then ";
									sql+="case when a.madoituong=1 or y.bhyt=1  then a.soluong*round(decode(x.giaban,0,a.giamua,b.giaban),"+i_Soledongiakhithanhtoan.ToString()+")*b.bhyt/100 else 0 end ";
									sql+="else case when a.madoituong=1 or y.bhyt=1 then a.soluong*round(a.giaban,"+i_Soledongiakhithanhtoan.ToString()+")*b.bhyt/100 else 0 end  end) bhyt";
								}
								sql+=", case when a.kythuat=-2 then b.kythuat else a.kythuat end as kythuat,a.id_ktcao ";//binh 280611
								sql+=" from xxx.d_tienthuoc a,"+userid+".d_dmbd b,"+userid+".d_doituong c,"+userid+".d_duockp d,"+userid+".btdkp_bv e,"+user+".d_dmnhom x, "+user+".doituong y  where a.mabd=b.id and a.madoituong=c.madoituong and a.madoituong=y.madoituong and a.makp=d.id(+) and d.makp=e.makp(+) and b.manhom=x.id and a.mabn='"+mabn+"'";
								sql+=" and a.maql="+maql_phongluu;//+" and a.soluong>0";
								sql+=" and a.madoituong="+madoituong;
								if (idkhoa!=0) sql+=" and to_date(a.ngay,'dd/mm/yy') between to_date('"+tu.Substring(0,10)+"','dd/mm/yy') and to_date('"+den.Substring(0,10)+"','dd/mm/yy')";
								if(!bCapcuu_noitru)
								{
									if (bTheongay) sql+=" and to_date(a.ngay,'dd/mm/yy') between to_date('"+tu.Substring(0,10)+"','dd/mm/yy') and to_date('"+den.Substring(0,10)+"','dd/mm/yy')";
								}
								if (done == 0 || done == 2) sql += " and (a.done=0 and a.idttrv=0)";
								else if (done == 1) sql += " and a.done=" + done;
								if (khu!=0) sql+=" and to_date(a.ngay,'dd/mm/yy') between to_date('"+DateToString("dd/MM/yyyy",StringToDate(tu.Substring(0,10)).AddDays(-1))+"','dd/mm/yy') and to_date('"+tu.Substring(0,10)+"','dd/mm/yy')";
								sql+=" group by a.idttrv,to_char(a.ngay,'yymmdd'),";
								if (bChenhlechdv && !bGia_bh_quydinh ) sql+="c.loai,round(decode(x.giaban,0,a.giamua,b.giaban),"+i_Soledongiakhithanhtoan.ToString()+"),round(a.giaban,"+i_Soledongiakhithanhtoan.ToString()+"),";
								else if (bChenhlechdv && bGia_bh_quydinh ) sql+="c.loai,round(decode(x.giaban,0,b.gia_bh,b.giaban),"+i_Soledongiakhithanhtoan.ToString()+"),round(a.giaban,"+i_Soledongiakhithanhtoan.ToString()+"),";
								else sql+="0,0,0,";
								sql+="to_char(a.ngay,'dd/mm/yyyy'),";
								sql+="case when d.makp is null then '"+smakp+"' else d.makp end,";
								sql+="a.mabd,round(decode(c.loai,0,decode(x.giaban,0,a.giamua,b.giaban),a.giaban),"+i_Soledongiakhithanhtoan.ToString()+")";
								sql+=", case when a.kythuat=-2 then b.kythuat else a.kythuat end,a.id_ktcao ";//binh 280611
								//								if(dbMmyy(Mmyy_truoc(mmyy)))
								//								{
								//									string xxxsau=user+"d"+Mmyy_truoc(mmyy);
								//									sql+=" union all ";
								//									sql+="select a.idttrv,to_char(a.ngay,'yymmdd') yymmdd,";
								//									if (bChenhlechdv && !bGia_bh_quydinh) sql+="c.loai,round(decode(x.giaban,0,a.giamua,b.giaban),"+i_Soledongiakhithanhtoan.ToString()+") giamua,round(a.giaban,"+i_Soledongiakhithanhtoan.ToString()+") as giaban,";
								//									else if (bChenhlechdv && bGia_bh_quydinh) sql+="c.loai,round(decode(x.giaban,0,b.gia_bh,b.giaban),"+i_Soledongiakhithanhtoan.ToString()+") giamua,round(a.giaban,"+i_Soledongiakhithanhtoan.ToString()+") as giaban,";
								//									else sql+="0 as loai,0 as giamua,0 as giaban,";
								//									sql+="to_char(a.ngay,'dd/mm/yyyy') ngay,";
								//									sql+="case when d.makp is null then '"+smakp+"' else d.makp end as makp,";
								//									sql+="a.mabd,round(decode(c.loai,0,decode(x.giaban,0,a.giamua,b.giaban),a.giaban),"+i_Soledongiakhithanhtoan.ToString()+") as dongia,";
								//									if (bLamtron)
								//									{
								//										sql+="sum(decode(b.lamtron,1,ceil(a.soluong),a.soluong)) as soluong,";
								//										sql+="sum(case when c.loai=0 then decode(b.lamtron,1,ceil(a.soluong),a.soluong)*round(decode(x.giaban,0,a.giamua,b.giaban),"+i_Soledongiakhithanhtoan.ToString()+") else decode(b.lamtron,1,ceil(a.soluong),a.soluong)*round(a.giaban,"+i_Soledongiakhithanhtoan.ToString()+") end) sotien,";
								//										sql+="sum(0) bhytt0107,";
								//										sql+="sum(case when c.loai=0 then ";
								//										sql+="case when a.madoituong=1 or y.bhyt=1 then decode(b.lamtron,1,ceil(a.soluong),a.soluong)*round(decode(x.giaban,0,a.giamua,b.giaban),"+i_Soledongiakhithanhtoan.ToString()+")*b.bhyt/100 else 0 end ";
								//										sql+="else case when a.madoituong=1 or y.bhyt=1 then decode(b.lamtron,1,ceil(a.soluong),a.soluong)*round(a.giaban,"+i_Soledongiakhithanhtoan.ToString()+")*b.bhyt/100 else 0 end  end) bhyt";
								//									}
								//									else
								//									{
								//										sql+="sum(a.soluong) soluong,sum(case when c.loai=0 then a.soluong*round(decode(x.giaban,0,a.giamua,b.giaban),"+i_Soledongiakhithanhtoan.ToString()+") else a.soluong*round(a.giaban,"+i_Soledongiakhithanhtoan.ToString()+") end) sotien,";
								//										sql+="sum(0) bhytt0107,";
								//										sql+="sum(case when c.loai=0 then ";
								//										sql+="case when a.madoituong=1 or y.bhyt=1  then a.soluong*round(decode(x.giaban,0,a.giamua,b.giaban),"+i_Soledongiakhithanhtoan.ToString()+")*b.bhyt/100 else 0 end ";
								//										sql+="else case when a.madoituong=1 or y.bhyt=1 then a.soluong*round(a.giaban,"+i_Soledongiakhithanhtoan.ToString()+")*b.bhyt/100 else 0 end  end) bhyt";
								//									}
								//									sql+=", case when a.kythuat=-2 then b.kythuat else a.kythuat end as kythuat,a.id_ktcao ";//binh 280611
								//									sql+=" from "+xxxsau+".d_tienthuoc a,"+userid+".d_dmbd b,"+userid+".d_doituong c,"+userid+".d_duockp d,"+userid+".btdkp_bv e,"+user+".d_dmnhom x, "+user+".doituong y  where a.mabd=b.id and a.madoituong=c.madoituong and a.madoituong=y.madoituong and a.makp=d.id(+) and d.makp=e.makp(+) and b.manhom=x.id and a.mabn='"+mabn+"'";
								//									sql+=" and a.maql="+maql_phongluu+" and a.soluong>0";
								//									sql+=" and a.madoituong="+madoituong;
								//									if (idkhoa!=0) sql+=" and to_date(a.ngay,'dd/mm/yy') between to_date('"+tu.Substring(0,10)+"','dd/mm/yy') and to_date('"+den.Substring(0,10)+"','dd/mm/yy')";
								//									if(!bCapcuu_noitru)
								//									{
								//										if (bTheongay) sql+=" and to_date(a.ngay,'dd/mm/yy') between to_date('"+tu.Substring(0,10)+"','dd/mm/yy') and to_date('"+den.Substring(0,10)+"','dd/mm/yy')";
								//									}
								//									if (done == 0 || done == 2) sql += " and (a.done=0 and a.idttrv=0)";
								//									else if (done == 1) sql += " and a.done=" + done;
								//									if (khu!=0) sql+=" and to_date(a.ngay,'dd/mm/yy') between to_date('"+DateToString("dd/MM/yyyy",StringToDate(tu.Substring(0,10)).AddDays(-1))+"','dd/mm/yy') and to_date('"+tu.Substring(0,10)+"','dd/mm/yy')";
								//									sql+=" group by a.idttrv,to_char(a.ngay,'yymmdd'),";
								//									if (bChenhlechdv && !bGia_bh_quydinh ) sql+="c.loai,round(decode(x.giaban,0,a.giamua,b.giaban),"+i_Soledongiakhithanhtoan.ToString()+"),round(a.giaban,"+i_Soledongiakhithanhtoan.ToString()+"),";
								//									else if (bChenhlechdv && bGia_bh_quydinh ) sql+="c.loai,round(decode(x.giaban,0,b.gia_bh,b.giaban),"+i_Soledongiakhithanhtoan.ToString()+"),round(a.giaban,"+i_Soledongiakhithanhtoan.ToString()+"),";
								//									else sql+="0,0,0,";
								//									sql+="to_char(a.ngay,'dd/mm/yyyy'),";
								//									sql+="case when d.makp is null then '"+smakp+"' else d.makp end,";
								//									sql+="a.mabd,round(decode(c.loai,0,decode(x.giaban,0,a.giamua,b.giaban),a.giaban),"+i_Soledongiakhithanhtoan.ToString()+")";
								//									sql+=", case when a.kythuat=-2 then b.kythuat else a.kythuat end,a.id_ktcao ";
								//								}
								if(dst==null)
								{
									//									dst=get_data(sql);
									dst=get_data_mmyy_d(sql,ngayvaoPL.Substring(0,10).ToString(),den.Substring(0,10).ToString(),false);
								}
								else
								{
									//									DataSet dstmp=get_data(sql);
									DataSet dstmp=get_data_mmyy_d(sql,ngayvaoPL.Substring(0,10).ToString(),den.Substring(0,10).ToString(),false);
									if(dstmp!=null)
									{
										dst.Merge(dstmp);
									}
								}
							}
						}
						#endregion

						if (bCapve || (bPL_capve && loaiba==4) || loaiba==2 || loaiba==1)
						{
							if (loaiba!=2 && bChenhlechdv)
							{
								sql="select k.idttrv,to_char(k.ngay,'yymmdd') yymmdd,";
								if (bChenhlechdv && !bGia_bh_quydinh) sql+="1 as loai,round(decode(x.giaban,0,a.giamua,b.giaban),"+i_Soledongiakhithanhtoan.ToString()+") giamua,round(a.giaban,"+i_Soledongiakhithanhtoan.ToString()+") as giaban,";
								else if (bChenhlechdv && bGia_bh_quydinh) sql+="1 as loai,round(decode(x.giaban,0,b.gia_bh,b.giaban),"+i_Soledongiakhithanhtoan+") giamua,round(a.giaban,"+i_Soledongiakhithanhtoan.ToString()+") as giaban,";
								else sql+="0 as loai,0 as giamua,0 as giaban,";
								sql+="to_char(k.ngay,'dd/mm/yyyy') ngay,k.makp,a.mabd,";
								sql+="round(decode(c.loai,0,decode(x.giaban,0,a.giamua,b.giaban),a.giaban),"+i_Soledongiakhithanhtoan.ToString()+") as dongia,";
								sql+="sum(a.soluong) soluong,sum(case when c.loai=0 then a.soluong*round(decode(x.giaban,0,a.giamua,b.giaban),"+i_Soledongiakhithanhtoan.ToString()+") else a.soluong*round(a.giaban,"+i_Soledongiakhithanhtoan.ToString()+") end) sotien,";
								sql+="sum(0) bhytt0107,";
								sql+="sum(case when c.loai=0 then ";
								sql+="case when a.madoituong=1 or y.bhyt=1 then a.soluong*round(decode(x.giaban,0,a.giamua,b.giaban),"+i_Soledongiakhithanhtoan.ToString()+")*b.bhyt/100 else 0 end ";
								sql+="else case when a.madoituong=1 or y.bhyt=1 then a.soluong*round(a.giaban,"+i_Soledongiakhithanhtoan.ToString()+")*b.bhyt/100 else 0 end  end) bhyt";
								sql+=", b.kythuat,0 id_ktcao ";//binh 280611
								sql+=" from "+xxx+".bhytkb k,"+xxx+".bhytthuoc a,"+userid+".d_dmbd b,"+userid+".d_doituong c,"+userid+".btdkp_bv e,"+user+".d_dmnhom x,"+user+".doituong y ";
								sql+=" where k.id=a.id and a.mabd=b.id and a.madoituong=c.madoituong and a.madoituong=y.madoituong and k.makp=e.makp(+) and b.manhom=x.id and k.mabn='"+mabn+"'";
								if (bCapve && mavaovien!=0) 
								{
									if (loaiba==4) sql+=" and (k.mavaovien="+mavaovien+" or k.maql="+mavaovien+")";
									else if(loaiba==1 && !bPK_capve) sql+=" and k.loaiba=1";
									else sql+=" and k.mavaovien="+mavaovien;
								}
								else
								{
									if (maso!="") sql+=" and k.maql in ("+maso.Substring(0,maso.Trim().Length-1)+")";
									else if (maql!=0 && loaiba!=2) sql+=" and k.maql="+maql;
								}
								//if (bCapve && loaiba==1) sql+=" and k.maql="+maql;
								if((bPL_capve || bPK_capve) && loaiba==1) sql+=" and k.loaiba in (1"+((bPL_capve)?",4":"")+((bPK_capve)?",2,3":"")+")";//toa ve cua noi tru va phong luu
								else if(bPL_capve && loaiba==4)sql+=" and k.loaiba=4 ";
								sql+=" and a.madoituong="+madoituong;
								sql+=" and to_date(k.ngay,'dd/mm/yy') between to_date('"+tu.Substring(0,10)+"','dd/mm/yy') and to_date('"+den.Substring(0,10)+"','dd/mm/yy')";
								if (khu!=0) sql+=" and e.khu="+khu;
								if (done == 0 || done == 2) sql += " and (k.quyenso=0 and k.sobienlai=0)";
								else if (done == 1) sql += " and (k.quyenso<>0 and k.sobienlai<>0)";
								sql+=" group by k.idttrv,to_char(k.ngay,'yymmdd'),";
								//if (bChenhlechdv && !bGia_bh_quydinh) sql+="1,decode(x.giaban,0,a.giamua,b.giaban),a.giaban,";
								if (bChenhlechdv && !bGia_bh_quydinh) sql+="1,round(decode(x.giaban,0,a.giamua,b.giaban),"+i_Soledongiakhithanhtoan.ToString()+"),round(a.giaban,"+i_Soledongiakhithanhtoan+"),";
									//else if (bChenhlechdv && bGia_bh_quydinh) sql+="1,decode(x.giaban,0,b.gia_bh,b.giaban),a.giaban,";
								else if (bChenhlechdv && bGia_bh_quydinh) sql+="1,round(decode(x.giaban,0,b.gia_bh,b.giaban),"+i_Soledongiakhithanhtoan.ToString()+"),round(a.giaban,"+i_Soledongiakhithanhtoan.ToString()+"),";
								else sql+="0,0,0,";
								sql+="to_char(k.ngay,'dd/mm/yyyy'),k.makp,a.mabd,";
								//sql+="decode(c.loai,0,decode(x.giaban,0,a.giamua,b.giaban),a.giaban)";
								sql+="round(decode(c.loai,0,decode(x.giaban,0,a.giamua,b.giaban),a.giaban),"+i_Soledongiakhithanhtoan.ToString()+")";
								sql+=", b.kythuat ";//binh 280611
								if (be==0 || dst==null) dst=get_data(sql);
								else 
								{
									DataSet dstmp=get_data(sql);
									if(dstmp!=null)
									{
										dst.Merge(dstmp);
									}
								}
								be++;
							}
							else
							{
								sql="select k.idttrv,to_char(k.ngay,'yymmdd') yymmdd,";
								//if (bChenhlechdv && !bGia_bh_quydinh) sql+="c.loai,decode(x.giaban,0,a.giamua,b.giaban) giamua,a.giaban,";
								if (bChenhlechdv && !bGia_bh_quydinh) sql+="c.loai,round(decode(x.giaban,0,a.giamua,b.giaban),"+i_Soledongiakhithanhtoan.ToString()+") giamua,round(a.giaban,"+i_Soledongiakhithanhtoan.ToString()+") as giaban,";
									//else if (bChenhlechdv && bGia_bh_quydinh) sql+="c.loai,decode(x.giaban,0,b.gia_bh,b.giaban) giamua,a.giaban,";
								else if (bChenhlechdv && bGia_bh_quydinh) sql+="c.loai,round(decode(x.giaban,0,b.gia_bh,b.giaban),"+i_Soledongiakhithanhtoan.ToString()+") giamua,round(a.giaban,"+i_Soledongiakhithanhtoan.ToString()+") as giaban,";
								else sql+="0 as loai,0 as giamua,0 as giaban,";
								//sql+="to_char(k.ngay,'dd/mm/yyyy') ngay,k.makp,a.mabd,decode(c.loai,0,decode(x.giaban,0,a.giamua,b.giaban),a.giaban) as dongia,sum(a.soluong) soluong,sum(case when c.loai=0 then a.soluong*decode(x.giaban,0,a.giamua,b.giaban) else a.soluong*a.giaban end) sotien,";
								sql+="to_char(k.ngay,'dd/mm/yyyy') ngay,k.makp,a.mabd,round(decode(c.loai,0,decode(x.giaban,0,a.giamua,b.giaban),a.giaban),"+i_Soledongiakhithanhtoan.ToString()+") as dongia,sum(a.soluong) soluong,sum(case when c.loai=0 then a.soluong*round(decode(x.giaban,0,a.giamua,b.giaban),"+i_Soledongiakhithanhtoan.ToString()+") else a.soluong*round(a.giaban,"+i_Soledongiakhithanhtoan.ToString()+") end) sotien,";
								sql+="sum(0) bhytt0107,";
								sql+="sum(case when c.loai=0 then ";
								//sql+="case when a.madoituong=1 or y.bhyt=1 then a.soluong*decode(x.giaban,0,a.giamua,b.giaban)*b.bhyt/100 else 0 end ";
								sql+="case when a.madoituong=1 or y.bhyt=1 then a.soluong*round(decode(x.giaban,0,a.giamua,b.giaban),"+i_Soledongiakhithanhtoan.ToString()+")*b.bhyt/100 else 0 end ";
								//sql+="else case when a.madoituong=1 or y.bhyt=1 then a.soluong*a.giaban*b.bhyt/100 else 0 end  end) bhyt";
								sql+="else case when a.madoituong=1 or y.bhyt=1 then a.soluong*round(a.giaban,"+i_Soledongiakhithanhtoan.ToString()+")*b.bhyt/100 else 0 end  end) bhyt";
								sql+=", b.kythuat,0 id_ktcao ";//binh 280611
								sql+=" from "+xxx+".bhytkb k,"+xxx+".bhytthuoc a,"+userid+".d_dmbd b,"+userid+".d_doituong c,"+userid+".btdkp_bv e,"+user+".d_dmnhom x,"+user+".doituong y where k.id=a.id and a.mabd=b.id and a.madoituong=c.madoituong and a.madoituong=y.madoituong and k.makp=e.makp(+) and b.manhom=x.id and k.mabn='"+mabn+"'";								
								if (loaiba==2)
								{
									sql+=" and k.loaiba="+loaiba;
									if (maso!="") sql+=" and k.maql in ("+maso.Substring(0,maso.Trim().Length-1)+")";
								}
								else if (bCapve && mavaovien!=0)
								{
									//if (loaiba==4) 
									sql+=" and (k.mavaovien="+mavaovien+" or k.maql="+mavaovien+")";
									//else sql+=" and k.mavaovien="+mavaovien;
								}
								else if (maql!=0 && loaiba!=2) sql+=" and k.maql="+maql;
								if (bCapve && loaiba==1 && mavaovien==0) sql+=" and k.maql="+maql;
								sql+=" and to_date(k.ngay,'dd/mm/yy') between to_date('"+tu.Substring(0,10)+"','dd/mm/yy') and to_date('"+den.Substring(0,10)+"','dd/mm/yy')";
								sql+=" and a.madoituong="+madoituong;
								if (khu!=0) sql+=" and e.khu="+khu;
								if (done == 0 || done == 2) sql += " and (k.quyenso=0 and k.sobienlai=0)";
								else if (done == 1) sql += " and (k.quyenso<>0 and k.sobienlai<>0)";
								sql+=" group by k.idttrv,to_char(k.ngay,'yymmdd'),";
								//if (bChenhlechdv && !bGia_bh_quydinh  ) sql+="c.loai,decode(x.giaban,0,a.giamua,b.giaban),a.giaban,";
								if (bChenhlechdv && !bGia_bh_quydinh  ) sql+="c.loai,round(decode(x.giaban,0,a.giamua,b.giaban),"+i_Soledongiakhithanhtoan.ToString()+"),round(a.giaban,"+i_Soledongiakhithanhtoan.ToString()+"),";
									//else if (bChenhlechdv && bGia_bh_quydinh  ) sql+="c.loai,decode(x.giaban,0,b.gia_bh,b.giaban),a.giaban,";
								else if (bChenhlechdv && bGia_bh_quydinh  ) sql+="c.loai,round(decode(x.giaban,0,b.gia_bh,b.giaban),"+i_Soledongiakhithanhtoan.ToString()+"),round(a.giaban,"+i_Soledongiakhithanhtoan.ToString()+"),";
								else sql+="0,0,0,";
								//sql+="to_char(k.ngay,'dd/mm/yyyy'),k.makp,a.mabd,decode(c.loai,0,decode(x.giaban,0,a.giamua,b.giaban),a.giaban)";
								sql+="to_char(k.ngay,'dd/mm/yyyy'),k.makp,a.mabd,round(decode(c.loai,0,decode(x.giaban,0,a.giamua,b.giaban),a.giaban),"+i_Soledongiakhithanhtoan.ToString()+")";
								sql+=", b.kythuat ";//binh 280611
								if (be==0 || dst==null) dst=get_data(sql);
								else 
								{
									//dst.Merge(get_data(sql));
									DataSet dstmp=get_data(sql);
									if(dstmp!=null)
									{
										dst.Merge(dstmp);
									}
								}
								be++;
								//hoantra
								if (loaiba==2)
								{
									sql="select 0 as idttrv,to_char(k.ngaysp,'yymmdd') yymmdd,";
									if (bChenhlechdv && !bGia_bh_quydinh ) sql+="0 as loai,round(decode(x.giaban,0,a.giamua,b.giaban),"+i_Soledongiakhithanhtoan.ToString()+") giamua,round(a.giaban,"+i_Soledongiakhithanhtoan.ToString()+") as giaban,";
									else if (bChenhlechdv && bGia_bh_quydinh ) sql+="0 as loai,round(decode(x.giaban,0,b.gia_bh,b.giaban),"+i_Soledongiakhithanhtoan.ToString()+") giamua,round(a.giaban,"+i_Soledongiakhithanhtoan.ToString()+") as giaban,";
									else sql+="0 as loai,0 as giamua,0 as giaban,";
									sql+="to_char(k.ngaysp,'dd/mm/yyyy') ngay,k.co as makp,a.mabd,round(decode(x.giaban,0,a.giamua,b.giaban),"+i_Soledongiakhithanhtoan.ToString()+") as dongia,sum(-1*a.soluong) soluong,sum(-1*a.soluong*round(decode(x.giaban,0,a.giamua,b.giaban),"+i_Soledongiakhithanhtoan.ToString()+")) sotien,";
									sql+="sum(0) bhytt0107,";
									sql+="sum(case when k.lydo=1 then -1*a.soluong*round(decode(x.giaban,0,a.giamua,b.giaban),"+i_Soledongiakhithanhtoan.ToString()+")*b.bhyt/100 else 0 end) bhyt";
									sql+=", b.kythuat,0 id_ktcao ";//binh 280611
									sql+=" from "+xxx+".d_nhapll k,"+xxx+".d_nhapct a,"+userid+".d_dmbd b,"+userid+".d_doituong c,"+user+".d_dmnhom x where k.id=a.id and a.mabd=b.id and b.manhom=x.id and k.lydo=c.madoituong(+) and k.sophieu='"+mabn+"'";
									sql+=" and k.loai='B' and to_date(k.ngaysp,'dd/mm/yy') between to_date('"+tu.Substring(0,10)+"','dd/mm/yy') and to_date('"+den.Substring(0,10)+"','dd/mm/yy')";
									sql+=" and k.lydo="+madoituong;
									sql+=" group by 0,to_char(k.ngaysp,'yymmdd'),";
									if (bChenhlechdv && !bGia_bh_quydinh ) sql+="0,round(decode(x.giaban,0,a.giamua,b.giaban),"+i_Soledongiakhithanhtoan.ToString()+"),round(a.giaban,"+i_Soledongiakhithanhtoan.ToString()+"),";
									else if (bChenhlechdv && bGia_bh_quydinh ) sql+="0,round(decode(x.giaban,0,b.gia_bh,b.giaban),"+i_Soledongiakhithanhtoan.ToString()+"),round(a.giaban,"+i_Soledongiakhithanhtoan.ToString()+"),";
									else sql+="0,0,0,";
									sql+="to_char(k.ngaysp,'dd/mm/yyyy'),k.co,a.mabd,round(decode(x.giaban,0,a.giamua,b.giaban),"+i_Soledongiakhithanhtoan.ToString()+")";
									sql+=", b.kythuat ";//binh 280611
									if (be==0 || dst==null) dst=get_data(sql);
									else 
									{
										DataSet dstmp=get_data(sql);
										if(dstmp!=null)
										{
											dst.Merge(dstmp);
										}
									}
								}
							}
						}

						//						if (bNgtr && loaiba!=2)
						//						{
						//							sql="select k.idttrv,to_char(k.ngay,'yymmdd') yymmdd,";
						//							//if (bChenhlechdv && !bGia_bh_quydinh) sql+="c.loai,decode(x.giaban,0,a.giamua,b.giaban) giamua,a.giaban,";
						//							if (bChenhlechdv && !bGia_bh_quydinh) sql+="c.loai,round(decode(x.giaban,0,a.giamua,b.giaban),"+i_Soledongiakhithanhtoan.ToString()+") giamua,round(a.giaban,"+i_Soledongiakhithanhtoan.ToString()+") as giaban,";
						//							//else if (bChenhlechdv && bGia_bh_quydinh) sql+="c.loai,decode(x.giaban,0,b.gia_bh,b.giaban) giamua,a.giaban,";
						//							else if (bChenhlechdv && bGia_bh_quydinh) sql+="c.loai,round(decode(x.giaban,0,b.gia_bh,b.giaban),"+i_Soledongiakhithanhtoan.ToString()+") giamua,round(a.giaban,"+i_Soledongiakhithanhtoan.ToString()+") as giaban,";
						//							else sql+="0 as loai,0 as giamua,0 as giaban,";
						//							//sql+="to_char(k.ngay,'dd/mm/yyyy') ngay,k.makp,a.mabd,decode(c.loai,0,decode(x.giaban,0,a.giamua,b.giaban),a.giaban) as dongia,sum(a.soluong) soluong,sum(case when c.loai=0 then a.soluong*decode(x.giaban,0,a.giamua,b.giaban) else a.soluong*a.giaban end) sotien,";
						//							sql+="to_char(k.ngay,'dd/mm/yyyy') ngay,k.makp,a.mabd,round(decode(c.loai,0,decode(x.giaban,0,a.giamua,b.giaban),a.giaban),"+i_Soledongiakhithanhtoan.ToString()+") as dongia,sum(a.soluong) soluong,sum(case when c.loai=0 then a.soluong*round(decode(x.giaban,0,a.giamua,b.giaban),"+i_Soledongiakhithanhtoan.ToString()+") else a.soluong*round(a.giaban,"+i_Soledongiakhithanhtoan.ToString()+") end) sotien,";
						//							sql+="sum(0) bhytt0107,";
						//							sql+="sum(case when c.loai=0 then ";
						//							//sql+="case when a.madoituong=1 or y.bhyt=1 then a.soluong*decode(x.giaban,0,a.giamua,b.giaban)*b.bhyt/100 else 0 end ";
						//							sql+="case when a.madoituong=1 or y.bhyt=1 then a.soluong*round(decode(x.giaban,0,a.giamua,b.giaban),"+i_Soledongiakhithanhtoan.ToString()+")*b.bhyt/100 else 0 end ";
						//							//sql+="else case when a.madoituong=1 or y.bhyt=1 then a.soluong*a.giaban*b.bhyt/100 else 0 end  end) bhyt";
						//							sql+="else case when a.madoituong=1 or y.bhyt=1 then a.soluong*round(a.giaban,"+i_Soledongiakhithanhtoan.ToString()+")*b.bhyt/100 else 0 end  end) bhyt";
						//							sql+=", b.kythuat ";//binh 280611
						//							sql+=" from "+xxx+".bhytkb k,"+xxx+".bhytthuoc a,"+userid+".d_dmbd b,"+userid+".d_doituong c,"+userid+".btdkp_bv e,"+user+".d_dmnhom x,"+user+".doituong y where k.id=a.id and a.mabd=b.id and a.madoituong=c.madoituong and a.madoituong=y.madoituong and k.makp=e.makp(+) and b.manhom=x.id and k.mabn='"+mabn+"'";
						//							sql+=" and to_date(k.ngay,'dd/mm/yy') between to_date('"+tu.Substring(0,10)+"','dd/mm/yy') and to_date('"+tu.Substring(0,10)+"','dd/mm/yy')";
						//							sql+=" and a.madoituong="+madoituong;
						//							if (khu!=0) sql+=" and e.khu="+khu;
						//							if (mavaovien!=0) sql+=" and k.mavaovien="+mavaovien;
						//							if (maso!="") sql+=" and k.maql in ("+maso.Substring(0,maso.Length-1)+")";
						//							if (done == 0 || done == 2) sql += " and (k.quyenso=0 and k.sobienlai=0)";
						//							else if (done == 1) sql += " and (k.quyenso<>0 and k.sobienlai<>0)";
						//							sql+=" group by k.idttrv,to_char(k.ngay,'yymmdd'),";
						//							//if (bChenhlechdv && !bGia_bh_quydinh ) sql+="c.loai,decode(x.giaban,0,a.giamua,b.giaban),a.giaban,";
						//							if (bChenhlechdv && !bGia_bh_quydinh ) sql+="c.loai,round(decode(x.giaban,0,a.giamua,b.giaban),"+i_Soledongiakhithanhtoan.ToString()+"),round(a.giaban,"+i_Soledongiakhithanhtoan.ToString()+"),";
						//							//else if (bChenhlechdv && bGia_bh_quydinh ) sql+="c.loai,decode(x.giaban,0,b.gia_bh,b.giaban),a.giaban,";
						//							else if (bChenhlechdv && bGia_bh_quydinh ) sql+="c.loai,round(decode(x.giaban,0,b.gia_bh,b.giaban),"+i_Soledongiakhithanhtoan.ToString()+"),round(a.giaban,"+i_Soledongiakhithanhtoan.ToString()+"),";
						//							else sql+="0,0,0,";
						//							//sql+="to_char(k.ngay,'dd/mm/yyyy'),k.makp,a.mabd,decode(c.loai,0,decode(x.giaban,0,a.giamua,b.giaban),a.giaban)";
						//							sql+="to_char(k.ngay,'dd/mm/yyyy'),k.makp,a.mabd,round(decode(c.loai,0,decode(x.giaban,0,a.giamua,b.giaban),a.giaban),"+i_Soledongiakhithanhtoan.ToString()+")";
						//							sql+=", b.kythuat ";//binh 280611
						//							if (be==0 || dst==null) dst=get_data(sql);
						//							else 
						//							{
						//								//dst.Merge(get_data(sql));
						//								DataSet dstmp=get_data(sql);
						//								if(dstmp!=null)
						//								{
						//									dst.Merge(dstmp);
						//								}
						//							}
						//							be++;
						//						}
					}
				}
			}
			return (be==0)?null:dst.Tables[0];
		}

		private DataTable get_vienphi_ct(int khu,string mabn,long maql,long idkhoa
			,string tu,string den,string makp,int madoituong,int done
			,long maql_phongluu,bool bCapve,bool bNgtr,int loaiba,string makp_rv
			,long mavaovien,string maso,bool bTheongay, bool bTTRV_Ndot
			, bool bTTRV_Theokhoa,string ngayvaovien)
		{
			#region cao vu 30/05/2013
			
			string sMavaovien="";
			if(bVP_ChuyenPhongKham_NoiTru)
			{
				sMavaovien=get_mavaovien_noitru(mabn,ngayvaovien);
			}
			#endregion
			bool bPL_capve=bCapve_Phongluu;
			bool bPK_capve=bBHYTngtr_noitru;	
			string s_mavp_congkham=f_get_mavp_congkham();
			DataSet dsv=new DataSet();
			DateTime dt1=StringToDate(tu).AddDays(-3);
			DateTime dt2=StringToDate(den).AddDays(3);
			int y1=dt1.Year,m1=dt1.Month;
			int y2=dt2.Year,m2=dt2.Month;
			int itu,iden,be=0;
			string mmyy="",xxx,ngayvaoPL="";
			bool bPttt_vp_vattu=bPttt_vienphi_vattu;
			//linh lam tron so le khi thanh toan
			//string fie=(bPttt_vp_vattu)?"a.dongia":"a.dongia";//+a.vattu";
			string fie=(bPttt_vp_vattu)?"round(a.dongia,"+i_Soledongiakhithanhtoan.ToString()+")":"round(a.dongia+a.vattu,"+i_Soledongiakhithanhtoan.ToString()+")";//+a.vattu";//linh lam tron round()
			if (maso!="" && maql_phongluu!=0) {maso=maso.Replace(maql_phongluu.ToString()+",","");}
			if (maql_phongluu!=0)
			{
				foreach(DataRow row in get_data("select to_char(ngay,'dd/mm/yyyy hh24:mi') as ngayvao from benhandt where maql in ("+maql_phongluu+") and loaiba=4").Tables[0].Rows)
				{
					ngayvaoPL=row["ngayvao"].ToString();
					break;
				}
			}
			for(int i=y1;i<=y2;i++)
			{
				itu=(i==y1)?m1:1;
				iden=(i==y2)?m2:12;
				for(int j=itu;j<=iden;j++)
				{
					mmyy=j.ToString().PadLeft(2,'0')+i.ToString().Substring(2,2);
					xxx=user+mmyy;
					if (bMmyy(mmyy))
					{
						if (done==0)
						{
							//sql="select a.idttrv,to_char(a.ngay,'yymmdd') yymmdd,to_char(a.ngay,'dd/mm/yyyy') ngay,a.makp,a.mavp, "+fie+" as dongia,sum(a.soluong) soluong,sum(a.soluong*("+fie+")) sotien, ";
							sql="select a.idttrv,to_char(a.ngay,'yymmdd') yymmdd,to_char(a.ngay,'dd/mm/yyyy') ngay,a.makp,a.mavp, case when a.cuocmothu2=1 then "+fie+"/2 else "+fie+" end as dongia,sum(a.soluong) soluong,sum(a.soluong*(case when a.cuocmothu2=1 then "+fie+"/2 else "+fie+" end)) sotien, ";//binh 040711
							sql+="sum(0) bhytt0107,";
							sql+="sum(case when a.madoituong=1 or y.bhyt=1 then a.soluong*("+fie+")*b.bhyt/100 else 0 end ) bhyt,";
							sql+="sum(a.soluong*a.vattu) vattu, b.id_loai ";
							sql+=", a.giachenhlech, a.dachenhlech, a.cuocmothu2,a.id ";
							sql+=" from "+xxx+".v_vpkhoa a,"+userid+".v_giavp b,"+userid+".btdkp_bv e, "+userid+".doituong y where a.mavp=b.id and a.madoituong=y.madoituong and a.makp=e.makp(+) and a.mabn='"+mabn+"'";
							if (loaiba==2) 
								sql+=" and a.maql<>"+maql_phongluu+" and to_date(a.ngay,'dd/mm/yy') between to_date('"+tu.Substring(0,10)+"','dd/mm/yy') and to_date('"+den.Substring(0,10)+"','dd/mm/yy')";
							else if(idkhoa!=0 && bTTRV_Theokhoa)
							{
								if (idkhoa!=0)
								{
									sql+=" and a.idkhoa="+idkhoa;
									sql+=" and to_date(a.ngay,'dd/mm/yy') between to_date('"+tu.Substring(0,10)+"','dd/mm/yy') and to_date('"+den.Substring(0,10)+"','dd/mm/yy')";
								}
							}
							else if(bTTRV_Ndot)//thanh theo dot
							{
								sql+=" and to_date(a.ngay,'dd/mm/yy') between to_date('"+tu.Substring(0,10)+"','dd/mm/yy') and to_date('"+den.Substring(0,10)+"','dd/mm/yy')";
							}
							if (maso!="") sql+=" and a.maql in ("+maso.Substring(0,maso.Trim().Length-1)+")";
							else sql+=" and a.maql="+maql;
							if (bTheongay) sql+=" and to_date(a.ngay,'dd/mm/yy') between to_date('"+tu.Substring(0,10)+"','dd/mm/yy') and to_date('"+den.Substring(0,10)+"','dd/mm/yy')";
							sql+=" and a.madoituong="+madoituong;
							if (makp!="") sql+=" and a.makp='"+makp+"'";
							if (done == 0 || done == 2) sql += " and (a.done=0 and a.idttrv=0)";
							else if (done == 1) sql += " and a.done=" + done;
							if (khu!=0) sql+=" and e.khu="+khu;
							sql+=" group by a.idttrv,to_char(a.ngay,'yymmdd'),to_char(a.ngay,'dd/mm/yyyy'),a.makp,a.mavp,"+fie+",b.id_loai";
							sql+=", a.giachenhlech, a.dachenhlech, a.cuocmothu2,a.id ";
							if (bChidinh_vienphi)
							{
								sql+=" union all ";
								sql+="select a.idttrv,to_char(a.ngay,'yymmdd') yymmdd,to_char(a.ngay,'dd/mm/yyyy') ngay,a.makp,a.mavp,"+fie+" as dongia,sum(a.soluong) soluong,sum(a.soluong*("+fie+")) sotien, ";
								sql+="sum(0) bhytt0107,";
								sql+="sum(case when a.madoituong=1 or y.bhyt=1 then a.soluong*("+fie+")*b.bhyt/100 else 0 end ) bhyt,";
								sql+="sum(a.soluong*a.vattu) vattu, b.id_loai ";
								sql+=", a.giachenhlech, a.dachenhlech, 0 as cuocmothu2,a.id ";
								sql+=" from "+xxx+".v_chidinh a,"+userid+".v_giavp b,"+userid+".btdkp_bv e,"+userid+".doituong y where a.mavp=b.id and a.madoituong=y.madoituong and a.makp=e.makp(+) and a.mabn='"+mabn+"'";
								if (loaiba==2) 
									sql+=" and a.maql<>"+maql_phongluu+" and to_date(a.ngay,'dd/mm/yy') between to_date('"+tu.Substring(0,10)+"','dd/mm/yy') and to_date('"+den.Substring(0,10)+"','dd/mm/yy')";
								else if(idkhoa!=0 && bTTRV_Theokhoa)								 
								{
									
									sql+=" and a.idkhoa="+idkhoa;								
									sql+=" and to_date(a.ngay,'dd/mm/yy') between to_date('"+tu.Substring(0,10)+"','dd/mm/yy') and to_date('"+den.Substring(0,10)+"','dd/mm/yy')";
								}
								else if(bTTRV_Ndot)
								{
									sql+=" and to_date(a.ngay,'dd/mm/yy') between to_date('"+tu.Substring(0,10)+"','dd/mm/yy') and to_date('"+den.Substring(0,10)+"','dd/mm/yy')";
								}
								#region cao vu 30/05/2013
								if(sMavaovien!="")
								{
									sql+=" and a.mavaovien in ("+sMavaovien.Trim(',')+")";
								}
								else
								{
									if (maso!="") sql+=" and a.maql in ("+maso.Substring(0,maso.Trim().Length-1)+")";
									else sql+=" and a.maql="+maql;
								}
								
								#endregion
								if (bTheongay) sql+=" and to_date(a.ngay,'dd/mm/yy') between to_date('"+tu.Substring(0,10)+"','dd/mm/yy') and to_date('"+den.Substring(0,10)+"','dd/mm/yy')";
								sql+=" and a.madoituong="+madoituong;
								if (makp!="") sql+=" and a.makp='"+makp+"'";
								if (done == 0 || done == 2) sql += " and (a.idttrv=0)";//sql += " and (a.paid=0 and a.idttrv=0)";
								else if (done == 1) sql += " and (a.paid=" + done +" and a.idttrv>0)";
								if (khu!=0) sql+=" and e.khu="+khu;
								if(s_mavp_congkham.Trim()!="" && bDoituong_BHYT(madoituong) && loaiba==1 && bNhapvien_kocongkham) sql+=" and (a.mavp not in ("+s_mavp_congkham+") or (a.mavp in ("+s_mavp_congkham+") and a.makp='99'))";//bbbb
								sql+=" group by a.idttrv,to_char(a.ngay,'yymmdd'),to_char(a.ngay,'dd/mm/yyyy'),a.makp,a.mavp,"+fie+",b.id_loai";
								sql+=", a.giachenhlech, a.dachenhlech,a.id ";
							}
							if (be==0) dsv=get_data(sql);
							else dsv.Merge(get_data(sql));
							be++;
							if (maql_phongluu!=0 && !bPhongluu && be<=1)// && loaiba!=2)
							{
								//sql="select a.idttrv,to_char(a.ngay,'yymmdd') yymmdd,to_char(a.ngay,'dd/mm/yyyy') ngay,a.makp,a.mavp,"+fie+" as dongia,sum(a.soluong) soluong,sum(a.soluong*("+fie+")) sotien, ";
								sql="select a.idttrv,to_char(a.ngay,'yymmdd') yymmdd,to_char(a.ngay,'dd/mm/yyyy') ngay,a.makp,a.mavp,case when a.cuocmothu2=1 then "+fie+"/2 else "+fie+" end as dongia,sum(a.soluong) soluong,sum(a.soluong*(case when a.cuocmothu2=1 then "+fie+"/2 else "+fie+" end)) sotien, ";//binh 040711
								sql+="sum(0) bhytt0107,";
								sql+="sum(case when a.madoituong=1 or y.bhyt=1 then a.soluong*("+fie+")*b.bhyt/100 else 0 end ) bhyt,";
								sql+="sum(a.soluong*a.vattu) vattu, b.id_loai";
								sql+=", a.giachenhlech, a.dachenhlech, a.cuocmothu2,a.id ";
								sql+=" from xxx.v_vpkhoa a,"+userid+".v_giavp b,"+userid+".btdkp_bv e,"+userid+".doituong y where a.mavp=b.id and a.madoituong=y.madoituong and a.makp=e.makp(+) and a.mabn='"+mabn+"'";
								sql+=" and a.maql="+maql_phongluu;
								sql+=" and a.madoituong="+madoituong;
								if (idkhoa!=0) sql+=" and to_date(a.ngay,'dd/mm/yy') between to_date('"+tu.Substring(0,10)+"','dd/mm/yy') and to_date('"+den.Substring(0,10)+"','dd/mm/yy')";
								if (done == 0 || done == 2) sql += " and (a.done=0 and a.idttrv=0)";
								else if (done == 1) sql += " and a.done=" + done;

								if (khu!=0) sql+=" and to_date(a.ngay,'dd/mm/yy') between to_date('"+DateToString("dd/MM/yyyy",StringToDate(tu.Substring(0,10)).AddDays(-1))+"','dd/mm/yy') and to_date('"+tu.Substring(0,10)+"','dd/mm/yy')";
								sql+=" group by a.idttrv,to_char(a.ngay,'yymmdd'),to_char(a.ngay,'dd/mm/yyyy'),a.makp,a.mavp,"+fie+",b.id_loai";
								sql+=", a.giachenhlech, a.dachenhlech, a.cuocmothu2,a.id ";
								if (bChidinh_vienphi)
								{
									sql+=" union all ";
									sql+="select  a.idttrv,to_char(a.ngay,'yymmdd') yymmdd,to_char(a.ngay,'dd/mm/yyyy') ngay,a.makp,a.mavp,"+fie+" as dongia,sum(a.soluong) soluong,sum(a.soluong*("+fie+")) sotien, ";
									sql+="sum(0) bhytt0107,";
									sql+="sum(case when a.madoituong=1 or y.bhyt=1 then a.soluong*("+fie+")*b.bhyt/100 else 0 end ) bhyt,";
									sql+="sum(a.soluong*a.vattu) vattu, b.id_loai ";
									sql+=", a.giachenhlech, a.dachenhlech, 0 as cuocmothu2,a.id ";
									sql+=" from xxx.v_chidinh a,"+userid+".v_giavp b,"+userid+".btdkp_bv e,"+userid+".doituong y where a.mavp=b.id and a.madoituong=y.madoituong and a.makp=e.makp(+) and a.mabn='"+mabn+"'";
									sql+=" and a.maql="+maql_phongluu;
									sql+=" and a.madoituong="+madoituong;
									if (done == 0 || done == 2) sql += " and (a.paid=0 and a.idttrv=0)";
									else if (done == 1) sql += " and (a.paid=" + done +" and a.idttrv>0)";
									if (khu!=0) sql+=" and to_date(a.ngay,'dd/mm/yy') between to_date('"+DateToString("dd/MM/yyyy",StringToDate(tu.Substring(0,10)).AddDays(-1))+"','dd/mm/yy') and to_date('"+tu.Substring(0,10)+"','dd/mm/yy')";
									if (idkhoa!=0) sql+=" and to_date(a.ngay,'dd/mm/yy') between to_date('"+tu.Substring(0,10)+"','dd/mm/yy') and to_date('"+den.Substring(0,10)+"','dd/mm/yy')";
									if(s_mavp_congkham.Trim()!="" && bDoituong_BHYT(madoituong) && bNhapvien_kocongkham && loaiba==1) sql+=" and (a.mavp not in ("+s_mavp_congkham+") or (a.mavp in ("+s_mavp_congkham+") and a.makp='99'))";//bbbb
									sql+=" group by a.idttrv,to_char(a.ngay,'yymmdd'),to_char(a.ngay,'dd/mm/yyyy'),a.makp,a.mavp,"+fie+",b.id_loai";
									sql+=", a.giachenhlech, a.dachenhlech,a.id ";
								}
								//								if(bMmyy(Mmyy_truoc(mmyy)))
								//								{
								//									string xxxsau=user+Mmyy_truoc(mmyy);
								//									sql+=" union all ";
								//									sql+="select a.idttrv,to_char(a.ngay,'yymmdd') yymmdd,to_char(a.ngay,'dd/mm/yyyy') ngay,a.makp,a.mavp,case when a.cuocmothu2=1 then "+fie+"/2 else "+fie+" end as dongia,sum(a.soluong) soluong,sum(a.soluong*(case when a.cuocmothu2=1 then "+fie+"/2 else "+fie+" end)) sotien, ";//binh 040711
								//									sql+="sum(0) bhytt0107,";
								//									sql+="sum(case when a.madoituong=1 or y.bhyt=1 then a.soluong*("+fie+")*b.bhyt/100 else 0 end ) bhyt,";
								//									sql+="sum(a.soluong*a.vattu) vattu, b.id_loai";
								//									sql+=", a.giachenhlech, a.dachenhlech, a.cuocmothu2,a.id ";
								//									sql+=" from "+xxxsau+".v_vpkhoa a,"+userid+".v_giavp b,"+userid+".btdkp_bv e,"+userid+".doituong y where a.mavp=b.id and a.madoituong=y.madoituong and a.makp=e.makp(+) and a.mabn='"+mabn+"'";
								//									sql+=" and a.maql="+maql_phongluu;
								//									sql+=" and a.madoituong="+madoituong;
								//									if (idkhoa!=0) sql+=" and to_date(a.ngay,'dd/mm/yy') between to_date('"+tu.Substring(0,10)+"','dd/mm/yy') and to_date('"+den.Substring(0,10)+"','dd/mm/yy')";
								//									if (done == 0 || done == 2) sql += " and (a.done=0 and a.idttrv=0)";
								//									else if (done == 1) sql += " and a.done=" + done;
								//
								//									if (khu!=0) sql+=" and to_date(a.ngay,'dd/mm/yy') between to_date('"+DateToString("dd/MM/yyyy",StringToDate(tu.Substring(0,10)).AddDays(-1))+"','dd/mm/yy') and to_date('"+tu.Substring(0,10)+"','dd/mm/yy')";
								//									sql+=" group by a.idttrv,to_char(a.ngay,'yymmdd'),to_char(a.ngay,'dd/mm/yyyy'),a.makp,a.mavp,"+fie+",b.id_loai";
								//									sql+=", a.giachenhlech, a.dachenhlech, a.cuocmothu2,a.id ";
								//									if (bChidinh_vienphi)
								//									{
								//										sql+=" union all ";
								//										sql+="select  a.idttrv,to_char(a.ngay,'yymmdd') yymmdd,to_char(a.ngay,'dd/mm/yyyy') ngay,a.makp,a.mavp,"+fie+" as dongia,sum(a.soluong) soluong,sum(a.soluong*("+fie+")) sotien, ";
								//										sql+="sum(0) bhytt0107,";
								//										sql+="sum(case when a.madoituong=1 or y.bhyt=1 then a.soluong*("+fie+")*b.bhyt/100 else 0 end ) bhyt,";
								//										sql+="sum(a.soluong*a.vattu) vattu, b.id_loai ";
								//										sql+=", a.giachenhlech, a.dachenhlech, 0 as cuocmothu2,a.id ";
								//										sql+=" from "+xxxsau+".v_chidinh a,"+userid+".v_giavp b,"+userid+".btdkp_bv e,"+userid+".doituong y where a.mavp=b.id and a.madoituong=y.madoituong and a.makp=e.makp(+) and a.mabn='"+mabn+"'";
								//										sql+=" and a.maql="+maql_phongluu;
								//										sql+=" and a.madoituong="+madoituong;
								//										if (done == 0 || done == 2) sql += " and (a.paid=0 and a.idttrv=0)";
								//										else if (done == 1) sql += " and (a.paid=" + done +" and a.idttrv>0)";
								//										if (khu!=0) sql+=" and to_date(a.ngay,'dd/mm/yy') between to_date('"+DateToString("dd/MM/yyyy",StringToDate(tu.Substring(0,10)).AddDays(-1))+"','dd/mm/yy') and to_date('"+tu.Substring(0,10)+"','dd/mm/yy')";
								//										if (idkhoa!=0) sql+=" and to_date(a.ngay,'dd/mm/yy') between to_date('"+tu.Substring(0,10)+"','dd/mm/yy') and to_date('"+den.Substring(0,10)+"','dd/mm/yy')";
								//										if(s_mavp_congkham.Trim()!="" && bDoituong_BHYT(madoituong) && bNhapvien_kocongkham && loaiba==1) sql+=" and (a.mavp not in ("+s_mavp_congkham+") or (a.mavp in ("+s_mavp_congkham+") and a.makp='99'))";//bbbb
								//										sql+=" group by a.idttrv,to_char(a.ngay,'yymmdd'),to_char(a.ngay,'dd/mm/yyyy'),a.makp,a.mavp,"+fie+",b.id_loai";
								//										sql+=", a.giachenhlech, a.dachenhlech,a.id ";
								//									}
								//								}
								//								dsv.Merge(get_data(sql));
								dsv.Merge(get_data_mmyy(sql,ngayvaoPL.Substring(0,10).ToString(),den.Substring(0,10).ToString(),false));
							}
						}
						else
						{
							//sql="select a.idttrv,to_char(a.ngay,'yymmdd') yymmdd,to_char(a.ngay,'dd/mm/yyyy') ngay,a.makp,a.mavp,"+fie+" as dongia,sum(a.soluong) soluong,sum(a.soluong*("+fie+")) sotien,";
							sql="select a.idttrv,to_char(a.ngay,'yymmdd') yymmdd,to_char(a.ngay,'dd/mm/yyyy') ngay,a.makp,a.mavp,case when a.cuocmothu2=1 then "+fie+"/2 else "+fie+" end as dongia,sum(a.soluong) soluong,sum(a.soluong*(case when a.cuocmothu2=1 then "+fie+"/2 else "+fie+" end)) sotien,";//binh 040711
							sql+="sum(0) bhytt0107,";
							sql+="sum(case when a.madoituong=1 or y.bhyt=1 then a.soluong*("+fie+")*b.bhyt/100 else 0 end ) bhyt,sum(a.soluong*a.vattu) vattu, b.id_loai ";
							sql+=", a.giachenhlech, a.dachenhlech, a.cuocmothu2,a.id ";
							sql+="from "+xxx+".v_vpkhoa a,"+userid+".v_giavp b,"+userid+".btdkp_bv e,"+userid+".doituong y where a.mavp=b.id and a.madoituong=y.madoituong and a.makp=e.makp(+) and a.mabn='"+mabn+"'";
							if (loaiba==2) 
								sql+=" and a.maql<>"+maql_phongluu+" and to_date(a.ngay,'dd/mm/yy') between to_date('"+tu.Substring(0,10)+"','dd/mm/yy') and to_date('"+den.Substring(0,10)+"','dd/mm/yy')";
							else if (idkhoa!=0 && bTTRV_Theokhoa) 
							{
								sql+=" and a.idkhoa="+idkhoa;
								sql+=" and to_date(a.ngay,'dd/mm/yy') between to_date('"+tu.Substring(0,10)+"','dd/mm/yy') and to_date('"+den.Substring(0,10)+"','dd/mm/yy')";
							}
							else if(bTTRV_Ndot )
							{
								sql+=" and to_date(a.ngay,'dd/mm/yy') between to_date('"+tu.Substring(0,10)+"','dd/mm/yy') and to_date('"+den.Substring(0,10)+"','dd/mm/yy')";
							}
							#region cao vu 30/05/2013
							if(sMavaovien!="")
							{
								sql+=" and a.mavaovien in ("+sMavaovien.Trim(',')+")";
							}
							else
							{
								if (maso!="") sql+=" and a.maql in ("+maso.Substring(0,maso.Trim().Length-1)+")";
								else sql+=" and a.maql="+maql;
							}
							sql+=" and a.madoituong="+madoituong;
							#endregion
							sql+=" and a.madoituong="+madoituong;
							if (makp!="") sql+=" and a.makp='"+makp+"'";
							if (bTheongay) sql+=" and to_date(a.ngay,'dd/mm/yy') between to_date('"+tu.Substring(0,10)+"','dd/mm/yy') and to_date('"+den.Substring(0,10)+"','dd/mm/yy')";
							if (done == 0 || done == 2) sql += " and (a.done=0 and a.idttrv=0)";
							else if (done == 1) sql += " and a.done=" + done;

							if (khu!=0) sql+=" and e.khu="+khu;
							sql+=" group by a.idttrv,to_char(a.ngay,'yymmdd'),to_char(a.ngay,'dd/mm/yyyy'),a.makp,a.mavp,"+fie+",b.id_loai";
							sql+=", a.giachenhlech, a.dachenhlech, a.cuocmothu2,a.id ";
							if (bChidinh_vienphi)
							{
								sql+=" union all ";
								sql+="select a.idttrv,to_char(a.ngay,'yymmdd') yymmdd,to_char(a.ngay,'dd/mm/yyyy') ngay,a.makp,a.mavp,"+fie+" as dongia,sum(a.soluong) soluong,sum(a.soluong*("+fie+")) sotien,";
								sql+="sum(0) bhytt0107,";
								sql+="sum(case when a.madoituong=1 or y.bhyt=1 then a.soluong*("+fie+")*b.bhyt/100 else 0 end ) bhyt,sum(a.soluong*a.vattu) vattu, b.id_loai ";
								sql+=", a.giachenhlech, a.dachenhlech, 0 as cuocmothu2,a.id ";
								sql+="from "+xxx+".v_chidinh a,"+userid+".v_giavp b,"+userid+".btdkp_bv e,"+userid+".doituong y where a.mavp=b.id and a.madoituong=y.madoituong and a.makp=e.makp(+) and a.mabn='"+mabn+"'";
								if (loaiba==2) 
									sql+=" and a.maql<>"+maql_phongluu+" and to_date(a.ngay,'dd/mm/yy') between to_date('"+tu.Substring(0,10)+"','dd/mm/yy') and to_date('"+den.Substring(0,10)+"','dd/mm/yy')";
								else if (idkhoa!=0 && bTTRV_Theokhoa)
								{
									sql+=" and a.idkhoa="+idkhoa;							
									sql+=" and to_date(a.ngay,'dd/mm/yy') between to_date('"+tu.Substring(0,10)+"','dd/mm/yy') and to_date('"+den.Substring(0,10)+"','dd/mm/yy')";
								}
								else if(bTTRV_Ndot)
								{
									sql+=" and to_date(a.ngay,'dd/mm/yy') between to_date('"+tu.Substring(0,10)+"','dd/mm/yy') and to_date('"+den.Substring(0,10)+"','dd/mm/yy')";
								}

								#region cao vu 30/05/2013
								if(sMavaovien!="")
								{
									sql+=" and a.mavaovien in ("+sMavaovien.Trim(',')+")";
								}
								else
								{
									if (maso!="") sql+=" and a.maql in ("+maso.Substring(0,maso.Trim().Length-1)+")";
									else sql+=" and a.maql="+maql;
								}
								sql+=" and a.madoituong="+madoituong;
								#endregion
								if (makp!="") sql+=" and a.makp='"+makp+"'";
								if (done == 0 || done == 2) sql += " and (a.paid=0 and a.idttrv=0)";
								else if (done == 1) sql += " and (a.paid=" + done+" and a.idttrv>0)";
								if (khu!=0) sql+=" and e.khu="+khu;
								if (bTheongay) sql+=" and to_date(a.ngay,'dd/mm/yy') between to_date('"+tu.Substring(0,10)+"','dd/mm/yy') and to_date('"+den.Substring(0,10)+"','dd/mm/yy')";
								if(s_mavp_congkham.Trim()!="" && bDoituong_BHYT(madoituong) && bNhapvien_kocongkham && loaiba==1) sql+=" and (a.mavp not in ("+s_mavp_congkham+") or (a.mavp in ("+s_mavp_congkham+") and a.makp='99'))";//bbbb
								sql+=" group by a.idttrv,to_char(a.ngay,'yymmdd'),to_char(a.ngay,'dd/mm/yyyy'),a.makp,a.mavp,"+fie+",b.id_loai";
								sql+=", a.giachenhlech, a.dachenhlech,a.id ";
							}
							if (be==0) dsv=get_data(sql);
							else dsv.Merge(get_data(sql));
							be++;
							if (maql_phongluu!=0 && !bPhongluu && be<=1)// && loaiba!=2)
							{
								//sql="select a.idttrv,to_char(a.ngay,'yymmdd') yymmdd,to_char(a.ngay,'dd/mm/yyyy') ngay,a.makp,a.mavp,"+fie+" as dongia,sum(a.soluong) soluong,sum(a.soluong*("+fie+")) sotien,";
								sql="select a.idttrv,to_char(a.ngay,'yymmdd') yymmdd,to_char(a.ngay,'dd/mm/yyyy') ngay,a.makp,a.mavp,case when a.cuocmothu2=1 then "+fie+"/2 else "+fie+" end as dongia,sum(a.soluong) soluong,sum(a.soluong*(case when a.cuocmothu2=1 then "+fie+"/2 else "+fie+" end)) sotien,";//binh 040711
								sql+="sum(0) bhytt0107,";
								sql+="sum(case when a.madoituong=1 or y.bhyt=1 then a.soluong*("+fie+")*b.bhyt/100 else 0 end ) bhyt,sum(a.soluong*a.vattu) vattu, b.id_loai ";
								sql+=", a.giachenhlech, a.dachenhlech, a.cuocmothu2,a.id ";
								sql+="from xxx.v_vpkhoa a,"+userid+".v_giavp b,"+userid+".btdkp_bv e,"+userid+".doituong y where a.mavp=b.id and a.madoituong=y.madoituong and a.makp=e.makp(+) and a.mabn='"+mabn+"'";
								sql+=" and a.maql="+maql_phongluu;
								sql+=" and a.madoituong="+madoituong;
								if(!bCapcuu_noitru)
								{
									if (idkhoa!=0||bTheongay) sql+=" and to_date(a.ngay,'dd/mm/yy') between to_date('"+tu.Substring(0,10)+"','dd/mm/yy') and to_date('"+den.Substring(0,10)+"','dd/mm/yy')";//binh 030611 them trong if: ||bTheongay)
								}
								if (done == 0 || done == 2) sql += " and (a.done=0 and a.idttrv=0)";
								else if (done == 1) sql += " and a.done=" + done;
								if (khu!=0) sql+=" and to_date(a.ngay,'dd/mm/yy') between to_date('"+DateToString("dd/MM/yyyy",StringToDate(tu.Substring(0,10)).AddDays(-1))+"','dd/mm/yy') and to_date('"+tu.Substring(0,10)+"','dd/mm/yy')";
								sql+=" group by a.idttrv,to_char(a.ngay,'yymmdd'),to_char(a.ngay,'dd/mm/yyyy'),a.makp,a.mavp,"+fie+",b.id_loai";
								sql+=", a.giachenhlech, a.dachenhlech, a.cuocmothu2,a.id ";
								if (bChidinh_vienphi)
								{
									sql+=" union all ";
									sql+="select a.idttrv,to_char(a.ngay,'yymmdd') yymmdd,to_char(a.ngay,'dd/mm/yyyy') ngay,a.makp,a.mavp,"+fie+" as dongia,sum(a.soluong) soluong,sum(a.soluong*("+fie+")) sotien,";
									sql+="sum(0) bhytt0107,";
									sql+="sum(case when a.madoituong=1 or y.bhyt=1 then a.soluong*("+fie+")*b.bhyt/100 else 0 end ) bhyt,sum(a.soluong*a.vattu) vattu, b.id_loai ";
									sql+=", a.giachenhlech, a.dachenhlech , 0 as cuocmothu2,a.id ";
									sql+="from xxx.v_chidinh a,"+userid+".v_giavp b,"+userid+".btdkp_bv e,"+userid+".doituong y where a.mavp=b.id and a.madoituong=y.madoituong and a.makp=e.makp(+) and a.mabn='"+mabn+"'";
									sql+=" and a.maql="+maql_phongluu;
									sql+=" and a.madoituong="+madoituong;
									if (done == 0 || done == 2) sql += " and (a.paid=0 and a.idttrv=0)";
									else if (done == 1) sql += " and (a.paid=" + done +" and a.idttrv>0)";
									if (khu!=0) sql+=" and to_date(a.ngay,'dd/mm/yy') between to_date('"+DateToString("dd/MM/yyyy",StringToDate(tu.Substring(0,10)).AddDays(-1))+"','dd/mm/yy') and to_date('"+tu.Substring(0,10)+"','dd/mm/yy')";
									if(!bCapcuu_noitru)
									{
										if (idkhoa!=0 || bTheongay) sql+=" and to_date(a.ngay,'dd/mm/yy') between to_date('"+tu.Substring(0,10)+"','dd/mm/yy') and to_date('"+den.Substring(0,10)+"','dd/mm/yy')";//binh 030611 them trong if: ||bTheongay)
									}
									if(s_mavp_congkham.Trim()!="" && bDoituong_BHYT(madoituong) && bNhapvien_kocongkham && loaiba==1) sql+=" and (a.mavp not in ("+s_mavp_congkham+") or (a.mavp in ("+s_mavp_congkham+") and a.makp='99'))";//bbbb
									sql+=" group by a.idttrv,to_char(a.ngay,'yymmdd'),to_char(a.ngay,'dd/mm/yyyy'),a.makp,a.mavp,"+fie+",b.id_loai";
									sql+=", a.giachenhlech, a.dachenhlech,a.id ";
								}
								
								dsv.Merge(get_data_mmyy(sql,ngayvaoPL.Substring(0,10).ToString(),den.Substring(0,10).ToString(),false));
							}
						}
					}
				}
			}
			if (bCapve || loaiba==2)//in mẫu 38 PL
			{	
				
				dt1=StringToDate(tu).AddDays(-iNgaykiemke);
				dt2=StringToDate(den).AddDays(iNgaykiemke);
				y1=dt1.Year;m1=dt1.Month;
				y2=dt2.Year;m2=dt2.Month;
				mmyy="";
				for(int i=y1;i<=y2;i++)
				{
					itu=(i==y1)?m1:1;
					iden=(i==y2)?m2:12;
					for(int j=itu;j<=iden;j++)
					{
						mmyy=j.ToString().PadLeft(2,'0')+i.ToString().Substring(2,2);
						xxx=user+"d"+mmyy;
						if (dbMmyy(mmyy))
						{
							sql="select k.idttrv,to_char(k.ngay,'yymmdd') yymmdd,to_char(k.ngay,'dd/mm/yyyy') ngay,k.makp,a.mavp,a.dongia,sum(a.soluong) soluong,sum(a.soluong*a.dongia) sotien, ";
							sql+="sum(0) bhytt0107,";
							sql+="sum(case when k.maphu=1 or y.bhyt=1 then a.soluong*a.dongia*b.bhyt/100 else 0 end ) bhyt,";
							sql+="0 vattu, b.id_loai";
							sql+=", a.giachenhlech, 1 as dachenhlech ";
							sql+=" from "+xxx+".bhytkb k,"+xxx+".bhytcls a,"+userid+".v_giavp b,"+userid+".btdkp_bv e ,"+userid+".doituong y  where k.id=a.id and k.maphu=y.madoituong and a.mavp=b.id and k.makp=e.makp(+) and k.mabn='"+mabn+"'";
							if (bCapve && mavaovien!=0) sql+=" and k.mavaovien="+mavaovien;
							else
							{
								if (maso!="") sql+=" and k.maql in ("+maso.Substring(0,maso.Trim().Length-1)+")";
								else if (maql!=0 && loaiba!=2) sql+=" and k.maql="+maql;
							}
							
							//
							if (loaiba==2 && bChuyenchiphi_PK_vao_Ngoaitru==false) sql+=" and k.loaiba="+loaiba;							
							else if(bChuyenchiphi_PK_vao_Ngoaitru && loaiba==2)sql+=" and k.loaiba in(2,3) ";//binh 310511: chuyen chi phi phong kham vao phong luu
							//if (bCapve && loaiba==1) sql+=" and k.maql="+maql;
							
							if((bPL_capve || bPK_capve) && loaiba==1) sql+=" and k.loaiba in (1"+((bPL_capve)?",4":"")+((bPK_capve)?",2,3":"")+")";//toa ve cua noi tru va phong luu							
							else if(loaiba==1)sql+=" and k.loaiba in(1)";
							
							sql+=" and to_date(k.ngay,'dd/mm/yy') between to_date('"+tu.Substring(0,10)+"','dd/mm/yy') and to_date('"+den.Substring(0,10)+"','dd/mm/yy')";
							sql+=" and k.maphu="+madoituong;
							if (done == 0 || done == 2) sql += " and ((k.quyenso=0 and k.sobienlai=0) or a.sobienlai=0)";
							else if (done == 1) sql += " and (k.quyenso<>0 and k.sobienlai<>0) ";
							if (khu!=0) sql+=" and e.khu="+khu;
							sql+=" group by k.idttrv,to_char(k.ngay,'yymmdd'),to_char(k.ngay,'dd/mm/yyyy'),k.makp,a.mavp,a.dongia,b.id_loai";
							sql+=", a.giachenhlech ";
							if (be==0 || dsv==null) dsv=get_data(sql);
							else dsv.Merge(get_data(sql));
							be++;
						}
					}
				}
			}
			//			if (bNgtr && loaiba!=2)
			//			{	
			//				
			//				dt1=StringToDate(tu).AddDays(-iNgaykiemke);
			//				dt2=StringToDate(tu).AddDays(iNgaykiemke);
			//				y1=dt1.Year;m1=dt1.Month;
			//				y2=dt2.Year;m2=dt2.Month;
			//				mmyy="";
			//				for(int i=y1;i<=y2;i++)
			//				{
			//					itu=(i==y1)?m1:1;
			//					iden=(i==y2)?m2:12;
			//					for(int j=itu;j<=iden;j++)
			//					{
			//						mmyy=j.ToString().PadLeft(2,'0')+i.ToString().Substring(2,2);
			//						xxx=user+"d"+mmyy;
			//						if (dbMmyy(mmyy))
			//						{
			//							sql="select  k.idttrv,to_char(k.ngay,'yymmdd') yymmdd,to_char(k.ngay,'dd/mm/yyyy') ngay,k.makp,a.mavp,a.dongia,sum(a.soluong) soluong,sum(a.soluong*a.dongia) sotien, ";
			//							sql+="sum(0) bhytt0107,";
			//							sql+="sum(case when k.maphu=1 or y.bhyt=1 then a.soluong*a.dongia*b.bhyt/100 else 0 end ) bhyt,";
			//							sql+="0 vattu, b.id_loai ";
			//							sql+=", a.giachenhlech, 1 as dachenhlech ";
			//							sql+=" from "+xxx+".bhytkb k,"+xxx+".bhytcls a,"+userid+".v_giavp b,"+userid+".btdkp_bv e, "+userid+".doituong y where k.id=a.id and k.maphu=y.madoituong and a.mavp=b.id and k.makp=e.makp(+) and k.mabn='"+mabn+"'";
			//							sql+=" and to_date(k.ngay,'dd/mm/yy') between to_date('"+tu.Substring(0,10)+"','dd/mm/yy') and to_date('"+tu.Substring(0,10)+"','dd/mm/yy')";
			//							sql+=" and k.maphu="+madoituong;//sql+=" and k.maphu=1";//+madoituong;
			//							if (maso!="") sql+=" and k.maql in ("+maso.Substring(0,maso.Trim().Length-1)+")";
			//							else sql+=" and k.maql="+maql;
			//							if (done == 0 || done == 2) sql += " and (k.quyenso=0 and k.sobienlai=0)";
			//							else if (done == 1) sql += " and (k.quyenso<>0 and k.sobienlai<>0)";
			//							if (khu!=0) sql+=" and e.khu="+khu;
			//							sql+=" group by k.idttrv,to_char(k.ngay,'yymmdd'),to_char(k.ngay,'dd/mm/yyyy'),k.makp,a.mavp,a.dongia,b.id_loai";							
			//							sql+=", a.giachenhlech ";
			//							if (be==0) dsv=get_data(sql);
			//							else dsv.Merge(get_data(sql));
			//							be++;
			//						}
			//					}
			//				}
			//			}
			if (bThongtu03)
			{
				sql="select 0 as idttrv,to_char(a.ngay,'yymmdd') yymmdd,to_char(a.ngay,'dd/mm/yyyy') ngay,a.makp,c.mavp,b.gia_th+b.vattu_th as dongia,sum(a.somat) soluong,sum(a.somat*(b.gia_th+b.vattu_th)) sotien, ";
				sql+="sum(0) bhytt0107,";
				sql+="sum(case when a.madoituong=1 or y.bhyt=1 then a.somat*(b.gia_th+b.vattu_th)*b.bhyt/100 else 0 end ) bhyt,";
				sql+="sum(a.somat*b.vattu_th) vattu, b.id_loai, 0 as giachenhlech,0 id from pttt a,v_giavp b,dmpttt c,btdkp_bv e, doituong y where a.mapt=c.mapt and a.madoituong=y.madoituong and c.mavp=b.id and a.makp=e.makp(+) and a.mabn='"+mabn+"'";
				sql+=" and to_date(a.ngay,'dd/mm/yy') between to_date('"+tu.Substring(0,10)+"','dd/mm/yy') and to_date('"+den.Substring(0,10)+"','dd/mm/yy')";
				sql+=" and a.madoituong="+madoituong;
				if (makp!="") sql+=" and a.makp='"+makp+"'";
				if (khu!=0) sql+=" and e.khu="+khu;
				sql+=" group by 0,to_char(a.ngay,'yymmdd'),to_char(a.ngay,'dd/mm/yyyy'),a.makp,c.mavp,b.gia_th+b.vattu_th,b.id_loai";
				if (be==0) dsv=get_data(sql);
				else dsv.Merge(get_data(sql));
				be++;
			}
			int nhom_khac=Nhom_khac;
			long tien_khac=Tienkhac;
			string yymmdd=den.Substring(8,2)+den.Substring(3,2)+den.Substring(0,2);
			//			dsv.WriteXml("test.xml",XmlWriteMode.WriteSchema);
			if (tien_khac!=0 && madoituong==2)
			{
				sql="select 0 as idttrv,'"+yymmdd+"' as yymmdd,'"+den.Substring(0,10)+"' as ngay,'"+makp_rv+"' as makp,b.id as mavp,"+tien_khac+" as dongia,1 soluong,"+tien_khac+" as sotien, ";
				sql+="0 as bhytt0107,0 as bhyt,0 as vattu,b.id_loai, 0 as giachchenhlech,0 id ";
				sql+=" from v_giavp b,v_loaivp c where b.id_loai=c.id and c.id_nhom="+nhom_khac+" and b.gia_th="+tien_khac;
				if (be==0) dsv=get_data(sql);
				else dsv.Merge(get_data(sql));
			}
			if ((loaiba==1 || loaiba==4) && done==2)
			{
				if ((bPhonggiuong || bGiuong_block) && bTienGiuongTudong_khongtinh==false)
				{
					if (be==0)
					{
						sql="select 0 as idttrv,'"+yymmdd+"' as yymmdd,'"+den.Substring(0,10)+"' as ngay,'"+makp_rv+"' as makp,b.id as mavp,0 as dongia,1 soluong,0 as sotien, ";
						sql+="0 as bhytt0107,0 as bhyt,0 as vattu,b.id_loai, 0 as giachenhlech,0 id ";
						sql+=" from v_giavp b,v_loaivp c where b.id_loai=c.id and c.id_nhom=-1 and b.gia_th=-1";
						dsv=get_data(sql);
					}
					sql="select a.mabn,a.id,a.makp,a.idkhoa,to_char(a.tu,'dd/mm/yyyy hh24:mi') as tu,a.dongia,a.idgiuong,a.madoituong,c.dichvu";
					sql+=" from theodoigiuong a,dmgiuong b,dmphong c where a.idgiuong=b.id and b.idphong=c.id ";
					sql+=" and maql="+maql+" and madoituong="+madoituong;
					sql+=" and a.soluong=0";
					sql+=" and to_char(a.tu,'dd/mm/yyyy')<>to_char(nvl(a.den,to_date('01/01/9999','dd/mm/yyyy')),'dd/mm/yyyy')";
					foreach(DataRow r1 in get_data(sql).Tables[0].Rows)
						songayblock(dsv,StringToDateTime(den),StringToDateTime(r1["tu"].ToString()),den,long.Parse(r1["id"].ToString()),r1["mabn"].ToString(),maql,long.Parse(r1["idkhoa"].ToString()),den,r1["makp"].ToString(),int.Parse(r1["madoituong"].ToString()),decimal.Parse(r1["dongia"].ToString()),int.Parse(r1["idgiuong"].ToString()));
				}
			}
			return (be==0)?null:dsv.Tables[0];
		}

		private decimal get_tamung_ct(int khu,string mabn,long maql,long idkhoa
			,string tu,string den,string makp,int madoituong,int done
			,long maql_phongluu,int loaiba,string maso
			,bool bTheongay,string ngayvaovien)
		{
			#region cao vu 31/05/2013
			string sMavaovien="";
			if(bVP_ChuyenPhongKham_NoiTru)
			{
				sMavaovien=get_mavaovien_noitru(mabn,ngayvaovien);
				//sMavaovien=get_mavaovien(maql).ToString();
			}
			#endregion
			decimal ret=0;					
			DateTime dt1=StringToDate(tu).AddDays(-iNgaykiemke);
			DateTime dt2=StringToDate(den).AddDays(iNgaykiemke);
			int y1=dt1.Year,m1=dt1.Month;
			int y2=dt2.Year,m2=dt2.Month;
			int itu,iden;
			string mmyy="",s="",xxx;
			bool b701306=Mabv_so==701306,bNguoithu=!bTamung_konguoithu;
			if (maso!="" && maql_phongluu!=0) maso=maso.Replace(maql_phongluu.ToString()+",","");
			for(int i=y1;i<=y2;i++)
			{
				itu=(i==y1)?m1:1;
				iden=(i==y2)?m2:12;
				for(int j=itu;j<=iden;j++)
				{
					mmyy=j.ToString().PadLeft(2,'0')+i.ToString().Substring(2,2);
					xxx=user+mmyy;
					if (bMmyy(mmyy))
					{
						sql="select sum(a.sotien) sotien, a.quyenso, b.sohieu,a.sobienlai,to_char(a.ngay,'dd/mm/yyyy') as ngay,f.hoten ";
						sql+=" from "+xxx+".v_tamung a, "+user+".v_quyenso b,"+userid+".btdkp_bv e,"+userid+".v_dlogin f";
						sql+=" where a.quyenso=b.id(+) and a.makp=e.makp(+) and a.userid=f.id(+) and a.mabn='"+mabn+"'";
						if (loaiba==2) 
							sql+=" and a.maql<>"+maql_phongluu+" and to_date(a.ngay,'dd/mm/yy') between to_date('"+tu.Substring(0,10)+"','dd/mm/yy') and to_date('"+den.Substring(0,10)+"','dd/mm/yy')";
						else
						{
							if (idkhoa!=0)
							{
								sql+=" and (a.idkhoa="+idkhoa+" or a.idkhoa=0)";
								sql+=" and to_date(a.ngay,'dd/mm/yy') between to_date('"+tu.Substring(0,10)+"','dd/mm/yy') and to_date('"+den.Substring(0,10)+"','dd/mm/yy')";
							}
							#region cao vu 31/05/2013
							if(sMavaovien!="")
							{
								sql+=" and a.mavaovien in ("+sMavaovien.Trim(',')+")";
							}
							else
							{
								if (maso!="") sql+=" and a.maql in ("+maso.Substring(0,maso.Trim().Length-1)+")";
								else sql+=" and (a.maql="+maql+" or a.maql=0)";
							}
							#endregion
						}
						if (bTheongay) sql+=" and to_date(a.ngay,'dd/mm/yy') between to_date('"+tu.Substring(0,10)+"','dd/mm/yy') and to_date('"+den.Substring(0,10)+"','dd/mm/yy')";
						sql+=" and a.madoituong="+madoituong;
						if (makp!="") sql+=" and a.makp='"+makp+"'";
						if (khu!=0) sql+=" and e.khu="+khu;
						else if (!b701306)
						{
							if (done==1) sql+=" and (a.done="+done+" and a.idttrv=0)"; 
							else if (done==0 || done==2) sql+=" and (a.done=0 or a.idttrv=0)";
						}
						sql+=" group by a.quyenso, b.sohieu, a.sobienlai,to_char(a.ngay,'dd/mm/yyyy'),f.hoten ";
						
						ds=get_data(sql);
						
						foreach(DataRow r in ds.Tables[0].Rows)
						{
							ret+=decimal.Parse(r["sotien"].ToString());
							b_sobienlaitamung+=r["sohieu"].ToString().Trim()+"-"+r["sobienlai"].ToString().Trim()+" "+r["ngay"].ToString()+((bNguoithu)?" Người thu :"+r["hoten"].ToString().Trim():"")+" :"+r["sotien"].ToString().Trim()+";";
							s+=r["quyenso"].ToString().Trim()+"-"+r["sobienlai"].ToString().Trim()+" "+r["ngay"].ToString()+((bNguoithu)?" Người thu :"+r["hoten"].ToString().Trim():"")+";";
						}
						if (maql_phongluu!=0)// && loaiba!=2)
						{
							sql="select sum(a.sotien) sotien,a.quyenso,b.sohieu,a.sobienlai,to_char(a.ngay,'dd/mm/yyyy') as ngay,f.hoten ";
							sql+=" from "+xxx+".v_tamung a, "+user+".v_quyenso b,"+userid+".btdkp_bv e,"+userid+".v_dlogin f";
							sql+=" where a.quyenso=b.id(+) and a.makp=e.makp(+) and a.userid=f.id(+) and a.mabn='"+mabn+"'";
							sql+=" and a.maql="+maql_phongluu;
							sql+=" and a.madoituong="+madoituong;
							if (idkhoa!=0) sql+=" and to_date(a.ngay,'dd/mm/yy') between to_date('"+tu.Substring(0,10)+"','dd/mm/yy') and to_date('"+den.Substring(0,10)+"','dd/mm/yy')";
							else if (!b701306)
							{
								if (done==1) sql+=" and (a.done="+done+" and a.idttrv=0)";
								else if (done==0 || done==2) sql+=" and (a.done=0 or a.idttrv=0)";//and
							}
							sql+=" group by a.quyenso,b.sohieu,a.sobienlai,to_char(a.ngay,'dd/mm/yyyy'),f.hoten ";
							ds=get_data(sql);					
							foreach(DataRow r in ds.Tables[0].Rows)
							{
								ret+=decimal.Parse(r["sotien"].ToString());
								if(b_sobienlaitamung.IndexOf(r["sohieu"].ToString().Trim()+"-"+r["sobienlai"].ToString().Trim())<0)
								{
									b_sobienlaitamung+=r["sohieu"].ToString().Trim()+"-"+r["sobienlai"].ToString().Trim()+" "+r["ngay"].ToString()+((bNguoithu)?" Người thu :"+r["hoten"].ToString().Trim():"")+" :"+r["sotien"].ToString().Trim()+";";
								}
								s+=r["quyenso"].ToString().Trim()+"-"+r["sobienlai"].ToString().Trim()+" "+r["ngay"].ToString()+((bNguoithu)?" Người thu :"+r["hoten"].ToString().Trim():"")+";";
							}
						}
					}
				}
			}
			//hoan tra
			for(int i=y1;i<=y2;i++)
			{
				itu=(i==y1)?m1:1;
				iden=(i==y2)?m2:12;
				for(int j=itu;j<=iden;j++)
				{
					mmyy=j.ToString().PadLeft(2,'0')+i.ToString().Substring(2,2);
					xxx=user+mmyy;
					if (bMmyy(mmyy))
					{
						sql="select sum(a.sotien) sotien, a.quyenso, b.sohieu,a.sobienlai,to_char(a.ngay,'dd/mm/yyyy') as ngay,f.hoten ";
						sql+=" from "+xxx+".v_hoantra a, "+user+".v_quyenso b,"+userid+".btdkp_bv e,"+userid+".v_dlogin f";
						sql+=" where a.quyenso=b.id(+) and a.makp=e.makp(+) and a.userid=f.id(+) and a.mabn='"+mabn+"'";
						sql+=" and to_date(a.ngayud,'dd/mm/yy') between to_date('"+tu.Substring(0,10)+"','dd/mm/yy') and to_date('"+den.Substring(0,10)+"','dd/mm/yy')";
						sql+=" and a.loaibn=2";
						sql+=" group by a.quyenso, b.sohieu, a.sobienlai,to_char(a.ngay,'dd/mm/yyyy'),f.hoten ";
						ds=get_data(sql);					
						foreach(DataRow r in ds.Tables[0].Rows)
						{
							if (s.IndexOf(r["quyenso"].ToString().Trim()+"-"+r["sobienlai"].ToString().Trim())!=-1)
							{
								ret-=decimal.Parse(r["sotien"].ToString());
								b_sobienlaitamung+="Hoàn trả "+r["sohieu"].ToString().Trim()+"-"+r["sobienlai"].ToString().Trim()+" "+r["ngay"].ToString()+((bNguoithu)?" Người thu :"+r["hoten"].ToString().Trim():"")+" :"+r["sotien"].ToString().Trim()+";";
							}
						}
					}
				}  
			}
			return ret;
		}

		private decimal get_tamung_ct_424(int khu,string mabn,long maql,long idkhoa,string tu,string den,string makp,int madoituong,int done,long maql_phongluu,int loaiba,string maso)
		{
			decimal ret=0;	
			DateTime dt1=StringToDate(tu).AddDays(-iNgaykiemke);
			DateTime dt2=StringToDate(den).AddDays(iNgaykiemke);
			int y1=dt1.Year,m1=dt1.Month;
			int y2=dt2.Year,m2=dt2.Month;
			int itu,iden;
			bool bNguoithu=!bTamung_konguoithu;
			string mmyy="",s="",xxx;
			for(int i=y1;i<=y2;i++)
			{
				itu=(i==y1)?m1:1;
				iden=(i==y2)?m2:12;
				for(int j=itu;j<=iden;j++)
				{
					mmyy=j.ToString().PadLeft(2,'0')+i.ToString().Substring(2,2);
					xxx=user+mmyy;
					if (bMmyy(mmyy))
					{
						sql="select sum(a.sotien) sotien, a.quyenso, b.sohieu,a.sobienlai,to_char(a.ngay,'dd/mm/yyyy') as ngay,f.hoten ";
						sql+=" from "+xxx+".v_tamung a, "+user+".v_quyenso b,"+userid+".btdkp_bv e,"+userid+".v_dlogin f";
						sql+=" where a.quyenso=b.id(+) and a.makp=e.makp(+) and a.userid=f.id(+) and a.mabn='"+mabn+"'";
						if (loaiba==2) 
							sql+=" and a.maql<>"+maql_phongluu+" and to_date(a.ngay,'dd/mm/yy') between to_date('"+tu.Substring(0,10)+"','dd/mm/yy') and to_date('"+den.Substring(0,10)+"','dd/mm/yy')";
						else
						{
							if (idkhoa!=0)
							{
								sql+=" and (a.idkhoa="+idkhoa+" or a.idkhoa=0)";
								sql+=" and to_date(a.ngay,'dd/mm/yy') between to_date('"+tu.Substring(0,10)+"','dd/mm/yy') and to_date('"+den.Substring(0,10)+"','dd/mm/yy')";
							}
						}
						//if (maso!="") sql+=" and a.maql in ("+maso.Substring(0,maso.Trim().Length-1)+")";
						//else sql+=" and (a.maql="+maql+" or a.maql=0)";
						sql+=" and to_date(a.ngay,'dd/mm/yy') between to_date('"+tu.Substring(0,10)+"','dd/mm/yy') and to_date('"+den.Substring(0,10)+"','dd/mm/yy')";
						sql+=" and a.madoituong="+madoituong;
						if (makp!="") sql+=" and a.makp='"+makp+"'";
						if (khu!=0) sql+=" and e.khu="+khu;
						else
						{
							if (done==1) sql+=" and (a.done="+done+" and a.idttrv=0)";
							else if (done==0 || done==2) sql+=" and (a.done=0 and a.idttrv=0)";
						}
						sql+=" group by a.quyenso, b.sohieu, a.sobienlai,to_char(a.ngay,'dd/mm/yyyy'),f.hoten ";
						ds=get_data(sql);					
						foreach(DataRow r in ds.Tables[0].Rows)
						{
							ret+=decimal.Parse(r["sotien"].ToString());
							if(b_sobienlaitamung.IndexOf(r["sohieu"].ToString().Trim()+"-"+r["sobienlai"].ToString().Trim())<0)
							{
								b_sobienlaitamung+=r["sohieu"].ToString().Trim()+"-"+r["sobienlai"].ToString().Trim()+" "+r["ngay"].ToString()+((bNguoithu)?" Người thu :"+r["hoten"].ToString().Trim():"")+" :"+r["sotien"].ToString().Trim()+";";
							}
							s+=r["quyenso"].ToString().Trim()+"-"+r["sobienlai"].ToString().Trim()+" "+r["ngay"].ToString()+((bNguoithu)?" Người thu :"+r["hoten"].ToString().Trim():"")+";";
						}
						if (maql_phongluu!=0)// && loaiba!=2)
						{
							sql="select sum(a.sotien) sotien,a.quyenso,b.sohieu,a.sobienlai,to_char(a.ngay,'dd/mm/yyyy') as ngay,f.hoten ";
							sql+=" from "+xxx+".v_tamung a, "+user+".v_quyenso b,"+userid+".btdkp_bv e,"+userid+".v_dlogin f";
							sql+=" where a.quyenso=b.id(+) and a.makp=e.makp(+) and a.userid=f.id(+) and a.mabn='"+mabn+"'";
							sql+=" and a.maql="+maql_phongluu;
							sql+=" and a.madoituong="+madoituong;
							if (idkhoa!=0) sql+=" and to_date(a.ngay,'dd/mm/yy') between to_date('"+tu.Substring(0,10)+"','dd/mm/yy') and to_date('"+den.Substring(0,10)+"','dd/mm/yy')";
							else
							{
								if (done==1) sql+=" and (a.done="+done+" and a.idttrv=0)";
								else if (done==0 || done==2) sql+=" and (a.done=0 and a.idttrv=0)";
							}
							sql+=" group by a.quyenso,b.sohieu,a.sobienlai,to_char(a.ngay,'dd/mm/yyyy'),f.hoten ";
							ds=get_data(sql);					
							foreach(DataRow r in ds.Tables[0].Rows)
							{
								ret+=decimal.Parse(r["sotien"].ToString());
								if(b_sobienlaitamung.IndexOf(r["sohieu"].ToString().Trim()+"-"+r["sobienlai"].ToString().Trim())<0)
								{
									b_sobienlaitamung+=r["sohieu"].ToString().Trim()+"-"+r["sobienlai"].ToString().Trim()+" "+r["ngay"].ToString()+((bNguoithu)?" Người thu :"+r["hoten"].ToString().Trim():"")+" :"+r["sotien"].ToString().Trim()+";";
								}
								s+=r["quyenso"].ToString().Trim()+"-"+r["sobienlai"].ToString().Trim()+" "+r["ngay"].ToString()+((bNguoithu)?" Người thu :"+r["hoten"].ToString().Trim():"")+";";
							}
						}
					}
				}
			}
			//hoan tra
			for(int i=y1;i<=y2;i++)
			{
				itu=(i==y1)?m1:1;
				iden=(i==y2)?m2:12;
				for(int j=itu;j<=iden;j++)
				{
					mmyy=j.ToString().PadLeft(2,'0')+i.ToString().Substring(2,2);
					xxx=user+mmyy;
					if (bMmyy(mmyy))
					{
						sql="select sum(a.sotien) sotien, a.quyenso, b.sohieu,a.sobienlai,to_char(a.ngay,'dd/mm/yyyy') as ngay,f.hoten ";
						sql+=" from "+xxx+".v_hoantra a, "+user+".v_quyenso b,"+userid+".btdkp_bv e,"+userid+".v_dlogin f";
						sql+=" where a.quyenso=b.id(+) and a.makp=e.makp(+) and a.userid=f.id(+) and a.mabn='"+mabn+"'";
						sql+=" and to_date(a.ngay,'dd/mm/yy') between to_date('"+tu.Substring(0,10)+"','dd/mm/yy') and to_date('"+den.Substring(0,10)+"','dd/mm/yy')";
						sql+=" and a.loaibn=2";
						sql+=" group by a.quyenso, b.sohieu, a.sobienlai,to_char(a.ngay,'dd/mm/yyyy'),f.hoten ";
						ds=get_data(sql);					
						foreach(DataRow r in ds.Tables[0].Rows)
						{
							//if (s.IndexOf(r["quyenso"].ToString().Trim()+"-"+r["sobienlai"].ToString().Trim()+";")!=-1)
							//{
							ret-=decimal.Parse(r["sotien"].ToString());
							if(b_sobienlaitamung.IndexOf("Hoàn trả "+r["sohieu"].ToString().Trim()+"-"+r["sobienlai"].ToString().Trim())<0)
							{
								b_sobienlaitamung+="Hoàn trả "+r["sohieu"].ToString().Trim()+"-"+r["sobienlai"].ToString().Trim()+" "+r["ngay"].ToString()+((bNguoithu)?" Người thu :"+r["hoten"].ToString().Trim():"")+" :"+r["sotien"].ToString().Trim()+";";
							}
							//}
						}
					}
				}  
			}
			return ret;
		}
		//cao vu 26/06
		public string get_tamung(string mabn,string maso,string tu,string den)
		{
			decimal ret=0;
			
			
			DateTime dt1=StringToDate(tu).AddDays(-iNgaykiemke);
			DateTime dt2=StringToDate(den).AddDays(iNgaykiemke);
			int y1=dt1.Year,m1=dt1.Month;
			int y2=dt2.Year,m2=dt2.Month;
			int itu,iden;
			string mmyy="",s="",xxx;
			for(int i=y1;i<=y2;i++)
			{
				itu=(i==y1)?m1:1;
				iden=(i==y2)?m2:12;
				for(int j=itu;j<=iden;j++)
				{
					mmyy=j.ToString().PadLeft(2,'0')+i.ToString().Substring(2,2);
					xxx=user+mmyy;
					if (bMmyy(mmyy))
					{
						sql="select sum(a.sotien) sotien, a.quyenso, b.sohieu,a.sobienlai,to_char(a.ngay,'dd/mm/yyyy') as ngay,f.hoten ";
						sql+=" from "+xxx+".v_tamung a, "+user+".v_quyenso b,"+userid+".btdkp_bv e,"+userid+".v_dlogin f";
						sql+=" where a.quyenso=b.id and a.makp=e.makp(+) and a.userid=f.id and a.mabn='"+mabn+"'";
						sql+=" and to_date(a.ngay,'dd/mm/yy') between to_date('"+tu.Substring(0,10)+"','dd/mm/yy') and to_date('"+den.Substring(0,10)+"','dd/mm/yy')";
						if (maso!="") sql+=" and a.maql in ("+maso.Substring(0,maso.Trim().Length-1)+")";
						sql+=" group by a.quyenso, b.sohieu, a.sobienlai,to_char(a.ngay,'dd/mm/yyyy'),f.hoten ";
						ds=get_data(sql);					
						foreach(DataRow r in ds.Tables[0].Rows)
						{
							ret+=decimal.Parse(r["sotien"].ToString());
							s+=r["sohieu"].ToString().Trim()+"-"+r["sobienlai"].ToString().Trim()+" "+r["ngay"].ToString()+" Người thu :"+r["hoten"].ToString().Trim()+" :"+r["sotien"].ToString().Trim()+";";
						}
					}
				}
			}
			//hoan tra
			for(int i=y1;i<=y2;i++)
			{
				itu=(i==y1)?m1:1;
				iden=(i==y2)?m2:12;
				for(int j=itu;j<=iden;j++)
				{
					mmyy=j.ToString().PadLeft(2,'0')+i.ToString().Substring(2,2);
					xxx=user+mmyy;
					if (bMmyy(mmyy))
					{
						sql="select sum(a.sotien) sotien, a.quyenso, b.sohieu,a.sobienlai,to_char(a.ngay,'dd/mm/yyyy') as ngay,f.hoten ";
						sql+=" from "+xxx+".v_hoantra a, "+user+".v_quyenso b,"+userid+".btdkp_bv e,"+userid+".v_dlogin f";
						sql+=" where a.quyenso=b.id and a.makp=e.makp(+) and a.userid=f.id and a.mabn='"+mabn+"'";
						sql+=" and to_date(a.ngay,'dd/mm/yy') between to_date('"+tu.Substring(0,10)+"','dd/mm/yy') and to_date('"+den.Substring(0,10)+"','dd/mm/yy')";
						sql+=" and a.loaibn=2";
						sql+=" group by a.quyenso, b.sohieu, a.sobienlai,to_char(a.ngay,'dd/mm/yyyy'),f.hoten ";
						ds=get_data(sql);					
						foreach(DataRow r in ds.Tables[0].Rows)
						{
							if (s.IndexOf(r["quyenso"].ToString().Trim()+"-"+r["sobienlai"].ToString().Trim()+";")!=-1)
							{
								ret-=decimal.Parse(r["sotien"].ToString());
								s+="Hoàn trả "+r["sohieu"].ToString().Trim()+"-"+r["sobienlai"].ToString().Trim()+" "+r["ngay"].ToString()+" Người thu :"+r["hoten"].ToString().Trim()+" :"+r["sotien"].ToString().Trim()+";";
							}
						}
					}
				}  
			}
			return ret.ToString()+"^"+s;
		}

		public decimal hoantra_tamung(string mabn,string s,string tu,string den)
		{
			decimal ret=0;
			
			DateTime dt1=StringToDate(tu).AddDays(-iNgaykiemke);
			DateTime dt2=StringToDate(den).AddDays(iNgaykiemke);
			int y1=dt1.Year,m1=dt1.Month;
			int y2=dt2.Year,m2=dt2.Month;
			int itu,iden;
			string mmyy="",xxx;
			for(int i=y1;i<=y2;i++)
			{
				itu=(i==y1)?m1:1;
				iden=(i==y2)?m2:12;
				for(int j=itu;j<=iden;j++)
				{
					mmyy=j.ToString().PadLeft(2,'0')+i.ToString().Substring(2,2);
					xxx=user+mmyy;
					if (bMmyy(mmyy))
					{
						sql="select sum(a.sotien) sotien, a.quyenso,a.sobienlai  from "+xxx+".v_hoantra a, "+user+".v_quyenso b where a.quyenso=b.id and a.mabn='"+mabn+"'";
						sql+=" and to_date(a.ngay,'dd/mm/yy') between to_date('"+tu.Substring(0,10)+"','dd/mm/yy') and to_date('"+den.Substring(0,10)+"','dd/mm/yy')";
						sql+=" and a.loaibn=2";
						sql+=" group by a.quyenso,a.sobienlai";
						ds=get_data(sql);					
						foreach(DataRow r in ds.Tables[0].Rows)
						{
							if (s.IndexOf(r["quyenso"].ToString().Trim()+"-"+r["sobienlai"].ToString().Trim()+";")!=-1)
								ret+=decimal.Parse(r["sotien"].ToString());
						}
					}
				}  
			}
			return ret;
		}

		public DataSet sort_ttravien_ct(string _mmyy,string _ngay,int loaiba,DataTable dtdt,DataRow [] dr,string makp_rv,bool ngia,DataTable dtvp,DataTable dt, int madoituongvao)
		{
			//linh
			string s_nhomvienphichiphivanchuyen=TenNhomVienPhiVanChuyen;
			DataRow row_locthe;
			bool bBHYT_Traituyen_tinhtheo_Tyle_khac=bBHYT_Traituyen_tinh_Tyle_khac;
			//bool bCPVC_TinhTyLe=bCPVC_TinhTyLe;
			bool bInchuky=(Thongso("ttrvchuky")=="1");
			if(bInchuky)sql="select * from dmbs";
			else sql="select ma, hoten, makp, mapk from dmbs";
			DataTable dtbs=get_data(sql).Tables[0];			
			bool Phongluu_bhyt_khambenh=bPhongluu_bhyt_khambenh,bhyt20_khambenh,Ngoaitru_bhyt_khambenh=bNgoaitru_bhyt_khambenh,btraituyen_bhtra=bTraituyen_bhtra,Noitru_bhyt_khambenh=bNoitru_bhyt_khambenh;
			string s_madoituong_bhyt="1";
			foreach(DataRow drdt in dtdt.Select("madoituong<>1 and bhyt>0"))
			{
				s_madoituong_bhyt+=","+drdt["madoituong"].ToString();
			}
			byte[] image=new byte[0];
			byte[] imagetk=new byte[0];
			DataSet dsxml=new DataSet();
			dsxml.ReadXml("..\\..\\..\\xml\\m_inravien.xml");
			dsxml.Tables[0].Columns.Add("Image", typeof(byte[]));
				dsxml.Tables[0].Columns.Add("Imagetk", typeof(byte[]));
					try{dsxml.Tables[0].Columns.Add("KYTHUAT", typeof(decimal));}
					catch{}		
			try{dsxml.Tables[0].Columns.Add("IDTTRV", typeof(decimal));}
			catch{}				
			dsxml.Tables[0].Columns.Add("kyhieu");
			dsxml.Tables[0].Columns.Add("sobienlai");
			dsxml.Tables[0].Columns.Add("mainkey");
			dsxml.Tables[0].Columns.Add("traituyen",typeof(decimal));
			dsxml.Tables[0].Columns.Add("tbh", typeof(decimal));
			dsxml.Tables[0].Columns.Add("tbn", typeof(decimal));
			dsxml.Tables[0].Columns.Add("tltraituyen", typeof(decimal));
			dsxml.Tables[0].Columns.Add("dbh", typeof(decimal));
			dsxml.Tables[0].Columns.Add("dbn", typeof(decimal));
			dsxml.Tables[0].Columns.Add("tlchitra", typeof(decimal));
			dsxml.Tables[0].Columns.Add("tong_tu", typeof(decimal)).DefaultValue=0;
			dsxml.Tables[0].Columns.Add("bienlai_tu", typeof(string));
			dsxml.Tables[0].Columns.Add("chenhlech", typeof(decimal)).DefaultValue=0;
			dsxml.Tables[0].Columns.Add("giachenhlech", typeof(decimal)).DefaultValue=0;
			dsxml.Tables[0].Columns.Add("chiphiktcao", typeof(decimal)).DefaultValue=0;
			dsxml.Tables[0].Columns.Add("bhyttracao", typeof(decimal)).DefaultValue=0;
			dsxml.Tables[0].Columns.Add("vattu", typeof(decimal)).DefaultValue=0;
			dsxml.Tables[0].Columns.Add("bhyttra_ct", typeof(decimal)).DefaultValue=0;
			dsxml.Tables[0].Columns.Add("bntra_ct", typeof(decimal)).DefaultValue=0;
			dsxml.Tables[0].Columns.Add("mien_ct", typeof(decimal)).DefaultValue=0;
			dsxml.Tables[0].Columns.Add("vuottuyen", typeof(decimal)).DefaultValue=-1;
			dsxml.Tables[0].Columns.Add("dinhmucktcao", typeof(decimal)).DefaultValue=0;
			dsxml.Tables[0].Columns.Add("mucdongchitra", typeof(decimal)).DefaultValue=0;
			try{dsxml.Tables[0].Columns.Add("ID",typeof(decimal));}
			catch{}
			try{dsxml.Tables[0].Columns.Add("ID_KTCAO",typeof(decimal));}
			catch{}
			try{dsxml.Tables[0].Columns.Add("VUOTTRAN",typeof(decimal));}
			catch{}
			decimal d_dinhmucktcao=ck2_ca3_26, d_mucdongchitra=decimal.Parse(ma13_st(nhom_duoc).ToString());

			dichso.numbertotext doiso=new dichso.numbertotext();
			string matt="",ma="",sothe="",s="";int madt=0,khu=0;
			decimal tcsotien=0,tcbhyt=0,tcbhytt0107=0,stbhyt=0,bnt=0,bht=0,tbh,tbn,st,ztc=0;
			decimal d_chiphi_ktcao=0, d_chiphi_ktcao_dinhmuc=muc_khongqua;
			int iTraituyen=iTraituyen_bhyt;
			DataRow r,r1;decimal tc=0;
			int sophieu=0,lanin=0;
			bool bFound=false,bTruongkhoa=false;
			int nhom=nhom_duoc,maphu=0;
			decimal chitra=80, chitra_tt=100;
			decimal dDichvuKhongcungchitra=0,d_dichvu_tt_bhyttra=0,d_dichvu_tt_bntra=0;
			//
			DataTable table2 = get_data("select id,locthe, sothe from d_dmbd where nhom=" + nhom + " and sothe is not null union all select id,locthe, sothe from v_giavp where sothe is not null").Tables[0];
			//
			bhyt20_khambenh=(loaiba==3) || (loaiba==2 && Ngoaitru_bhyt_khambenh) || (Phongluu_bhyt_khambenh && loaiba==4) || (Noitru_bhyt_khambenh && loaiba==1);
			if(bInchuky)
			{
				r1=getrowbyid(dtbs,"makp='"+makp_rv+"' and nhom="+truongkhoa);
				if (r1!=null)
				{
					try
					{
						imagetk =(byte[])(r1["image"]);
						bTruongkhoa=true;
					}
					catch{bTruongkhoa=false;}
				}
			}
			else bTruongkhoa=false;
			for(int i=0;i<dr.Length;i++)
			{
				dDichvuKhongcungchitra=0;d_dichvu_tt_bhyttra=0;d_dichvu_tt_bntra=0;
				if (sothe!=dr[i]["sothe"].ToString().Trim().Trim(';') || khu!=int.Parse(dr[i]["khu"].ToString()) || matt!=dr[i]["matt"].ToString() || ma!=dr[i]["mabn"].ToString() || madt!=int.Parse(dr[i]["madoituong"].ToString()))
				{					
					bFound=false;
					matt=dr[i]["matt"].ToString();ma=dr[i]["mabn"].ToString();
					madt=int.Parse(dr[i]["madoituong"].ToString());
					sothe=dr[i]["sothe"].ToString().Trim().Trim(';');
					khu=int.Parse(dr[i]["khu"].ToString());
					ztc=stbhyt=tcsotien=tcbhyt=tcbhytt0107=0;
					if (bhyt20_khambenh)
					{
						s=bntra50(dr);
						bnt=decimal.Parse(s.Substring(0,s.IndexOf("^")));
						bht=decimal.Parse(s.Substring(s.IndexOf("^")+1));
					}
					if (dr[i]["done"].ToString()=="0")
					{
						sophieu=get_sophieu_ravien(_mmyy,dr[i]["mabn"].ToString(),long.Parse(dr[i]["maql"].ToString()),loaiba,_ngay,int.Parse(dr[i]["madoituong"].ToString()),0);
						lanin=get_laninrv(_mmyy,dr[i]["mabn"].ToString(),long.Parse(dr[i]["maql"].ToString()),_ngay,int.Parse(dr[i]["madoituong"].ToString()));
						upd_sophieurv(_mmyy,dr[i]["mabn"].ToString(),long.Parse(dr[i]["maql"].ToString()),dr[i]["ghichu"].ToString());
					}
					if(bInchuky)
					{
						r1=getrowbyid(dtbs,"ma='"+dr[i]["mabs"].ToString()+"'");
						if (r1!=null)
						{
							try
							{
								image =(byte[])(r1["image"]);
								bFound=true;
							}
							catch{bFound=false;}
						}
					}
					else bFound=false;
					maphu=0;
					if (sothe!="" && bDoituong_BHYT(madt,dtdt))//if (sothe!="" && madt==1)
					{
						if (bhyt20_khambenh)
						{
							//foreach(DataRow r0 in dt.Rows) ztc+=decimal.Parse(r0["sotien"].ToString());
							foreach(DataRow r0 in dt.Select("madoituong="+madt)) 
							{								
								row_locthe = this.getrowbyid(table2, "id=" + int.Parse(r0["ma"].ToString()));
								if ((row_locthe != null) && (row_locthe["sothe"].ToString().Trim().IndexOf(r0["sothe"].ToString().Substring(2, 1)) != -1))
								{
									if(bCPVC_TinhTyLe) ztc+=decimal.Parse(r0["sotien"].ToString());
										//nhung dich vu(chi phi van chuyen) BHYT chi tra 100% --> thi khong tinh vao chi phi dinh muc 109.500
									else ztc+=0;
								}
								else ztc+=decimal.Parse(r0["sotien"].ToString());
								//
							}
							maphu=get_maphu_ngtru(sothe,ztc,nhom,dr[i]["ngayra"].ToString().Substring(0,10));
						}
						else maphu=get_maphu_noitru(sothe,nhom,dr[i]["ngayra"].ToString().Substring(0,10));
					}
				}
				tbh=tbn=0;
				if(sothe!="" && sothe != dr[i]["sothe"].ToString().Trim().Trim(';'))
				{
					tcsotien+=decimal.Parse(dr[i]["sotien"].ToString());
					tcbhyt=decimal.Parse(dr[i]["bhyt"].ToString());
					tcbhytt0107=decimal.Parse(dr[i]["bhytt0107"].ToString());
				}
				else
				{
					tcsotien+=decimal.Parse(dr[i]["sotien"].ToString());
					tcbhyt+=decimal.Parse(dr[i]["bhyt"].ToString());
					tcbhytt0107+=decimal.Parse(dr[i]["bhytt0107"].ToString());
				}
				//				if (bhyt20_khambenh && dr[i]["madoituong"].ToString()=="1" && int.Parse(dr[i]["maphu"].ToString())!=100 && int.Parse(dr[i]["maphu"].ToString())>0) 
				//					stbhyt+=0;
				//				else
				//					stbhyt+=decimal.Parse(dr[i]["sotien"].ToString());
				stbhyt=decimal.Parse(dr[i]["sotien"].ToString());
				r=dsxml.Tables[0].NewRow();
				r["bhyttra"]=0;
				r["bntra"]=0;
				r["sophieu"]=sophieu;
				r["lanin"]=lanin;
				r["mabs"]=dr[i]["mabs"].ToString();
				r["tenbs"]=dr[i]["tenbs"].ToString();
				r["tenuser"]=dr[i]["tenuser"].ToString();
				if (bFound)
				{
					try{r["image"]=image;}
					catch{}
				}
				if (bTruongkhoa)
				{
					try{r["imagetk"]=imagetk;}
					catch{}
				}
				r["dinhmucktcao"]=d_dinhmucktcao;
				r["mucdongchitra"]=d_mucdongchitra;
				r["khu"]=khu;
				r["matt"]=matt;
				r["mabn"]=ma;
				r["hoten"]=dr[i]["hoten"].ToString();
				r["maql"]=dr[i]["maql"].ToString();
				r["idkhoa"]=dr[i]["idkhoa"].ToString();
				r["namsinh"]=dr[i]["namsinh"].ToString();
				r["phai"]=dr[i]["phai"].ToString();
				r["diachi"]=dr[i]["diachi"].ToString();
				r["madoituongvao"]=madoituongvao;
				r["madoituong"]=dr[i]["madoituong"].ToString();
				r["doituong"]=dr[i]["doituong"].ToString();
				r["sothe"]=dr[i]["sothe"].ToString();
				r["maphu"]=dr[i]["maphu"].ToString();
				r["tungay"]=dr[i]["tungay"].ToString();
				r["denngay"]=dr[i]["denngay"].ToString();
				r["noigioithieu"]=dr[i]["noigioithieu"].ToString();
				r["noicap"]=dr[i]["noicap"].ToString();
				r["giuong"]=dr[i]["giuong"].ToString();
				r["makp"]=dr[i]["makp"].ToString();
				r["tenkp"]=dr[i]["tenkp"].ToString();
				r["ngayvao"]=dr[i]["ngayvao"].ToString();
				r["ngayra"]=dr[i]["ngayra"].ToString();
				r["chandoan"]=dr[i]["chandoan"].ToString();
				r["maicd"]=dr[i]["maicd"].ToString();
				r["sttnhom"]=dr[i]["sttnhom"].ToString();
				r["nhom"]=dr[i]["nhom"].ToString();
				r["sttloai"]=dr[i]["sttloai"].ToString();
				r["loai"]=dr[i]["loai"].ToString();
				r["ma"]=dr[i]["ma"].ToString();
				r["done"]=dr[i]["done"].ToString();
				if (ngia)
				{
					r["gia_th"]=dr[i]["gia_th"].ToString();
					r["gia_dv"]=dr[i]["gia_dv"].ToString();
					r1=getrowbyid(dtvp,"id="+int.Parse(dr[i]["ma"].ToString()));
					if (r1!=null)
					{
						if (r["gia_th"].ToString()=="0") r["gia_th"]=r1["gia_th"].ToString();
						r["gia_bh"]=r1["gia_bh"].ToString();
						if (r["gia_dv"].ToString()=="0") r["gia_dv"]=r1["gia_dv"].ToString();
						r["gia_cs"]=r1["gia_cs"].ToString();
						r["gia_nn"]=r1["gia_nn"].ToString();
						r["chenhlech"]= r1["chenhlech"].ToString();
					}
				}
				r["ten"]=dr[i]["ten"].ToString();
				r["dvt"]=dr[i]["dvt"].ToString();
				r["soluutru"]=dr[i]["soluutru"].ToString();
				r["nguoinha"]=dr[i]["nguoinha"].ToString();
				r["hinhthuc"]=dr[i]["hinhthuc"].ToString();
				r["phuongphap"]=dr[i]["phuongphap"].ToString();
				r["ketqua"]=dr[i]["ketqua"].ToString();
				r["soluong"]=dr[i]["soluong"].ToString();
				r["dongia"]=dr[i]["dongia"].ToString();
				r["sotien"]=dr[i]["sotien"].ToString();
				r["kythuat"]=dr[i]["kythuat"].ToString();
				if(dr[i]["kythuat"].ToString()=="0")
				{
					d_chiphi_ktcao+=decimal.Parse(dr[i]["sotien"].ToString());
					r["chiphiktcao"]=dr[i]["sotien"].ToString();
				}				
				r["tamung"]=dr[i]["tamung"].ToString();
				//
				r["giachenhlech"]=dr[i]["giachenhlech"].ToString();
				//
				r["tong_tu"]=tc_tamung;
				r["bienlai_tu"]=b_tatca_sobienlaitamung;
				//
				r["loaiba"]=dr[i]["loaiba"].ToString();
				r["tcsotien"]=tcsotien;
				r["ngaypt"]=dr[i]["ngaypt"].ToString();
				r["tenpt"]=dr[i]["tenpt"].ToString();
				r["dbh"] = r["dbn"] = r["tlchitra"] = 0;
				r["tltraituyen"] = iTraituyen;
				r["mien"]=0;//BINH: GAN=0 DE KHONG BI NULL THI REPORT KHONG BI LOI
				if (bDoituong_BHYT(int.Parse(dr[i]["madoituong"].ToString()),dtdt) || dr[i]["madoituong"].ToString()=="99")//if (dr[i]["madoituong"].ToString()=="1" || dr[i]["madoituong"].ToString()=="99") //bhyt; 99 BHYT truoc 01/07/2005
				{
					row_locthe = this.getrowbyid(table2, "id=" + int.Parse(dr[i]["ma"].ToString()));
					if (bhyt20_khambenh)//thanh toan giong nhu phong kham
					{
						if (int.Parse(dr[i]["traituyen"].ToString())!=0 && iTraituyen!=0 && !btraituyen_bhtra)
						{
							//
							chitra=iTraituyen;
							if(bBHYT_Traituyen_tinhtheo_Tyle_khac)
							{		
								chitra_tt=chitra;
								#region vuot tuyen a.Binh
								/*
								r1=r1=getrowbyid(dtvp,"id="+int.Parse(dr[i]["ma"].ToString()));
								if (r1!=null && decimal.Parse(r1["bhyt_tt"].ToString())!=decimal.Parse(r1["bhyt"].ToString()))
								{
									dDichvuKhongcungchitra += decimal.Parse(dr[i]["sotien"].ToString());// *(decimal.Parse(r1["bhyt_tt"].ToString()) / 100);
									d_dichvu_tt_bhyttra += decimal.Parse(dr[i]["sotien"].ToString()) * (decimal.Parse(r1["bhyt_tt"].ToString()) / 100);
									d_dichvu_tt_bntra += decimal.Parse(dr[i]["sotien"].ToString()) * (100 - decimal.Parse(r1["bhyt_tt"].ToString())) / 100;
									r["ten"] = dr[i]["ten"].ToString() + " [trái tuyến BHYT trả " + decimal.Parse(r1["bhyt_tt"].ToString()).ToString("##") + "%]";
									chitra_tt=decimal.Parse(r1["bhyt_tt"].ToString());
								}
								r["bhyttra"] = (stbhyt - dDichvuKhongcungchitra) * chitra / 100 + bnt + d_dichvu_tt_bhyttra;//bhyttra = stbhyt * chitra / 100 + bnt;
								r["bntra"] = (stbhyt - dDichvuKhongcungchitra) - ((stbhyt - dDichvuKhongcungchitra) * chitra / 100) + bht + d_dichvu_tt_bntra;
								r["tlchitra"] =  chitra_tt;
								*/
								#endregion
								//linh
								DataRow rvp=getrowbyid(dtvp,"id="+dr[i]["ma"].ToString());
								if(rvp!=null)
								{
									if(rvp["vuottuyen"].ToString()!="-1")
									{
										chitra=int.Parse(rvp["vuottuyen"].ToString());
										r["vuottuyen"]=chitra;
									}
								}
								//end vuot tuyen
								r["bhyttra"]=stbhyt*chitra/100+bnt;
								r["bntra"]=stbhyt-(stbhyt*chitra/100)+bht;
								r["tlchitra"] =  chitra;
								
							}
							else
							{
								//đúng tuyến							
								r["bhyttra"]=stbhyt*chitra/100+bnt;
								r["bntra"]=stbhyt-(stbhyt*chitra/100)+bht;
								r["tlchitra"] =  chitra;
								
							}
						}
						else
						{
							//							maphu=get_maphu_ngtru(dr[i]["sothe"].ToString(),tcsotien,nhom);
							if (maphu!=0)
							{
								chitra=(maphu==1)?80:95;
								//linh chi phi van chuyen
								if(dr[i]["nhom"].ToString()==s_nhomvienphichiphivanchuyen)
								{
									//thanhcuong-22082011
									if(s_Madtthehuong100cpvc.IndexOf(sothe.Substring(2,1)+",")>-1)
									{
										chitra=100;
									}
									else if(bCPVC_TinhTyLe)
									{
										if(int.Parse(dr[i]["traituyen"].ToString())!=0 && iTraituyen != 0)
										{
											chitra=iTraituyen;
										}
										else
										{
											if(row_locthe["sothe"].ToString().Trim().IndexOf(dr[i]["sothe"].ToString().Substring(2, 1)) != -1)
												chitra=(maphu==1)?80:95;
											else chitra=0;
										}
									}
									else if(!bCPVC_TinhTyLe)
									{
										if(row_locthe["sothe"].ToString().Trim().IndexOf(dr[i]["sothe"].ToString().Substring(2, 1)) == -1)
											chitra=0;
									}
									//
								}
								//end linh
								r["bhyttra"]=stbhyt*chitra/100+bnt;
								r["bntra"]=stbhyt-(stbhyt*chitra/100)+bht;
								r["tlchitra"] =  chitra;
								
							}
							else
							{
								chitra=100;
								r["bhyttra"]=tcsotien;
								r["bntra"]=0;
								r["tlchitra"] =  100;

							}
							r["dbh"] = r["bhyttra"].ToString();
							r["dbn"] = r["bntra"].ToString();
							if (int.Parse(dr[i]["traituyen"].ToString()) != 0 && iTraituyen != 0)
							{                            
								st = decimal.Parse(r["bhyttra"].ToString());
								chitra = iTraituyen;
								tbh = st * chitra / 100;
								tbn = st - (st * chitra / 100);
								r["bhyttra"]= tbh;
								r["bntra"]=decimal.Parse(r["bntra"].ToString()) + tbn;
								r["tlchitra"] =  decimal.Parse(r["bhyttra"].ToString()) / stbhyt * 100;
							}
						}
					}
					else
					{
						if (int.Parse(dr[i]["traituyen"].ToString())!=0 && iTraituyen!=0 && !btraituyen_bhtra)
						{
							chitra=iTraituyen;
							//linh vuot tuyen
							DataRow rvp=getrowbyid(dtvp,"id="+dr[i]["ma"].ToString());
							if(rvp!=null)
							{
								if(rvp["vuottuyen"].ToString()!="-1")
								{
									chitra=int.Parse(rvp["vuottuyen"].ToString());
									r["vuottuyen"]=chitra;
								}
							}
							//end vuot tuyen
							r["bhyttra"]=stbhyt*chitra/100+bnt;
							r["bntra"]=stbhyt-(stbhyt*chitra/100)+bht;
							r["tlchitra"] =  chitra;
						}
						else
						{
							//							maphu=(dr[i]["sothe"].ToString().Trim()!="")?get_maphu_noitru(dr[i]["sothe"].ToString(),nhom):0;
							if (maphu==0)
							{
								chitra=100;
								r["bhyttra"]=tcsotien;
								r["bntra"]=0;
								r["tlchitra"] =  100;
							}
							else
							{
								chitra=(maphu==1)?80:95;
								//linh chi phi va chuyen
								if(dr[i]["nhom"].ToString()==s_nhomvienphichiphivanchuyen)
								{
									//									if(s_Madtthehuong100cpvc.IndexOf(sothe.Substring(2,1)+",")>-1 )
									//									{
									//										chitra=100;
									//									}
									//									else if(!bCPVC_TinhTyLe && (row_locthe["sothe"].ToString().Trim().IndexOf(dr[i]["sothe"].ToString().Substring(2, 1)) != -1))
									//									{
									//										chitra=0;
									//									}
									//thanhcuong-22082011
									if(s_Madtthehuong100cpvc.IndexOf(sothe.Substring(2,1)+",")>-1)
									{
										chitra=100;
									}
									else if(bCPVC_TinhTyLe)
									{
										if(int.Parse(dr[i]["traituyen"].ToString())!=0 && iTraituyen != 0)
										{
											chitra=iTraituyen;
										}
										else
										{
											if(row_locthe["sothe"].ToString().Trim().IndexOf(dr[i]["sothe"].ToString().Substring(2, 1)) != -1)
												chitra=(maphu==1)?80:95;
											else chitra=0;
										}
									}
									else if(!bCPVC_TinhTyLe)
									{
										if(row_locthe["sothe"].ToString().Trim().IndexOf(dr[i]["sothe"].ToString().Substring(2, 1)) == -1)
											chitra=0;
									}
									//
								}
								//end cpvc
								r["bhyttra"]=stbhyt*chitra/100+bnt;
								r["bntra"]=stbhyt-(stbhyt*chitra/100)+bht;
								r["tlchitra"] =  chitra;
							}
							r["dbh"] = r["bhyttra"].ToString();
							r["dbn"] = r["bntra"].ToString();
							if (int.Parse(dr[i]["traituyen"].ToString()) != 0 && iTraituyen != 0)
							{                            
								st = decimal.Parse(r["bhyttra"].ToString());
								chitra = iTraituyen;
								tbh = st * chitra / 100;
								tbn = st - (st * chitra / 100);
								r["bhyttra"]= tbh;
								r["bntra"]=decimal.Parse(r["bntra"].ToString()) + tbn;
								r["tlchitra"] =  decimal.Parse(r["bhyttra"].ToString()) / stbhyt * 100;
							}
						}
					}
					//Tinh chi phia cho cac dang the dat biet: vi du: the CK2: mien cp van chuyen
					//row_locthe = this.getrowbyid(table2, "id=" + int.Parse(dr[i]["ma"].ToString()));
					if ((row_locthe != null) && (row_locthe["sothe"].ToString().Trim().IndexOf(dr[i]["sothe"].ToString().Substring(2, 1)) != -1))
					{
						//chitra = 100;
						chitra=(maphu==1)?80:95;
						if(dr[i]["nhom"].ToString()==s_nhomvienphichiphivanchuyen)
						{
							//							if(s_Madtthehuong100cpvc.IndexOf(sothe.Substring(2,1)+",")>-1 )
							//							{
							//								chitra=100;
							//							}
							//							else if(!bCPVC_TinhTyLe)
							//							{
							//								chitra=0;
							//							}
							//thanhcuong-22082011
							if(s_Madtthehuong100cpvc.IndexOf(sothe.Substring(2,1))>-1)
							{
								chitra=100;
							}
							else if(bCPVC_TinhTyLe)
							{
								if(int.Parse(dr[i]["traituyen"].ToString())!=0 && iTraituyen != 0)
								{
									chitra=iTraituyen;
								}
								else
								{
									if(row_locthe["sothe"].ToString().Trim().IndexOf(dr[i]["sothe"].ToString().Substring(2, 1)) != -1)
										chitra=(maphu==1)?80:95;
									else chitra=0;
								}
							}
							else if(!bCPVC_TinhTyLe)
							{
								if(row_locthe["sothe"].ToString().Trim().IndexOf(dr[i]["sothe"].ToString().Substring(2, 1)) == -1)
									chitra=0;
							}
							//
						}
						r["bhyttra"] = stbhyt;						
						r["bntra"] = 0;
						r["tlchitra"] = chitra;
						r["dbh"] = r["bhyttra"].ToString();
						r["dbn"] = r["bntra"].ToString();
						r["kythuat"] = 9;
					}
					//
					r["dichsotra"]=doiso.doithapphan(r["bntra"].ToString());
					//
					r["bhyttra_ct"]=decimal.Parse(dr[i]["sotien"].ToString())*chitra/100;//doi tuong bhyt chi tra chi tiet
					r["bntra_ct"]=decimal.Parse(dr[i]["sotien"].ToString())*(100-chitra)/100;//bn dong chi tra chi tiet
					//
				}
				else if (mien_doituong(int.Parse(dr[i]["madoituong"].ToString()),dtdt)) //mien
				{
					r["mien"]=tcsotien;r["bntra"]=0;r["bhyttra"]=0;
					r["mien_ct"]=dr[i]["sotien"].ToString();//doi tuong thu phi
					r["dichsotra"]=doiso.doithapphan(r["mien"].ToString());
				}
				else
				{
					r["bntra"]=tcsotien;r["bhyttra"]=0;
					r["bntra_ct"]=dr[i]["sotien"].ToString();//doi tuong thu phi
					r["dichsotra"]=doiso.doithapphan(r["bntra"].ToString());
				}
				tc=Math.Abs(decimal.Parse(r["tcsotien"].ToString()));
				r["dichso"]=((decimal.Parse(r["tcsotien"].ToString())<0)?"-":"")+doiso.doithapphan(tc.ToString());
				r["sbltamung"]=dr[i]["sbltamung"];//b_sobienlaitamung;
				r["ghichu"]=dr[i]["ghichu"].ToString();
				r["ngay1"]=dr[i]["ngay1"].ToString();
				r["ngay2"]=dr[i]["ngay2"].ToString();
				r["ngay3"]=dr[i]["ngay3"].ToString();
				r["ngay"]=dr[i]["ngay"].ToString();
				r["yyyymmdd"]=dr[i]["yyyymmdd"].ToString();
				
				r["idttrv"]=(dr[i]["idttrv"].ToString().Trim()=="")?"0":dr[i]["idttrv"].ToString().Trim();
				r["kyhieu"]=dr[i]["kyhieu"].ToString();
				r["sobienlai"]=dr[i]["sobienlai"].ToString();
				r["mainkey"]=dr[i]["khu"].ToString()+"^"+dr[i]["matt"].ToString()+"^"+dr[i]["mabn"].ToString()+"^"+dr[i]["sothe"].ToString()+"^"+dr[i]["sttnhom"].ToString()+"^"+dr[i]["tenkp"].ToString()+"^"+dr[i]["ten"].ToString()+"^"+dr[i]["ma"].ToString()+"^"+dr[i]["dongia"].ToString()+"^"+dr[i]["idttrv"].ToString();
				r["traituyen"]=dr[i]["traituyen"].ToString();
				r["tbh"] = tbh;
				r["tbn"] = tbn;
				try
				{
					r["id"]=dr[i]["id"].ToString();
				}
				catch{r["id"]=0;}
				try
				{
					r["id_ktcao"]=dr[i]["id_ktcao"].ToString();
				}
				catch{r["id_ktcao"]=0;}
				try
				{
					r["vuottran"]=dr[i]["vuottran"].ToString();
				}
				catch{r["vuottran"]=0;}
				dsxml.Tables[0].Rows.Add(r);
			}		
			#region kyhieu+sobienlai
			if (dsxml.Tables[0].Select("idttrv<>0").Length>0)
			{
				long idttrv=0;
				string tu,den,kyhieu,sobienlai;
				foreach(DataRow r2 in dsxml.Tables[0].Select("idttrv<>0","idttrv"))
				{
					if (idttrv!=long.Parse(r2["idttrv"].ToString()))
					{
						idttrv=long.Parse(r2["idttrv"].ToString());
						kyhieu=sobienlai="";
						tu=r2["ngayvao"].ToString().Substring(0,10);
						den=r2["ngayra"].ToString().Substring(0,10);
						sql="select b.sohieu,a.sobienlai from xxx.v_ttrvll a,"+user+".v_quyenso b where a.quyenso=b.id";
						sql+=" and a.id="+idttrv;
						foreach(DataRow r3 in get_data_mmyy(sql,tu,den,7).Tables[0].Rows)
						{
							kyhieu=r3["sohieu"].ToString();
							sobienlai=r3["sobienlai"].ToString();
							break;
						}
						if (kyhieu!="" && sobienlai!="")
						{
							foreach(DataRow r3 in dsxml.Tables[0].Select("idttrv="+idttrv))
							{
								r3["kyhieu"]=kyhieu;
								r3["sobienlai"]=sobienlai;
							}
						}
					}
				}
			}
			string _mabn = "", bangchu = ""; bht = bnt = 0;
			foreach (DataRow r3 in dsxml.Tables[0].Select("madoituong in ("+s_madoituong_bhyt+")", "mabn"))//foreach (DataRow r3 in dsxml.Tables[0].Select("madoituong=1", "mabn"))//dsxml.Tables[0].Select("madt=1", "mabn"))
			{
				if (_mabn == "") _mabn = r3["mabn"].ToString();
				if (_mabn != r3["mabn"].ToString())
				{
					bangchu = doiso.doithapphan(bnt.ToString());
					foreach (DataRow r0 in dsxml.Tables[0].Select("madoituong in("+s_madoituong_bhyt+") and mabn='" + _mabn + "'"))//foreach (DataRow r0 in dsxml.Tables[0].Select("madoituong=1 and mabn='" + _mabn + "'"))
					{
						r0["bhyttra"] = bht;
						r0["bntra"] = bnt;
						r0["dichsotra"] = bangchu;
					}
					bht = bnt = 0; _mabn = r3["mabn"].ToString();
				}
				chitra=(r3["tlchitra"].ToString()=="")?0:int.Parse(r3["tlchitra"].ToString());
				bht +=decimal.Parse(r3["sotien"].ToString())*chitra/100;   //decimal.Parse(r3["bhyttra"].ToString());
				bnt +=decimal.Parse(r3["sotien"].ToString())*(100-chitra)/100; //decimal.Parse(r3["bntra"].ToString());
			}
			if (bht != 0)
			{
				bangchu = doiso.doithapphan(bnt.ToString());
				foreach (DataRow r0 in dsxml.Tables[0].Select("madoituong in ("+s_madoituong_bhyt+") and mabn='" + _mabn + "'"))//foreach (DataRow r0 in dsxml.Tables[0].Select("madoituong=1 and mabn='" + _mabn + "'"))//dsxml.Tables[0].Select("madt=1 and mabn='" + _mabn + "'"))
				{
					//r0["bhyttra_ct"]=(r0["bhyttra"].ToString()=="")?"0":r0["bhyttra"].ToString();
					//r0["bntra_ct"]=(r0["bntra"].ToString()=="")?"0":r0["bntra"].ToString();
					r0["bhyttra"] = bht;
					r0["bntra"] = bnt;
					r0["dichsotra"] = bangchu;
				}
			}
			#endregion
			//dsxml.WriteXml("xxx.xml",XmlWriteMode.WriteSchema);
			return dsxml;
			
		}
		
		public DataSet sort_ttravien_ct(string _mmyy,string _ngay,int loaiba,DataTable dtdt,DataRow [] dr,string makp_rv,bool ngia,DataTable dtvp,DataTable dt, int madoituongvao,string tngaydt)
		{
			//linh
			decimal d_bhyt=0,d_bntra=0;
			//bool nhom1,nhom2;
			string huong100=huong_100+"+"+cc1_te1, huong100kqua=huong_100_khongqua+"+"+ck2_ca3,huong95kqua=bt4_hn4_ht5;
			string s_nhomvienphichiphivanchuyen=TenNhomVienPhiVanChuyen;
			DataRow row_locthe;
			bool bBHYT_Traituyen_tinhtheo_Tyle_khac=bBHYT_Traituyen_tinh_Tyle_khac;
			//bool bCPVC_TinhTyLe=bCPVC_TinhTyLe;
			bool bInchuky=(Thongso("ttrvchuky")=="1");
			if(bInchuky)sql="select * from dmbs";
			else sql="select ma, hoten, makp, mapk from dmbs";
			DataTable dtbs=get_data(sql).Tables[0];			
			bool Phongluu_bhyt_khambenh=bPhongluu_bhyt_khambenh,bhyt20_khambenh,Ngoaitru_bhyt_khambenh=bNgoaitru_bhyt_khambenh,btraituyen_bhtra=bTraituyen_bhtra,Noitru_bhyt_khambenh=bNoitru_bhyt_khambenh;
			string s_madoituong_bhyt="1";
			foreach(DataRow drdt in dtdt.Select("madoituong<>1 and bhyt>0"))
			{
				s_madoituong_bhyt+=","+drdt["madoituong"].ToString();
			}
			byte[] image=new byte[0];
			byte[] imagetk=new byte[0];
			DataSet dsxml=new DataSet();
			#region design dsxml
			dsxml.ReadXml("..\\..\\..\\xml\\m_inravien.xml");
			dsxml.Tables[0].Columns.Add("Image", typeof(byte[]));
				dsxml.Tables[0].Columns.Add("Imagetk", typeof(byte[]));
					try{dsxml.Tables[0].Columns.Add("KYTHUAT", typeof(decimal));}
					catch{}		
			try{dsxml.Tables[0].Columns.Add("IDTTRV", typeof(decimal));}
			catch{}				
			dsxml.Tables[0].Columns.Add("kyhieu");
			dsxml.Tables[0].Columns.Add("sobienlai");
			dsxml.Tables[0].Columns.Add("mainkey");
			dsxml.Tables[0].Columns.Add("traituyen",typeof(decimal));
			dsxml.Tables[0].Columns.Add("tbh", typeof(decimal));
			dsxml.Tables[0].Columns.Add("tbn", typeof(decimal));
			dsxml.Tables[0].Columns.Add("tltraituyen", typeof(decimal));
			dsxml.Tables[0].Columns.Add("dbh", typeof(decimal));
			dsxml.Tables[0].Columns.Add("dbn", typeof(decimal));
			dsxml.Tables[0].Columns.Add("tlchitra", typeof(decimal));
			dsxml.Tables[0].Columns.Add("tong_tu", typeof(decimal)).DefaultValue=0;
			dsxml.Tables[0].Columns.Add("bienlai_tu", typeof(string));
			dsxml.Tables[0].Columns.Add("chenhlech", typeof(decimal)).DefaultValue=0;
			dsxml.Tables[0].Columns.Add("giachenhlech", typeof(decimal)).DefaultValue=0;
			dsxml.Tables[0].Columns.Add("chiphiktcao", typeof(decimal)).DefaultValue=0;
			dsxml.Tables[0].Columns.Add("bhyttracao", typeof(decimal)).DefaultValue=0;
			dsxml.Tables[0].Columns.Add("vattu", typeof(decimal)).DefaultValue=0;
			dsxml.Tables[0].Columns.Add("bhyttra_ct", typeof(decimal)).DefaultValue=0;
			dsxml.Tables[0].Columns.Add("bntra_ct", typeof(decimal)).DefaultValue=0;
			dsxml.Tables[0].Columns.Add("mien_ct", typeof(decimal)).DefaultValue=0;
			dsxml.Tables[0].Columns.Add("vuottuyen", typeof(decimal)).DefaultValue=-1;
			dsxml.Tables[0].Columns.Add("dinhmucktcao", typeof(decimal)).DefaultValue=0;
			dsxml.Tables[0].Columns.Add("mucdongchitra", typeof(decimal)).DefaultValue=0;
			
			try{dsxml.Tables[0].Columns.Add("ID",typeof(decimal));}
			catch{}
			try{dsxml.Tables[0].Columns.Add("ID_KTCAO",typeof(decimal));}
			catch{}
			try{dsxml.Tables[0].Columns.Add("VUOTTRAN",typeof(decimal));}
			catch{}
			try{dsxml.Tables[0].Columns.Add("TongNgaydt",typeof(decimal));}
			catch{}
			try{dsxml.Tables[0].Columns.Add("ngayvv");}
			catch{}
			try
			{
				dsxml.Tables[0].Columns.Add("ngayrv");
				dsxml.Tables[0].Columns.Add("ten_khoacuoi");
			}
			catch{}
			#endregion
			decimal d_dinhmucktcao=ck2_ca3_26, d_mucdongchitra=decimal.Parse(ma13_st(nhom_duoc).ToString());

			dichso.numbertotext doiso=new dichso.numbertotext();
			string matt="",ma="",sothe="",s="";int madt=0,khu=0;
			decimal tcsotien=0,tcbhyt=0,tcbhytt0107=0,stbhyt=0,bnt=0,bht=0,tbh,tbn,st,ztc=0;
			decimal d_chiphi_ktcao=0, d_chiphi_ktcao_dinhmuc=muc_khongqua;
			int iTraituyen=iTraituyen_bhyt;
			DataRow r,r1;decimal tc=0;
			int sophieu=0,lanin=0;
			bool bFound=false,bTruongkhoa=false;
			int nhom=nhom_duoc,maphu=0;
			decimal chitra=80;
			//decimal dDichvuKhongcungchitra=0,d_dichvu_tt_bhyttra=0,d_dichvu_tt_bntra=0;
			//
			DataTable table2 = get_data("select id,locthe, sothe from d_dmbd where nhom=" + nhom + " and sothe is not null union all select id,locthe, sothe from v_giavp where sothe is not null").Tables[0];
			//
			bhyt20_khambenh=(loaiba==3) || (loaiba==2 && Ngoaitru_bhyt_khambenh) || (Phongluu_bhyt_khambenh && loaiba==4) || (Noitru_bhyt_khambenh && loaiba==1);
			if(bInchuky)
			{
				r1=getrowbyid(dtbs,"makp='"+makp_rv+"' and nhom="+truongkhoa);
				if (r1!=null)
				{
					try
					{
						imagetk =(byte[])(r1["image"]);
						bTruongkhoa=true;
					}
					catch{bTruongkhoa=false;}
				}
			}
			else {bTruongkhoa=false;}
			decimal d_hotroTA=dTienAn,d_tongTA=0;
			string s_Nhomvptienan=TenNhomvptienan;
			if(d_hotroTA>0)
			{
				for(int i=0;i<dr.Length;i++)
				{
					try
					{
						if(dr[i]["nhom"].ToString()==s_Nhomvptienan)
						{
							d_tongTA+=decimal.Parse(dr[i]["dongia"].ToString())*decimal.Parse(dr[i]["soluong"].ToString());
						}
					}
					catch{}
				}
			}
			
			for(int i=0;i<dr.Length;i++)
			{
				//dDichvuKhongcungchitra=0;d_dichvu_tt_bhyttra=0;d_dichvu_tt_bntra=0;
				if (sothe!=dr[i]["sothe"].ToString().Trim().Trim(';') || khu!=int.Parse(dr[i]["khu"].ToString()) || matt!=dr[i]["matt"].ToString() || ma!=dr[i]["mabn"].ToString() || madt!=int.Parse(dr[i]["madoituong"].ToString()))
				{					
					bFound=false;
					matt=dr[i]["matt"].ToString();ma=dr[i]["mabn"].ToString();
					madt=int.Parse(dr[i]["madoituong"].ToString());
					sothe=dr[i]["sothe"].ToString().Trim().Trim(';');
					khu=int.Parse(dr[i]["khu"].ToString());
					ztc=stbhyt=tcsotien=tcbhyt=tcbhytt0107=0;
					if (bhyt20_khambenh)
					{
						s=bntra50(dr);
						bnt=decimal.Parse(s.Substring(0,s.IndexOf("^")));
						bht=decimal.Parse(s.Substring(s.IndexOf("^")+1));
					}
					if (dr[i]["done"].ToString()=="0")
					{
						sophieu=get_sophieu_ravien(_mmyy,dr[i]["mabn"].ToString(),long.Parse(dr[i]["maql"].ToString()),loaiba,_ngay,int.Parse(dr[i]["madoituong"].ToString()),0);
						lanin=get_laninrv(_mmyy,dr[i]["mabn"].ToString(),long.Parse(dr[i]["maql"].ToString()),_ngay,int.Parse(dr[i]["madoituong"].ToString()));
						upd_sophieurv(_mmyy,dr[i]["mabn"].ToString(),long.Parse(dr[i]["maql"].ToString()),dr[i]["ghichu"].ToString());
					}
					if(bInchuky)
					{
						r1=getrowbyid(dtbs,"ma='"+dr[i]["mabs"].ToString()+"'");
						if (r1!=null)
						{
							try
							{
								image =(byte[])(r1["image"]);
								bFound=true;
							}
							catch{bFound=false;}
						}
					}
					else bFound=false;
					maphu=0;
					if (sothe!="" && bDoituong_BHYT(madt,dtdt))//if (sothe!="" && madt==1)
					{
						if (bhyt20_khambenh)
						{
							//foreach(DataRow r0 in dt.Rows) ztc+=decimal.Parse(r0["sotien"].ToString());
							foreach(DataRow r0 in dt.Select("madoituong="+madt)) 
							{								
								row_locthe = this.getrowbyid(table2, "id=" + int.Parse(r0["ma"].ToString()));
								if ((row_locthe != null) && (row_locthe["sothe"].ToString().Trim().IndexOf(r0["sothe"].ToString().Substring(2, 1)) != -1))
								{
									if(bCPVC_TinhTyLe) ztc+=decimal.Parse(r0["sotien"].ToString());
										//nhung dich vu(chi phi van chuyen) BHYT chi tra 100% --> thi khong tinh vao chi phi dinh muc 109.500
									else ztc+=0;
								}
								else ztc+=decimal.Parse(r0["sotien"].ToString());
								//
							}
							maphu=get_maphu_ngtru(sothe,ztc,nhom,dr[i]["ngayra"].ToString().Substring(0,10));
						}
						else maphu=get_maphu_noitru(sothe,nhom,dr[i]["ngayra"].ToString().Substring(0,10));
					}
				}
				tbh=tbn=0;
				if(sothe!="" && sothe != dr[i]["sothe"].ToString().Trim().Trim(';'))
				{
					tcsotien+=decimal.Parse(dr[i]["sotien"].ToString());
					tcbhyt=decimal.Parse(dr[i]["bhyt"].ToString());
					tcbhytt0107=decimal.Parse(dr[i]["bhytt0107"].ToString());
				}
				else
				{
					tcsotien+=decimal.Parse(dr[i]["sotien"].ToString());
					tcbhyt+=decimal.Parse(dr[i]["bhyt"].ToString());
					tcbhytt0107+=decimal.Parse(dr[i]["bhytt0107"].ToString());
				}
				
				stbhyt=decimal.Parse(dr[i]["sotien"].ToString());
				r=dsxml.Tables[0].NewRow();
				#region
				r["bhyttra"]=0;
				r["bntra"]=0;
				r["sophieu"]=sophieu;
				r["lanin"]=lanin;
				r["mabs"]=dr[i]["mabs"].ToString();
				r["tenbs"]=dr[i]["tenbs"].ToString();
				r["tenuser"]=dr[i]["tenuser"].ToString();
				if (bFound)
				{
					try{r["image"]=image;}
					catch{}
				}
				if (bTruongkhoa)
				{
					try{r["imagetk"]=imagetk;}
					catch{}
				}
				r["dinhmucktcao"]=d_dinhmucktcao;
				r["mucdongchitra"]=d_mucdongchitra;
				r["khu"]=khu;
				r["matt"]=matt;
				r["mabn"]=ma;
				r["hoten"]=dr[i]["hoten"].ToString();
				r["maql"]=dr[i]["maql"].ToString();
				r["idkhoa"]=dr[i]["idkhoa"].ToString();
				r["namsinh"]=dr[i]["namsinh"].ToString();
				r["phai"]=dr[i]["phai"].ToString();
				r["diachi"]=dr[i]["diachi"].ToString();
				r["madoituongvao"]=madoituongvao;
				r["madoituong"]=dr[i]["madoituong"].ToString();
				r["doituong"]=dr[i]["doituong"].ToString();
				r["sothe"]=dr[i]["sothe"].ToString();
				r["maphu"]=dr[i]["maphu"].ToString();
				r["tungay"]=dr[i]["tungay"].ToString();
				r["denngay"]=dr[i]["denngay"].ToString();
				r["noigioithieu"]=dr[i]["noigioithieu"].ToString();
				r["noicap"]=dr[i]["noicap"].ToString();
				r["giuong"]=dr[i]["giuong"].ToString();
				r["makp"]=dr[i]["makp"].ToString();
				r["tenkp"]=dr[i]["tenkp"].ToString();
				r["ngayvao"]=dr[i]["ngayvao"].ToString();
				r["ngayra"]=dr[i]["ngayra"].ToString();
				r["chandoan"]=dr[i]["chandoan"].ToString();
				r["maicd"]=dr[i]["maicd"].ToString();
				r["sttnhom"]=dr[i]["sttnhom"].ToString();
				r["nhom"]=dr[i]["nhom"].ToString();
				r["sttloai"]=dr[i]["sttloai"].ToString();
				r["loai"]=dr[i]["loai"].ToString();
				r["ma"]=dr[i]["ma"].ToString();
				r["done"]=dr[i]["done"].ToString();
				if (ngia)
				{
					r["gia_th"]=dr[i]["gia_th"].ToString();
					r["gia_dv"]=dr[i]["gia_dv"].ToString();
					r1=getrowbyid(dtvp,"id="+int.Parse(dr[i]["ma"].ToString()));
					if (r1!=null)
					{
						if (r["gia_th"].ToString()=="0") r["gia_th"]=r1["gia_th"].ToString();
						r["gia_bh"]=r1["gia_bh"].ToString();
						if (r["gia_dv"].ToString()=="0") r["gia_dv"]=r1["gia_dv"].ToString();
						r["gia_cs"]=r1["gia_cs"].ToString();
						r["gia_nn"]=r1["gia_nn"].ToString();
						r["chenhlech"]= r1["chenhlech"].ToString();
					}
				}
				r["ten"]=dr[i]["ten"].ToString();
				r["dvt"]=dr[i]["dvt"].ToString();
				r["soluutru"]=dr[i]["soluutru"].ToString();
				r["nguoinha"]=dr[i]["nguoinha"].ToString();
				r["hinhthuc"]=dr[i]["hinhthuc"].ToString();
				r["phuongphap"]=dr[i]["phuongphap"].ToString();
				r["ketqua"]=dr[i]["ketqua"].ToString();
				r["soluong"]=dr[i]["soluong"].ToString();
				r["dongia"]=dr[i]["dongia"].ToString();
				r["sotien"]=dr[i]["sotien"].ToString();
				r["kythuat"]=dr[i]["kythuat"].ToString();
				if(dr[i]["kythuat"].ToString()=="0")
				{
					d_chiphi_ktcao+=decimal.Parse(dr[i]["sotien"].ToString());
					r["chiphiktcao"]=dr[i]["sotien"].ToString();
				}				
				r["tamung"]=dr[i]["tamung"].ToString();
				//
				r["giachenhlech"]=dr[i]["giachenhlech"].ToString();
				//
				r["tong_tu"]=tc_tamung;
				r["bienlai_tu"]=b_tatca_sobienlaitamung;
				//
				r["loaiba"]=dr[i]["loaiba"].ToString();
				r["tcsotien"]=tcsotien;
				r["ngaypt"]=dr[i]["ngaypt"].ToString();
				r["tenpt"]=dr[i]["tenpt"].ToString();
				r["dbh"] = r["dbn"] = r["tlchitra"] = 0;
				r["tltraituyen"] = iTraituyen;
				r["mien"]=0;//BINH: GAN=0 DE KHONG BI NULL THI REPORT KHONG BI LOI
				#endregion

				if(dr[i]["nhom"].ToString()==s_Nhomvptienan && d_hotroTA>0 && d_tongTA>0)//ta
				{
					stbhyt=decimal.Parse(tngaydt.ToString())*decimal.Parse(dr[i]["dongia"].ToString());
					decimal dtyleTA=d_hotroTA*decimal.Parse(tngaydt.ToString())*100/d_tongTA;
					d_bhyt=dtyleTA*stbhyt/100;
					d_bntra=stbhyt-d_bhyt;
					//					r["soluong"]=tngaydt;
					r["sotien"]=stbhyt;
					r["bhyttra_ct"]=d_bhyt;
					r["bntra_ct"]=d_bntra;
					r["tlchitra"]=Math.Round(dtyleTA,0);
				}
				else
				{
					if (bDoituong_BHYT(int.Parse(dr[i]["madoituong"].ToString()),dtdt) || dr[i]["madoituong"].ToString()=="99")//if (dr[i]["madoituong"].ToString()=="1" || dr[i]["madoituong"].ToString()=="99") //bhyt; 99 BHYT truoc 01/07/2005
					{
						bool vbTraiTuyen=int.Parse(dr[i]["traituyen"].ToString())!=0;
						string vsNgayRaVien=dr[i]["ngayra"].ToString().Substring(0,10);
						string vsSoThe=dr[i]["sothe"].ToString();
						
						row_locthe = this.getrowbyid(table2, "id=" + int.Parse(dr[i]["ma"].ToString()));
						if (bhyt20_khambenh)//thanh toan giong nhu phong kham
						{
							#region
							if (vbTraiTuyen//trai tuyen
								&& iTraituyen!=0 //ty le trai tuyen <>0
								&& !btraituyen_bhtra
								)
							{
								//
								chitra=iTraituyen;
								if(bBHYT_Traituyen_tinhtheo_Tyle_khac)
								{
									#region
									//chitra_tt=chitra;//lay ty le trai tuyen (khong biet lay de lam gi?)
								
									//linh
									DataRow rvp=getrowbyid(dtvp,"id="+dr[i]["ma"].ToString());
									if(rvp!=null)
									{
										if(rvp["vuottuyen"].ToString()!="-1")
										{
											chitra=int.Parse(rvp["vuottuyen"].ToString());
											r["vuottuyen"]=chitra;											
										}
									}
									#endregion
								}
								d_bhyt=stbhyt*chitra/100;								
								d_bntra=stbhyt-d_bhyt;
								r["bhyttra"]=d_bhyt;
								r["bntra"]=d_bntra;
								r["tlchitra"] =  chitra;
							}
							else//dung tuyen
							{
								#region
								if (maphu!=0)//bn dong chi tra
								{
									#region
									if(dr[i]["vuottran"].ToString()=="0")
									{
										chitra=(maphu==1)?80:95;
										//linh chi phi van chuyen
										if(dr[i]["nhom"].ToString()==s_nhomvienphichiphivanchuyen)
										{
											#region Madtthehuong100cpvc
											if(s_Madtthehuong100cpvc.IndexOf(vsSoThe.Substring(2,1)+",")>-1)
											{
												if(vbTraiTuyen && iTraituyen != 0)
												{
													chitra=iTraituyen;
												}
												else chitra=100;
											}
											else if(bCPVC_TinhTyLe)
											{
												if(vbTraiTuyen && iTraituyen != 0)
												{
													chitra=iTraituyen;
												}
												else
												{
													if(row_locthe["sothe"].ToString().Trim().IndexOf(vsSoThe.Substring(2, 1)) != -1)
														chitra=(maphu==1)?80:95;
													else chitra=0;
												}
											}
											else if(!bCPVC_TinhTyLe)
											{
												if(row_locthe["sothe"].ToString().Trim().IndexOf(vsSoThe.Substring(2, 1)) == -1)
													chitra=0;
											}
											#endregion
										}
									}
									else{chitra=100;}
									//end linh
									d_bhyt=stbhyt*chitra/100;
									d_bntra=stbhyt-d_bhyt;
									if(bktCao_tinhtungDV)
									{
										#region
										if(dr[i]["kythuat"].ToString()=="0")
										{
											if(d_bhyt>d_dinhmucktcao)
											{
												d_bntra+=d_bhyt-d_dinhmucktcao;
												d_bhyt=d_dinhmucktcao;
											}
											
										}
										#endregion
									}									
									r["bhyttra"]=d_bhyt;
									r["bntra"]=d_bntra;
									r["tlchitra"] =  chitra;
									#endregion
								}
								else//bn khong cung chi tra
								{
									chitra=100;
									d_bhyt=stbhyt;
									d_bntra=0;
									if(bktCao_tinhtungDV)
									{
										if(dr[i]["kythuat"].ToString()=="0")
										{
											#region ktcao
											if(get_nhom(vsSoThe,huong100,nhom))
											{
												//r["bhyttra"]=d_bhyt;
												//r["bntra"]=d_bntra;
											}
											else if(get_nhom(vsSoThe,huong100kqua,nhom))
											{
												if(d_bhyt>d_dinhmucktcao)
												{
													d_bntra+=d_bhyt-d_dinhmucktcao;
													d_bhyt=d_dinhmucktcao;
												}													
											}
											r["bhyttra"]=d_bhyt;
											r["bntra"]=d_bntra;
											#endregion
										}
									}									
									r["bhyttra"]=d_bhyt;
									r["bntra"]=d_bntra;
									r["tlchitra"] =  chitra;

								}
								r["dbh"] = r["bhyttra"].ToString();
								r["dbn"] = r["bntra"].ToString();
								if (vbTraiTuyen && iTraituyen != 0)
								{                            
									st = decimal.Parse(r["bhyttra"].ToString());
									chitra = iTraituyen;
									tbh = st * chitra / 100;
									tbn = st - (st * chitra / 100);
									r["bhyttra"]= tbh;
									r["bntra"]=decimal.Parse(r["bntra"].ToString()) + tbn;
									r["tlchitra"] =  decimal.Parse(r["bhyttra"].ToString()) / stbhyt * 100;
								}
								#endregion
							}
							#endregion
						}
						else
						{
							if (int.Parse(dr[i]["traituyen"].ToString())!=0 && iTraituyen!=0 && !btraituyen_bhtra)//trai tuyen
							{
								chitra=iTraituyen;
								//linh vuot tuyen
								DataRow rvp=getrowbyid(dtvp,"id="+dr[i]["ma"].ToString());
								if(rvp!=null)
								{
									if(rvp["vuottuyen"].ToString()!="-1")
									{
										chitra=int.Parse(rvp["vuottuyen"].ToString());
										r["vuottuyen"]=chitra;
									}
								}
								//end vuot tuyen
								r["bhyttra"]=stbhyt*chitra/100+bnt;
								r["bntra"]=stbhyt-(stbhyt*chitra/100)+bht;
								r["tlchitra"] =  chitra;
								
							}
							else//dung tuyen
							{
								#region
								//							maphu=(dr[i]["sothe"].ToString().Trim()!="")?get_maphu_noitru(dr[i]["sothe"].ToString(),nhom):0;
								if (maphu==0)
								{
									chitra=100;
									r["bhyttra"]=tcsotien;
									r["bntra"]=0;
									r["tlchitra"] =  100;
								}
								else
								{
									chitra=(maphu==1)?80:95;
									//linh chi phi va chuyen
									if(dr[i]["nhom"].ToString()==s_nhomvienphichiphivanchuyen)
									{
										#region s_Madtthehuong100cpvc
										if(s_Madtthehuong100cpvc.IndexOf(sothe.Substring(2,1)+",")>-1)
										{
											if(int.Parse(dr[i]["traituyen"].ToString())!=0 && iTraituyen != 0)
											{
												chitra=iTraituyen;
											}
											else chitra=100;
										}
										else if(bCPVC_TinhTyLe)
										{
											if(int.Parse(dr[i]["traituyen"].ToString())!=0 && iTraituyen != 0)
											{
												chitra=iTraituyen;
											}
											else
											{
												if(row_locthe["sothe"].ToString().Trim().IndexOf(dr[i]["sothe"].ToString().Substring(2, 1)) != -1)
													chitra=(maphu==1)?80:95;
												else chitra=0;
											}
										}
										else if(!bCPVC_TinhTyLe)
										{
											if(row_locthe["sothe"].ToString().Trim().IndexOf(dr[i]["sothe"].ToString().Substring(2, 1)) == -1)
												chitra=0;
										}
										#endregion
									}
									//end cpvc
									r["bhyttra"]=stbhyt*chitra/100+bnt;
									r["bntra"]=stbhyt-(stbhyt*chitra/100)+bht;
									r["tlchitra"] =  chitra;
								}
								r["dbh"] = r["bhyttra"].ToString();
								r["dbn"] = r["bntra"].ToString();
								if (int.Parse(dr[i]["traituyen"].ToString()) != 0 && iTraituyen != 0)
								{                            
									st = decimal.Parse(r["bhyttra"].ToString());
									chitra = iTraituyen;
									tbh = st * chitra / 100;
									tbn = st - (st * chitra / 100);
									r["bhyttra"]= tbh;
									r["bntra"]=decimal.Parse(r["bntra"].ToString()) + tbn;
									r["tlchitra"] =  decimal.Parse(r["bhyttra"].ToString()) / stbhyt * 100;
								}
								#endregion
							}
						}
						//Tinh chi phia cho cac dang the dat biet: vi du: the CK2: mien cp van chuyen
						//row_locthe = this.getrowbyid(table2, "id=" + int.Parse(dr[i]["ma"].ToString()));
						if ((row_locthe != null) && (row_locthe["sothe"].ToString().Trim().IndexOf(dr[i]["sothe"].ToString().Substring(2, 1)) != -1))
						{
							//chitra = 100;
							chitra=(maphu==1)?80:95;
							if(dr[i]["nhom"].ToString()==s_nhomvienphichiphivanchuyen)
							{
								#region s_Madtthehuong100cpvc
								if(s_Madtthehuong100cpvc.IndexOf(sothe.Substring(2,1))>-1)
								{
									if(vbTraiTuyen && iTraituyen != 0)
									{
										chitra=iTraituyen;
									}
									else chitra=100;
								}
								else if(bCPVC_TinhTyLe)
								{
									if(vbTraiTuyen && iTraituyen != 0)
									{
										chitra=iTraituyen;
									}
									else
									{
										if(row_locthe["sothe"].ToString().Trim().IndexOf(dr[i]["sothe"].ToString().Substring(2, 1)) != -1)
											chitra=(maphu==1)?80:95;
										else chitra=0;
									}
								}
								else if(!bCPVC_TinhTyLe)
								{
									if(row_locthe["sothe"].ToString().Trim().IndexOf(dr[i]["sothe"].ToString().Substring(2, 1)) == -1)
										chitra=0;
								}
								#endregion
							}
							r["bhyttra"] = stbhyt;						
							r["bntra"] = 0;
							r["tlchitra"] = chitra;
							r["dbh"] = r["bhyttra"].ToString();
							r["dbn"] = r["bntra"].ToString();
							r["kythuat"] = 9;
						}
						//
						r["dichsotra"]=doiso.doithapphan(r["bntra"].ToString());
						//
						r["bhyttra_ct"]=decimal.Parse(dr[i]["sotien"].ToString())*chitra/100;//doi tuong bhyt chi tra chi tiet
						r["bntra_ct"]=decimal.Parse(dr[i]["sotien"].ToString())*(100-chitra)/100;//bn dong chi tra chi tiet
						if(bktCao_tinhtungDV)
						{
							if(dr[i]["kythuat"].ToString()=="0")
							{
								
								r["bhyttra_ct"]=d_bhyt;
								r["bntra_ct"]=d_bntra;
							}
						}
						//
					}
					else if (mien_doituong(int.Parse(dr[i]["madoituong"].ToString()),dtdt)) //mien
					{
						r["mien"]=tcsotien;r["bntra"]=0;r["bhyttra"]=0;
						r["mien_ct"]=dr[i]["sotien"].ToString();//doi tuong thu phi
						r["dichsotra"]=doiso.doithapphan(r["mien"].ToString());
					}
					else
					{
						r["bntra"]=tcsotien;r["bhyttra"]=0;
						r["bntra_ct"]=dr[i]["sotien"].ToString();//doi tuong thu phi
						r["dichsotra"]=doiso.doithapphan(r["bntra"].ToString());
					}
				}
				tc=Math.Abs(decimal.Parse(r["tcsotien"].ToString()));
				r["dichso"]=((decimal.Parse(r["tcsotien"].ToString())<0)?"-":"")+doiso.doithapphan(tc.ToString());
				r["sbltamung"]=dr[i]["sbltamung"];//b_sobienlaitamung;
				r["ghichu"]=dr[i]["ghichu"].ToString();
				r["ngay1"]=dr[i]["ngay1"].ToString();
				r["ngay2"]=dr[i]["ngay2"].ToString();
				r["ngay3"]=dr[i]["ngay3"].ToString();
				r["ngay"]=dr[i]["ngay"].ToString();
				r["yyyymmdd"]=dr[i]["yyyymmdd"].ToString();
				
				r["idttrv"]=(dr[i]["idttrv"].ToString().Trim()=="")?"0":dr[i]["idttrv"].ToString().Trim();
				r["kyhieu"]=dr[i]["kyhieu"].ToString();
				r["sobienlai"]=dr[i]["sobienlai"].ToString();
				r["mainkey"]=dr[i]["khu"].ToString()+"^"+dr[i]["matt"].ToString()+"^"+dr[i]["mabn"].ToString()+"^"+dr[i]["sothe"].ToString()+"^"+dr[i]["sttnhom"].ToString()+"^"+dr[i]["tenkp"].ToString()+"^"+dr[i]["ten"].ToString()+"^"+dr[i]["ma"].ToString()+"^"+dr[i]["dongia"].ToString()+"^"+dr[i]["idttrv"].ToString();
				r["traituyen"]=dr[i]["traituyen"].ToString();
				r["tbh"] = tbh;
				r["tbn"] = tbn;
				try
				{
					r["id"]=dr[i]["id"].ToString();
				}
				catch{r["id"]=0;}
				try
				{
					r["id_ktcao"]=dr[i]["id_ktcao"].ToString();
				}
				catch{r["id_ktcao"]=0;}
				try
				{
					r["vuottran"]=dr[i]["vuottran"].ToString();
				}
				catch{}
				try
				{
					r["TongNgaydt"]=tngaydt;
				}
				catch{r["vuottran"]=0;}
				try
				{
					r["ngayvv"]=dr[i]["ngayvv"].ToString();
					r["ngayrv"]=dr[i]["ngayrv"].ToString();
					dsxml.Tables[0].Rows.Add(r);
				}
				catch{}
			}		
			#region kyhieu+sobienlai
			if (dsxml.Tables[0].Select("idttrv<>0").Length>0)
			{
				long idttrv=0;
				string tu,den,kyhieu,sobienlai;
				foreach(DataRow r2 in dsxml.Tables[0].Select("idttrv<>0","idttrv"))
				{
					if (idttrv!=long.Parse(r2["idttrv"].ToString()))
					{
						idttrv=long.Parse(r2["idttrv"].ToString());
						kyhieu=sobienlai="";
						tu=r2["ngayvao"].ToString().Substring(0,10);
						den=r2["ngayra"].ToString().Substring(0,10);
						sql="select b.sohieu,a.sobienlai from xxx.v_ttrvll a,"+user+".v_quyenso b where a.quyenso=b.id";
						sql+=" and a.id="+idttrv;
						foreach(DataRow r3 in get_data_mmyy(sql,tu,den,7).Tables[0].Rows)
						{
							kyhieu=r3["sohieu"].ToString();
							sobienlai=r3["sobienlai"].ToString();
							break;
						}
						if (kyhieu!="" && sobienlai!="")
						{
							foreach(DataRow r3 in dsxml.Tables[0].Select("idttrv="+idttrv))
							{
								r3["kyhieu"]=kyhieu;
								r3["sobienlai"]=sobienlai;
							}
						}
					}
				}
			}
			string _mabn = "", bangchu = ""; bht = bnt = 0;
			foreach (DataRow r3 in dsxml.Tables[0].Select("madoituong in ("+s_madoituong_bhyt+")", "mabn"))//foreach (DataRow r3 in dsxml.Tables[0].Select("madoituong=1", "mabn"))//dsxml.Tables[0].Select("madt=1", "mabn"))
			{
				if (_mabn == "") _mabn = r3["mabn"].ToString();
				if (_mabn != r3["mabn"].ToString())
				{
					bangchu = doiso.doithapphan(bnt.ToString());
					foreach (DataRow r0 in dsxml.Tables[0].Select("madoituong in("+s_madoituong_bhyt+") and mabn='" + _mabn + "'"))//foreach (DataRow r0 in dsxml.Tables[0].Select("madoituong=1 and mabn='" + _mabn + "'"))
					{
						r0["bhyttra"] = bht;
						r0["bntra"] = bnt;
						r0["dichsotra"] = bangchu;
					}
					bht = bnt = 0; _mabn = r3["mabn"].ToString();
				}
				chitra=(r3["tlchitra"].ToString()=="")?0:int.Parse(r3["tlchitra"].ToString());
				bht +=decimal.Parse(r3["sotien"].ToString())*chitra/100;   //decimal.Parse(r3["bhyttra"].ToString());
				bnt +=decimal.Parse(r3["sotien"].ToString())*(100-chitra)/100; //decimal.Parse(r3["bntra"].ToString());
			}
			if (bht != 0)
			{
				bangchu = doiso.doithapphan(bnt.ToString());
				foreach (DataRow r0 in dsxml.Tables[0].Select("madoituong in ("+s_madoituong_bhyt+") and mabn='" + _mabn + "'"))//foreach (DataRow r0 in dsxml.Tables[0].Select("madoituong=1 and mabn='" + _mabn + "'"))//dsxml.Tables[0].Select("madt=1 and mabn='" + _mabn + "'"))
				{
					//r0["bhyttra_ct"]=(r0["bhyttra"].ToString()=="")?"0":r0["bhyttra"].ToString();
					//r0["bntra_ct"]=(r0["bntra"].ToString()=="")?"0":r0["bntra"].ToString();
					r0["bhyttra"] = bht;
					r0["bntra"] = bnt;
					r0["dichsotra"] = bangchu;
				}
			}
			#endregion
			if(pbBhytApDungTT1314)
			{
				//int iTraituyen=(bTraituyen)?iTraituyen_bhyt:0;
				dlltinhcp.BHYT1314 vcbhyt=new dlltinhcp.BHYT1314();
				vcbhyt.bBHYT1314ApDung=true;
				vcbhyt.pbBHYT_Traituyen_tinh_Tyle_khac=bBHYT_Traituyen_tinh_Tyle_khac;
				vcbhyt.piTyLeTraiTuyen=iTraituyen;
				vcbhyt.pdDinhMucKTC=muc_bhquidinh;
				vcbhyt.pdTienMienBHYT=172500;
				try
				{
					vcbhyt.pbMienChiTra=vcbhyt.f_chk_MienChiTra(dsxml.Tables[0].Rows[0]["sothe"].ToString(),long.Parse(dsxml.Tables[0].Rows[0]["maql"].ToString()),dsxml.Tables[0].Rows[0]["ngayvv"].ToString(),dsxml.Tables[0].Rows[0]["ngayrv"].ToString());
				}
				catch{}
				vcbhyt.psLoaiBenhNhan=loaiba.ToString();
				try{vcbhyt.psNgayRaVien=dsxml.Tables[0].Rows[0]["ngayrv"].ToString();}
				catch{}
				decimal vdtong=0;
				try{vdtong=decimal.Parse(dsxml.Tables[0].Compute("sum(sotien)","madoituong in(1,6)").ToString());}
				catch{}
				vcbhyt.f_set_TinhLaiChiPhiTheoTT1314(ref dsxml,"bhyttra_ct","bntra_ct","ma",vdtong);
			}
			//dsxml.WriteXml("dsxml.xml",XmlWriteMode.WriteSchema);
			return dsxml;
			
		}

		public string bntra50(DataRow [] dr)
		{
			decimal s1=0,s2=0,st=0;
			for(int i=0;i<dr.Length;i++)
				if (bDoituong_BHYT(dr[i]["madoituong"].ToString()) && int.Parse(dr[i]["maphu"].ToString())!=100 && int.Parse(dr[i]["maphu"].ToString())>0) //if (dr[i]["madoituong"].ToString()=="1" && int.Parse(dr[i]["maphu"].ToString())!=100 && int.Parse(dr[i]["maphu"].ToString())>0) 
				{
					st=decimal.Parse(dr[i]["sotien"].ToString());
					s1=st;s2=st-s1;
				}
			return s1.ToString()+"^"+s2.ToString();
		}

		public bool get_thvpll(string mmyy,long maql)
		{
			return get_data("select mabn from "+user+mmyy+".v_thvpll where maql="+maql).Tables[0].Rows.Count>0;
		}

		public string get_giuong(long maql,string makp)
		{
			sql="select giuong from nhapkhoa where maql="+maql;
			if (makp!="") sql+=" and makp='"+makp+"'";
			sql+=" order by ngay desc";
			ds=get_data(sql);
			if (ds.Tables[0].Rows.Count>0) return ds.Tables[0].Rows[0]["giuong"].ToString();
			else return "";
		}

		public bool upd_vantay(string m_mabn,byte [] m_kytu,byte [] m_hinhanh)
		{
			sql="update vantay set kytu=:m_kytu,hinhanh=:m_hinhanh ";
			sql+="where mabn=:m_mabn";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_kytu",OracleType.Blob,m_kytu.Length).Value=m_kytu;
				cmd.Parameters.Add("m_hinhanh",OracleType.Blob,m_hinhanh.Length).Value=m_hinhanh;
				cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into vantay(mabn,kytu,hinhanh) values (:m_mabn,:m_kytu,:m_hinhanh)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
					cmd.Parameters.Add("m_kytu",OracleType.Blob,m_kytu.Length).Value=m_kytu;
					cmd.Parameters.Add("m_hinhanh",OracleType.Blob,m_hinhanh.Length).Value=m_hinhanh;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"vantay");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool mien_doituong(int madoituong,DataTable dt)
		{
			return getrowbyid(dt,"mien=1 and madoituong="+madoituong)!=null;
		}


		public string get_nguoinha(string mabn,long maql)
		{
			DataTable dt;
			sql="select * from hcsosinh where mabn='"+mabn+"'";
			dt=get_data(sql).Tables[0];
			if (dt.Rows.Count>0) return (dt.Rows[0]["hoten_me"].ToString()!="")?dt.Rows[0]["hoten_me"].ToString().Trim():dt.Rows[0]["hoten_bo"].ToString().Trim();
			sql="select * from hcnhi where mabn='"+mabn+"' and (hoten_me is not null or hoten_bo is not null)";
			dt=get_data(sql).Tables[0];
			if (dt.Rows.Count>0) return (dt.Rows[0]["hoten_me"].ToString()!="")?dt.Rows[0]["hoten_me"].ToString().Trim():dt.Rows[0]["hoten_bo"].ToString().Trim();
			sql="select * from quanhe where maql="+maql;
			dt=get_data(sql).Tables[0];
			if (dt.Rows.Count>0) return dt.Rows[0]["hoten"].ToString().Trim();
			return "";
		}

		public string get_nguoinha(string mabn,long maql,string ngay)
		{
			DataTable dt;
			sql="select * from hcsosinh where mabn='"+mabn+"'";
			dt=get_data(sql).Tables[0];
			if (dt.Rows.Count>0) return (dt.Rows[0]["hoten_me"].ToString()!="")?dt.Rows[0]["hoten_me"].ToString().Trim():dt.Rows[0]["hoten_bo"].ToString().Trim();
			sql="select * from hcnhi where mabn='"+mabn+"'";
			dt=get_data(sql).Tables[0];
			if (dt.Rows.Count>0) return (dt.Rows[0]["hoten_me"].ToString()!="")?dt.Rows[0]["hoten_me"].ToString().Trim():dt.Rows[0]["hoten_bo"].ToString().Trim();
			sql="select * from "+user+mmyy(ngay)+".quanhe where maql="+maql;
			dt=get_data(sql).Tables[0];
			if (dt.Rows.Count>0) return dt.Rows[0]["hoten"].ToString().Trim();
			sql="select * from quanhe where maql="+maql;
			dt=get_data(sql).Tables[0];
			if (dt.Rows.Count>0) return dt.Rows[0]["hoten"].ToString().Trim();
			return "";
		}
		public string get_noilamviec(string mabn,long maql,string ngay)
		{
			DataTable vdt=new DataTable();
			try
			{
				sql="select * from "+user+mmyy(ngay)+".lienhe where maql="+maql;
				vdt=get_data(sql).Tables[0];
				return vdt.Rows[0]["cholam"].ToString();
			}
			catch{}		
			if(vdt.Rows.Count==0)
			{
				try
				{
					sql="select * from lienhe where maql="+maql;
					vdt=get_data(sql).Tables[0];
					return vdt.Rows[0]["cholam"].ToString();
				}
				catch{}
			}			
			return "";
		}
		public int phuongphapdieutri(string makp)
		{
			int ret=1;
			ds=get_data("select makpbo from btdkp_bv where makp='"+makp+"'");
			if (ds.Tables[0].Rows.Count>0)
			{
				string makpbo=ds.Tables[0].Rows[0]["makpbo"].ToString();
				if (ngoaikhoa.IndexOf(makpbo)!=-1) ret=2;
				else if (yhdt.IndexOf(makpbo)!=-1) ret=3;
			}
			return ret;
		}

		public int ketquadieutri(int ketqua,int ttlucrv)
		{
			int ret=0;
			if (ketqua<=3 || (ttlucrv!=6 && ttlucrv!=7)) ret=ketqua;
			else if (ttlucrv==6) return ret=3;
			else if (ttlucrv==7) return ret=4;
			return ret;
		}

		public long get_maql_phongluu(long maql)
		{
			ds=get_data("select matiepdon from sukien where matiepdon>0 and macap="+maql);
			if (ds.Tables[0].Rows.Count>0)
			{
				sql="select macap from sukien where noitiepdon="+Phongluu+" and matiepdon="+long.Parse(ds.Tables[0].Rows[0]["matiepdon"].ToString())+"  order by macap desc";
				ds=get_data(sql);
				if (ds.Tables[0].Rows.Count>0) return long.Parse(ds.Tables[0].Rows[0]["macap"].ToString());
				else return 0;
			}
			else return 0;
		}

		public int get_sobienlai(long m_id,bool m_tang)
		{
			if (!m_tang) return get_sobienlai(m_id,1);
			else
			{
				sql="update v_quyenso set soghi=soghi+1 where id=:m_id";
				con=new OracleConnection(sConn);
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.ExecuteNonQuery();
				cmd.Dispose();
				sql="select soghi from v_quyenso where id="+m_id;
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				dest=new OracleDataAdapter(cmd);
				ds=new DataSet();
				dest.Fill(ds);	
				cmd.Dispose();				
				con.Close();con.Dispose();
				return int.Parse(ds.Tables[0].Rows[0][0].ToString());
			}
		}

		public string get_soluutru(string mabn,int loaiba)
		{
			sql="select b.soluutru from benhandt a,lienhe b where a.maql=b.maql and a.mabn='"+mabn+"' and a.loaiba="+loaiba+" order by a.maql desc";
			ds=get_data(sql);
			if (ds.Tables[0].Rows.Count>0) return ds.Tables[0].Rows[0]["soluutru"].ToString();
			else return "";
		}

		public void updrec_donthuoc(DataTable dt,int mabd,string ten,string dang,string tenhc)
		{
			string exp="mabd="+mabd;
			DataRow r = getrowbyid (dt,exp); 
			if ( r == null )
			{
				DataRow nrow = dt.NewRow ( ) ;
				nrow["mabd"]=mabd;
				nrow["ten"]=ten;
				nrow["tenhc"]=tenhc;
				nrow["dang"]=dang;
				nrow["soluong"]=1;
				dt.Rows.Add ( nrow ) ;
			}
		}

		public void updrec_donthuoc(DataTable dt,int stt,int mabd,string ten,string dang,string tenhc)
		{
			string exp="mabd="+mabd;
			DataRow r = getrowbyid (dt,exp); 
			if ( r == null )
			{
				DataRow nrow = dt.NewRow ( ) ;
				nrow["stt"]=stt;
				nrow["mabd"]=mabd;
				nrow["ten"]=ten;
				nrow["tenhc"]=tenhc;
				nrow["dang"]=dang;
				nrow["soluong"]=1;
				dt.Rows.Add ( nrow ) ;
			}
		}

		public string field_gia(string madoituong)
		{
			string fie="gia_th";
			if (madoituong!="")
			{
				try
				{
					DataTable tmp=get_data("select field_gia from doituong where madoituong="+int.Parse(madoituong)).Tables[0];
					if (tmp.Rows.Count>0) return tmp.Rows[0]["field_gia"].ToString().Trim();
				}
				catch{}
			}
			return fie;
		}
		

		public bool upd_danhmuc_sankhoa(int m_id,int m_stt,string m_ma,string m_ten,string m_table)
		{
			sql="update "+m_table+" set stt=:m_stt,ma=:m_ma,ten=:m_ten";
			sql+=" where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
				cmd.Parameters.Add("m_ma",OracleType.VarChar,10).Value=m_ma;
				cmd.Parameters.Add("m_ten",OracleType.NVarChar,100).Value=m_ten;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+m_table+" (id,stt,ma,ten) values (:m_id,:m_stt,:m_ma,:m_ten)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
					cmd.Parameters.Add("m_ma",OracleType.VarChar,10).Value=m_ma;
					cmd.Parameters.Add("m_ten",OracleType.NVarChar,100).Value=m_ten;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,m_table);
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		#region Binh
		public long get_id_hiendien_do_cdvv(string s_mabn, long s_maql, string s_noichuyen)
		{
			long lid=0;
			sql="select * from hiendien where mabn='"+s_mabn+"' and maql="+s_maql+" and noichuyen='" +s_noichuyen+"' and nhapkhoa=0 and xuatkhoa=0 order by id desc";
			DataTable dt=get_data(sql).Tables[0];
			if(dt.Rows.Count>0)
			{
				lid=long.Parse(dt.Rows[0]["id"].ToString());				
			}
			dt.Dispose();
			return lid;
		}
		#region congkhaivphangngay_binh
		public DataTable get_t_thcpdt(string b_makp, string b_ngay, double b_sono)
		{
			con=new OracleConnection(sConn);
			con.Open();
			cmd=new OracleCommand("pkg_medi.get_t_thcpdt",con );
			cmd.CommandType=CommandType.StoredProcedure;
			//
			cmd.Parameters.Add("b_makp",OracleType.VarChar,2).Value=b_makp;	
			cmd.Parameters.Add("b_ngay",OracleType.VarChar,10).Value=b_ngay;	
			cmd.Parameters.Add("b_sono",OracleType.Number).Value=b_sono;
			cmd.Parameters.Add("io_cursor",OracleType.Cursor).Direction=ParameterDirection.Output;;
			//
			DataTable dt=new DataTable();
			dest=new OracleDataAdapter(cmd);
			string strerr="";
			try
			{
				dest.Fill(dt);
			}
			catch(Exception ex)
			{
				strerr=ex.Message;
				Console.WriteLine(strerr);
				
			}
			con.Close();con.Dispose();
			return dt;
		}

		public DataTable get_t_thcpdt(string b_makp, string b_ngay)
		{
			con=new OracleConnection(sConn);
			con.Open();
			cmd=new OracleCommand("pkg_medi.get_t_thcpdt",con );
			cmd.CommandType=CommandType.StoredProcedure;
			//
			cmd.Parameters.Add("b_makp",OracleType.VarChar,2).Value=b_makp;	
			cmd.Parameters.Add("b_ngay",OracleType.VarChar,10).Value=b_ngay;	
			cmd.Parameters.Add("io_cursor",OracleType.Cursor).Direction=ParameterDirection.Output;;
			//
			DataTable dt=new DataTable();
			dest=new OracleDataAdapter(cmd);
			string strerr="";
			try
			{
				dest.Fill(dt);
			}
			catch(Exception ex)
			{
				strerr=ex.Message;
				Console.WriteLine(strerr);
				
			}
			con.Close();con.Dispose();
			return dt;
		}
		public void upd_t_thcpdt(string b_makp, string b_ngay, string b_mabn, double b_maql,
			double b_cpngay, double b_tamung, double b_cpluyke, string b_nguoidung, 
			double b_x01,double b_x02, double b_x03, double b_x04,double b_x05)
			
		{
			con=new OracleConnection(sConn);
			con.Open();
			cmd=new OracleCommand("pkg_medi.upd_t_thcpdt",con);
			cmd.CommandType=CommandType.StoredProcedure;
			//
			cmd.Parameters.Add("b_makp",OracleType.VarChar,2).Value=b_makp;
			cmd.Parameters.Add("b_ngay",OracleType.VarChar,10).Value=b_ngay;
			cmd.Parameters.Add("b_mabn",OracleType.VarChar,10).Value=b_mabn;
			cmd.Parameters.Add("b_maql",OracleType.Number,11).Value=b_maql;

			cmd.Parameters.Add("b_cpngay",OracleType.Number).Value=b_cpngay;
			cmd.Parameters.Add("b_tamung",OracleType.Number).Value=b_tamung;
			cmd.Parameters.Add("b_cpluyke",OracleType.Number).Value=b_cpluyke;
			cmd.Parameters.Add("b_nguoidung",OracleType.VarChar,15).Value=b_nguoidung;
			//
			cmd.Parameters.Add("b_x01",OracleType.Number).Value=b_x01;
			cmd.Parameters.Add("b_x02",OracleType.Number).Value=b_x02;
			cmd.Parameters.Add("b_x03",OracleType.Number).Value=b_x03;
			cmd.Parameters.Add("b_x04",OracleType.Number).Value=b_x04;
			cmd.Parameters.Add("b_x05",OracleType.Number).Value=b_x05;
			
			string strerr="";
			try
			{
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				strerr=ex.Message;
				Console.WriteLine(strerr);
				
			}
			con.Close();con.Dispose();
		}

		public void upd_t_thcpdt(string b_makp, string b_ngay, string b_mabn, double b_maql,
			double b_cpngay, double b_tamung, double b_cpluyke, string b_nguoidung, 
			double b_x01,double b_x02, double b_x03, double b_x04,double b_x05,double b_dathu)
		{
			con=new OracleConnection(sConn);
			con.Open();
			cmd=new OracleCommand("pkg_medi.upd_t_thcpdt",con);
			cmd.CommandType=CommandType.StoredProcedure;
			//
			cmd.Parameters.Add("b_makp",OracleType.VarChar,2).Value=b_makp;
			cmd.Parameters.Add("b_ngay",OracleType.VarChar,10).Value=b_ngay;
			cmd.Parameters.Add("b_mabn",OracleType.VarChar,10).Value=b_mabn;
			cmd.Parameters.Add("b_maql",OracleType.Number,11).Value=b_maql;

			cmd.Parameters.Add("b_cpngay",OracleType.Number).Value=b_cpngay;
			cmd.Parameters.Add("b_tamung",OracleType.Number).Value=b_tamung;
			cmd.Parameters.Add("b_cpluyke",OracleType.Number).Value=b_cpluyke;
			cmd.Parameters.Add("b_nguoidung",OracleType.VarChar,15).Value=b_nguoidung;
			//
			cmd.Parameters.Add("b_x01",OracleType.Number).Value=b_x01;
			cmd.Parameters.Add("b_x02",OracleType.Number).Value=b_x02;
			cmd.Parameters.Add("b_x03",OracleType.Number).Value=b_x03;
			cmd.Parameters.Add("b_x04",OracleType.Number).Value=b_x04;
			cmd.Parameters.Add("b_x05",OracleType.Number).Value=b_x05;

			cmd.Parameters.Add("b_dathu",OracleType.Number).Value=b_dathu;
			
			string strerr="";
			try
			{
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				strerr=ex.Message;
				Console.WriteLine(strerr);
				
			}
			cmd.Dispose();
			con.Close();con.Dispose();
		}
		public void upd_t_ttba(string b_mabn, double b_maql, string b_nguoidung, string b_nguoitomtat, string b_ngaytt, string b_loaidv, double b_codedv,
			string b_x01, string b_x02, string b_x03, string b_x04,  
			string b_x05, string b_x06, string b_x07, string b_x08, string b_x09, string b_x10, double b_soluong)
		{
			con=new OracleConnection(sConn);
			con.Open();
			cmd=new OracleCommand("pkg_medi.upd_t_ttba",con);
			cmd.CommandType=CommandType.StoredProcedure;						
			cmd.Parameters.Add("b_mabn",OracleType.VarChar,10).Value=b_mabn;
			cmd.Parameters.Add("b_maql",OracleType.Number).Value=b_maql;
			cmd.Parameters.Add("b_nguoidung",OracleType.VarChar,14).Value=b_nguoidung;
			cmd.Parameters.Add("b_nguoitomtat",OracleType.NVarChar,30).Value=b_nguoitomtat;
			cmd.Parameters.Add("b_ngaytt",OracleType.VarChar,10).Value=b_ngaytt;
			cmd.Parameters.Add("b_loaidv",OracleType.VarChar,1).Value=b_loaidv;
			cmd.Parameters.Add("b_codedv",OracleType.Number).Value=b_codedv;
			//
			cmd.Parameters.Add("b_x01",OracleType.VarChar,6).Value=b_x01;//madich vu: mathuoc+maxn+macdha+makp
			cmd.Parameters.Add("b_x02",OracleType.NVarChar,80).Value=b_x02;//ten dich vu
			cmd.Parameters.Add("b_x03",OracleType.NVarChar,2000).Value=b_x03;//cach dung+lieudung+ketqua+chan doan
			cmd.Parameters.Add("b_x04",OracleType.NVarChar,20).Value=b_x04;//Duong dung+Maicd10
			cmd.Parameters.Add("b_x05",OracleType.VarChar,10).Value=b_x05;//so lan dung thuoc/24h
			//
			cmd.Parameters.Add("b_x06",OracleType.VarChar,10).Value=b_x06;// so ngay dung thuoc
			cmd.Parameters.Add("b_x07",OracleType.NVarChar,100).Value=b_x07;//dien bien lam sang
			cmd.Parameters.Add("b_x08",OracleType.VarChar,10).Value=b_x08;//tu ngay+ngayvao
			cmd.Parameters.Add("b_x09",OracleType.VarChar,10).Value=b_x09;//den ngay+ngay ra
			cmd.Parameters.Add("b_x10",OracleType.NVarChar,100).Value=b_x10;//ghi chu
			//
			cmd.Parameters.Add("b_soluong",OracleType.Number).Value=b_soluong;//ghi chu
			string strerr="";
			try
			{
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				strerr=ex.Message;
				Console.WriteLine(strerr);
				
			}
			cmd.Dispose();			
			con.Close();con.Dispose();
		}
		//Kiem tra lai tien thuoc tu table d_xuatsdll+d_xuatsdct --> chuyen sang --> d_tienthuoc

        #endregion		
		#endregion

		public DataSet get_thanhtoan(long l_maql,long l_idkhoa,string ngayvv,string ngayrv,int loaiba,string suserid,string makp_rv, bool bN_dot)
		{			
			string 	mabn="",s_tenkp="",s_sothe="",s_tungay="",s_denngay="",s_tenbv="",s_vao="",s_ra="",s_tenbs="",ngay1="",ngay2="",ngay3="";
			int i_madoituong=1;
			bool bKhu=bThanhtoan_khu;
			DataTable dtkhu=new DataTable();
			bool b1khu=true;
			if (bKhu)
			{
				sql="select distinct b.khu from nhapkhoa a,btdkp_bv b where a.makp=b.makp and a.maql="+l_maql;
				dtkhu=get_data(sql).Tables[0];
				b1khu=dtkhu.Rows.Count<2;
			}
			DataSet dsngay=new DataSet();
			DataSet dsxml=new DataSet();
			DataSet ds=new DataSet();
			DataSet dsss=new DataSet();
			DataTable dtbs=new DataTable();
			DataTable dtkp;
			DataRow dr;
			dtbs=get_data("select ma, hoten, makp, mapk, nhom  from dmbs").Tables[0];
			dtkp=get_data("select * from d_duockp").Tables[0];
			dsngay.ReadXml("..\\..\\..\\xml\\m_ngayvao.xml");
			dsngay.Tables[0].Columns.Add("traituyen",typeof(decimal));

			dsxml.ReadXml("..\\..\\..\\xml\\m_inravien.xml");
			DataColumn dc = new DataColumn("Image", typeof(byte[]));
			dsxml.Tables[0].Columns.Add(dc);
			dc = new DataColumn("Imagetk", typeof(byte[]));
			dsxml.Tables[0].Columns.Add(dc);
			try{dsxml.Tables[0].Columns.Add("KYTHUAT",typeof(decimal));}
			catch{}
			try{dsxml.Tables[0].Columns.Add("IDTTRV",typeof(decimal));}
			catch{}
			try{dsxml.Tables[0].Columns.Add("KYHIEU");}
			catch{}
			try{dsxml.Tables[0].Columns.Add("SOBIENLAI");}
			catch{}
			try{dsxml.Tables[0].Columns.Add("TRAITUYEN",typeof(decimal));}
			catch{}
			try{dsxml.Tables[0].Columns.Add("GIACHENHLECH",typeof(decimal)).DefaultValue=0;}
			catch{}
			try{dsxml.Tables[0].Columns.Add("VUOTTUYEN",typeof(decimal)).DefaultValue=0;}
			catch{}
			try{dsxml.Tables[0].Columns.Add("ID",typeof(decimal));}
			catch{}
			try{dsxml.Tables[0].Columns.Add("ID_KTCAO",typeof(decimal));}
			catch{}
			try{dsxml.Tables[0].Columns.Add("ngayvv");}
			catch{}
			try{dsxml.Tables[0].Columns.Add("ngayrv");}
			catch{}
			//			dsxml.Tables[0].Columns.Add("Image", typeof(byte[]));
			//			dsxml.Tables[0].Columns.Add("Imagetk", typeof(byte[]));
			//			dsxml.Tables[0].Columns.Add("kythuat",typeof(decimal));
			//			dsxml.Tables[0].Columns.Add("idttrv",typeof(decimal));
			//			dsxml.Tables[0].Columns.Add("kyhieu");
			//			dsxml.Tables[0].Columns.Add("sobienlai");
			//			dsxml.Tables[0].Columns.Add("traituyen",typeof(decimal));
			//			dsxml.Tables[0].Columns.Add("giachenhlech",typeof(decimal)).DefaultValue=0;

			ds.ReadXml("..\\..\\..\\xml\\m_ravien.xml");
			try{ds.Tables[0].Columns.Add("chon",typeof(bool));}
			catch{}
			try{ds.Tables[0].Columns.Add("IDTTRV",typeof(decimal));}
			catch{}
			try{ds.Tables[0].Columns.Add("KYHIEU");}
			catch{}
			try{ds.Tables[0].Columns.Add("SOBIENLAI");}
			catch{}
			try{ds.Tables[0].Columns.Add("TRAITUYEN",typeof(decimal));}
			catch{}
			try{ds.Tables[0].Columns.Add("GIACHENHLECH",typeof(decimal)).DefaultValue=0;}
			catch{}
			try{ds.Tables[0].Columns.Add("VUOTTUYEN",typeof(decimal)).DefaultValue=0;}
			catch{}
			try{ds.Tables[0].Columns.Add("ngayvv");}
			catch{}
			try{ds.Tables[0].Columns.Add("ngayrv");}
			catch{}
			//			ds.Tables[0].Columns.Add("chon",typeof(bool));
			//			ds.Tables[0].Columns.Add("idttrv",typeof(decimal));
			//			ds.Tables[0].Columns.Add("kyhieu");
			//			ds.Tables[0].Columns.Add("sobienlai");
			//			ds.Tables[0].Columns.Add("traituyen",typeof(decimal));
			//			ds.Tables[0].Columns.Add("giachenhlech",typeof(decimal)).DefaultValue=0;

			dsss.ReadXml("..\\..\\..\\xml\\m_ravienss.xml");
			try{dsss.Tables[0].Columns.Add("chon",typeof(bool));}
			catch{}
			try{dsss.Tables[0].Columns.Add("IDTTRV",typeof(decimal));}
			catch{}
			try{dsss.Tables[0].Columns.Add("KYHIEU");}
			catch{}
			try{dsss.Tables[0].Columns.Add("SOBIENLAI");}
			catch{}
			try{dsss.Tables[0].Columns.Add("TRAITUYEN",typeof(decimal)).DefaultValue=0;}
			catch{}
			try{dsss.Tables[0].Columns.Add("GIACHENHLECH",typeof(decimal)).DefaultValue=0;}
			catch{}
			try{dsss.Tables[0].Columns.Add("VUOTTUYEN",typeof(decimal)).DefaultValue=0;}
			catch{}
			//			dsss.Tables[0].Columns.Add("chon",typeof(bool));
			//			dsss.Tables[0].Columns.Add("idttrv",typeof(decimal));
			//			dsss.Tables[0].Columns.Add("kyhieu");
			//			dsss.Tables[0].Columns.Add("sobienlai");
			//			dsss.Tables[0].Columns.Add("traituyen",typeof(decimal));
			//			dsss.Tables[0].Columns.Add("giachenhlech",typeof(decimal)).DefaultValue=0;

			string s_chandoan="",s_maicd="";
			if ((bN_dot || !b1khu) &&  loaiba==1)
			{
				sql="select a.mabn,c.hoten,c.namsinh,c.phai,c.sonha,c.thon,c.cholam,a.maql,a.id,a.giuong,";
				sql+="to_char(a.ngay,'dd/mm/yyyy hh24:mi') ngayvao,";
				sql+="decode(b.ngay,null,to_char(sysdate,'dd/mm/yyyy hh24:mi'),to_char(b.ngay,'dd/mm/yyyy hh24:mi')) ngayra,";
				sql+="a.makp,d.tenkp,nvl(b.chandoan,a.chandoan) chandoan,nvl(b.maicd,a.maicd) maicd,";
				sql+="nvl(e.tentt,' ') tentt,nvl(f.tenquan,' ') tenquan,";
				sql+="nvl(g.tenpxa,' ') tenpxa,nvl(b.ketqua,0) as ketqua,nvl(b.ttlucrk,0) as ttlucrv,";
				if (bSovaovien) sql+="h.sovaovien as soluutru,";
				else sql+="' ' as soluutru,";
				sql+="nvl(b.mabs,a.mabs) as mabs,";
				sql+="h.madoituong from nhapkhoa a,xuatkhoa b,btdbn c,btdkp_bv d,btdtt e,btdquan f,btdpxa g,benhandt h ";
				sql+=" where a.id=b.id and a.mabn=c.mabn and a.makp=d.makp and c.matt=e.matt(+) and c.maqu=f.maqu(+) and c.maphuongxa=g.maphuongxa(+) ";
				sql+=" and a.maql=h.maql ";
				sql+=" and a.id="+l_idkhoa;
			}
			else
			{
				sql="select a.mabn,c.hoten,c.namsinh,c.phai,c.sonha,c.thon,c.cholam,a.maql,0 id,' ' giuong,";
				sql+="to_char(a.ngay,'dd/mm/yyyy hh24:mi') ngayvao,";
				sql+="decode(b.ngay,null,to_char(sysdate,'dd/mm/yyyy hh24:mi'),to_char(b.ngay,'dd/mm/yyyy hh24:mi')) ngayra,";
				sql+="decode(b.makp,null,a.makp,b.makp) makp,decode(b.makp,null,h.tenkp,d.tenkp) tenkp,";
				sql+="nvl(b.chandoan,a.chandoan) chandoan,nvl(b.maicd,a.maicd) maicd,";
				sql+="nvl(e.tentt,' ') tentt,nvl(f.tenquan,' ') tenquan,";
				sql+="nvl(g.tenpxa,' ') as tenpxa,nvl(b.ketqua,0) as ketqua,nvl(b.ttlucrv,0) as ttlucrv,";
				if (bSovaovien) sql+="a.sovaovien as soluutru,";
				else sql+="b.soluutru,";//ThanhCuong-12072011-Xuat thêm sovaovien
				sql+=" a.madoituong,nvl(b.mabs,a.mabs) as mabs,a.sovaovien ";
				sql+="from benhandt a,xuatvien b,btdbn c,btdkp_bv d,btdtt e,btdquan f,";
				sql+="btdpxa g,btdkp_bv h where a.maql=b.maql(+) and a.mabn=c.mabn and ";
				sql+="b.makp=d.makp(+) and c.matt=e.matt(+) and c.maqu=f.maqu(+) ";
				sql+="and c.maphuongxa=g.maphuongxa(+) and a.makp=h.makp and ";
				sql+="a.maql="+l_maql+" and a.loaiba="+loaiba;
			}
			int traituyen=0;string s_giuong="";
			foreach(DataRow r in get_data(sql).Tables[0].Rows)
			{
				dr=getrowbyid(dtbs,"ma='"+r["mabs"].ToString()+"'");
				if (dr!=null) s_tenbs=dr["hoten"].ToString();
				s_vao=(ngayvv!="")?ngayvv:r["ngayvao"].ToString();//(ngayvv!="")?ngayvv:;
				s_ra=(ngayrv!="")?ngayrv:r["ngayra"].ToString();//(ngayrv!="")?ngayrv:
				s_tenkp=r["tenkp"].ToString();
				mabn=r["mabn"].ToString();
				foreach(DataRow r1 in get_data("select a.traituyen,a.sothe,to_char(a.tungay,'dd/mm/yyyy') as tungay,to_char(a.denngay,'dd/mm/yyyy') as denngay,to_char(a.ngay1,'dd/mm/yyyy') as ngay1,to_char(a.ngay2,'dd/mm/yyyy') as ngay2,to_char(a.ngay3,'dd/mm/yyyy') as ngay3,b.tenbv from bhyt a,dmnoicapbhyt b where a.mabv=b.mabv(+) and a.maql="+l_maql).Tables[0].Rows)
				{
					s_sothe+=r1["sothe"].ToString().Trim()+";";
					s_tungay=r1["tungay"].ToString();
					s_denngay=r1["denngay"].ToString()+";";
					s_tenbv+=r1["tenbv"].ToString().Trim()+";";
					ngay1=r1["ngay1"].ToString();
					ngay2=r1["ngay2"].ToString();
					ngay3=r1["ngay3"].ToString();
					traituyen=int.Parse(r1["traituyen"].ToString());
				}
				i_madoituong=int.Parse(r["madoituong"].ToString());
				if (s_sothe!="")
					s_sothe=(s_sothe.Substring(s_sothe.Length-1,1)==";")?s_sothe.Substring(0,s_sothe.Length-1):s_sothe;
				s_chandoan=r["chandoan"].ToString().Trim()+";";
				s_maicd=r["maicd"].ToString().Trim()+";";
				foreach(DataRow r1 in get_data("select distinct chandoan,maicd from cdkemtheo where maql="+l_maql).Tables[0].Rows)
				{
					s_chandoan+=r1["chandoan"].ToString().Trim()+";";
					s_maicd+=r1["maicd"].ToString().Trim()+";";
				}
				s_giuong=r["giuong"].ToString().Trim();
				if (s_giuong=="") s_giuong=get_giuong(l_maql,r["makp"].ToString());
				updrec_ravien(dsngay,r["mabn"].ToString(),l_maql,long.Parse(r["id"].ToString()),
					r["hoten"].ToString(),r["namsinh"].ToString(),(r["phai"].ToString()=="0")?"Nam":"Nữ",r["sonha"].ToString().Trim()+" "+r["thon"].ToString().Trim()+", "+r["tenpxa"].ToString().Trim()+", "+r["tenquan"].ToString().Trim()+", "+r["tentt"].ToString().Trim()+" ^ "+r["cholam"].ToString(),
					int.Parse(r["madoituong"].ToString()),"",s_sothe,s_tungay,s_denngay,get_noigioithieu(l_maql),s_tenbv,s_giuong,
					r["makp"].ToString(),r["tenkp"].ToString(),s_vao,s_ra,s_chandoan,s_maicd,get_nguoinha(r["mabn"].ToString(),l_maql),2,phuongphapdieutri(r["makp"].ToString()),ketquadieutri(int.Parse(r["ketqua"].ToString()),
					int.Parse(r["ttlucrv"].ToString())),r["soluutru"].ToString()+"^"+r["sovaovien"].ToString(),r["mabs"].ToString(),s_tenbs,suserid,b1khu,ngay1,ngay2,ngay3,traituyen);
			}
			if (dsngay.Tables[0].Rows.Count>0)
			{
				if (s_vao=="" || s_ra=="")
				{
					s_vao=ngayvv;s_ra=ngayrv;
				}
				if (s_vao!="" && s_ra!="") upd_laitienthuoc(mabn,l_maql,s_vao,s_ra,true);
				string s=get_doituong(0,mabn,l_maql,0,s_vao,s_ra,"",dtkp,0,bCapcuu_noitru,loaiba,s_sothe);//lay tu-den
				if (s.Trim().Length>1)
				{
					string ngaypt="",tenpt="";
					sql="select a.tenpt,to_char(a.ngay,'dd/mm/yyyy') as ngay,c.ten as loaipt from pttt a,dmpttt b,loaipttt c where a.mapt=b.mapt and b.loaipt=c.ma and a.mabn='"+mabn+"'";
					sql+=" and to_date(a.ngay,'dd/mm/yy') between to_date('"+s_vao.Substring(0,10)+"','dd/mm/yy') and to_date('"+s_ra.Substring(0,10)+"','dd/mm/yy')";
					foreach(DataRow r in get_data(sql).Tables[0].Rows)
					{
						tenpt+=r["tenpt"].ToString().Trim()+"("+r["loaipt"].ToString().Trim()+");";
						ngaypt+=r["ngay"].ToString()+";";
					}
					if (ngaypt=="")
					{
						foreach(DataRow r1 in get_data("select to_char(ngay,'dd/mm/yyyy hh24:mi') as ngay from cdsankhoa where maql="+l_maql).Tables[0].Rows)
							ngaypt=r1["ngay"].ToString();
					}				
					string maso=l_maql.ToString().Trim()+",";
					if (loaiba==2) maso+=get_maso(l_maql,s_vao.Substring(0,10),s_ra.Substring(0,10));
					else
					{
						if (bKhoacdkham_chiphi)	maso+=Khoacdkham(mabn,l_maql,s_vao.Substring(0,10),s_ra.Substring(0,10));
						if (bCapve_noitru)
						{
							maso+=get_maso_khambenh(l_maql,s_vao.Substring(0,10));
							maso+=get_maso_maql(l_maql,s_vao.Substring(0,10),0);
						}
						else if (bCapcuu_noitru || bBHYTngtr_noitru) maso+=get_maso_maql(l_maql,s_vao.Substring(0,10),-1);				

						if(bCapcuu_noitru) maso+= get_maso_phongluu(maso,s_vao.Substring(0,10));	
					}				
					bool bChitietsothe=false;
					sql="select * from d_doituong where madoituong in ("+s.Substring(0,s.Length-1)+")";
					DataSet dssothe=get_data("select a.traituyen,a.sothe,to_char(a.tungay,'dd/mm/yyyy') as tungay,to_char(a.denngay,'dd/mm/yyyy') as denngay,to_char(a.tungay,'dd/mm/yyyy')||' ^ '||to_char(a.denngay,'dd/mm/yyyy') as tuden,b.tenbv,to_char(a.ngay1,'dd/mm/yyyy')||'^'||to_char(a.ngay2,'dd/mm/yyyy')||'^'||to_char(a.ngay3,'dd/mm/yyyy') as ngay123,to_char(a.ngay1,'dd/mm/yy')||' '||to_char(a.ngay2,'dd/mm/yy')||' '||to_char(a.ngay3,'dd/mm/yy') as ng123,to_char(a.ngay1,'dd/mm/yyyy') as ngay1,to_char(a.ngay2,'dd/mm/yyyy') as ngay2,to_char(a.ngay3,'dd/mm/yyyy') as ngay3,to_char(a.tungay,'yymmdd') as yymmdd from bhyt a,dmnoicapbhyt b where a.mabv=b.mabv(+) and a.maql="+l_maql+" and denngay is not null order by yymmdd");
					foreach(DataRow r in get_data(sql).Tables[0].Rows)
					{
				#region updrec
						if (bKhu)
						{
							foreach(DataRow r1 in dtkhu.Rows)
							{
								dr=ds.Tables[0].NewRow();
								dr["madoituongvao"]=i_madoituong;
								dr["mabn"]=dsngay.Tables[0].Rows[0]["mabn"].ToString();
								dr["hoten"]=dsngay.Tables[0].Rows[0]["hoten"].ToString();
								dr["namsinh"]=dsngay.Tables[0].Rows[0]["namsinh"].ToString();
								dr["ngayvao"]=dsngay.Tables[0].Rows[0]["ngayvao"].ToString();
								dr["ngayra"]=dsngay.Tables[0].Rows[0]["ngayra"].ToString();
								dr["madoituong"]=r["madoituong"].ToString();
								dr["doituong"]=r["doituong"].ToString();
								dr["sothe"]=dsngay.Tables[0].Rows[0]["sothe"].ToString();
								dr["maphu"]=0;
								dr["makp"]=dsngay.Tables[0].Rows[0]["makp"].ToString();
								dr["tenkp"]=dsngay.Tables[0].Rows[0]["tenkp"].ToString();
								dr["maql"]=l_maql;
								dr["idkhoa"]=l_idkhoa;
								dr["phai"]=dsngay.Tables[0].Rows[0]["phai"].ToString();
								dr["diachi"]=dsngay.Tables[0].Rows[0]["diachi"].ToString();
								dr["denngay"]=dsngay.Tables[0].Rows[0]["denngay"].ToString();
								dr["noigioithieu"]=dsngay.Tables[0].Rows[0]["noigioithieu"].ToString();
								dr["noicap"]=dsngay.Tables[0].Rows[0]["noicap"].ToString();
								dr["giuong"]=dsngay.Tables[0].Rows[0]["giuong"].ToString();
								dr["chandoan"]=dsngay.Tables[0].Rows[0]["chandoan"].ToString();
								dr["maicd"]=dsngay.Tables[0].Rows[0]["maicd"].ToString();
								dr["nguoinha"]=dsngay.Tables[0].Rows[0]["nguoinha"].ToString();
								dr["hinhthuc"]=dsngay.Tables[0].Rows[0]["hinhthuc"].ToString();
								dr["phuongphap"]=dsngay.Tables[0].Rows[0]["phuongphap"].ToString();
								dr["ketqua"]=dsngay.Tables[0].Rows[0]["ketqua"].ToString();
								dr["soluutru"]=dsngay.Tables[0].Rows[0]["soluutru"].ToString();
								dr["khu"]=r1["khu"].ToString();
								dr["done"]=0;
								dr["motkhu"]=1;
								dr["ngaypt"]=ngaypt;
								dr["tenpt"]=tenpt;
								dr["ngay1"]=ngay1;
								dr["ngay2"]=ngay2;
								dr["ngay3"]=ngay3;
								dr["maso"]=maso;
								dr["chon"]=true;
								dr["traituyen"]=traituyen;
								ds.Tables[0].Rows.Add(dr);
							}
						}
						else
						{
							if (dssothe.Tables[0].Rows.Count>1 && bDoituong_BHYT(r["madoituong"].ToString()) && bDoituong_BHYT(i_madoituong))//if (dssothe.Tables[0].Rows.Count>1 && r["madoituong"].ToString()=="1" && i_madoituong.ToString()=="1")
							{
								if (!bChitietsothe) bChitietsothe=true;
								dr=ds.Tables[0].NewRow();
								dr["madoituongvao"]=i_madoituong;
								dr["mabn"]=dsngay.Tables[0].Rows[0]["mabn"].ToString();
								dr["hoten"]=dsngay.Tables[0].Rows[0]["hoten"].ToString();
								dr["namsinh"]=dsngay.Tables[0].Rows[0]["namsinh"].ToString();
								dr["ngayvao"]=dsngay.Tables[0].Rows[0]["ngayvao"].ToString();
								dr["ngayra"]=dssothe.Tables[0].Rows[0]["denngay"].ToString()+" "+DateTime.Now.Hour.ToString().PadLeft(2,'0')+":"+DateTime.Now.Minute.ToString().PadLeft(2,'0');								
								dr["madoituong"]=r["madoituong"].ToString();
								dr["doituong"]=r["doituong"].ToString();
								dr["sothe"]=dsngay.Tables[0].Rows[0]["sothe"].ToString();
								dr["maphu"]=0;
								dr["makp"]=dsngay.Tables[0].Rows[0]["makp"].ToString();
								dr["tenkp"]=dsngay.Tables[0].Rows[0]["tenkp"].ToString();
								dr["maql"]=l_maql;
								dr["idkhoa"]=l_idkhoa;
								dr["phai"]=dsngay.Tables[0].Rows[0]["phai"].ToString();
								dr["diachi"]=dsngay.Tables[0].Rows[0]["diachi"].ToString();
								dr["denngay"]=dsngay.Tables[0].Rows[0]["denngay"].ToString();
								dr["noigioithieu"]=dsngay.Tables[0].Rows[0]["noigioithieu"].ToString();
								dr["noicap"]=dsngay.Tables[0].Rows[0]["noicap"].ToString();
								dr["giuong"]=dsngay.Tables[0].Rows[0]["giuong"].ToString();
								dr["chandoan"]=dsngay.Tables[0].Rows[0]["chandoan"].ToString();
								dr["maicd"]=dsngay.Tables[0].Rows[0]["maicd"].ToString();
								dr["nguoinha"]=dsngay.Tables[0].Rows[0]["nguoinha"].ToString();
								dr["hinhthuc"]=dsngay.Tables[0].Rows[0]["hinhthuc"].ToString();
								dr["phuongphap"]=dsngay.Tables[0].Rows[0]["phuongphap"].ToString();
								dr["ketqua"]=dsngay.Tables[0].Rows[0]["ketqua"].ToString();
								dr["soluutru"]=dsngay.Tables[0].Rows[0]["soluutru"].ToString();
								dr["khu"]=0;
								dr["motkhu"]=1;
								dr["done"]=0;
								dr["ngaypt"]=ngaypt;
								dr["tenpt"]=tenpt;
								dr["chon"]=true;
								dr["ngay1"]=ngay1;
								dr["ngay2"]=ngay2;
								dr["ngay3"]=ngay3;
								dr["maso"]=maso;
								dr["traituyen"]=traituyen;
								ds.Tables[0].Rows.Add(dr);
								//
								dr=ds.Tables[0].NewRow();
								dr["madoituongvao"]=i_madoituong;
								dr["mabn"]=dsngay.Tables[0].Rows[0]["mabn"].ToString();
								dr["hoten"]=dsngay.Tables[0].Rows[0]["hoten"].ToString();
								dr["namsinh"]=dsngay.Tables[0].Rows[0]["namsinh"].ToString();
								dr["ngayvao"]=DateToString("dd/MM/yyyy",StringToDate(dssothe.Tables[0].Rows[0]["denngay"].ToString()).AddDays(1))+" "+DateTime.Now.Hour.ToString().PadLeft(2,'0')+":"+DateTime.Now.Minute.ToString().PadLeft(2,'0');
								dr["ngayra"]=dsngay.Tables[0].Rows[0]["ngayra"].ToString();
								dr["madoituong"]=r["madoituong"].ToString();
								dr["doituong"]=r["doituong"].ToString();
								dr["sothe"]=dsngay.Tables[0].Rows[0]["sothe"].ToString();
								dr["maphu"]=0;
								dr["makp"]=dsngay.Tables[0].Rows[0]["makp"].ToString();
								dr["tenkp"]=dsngay.Tables[0].Rows[0]["tenkp"].ToString();
								dr["maql"]=l_maql;
								dr["idkhoa"]=l_idkhoa;
								dr["phai"]=dsngay.Tables[0].Rows[0]["phai"].ToString();
								dr["diachi"]=dsngay.Tables[0].Rows[0]["diachi"].ToString();
								dr["denngay"]=dsngay.Tables[0].Rows[0]["denngay"].ToString();
								dr["noigioithieu"]=dsngay.Tables[0].Rows[0]["noigioithieu"].ToString();
								dr["noicap"]=dsngay.Tables[0].Rows[0]["noicap"].ToString();
								dr["giuong"]=dsngay.Tables[0].Rows[0]["giuong"].ToString();
								dr["chandoan"]=dsngay.Tables[0].Rows[0]["chandoan"].ToString();
								dr["maicd"]=dsngay.Tables[0].Rows[0]["maicd"].ToString();
								dr["nguoinha"]=dsngay.Tables[0].Rows[0]["nguoinha"].ToString();
								dr["hinhthuc"]=dsngay.Tables[0].Rows[0]["hinhthuc"].ToString();
								dr["phuongphap"]=dsngay.Tables[0].Rows[0]["phuongphap"].ToString();
								dr["ketqua"]=dsngay.Tables[0].Rows[0]["ketqua"].ToString();
								dr["soluutru"]=dsngay.Tables[0].Rows[0]["soluutru"].ToString();
								dr["khu"]=0;
								dr["motkhu"]=1;
								dr["done"]=0;
								dr["ngaypt"]=ngaypt;
								dr["tenpt"]=tenpt;
								dr["chon"]=true;
								dr["ngay1"]=ngay1;
								dr["ngay2"]=ngay2;
								dr["ngay3"]=ngay3;
								dr["maso"]=maso;
								dr["traituyen"]=traituyen;
								ds.Tables[0].Rows.Add(dr);
							}
							else
							{
								dr=ds.Tables[0].NewRow();
								dr["madoituongvao"]=i_madoituong;
								dr["mabn"]=dsngay.Tables[0].Rows[0]["mabn"].ToString();
								dr["hoten"]=dsngay.Tables[0].Rows[0]["hoten"].ToString();
								dr["namsinh"]=dsngay.Tables[0].Rows[0]["namsinh"].ToString();
								dr["ngayvao"]=dsngay.Tables[0].Rows[0]["ngayvao"].ToString();
								dr["ngayra"]=dsngay.Tables[0].Rows[0]["ngayra"].ToString();
								dr["madoituong"]=r["madoituong"].ToString();
								dr["doituong"]=r["doituong"].ToString();
								dr["sothe"]=dsngay.Tables[0].Rows[0]["sothe"].ToString();
								dr["maphu"]=0;
								dr["makp"]=dsngay.Tables[0].Rows[0]["makp"].ToString();
								dr["tenkp"]=dsngay.Tables[0].Rows[0]["tenkp"].ToString();
								dr["maql"]=l_maql;
								dr["idkhoa"]=l_idkhoa;
								dr["phai"]=dsngay.Tables[0].Rows[0]["phai"].ToString();
								dr["diachi"]=dsngay.Tables[0].Rows[0]["diachi"].ToString();
								dr["denngay"]=dsngay.Tables[0].Rows[0]["denngay"].ToString();
								dr["noigioithieu"]=dsngay.Tables[0].Rows[0]["noigioithieu"].ToString();
								dr["noicap"]=dsngay.Tables[0].Rows[0]["noicap"].ToString();
								dr["giuong"]=dsngay.Tables[0].Rows[0]["giuong"].ToString();
								dr["chandoan"]=dsngay.Tables[0].Rows[0]["chandoan"].ToString();
								dr["maicd"]=dsngay.Tables[0].Rows[0]["maicd"].ToString();
								dr["nguoinha"]=dsngay.Tables[0].Rows[0]["nguoinha"].ToString();
								dr["hinhthuc"]=dsngay.Tables[0].Rows[0]["hinhthuc"].ToString();
								dr["phuongphap"]=dsngay.Tables[0].Rows[0]["phuongphap"].ToString();
								dr["ketqua"]=dsngay.Tables[0].Rows[0]["ketqua"].ToString();
								dr["soluutru"]=dsngay.Tables[0].Rows[0]["soluutru"].ToString();
								dr["khu"]=0;
								dr["motkhu"]=1;
								dr["done"]=0;
								dr["ngaypt"]=ngaypt;
								dr["tenpt"]=tenpt;
								dr["chon"]=true;
								dr["ngay1"]=ngay1;
								dr["ngay2"]=ngay2;
								dr["ngay3"]=ngay3;
								dr["maso"]=maso;
								dr["traituyen"]=traituyen;
								ds.Tables[0].Rows.Add(dr);
							}
						}
				#endregion
					}
					sql=" select a.id,a.ma,trim(a.ten)||' '||trim(a.hamluong)||' ['||trim(b.ten)||']' as ten,";
					sql+=" a.dang as dvt,c.stt as sttloai,c.ten as loai,d.stt as sttnhom,d.ten as nhom,a.bhyt,a.tenhc,trim(a.ten)||' '||trim(a.hamluong) as tenbd,a.kythuat,a.gia_bh, a.bhyt as bhyt_tt, -1 as vuottuyen"; 
					sql+=" from d_dmbd a,d_dmhang b,d_dmnhom c,v_nhomvp d";
					sql+=" where a.mahang=b.id and a.manhom=c.id and c.nhomvp=d.ma";
					DataTable dtbd=get_data(sql).Tables[0];
					sql="select a.id,a.ma,a.ten,a.dvt,b.stt as sttloai,b.ten as loai,c.stt as sttnhom,c.ten as nhom,a.bhyt";
					sql+=",a.gia_th,a.gia_bh,a.gia_dv,a.gia_nn,a.vattu_th,a.vattu_bh,a.vattu_dv,a.vattu_nn,a.gia_cs,a.vattu_cs,a.kythuat,a.chenhlech, a.bhyt_tt, a.vuottuyen ";
					sql+=" from v_giavp a,v_loaivp b,v_nhomvp c";
					sql+=" where a.id_loai=b.id and b.id_nhom=c.ma";
					DataTable dtvp=get_data(sql).Tables[0];
					//dsxml=get_ttravien_ct(dsxml,ds.Tables[0].Select("chon=true"),dsss.Tables[0].Select("chon=true"),dtkp,dtbd,dtvp,"",bCapcuu_noitru,loaiba,makp_rv,bN_dot,bRavien_ngia,bChitietsothe);
					dsxml=get_ttravien_ct(dsxml,ds.Tables[0].Select("","mabn"),dsss.Tables[0].Select("chon=true","mame,mabn"),dtkp,dtbd,dtvp,"",bCapcuu_noitru,loaiba,makp_rv,bN_dot,bRavien_ngia,bChitietsothe,songay(StringToDate(ngayrv.Substring(0,10)),StringToDate(ngayvv.Substring(0,10)),1).ToString());
					decimal tc=0;
					foreach(DataRow r in dsxml.Tables[0].Rows) tc+=decimal.Parse(r["sotien"].ToString());
					execute_data("update xuatvien set sotien="+tc+" where maql="+l_maql);
				}
			}
			return dsxml;
		}

		public string get_tenkp(string makp)
		{
			ds=get_data("select tenkp from btdkp_bv where makp='"+makp+"'");
			if (ds.Tables[0].Rows.Count>0) return ds.Tables[0].Rows[0]["tenkp"].ToString();
			else return "";
		}

		public bool get_capso(string makp)
		{
			return get_data("select * from btdkp_bv where capso>0 and makp='"+makp+"'").Tables[0].Rows.Count>0;
		}

		public bool upd_ttmat(long m_maql,string m_mp,string m_mt,string m_nhanapp,string m_nhanapt)
		{
			sql="update ttmat set mp=:m_mp,mt=:m_mt,nhanapp=:m_nhanapp,nhanapt=:m_nhanapt";
			sql+=" where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_mp",OracleType.NVarChar,30).Value=m_mp;
				cmd.Parameters.Add("m_mt",OracleType.NVarChar,30).Value=m_mt;
				cmd.Parameters.Add("m_nhanapp",OracleType.NVarChar,30).Value=m_nhanapp;
				cmd.Parameters.Add("m_nhanapt",OracleType.NVarChar,30).Value=m_nhanapt;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into ttmat(maql,mp,mt,nhanapp,nhanapt) values (:m_maql,:m_mp,:m_mt,:m_nhanapp,:m_nhanapt)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_mp",OracleType.NVarChar,30).Value=m_mp;
					cmd.Parameters.Add("m_mt",OracleType.NVarChar,30).Value=m_mt;
					cmd.Parameters.Add("m_nhanapp",OracleType.NVarChar,30).Value=m_nhanapp;
					cmd.Parameters.Add("m_nhanapt",OracleType.NVarChar,30).Value=m_nhanapt;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ttmat "+m_maql.ToString());
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ttmat_rv(long m_maql,string m_mpr,string m_mtr,string m_nhanappr,string m_nhanaptr)
		{
			sql="update ttmat set mpr=:m_mpr,mtr=:m_mtr,nhanappr=:m_nhanappr,nhanaptr=:m_nhanaptr";
			sql+=" where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_mpr",OracleType.NVarChar,30).Value=m_mpr;
				cmd.Parameters.Add("m_mtr",OracleType.NVarChar,30).Value=m_mtr;
				cmd.Parameters.Add("m_nhanappr",OracleType.NVarChar,30).Value=m_nhanappr;
				cmd.Parameters.Add("m_nhanaptr",OracleType.NVarChar,30).Value=m_nhanaptr;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				cmd.ExecuteNonQuery();
				cmd.Dispose();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ttmat "+m_maql.ToString());
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ttmat(long m_maql,string m_mp,string m_mt,string m_nhanapp,string m_nhanapt,string m_mpkk,string m_mtkk)
		{
			sql="update ttmat set mp=:m_mp,mt=:m_mt,nhanapp=:m_nhanapp,nhanapt=:m_nhanapt,mpkk=:m_mpkk,mtkk=:m_mtkk";
			sql+=" where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_mp",OracleType.NVarChar,30).Value=m_mp;
				cmd.Parameters.Add("m_mt",OracleType.NVarChar,30).Value=m_mt;
				cmd.Parameters.Add("m_nhanapp",OracleType.NVarChar,30).Value=m_nhanapp;
				cmd.Parameters.Add("m_nhanapt",OracleType.NVarChar,30).Value=m_nhanapt;
				cmd.Parameters.Add("m_mpkk",OracleType.NVarChar,30).Value=m_mpkk;
				cmd.Parameters.Add("m_mtkk",OracleType.NVarChar,30).Value=m_mtkk;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into ttmat(maql,mp,mt,nhanapp,nhanapt,mpkk,mtkk) values (:m_maql,:m_mp,:m_mt,:m_nhanapp,:m_nhanapt,:m_mpkk,:m_mtkk)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_mp",OracleType.NVarChar,30).Value=m_mp;
					cmd.Parameters.Add("m_mt",OracleType.NVarChar,30).Value=m_mt;
					cmd.Parameters.Add("m_nhanapp",OracleType.NVarChar,30).Value=m_nhanapp;
					cmd.Parameters.Add("m_nhanapt",OracleType.NVarChar,30).Value=m_nhanapt;
					cmd.Parameters.Add("m_mpkk",OracleType.NVarChar,30).Value=m_mpkk;
					cmd.Parameters.Add("m_mtkk",OracleType.NVarChar,30).Value=m_mtkk;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ttmat "+m_maql.ToString());
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public void check_process_Excel()
		{
			Process[] processes=Process.GetProcesses();
			if (processes.Length > 1)
			{
				int i=0;
				for (int n=0; n <= processes.Length-1;n++)
				{
					if(((Process)processes[n]).ProcessName=="EXCEL")
					{
						i++;
						((Process)processes[n]).Kill();
					}
				}
			}
		}		

		public int check_process(string program)
		{
			try
			{
				int i=0;
				Process[] processes=Process.GetProcesses();
				if (processes.Length > 1)
					for (int n=0; n <= processes.Length-1;n++)
						if(((Process)processes[n]).ProcessName.ToString().ToUpper()==program) i++;
				return i;
			}
			catch{return 1;}
		}		

		public void check_process(int so,string program)
		{
			Process[] processes=Process.GetProcesses();
			int sopro=processes.Length;
			if (sopro > so)
			{
				for (int n=0; n <= processes.Length-1;n++)
					if(((Process)processes[n]).ProcessName==program)
					{
						((Process)processes[n]).Kill();
						sopro--;
						if (sopro==so) break;
					}
			}
		}		

		public bool upd_cls_danhmuc(string m_table,long m_id,int m_loai,string m_ten)
		{
			sql="update "+m_table+" set ten=:m_ten,loai=:m_loai where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_ten",OracleType.NVarChar,100).Value=m_ten;
				cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+m_table+" (id,ten,loai) values (:m_id,:m_ten,:m_loai)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ten",OracleType.NVarChar,100).Value=m_ten;
					cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim(),sComputer,m_table);
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_cls_loai(int m_id,string m_ten,int m_hinh,int m_nhomvp,int m_ytaphu,int m_thuoc,int m_canquang,int m_gayme,int m_mat,int m_phanung,int m_sa,int m_phim,int m_madia,int m_may)
		{
			sql="update cls_loai set ten=:m_ten,hinh=:m_hinh,nhomvp=:m_nhomvp,ytaphu=:m_ytaphu,thuoc=:m_thuoc,canquang=:m_canquang,gayme=:m_gayme,mat=:m_mat,phanung=:m_phanung,sa=:m_sa,phim=:m_phim,madia=:m_madia,may=:m_may where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_ten",OracleType.NVarChar,100).Value=m_ten;
				cmd.Parameters.Add("m_hinh",OracleType.Number).Value=m_hinh;
				cmd.Parameters.Add("m_nhomvp",OracleType.Number).Value=m_nhomvp;
				cmd.Parameters.Add("m_ytaphu",OracleType.Number).Value=m_ytaphu;
				cmd.Parameters.Add("m_thuoc",OracleType.Number).Value=m_thuoc;
				cmd.Parameters.Add("m_canquang",OracleType.Number).Value=m_canquang;
				cmd.Parameters.Add("m_gayme",OracleType.Number).Value=m_gayme;
				cmd.Parameters.Add("m_mat",OracleType.Number).Value=m_mat;
				cmd.Parameters.Add("m_phanung",OracleType.Number).Value=m_phanung;
				cmd.Parameters.Add("m_sa",OracleType.Number).Value=m_sa;
				cmd.Parameters.Add("m_phim",OracleType.Number).Value=m_phim;
				cmd.Parameters.Add("m_madia",OracleType.Number).Value=m_madia;
				cmd.Parameters.Add("m_may",OracleType.Number).Value=m_may;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into cls_loai (id,ten,hinh,nhomvp,ytaphu,thuoc,canquang,gayme,mat,phanung,sa,phim,madia,may) values (:m_id,:m_ten,:m_hinh,:m_nhomvp,:m_ytaphu,:m_thuoc,:m_canquang,:m_gayme,:m_mat,:m_phanung,:m_sa,:m_phim,:m_madia,:m_may)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ten",OracleType.NVarChar,100).Value=m_ten;
					cmd.Parameters.Add("m_hinh",OracleType.Number).Value=m_hinh;
					cmd.Parameters.Add("m_nhomvp",OracleType.Number).Value=m_nhomvp;
					cmd.Parameters.Add("m_ytaphu",OracleType.Number).Value=m_ytaphu;
					cmd.Parameters.Add("m_thuoc",OracleType.Number).Value=m_thuoc;
					cmd.Parameters.Add("m_canquang",OracleType.Number).Value=m_canquang;
					cmd.Parameters.Add("m_gayme",OracleType.Number).Value=m_gayme;
					cmd.Parameters.Add("m_mat",OracleType.Number).Value=m_mat;
					cmd.Parameters.Add("m_phanung",OracleType.Number).Value=m_phanung;
					cmd.Parameters.Add("m_sa",OracleType.Number).Value=m_sa;
					cmd.Parameters.Add("m_phim",OracleType.Number).Value=m_phim;
					cmd.Parameters.Add("m_madia",OracleType.Number).Value=m_madia;
					cmd.Parameters.Add("m_may",OracleType.Number).Value=m_may;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim(),sComputer,"cls_loai");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_cls_kehoach(string m_mmyy,int m_id,decimal m_so)
		{
			sql="update cls_kehoach set so=:m_so where mmyy=:m_mmyy and id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_so",OracleType.Number).Value=m_so;
				cmd.Parameters.Add("m_mmyy",OracleType.VarChar,4).Value=m_mmyy;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into cls_kehoach (mmyy,id,so) values (:m_mmyy,:m_id,:m_so)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_mmyy",OracleType.VarChar,4).Value=m_mmyy;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_so",OracleType.Number).Value=m_so;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim(),sComputer,"cls_kehoach");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_cls_hen(long m_id,int m_songay,string m_ghichu,int m_loai)
		{
			sql="update cls_hen set songay=:m_songay,ghichu=:m_ghichu,loai=:m_loai where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_songay",OracleType.Number).Value=m_songay;
				cmd.Parameters.Add("m_ghichu",OracleType.NVarChar,254).Value=m_ghichu;
				cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into cls_hen (id,songay,ghichu,loai) values (:m_id,:m_songay,:m_ghichu,:m_loai)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_songay",OracleType.Number).Value=m_songay;
					cmd.Parameters.Add("m_ghichu",OracleType.NVarChar,254).Value=m_ghichu;
					cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim(),sComputer,"cls_hen");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_cls_hinh(long m_id,int m_stt,string m_hinh)
		{
			sql="update cls_hinh set stt=:m_stt,hinh=:m_hinh where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
				cmd.Parameters.Add("m_hinh",OracleType.VarChar,254).Value=m_hinh;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into cls_hinh (id,stt,hinh) values (:m_id,:m_stt,:m_hinh)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
					cmd.Parameters.Add("m_hinh",OracleType.VarChar,254).Value=m_hinh;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim(),sComputer,"cls_hinh");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_cls_mota(long m_id,string m_noidung)
		{
			sql="update cls_mota set noidung=:m_noidung where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_noidung",OracleType.NVarChar,2000).Value=m_noidung;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into cls_mota (id,noidung) values (:m_id,:m_noidung)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_noidung",OracleType.NVarChar,2000).Value=m_noidung;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim(),sComputer,"cls_mota");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_cls_motact(long m_id,int m_canquang,int m_gayme)
		{
			sql="update cls_motact set canquang=:m_canquang,gayme=:m_gayme where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_canquang",OracleType.Number).Value=m_canquang;
				cmd.Parameters.Add("m_gayme",OracleType.Number).Value=m_gayme;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into cls_motact (id,canquang,gayme) values (:m_id,:m_canquang,:m_gayme)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_canquang",OracleType.Number).Value=m_canquang;
					cmd.Parameters.Add("m_gayme",OracleType.Number).Value=m_gayme;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim(),sComputer,"cls_motact");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_cls_noidung(long m_id,int m_loai,string m_ma,string m_ten)
		{
			sql="update cls_noidung set loai=:m_loai,ma=:m_ma,ten=:m_ten where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
				cmd.Parameters.Add("m_ma",OracleType.VarChar,10).Value=m_ma;
				cmd.Parameters.Add("m_ten",OracleType.NVarChar,254).Value=m_ten;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into cls_noidung (id,loai,ma,ten) values (:m_id,:m_loai,:m_ma,:m_ten)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
					cmd.Parameters.Add("m_ma",OracleType.VarChar,10).Value=m_ma;
					cmd.Parameters.Add("m_ten",OracleType.NVarChar,254).Value=m_ten;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim(),sComputer,"cls_noidung");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_cls_thuchien(long m_id,string m_mabn,long m_maql,string m_makp,string m_ngay,int m_loai,
			string m_bscd,string m_bsth,string m_maicd,string m_chandoan,int m_loaibn,int m_kham,int m_madoituong,
			string m_ma,string m_ten,int m_ketqua,int m_denghi,string m_ghichu,int m_userid,string m_ytaphu)
		{
			sql="update cls_thuchien set mabn=:m_mabn,maql=:m_maql,makp=:m_makp,ngay=:m_ngay,loai=:m_loai,";
			sql+="bscd=:m_bscd,bsth=:m_bsth,maicd=:m_maicd,chandoan=:m_chandoan,loaibn=:m_loaibn,";
			sql+="kham=:m_kham,madoituong=:m_madoituong,ma=:m_ma,ten=:m_ten,ketqua=:m_ketqua,denghi=:m_denghi,";
			sql+="ghichu=:m_ghichu,userid=:m_userid,ytaphu=:m_ytaphu where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
				cmd.Parameters.Add("m_bscd",OracleType.VarChar,4).Value=m_bscd;
				cmd.Parameters.Add("m_bsth",OracleType.VarChar,4).Value=m_bsth;
				cmd.Parameters.Add("m_maicd",OracleType.VarChar,9).Value=m_maicd;
				cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,254).Value=m_chandoan;
				cmd.Parameters.Add("m_loaibn",OracleType.Number).Value=m_loaibn;
				cmd.Parameters.Add("m_kham",OracleType.Number).Value=m_kham;
				cmd.Parameters.Add("m_madoituong",OracleType.Number).Value=m_madoituong;
				cmd.Parameters.Add("m_ma",OracleType.VarChar,10).Value=m_ma;
				cmd.Parameters.Add("m_ten",OracleType.NVarChar,2000).Value=m_ten;
				cmd.Parameters.Add("m_ketqua",OracleType.Number).Value=m_ketqua;
				cmd.Parameters.Add("m_denghi",OracleType.Number).Value=m_denghi;
				cmd.Parameters.Add("m_ghichu",OracleType.NVarChar,500).Value=m_ghichu;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_ytaphu",OracleType.VarChar,4).Value=m_ytaphu;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into cls_thuchien (id,mabn,maql,makp,ngay,loai,bscd,bsth,maicd,chandoan,loaibn,kham,madoituong,ma,ten,ketqua,denghi,ghichu,userid,ytaphu) values (:m_id,:m_mabn,:m_maql,:m_makp,:m_ngay,:m_loai,:m_bscd,:m_bsth,:m_maicd,:m_chandoan,:m_loaibn,:m_kham,:m_madoituong,:m_ma,:m_ten,:m_ketqua,:m_denghi,:m_ghichu,:m_userid,:m_ytaphu)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
					cmd.Parameters.Add("m_bscd",OracleType.VarChar,4).Value=m_bscd;
					cmd.Parameters.Add("m_bsth",OracleType.VarChar,4).Value=m_bsth;
					cmd.Parameters.Add("m_maicd",OracleType.VarChar,9).Value=m_maicd;
					cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,254).Value=m_chandoan;
					cmd.Parameters.Add("m_loaibn",OracleType.Number).Value=m_loaibn;
					cmd.Parameters.Add("m_kham",OracleType.Number).Value=m_kham;
					cmd.Parameters.Add("m_madoituong",OracleType.Number).Value=m_madoituong;
					cmd.Parameters.Add("m_ma",OracleType.VarChar,10).Value=m_ma;
					cmd.Parameters.Add("m_ten",OracleType.NVarChar,2000).Value=m_ten;
					cmd.Parameters.Add("m_ketqua",OracleType.Number).Value=m_ketqua;
					cmd.Parameters.Add("m_denghi",OracleType.Number).Value=m_denghi;
					cmd.Parameters.Add("m_ghichu",OracleType.NVarChar,500).Value=m_ghichu;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					cmd.Parameters.Add("m_ytaphu",OracleType.VarChar,4).Value=m_ytaphu;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim(),sComputer,"cls_thuchien");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_cls_mat(long m_id,int m_mp,int m_mt)
		{
			sql="update cls_mat set mp=:m_mp,mt=:m_mt where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_mp",OracleType.Number).Value=m_mp;
				cmd.Parameters.Add("m_mt",OracleType.Number).Value=m_mt;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into cls_mat (id,mp,mt) values (:m_id,:m_mp,:m_mt)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_mp",OracleType.Number).Value=m_mp;
					cmd.Parameters.Add("m_mt",OracleType.Number).Value=m_mt;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim(),sComputer,"cls_mat");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_cls_sdthuoc(long m_id,int m_thuoc)
		{
			sql="update cls_sdthuoc set thuoc=:m_thuoc where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_thuoc",OracleType.Number).Value=m_thuoc;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into cls_sdthuoc (id,thuoc) values (:m_id,:m_thuoc)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_thuoc",OracleType.Number).Value=m_thuoc;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim(),sComputer,"cls_sdthuoc");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}
		//cao vu 26/06
		public string get_tamung(string mabn,string ngay,int madoituong)
		{
			
			string _mmyy=mmyy(ngay),xxx=user+_mmyy,sql,s=" ";
			decimal st=0;
			if (bMmyy(_mmyy))
			{
				sql="select to_char(a.ngay,'dd/mm/yyyy') as ngaythu, c.sohieu,a.sobienlai,b.hoten,sum(a.sotien) as sotien from "+xxx+".v_tamung a,"+user+".v_dlogin b,"+user+".v_quyenso c";
				sql+=" where a.userid=b.id and a.quyenso=c.id and a.mabn='"+mabn+"'";
				sql+=" and to_char(a.ngay,'dd/mm/yyyy')='"+ngay+"' and a.loaibn in (0,3,4) and a.done=0";
				if (madoituong!=0) sql+=" and a.madoituong="+madoituong;
				sql+=" group by to_char(a.ngay,'dd/mm/yyyy'), c.sohieu,a.sobienlai,b.hoten";
				foreach(DataRow r in get_data(sql).Tables[0].Rows)
				{
					s+="Ngày: "+r["ngaythu"].ToString()+" - "+r["sohieu"].ToString().Trim()+"-"+r["sobienlai"].ToString().Trim()+" Người thu :"+r["hoten"].ToString().Trim()+";";
					st+=decimal.Parse(r["sotien"].ToString());
				}
			}
			return st.ToString()+"^"+s;
		}
		//cao vu 26/06
		public string get_tamung(string mabn,string tungay,string denngay,int madoituong)
		{
			
			string _mmyy=mmyy(tungay),xxx=user+_mmyy,sql,s=" ";
			decimal st=0;
			
			sql="select to_char(a.ngay,'dd/mm/yyyy') as ngaythu, c.sohieu,a.sobienlai,b.hoten,sum(a.sotien) as sotien from xxx.v_tamung a,"+user+".v_dlogin b,"+user+".v_quyenso c";
			sql+=" where a.userid=b.id and a.quyenso=c.id and a.mabn='"+mabn+"'";
			sql+=" and to_date(to_char(a.ngay,'dd/mm/yyyy'),'dd/mm/yyyy') between to_date('"+tungay+"','dd/mm/yyyy') and to_date('"+denngay+"','dd/mm/yyyy') and a.loaibn in (0,3,4) and a.done=0";
			if (madoituong!=0) sql+=" and a.madoituong="+madoituong;
			sql+=" group by to_char(a.ngay,'dd/mm/yyyy'),c.sohieu,a.sobienlai,b.hoten";
			foreach(DataRow r in get_data_mmyy(sql,tungay,denngay,0).Tables[0].Rows)
			{
				s+="Ngày: "+r["ngaythu"].ToString()+" - "+ r["sohieu"].ToString().Trim()+"-"+r["sobienlai"].ToString().Trim()+" Người thu :"+r["hoten"].ToString().Trim()+";";
				st+=decimal.Parse(r["sotien"].ToString());
			}
			return st.ToString()+"^"+s;
		}
		//cao vu 26/06
		public decimal get_tamung(string mabn,long maql,string tu,string den,string makp,int madoituong)
		{			
			DateTime dt1 = StringToDate(tu).AddDays(-iNgaykiemke);
			DateTime dt2 = StringToDate(den).AddDays(iNgaykiemke);
			int y1 = dt1.Year, m1 = dt1.Month;
			int y2 = dt2.Year, m2 = dt2.Month;
			int itu, iden;
			string sql,mmyy = "",s="",xxx;
			decimal st=0;
			DataTable dt;
			long maql_phongluu=0;
			if (bCapcuu_noitru) maql_phongluu=get_maql_phongluu(maql);
			for (int i = y1; i <= y2; i++)
			{
				itu = (i == y1) ? m1 : 1;
				iden = (i == y2) ? m2 : 12;
				for (int j = itu; j <= iden; j++)
				{
					mmyy = j.ToString().PadLeft(2, '0') + i.ToString().Substring(2, 2);
					xxx=user+mmyy;
					if (bMmyy(mmyy))
					{
						sql="select quyenso,sobienlai,sum(sotien) as sotien from "+xxx+".v_tamung where maql="+maql;
						sql+=" and to_date(ngay,'dd/mm/yy') between to_date('"+tu.Substring(0,10)+"','dd/mm/yy') and to_date('"+den.Substring(0,10)+"','dd/mm/yy')";
						if (makp!="") sql+=" and makp='"+makp+"'";
						if (madoituong!=0) sql+=" and madoituong="+madoituong;
						sql+=" group by quyenso,sobienlai";
						if (maql_phongluu!=0)
						{
							sql+=" union all ";
							sql+="select quyenso,sobienlai,sum(sotien) as sotien from "+xxx+".v_tamung where maql="+maql_phongluu;
							if (madoituong!=0) sql+=" and madoituong="+madoituong;
							sql+=" group by quyenso,sobienlai";
						}
						dt=get_data(sql).Tables[0];
						foreach(DataRow r in dt.Rows)
						{
							s+=r["quyenso"].ToString().Trim()+"-"+r["sobienlai"].ToString().Trim()+";";
							st+=decimal.Parse(r["sotien"].ToString());
						}
					}
				}
			}
			for(int i=y1;i<=y2;i++)
			{
				itu=(i==y1)?m1:1;
				iden=(i==y2)?m2:12;
				for(int j=itu;j<=iden;j++)
				{
					mmyy=j.ToString().PadLeft(2,'0')+i.ToString().Substring(2,2);
					xxx=user+mmyy;
					if (bMmyy(mmyy))
					{
						sql="select sum(a.sotien) sotien, a.quyenso,a.sobienlai  from "+xxx+".v_hoantra a, "+user+".v_quyenso b,"+userid+".btdkp_bv e where a.quyenso=b.id and a.makp=e.makp(+) and a.mabn='"+mabn+"'";
						sql+=" and to_date(a.ngay,'dd/mm/yy') between to_date('"+tu.Substring(0,10)+"','dd/mm/yy') and to_date('"+den.Substring(0,10)+"','dd/mm/yy')";
						sql+=" and a.loaibn=2";
						sql+=" group by a.quyenso,a.sobienlai";
						ds=get_data(sql);					
						foreach(DataRow r in ds.Tables[0].Rows)
						{
							if (s.IndexOf(r["quyenso"].ToString().Trim()+"-"+r["sobienlai"].ToString().Trim()+";")!=-1)
								st-=decimal.Parse(r["sotien"].ToString());
						}
					}
				}  
			}
			return st;
		}

		public decimal get_vienphi(long maql,string tu,string den,string makp,int madoituong,bool bCongno)
		{
			
			DateTime dt1 = StringToDate(tu).AddDays(-3);
			DateTime dt2 = StringToDate(den).AddDays(3);
			int y1 = dt1.Year, m1 = dt1.Month;
			int y2 = dt2.Year, m2 = dt2.Month;
			int itu, iden;
			string sql,mmyy = "",xxx;
			decimal st=0;
			DataTable dt;
			long maql_phongluu=0;
			if (bCapcuu_noitru) maql_phongluu=get_maql_phongluu(maql);
			else maql_phongluu=0;
			if (maql_phongluu==maql) maql_phongluu=0;
			for (int i = y1; i <= y2; i++)
			{
				itu = (i == y1) ? m1 : 1;
				iden = (i == y2) ? m2 : 12;
				for (int j = itu; j <= iden; j++)
				{
					mmyy = j.ToString().PadLeft(2, '0') + i.ToString().Substring(2, 2);
					xxx=user+mmyy;
					if (bMmyy(mmyy))
					{
						sql="select sum(a.soluong*(a.dongia+a.vattu)) as sotien from "+xxx+".v_vpkhoa a,"+user+".btdkp_bv b,"+user+".doituong c where a.makp=b.makp and a.madoituong=c.madoituong";
						sql+=" and a.maql="+maql;
						if (bCongno) sql+=" and c.mien=0 and a.done=0";
						else sql+=" and to_date(a.ngay,'dd/mm/yy') between to_date('"+tu+"','dd/mm/yy') and to_date('"+den+"','dd/mm/yy')";
						if (makp!="") sql+=" and a.makp='"+makp+"'";
						if (madoituong!=0) sql+=" and a.madoituong="+madoituong;
						dt=get_data(sql).Tables[0];
						if (dt.Rows[0]["sotien"].ToString()!="") st+=decimal.Parse(dt.Rows[0]["sotien"].ToString());
						if (bChidinh_vienphi)
						{
							sql="select sum(a.soluong*(a.dongia+a.vattu)) as sotien from "+xxx+".v_chidinh a,"+user+".btdkp_bv b,"+user+".doituong c where a.makp=b.makp and a.madoituong=c.madoituong";
							sql+=" and a.maql="+maql;
							if (bCongno) sql+=" and c.mien=0  and a.paid=0";
							else sql+=" and to_date(a.ngay,'dd/mm/yy') between to_date('"+tu+"','dd/mm/yy') and to_date('"+den+"','dd/mm/yy')";
							if (makp!="") sql+=" and a.makp='"+makp+"'";
							if (madoituong!=0) sql+=" and a.madoituong="+madoituong;
							dt=get_data(sql).Tables[0];
							if (dt.Rows[0]["sotien"].ToString()!="") st+=decimal.Parse(dt.Rows[0]["sotien"].ToString());
						}
						if (maql_phongluu!=0)
						{
							sql="select sum(a.soluong*(a.dongia+a.vattu)) as sotien from "+xxx+".v_vpkhoa a,"+user+".btdkp_bv b,"+user+".doituong c where a.makp=b.makp and a.madoituong=c.madoituong";
							sql+=" and a.maql="+maql_phongluu;
							if (bCongno) sql+=" and c.mien=0 and a.done=0";
							if (makp!="") sql+=" and a.makp='"+makp+"'";
							if (madoituong!=0) sql+=" and a.madoituong="+madoituong;
							dt=get_data(sql).Tables[0];
							if (dt.Rows[0]["sotien"].ToString()!="") st+=decimal.Parse(dt.Rows[0]["sotien"].ToString());
							if (bChidinh_vienphi)
							{
								sql="select sum(a.soluong*(a.dongia+a.vattu)) as sotien from "+xxx+".v_chidinh a,"+user+".btdkp_bv b,"+user+".doituong c where a.makp=b.makp and a.madoituong=c.madoituong";
								sql+=" and a.maql="+maql_phongluu;
								if (bCongno) sql+=" and c.mien=0  and a.paid=0";
								if (makp!="") sql+=" and a.makp='"+makp+"'";
								if (madoituong!=0) sql+=" and a.madoituong="+madoituong;
								dt=get_data(sql).Tables[0];
								if (dt.Rows[0]["sotien"].ToString()!="") st+=decimal.Parse(dt.Rows[0]["sotien"].ToString());
							}
						}
					}
				}
			}
			if (bPhonggiuong)
			{
				if (bGiuong_block)
				{
					sql="select a.mabn,a.id,a.makp,a.idkhoa,to_char(a.tu,'dd/mm/yyyy hh24:mi') as tu,a.dongia,a.idgiuong,a.madoituong,c.dichvu";
					sql+=" from theodoigiuong a,dmgiuong b,dmphong c where a.idgiuong=b.id and b.idphong=c.id ";
					sql+=" and maql="+maql;
					sql+=" and a.soluong=0";
					foreach(DataRow r1 in get_data(sql).Tables[0].Rows)
						st+=songayblock(null,StringToDateTime(ngayhienhanh_server),StringToDateTime(r1["tu"].ToString()),ngayhienhanh_server,long.Parse(r1["id"].ToString()),r1["mabn"].ToString(),maql,long.Parse(r1["idkhoa"].ToString()),den,r1["makp"].ToString(),int.Parse(r1["madoituong"].ToString()),decimal.Parse(r1["dongia"].ToString()),int.Parse(r1["idgiuong"].ToString()));					
				}
				else
				{
					int _madoituong_giuongdichvu=bMadoituong_giuongdichvu?madoituong_giuongdichvu:0,_madoituong=0;
					double _songay=0;
					bool _bNgayra_ngayvao_1=bNgayra_ngayvao_1;
					sql="select a.mabn,a.id,a.makp,a.idkhoa,to_char(a.tu,'dd/mm/yyyy hh24:mi') as tu,a.dongia,a.idgiuong,a.madoituong,c.dichvu,to_char(sysdate,'dd/mm/yyyy hh24:mi') as den";
					sql+=" from theodoigiuong a,dmgiuong b,dmphong c where a.idgiuong=b.id and b.idphong=c.id ";
					sql+=" and maql="+maql;
					sql+=" and a.soluong=0 and to_char(a.tu,'dd/mm/yyyy')<>to_char(nvl(a.den,to_date('01/01/9999','dd/mm/yyyy')),'dd/mm/yyyy')";
					foreach(DataRow r1 in get_data(sql).Tables[0].Rows)
					{
						if (_bNgayra_ngayvao_1 && _madoituong_giuongdichvu!=0) _madoituong=(r1["dichvu"].ToString()=="1")?_madoituong_giuongdichvu:madoituong;
						_songay=(_bNgayra_ngayvao_1)?songaygiuong(StringToDateTime(r1["den"].ToString()),StringToDateTime(r1["tu"].ToString()),1,int.Parse(r1["idgiuong"].ToString())):Math.Max(0,songay(StringToDateTime(r1["den"].ToString()),StringToDateTime(r1["tu"].ToString()),0));
						st+=Convert.ToDecimal(_songay)*decimal.Parse(r1["dongia"].ToString());
					}
				}
			}
			return st;
		}

		public string get_sovaovien(long maql)
		{
			ds=get_data("select sovaovien from benhandt where maql="+maql);
			if (ds.Tables[0].Rows.Count>0) return ds.Tables[0].Rows[0]["sovaovien"].ToString();
			else return "";
		}

		public bool upd_le_danhmuc(string m_table,long m_id,string m_ma,string m_ten)
		{
			sql="update "+m_table+" set ma=:m_ma,ten=:m_ten where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_ma",OracleType.VarChar,10).Value=m_ma;
				cmd.Parameters.Add("m_ten",OracleType.NVarChar,100).Value=m_ten;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+m_table+" (id,ma,ten) values (:m_id,:m_ma,:m_ten)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.VarChar,10).Value=m_ma;
					cmd.Parameters.Add("m_ten",OracleType.NVarChar,100).Value=m_ten;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim(),sComputer,m_table);
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_le_mat(long m_id,int m_mp,int m_mt)
		{
			sql="update le_mat set mp=:m_mp,mt=:m_mt where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_mp",OracleType.Number).Value=m_mp;
				cmd.Parameters.Add("m_mt",OracleType.Number).Value=m_mt;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into le_mat (id,mp,mt) values (:m_id,:m_mp,:m_mt)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_mp",OracleType.Number).Value=m_mp;
					cmd.Parameters.Add("m_mt",OracleType.Number).Value=m_mt;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim(),sComputer,"le_mat");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_le_thuchien(long m_id,string m_mabn,long m_maql,string m_makp,string m_ngay,
			int m_loaibn,int m_kham,int m_madoituong,int m_sohoso,string m_mabs,int m_userid)
		{
			sql="update le_thuchien set mabn=:m_mabn,maql=:m_maql,makp=:m_makp,ngay=:m_ngay,";
			sql+="loaibn=:m_loaibn,kham=:m_kham,madoituong=:m_madoituong,sohoso=:m_sohoso,mabs=:m_mabs,userid=:m_userid where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_loaibn",OracleType.Number).Value=m_loaibn;
				cmd.Parameters.Add("m_kham",OracleType.Number).Value=m_kham;
				cmd.Parameters.Add("m_madoituong",OracleType.Number).Value=m_madoituong;
				cmd.Parameters.Add("m_sohoso",OracleType.Number).Value=m_sohoso;
				cmd.Parameters.Add("m_mabs",OracleType.VarChar,4).Value=m_mabs;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into le_thuchien (id,mabn,maql,makp,ngay,loaibn,kham,madoituong,sohoso,mabs,userid) values (:m_id,:m_mabn,:m_maql,:m_makp,:m_ngay,:m_loaibn,:m_kham,:m_madoituong,:m_sohoso,:m_mabs,:m_userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_loaibn",OracleType.Number).Value=m_loaibn;
					cmd.Parameters.Add("m_kham",OracleType.Number).Value=m_kham;
					cmd.Parameters.Add("m_madoituong",OracleType.Number).Value=m_madoituong;
					cmd.Parameters.Add("m_sohoso",OracleType.Number).Value=m_sohoso;
					cmd.Parameters.Add("m_mabs",OracleType.VarChar,4).Value=m_mabs;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim(),sComputer,"le_thuchien");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_le_hen(long m_id,int m_songay,string m_ghichu,int m_loai)
		{
			sql="update le_hen set songay=:m_songay,ghichu=:m_ghichu,loai=:m_loai where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_songay",OracleType.Number).Value=m_songay;
				cmd.Parameters.Add("m_ghichu",OracleType.NVarChar,254).Value=m_ghichu;
				cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into le_hen (id,songay,ghichu,loai) values (:m_id,:m_songay,:m_ghichu,:m_loai)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_songay",OracleType.Number).Value=m_songay;
					cmd.Parameters.Add("m_ghichu",OracleType.NVarChar,254).Value=m_ghichu;
					cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim(),sComputer,"le_hen");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public long get_id_le(string m_mabn,string m_ngaygio,bool gio)
		{
			sql="select id from le_thuchien where mabn='"+m_mabn+"'";
			if (gio) sql+=" and to_char(ngay,'dd/mm/yyyy hh24:mi')='"+m_ngaygio+"'";
			else sql+=" and to_char(ngay,'dd/mm/yyyy')='"+m_ngaygio.Substring(0,10)+"'";
			ds=get_data(sql);
			long l_id=(ds.Tables[0].Rows.Count==0)?0:long.Parse(ds.Tables[0].Rows[0][0].ToString());
			return l_id;
		}

		public long get_id_le(string m_mabn,string m_makp,string m_ngaygio)
		{
			ds=get_data("select id from le_thuchien where mabn='"+m_mabn+"' and makp='"+m_makp+"'"+" and to_char(ngay,'dd/mm/yyyy hh24:mi')='"+m_ngaygio+"'");
			long l_id=(ds.Tables[0].Rows.Count==0)?0:long.Parse(ds.Tables[0].Rows[0][0].ToString());
			if (l_id==0) l_id=getidyymmddhhmiss_stt_computer;//get_capid(-7);
			return l_id;
		}

		public bool upd_kx_thoiquen(string m_mabn,string m_thoiquen)
		{
			sql="update kx_thoiquen set thoiquen=:m_thoiquen where mabn=:m_mabn";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_thoiquen",OracleType.NVarChar,254).Value=m_thoiquen;
				cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into kx_thoiquen (mabn,thoiquen) values (:m_mabn,:m_thoiquen)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
					cmd.Parameters.Add("m_thoiquen",OracleType.NVarChar,254).Value=m_thoiquen;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim(),sComputer,"kx_thoiquen");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_kx_hen(long m_id,int m_songay,string m_ghichu,int m_loai)
		{
			sql="update kx_hen set songay=:m_songay,ghichu=:m_ghichu,loai=:m_loai where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_songay",OracleType.Number).Value=m_songay;
				cmd.Parameters.Add("m_ghichu",OracleType.NVarChar,254).Value=m_ghichu;
				cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into kx_hen (id,songay,ghichu,loai) values (:m_id,:m_songay,:m_ghichu,:m_loai)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_songay",OracleType.Number).Value=m_songay;
					cmd.Parameters.Add("m_ghichu",OracleType.NVarChar,254).Value=m_ghichu;
					cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim(),sComputer,"kx_hen");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_kx_dieutri(long m_id,string m_mabn,long m_maql,string m_ngay,
			int m_loaibn,int m_kham,int m_madoituong,string m_tlxkk_mp,string m_tlxkk_mt,string m_tlkl_mp,
			string m_tlkl_mt,string m_tlg_mp,string m_tlg_mt,string m_dttb_xa,string m_dttb_gan,string m_dtxtm_mp,
			string m_dtxtm_mt,string m_dtgtm_mp,string m_dtgtm_mt,string m_kql1_mp,string m_kql1_mt,string m_kqtll1_mp,string m_kqtll1_mt,
			string m_cql1_mp,string m_cql1_mt,string m_cqtll1_mp,string m_cqtll1_mt,int m_chidinh,
			string m_kql2_mp,string m_kql2_mt,string m_kqtll2_mp,string m_kqtll2_mt,string m_cql2_mp,
			string m_cql2_mt,string m_cqtll2_mp,string m_cqtll2_mt,string m_ct_mp,string m_ct_mt,
			string m_cttl_mp,string m_cttl_mt,string m_dc_mp,string m_dc_mt,string m_dctl_mp,string m_dctl_mt,
			string m_kc_mp,string m_kc_mt,string m_ctk_mp,string m_ctk_mt,int m_xutri,string m_capdon,
			string m_chuyen,string m_loidan,string m_khac,string m_ktv,string m_maicd,string m_chandoan,
			string m_maicdk,string m_chandoank,int m_userid)
		{
			sql="update kx_dieutri set mabn=:m_mabn,maql=:m_maql,ngay=:m_ngay,";
			sql+="loaibn=:m_loaibn,kham=:m_kham,madoituong=:m_madoituong,";
			sql+="tlxkk_mp=:m_tlxkk_mp,tlxkk_mt=:m_tlxkk_mt,tlkl_mp=:m_tlkl_mp,tlkl_mt=:m_tlkl_mt,";
			sql+="tlg_mp=:m_tlg_mp,tlg_mt=:m_tlg_mt,dttb_xa=:m_dttb_xa,dttb_gan=:m_dttb_gan,";
			sql+="dtxtm_mp=:m_dtxtm_mp,dtxtm_mt=:m_dtxtm_mt,dtgtm_mp=:m_dtgtm_mp,dtgtm_mt=:m_dtgtm_mt,kql1_mp=:m_kql1_mp,kql1_mt=:m_kql1_mt,";
			sql+="kqtll1_mp=:m_kqtll1_mp,kqtll1_mt=:m_kqtll1_mt,cql1_mp=:m_cql1_mp,cql1_mt=:m_cql1_mt,";
			sql+="cqtll1_mp=:m_cqtll1_mp,cqtll1_mt=:m_cqtll1_mt,chidinh=:m_chidinh,kql2_mp=:m_kql2_mp,kql2_mt=:m_kql2_mt,";
			sql+="kqtll2_mp=:m_kqtll2_mp,kqtll2_mt=:m_kqtll2_mt,cql2_mp=:m_cql2_mp,cql2_mt=:m_cql2_mt,cqtll2_mp=:m_cqtll2_mp,cqtll2_mt=:m_cqtll2_mt,";
			sql+="ct_mp=:m_ct_mp,ct_mt=:m_ct_mt,cttl_mp=:m_cttl_mp,cttl_mt=:m_cttl_mt,dc_mp=:m_dc_mp,dc_mt=:m_dc_mt,";
			sql+="dctl_mp=:m_dctl_mp,dctl_mt=:m_dctl_mt,kc_mp=:m_kc_mp,kc_mt=:m_kc_mt,ctk_mp=:m_ctk_mp,ctk_mt=:m_ctk_mt,";
			sql+="xutri=:m_xutri,capdon=:m_capdon,chuyen=:m_chuyen,loidan=:m_loidan,khac=:m_khac,ktv=:m_ktv,";
			sql+="maicd=:m_maicd,chandoan=:m_chandoan,maicdk=:m_maicdk,chandoank=:m_chandoank,";
			sql+="userid=:m_userid where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_loaibn",OracleType.Number).Value=m_loaibn;
				cmd.Parameters.Add("m_kham",OracleType.Number).Value=m_kham;
				cmd.Parameters.Add("m_madoituong",OracleType.Number).Value=m_madoituong;
				cmd.Parameters.Add("m_tlxkk_mp",OracleType.VarChar,10).Value=m_tlxkk_mp;
				cmd.Parameters.Add("m_tlxkk_mt",OracleType.VarChar,10).Value=m_tlxkk_mt;
				cmd.Parameters.Add("m_tlkl_mp",OracleType.VarChar,10).Value=m_tlkl_mp;
				cmd.Parameters.Add("m_tlkl_mt",OracleType.VarChar,10).Value=m_tlkl_mt;
				cmd.Parameters.Add("m_tlg_mp",OracleType.VarChar,10).Value=m_tlg_mp;
				cmd.Parameters.Add("m_tlg_mt",OracleType.VarChar,10).Value=m_tlg_mt;
				cmd.Parameters.Add("m_dttb_xa",OracleType.VarChar,10).Value=m_dttb_xa;
				cmd.Parameters.Add("m_dttb_gan",OracleType.VarChar,10).Value=m_dttb_gan;
				cmd.Parameters.Add("m_dtxtm_mp",OracleType.VarChar,10).Value=m_dtxtm_mp;
				cmd.Parameters.Add("m_dtxtm_mt",OracleType.VarChar,10).Value=m_dtxtm_mt;
				cmd.Parameters.Add("m_dtgtm_mp",OracleType.VarChar,10).Value=m_dtgtm_mp;
				cmd.Parameters.Add("m_dtgtm_mt",OracleType.VarChar,10).Value=m_dtgtm_mt;
				cmd.Parameters.Add("m_kql1_mp",OracleType.NVarChar,100).Value=m_kql1_mp;
				cmd.Parameters.Add("m_kql1_mt",OracleType.NVarChar,100).Value=m_kql1_mt;
				cmd.Parameters.Add("m_kqtll1_mp",OracleType.VarChar,10).Value=m_kqtll1_mp;
				cmd.Parameters.Add("m_kqtll1_mt",OracleType.VarChar,10).Value=m_kqtll1_mt;
				cmd.Parameters.Add("m_cql1_mp",OracleType.NVarChar,100).Value=m_cql1_mp;
				cmd.Parameters.Add("m_cql1_mt",OracleType.NVarChar,100).Value=m_cql1_mt;
				cmd.Parameters.Add("m_cqtll1_mp",OracleType.VarChar,10).Value=m_cqtll1_mp;
				cmd.Parameters.Add("m_cqtll1_mt",OracleType.VarChar,10).Value=m_cqtll1_mt;
				cmd.Parameters.Add("m_chidinh",OracleType.Number).Value=m_chidinh;
				cmd.Parameters.Add("m_kql2_mp",OracleType.NVarChar,100).Value=m_kql2_mp;
				cmd.Parameters.Add("m_kql2_mt",OracleType.NVarChar,100).Value=m_kql2_mt;
				cmd.Parameters.Add("m_kqtll2_mp",OracleType.VarChar,10).Value=m_kqtll2_mp;
				cmd.Parameters.Add("m_kqtll2_mt",OracleType.VarChar,10).Value=m_kqtll2_mt;
				cmd.Parameters.Add("m_cql2_mp",OracleType.NVarChar,100).Value=m_cql2_mp;
				cmd.Parameters.Add("m_cql2_mt",OracleType.NVarChar,100).Value=m_cql2_mt;
				cmd.Parameters.Add("m_cqtll2_mp",OracleType.VarChar,10).Value=m_cqtll2_mp;
				cmd.Parameters.Add("m_cqtll2_mt",OracleType.VarChar,10).Value=m_cqtll2_mt;
				cmd.Parameters.Add("m_ct_mp",OracleType.NVarChar,100).Value=m_ct_mp;
				cmd.Parameters.Add("m_ct_mt",OracleType.NVarChar,100).Value=m_ct_mt;
				cmd.Parameters.Add("m_cttl_mp",OracleType.VarChar,10).Value=m_cttl_mp;
				cmd.Parameters.Add("m_cttl_mt",OracleType.VarChar,10).Value=m_cttl_mt;
				cmd.Parameters.Add("m_dc_mp",OracleType.NVarChar,100).Value=m_dc_mp;
				cmd.Parameters.Add("m_dc_mt",OracleType.NVarChar,100).Value=m_dc_mt;
				cmd.Parameters.Add("m_dctl_mp",OracleType.VarChar,10).Value=m_dctl_mp;
				cmd.Parameters.Add("m_dctl_mt",OracleType.VarChar,10).Value=m_dctl_mt;
				cmd.Parameters.Add("m_kc_mp",OracleType.VarChar,10).Value=m_kc_mp;
				cmd.Parameters.Add("m_kc_mt",OracleType.VarChar,10).Value=m_kc_mt;
				cmd.Parameters.Add("m_ctk_mp",OracleType.NVarChar,100).Value=m_ctk_mp;
				cmd.Parameters.Add("m_ctk_mt",OracleType.NVarChar,100).Value=m_ctk_mt;
				cmd.Parameters.Add("m_xutri",OracleType.Number).Value=m_xutri;
				cmd.Parameters.Add("m_capdon",OracleType.NVarChar,100).Value=m_capdon;
				cmd.Parameters.Add("m_chuyen",OracleType.NVarChar,100).Value=m_chuyen;
				cmd.Parameters.Add("m_loidan",OracleType.NVarChar,100).Value=m_loidan;
				cmd.Parameters.Add("m_khac",OracleType.NVarChar,100).Value=m_khac;
				cmd.Parameters.Add("m_ktv",OracleType.VarChar,4).Value=m_ktv;
				cmd.Parameters.Add("m_maicd",OracleType.VarChar,9).Value=m_maicd;
				cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,254).Value=m_chandoan;
				cmd.Parameters.Add("m_maicdk",OracleType.VarChar,9).Value=m_maicdk;
				cmd.Parameters.Add("m_chandoank",OracleType.NVarChar,254).Value=m_chandoank;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into kx_dieutri (id,mabn,maql,ngay,loaibn,kham,madoituong,tlxkk_mp,tlxkk_mt,tlkl_mp,tlkl_mt,tlg_mp,tlg_mt,";
					sql+="dttb_xa,dttb_gan,dtxtm_mp,dtxtm_mt,dtgtm_mp,dtgtm_mt,kql1_mp,kql1_mt,kqtll1_mp,kqtll1_mt,cql1_mp,cql1_mt,cqtll1_mp,cqtll1_mt,chidinh,";
					sql+="kql2_mp,kql2_mt,kqtll2_mp,kqtll2_mt,cql2_mp,cql2_mt,cqtll2_mp,cqtll2_mt,ct_mp,ct_mt,cttl_mp,cttl_mt,dc_mp,dc_mt,";
					sql+="dctl_mp,dctl_mt,kc_mp,kc_mt,ctk_mp,ctk_mt,xutri,capdon,chuyen,loidan,khac,ktv,maicd,chandoan,maicdk,chandoank,userid)";
					sql+=" values ";
					sql+=" (:m_id,:m_mabn,:m_maql,:m_ngay,:m_loaibn,:m_kham,:m_madoituong,:m_tlxkk_mp,:m_tlxkk_mt,:m_tlkl_mp,:m_tlkl_mt,:m_tlg_mp,:m_tlg_mt,";
					sql+=":m_dttb_xa,:m_dttb_gan,:m_dtxtm_mp,:m_dtxtm_mt,:m_dtgtm_mp,:m_dtgtm_mt,:m_kql1_mp,:m_kql1_mt,:m_kqtll1_mp,:m_kqtll1_mt,:m_cql1_mp,:m_cql1_mt,:m_cqtll1_mp,:m_cqtll1_mt,:m_chidinh,";
					sql+=":m_kql2_mp,:m_kql2_mt,:m_kqtll2_mp,:m_kqtll2_mt,:m_cql2_mp,:m_cql2_mt,:m_cqtll2_mp,:m_cqtll2_mt,:m_ct_mp,:m_ct_mt,:m_cttl_mp,:m_cttl_mt,:m_dc_mp,:m_dc_mt,";
					sql+=":m_dctl_mp,:m_dctl_mt,:m_kc_mp,:m_kc_mt,:m_ctk_mp,:m_ctk_mt,:m_xutri,:m_capdon,:m_chuyen,:m_loidan,:m_khac,:m_ktv,:m_maicd,:m_chandoan,:m_maicdk,:m_chandoank,:m_userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_loaibn",OracleType.Number).Value=m_loaibn;
					cmd.Parameters.Add("m_kham",OracleType.Number).Value=m_kham;
					cmd.Parameters.Add("m_madoituong",OracleType.Number).Value=m_madoituong;
					cmd.Parameters.Add("m_tlxkk_mp",OracleType.VarChar,10).Value=m_tlxkk_mp;
					cmd.Parameters.Add("m_tlxkk_mt",OracleType.VarChar,10).Value=m_tlxkk_mt;
					cmd.Parameters.Add("m_tlkl_mp",OracleType.VarChar,10).Value=m_tlkl_mp;
					cmd.Parameters.Add("m_tlkl_mt",OracleType.VarChar,10).Value=m_tlkl_mt;
					cmd.Parameters.Add("m_tlg_mp",OracleType.VarChar,10).Value=m_tlg_mp;
					cmd.Parameters.Add("m_tlg_mt",OracleType.VarChar,10).Value=m_tlg_mt;
					cmd.Parameters.Add("m_dttb_xa",OracleType.VarChar,10).Value=m_dttb_xa;
					cmd.Parameters.Add("m_dttb_gan",OracleType.VarChar,10).Value=m_dttb_gan;
					cmd.Parameters.Add("m_dtxtm_mp",OracleType.VarChar,10).Value=m_dtxtm_mp;
					cmd.Parameters.Add("m_dtxtm_mt",OracleType.VarChar,10).Value=m_dtxtm_mt;
					cmd.Parameters.Add("m_dtgtm_mp",OracleType.VarChar,10).Value=m_dtgtm_mp;
					cmd.Parameters.Add("m_dtgtm_mt",OracleType.VarChar,10).Value=m_dtgtm_mt;
					cmd.Parameters.Add("m_kql1_mp",OracleType.NVarChar,100).Value=m_kql1_mp;
					cmd.Parameters.Add("m_kql1_mt",OracleType.NVarChar,100).Value=m_kql1_mt;
					cmd.Parameters.Add("m_kqtll1_mp",OracleType.VarChar,10).Value=m_kqtll1_mp;
					cmd.Parameters.Add("m_kqtll1_mt",OracleType.VarChar,10).Value=m_kqtll1_mt;
					cmd.Parameters.Add("m_cql1_mp",OracleType.NVarChar,100).Value=m_cql1_mp;
					cmd.Parameters.Add("m_cql1_mt",OracleType.NVarChar,100).Value=m_cql1_mt;
					cmd.Parameters.Add("m_cqtll1_mp",OracleType.VarChar,10).Value=m_cqtll1_mp;
					cmd.Parameters.Add("m_cqtll1_mt",OracleType.VarChar,10).Value=m_cqtll1_mt;
					cmd.Parameters.Add("m_chidinh",OracleType.Number).Value=m_chidinh;
					cmd.Parameters.Add("m_kql2_mp",OracleType.NVarChar,100).Value=m_kql2_mp;
					cmd.Parameters.Add("m_kql2_mt",OracleType.NVarChar,100).Value=m_kql2_mt;
					cmd.Parameters.Add("m_kqtll2_mp",OracleType.VarChar,10).Value=m_kqtll2_mp;
					cmd.Parameters.Add("m_kqtll2_mt",OracleType.VarChar,10).Value=m_kqtll2_mt;
					cmd.Parameters.Add("m_cql2_mp",OracleType.NVarChar,100).Value=m_cql2_mp;
					cmd.Parameters.Add("m_cql2_mt",OracleType.NVarChar,100).Value=m_cql2_mt;
					cmd.Parameters.Add("m_cqtll2_mp",OracleType.VarChar,10).Value=m_cqtll2_mp;
					cmd.Parameters.Add("m_cqtll2_mt",OracleType.VarChar,10).Value=m_cqtll2_mt;
					cmd.Parameters.Add("m_ct_mp",OracleType.NVarChar,100).Value=m_ct_mp;
					cmd.Parameters.Add("m_ct_mt",OracleType.NVarChar,100).Value=m_ct_mt;
					cmd.Parameters.Add("m_cttl_mp",OracleType.VarChar,10).Value=m_cttl_mp;
					cmd.Parameters.Add("m_cttl_mt",OracleType.VarChar,10).Value=m_cttl_mt;
					cmd.Parameters.Add("m_dc_mp",OracleType.NVarChar,100).Value=m_dc_mp;
					cmd.Parameters.Add("m_dc_mt",OracleType.NVarChar,100).Value=m_dc_mt;
					cmd.Parameters.Add("m_dctl_mp",OracleType.VarChar,10).Value=m_dctl_mp;
					cmd.Parameters.Add("m_dctl_mt",OracleType.VarChar,10).Value=m_dctl_mt;
					cmd.Parameters.Add("m_kc_mp",OracleType.VarChar,10).Value=m_kc_mp;
					cmd.Parameters.Add("m_kc_mt",OracleType.VarChar,10).Value=m_kc_mt;
					cmd.Parameters.Add("m_ctk_mp",OracleType.NVarChar,100).Value=m_ctk_mp;
					cmd.Parameters.Add("m_ctk_mt",OracleType.NVarChar,100).Value=m_ctk_mt;
					cmd.Parameters.Add("m_xutri",OracleType.Number).Value=m_xutri;
					cmd.Parameters.Add("m_capdon",OracleType.NVarChar,100).Value=m_capdon;
					cmd.Parameters.Add("m_chuyen",OracleType.NVarChar,100).Value=m_chuyen;
					cmd.Parameters.Add("m_loidan",OracleType.NVarChar,100).Value=m_loidan;
					cmd.Parameters.Add("m_khac",OracleType.NVarChar,100).Value=m_khac;
					cmd.Parameters.Add("m_ktv",OracleType.VarChar,4).Value=m_ktv;
					cmd.Parameters.Add("m_maicd",OracleType.VarChar,9).Value=m_maicd;
					cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,254).Value=m_chandoan;
					cmd.Parameters.Add("m_maicdk",OracleType.VarChar,9).Value=m_maicdk;
					cmd.Parameters.Add("m_chandoank",OracleType.NVarChar,254).Value=m_chandoank;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim(),sComputer,"kx_dieutri");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}
		public long get_id_kx(string m_mabn,string m_ngaygio,bool gio)
		{
			sql="select id from kx_dieutri where mabn='"+m_mabn+"'";
			if (gio) sql+=" and to_char(ngay,'dd/mm/yyyy hh24:mi')='"+m_ngaygio+"'";
			else sql+=" and to_char(ngay,'dd/mm/yyyy')='"+m_ngaygio.Substring(0,10)+"'";
			ds=get_data(sql);
			long l_id=(ds.Tables[0].Rows.Count==0)?0:long.Parse(ds.Tables[0].Rows[0][0].ToString());
			return l_id;
		}

		public long get_id_kx(string m_mabn,string m_ngaygio)
		{
			ds=get_data("select id from kx_dieutri where mabn='"+m_mabn+"' and to_char(ngay,'dd/mm/yyyy hh24:mi')='"+m_ngaygio+"'");
			long l_id=(ds.Tables[0].Rows.Count==0)?0:long.Parse(ds.Tables[0].Rows[0][0].ToString());
			if (l_id==0) l_id=getidyymmddhhmiss_stt_computer;//get_capid(-11);
			return l_id;
		}

		public bool upd_hen(long m_maql,decimal m_songay,string m_ghichu,int m_loai)
		{
			sql="update hen set songay=:m_songay,ghichu=:m_ghichu,loai=:m_loai where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_songay",OracleType.Number).Value=m_songay;
				cmd.Parameters.Add("m_ghichu",OracleType.NVarChar,254).Value=m_ghichu;
				cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;				
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into hen (maql,songay,ghichu,loai) values (:m_maql,:m_songay,:m_ghichu,:m_loai)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_songay",OracleType.Number).Value=m_songay;
					cmd.Parameters.Add("m_ghichu",OracleType.NVarChar,254).Value=m_ghichu;
					cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim(),sComputer,"hen");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public void upd_suahuy(string table,string tables,long id,int ma,decimal soluong,int userid)
		{
			sql="select * from "+table+" where tables='"+tables+"' and id="+id+" and ma="+ma+" and soluong="+soluong;
			sql+=" and computer='"+sComputer+"' and userid="+userid;
			if (get_data(sql).Tables[0].Rows.Count==0)
			{
				sql="insert into "+table+"(tables,id,ma,soluong,computer,userid) values ('"+tables+"',"+id+","+ma+","+soluong+",'"+sComputer+"',"+userid+")";
				execute_data(sql);
			}
		}

		public bool upd_khoacdkham(string m_mabn,long m_maql,string m_makp,string m_ngay,int m_userid)
		{
			sql="update khoacdkham set makp=:m_makp,ngay=:m_ngay,userid=:m_userid where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;	
				cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into khoacdkham (mabn,maql,makp,ngay,userid) values (:m_mabn,:m_maql,:m_makp,:m_ngay,:m_userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim(),sComputer,"khoacdkham");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_bhyt(string m_ngay,string m_mabn,long m_maql,string m_sothe,string m_denngay,string m_mabv)
		{
			string xxx=user+mmyy(m_ngay);
			int m_maphu=0;//d.get_maphu(m_sothe);
			sql="update "+xxx+".bhyt set sothe=:m_sothe,";
			if (m_denngay!="") sql+="denngay=:m_denngay,";
			sql+="mabv=:m_mabv,maphu=:m_maphu where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_sothe",OracleType.VarChar,20).Value=m_sothe;
				if (m_denngay!="") cmd.Parameters.Add("m_denngay",OracleType.DateTime).Value=StringToDateTime(m_denngay);
				cmd.Parameters.Add("m_mabv",OracleType.VarChar,8).Value=m_mabv;
				cmd.Parameters.Add("m_maphu",OracleType.Number).Value=m_maphu;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					if (m_denngay!="")
						sql="insert into "+xxx+".bhyt(mabn,maql,sothe,denngay,mabv,maphu) values (:m_mabn,:m_maql,:m_sothe,:m_denngay,:m_mabv,:m_maphu)";
					else
						sql="insert into "+xxx+".bhyt(mabn,maql,sothe,mabv,maphu) values (:m_mabn,:m_maql,:m_sothe,:m_mabv,:m_maphu)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_sothe",OracleType.VarChar,20).Value=m_sothe;
					if (m_denngay!="") cmd.Parameters.Add("m_denngay",OracleType.DateTime).Value=StringToDateTime(m_denngay);
					cmd.Parameters.Add("m_mabv",OracleType.VarChar,8).Value=m_mabv;
					cmd.Parameters.Add("m_maphu",OracleType.Number).Value=m_maphu;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"Bhyt "+m_mabn);
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_bhyt(string m_ngay,string m_mabn,long m_maql,string m_sothe,string m_denngay,string m_mabv,int m_maphu)
		{
			string xxx=user+mmyy(m_ngay);
			sql="update "+xxx+".bhyt set sothe=:m_sothe,";
			if (m_denngay!="") sql+="denngay=:m_denngay,";
			sql+="mabv=:m_mabv,maphu=:m_maphu where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_sothe",OracleType.VarChar,20).Value=m_sothe;
				if (m_denngay!="") cmd.Parameters.Add("m_denngay",OracleType.DateTime).Value=StringToDateTime(m_denngay);
				cmd.Parameters.Add("m_mabv",OracleType.VarChar,8).Value=m_mabv;
				cmd.Parameters.Add("m_maphu",OracleType.Number).Value=m_maphu;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					if (m_denngay!="")
						sql="insert into "+xxx+".bhyt(mabn,maql,sothe,denngay,mabv,maphu) values (:m_mabn,:m_maql,:m_sothe,:m_denngay,:m_mabv,:m_maphu)";
					else
						sql="insert into "+xxx+".bhyt(mabn,maql,sothe,mabv,maphu) values (:m_mabn,:m_maql,:m_sothe,:m_mabv,:m_maphu)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_sothe",OracleType.VarChar,20).Value=m_sothe;
					if (m_denngay!="") cmd.Parameters.Add("m_denngay",OracleType.DateTime).Value=StringToDateTime(m_denngay);
					cmd.Parameters.Add("m_mabv",OracleType.VarChar,8).Value=m_mabv;
					cmd.Parameters.Add("m_maphu",OracleType.Number).Value=m_maphu;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"Bhyt "+m_mabn);
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_bhyt(string m_ngay,string m_mabn,long m_maql,string m_sothe,string m_denngay,string m_mabv,int m_maphu, int m_traituyen)
		{
			string xxx=user+mmyy(m_ngay);
			sql="update "+xxx+".bhyt set sothe=:m_sothe,";
			if (m_denngay!="") sql+="denngay=:m_denngay,";
			sql+="mabv=:m_mabv,maphu=:m_maphu, traituyen=:m_traituyen where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_sothe",OracleType.VarChar,20).Value=m_sothe;
				if (m_denngay!="") cmd.Parameters.Add("m_denngay",OracleType.DateTime).Value=StringToDateTime(m_denngay);
				cmd.Parameters.Add("m_mabv",OracleType.VarChar,8).Value=m_mabv;
				cmd.Parameters.Add("m_maphu",OracleType.Number).Value=m_maphu;
				cmd.Parameters.Add("m_traituyen",OracleType.Number).Value=m_traituyen;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					if (m_denngay!="")
						sql="insert into "+xxx+".bhyt(mabn,maql,sothe,denngay,mabv,maphu,traituyen) values (:m_mabn,:m_maql,:m_sothe,:m_denngay,:m_mabv,:m_maphu,:m_traituyen)";
					else
						sql="insert into "+xxx+".bhyt(mabn,maql,sothe,mabv,maphu,traituyen) values (:m_mabn,:m_maql,:m_sothe,:m_mabv,:m_maphu,:m_traituyen)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_sothe",OracleType.VarChar,20).Value=m_sothe;
					if (m_denngay!="") cmd.Parameters.Add("m_denngay",OracleType.DateTime).Value=StringToDateTime(m_denngay);
					cmd.Parameters.Add("m_mabv",OracleType.VarChar,8).Value=m_mabv;
					cmd.Parameters.Add("m_maphu",OracleType.Number).Value=m_maphu;
					cmd.Parameters.Add("m_traituyen",OracleType.Number).Value=m_traituyen;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"Bhyt "+m_mabn);
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}
		public bool upd_bhyt_(string m_ngay,string m_mabn,long m_maql,string m_sothe,string m_denngay,string m_mabv,int m_maphu, int m_traituyen, string m_thecu)
		{
			string xxx=user+mmyy(m_ngay);
			sql="update "+xxx+".bhyt set sothe=:m_sothe,";
			if (m_denngay!="") sql+="denngay=:m_denngay,";
			sql+="mabv=:m_mabv,maphu=:m_maphu, traituyen=:m_traituyen where maql=:m_maql";
			if(m_thecu!="")sql+=" and sothe='"+m_thecu+"'";

			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_sothe",OracleType.VarChar,20).Value=m_sothe;
				if (m_denngay!="") cmd.Parameters.Add("m_denngay",OracleType.DateTime).Value=StringToDateTime(m_denngay);
				cmd.Parameters.Add("m_mabv",OracleType.VarChar,8).Value=m_mabv;
				cmd.Parameters.Add("m_maphu",OracleType.Number).Value=m_maphu;
				cmd.Parameters.Add("m_traituyen",OracleType.Number).Value=m_traituyen;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					if (m_denngay!="")
						sql="insert into "+xxx+".bhyt(mabn,maql,sothe,denngay,mabv,maphu,traituyen) values (:m_mabn,:m_maql,:m_sothe,:m_denngay,:m_mabv,:m_maphu,:m_traituyen)";
					else
						sql="insert into "+xxx+".bhyt(mabn,maql,sothe,mabv,maphu,traituyen) values (:m_mabn,:m_maql,:m_sothe,:m_mabv,:m_maphu,:m_traituyen)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_sothe",OracleType.VarChar,20).Value=m_sothe;
					if (m_denngay!="") cmd.Parameters.Add("m_denngay",OracleType.DateTime).Value=StringToDateTime(m_denngay);
					cmd.Parameters.Add("m_mabv",OracleType.VarChar,8).Value=m_mabv;
					cmd.Parameters.Add("m_maphu",OracleType.Number).Value=m_maphu;
					cmd.Parameters.Add("m_traituyen",OracleType.Number).Value=m_traituyen;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"Bhyt "+m_mabn);
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}
		public bool upd_bhyt(string m_ngay,string m_mabn,long m_maql,string m_sothe,string m_denngay,string m_mabv,
			int m_maphu,string m_tungay,int traituyen)
		{
			string xxx=user+mmyy(m_ngay);
			sql="update "+xxx+".bhyt set sothe=:m_sothe";
			if (m_denngay!="") sql+=",denngay=:m_denngay";
			sql+=",mabv=:m_mabv,maphu=:m_maphu";
			if (m_tungay!="") sql+=",tungay=:m_tungay";
			sql+=",traituyen="+traituyen;
			sql+=" where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_sothe",OracleType.VarChar,20).Value=m_sothe;
				if (m_denngay!="") cmd.Parameters.Add("m_denngay",OracleType.DateTime).Value=StringToDateTime(m_denngay);
				cmd.Parameters.Add("m_mabv",OracleType.VarChar,8).Value=m_mabv;
				cmd.Parameters.Add("m_maphu",OracleType.Number).Value=m_maphu;
				if (m_tungay!="") cmd.Parameters.Add("m_tungay",OracleType.DateTime).Value=StringToDateTime(m_tungay);
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".bhyt(mabn,maql,sothe";
					if (m_denngay!="") sql+=",denngay";
					sql+=",mabv,maphu";
					if (m_tungay!="") sql+=",tungay";
					sql+=",traituyen) values (:m_mabn,:m_maql,:m_sothe";
					if (m_denngay!="") sql+=",:m_denngay";
					sql+=",:m_mabv,:m_maphu";
					if (m_tungay!="")  sql+=",:m_tungay";
					sql+=","+traituyen+")";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_sothe",OracleType.VarChar,20).Value=m_sothe;
					if (m_denngay!="") cmd.Parameters.Add("m_denngay",OracleType.DateTime).Value=StringToDateTime(m_denngay);
					cmd.Parameters.Add("m_mabv",OracleType.VarChar,8).Value=m_mabv;
					cmd.Parameters.Add("m_maphu",OracleType.Number).Value=m_maphu;
					if (m_tungay!="") cmd.Parameters.Add("m_tungay",OracleType.DateTime).Value=StringToDateTime(m_tungay);
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"Bhyt "+m_mabn);
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_bhyt_(string m_ngay,string m_mabn,long m_maql,string m_sothe,string m_denngay,string m_mabv,
			int m_maphu,string m_tungay,int traituyen, string m_thecu)
		{
			string xxx=user+mmyy(m_ngay);
			sql="update "+xxx+".bhyt set sothe=:m_sothe";
			if (m_denngay!="") sql+=",denngay=:m_denngay";
			sql+=",mabv=:m_mabv,maphu=:m_maphu";
			if (m_tungay!="") sql+=",tungay=:m_tungay";
			sql+=",traituyen="+traituyen;
			sql+=" where maql=:m_maql";
			if(m_thecu!="")sql+=" and sothe='"+m_thecu+"'";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_sothe",OracleType.VarChar,20).Value=m_sothe;
				if (m_denngay!="") cmd.Parameters.Add("m_denngay",OracleType.DateTime).Value=StringToDateTime(m_denngay);
				cmd.Parameters.Add("m_mabv",OracleType.VarChar,8).Value=m_mabv;
				cmd.Parameters.Add("m_maphu",OracleType.Number).Value=m_maphu;
				if (m_tungay!="") cmd.Parameters.Add("m_tungay",OracleType.DateTime).Value=StringToDateTime(m_tungay);
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".bhyt(mabn,maql,sothe";
					if (m_denngay!="") sql+=",denngay";
					sql+=",mabv,maphu";
					if (m_tungay!="") sql+=",tungay";
					sql+=",traituyen) values (:m_mabn,:m_maql,:m_sothe";
					if (m_denngay!="") sql+=",:m_denngay";
					sql+=",:m_mabv,:m_maphu";
					if (m_tungay!="")  sql+=",:m_tungay";
					sql+=","+traituyen+")";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_sothe",OracleType.VarChar,20).Value=m_sothe;
					if (m_denngay!="") cmd.Parameters.Add("m_denngay",OracleType.DateTime).Value=StringToDateTime(m_denngay);
					cmd.Parameters.Add("m_mabv",OracleType.VarChar,8).Value=m_mabv;
					cmd.Parameters.Add("m_maphu",OracleType.Number).Value=m_maphu;
					if (m_tungay!="") cmd.Parameters.Add("m_tungay",OracleType.DateTime).Value=StringToDateTime(m_tungay);
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"Bhyt "+m_mabn);
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_lienhe(string m_ngay,long m_maql,string m_sonha,string m_thon,
			string m_cholam,string m_matt,string m_maqu,string m_maphuongxa,string m_tuoivao,int m_loai,int m_bnmoi)
		{
			string xxx=user+mmyy(m_ngay);
			sql="update "+xxx+".lienhe set sonha=:m_sonha,thon=:m_thon,cholam=:m_cholam,matt=:m_matt,maqu=:m_maqu,";
			sql+="maphuongxa=:m_maphuongxa,tuoivao=:m_tuoivao,loai=:m_loai,bnmoi=:m_bnmoi where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_sonha",OracleType.NVarChar,10).Value=m_sonha;
				cmd.Parameters.Add("m_thon",OracleType.NVarChar,150).Value=m_thon;
				cmd.Parameters.Add("m_cholam",OracleType.NVarChar,150).Value=m_cholam;
				cmd.Parameters.Add("m_matt",OracleType.VarChar,3).Value=m_matt;
				cmd.Parameters.Add("m_maqu",OracleType.VarChar,5).Value=m_maqu;
				cmd.Parameters.Add("m_maphuongxa",OracleType.VarChar,7).Value=m_maphuongxa;
				cmd.Parameters.Add("m_tuoivao",OracleType.VarChar,4).Value=m_tuoivao;
				cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
				cmd.Parameters.Add("m_bnmoi",OracleType.Number).Value=m_bnmoi;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".lienhe (maql,sonha,thon,cholam,matt,maqu,maphuongxa,tuoivao,loai,bnmoi)";
					sql+=" values (:m_maql,:m_sonha,:m_thon,:m_cholam,:m_matt,:m_maqu,:m_maphuongxa,:m_tuoivao,:m_loai,:m_bnmoi)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_sonha",OracleType.NVarChar,10).Value=m_sonha;
					cmd.Parameters.Add("m_thon",OracleType.NVarChar,150).Value=m_thon;
					cmd.Parameters.Add("m_cholam",OracleType.NVarChar,150).Value=m_cholam;
					cmd.Parameters.Add("m_matt",OracleType.VarChar,3).Value=m_matt;
					cmd.Parameters.Add("m_maqu",OracleType.VarChar,5).Value=m_maqu;
					cmd.Parameters.Add("m_maphuongxa",OracleType.VarChar,7).Value=m_maphuongxa;
					cmd.Parameters.Add("m_tuoivao",OracleType.VarChar,4).Value=m_tuoivao;
					cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
					cmd.Parameters.Add("m_bnmoi",OracleType.Number).Value=m_bnmoi;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"Lienhe");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		//ThanCuong 12/04/2012
		public bool upd_lienhe(string m_ngay,long m_maql,string m_sonha,string m_thon,
			string m_cholam,string m_matt,string m_maqu,string m_maphuongxa,string m_tuoivao,int m_loai,int m_bnmoi,string m_ghichu)
		{
			string xxx=user+mmyy(m_ngay);
			sql="update "+xxx+".lienhe set sonha=:m_sonha,thon=:m_thon,cholam=:m_cholam,matt=:m_matt,maqu=:m_maqu,";
			sql+="maphuongxa=:m_maphuongxa,tuoivao=:m_tuoivao,loai=:m_loai,bnmoi=:m_bnmoi,ghichu=:m_ghichu where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_sonha",OracleType.NVarChar,10).Value=m_sonha;
				cmd.Parameters.Add("m_thon",OracleType.NVarChar,150).Value=m_thon;
				cmd.Parameters.Add("m_cholam",OracleType.NVarChar,150).Value=m_cholam;
				cmd.Parameters.Add("m_matt",OracleType.VarChar,3).Value=m_matt;
				cmd.Parameters.Add("m_maqu",OracleType.VarChar,5).Value=m_maqu;
				cmd.Parameters.Add("m_maphuongxa",OracleType.VarChar,7).Value=m_maphuongxa;
				cmd.Parameters.Add("m_tuoivao",OracleType.VarChar,4).Value=m_tuoivao;
				cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
				cmd.Parameters.Add("m_bnmoi",OracleType.Number).Value=m_bnmoi;
				cmd.Parameters.Add("m_ghichu",OracleType.NVarChar,2000).Value=m_ghichu;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".lienhe (maql,sonha,thon,cholam,matt,maqu,maphuongxa,tuoivao,loai,bnmoi,ghichu)";
					sql+=" values (:m_maql,:m_sonha,:m_thon,:m_cholam,:m_matt,:m_maqu,:m_maphuongxa,:m_tuoivao,:m_loai,:m_bnmoi,:m_ghichu)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_sonha",OracleType.NVarChar,10).Value=m_sonha;
					cmd.Parameters.Add("m_thon",OracleType.NVarChar,150).Value=m_thon;
					cmd.Parameters.Add("m_cholam",OracleType.NVarChar,150).Value=m_cholam;
					cmd.Parameters.Add("m_matt",OracleType.VarChar,3).Value=m_matt;
					cmd.Parameters.Add("m_maqu",OracleType.VarChar,5).Value=m_maqu;
					cmd.Parameters.Add("m_maphuongxa",OracleType.VarChar,7).Value=m_maphuongxa;
					cmd.Parameters.Add("m_tuoivao",OracleType.VarChar,4).Value=m_tuoivao;
					cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
					cmd.Parameters.Add("m_bnmoi",OracleType.Number).Value=m_bnmoi;
					cmd.Parameters.Add("m_ghichu",OracleType.NVarChar,2000).Value=m_ghichu;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"Lienhe");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}
		//End ThanhCuong
		public bool upd_quanhe(string m_ngay,long m_maql,string m_quanhe,string m_hoten,string m_diachi,string m_dienthoai)
		{
			string xxx=user+mmyy(m_ngay);
			sql="update "+xxx+".quanhe set quanhe=:m_quanhe,hoten=:m_hoten,diachi=:m_diachi,dienthoai=:m_dienthoai";
			sql+=" where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
			
				cmd.Parameters.Add("m_quanhe",OracleType.NVarChar,20).Value=m_quanhe;
				cmd.Parameters.Add("m_hoten",OracleType.NVarChar,50).Value=m_hoten;
				cmd.Parameters.Add("m_diachi",OracleType.NVarChar,50).Value=m_diachi;
				cmd.Parameters.Add("m_dienthoai",OracleType.VarChar,20).Value=m_dienthoai;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".quanhe (maql,quanhe,hoten,diachi,dienthoai) values (:m_maql,:m_quanhe,:m_hoten,:m_diachi,:m_dienthoai)"; 
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_quanhe",OracleType.NVarChar,20).Value=m_quanhe;
					cmd.Parameters.Add("m_hoten",OracleType.NVarChar,50).Value=m_hoten;
					cmd.Parameters.Add("m_diachi",OracleType.NVarChar,50).Value=m_diachi;
					cmd.Parameters.Add("m_dienthoai",OracleType.VarChar,20).Value=m_dienthoai;
					cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"quanhe");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_sukien(string m_ngay,string m_mabn,long m_matiepdon,int m_noitiepdon,long m_macap)
		{
			string xxx=user+mmyy(m_ngay);
			sql="update "+xxx+".sukien set mabn=:m_mabn ";
			sql+="where matiepdon=:m_matiepdon and noitiepdon=:m_noitiepdon and macap=:m_macap";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
				cmd.Parameters.Add("m_matiepdon",OracleType.Number).Value=m_matiepdon;
				cmd.Parameters.Add("m_noitiepdon",OracleType.Number).Value=m_noitiepdon;
				cmd.Parameters.Add("m_macap",OracleType.Number).Value=m_macap;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".sukien(mabn,matiepdon,noitiepdon,macap) values ";
					sql+="(:m_mabn,:m_matiepdon,:m_noitiepdon,:m_macap)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
					cmd.Parameters.Add("m_matiepdon",OracleType.Number).Value=m_matiepdon;
					cmd.Parameters.Add("m_noitiepdon",OracleType.Number).Value=m_noitiepdon;
					cmd.Parameters.Add("m_macap",OracleType.Number).Value=m_macap;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"sukien");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_lydokham(string ngay,long m_maql,string m_lydo)
		{
			string xxx=user+mmyy(ngay);
			sql="update "+xxx+".lydokham set lydo=:m_lydo where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_lydo",OracleType.NVarChar,254).Value=m_lydo;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;

				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".lydokham(maql,lydo) values ";
					sql+="(:m_maql,:m_lydo)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_lydo",OracleType.NVarChar,254).Value=m_lydo;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"lydokham");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_lydokham(long m_maql,string m_lydo)
		{
			sql="update lydokham set lydo=:m_lydo where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_lydo",OracleType.NVarChar,254).Value=m_lydo;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;

				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into lydokham(maql,lydo) values ";
					sql+="(:m_maql,:m_lydo)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_lydo",OracleType.NVarChar,254).Value=m_lydo;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"lydokham");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public string get_lydokham(string ngay,long maql)
		{
			ds=get_data("select lydo from "+user+mmyy(ngay.Substring(0,10))+".lydokham where maql="+maql);
			if (ds.Tables[0].Rows.Count>0) return ds.Tables[0].Rows[0]["lydo"].ToString();
			else return "";
		}

		public int get_honnhan(string ngay,long maql)
		{
			ds=get_data("select honnhan from "+user+mmyy(ngay)+".lienhe where maql="+maql);
			if (ds.Tables[0].Rows.Count>0) return int.Parse(ds.Tables[0].Rows[0]["honnhan"].ToString());
			else return 0;
		}

		public string get_mabn_nam(string mabn)
		{
			ds = get_data("select nam from btdbn where mabn='" + mabn + "'");
			if (ds.Tables[0].Rows.Count > 0) return ds.Tables[0].Rows[0]["nam"].ToString().Trim();
			else return "";
		}

		public bool upd_dausinhton(string m_ngay,long m_maql,decimal m_mach,decimal m_nhietdo,string m_huyetap,decimal m_cannang,decimal m_chieucao)
		{
			string xxx=user+mmyy(m_ngay);
			sql="update "+xxx+".dausinhton set mach=:m_mach,nhietdo=:m_nhietdo,huyetap=:m_huyetap,cannang=:m_cannang,chieucao=:m_chieucao";
			sql+=" where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_mach",OracleType.Number).Value=m_mach;
				cmd.Parameters.Add("m_nhietdo",OracleType.Number).Value=m_nhietdo;
				cmd.Parameters.Add("m_huyetap",OracleType.VarChar,7).Value=m_huyetap;
				cmd.Parameters.Add("m_cannang",OracleType.Number).Value=m_cannang;
				cmd.Parameters.Add("m_chieucao",OracleType.Number).Value=m_chieucao;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".dausinhton (maql,mach,nhietdo,huyetap,cannang,chieucao)";
					sql+=" values (:m_maql,:m_mach,:m_nhietdo,:m_huyetap,:m_cannang,:m_chieucao)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_mach",OracleType.Number).Value=m_mach;
					cmd.Parameters.Add("m_nhietdo",OracleType.Number).Value=m_nhietdo;
					cmd.Parameters.Add("m_huyetap",OracleType.VarChar,7).Value=m_huyetap;
					cmd.Parameters.Add("m_cannang",OracleType.Number).Value=m_cannang;
					cmd.Parameters.Add("m_chieucao",OracleType.Number).Value=m_chieucao;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"dausinhton");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ttkhamthai(string m_ngay,string m_mabn,long m_maql,string m_para,string m_kinhcc,string m_ngaysanh,string m_dacdiem)
		{
			string xxx=user+mmyy(m_ngay);
			sql="update "+xxx+".ttkhamthai set para=:m_para";
			if (m_kinhcc!="") sql+=",kinhcc=:m_kinhcc,";
			if (m_ngaysanh!="") sql+="ngaysanh=:m_ngaysanh";
			sql+=",dacdiem=:m_dacdiem where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_para",OracleType.VarChar,8).Value=m_para;
				if (m_kinhcc!="") cmd.Parameters.Add("m_kinhcc",OracleType.DateTime).Value=StringToDateTime(m_kinhcc);
				if (m_ngaysanh!="")	cmd.Parameters.Add("m_ngaysanh",OracleType.DateTime).Value=StringToDateTime(m_ngaysanh);
				cmd.Parameters.Add("m_dacdiem",OracleType.NVarChar,254).Value=m_dacdiem;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ttkhamthai(mabn,maql,para,";
					if (m_kinhcc!="") sql+="kinhcc,";
					if (m_ngaysanh!="") sql+="ngaysanh,";
					sql+="dacdiem)";
					sql+=" values (:m_mabn,:m_maql,:m_para,";
					if (m_kinhcc!="") sql+=":m_kinhcc,";
					if (m_ngaysanh!="") sql+=":m_ngaysanh,";
					sql+=":m_dacdiem)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_para",OracleType.VarChar,8).Value=m_para;
					if (m_kinhcc!="") cmd.Parameters.Add("m_kinhcc",OracleType.DateTime).Value=StringToDateTime(m_kinhcc);
					if (m_ngaysanh!="")	cmd.Parameters.Add("m_ngaysanh",OracleType.DateTime).Value=StringToDateTime(m_ngaysanh);
					cmd.Parameters.Add("m_dacdiem",OracleType.NVarChar,254).Value=m_dacdiem;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ttkhamthai "+m_maql.ToString());
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_noigioithieu(string m_ngay,long m_maql,string m_mabv,string m_chandoan,string m_maicd)
		{
			string xxx=user+mmyy(m_ngay);
			sql="update "+xxx+".noigioithieu set mabv=:m_mabv,chandoan=:m_chandoan,maicd=:m_maicd where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
			
				cmd.Parameters.Add("m_mabv",OracleType.VarChar,8).Value=m_mabv;
				cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,254).Value=m_chandoan;
				cmd.Parameters.Add("m_maicd",OracleType.VarChar,9).Value=m_maicd;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".noigioithieu(maql,mabv,chandoan,maicd) values (:m_maql,:m_mabv,:m_chandoan,:m_maicd)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_mabv",OracleType.VarChar,8).Value=m_mabv;
					cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,254).Value=m_chandoan;
					cmd.Parameters.Add("m_maicd",OracleType.VarChar,9).Value=m_maicd;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"Noigioithieu");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		//ThanhCuong 06/04/2012
		public bool upd_noigioithieu(long m_maql,string m_sochuyenden,string m_ngay)
		{
			string xxx=user+mmyy(m_ngay);
			sql="update "+xxx+".noigioithieu set sochuyenden=:m_sochuyenden where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
			
				cmd.Parameters.Add("m_sochuyenden",OracleType.NVarChar,30).Value=m_sochuyenden;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".noigioithieu(maql,sochuyenden) values (:m_maql,:m_sochuyenden)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_sochuyenden",OracleType.NVarChar,30).Value=m_sochuyenden;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"Noigioithieu");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}
		//End ThanhCuong 06/04/2012

		public bool get_count(string nam, string str)
		{
			int i=0;
			bool bFound = false;
			string mmyy = "";
			while (i < nam.Trim().Length && !bFound)
			{
				mmyy = nam.Substring(i, 4);
				if (bMmyy(mmyy))
				{
					sql = str.Replace("xxx", user + mmyy);
					bFound=get_data(sql).Tables[0].Rows.Count > 0;
				}
				i += 5;
			}
			return bFound;
		}

		public DataSet get_data_nam_dec(string nam, string str)
		{
			if (ds!=null)
			{
				ds.Dispose();
				ds=null;
			}
			ds = new DataSet();
			int i = nam.Trim().Length;
			bool bFound = false ;
			string mmyy = "";
			while (i>0 && !bFound)
			{
				mmyy = nam.Substring(i-5, 4);
				if (bMmyy(mmyy))
				{
					sql = str.Replace("xxx", user + mmyy);
					ds = get_data(sql);
					if(ds!=null)
						bFound = ds.Tables[0].Rows.Count > 0;
					else
						bFound=false;
				}
				i -= 5;
			}
			return ds;
		}

		public DataSet get_data_nam_dec(string nam, string str, int i_sothang)
		{
			if (ds!=null)
			{
				ds.Dispose();
				ds=null;
			}
			ds = new DataSet();
			int i = nam.Trim().Length;
			bool bFound = false ;
			string mmyy = "";
			int i_thang=0;
			if(i_sothang<=0)i_sothang=12;
			while (i>0 && !bFound && i_thang<=i_sothang)
			{
				mmyy = nam.Substring(i-5, 4);
				if (bMmyy(mmyy))
				{
					sql = str.Replace("xxx", user + mmyy);
					ds = get_data(sql);
					if(ds!=null)
						bFound = ds.Tables[0].Rows.Count > 0;
					else
						bFound=false;
				}
				i -= 5;
				i_thang+=1;
			}
			return ds;
		}

		public DataSet get_data_nam(string nam, string str)
		{
			DataSet tmp = new DataSet();
			int i = 0;
			bool be = true;
			string mmyy = "";
			while (i < nam.Trim().Length)
			{
				mmyy = nam.Substring(i, 4);
				if (bMmyy(mmyy))
				{
					sql = str.Replace("xxx", user + mmyy);
					if (be)
					{
						tmp = get_data(sql);
						if(tmp!=null)be = false;
					}
					else tmp.Merge(get_data(sql));
				}
				i += 5;
			}
			if(tmp.Tables.Count==0){tmp=null;}
			return tmp;
		}

		public DataSet get_data_nam(string nam, string str, int i_sothang)
		{
			DataSet tmp = new DataSet();
			int i = 0;
			bool be = true;
			string mmyy = "";
			int i_thang=0;
			if(i_sothang==0) i_sothang=12;
			while (i < nam.Trim().Length && i_thang<=i_sothang)
			{
				mmyy = nam.Substring(i, 4);
				if (bMmyy(mmyy))
				{
					sql = str.Replace("xxx", user + mmyy);
					if (be)
					{
						tmp = get_data(sql);
						if(tmp!=null)be = false;
					}
					else tmp.Merge(get_data(sql));
				}
				i += 5;
			}
			return tmp;
		}
		public DataSet get_data_mmyy(string str, string tu, string den, bool khoangcach)
		{
			DataSet tmp = new DataSet();
			
			DateTime dt1 = (khoangcach) ? StringToDate(tu).AddDays(-iNgaykiemke) : StringToDate(tu);
			DateTime dt2 = (khoangcach) ? StringToDate(den).AddDays(iNgaykiemke) : StringToDate(den);
			int y1 = dt1.Year, m1 = dt1.Month;
			int y2 = dt2.Year, m2 = dt2.Month;
			int itu, iden;
			string mmyy = "";
			bool be = true;
			for (int i = y1; i <= y2; i++)
			{
				itu = (i == y1) ? m1 : 1;
				iden = (i == y2) ? m2 : 12;
				for (int j = itu; j <= iden; j++)
				{
					mmyy = j.ToString().PadLeft(2, '0') + i.ToString().Substring(2, 2);
					if (bMmyy(mmyy))
					{
						sql = str.Replace("xxx", user + mmyy);
						if (be ||tmp.Tables.Count <=0 ||tmp.Tables[0].Rows.Count <=0)
						{
							tmp = get_data(sql);
							be = false;
						}
						else tmp.Merge(get_data(sql));
					}
				}
			}
			return tmp;
		}

		public DataSet get_data_mmyy_d(string str, string tu, string den, bool khoangcach)
		{
			DataSet tmp = new DataSet();
			
			DateTime dt1 = (khoangcach) ? StringToDate(tu).AddDays(-iNgaykiemke) : StringToDate(tu);
			DateTime dt2 = (khoangcach) ? StringToDate(den).AddDays(iNgaykiemke) : StringToDate(den);
			int y1 = dt1.Year, m1 = dt1.Month;
			int y2 = dt2.Year, m2 = dt2.Month;
			int itu, iden;
			string mmyy = "";
			bool be = true;
			for (int i = y1; i <= y2; i++)
			{
				itu = (i == y1) ? m1 : 1;
				iden = (i == y2) ? m2 : 12;
				for (int j = itu; j <= iden; j++)
				{
					mmyy = j.ToString().PadLeft(2, '0') + i.ToString().Substring(2, 2);
					if (bMmyy_d(mmyy))
					{
						sql = str.Replace("xxx", user +"d" + mmyy);
						if (be)
						{
							tmp = get_data(sql);
							be = false;
						}
						else tmp.Merge(get_data(sql));
					}
				}
			}
			return tmp;
		}
		public DataSet get_data_mmyy(string str, string tu, string den, int songay)
		{
			DataSet tmp = new DataSet();
			
			DateTime dt1 = (songay!=0) ? StringToDate(tu).AddDays(-songay) : StringToDate(tu);
			DateTime dt2 = (songay!=0) ? StringToDate(den).AddDays(songay) : StringToDate(den);
			int y1 = dt1.Year, m1 = dt1.Month;
			int y2 = dt2.Year, m2 = dt2.Month;
			int itu, iden;
			string mmyy = "";
			bool be = true;
			for (int i = y1; i <= y2; i++)
			{
				itu = (i == y1) ? m1 : 1;
				iden = (i == y2) ? m2 : 12;
				for (int j = itu; j <= iden; j++)
				{
					mmyy = j.ToString().PadLeft(2, '0') + i.ToString().Substring(2, 2);
					if (bMmyy(mmyy))
					{
						sql = str.Replace("xxx", user + mmyy);
						if (be || tmp==null)
						{
							tmp = get_data(sql);
							be = false;
						}
						else tmp.Merge(get_data(sql));
					}
				}
			}
			return tmp;
		}

		public bool bMmyy(string m_mmyy)
		{
			return get_data("select * from m_table where mmyy='" + ((m_mmyy.Trim().Length==4)?m_mmyy:mmyy(m_mmyy)) + "'").Tables[0].Rows.Count > 0;
		}

		public bool bMmyy_d(string m_mmyy)
		{
			return get_data("select * from d_table where mmyy='" + ((m_mmyy.Trim().Length==4)?m_mmyy:mmyy(m_mmyy)) + "'").Tables[0].Rows.Count > 0;
		}
		public bool upd_giocc(int m_buoi,string m_tu,string m_den)
		{
			sql="update tl_giocc set tu=:m_tu,den=:m_den where buoi=:m_buoi";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
			
				cmd.Parameters.Add("m_tu",OracleType.VarChar,5).Value=m_tu;
				cmd.Parameters.Add("m_den",OracleType.VarChar,5).Value=m_den;
				cmd.Parameters.Add("m_buoi",OracleType.Number).Value=m_buoi;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into tl_giocc(buoi,tu,den) values (:m_buoi,:m_tu,:m_den)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_buoi",OracleType.Number).Value=m_buoi;
					cmd.Parameters.Add("m_tu",OracleType.VarChar,5).Value=m_tu;
					cmd.Parameters.Add("m_den",OracleType.VarChar,5).Value=m_den;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"tl_giocc");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_giothem(int m_loai,string m_tu,string m_den)
		{
			sql="update tl_giothem set tu=:m_tu,den=:m_den where loai=:m_loai";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
			
				cmd.Parameters.Add("m_tu",OracleType.VarChar,5).Value=m_tu;
				cmd.Parameters.Add("m_den",OracleType.VarChar,5).Value=m_den;
				cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into tl_giothem(loai,tu,den) values (:m_loai,:m_tu,:m_den)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
					cmd.Parameters.Add("m_tu",OracleType.VarChar,5).Value=m_tu;
					cmd.Parameters.Add("m_den",OracleType.VarChar,5).Value=m_den;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"tl_giothem");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_loaicc(int m_id,string m_ma,string m_ten)
		{
			sql="update tl_loaicc set ma=:m_ma,ten=:m_ten where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
			
				cmd.Parameters.Add("m_ma",OracleType.NVarChar,10).Value=m_ma;
				cmd.Parameters.Add("m_ten",OracleType.NVarChar,100).Value=m_ten;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into tl_loaicc(id,ma,ten) values (:m_id,:m_ma,:m_ten)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.NVarChar,10).Value=m_ma;
					cmd.Parameters.Add("m_ten",OracleType.NVarChar,100).Value=m_ten;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"tl_loaicc");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_cc(string m_madv,string m_manv,string m_ngay,int m_buoi,int m_loai,string m_tu,string m_den,string m_ghichu,int m_userid)
		{
			string xxx=user+mmyy(m_ngay);
			sql="update "+xxx+".tl_cc set madv=:m_madv,loai=:m_loai,tu=:m_tu,den=:m_den,ghichu=:m_ghichu,userid=:m_userid where manv=:m_manv and to_char(ngay,'dd/mm/yyyy')=:m_ngay and buoi=:m_buoi";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
			
				cmd.Parameters.Add("m_madv",OracleType.VarChar,3).Value=m_madv;
				cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
				cmd.Parameters.Add("m_tu",OracleType.VarChar,5).Value=m_tu;
				cmd.Parameters.Add("m_den",OracleType.VarChar,5).Value=m_den;
				cmd.Parameters.Add("m_ghichu",OracleType.NVarChar,254).Value=m_ghichu;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_manv",OracleType.VarChar,4).Value=m_manv;
				cmd.Parameters.Add("m_ngay",OracleType.VarChar,10).Value=m_ngay;
				cmd.Parameters.Add("m_buoi",OracleType.Number).Value=m_buoi;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".tl_cc(madv,manv,ngay,buoi,loai,tu,den,ghichu,userid) values (:m_madv,:m_manv,to_date(:m_ngay,'dd/mm/yyyy'),:m_buoi,:m_loai,:m_tu,:m_den,:m_ghichu,:m_userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_madv",OracleType.VarChar,3).Value=m_madv;
					cmd.Parameters.Add("m_manv",OracleType.VarChar,4).Value=m_manv;
					cmd.Parameters.Add("m_ngay",OracleType.VarChar,10).Value=m_ngay;
					cmd.Parameters.Add("m_buoi",OracleType.Number).Value=m_buoi;
					cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
					cmd.Parameters.Add("m_tu",OracleType.VarChar,5).Value=m_tu;
					cmd.Parameters.Add("m_den",OracleType.VarChar,5).Value=m_den;
					cmd.Parameters.Add("m_ghichu",OracleType.NVarChar,254).Value=m_ghichu;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"tl_cc");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}
		public bool upd_ng(string m_madv,string m_manv,string m_ngay,int m_loai,int m_co,string m_tu,string m_den,string m_ghichu,int m_userid)
		{
			string xxx=user+mmyy(m_ngay);
			sql="update "+xxx+".tl_ng set madv=:m_madv,co=:m_co,tu=:m_tu,den=:m_den,ghichu=:m_ghichu,userid=:m_userid where manv=:m_manv and to_char(ngay,'dd/mm/yyyy')=:m_ngay and loai=:m_loai";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
			
				cmd.Parameters.Add("m_madv",OracleType.VarChar,3).Value=m_madv;
				cmd.Parameters.Add("m_co",OracleType.Number).Value=m_co;
				cmd.Parameters.Add("m_tu",OracleType.VarChar,5).Value=m_tu;
				cmd.Parameters.Add("m_den",OracleType.VarChar,5).Value=m_den;
				cmd.Parameters.Add("m_ghichu",OracleType.NVarChar,254).Value=m_ghichu;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_manv",OracleType.VarChar,4).Value=m_manv;
				cmd.Parameters.Add("m_ngay",OracleType.VarChar,10).Value=m_ngay;
				cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".tl_ng(madv,manv,ngay,loai,co,tu,den,ghichu,userid) values (:m_madv,:m_manv,to_date(:m_ngay,'dd/mm/yyyy'),:m_loai,:m_co,:m_tu,:m_den,:m_ghichu,:m_userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_madv",OracleType.VarChar,3).Value=m_madv;
					cmd.Parameters.Add("m_manv",OracleType.VarChar,4).Value=m_manv;
					cmd.Parameters.Add("m_ngay",OracleType.VarChar,10).Value=m_ngay;
					cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
					cmd.Parameters.Add("m_co",OracleType.Number).Value=m_co;
					cmd.Parameters.Add("m_tu",OracleType.VarChar,5).Value=m_tu;
					cmd.Parameters.Add("m_den",OracleType.VarChar,5).Value=m_den;
					cmd.Parameters.Add("m_ghichu",OracleType.NVarChar,254).Value=m_ghichu;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"tl_ng");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_benhandt_mmyy(string m_mabn,long m_maql,string m_makp,string m_ngay,
			int m_dentu,int m_nhantu,int m_lanthu,int m_madoituong,string m_chandoan,
			string m_maicd,string m_mabs,string m_sovaovien,int m_loaiba,int m_userid,bool m_update,long m_mangtr,long m_mavaovien)
		{
			string xxx=user+mmyy(m_ngay);
			sql="update "+xxx+".benhandt set ";
			if (m_update) sql+="makp=:m_makp,";
			sql+="ngay=:m_ngay,dentu=:m_dentu,nhantu=:m_nhantu,";
			sql+="lanthu=:m_lanthu,madoituong=:m_madoituong,chandoan=:m_chandoan,maicd=:m_maicd,mabs=:m_mabs,";
			if (m_sovaovien!="") sql+="sovaovien=:m_sovaovien,";
			sql+="loaiba=:m_loaiba,userid=:m_userid,mangtr=:m_mangtr,mavaovien=:m_mavaovien where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				if (m_update)	cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_dentu",OracleType.Number).Value=m_dentu;
				cmd.Parameters.Add("m_nhantu",OracleType.Number).Value=m_nhantu;
				cmd.Parameters.Add("m_lanthu",OracleType.Number).Value=m_lanthu;
				cmd.Parameters.Add("m_madoituong",OracleType.Number).Value=m_madoituong;
				cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,254).Value=m_chandoan;
				cmd.Parameters.Add("m_maicd",OracleType.VarChar,9).Value=m_maicd;
				cmd.Parameters.Add("m_mabs",OracleType.VarChar,4).Value=m_mabs;
				if (m_sovaovien!="") cmd.Parameters.Add("m_sovaovien",OracleType.VarChar,10).Value=m_sovaovien;
				cmd.Parameters.Add("m_loaiba",OracleType.Number).Value=m_loaiba;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_mangtr",OracleType.Number).Value=m_mangtr;
				cmd.Parameters.Add("m_mavaovien",OracleType.Number).Value=m_mavaovien;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					if (m_sovaovien=="")
					{
						sql="insert into "+xxx+".benhandt(mabn,maql,makp,ngay,dentu,nhantu,lanthu,madoituong,chandoan,maicd,mabs,loaiba,userid,ngayud,mangtr,mavaovien)";
						sql+=" values (:m_mabn,:m_maql,:m_makp,:m_ngay,:m_dentu,:m_nhantu,:m_lanthu,:m_madoituong,:m_chandoan,:m_maicd,:m_mabs,:m_loaiba,:m_userid,sysdate,:m_mangtr,:m_mavaovien)";
					}
					else
					{
						sql="insert into "+xxx+".benhandt(mabn,maql,makp,ngay,dentu,nhantu,lanthu,madoituong,chandoan,maicd,mabs,sovaovien,loaiba,userid,ngayud,mangtr,mavaovien)";
						sql+=" values (:m_mabn,:m_maql,:m_makp,:m_ngay,:m_dentu,:m_nhantu,:m_lanthu,:m_madoituong,:m_chandoan,:m_maicd,:m_mabs,:m_sovaovien,:m_loaiba,:m_userid,sysdate,:m_mangtr,:m_mavaovien)";
					}
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar).Value=m_mabn;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_dentu",OracleType.Number).Value=m_dentu;
					cmd.Parameters.Add("m_nhantu",OracleType.Number).Value=m_nhantu;
					cmd.Parameters.Add("m_lanthu",OracleType.Number).Value=m_lanthu;
					cmd.Parameters.Add("m_madoituong",OracleType.Number).Value=m_madoituong;
					cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,254).Value=m_chandoan;
					cmd.Parameters.Add("m_maicd",OracleType.VarChar,9).Value=m_maicd;
					cmd.Parameters.Add("m_mabs",OracleType.VarChar,4).Value=m_mabs;
					if (m_sovaovien!="") cmd.Parameters.Add("m_sovaovien",OracleType.VarChar,10).Value=m_sovaovien;
					cmd.Parameters.Add("m_loaiba",OracleType.Number).Value=m_loaiba;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					cmd.Parameters.Add("m_mangtr",OracleType.Number).Value=m_mangtr;
					cmd.Parameters.Add("m_mavaovien",OracleType.Number).Value=m_mavaovien;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"Benhandt");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public void upd_sovaovien(string m_ngay,long m_maql,string m_sovaovien)
		{
			string xxx=user+mmyy(m_ngay);
			sql="update "+xxx+".benhandt set sovaovien='"+m_sovaovien+"' where maql="+m_maql;
			execute_data(sql);
		}

		public bool upd_xuatvien_mmyy(string m_mabn,long m_maql,string m_makp,string m_ngay,int m_ketqua,int m_ttlucrv,
			string m_chandoan,string m_maicd,string m_mabs,string m_soluutru,int m_bienchung,int m_taibien,int m_giaiphau,int m_userid)
		{
			string xxx=user+mmyy(m_ngay);
			string sql="update "+xxx+".xuatvien set makp=:m_makp,ngay=:m_ngay,";
			sql+="ketqua=:m_ketqua,ttlucrv=:m_ttlucrv,chandoan=:m_chandoan,";
			sql+="maicd=:m_maicd,mabs=:m_mabs,soluutru=:m_soluutru,bienchung=:m_bienchung,";
			sql+="taibien=:m_taibien,giaiphau=:m_giaiphau,userid=:m_userid";
			sql+=" where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
			
				cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_ketqua",OracleType.Number).Value=m_ketqua;
				cmd.Parameters.Add("m_ttlucrv",OracleType.Number).Value=m_ttlucrv;
				cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,254).Value=m_chandoan;
				cmd.Parameters.Add("m_maicd",OracleType.VarChar,9).Value=m_maicd;
				cmd.Parameters.Add("m_mabs",OracleType.VarChar,4).Value=m_mabs;
				cmd.Parameters.Add("m_soluutru",OracleType.NVarChar,10).Value=m_soluutru;
				cmd.Parameters.Add("m_bienchung",OracleType.Number).Value=m_bienchung;
				cmd.Parameters.Add("m_taibien",OracleType.Number).Value=m_taibien;
				cmd.Parameters.Add("m_giaiphau",OracleType.Number).Value=m_giaiphau;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;

				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".xuatvien (mabn,maql,makp,ngay,ketqua,ttlucrv,chandoan,maicd,mabs,soluutru,bienchung,taibien,giaiphau,userid,ngayud)";
					sql+=" values (:m_mabn,:m_maql,:m_makp,:m_ngay,:m_ketqua,:m_ttlucrv,:m_chandoan,:m_maicd,:m_mabs,:m_soluutru,:m_bienchung,:m_taibien,:m_giaiphau,:m_userid,sysdate)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar).Value=m_mabn;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_ketqua",OracleType.Number).Value=m_ketqua;
					cmd.Parameters.Add("m_ttlucrv",OracleType.Number).Value=m_ttlucrv;
					cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,254).Value=m_chandoan;
					cmd.Parameters.Add("m_maicd",OracleType.VarChar,9).Value=m_maicd;
					cmd.Parameters.Add("m_mabs",OracleType.VarChar,4).Value=m_mabs;
					cmd.Parameters.Add("m_soluutru",OracleType.NVarChar,10).Value=m_soluutru;
					cmd.Parameters.Add("m_bienchung",OracleType.Number).Value=m_bienchung;
					cmd.Parameters.Add("m_taibien",OracleType.Number).Value=m_taibien;
					cmd.Parameters.Add("m_giaiphau",OracleType.Number).Value=m_giaiphau;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
								
				//upd_hiendien(m_maql);
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"Xuatvien");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public string get_soluutru(string nam,string mabn)
		{
			try
			{
				sql="select b.soluutru from xxx.benhandt a,xxx.lienhe b where a.maql=b.maql and a.mabn='"+mabn+"' order by a.maql desc";
				ds=get_data_nam_dec(nam,sql);
				if (ds.Tables[0].Rows.Count>0) return ds.Tables[0].Rows[0]["soluutru"].ToString();
				else return "";
			}
			catch{return "";}
		}

		public string get_tuoivao(string m_ngay,long m_maql)
		{
			ds=get_data("select tuoivao from "+user+mmyy(m_ngay)+".lienhe where maql="+m_maql);
			return (ds.Tables[0].Rows.Count==0)?"":ds.Tables[0].Rows[0][0].ToString();
		}

		public bool upd_ttmat(string m_ngay,long m_maql,string m_mp,string m_mt,string m_nhanapp,string m_nhanapt)
		{
			string xxx=user+mmyy(m_ngay);
			sql="update "+xxx+".ttmat set mp=:m_mp,mt=:m_mt,nhanapp=:m_nhanapp,nhanapt=:m_nhanapt";
			sql+=" where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_mp",OracleType.NVarChar,30).Value=m_mp;
				cmd.Parameters.Add("m_mt",OracleType.NVarChar,30).Value=m_mt;
				cmd.Parameters.Add("m_nhanapp",OracleType.NVarChar,30).Value=m_nhanapp;
				cmd.Parameters.Add("m_nhanapt",OracleType.NVarChar,30).Value=m_nhanapt;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ttmat(maql,mp,mt,nhanapp,nhanapt) values (:m_maql,:m_mp,:m_mt,:m_nhanapp,:m_nhanapt)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_mp",OracleType.NVarChar,30).Value=m_mp;
					cmd.Parameters.Add("m_mt",OracleType.NVarChar,30).Value=m_mt;
					cmd.Parameters.Add("m_nhanapp",OracleType.NVarChar,30).Value=m_nhanapp;
					cmd.Parameters.Add("m_nhanapt",OracleType.NVarChar,30).Value=m_nhanapt;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ttmat "+m_maql.ToString());
				return false;
			}
			finally
			{
				con.Close();con.Dispose();				
			}		
			return true;
		}

		public bool upd_ttmat(string m_ngay,long m_maql,string m_mp,string m_mt,string m_nhanapp,string m_nhanapt,string m_mpkk,string m_mtkk)
		{
			string xxx=user+mmyy(m_ngay);
			sql="update "+xxx+".ttmat set mp=:m_mp,mt=:m_mt,nhanapp=:m_nhanapp,nhanapt=:m_nhanapt,mpkk=:m_mpkk,mtkk=:m_mtkk";
			sql+=" where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_mp",OracleType.NVarChar,30).Value=m_mp;
				cmd.Parameters.Add("m_mt",OracleType.NVarChar,30).Value=m_mt;
				cmd.Parameters.Add("m_nhanapp",OracleType.NVarChar,30).Value=m_nhanapp;
				cmd.Parameters.Add("m_nhanapt",OracleType.NVarChar,30).Value=m_nhanapt;
				cmd.Parameters.Add("m_mpkk",OracleType.NVarChar,30).Value=m_mpkk;
				cmd.Parameters.Add("m_mtkk",OracleType.NVarChar,30).Value=m_mtkk;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ttmat(maql,mp,mt,nhanapp,nhanapt,mpkk,mtkk) values (:m_maql,:m_mp,:m_mt,:m_nhanapp,:m_nhanapt,:m_mpkk,:m_mtkk)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_mp",OracleType.NVarChar,30).Value=m_mp;
					cmd.Parameters.Add("m_mt",OracleType.NVarChar,30).Value=m_mt;
					cmd.Parameters.Add("m_nhanapp",OracleType.NVarChar,30).Value=m_nhanapp;
					cmd.Parameters.Add("m_nhanapt",OracleType.NVarChar,30).Value=m_nhanapt;
					cmd.Parameters.Add("m_mpkk",OracleType.NVarChar,30).Value=m_mpkk;
					cmd.Parameters.Add("m_mtkk",OracleType.NVarChar,30).Value=m_mtkk;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ttmat "+m_maql.ToString());
				return false;
			}
			finally
			{
				con.Close();con.Dispose();				
			}		
			return true;
		}

		public bool upd_xutrikbct(string m_ngay,long m_maql,string m_xutri,string m_makp)
		{
			string xxx=user+mmyy(m_ngay);
			sql="update "+xxx+".xutrikbct set xutri=:m_xutri,makp=:m_makp";
			sql+=" where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_xutri",OracleType.VarChar,50).Value=m_xutri;
				cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".xutrikbct(maql,xutri,makp) values (:m_maql,:m_xutri,:m_makp)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_xutri",OracleType.VarChar,50).Value=m_xutri;
					cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"xutrikbct");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();				
			}		
			return true;
		}

		public string get_xutri(string m_ngay,long m_maql,int i)
		{
			DataTable dt=get_data("select xutri,makp from "+user+mmyy(m_ngay)+".xutrikbct where maql="+m_maql).Tables[0];
			if (dt.Rows.Count==0) return "";
			else return dt.Rows[0][i].ToString();
		}

		public bool upd_cdkemtheo(string m_ngay,long m_id,long m_maql,int m_loai,string m_chandoan,string m_maicd,int m_stt)
		{
			string xxx=user+mmyy(m_ngay);
			sql="update "+xxx+".cdkemtheo set chandoan=:m_chandoan,maicd=:m_maicd,maql=:m_maql where id=:m_id and loai=:m_loai and stt=:m_stt";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
			
				cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,254).Value=m_chandoan;
				cmd.Parameters.Add("m_maicd",OracleType.VarChar,9).Value=m_maicd;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
				cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".cdkemtheo(id,maql,loai,chandoan,maicd,stt) values (:m_id,:m_maql,:m_loai,:m_chandoan,:m_maicd,:m_stt)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
					cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,254).Value=m_chandoan;
					cmd.Parameters.Add("m_maicd",OracleType.VarChar,9).Value=m_maicd;
					cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"Cdkemtheo");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();				
			}		
			return true;
		}

		public bool upd_hen(string m_ngay,long m_maql,decimal m_songay,string m_ghichu,int m_loai,int m_tiepdon)
		{
			string xxx=user+mmyy(m_ngay);
			sql="update "+xxx+".hen set songay=:m_songay,ghichu=:m_ghichu,loai=:m_loai,tiepdon=:m_tiepdon where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_songay",OracleType.Number).Value=m_songay;
				cmd.Parameters.Add("m_ghichu",OracleType.NVarChar,254).Value=m_ghichu;
				cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
				cmd.Parameters.Add("m_tiepdon",OracleType.Number).Value=m_tiepdon;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".hen (maql,songay,ghichu,loai,tiepdon) values (:m_maql,:m_songay,:m_ghichu,:m_loai,:m_tiepdon)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_songay",OracleType.Number).Value=m_songay;
					cmd.Parameters.Add("m_ghichu",OracleType.NVarChar,254).Value=m_ghichu;
					cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
					cmd.Parameters.Add("m_tiepdon",OracleType.Number).Value=m_tiepdon;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim(),sComputer,"hen");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();				
			}		
			return true;
		}

		public bool upd_hen(string m_ngay,long m_maql,decimal m_songay,string m_ghichu,int m_loai,int m_tiepdon,string m_makp)
		{
			string xxx=user+mmyy(m_ngay);
			sql="update "+xxx+".hen set songay=:m_songay,ghichu=:m_ghichu,loai=:m_loai,tiepdon=:m_tiepdon,makp=:m_makp where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_songay",OracleType.Number).Value=m_songay;
				cmd.Parameters.Add("m_ghichu",OracleType.NVarChar,254).Value=m_ghichu;
				cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
				cmd.Parameters.Add("m_tiepdon",OracleType.Number).Value=m_tiepdon;
				cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".hen (maql,songay,ghichu,loai,tiepdon,makp) values (:m_maql,:m_songay,:m_ghichu,:m_loai,:m_tiepdon,:m_makp)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_songay",OracleType.Number).Value=m_songay;
					cmd.Parameters.Add("m_ghichu",OracleType.NVarChar,254).Value=m_ghichu;
					cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
					cmd.Parameters.Add("m_tiepdon",OracleType.Number).Value=m_tiepdon;
					cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim(),sComputer,"hen");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();				
			}		
			return true;
		}

		public int stt(string mabs,string maicd,long id)
		{
			int ret=0;
			ds=get_data("select * from d_theodonll where mabs='"+mabs+"' and maicd='"+maicd+"'");
			if (ds.Tables[0].Rows.Count>0)
				foreach(DataRow r in ds.Tables[0].Select("id="+id))
				{
					ret=int.Parse(r["stt"].ToString());
					break;
				}
			return (ret==0)?ds.Tables[0].Rows.Count+1:ret;
		}

		public string get_nam(string m_mabn)
		{
			try
			{
				return get_data("select nam from btdbn where mabn='"+m_mabn+"'").Tables[0].Rows[0]["nam"].ToString().Trim();
			}
			catch{return "";}
		}

		public bool upd_pttt_loai(int m_id,string m_ten)
		{
			sql="update pttt_loai set ten=:m_ten where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
			
				cmd.Parameters.Add("m_ten",OracleType.NVarChar,100).Value=m_ten;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into pttt_loai(id,ten) values (:m_id,:m_ten)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ten",OracleType.NVarChar,100).Value=m_ten;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"pttt_loai");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();				
			}		
			return true;
		}

		public bool upd_pttt_bs(long m_id,int m_loai,string m_mabs)
		{
			sql="update pttt_bs set loai=:m_loai where id=:m_id and mabs=:m_mabs";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;			
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_mabs",OracleType.VarChar,4).Value=m_mabs;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into pttt_bs(id,loai,mabs) values (:m_id,:m_loai,:m_mabs)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
					cmd.Parameters.Add("m_mabs",OracleType.VarChar,4).Value=m_mabs;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"pttt_bs");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();				
			}		
			return true;
		}
		public DataSet merge(DataSet ds1, DataSet ds2)
		{
			DataRow r1;
			foreach (DataRow r in ds2.Tables[0].Rows)
			{
				r1 = ds1.Tables[0].NewRow();
				for (int i = 0; i < ds2.Tables[0].Columns.Count; i++) r1[i] = r[i].ToString();
				ds1.Tables[0].Rows.Add(r1);
			}
			return ds1;
		}
		public DataTable merge(DataTable dt1, DataTable dt2)
		{
			DataRow r1;
			foreach (DataRow r in dt2.Rows)
			{
				r1 = dt1.NewRow();
				for (int i = 0; i < dt2.Columns.Count; i++) r1[i] = r[i].ToString();
				dt1.Rows.Add(r1);
			}
			return dt1;
		}

		public bool upd_tuchoi(string m_mabn,long m_maql,string m_makp,string m_ngay,
			int m_dentu,int m_nhantu,int m_lanthu,int m_madoituong,string m_chandoan,
			string m_maicd,string m_mabs,string m_sovaovien,int m_loaiba,int m_lydo,int m_userid)
		{
			sql="update tuchoi set ";
			sql+="makp=:m_makp,";
			sql+="ngay=:m_ngay,dentu=:m_dentu,nhantu=:m_nhantu,";
			sql+="lanthu=:m_lanthu,madoituong=:m_madoituong,chandoan=:m_chandoan,maicd=:m_maicd,mabs=:m_mabs,";
			sql+="sovaovien=:m_sovaovien,";
			sql+="loaiba=:m_loaiba,lydo=:m_lydo,userid=:m_userid where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
				cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
				cmd.Parameters.Add("m_dentu",OracleType.Number).Value=m_dentu;
				cmd.Parameters.Add("m_nhantu",OracleType.Number).Value=m_nhantu;
				cmd.Parameters.Add("m_lanthu",OracleType.Number).Value=m_lanthu;
				cmd.Parameters.Add("m_madoituong",OracleType.Number).Value=m_madoituong;
				cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,254).Value=m_chandoan;
				cmd.Parameters.Add("m_maicd",OracleType.VarChar,9).Value=m_maicd;
				cmd.Parameters.Add("m_mabs",OracleType.VarChar,4).Value=m_mabs;
				cmd.Parameters.Add("m_sovaovien",OracleType.VarChar,10).Value=m_sovaovien;
				cmd.Parameters.Add("m_loaiba",OracleType.Number).Value=m_loaiba;
				cmd.Parameters.Add("m_lydo",OracleType.Number).Value=m_lydo;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into tuchoi(mabn,maql,makp,ngay,dentu,nhantu,lanthu,madoituong,chandoan,maicd,mabs,sovaovien,loaiba,lydo,userid,ngayud)";
					sql+=" values (:m_mabn,:m_maql,:m_makp,:m_ngay,:m_dentu,:m_nhantu,:m_lanthu,:m_madoituong,:m_chandoan,:m_maicd,:m_mabs,:m_sovaovien,:m_loaiba,:m_lydo,:m_userid,sysdate)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar).Value=m_mabn;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
					cmd.Parameters.Add("m_ngay",OracleType.DateTime).Value=StringToDateTime(m_ngay);
					cmd.Parameters.Add("m_dentu",OracleType.Number).Value=m_dentu;
					cmd.Parameters.Add("m_nhantu",OracleType.Number).Value=m_nhantu;
					cmd.Parameters.Add("m_lanthu",OracleType.Number).Value=m_lanthu;
					cmd.Parameters.Add("m_madoituong",OracleType.Number).Value=m_madoituong;
					cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,254).Value=m_chandoan;
					cmd.Parameters.Add("m_maicd",OracleType.VarChar,9).Value=m_maicd;
					cmd.Parameters.Add("m_mabs",OracleType.VarChar,4).Value=m_mabs;
					cmd.Parameters.Add("m_sovaovien",OracleType.VarChar,10).Value=m_sovaovien;
					cmd.Parameters.Add("m_loaiba",OracleType.Number).Value=m_loaiba;
					cmd.Parameters.Add("m_lydo",OracleType.Number).Value=m_lydo;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"tuchoi");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();				
			}		
			return true;
		}

		public string mabn_bhyt(string mabn,string sothe)
		{

			try
			{

				sql="select a.mabn from bhyt a inner join btdbn b on a.mabn=b.mabn where sothe='"+sothe+"' and a.mabn<>'"+mabn+"' and b.hide=0";
				ds=get_data(sql);
				if (ds.Tables[0].Rows.Count>0) return ds.Tables[0].Rows[0]["mabn"].ToString();
				else
				{
					string nam="";
					foreach(DataRow r in get_data("select mmyy from m_table order by substr(mmyy,3,2) desc,substr(mmyy,1,2) desc").Tables[0].Rows) nam+=r["mmyy"].ToString()+"+";
					sql="select a.mabn from xxx.bhyt a inner join btdbn b on a.mabn=b.mabn where sothe='"+sothe+"' and a.mabn<>'"+mabn+"'  and b.hide=0";
					ds=get_data_nam_dec(nam,sql);
					if (ds.Tables[0].Rows.Count>0) return ds.Tables[0].Rows[0]["mabn"].ToString();
					else return "";
				}
			}
			catch
			{execute_data("alter table btdbn add hide number(1) default 0");return "";}
		}
		public DataSet mabn_bhyt_dsbn(string mabn,string sothe,string ngayvaovien)
		{
			ds=null;
			try
			{

				sql="select b.mabn,b.hoten,b.namsinh,b.phai,a.sothe from bhyt a inner join btdbn b on a.mabn=b.mabn where sothe='"+sothe+"' and a.mabn<>'"+mabn+"' and b.hide=0 and to_date(a.denngay,'dd/mm/yyyy')>=to_date('"+ngayvaovien+"','dd/mm/yyyy')";
				ds=get_data(sql);
				if (ds.Tables[0].Rows.Count==0) 
				{
					string nam="";
					foreach(DataRow r in get_data("select mmyy from m_table order by substr(mmyy,3,2) desc,substr(mmyy,1,2) desc").Tables[0].Rows) nam+=r["mmyy"].ToString()+"+";
					sql="select b.mabn,b.hoten,b.namsinh,b.phai from xxx.bhyt a inner join btdbn b on a.mabn=b.mabn where sothe='"+sothe+"' and a.mabn<>'"+mabn+"'  and b.hide=0 and to_date(a.denngay,'dd/mm/yyyy')>=to_date('"+ngayvaovien+"','dd/mm/yyyy')";
					ds=get_data_nam_dec(nam,sql);
					
				}
			}
			catch
			{execute_data("alter table btdbn add hide number(1) default 0");}
			return ds;
		}

		public string mabn_bhyt(string nam,string mabn,string sothe)
		{
			nam="";
			foreach(DataRow r in get_data("select mmyy from m_table order by substr(mmyy,3,2) desc,substr(mmyy,1,2) desc").Tables[0].Rows) nam+=r["mmyy"].ToString()+"+";
			sql="select * from xxx.bhyt where sothe='"+sothe+"' and mabn<>'"+mabn+"'";
			ds=get_data_nam_dec(nam,sql);
			if (ds.Tables[0].Rows.Count>0) return ds.Tables[0].Rows[0]["mabn"].ToString();
			else return "";
		}

		public bool upd_ttxk(int m_ma,string m_ten,int m_rakhoa)
		{
			sql="update ttxk set ten=:m_ten,rakhoa=:m_rakhoa where ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_ten",OracleType.NVarChar,50).Value=m_ten;
				cmd.Parameters.Add("m_rakhoa",OracleType.Number).Value=m_rakhoa;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into ttxk (ma,ten,rakhoa) values (:m_ma,:m_ten,:m_rakhoa)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ten",OracleType.NVarChar,50).Value=m_ten;
					cmd.Parameters.Add("m_rakhoa",OracleType.Number).Value=m_rakhoa;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ttxk");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
				
			}		
			return true;
		}

		public bool ma_phongmo(string makp)
		{
			if (!bPttt_Konhapkhoa) return false;
			else return get_data("select * from btdkp_bv where makp='"+makp+"' and makpbo='19'").Tables[0].Rows.Count>0;
		}

		public bool bTuvong(string mabn)
		{
			return get_data("select a.mabn from xuatvien a,benhandt b where a.maql=b.maql and a.ttlucrv=7 and b.loaiba in (1,2) and a.mabn='"+mabn+"'").Tables[0].Rows.Count>0;
		}

		public string get_soluutru(long maql,string maicd,string ngay)
		{
			sql="select max(substr(soluutru,4,4)) as so from xuatvien where substr(soluutru,1,3)='"+maicd.Substring(0,3)+"' and to_char(ngay,'yy')='"+ngay.Substring(8,2)+"' and maql<>"+maql+" and length(trim(soluutru))=10";
			ds=get_data(sql);
			if (ds.Tables[0].Rows[0]["so"].ToString()=="") return maicd.Substring(0,3)+"0001/"+ngay.Substring(8,2);
			else
			{
				int stt=int.Parse(ds.Tables[0].Rows[0]["so"].ToString())+1;
				return maicd.Substring(0,3)+stt.ToString().PadLeft(4,'0')+"/"+ngay.Substring(8,2);
			}
		}

		public string get_soluutru_ma(long maql,string ma,string ngay)
		{
			sql="select max(substr(soluutru,6)) as so from xuatvien where substr(soluutru,3,3)='"+ma+"' and to_char(ngay,'yy')='"+ngay.Substring(8,2)+"' and maql<>"+maql+" and length(trim(soluutru))=10";
			ds=get_data(sql);
			if (ds.Tables[0].Rows[0]["so"].ToString()=="") return ngay.Substring(8,2)+ma.Substring(0,3)+"00001";
			else
			{
				int stt=int.Parse(ds.Tables[0].Rows[0]["so"].ToString())+1;
				return ngay.Substring(8,2)+ma.Substring(0,3)+stt.ToString().PadLeft(5,'0');
			}
		}

		public string get_soluutru_makpmmsttyy(long maql,string makp,string ngay)
		{
			sql="select max(substr(soluutru,5,4)) as so from xuatvien where makp='"+makp+"' and to_char(ngay,'yymm')='"+ngay.Substring(8,2)+ngay.Substring(3,2)+"' and maql<>"+maql+" and length(trim(soluutru))=10";
			ds=get_data(sql);
			if (ds.Tables[0].Rows[0]["so"].ToString()=="") return makp+ngay.Substring(3,2)+"0001"+ngay.Substring(8,2);
			else
			{
				int stt=int.Parse(ds.Tables[0].Rows[0]["so"].ToString())+1;
				return makp+ngay.Substring(3,2)+stt.ToString().PadLeft(4,'0')+ngay.Substring(8,2);
			}
		}

		public string get_soluutru_makpyystt(long maql,string makp,string ngay)
		{
			sql="select max(substr(soluutru,5,6)) as so from xuatvien where makp='"+makp+"' and to_char(ngay,'yy')='"+ngay.Substring(8,2)+"' and substr(soluutru,8,1)<>'/' and maql<>"+maql+" and length(trim(soluutru))=10";
			ds=get_data(sql);
			if (ds.Tables[0].Rows[0]["so"].ToString()=="") return makp+ngay.Substring(8,2)+"000001";
			else
			{
				try
				{
					int stt=int.Parse(ds.Tables[0].Rows[0]["so"].ToString())+1;
					return makp+ngay.Substring(8,2)+stt.ToString().PadLeft(6,'0');
				}
				catch
				{
					return makp+ngay.Substring(8,2)+"000001";
				}
			}
		}

		public string get_sovaovien_makpmmsttyy(long maql,string makp,string ngay)
		{
			sql="select max(substr(sovaovien,5,4)) as so from benhandt where makp='"+makp+"' and to_char(ngay,'yymm')='"+ngay.Substring(8,2)+ngay.Substring(3,2)+"' and maql<>"+maql+" and length(trim(sovaovien))=10 and loaiba=1";
			ds=get_data(sql);
			if (ds.Tables[0].Rows[0]["so"].ToString()=="") return makp+ngay.Substring(3,2)+"0001"+ngay.Substring(8,2);
			else
			{
				int stt=int.Parse(ds.Tables[0].Rows[0]["so"].ToString())+1;
				return makp+ngay.Substring(3,2)+stt.ToString().PadLeft(4,'0')+ngay.Substring(8,2);
			}
		}

		public bool upd_diungthucan(string m_mabn,int m_stt,int m_nhom,string m_thucan)
		{
			sql="update diungthucan set nhom=:m_nhom,thucan=:m_thucan where mabn=:m_mabn and stt=:m_stt";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_nhom",OracleType.Number).Value=m_nhom;
				cmd.Parameters.Add("m_thucan",OracleType.NVarChar,254).Value=m_thucan;
				cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
				cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into diungthucan(mabn,stt,nhom,thucan) values (:m_mabn,:m_stt,:m_nhom,:m_thucan)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
					cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
					cmd.Parameters.Add("m_nhom",OracleType.Number).Value=m_nhom;
					cmd.Parameters.Add("m_thucan",OracleType.NVarChar,254).Value=m_thucan;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"diungthucan");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
				
			}		
			return true;
		}

		public bool upd_benhannoi(string m_ngay,long m_maql,int m_dentu,int m_kham,string m_ecg,string m_ketluan)
		{
			string xxx=user+mmyy(m_ngay);
			sql="update "+xxx+".benhannoi set dentu=:m_dentu,kham=:m_kham,ecg=:m_ecg,ketluan=:m_ketluan where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_dentu",OracleType.Number).Value=m_dentu;
				cmd.Parameters.Add("m_kham",OracleType.Number).Value=m_kham;
				cmd.Parameters.Add("m_ecg",OracleType.NVarChar,254).Value=m_ecg;
				cmd.Parameters.Add("m_ketluan",OracleType.NVarChar,254).Value=m_ketluan;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".benhannoi(maql,dentu,kham,ecg,ketluan) values (:m_maql,:m_dentu,:m_kham,:m_ecg,:m_ketluan)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_dentu",OracleType.Number).Value=m_dentu;
					cmd.Parameters.Add("m_kham",OracleType.Number).Value=m_kham;
					cmd.Parameters.Add("m_ecg",OracleType.NVarChar,254).Value=m_ecg;
					cmd.Parameters.Add("m_ketluan",OracleType.NVarChar,254).Value=m_ketluan;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"benhannoi");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
				
			}		
			return true;
		}

		public bool upd_chidinhnoi(long m_id,long m_maql,string m_ngay,long m_mavp,string m_ketqua)
		{
			string xxx=user+mmyy(m_ngay);
			sql="update "+xxx+".chidinhnoi set maql=:m_maql,ngay=to_date(:m_ngay,'dd/mm/yyyy hh24:mi'),mavp=:m_mavp,ketqua=:m_ketqua where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				cmd.Parameters.Add("m_ngay",OracleType.VarChar).Value=m_ngay;
				cmd.Parameters.Add("m_mavp",OracleType.Number).Value=m_mavp;
				cmd.Parameters.Add("m_ketqua",OracleType.NVarChar,254).Value=m_ketqua;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".chidinhnoi(id,maql,ngay,mavp,ketqua) values (:m_id,:m_maql,to_date(:m_ngay,'dd/mm/yyyy hh24:mi'),:m_mavp,:m_ketqua)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_ngay",OracleType.VarChar).Value=m_ngay;
					cmd.Parameters.Add("m_mavp",OracleType.Number).Value=m_mavp;
					cmd.Parameters.Add("m_ketqua",OracleType.NVarChar,254).Value=m_ketqua;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"chidinhnoi");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
				
			}		
			return true;
		}

		public bool upd_dausinhton(string m_ngay,long m_maql,decimal m_mach,decimal m_nhietdo,string m_huyetap,decimal m_nhiptho)
		{
			string xxx=user+mmyy(m_ngay);
			sql="update "+xxx+".dausinhton set mach=:m_mach,nhietdo=:m_nhietdo,huyetap=:m_huyetap,nhiptho=:m_nhiptho";
			sql+=" where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_mach",OracleType.Number).Value=m_mach;
				cmd.Parameters.Add("m_nhietdo",OracleType.Number).Value=m_nhietdo;
				cmd.Parameters.Add("m_huyetap",OracleType.VarChar,7).Value=m_huyetap;
				cmd.Parameters.Add("m_nhiptho",OracleType.Number).Value=m_nhiptho;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".dausinhton (maql,mach,nhietdo,huyetap,nhiptho)";
					sql+=" values (:m_maql,:m_mach,:m_nhietdo,:m_huyetap,:m_nhiptho)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_mach",OracleType.Number).Value=m_mach;
					cmd.Parameters.Add("m_nhietdo",OracleType.Number).Value=m_nhietdo;
					cmd.Parameters.Add("m_huyetap",OracleType.VarChar,7).Value=m_huyetap;
					cmd.Parameters.Add("m_nhiptho",OracleType.Number).Value=m_nhiptho;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"dausinhton");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
				
			}		
			return true;
		}

		public string get_soluutru(string m_ngay)
		{
			return get_capid(-50,m_ngay.Substring(8,2)).ToString().PadLeft(7,'0')+"/"+m_ngay.Substring(8,2);
		}

		public string get_soluutru_ngtru(string m_ngay)
		{
			return get_capid(-500,m_ngay.Substring(8,2)).ToString().PadLeft(7,'0')+"/"+m_ngay.Substring(8,2);
		}
		public string get_soluutru_pluu(string m_ngay)
		{
			return get_capid(-501,m_ngay.Substring(8,2)).ToString().PadLeft(7,'0')+"/"+m_ngay.Substring(8,2);
		}

		public bool upd_eve_tables(int m_tableid,int m_userid,string m_command)
		{
			string ngay = ngayhienhanh_server.Substring(0, 10);
			int icomputerid = iRownum,m_ins=0,m_upd=0,m_del=0;
			switch (m_command)
			{
				case "upd": m_upd = 1; break;
				case "del": m_del = 1; break;
				default: m_ins = 1; break;
			}
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand("pkg_duoc.upd_eve_tables",con);
				cmd.CommandType = CommandType.StoredProcedure;
				cmd.Parameters.Add("m_tableid", OracleType.Number).Value = m_tableid;
				cmd.Parameters.Add("m_ngay", OracleType.VarChar,10).Value = ngay;
				cmd.Parameters.Add("m_userid", OracleType.Number).Value = m_userid;
				cmd.Parameters.Add("m_computerid", OracleType.Number).Value = icomputerid;
				cmd.Parameters.Add("m_ins", OracleType.Number).Value = m_ins;
				cmd.Parameters.Add("m_upd", OracleType.Number).Value = m_upd;
				cmd.Parameters.Add("m_del", OracleType.Number).Value = m_del;
				cmd.ExecuteNonQuery();
			}
			catch (OracleException ex)
			{
				upd_error(ex.Message, sComputer, "eve_tables");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
				
			}
			return true;
		}

		public bool upd_eve_upd_del(int m_tableid,int m_userid,string m_command,string m_noidung)
		{
			int icomputerid = iRownum;
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand("pkg_duoc.upd_eve_upd_del",con);
				cmd.CommandType = CommandType.StoredProcedure;
				cmd.Parameters.Add("m_tableid", OracleType.Number).Value = m_tableid;
				cmd.Parameters.Add("m_userid", OracleType.Number).Value = m_userid;
				cmd.Parameters.Add("m_computerid", OracleType.Number).Value = icomputerid;
				cmd.Parameters.Add("m_command", OracleType.VarChar,3).Value = m_command ;
				cmd.Parameters.Add("m_noidung", OracleType.NVarChar,2000).Value = m_noidung;
				cmd.ExecuteNonQuery();
			}
			catch (OracleException ex)
			{
				upd_error(ex.Message, sComputer, "eve_upd_del");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
				
			}
			return true;
		}

		public bool upd_eve_tables(string m_ngay,int m_tableid, int m_userid, string m_command)
		{
			string ngay = ngayhienhanh_server.Substring(0, 10);
			int icomputerid = iRownum, m_ins = 0, m_upd = 0, m_del = 0;
			switch (m_command)
			{
				case "upd": m_upd = 1; break;
				case "del": m_del = 1; break;
				default: m_ins = 1; break;
			}
			if(m_ngay.Trim()=="")m_ngay=ngay;
			string xxx=user+mmyy(m_ngay)+".pkg_vienphi.upd_eve_tables";
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(xxx,con);
				cmd.CommandType = CommandType.StoredProcedure;
				cmd.Parameters.Add("m_tableid", OracleType.Number).Value = m_tableid;
				cmd.Parameters.Add("m_ngay", OracleType.VarChar, 10).Value = ngay;
				cmd.Parameters.Add("m_userid", OracleType.Number).Value = m_userid;
				cmd.Parameters.Add("m_computerid", OracleType.Number).Value = icomputerid;
				cmd.Parameters.Add("m_ins", OracleType.Number).Value = m_ins;
				cmd.Parameters.Add("m_upd", OracleType.Number).Value = m_upd;
				cmd.Parameters.Add("m_del", OracleType.Number).Value = m_del;
				cmd.ExecuteNonQuery();
			}
			catch (OracleException ex)
			{
				upd_error(ex.Message, sComputer, "eve_tables");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
				
			}
			return true;
		}

		public bool upd_eve_upd_del(string m_ngay,int m_tableid, int m_userid, string m_command, string m_noidung)
		{
			int icomputerid = iRownum;
			string xxx=user+mmyy(m_ngay)+".pkg_vienphi.upd_eve_upd_del";
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(xxx,con);
				cmd.CommandType = CommandType.StoredProcedure;
				cmd.Parameters.Add("m_tableid", OracleType.Number).Value = m_tableid;
				cmd.Parameters.Add("m_userid", OracleType.Number).Value = m_userid;
				cmd.Parameters.Add("m_computerid", OracleType.Number).Value = icomputerid;
				cmd.Parameters.Add("m_command", OracleType.VarChar, 3).Value = m_command;
				cmd.Parameters.Add("m_noidung", OracleType.NVarChar,2000).Value = m_noidung;
				cmd.ExecuteNonQuery();
			}
			catch (OracleException ex)
			{
				upd_error(ex.Message, sComputer, "eve_upd_del");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}
			return true;
		}

		private int tableid()
		{
			ds = get_data("select max(id) as id from dmtables");
			if (ds.Tables[0].Rows[0]["id"].ToString()=="") return 1;
			else return int.Parse(ds.Tables[0].Rows[0]["id"].ToString()) + 1;
		}

		public int tableid(string mmyy,string tables)
		{
			int ret = 1;
			ds = get_data("select * from dmtables where tables='" + tables + "'");
			if (ds.Tables[0].Rows.Count > 0) ret=int.Parse(ds.Tables[0].Rows[0]["id"].ToString());
			else
			{
				ret = tableid();
				string fie = "";
				DataSet lds=get_data("select * from "+user+mmyy+"."+tables+" where rownum<0");
				for (int i = 0;i<lds.Tables[0].Columns.Count; i++) fie += lds.Tables[0].Columns[i].ColumnName.ToString().Trim() + "^";
				execute_data("insert into dmtables(id,tables,fields) values (" + ret + ",'" + tables + "','"+fie.Substring(0,fie.Length-1)+"')");
			}
			return ret;
		}

		public string fields(string table,string dk)
		{
			try
			{
				string ret = "";
				DataTable dt = get_data("select * from " + table + " where "+dk).Tables[0];
				if (dt.Rows.Count>0) for (int i = 0; i < dt.Columns.Count; i++) ret += dt.Rows[0][i].ToString().Trim() + "^";
				return (ret != "") ? ret.Substring(0, ret.Length - 1) : ret;
			}
			catch{return "";}
		}

		public bool get_hiv(string mabn)
		{
			string id=ID_HIV;
			if (id=="") return false;
			sql=sql="select a.* from xn_phieu a,xn_ketqua b,xn_ten c,xn_bv_chitiet d ";
			sql+=" where a.id=b.id and b.id_ten=d.id and d.id_ten=c.id";
			sql+=" and a.mabn='"+mabn+"' and b.id_ten in ("+id+")";
			sql+=" and b.ketqua like '%NG T%'";
			return get_data(sql).Tables[0].Rows.Count>0;
		}

		public string file_modify(string tenfile)
		{
			string ret="";
			ret=System.IO.File.GetLastWriteTime(tenfile).ToString("dd/MM/yyyy HH:mm");
			System.IO.FileInfo fi=new System.IO.FileInfo(tenfile);
			ret+=" "+(fi.Length/1024).ToString();
			return ret;
		}

		public string f_modify(string tenfile)
		{
			string s_gio_modify=System.IO.File.GetLastWriteTime(tenfile).ToString("dd.MM.yy")+".1";
			return s_gio_modify;
		}

		public string f_size(string tenfile)
		{
			System.IO.FileInfo fi=new System.IO.FileInfo(tenfile);
			return (fi.Length/1024).ToString();
		}

		public bool bUpdate(string p_localhost,string p_server,string file)
		{
			bool modify=f_modify(file_exe(p_localhost,file))==f_modify(file_exe_update(p_server,file));
			bool size=f_size(file_exe(p_localhost,file))==f_size(file_exe_update(p_server,file));
			return modify && size;
		}

		public string file_exe_update(string path,string tenfilegoc)
		{
			string ret="";
			string [] files=System.IO.Directory.GetFiles(path);
			for(int i=0;i<files.GetLength(0);i++)
			{
				if (files[i].ToString().ToUpper().IndexOf(".EXE")!=-1 && tenfile(files[i].ToString())==tenfilegoc.ToLower())
				{
					ret=files[i].ToString();
					break;
				}
			}
			return ret;
		}

		public string path_medisofthis()
		{
			string path = System.IO.Directory.GetCurrentDirectory();
			string p_localhost = "";
			int j = 0,i=path.Length;
			for (; i >0; i--)
			{
				if (path.Substring(i-1, 1) == "\\") j++;
				if (j == 3) break;				
			}
			p_localhost = path.Substring(0,i-1);
			return p_localhost;
		}

		public void xcopy(string source,string dist)
		{
			string filerun=@path_medisofthis()+"\\version\\bin\\debug\\xcopy.exe";
			string arg=source+" "+dist+" /yes";
			run f=new run(filerun,arg,true);
			f.Launch();
		}

		public string tenfile_goc(string tenfile)
		{
			if (tenfile.Substring(0,1)=="\\")
			{
				string s=tenfile.Substring(tenfile.LastIndexOf("\\")+1);
				return s.Substring(0,s.IndexOf(".")).ToLower();
			}
			else
			{
				System.Reflection.Assembly asm=null;
				asm=System.Reflection.Assembly.LoadFrom(tenfile);
				return asm.GetName().Name.ToString().ToLower();
			}
		}

		public string tenfile(string tenfile)
		{
			string s=tenfile.Substring(tenfile.LastIndexOf("\\")+1);
			return s.Substring(0,s.LastIndexOf(".")).ToLower();
		}

		public string file_exe(string tenfilegoc)
		{
			string ret="";
			string [] files=System.IO.Directory.GetFiles(System.IO.Directory.GetCurrentDirectory());
			for(int i=0;i<files.GetLength(0);i++)
			{
				if (files[i].ToString().ToUpper().IndexOf(".EXE")!=-1 && tenfile_goc(files[i].ToString())==tenfilegoc.ToLower())
				{
					ret=files[i].ToString();
					break;
				}
			}
			return ret;
		}

		public string file_exe(string path,string tenfilegoc)
		{
			string ret="";
			string [] files=System.IO.Directory.GetFiles(path);
			for(int i=0;i<files.GetLength(0);i++)
			{
				if (files[i].ToString().ToUpper().IndexOf(".EXE")!=-1 && tenfile_goc(files[i].ToString())==tenfilegoc.ToLower())
				{
					ret=files[i].ToString();
					break;
				}
			}
			return ret;
		}

		public string file_exe_goc
		{
			get
			{
				string ret="";
				string [] files=System.IO.Directory.GetFiles(System.IO.Directory.GetCurrentDirectory());
				for(int i=0;i<files.GetLength(0);i++)
				{
					if (files[i].ToString().ToUpper().IndexOf(".EXE")!=-1)
					{
						ret=tenfile_goc(files[i].ToString());
						break;
					}
				}
				return ret;
			}
		}

		#region nguyen vien k
		private String get_prev_date(string date)
		{
			DateTime dt=StringToDate(date).AddDays(-1);
			return dt.Day.ToString().PadLeft(2,'0')+"/"+dt.Month.ToString().PadLeft(2,'0')+"/"+dt.Year.ToString();
		}

		public DataSet get_ttravien_ct_ndot(DataSet ds,DataRow [] dr,DataTable dtkp,DataTable dtkpmo,DataTable dtdt,DataTable dtbd,DataTable dtvp,DataSet dsthebhyt,string makp,bool bVienphi_phongluu,bool bLoctheonhapkhoa,bool bLaydottruoc)
		{
			ds.Clear();
			DataRow r1,r2=null;
			DataTable tmp;
			string bhyt_mien="01/07/2005";
			decimal tamung,sotien,bhyt,mien;string yy=Ngaygio_hienhanh.Substring(3,2)+Ngaygio_hienhanh.Substring(8,2);
			long idkhoa=0,maql=0,idvienphi=0,maql_phuongluu=0,idkhoa_sub=0;//de tranh lay so lieu lan nhap khoa ke
			string aimakp="",asmakp="";
			decimal d_st_ktcao=0;
			b_sobienlaitamung="";
			//nguyen
			//
			DataTable dtmavp=new DataTable();
			string s_mathe="";
			foreach(DataRow r in dr)
			{
				maql=long.Parse(r["maql"].ToString());
				yy=r["ngayra"].ToString().Substring(3,2)+r["ngayra"].ToString().Substring(8,2);
				s_mathe=r["sothe"].ToString();
				idkhoa=long.Parse(r["idkhoa"].ToString());
				if(bLoctheonhapkhoa) 
					foreach (DataRow rr in get_data("select id from nhapkhoa where maql="+maql+" and to_char(ngay,'dd/mm/yyyy')='"+r["ngayra"].ToString().Substring(0,10)+"'").Tables[0].Rows)
					{
						idkhoa_sub=long.Parse(rr[0].ToString());
						if(idkhoa==idkhoa_sub) idkhoa_sub=0;
					}
				if (r["done"].ToString()=="0")
				{
					idvienphi=get_id_thvp(yy,r["mabn"].ToString(),maql,idkhoa,r["ngayvao"].ToString(),r["ngayra"].ToString());
					if (idvienphi!=0) execute_data("delete from "+user+yy+".v_thvpct where id="+idvienphi);
					else idvienphi=get_id_thvp();
				}
				break;
			}
			if(makp!="")//neu makp la null lay tat ca cac khoa
			{
				asmakp=makp;
				if(asmakp.Substring(asmakp.Length-1,1)==",") asmakp=asmakp.Substring(0,asmakp.Length-1); 
				foreach(string s_makp in makp.Split(",".ToCharArray())) 
				{
					DataRow rmakp=getrowbyid(dtkp,"makp='"+s_makp+"'");
					if(rmakp!=null)aimakp+=rmakp["id"].ToString()+",";
				}
				if(aimakp!="") aimakp=aimakp.Substring(0,aimakp.Length-1);
			}

			for(int i=0;i<dr.Length;i++)
			{				
				//quang
				r1=getrowbyid(dtkp,"makp='"+dr[i]["makp"].ToString()+"'");				
				if (r1!=null)
				{
					tamung=0;sotien=0;bhyt=0;mien=0;
					idkhoa=long.Parse(dr[i]["idkhoa"].ToString());
					maql=long.Parse(dr[i]["maql"].ToString());
					if (bVienphi_phongluu) maql_phuongluu=get_maql_phongluu(maql);
					else maql_phuongluu=0;
					tamung=get_tamung_ct_ndot(dr[i]["mabn"].ToString(),maql,idkhoa,dr[i]["ngayvao"].ToString(),dr[i]["ngayra"].ToString(),asmakp,int.Parse(dr[i]["madoituong"].ToString()),int.Parse(dr[i]["done"].ToString()),maql_phuongluu);
					if (!bBosolieuduoc)
					{
						tmp=get_thuoc_ct_ndot(dr[i]["mabn"].ToString(),maql,idkhoa,idkhoa_sub,bLaydottruoc?get_prev_date(dr[i]["ngayvao"].ToString()):dr[i]["ngayvao"].ToString(),dr[i]["ngayra"].ToString(),aimakp,int.Parse(dr[i]["madoituong"].ToString()),int.Parse(dr[i]["done"].ToString()),bhyt_mien,maql_phuongluu,bLoctheonhapkhoa);
						if (tmp!=null)
						{
							foreach(DataRow r in tmp.Rows)
							{		
								r2=null;
								//lay ti le bhyt theo ngay su dung (do bhyt thay doi tung thoi diem)
								if(r["bhytt0107"].ToString()!="0")
								{
									r2=get_tylebhyt(long.Parse(r["mabd"].ToString()),r["ngay0107"].ToString(),dtbd);
									if(r2!=null && r2["bhyt"].ToString()=="50")
									{
										r["sotien"]=decimal.Parse(r["sotien"].ToString())*50/100;
										r["bhytt0107"]=decimal.Parse(r["bhytt0107"].ToString())*50/100;
									}
									else
									{
										r["bhytt0107"]=decimal.Parse(r["bhytt0107"].ToString())*80/100;
									}
								}
								//
								if(r2==null) r2=getrowbyid(dtbd,"id="+int.Parse(r["mabd"].ToString()));
								if (r2!=null)
								{
									if(decimal.Parse(r["soluong"].ToString())==0) continue;
									//Binh: lay ten kp
									DataRow rkp=getrowbyid(dtkp,"id="+r["makp"].ToString());
									string s_tenkp="";
									if(rkp!=null)s_tenkp=rkp["ten"].ToString();
									else s_tenkp=dr[i]["tenkp"].ToString();
									//
									string s_madt=dr[i]["madoituong"].ToString();
									string s_dtuong=dr[i]["doituong"].ToString();
									string s_ngay0107=r["ngay0107"].ToString();
									//if(long.Parse(s_ngay0107)<50701 && s_madt =="1" && dr[i]["maphu"].ToString()=="1"){s_madt="99";s_dtuong="BHYT ( < 01/07/2005)";}
									//
									updrec_ravien_ndot(ds,dr[i]["mabn"].ToString(),long.Parse(dr[i]["maql"].ToString()),long.Parse(dr[i]["idkhoa"].ToString()),dr[i]["hoten"].ToString(),dr[i]["namsinh"].ToString(),dr[i]["phai"].ToString(),
										dr[i]["diachi"].ToString(),int.Parse(s_madt),s_dtuong,dr[i]["sothe"].ToString(),int.Parse(dr[i]["maphu"].ToString()),dr[i]["denngay"].ToString(),dr[i]["noigioithieu"].ToString(),dr[i]["noicap"].ToString(),
										dr[i]["giuong"].ToString(),r["makp"].ToString(),s_tenkp,dr[i]["ngayvao"].ToString(),dr[i]["ngayra"].ToString(),dr[i]["chandoan"].ToString(),dr[i]["maicd"].ToString(),int.Parse(r2["sttnhom"].ToString()),
										r2["nhom"].ToString(),int.Parse(r2["sttnhombhyt"].ToString()),r2["nhombhyt"].ToString(),int.Parse(r["mabd"].ToString()),r2["ten"].ToString()+((r2["bhyt"].ToString()!="0" && r2["bhyt"].ToString()!="100" && dr[i]["madoituong"].ToString()=="1")?"(*)":""),r2["dvt"].ToString(),decimal.Parse(r["soluong"].ToString()),decimal.Parse(r["dongia"].ToString()),decimal.Parse(r["soluong"].ToString())*decimal.Parse(r["dongia"].ToString()),decimal.Parse(r["bhyt"].ToString()),tamung,decimal.Parse(r["bhytt0107"].ToString()),dr[i]["nguoinha"].ToString(),int.Parse(dr[i]["hinhthuc"].ToString()),int.Parse(dr[i]["phuongphap"].ToString()),int.Parse(dr[i]["ketqua"].ToString()),dr[i]["soluutru"].ToString(),int.Parse(dr[i]["traituyen"].ToString()));
									if (dr[i]["done"].ToString()=="0")
									{
										upd_thvpct(yy,idvienphi,r["ngay"].ToString(),r["makp"].ToString(),int.Parse(s_madt),long.Parse(r["mabd"].ToString()),decimal.Parse(r["soluong"].ToString()),decimal.Parse(r["dongia"].ToString()),decimal.Parse(r["sotien"].ToString()),0,dr[i]["sothe"].ToString());
										sotien+=decimal.Parse(r["sotien"].ToString());
										bhyt+=decimal.Parse(r["bhyt"].ToString());
									}
								}
							}
						}
					}
					tmp=get_vienphi_ct_ndot(dr[i]["mabn"].ToString(),maql,idkhoa,idkhoa_sub,bLaydottruoc?get_prev_date(dr[i]["ngayvao"].ToString()):dr[i]["ngayvao"].ToString(),dr[i]["ngayra"].ToString(),asmakp,int.Parse(dr[i]["madoituong"].ToString()),int.Parse(dr[i]["done"].ToString()),bhyt_mien,maql_phuongluu,bLoctheonhapkhoa);
					if (tmp!=null)
					{
						foreach(DataRow r in tmp.Rows)
						{
							//Binh: lay ten kp
							DataRow rkp=getrowbyid(dtkp,"id="+r["makp"].ToString());
							string s_tenkp="";
							if(rkp!=null)s_tenkp=rkp["ten"].ToString();
							else s_tenkp=dr[i]["tenkp"].ToString();
							//
							r2=getrowbyid(dtvp,"id="+int.Parse(r["mavp"].ToString()));
							if (r2!=null)
							{
								string s_madt=dr[i]["madoituong"].ToString();
								string s_dtuong=dr[i]["doituong"].ToString();
								string s_ngay0107=r["ngay0107"].ToString();
								updrec_ravien_ndot(ds,dr[i]["mabn"].ToString(),long.Parse(dr[i]["maql"].ToString()),long.Parse(dr[i]["idkhoa"].ToString()),dr[i]["hoten"].ToString(),dr[i]["namsinh"].ToString(),dr[i]["phai"].ToString(),
									dr[i]["diachi"].ToString(),int.Parse(s_madt),s_dtuong,dr[i]["sothe"].ToString(),int.Parse(dr[i]["maphu"].ToString()),dr[i]["denngay"].ToString(),dr[i]["noigioithieu"].ToString(),dr[i]["noicap"].ToString(),
									dr[i]["giuong"].ToString(),r["makp"].ToString(),s_tenkp,dr[i]["ngayvao"].ToString(),dr[i]["ngayra"].ToString(),dr[i]["chandoan"].ToString(),dr[i]["maicd"].ToString(),int.Parse(r2["sttnhom"].ToString()),
									r2["nhom"].ToString(),int.Parse(r2["sttnhombhyt"].ToString()),r2["nhombhyt"].ToString(),int.Parse(r["mavp"].ToString()),r2["ten"].ToString()+((r2["chenhlech"].ToString()=="1" && s_madt=="1")?"(*)":""),r2["dvt"].ToString(),decimal.Parse(r["soluong"].ToString()),decimal.Parse(r["sotien"].ToString())/decimal.Parse(r["soluong"].ToString()),decimal.Parse(r["sotien"].ToString()),decimal.Parse(r["bhyt"].ToString()),tamung,decimal.Parse(r["bhytt0107"].ToString()),dr[i]["nguoinha"].ToString(),int.Parse(dr[i]["hinhthuc"].ToString()),int.Parse(dr[i]["phuongphap"].ToString()),int.Parse(dr[i]["ketqua"].ToString()),dr[i]["soluutru"].ToString(),int.Parse(dr[i]["traituyen"].ToString()));
								if (dr[i]["done"].ToString()=="0")
								{
									upd_thvpct(yy,idvienphi,r["ngay"].ToString(),r["makp"].ToString(),int.Parse(s_madt),long.Parse(r["mavp"].ToString()),decimal.Parse(r["soluong"].ToString()),System.Math.Round(decimal.Parse(r["sotien"].ToString())/decimal.Parse(r["soluong"].ToString())),decimal.Parse(r["sotien"].ToString()),decimal.Parse(r["vattu"].ToString()),dr[i]["sothe"].ToString());
									sotien+=decimal.Parse(r["sotien"].ToString());
									bhyt+=decimal.Parse(r["bhyt"].ToString());
								}
							}
						}
					}
					if (dr[i]["done"].ToString()=="0")
					{
						if (bDoituong_BHYT(dr[i]["madoituong"].ToString())) //if (dr[i]["madoituong"].ToString()=="1") //bhyt
						{
							if (dr[i]["maphu"].ToString()=="0") // Ko cung chi tra
							{
								bhyt=sotien;sotien=0;
							}
							else sotien=sotien-bhyt;
						}
						else if (mien_doituong(int.Parse(dr[i]["madoituong"].ToString()),dtdt)) //mien
						{
							mien=sotien;sotien=0;bhyt=0;
						}
						else bhyt=0;
						if (dr[i]["sothe"].ToString()!="" && bDoituong_BHYT(dr[i]["madoituong"].ToString())) upd_thvpbhyt(yy,idvienphi,dr[i]["sothe"].ToString().Trim(),int.Parse(dr[i]["maphu"].ToString()),get_manoigioithieu(maql),get_manoicap(maql),int.Parse(dr[i]["traituyen"].ToString()));//if (dr[i]["sothe"].ToString()!="" && dr[i]["madoituong"].ToString()=="1") upd_thvpbhyt(yy,idvienphi,dr[i]["sothe"].ToString().Trim(),int.Parse(dr[i]["maphu"].ToString()),get_manoigioithieu(maql),get_manoicap(maql),int.Parse(dr[i]["traituyen"].ToString()));
					}
				}
			}
			//ds.WriteXml(@"d:\dsravien_.xml",XmlWriteMode.WriteSchema);
			return sort_ttravien_ct_ndot(dtdt,ds.Tables[0].Select("true","mabn,madoituong,sttloai,sttnhom,makp,ten"));//,ten"));
		}

		private DataTable get_thuoc_ct_ndot(string mabn,long maql,long idkhoa,long idkhoa_sub,string tu,string den,string amakp,int madoituong,int done,string bhyt_mien,long maql_phuongluu,bool bLoctheonhapkhoa)
		{
			ds=new DataSet();
			
			DateTime dt1=StringToDate(tu).AddDays(-iNgaykiemke);
			DateTime dt2=StringToDate(den).AddDays(iNgaykiemke);
			int y1=dt1.Year,m1=dt1.Month;
			int y2=dt2.Year,m2=dt2.Month;
			int itu,iden,be=0;
			string mmyy="",xxx;
			for(int i=y1;i<=y2;i++)
			{
				itu=(i==y1)?m1:1;
				iden=(i==y2)?m2:12;
				for(int j=itu;j<=iden;j++)
				{
					mmyy=j.ToString().PadLeft(2,'0')+i.ToString().Substring(2,2);
					xxx=user+"d"+mmyy;
					if (dbMmyy(mmyy))
					{
						if (done==0)
						{
							//sql="select to_char(a.ngay,'yymmdd') ngay0107, to_char(a.ngay,'dd/mm/yyyy') ngay,d.makp,a.mabd,sum(a.soluong) soluong,sum(case when c.loai=0 then case when a.madoituong=1 then a.sotien else a.sotien end else case when a.madoituong=1 then a.soluong*a.giaban else a.soluong*a.giaban end end) sotien,";
							sql="select to_char(a.ngay,'yymmdd') ngay0107, to_char(a.ngay,'dd/mm/yyyy') ngay,d.makp,a.mabd,sum(a.soluong) soluong,sum(case when c.loai=0 then case when a.madoituong=1 or y.bhyt=1 then a.soluong*a.giamua else a.soluong*a.giamua end else case when a.madoituong=1 or y.bhyt=1 then a.soluong*a.giaban else a.soluong*a.giaban end end) sotien,";
							sql+="case when c.loai=0 then a.giamua else a.giaban end as dongia,";
							sql+="sum(case when c.loai=0 then ";
							//sql+="case when a.madoituong=1 then a.sotien*decode(bhyt,50,50,80)/100 else 0 end ";
							//sql+="else case when a.madoituong=1 then a.soluong*a.giaban*decode(bhyt,50,50,80)/100 else 0 end  end) bhytt0107,";
							sql+="case when a.madoituong=1 or y.bhyt=1 then a.sotien else 0 end ";
							sql+="else case when a.madoituong=1 or y.bhyt=1 then a.soluong*a.giaban else 0 end  end) bhytt0107,";
							sql+="sum(case when c.loai=0 then ";
							sql+="case when a.madoituong=1 or y.bhyt=1 then a.sotien*bhyt/100 else 0 end ";
							sql+="else case when a.madoituong=1 or y.bhyt=1 then a.soluong*a.giaban*bhyt/100 else 0 end  end) bhyt";
							sql+=" from "+xxx+".d_tienthuoc a,"+userid+".d_dmbd b,"+userid+".d_doituong c,"+user+".d_duockp d, "+user+".doituong y where a.mabd=b.id and a.madoituong=c.madoituong and a.madoituong=y.madoituong and a.makp=d.id and a.mabn='"+mabn+"'";
							//nguyen
							if (maql!=0) sql+=" and a.maql="+maql;
							sql+=" and to_char(a.ngay,'yyyymmdd') between '"+tu.Substring(6,4)+tu.Substring(3,2)+tu.Substring(0,2)+"' and '"+den.Substring(6,4)+den.Substring(3,2)+den.Substring(0,2)+"'";
							sql+=" and a.madoituong="+madoituong;
							if(bLoctheonhapkhoa) sql+=" and ((a.idkhoa>="+idkhoa+(idkhoa_sub>0?" and a.idkhoa<"+idkhoa_sub:"")+") or a.idkhoa=0)";
							//
							if (done!=2) sql+=" and a.done="+done;
							else sql+=" and a.done=0";
							//nguyen
							if (amakp!="") sql+=" and a.makp in ("+amakp+")";
							//
							sql+=" group by to_char(a.ngay,'dd/mm/yyyy'),d.makp,a.mabd, to_char(a.ngay,'yymmdd'),case when c.loai=0 then a.giamua else a.giaban end";
							if (be==0) ds=get_data(sql);
							else ds.Merge(get_data(sql));							
							be++;
							if (maql_phuongluu!=0)
							{
								sql="select to_char(a.ngay,'yymmdd') ngay0107, to_char(a.ngay,'dd/mm/yyyy') ngay,d.makp,a.mabd,sum(a.soluong) soluong,sum(case when c.loai=0 then case when a.madoituong=1 or y.bhyt=1 then a.sotien else a.sotien end else case when a.madoituong=1 or y.bhyt=1 then a.soluong*(a.giaban) else a.soluong*a.giaban end end) sotien,";
								sql+="case when c.loai=0 then a.giamua else a.giaban end as dongia,";
								sql+="sum(case when c.loai=0 then ";
								sql+="case when a.madoituong=1 or y.bhyt=1 then a.sotien else 0 end ";
								sql+="else case when a.madoituong=1 or y.bhyt=1  then a.soluong*a.giaban else 0 end  end) bhytt0107,";
								sql+="sum(case when c.loai=0 then ";
								sql+="case when a.madoituong=1 or y.bhyt=1 then a.sotien*bhyt/100 else 0 end ";
								sql+="else case when a.madoituong=1 or y.bhyt=1 then a.soluong*a.giaban*bhyt/100 else 0 end  end) bhyt";
								sql+=" from "+xxx+".d_tienthuoc a,"+userid+".d_dmbd b,"+userid+".d_doituong c,"+user+".d_duockp d,"+user+".doituong y   where a.mabd=b.id and a.madoituong=c.madoituong and a.mdoituong=y.madoituong and a.makp=d.id and a.mabn='"+mabn+"'";
								sql+=" and a.maql="+maql_phuongluu;
								sql+=" and a.madoituong="+madoituong;
								if (done!=2) sql+=" and a.done="+done;
								else sql+=" and a.done=0";
								sql+=" group by to_char(a.ngay,'dd/mm/yyyy'),d.makp,a.mabd, to_char(a.ngay,'yymmdd'),case when c.loai=0 then a.giamua else a.giaban end";
								ds.Merge(get_data(sql));							
							}
						}
						else
						{
							sql="select a.mabd,a.makp,to_char(a.ngay,'yymmdd') ngay0107,sum(a.soluong) soluong,sum(case when c.loai=0 then case when a.madoituong=1 or y.bhyt=1 then a.sotien else a.sotien end else case when a.madoituong=1 or y.bhyt=1 then a.soluong*(a.giaban) else a.soluong*a.giaban end end) sotien,";
							sql+="case when c.loai=0 then a.giamua else a.giaban end as dongia,";
							sql+="sum(case when c.loai=0 then ";
							sql+="case when a.madoituong=1 or y.bhyt=1  then a.sotien else 0 end ";
							sql+="else case when a.madoituong=1 or y.bhyt=1 then a.soluong*a.giaban else 0 end  end) bhytt0107,";
							sql+="sum(case when c.loai=0 then ";
							sql+="case when a.madoituong=1 or y.bhyt=1 then a.sotien*b.bhyt/100 else 0 end ";
							sql+="else case when a.madoituong=1 or y.bhyt=1 then a.soluong*a.giaban*b.bhyt/100 else 0 end  end) bhyt";
							sql+=" from "+xxx+".d_tienthuoc a,"+userid+".d_dmbd b,"+userid+".d_doituong c, "+userid+".doituong y where a.mabd=b.id and a.madoituong=c.madoituong and a.madoituong=y.madoituong and a.mabn='"+mabn+"'";
							if (maql!=0) sql+=" and a.maql="+maql;
							sql+=" and to_char(a.ngay,'yyyymmdd') between '"+tu.Substring(6,4)+tu.Substring(3,2)+tu.Substring(0,2)+"' and '"+den.Substring(6,4)+den.Substring(3,2)+den.Substring(0,2)+"'";
							sql+=" and a.madoituong="+madoituong;
							if(bLoctheonhapkhoa) sql+=" and ((a.idkhoa>="+idkhoa+(idkhoa_sub>0?" and a.idkhoa<"+idkhoa_sub:"")+") or a.idkhoa=0)";
							if (done!=2) sql+=" and a.done="+done;
							else sql+=" and a.done=0";
							if (amakp!="") sql+=" and a.makp in ("+amakp+")";
							sql+=" group by a.makp, a.mabd,a.ngay,c.loai,a.giamua,a.giaban ";
							if (be==0) ds=get_data(sql);
							else ds.Merge(get_data(sql));
							be++;
							if (maql_phuongluu!=0)
							{
								sql="select a.mabd,a.makp,to_char(a.ngay,'yymmdd') ngay0107,sum(a.soluong) soluong,sum(case when c.loai=0 then case when a.madoituong=1 or y.bhyt=1 then a.sotien else a.sotien end else case when a.madoituong=1 or y.bhyt=1 then a.soluong*(a.giaban) else a.soluong*a.giaban end end) sotien,";
								sql+="case when c.loai=0 then a.giamua else a.giaban end as dongia,";
								sql+="sum(case when c.loai=0 then ";
								sql+="case when a.madoituong=1 or y.bhyt=1 then a.sotien else 0 end ";
								sql+="else case when a.madoituong=1 or y.bhyt=1 then a.soluong*a.giaban else 0 end  end) bhytt0107,";
								sql+="sum(case when c.loai=0 then ";
								sql+="case when a.madoituong=1 or y.bhyt=1 then a.sotien*bhyt/100 else 0 end ";
								sql+="else case when a.madoituong=1 or y.bhyt=1 then a.soluong*a.giaban*bhyt/100 else 0 end  end) bhyt";
								sql+=" from "+xxx+".d_tienthuoc a,"+userid+".d_dmbd b,"+userid+".d_doituong c,"+userid+".doituong y where a.mabd=b.id and a.madoituong=c.madoituong and a.madoituong=y.madoituong and a.mabn='"+mabn+"'";
								sql+=" and a.maql="+maql_phuongluu;
								sql+=" and a.madoituong="+madoituong;
								if (done!=2) sql+=" and a.done="+done;
								else sql+=" and a.done=0";
								sql+=" group by a.makp, a.mabd,to_char(a.ngay,'yymmdd'),case when c.loai=0 then a.giamua else a.giaban end ";
								ds.Merge(get_data(sql));
							}
						}
					}
				}
			}
			return (be==0)?null:ds.Tables[0];
		}
		private DataRow get_tylebhyt(long mabd,string ngay,DataTable dtdmbd)
		{
			sql="id="+mabd+" and ngayud>"+ngay+" and luu=1";
			DataRow[] dr=dtdmbd.Select(sql,"ngayud desc");
			if (dr.Length>0)
			{				
				return dr[0];
			}
			else
			{
				sql="id="+mabd+" and luu=0";
				dr=dtdmbd.Select(sql,"ngayud desc");
				if(dr.Length>0) return dr[0];
			}
			return null;
		}

		private DataTable get_vienphi_ct_ndot(string mabn,long maql,long idkhoa,long idkhoa_sub,string tu,string den,string amakp,int madoituong,int done,string bhyt_mien,long maql_phuongluu,bool bLoctheonhapkhoa)
		{
			ds=new DataSet();
			
			int yy1=int.Parse(tu.Substring(8,2)),yy2=int.Parse(den.Substring(8,2));
			int be=0;
			DateTime dt1=StringToDate(tu).AddDays(-iNgaykiemke);
			DateTime dt2=StringToDate(den).AddDays(iNgaykiemke);
			int y1=dt1.Year,m1=dt1.Month;
			int y2=dt2.Year,m2=dt2.Month;
			int itu,iden;
			string mmyy="",xxx;
			for(int i=y1;i<=y2;i++)
			{
				itu=(i==y1)?m1:1;
				iden=(i==y2)?m2:12;
				for(int j=itu;j<=iden;j++)
				{
					mmyy=j.ToString().PadLeft(2,'0')+i.ToString().Substring(2,2);
					xxx=user+mmyy;
					if (bMmyy(mmyy))
					{
						if (done==0)
						{
							sql="select  to_char(ngay,'yymmdd') ngay0107, to_char(a.ngay,'dd/mm/yyyy') ngay,a.makp,a.mavp,sum(a.soluong) soluong,sum(a.soluong*(a.dongia+a.vattu)) sotien, ";
							sql+="sum(case when a.madoituong=1 or y.bhyt=1 then a.soluong*(a.dongia+a.vattu)*80/100 else 0 end ) bhytt0107,";
							sql+="sum(case when a.madoituong=1 or y.bhyt=1  then a.soluong*(a.dongia+a.vattu) else 0 end ) bhyt,";
							sql+="sum(a.soluong*a.vattu) vattu, b.id_loai from "+xxx+".v_vpkhoa a ,"+userid+".v_giavp b, "+userid+".doituong y where a.mavp=b.id andd a.madoituong=y.madoituong and a.mabn='"+mabn+"'";
							if (maql!=0) sql+=" and a.maql="+maql;
							sql+=" and to_char(a.ngay,'yyyymmdd') between '"+tu.Substring(6,4)+tu.Substring(3,2)+tu.Substring(0,2)+"' and '"+den.Substring(6,4)+den.Substring(3,2)+den.Substring(0,2)+"'";
							sql+=" and a.madoituong="+madoituong;
							if(bLoctheonhapkhoa) sql+=" and ((a.idkhoa>="+idkhoa+(idkhoa_sub>0?" and a.idkhoa<"+idkhoa_sub:"")+") or a.idkhoa=0)";
							if (amakp!="") sql+=" and a.makp in ("+amakp+")";
							if (done!=2) sql+=" and a.done="+done;
							else sql+=" and a.done=0";
							sql+=" group by to_char(a.ngay,'dd/mm/yyyy'),a.makp,a.mavp,b.id_loai,  to_char(a.ngay,'yymmdd')";
							sql+=" order by b.id_loai,a.makp,a.mavp, to_char(a.ngay,'yymmdd')";
							if (be==0) ds=get_data(sql);
							else ds.Merge(get_data(sql));
							be++;
							if (maql_phuongluu!=0)
							{
								sql="select  to_char(ngay,'yymmdd') ngay0107, to_char(a.ngay,'dd/mm/yyyy') ngay,a.makp,a.mavp,sum(a.soluong) soluong,sum(a.soluong*(a.dongia+a.vattu)) sotien, ";
								sql+="sum(case when a.madoituong=1 or y.bhyt=1 then a.soluong*(a.dongia+a.vattu)*80/100 else 0 end ) bhytt0107,";
								sql+="sum(case when a.madoituong=1 or y.bhyt=1 then a.soluong*(a.dongia+a.vattu) else 0 end ) bhyt,";
								sql+="sum(a.soluong*a.vattu) vattu, b.id_loai from "+xxx+".v_vpkhoa a,"+userid+".v_giavp b,"+userid+".doituong y where a.mavp=b.id and a.mdoituong=y.madoituong and a.mabn='"+mabn+"'";
								sql+=" and a.maql="+maql_phuongluu;
								sql+=" and a.madoituong="+madoituong;
								if (done!=2) sql+=" and a.done="+done;
								else sql+=" and a.done=0";
								sql+=" group by to_char(a.ngay,'dd/mm/yyyy'),a.makp,a.mavp,b.id_loai,  to_char(a.ngay,'yymmdd')";
								sql+=" order by b.id_loai,a.makp,a.mavp, to_char(a.ngay,'yymmdd')";
								ds.Merge(get_data(sql));
							}
						}
						else
						{
							sql="select to_char(a.ngay,'yymmdd') ngay0107, a.mavp,a.makp,sum(a.soluong) soluong,sum(a.soluong*(a.dongia+a.vattu)) sotien,";
							sql+="sum(case when a.madoituong=1 or y.bhyt=1 then a.soluong*(a.dongia+a.vattu)*80/100 else 0 end ) bhytt0107,";
							sql+="sum(case when a.madoituong=1 or y.bhyt=1 then a.soluong*(a.dongia+a.vattu) else 0 end ) bhyt, b.id_loai ";
							sql+="from "+xxx+".v_vpkhoa a,"+userid+".v_giavp b, "+userid+".doituong y where a.mavp=b.id and a.madoituong=y.madoituong and a.mabn='"+mabn+"'";
							if (maql!=0) sql+=" and a.maql="+maql;
							sql+=" and to_char(a.ngay,'yyyymmdd') between '"+tu.Substring(6,4)+tu.Substring(3,2)+tu.Substring(0,2)+"' and '"+den.Substring(6,4)+den.Substring(3,2)+den.Substring(0,2)+"'";
							sql+=" and a.madoituong="+madoituong;
							if(bLoctheonhapkhoa) sql+=" and ((a.idkhoa>="+idkhoa+(idkhoa_sub>0?" and a.idkhoa<"+idkhoa_sub:"")+") or a.idkhoa=0)";
							if (amakp!="") sql+=" and a.makp in ("+amakp+")";
							if (done!=2) sql+=" and a.done="+done;
							else sql+=" and a.done=0";
							sql+=" group by mavp, b.id_loai,a.makp, a.ngay";
							sql+=" order by b.id_loai,a.makp,a.mavp,a.ngay";
							if (be==0) ds=get_data(sql);
							else ds.Merge(get_data(sql));
							be++;
							if (maql_phuongluu!=0)
							{
								sql="select to_char(ngay,'yymmdd') ngay0107, a.mavp,a.makp,sum(a.soluong) soluong,sum(a.soluong*(a.dongia+a.vattu)) sotien,";
								sql+="sum(case when a.madoituong=1 or y.bhyt=1 then a.soluong*(a.dongia+a.vattu)*80/100 else 0 end ) bhytt0107,";
								sql+="sum(case when a.madoituong=1 or y.bhyt=1 then a.soluong*(a.dongia+a.vattu) else 0 end ) bhyt, b.id_loai ";
								sql+="from "+xxx+".v_vpkhoa a,"+userid+".v_giavp b,"+userid+".doituong y  where a.mavp=b.id and a.madoituong=y.madoituong and a.mabn='"+mabn+"'";
								sql+=" and a.maql="+maql_phuongluu;
								sql+=" and a.madoituong="+madoituong;
								if (done!=2) sql+=" and a.done="+done;
								else sql+=" and a.done=0";
								sql+=" group by mavp, b.id_loai,a.makp, to_char(ngay,'yymmdd')";
								sql+=" order by b.id_loai,a.makp,a.mavp, to_char(ngay,'yymmdd')";
								ds.Merge(get_data(sql));
							}
						}
					}
				}
			}
			return (be==0)?null:ds.Tables[0];
		}

		private decimal get_tamung_ct_ndot(string mabn,long maql,long idkhoa,string tu,string den,string amakp,int madoituong,int done,long maql_phuongluu)
		{
			decimal ret=0;
			
			DateTime dt1=StringToDate(tu).AddDays(-iNgaykiemke);
			DateTime dt2=StringToDate(den).AddDays(iNgaykiemke);
			int y1=dt1.Year,m1=dt1.Month;
			int y2=dt2.Year,m2=dt2.Month;
			int itu,iden;
			string mmyy="",xxx;
			for(int i=y1;i<=y2;i++)
			{
				itu=(i==y1)?m1:1;
				iden=(i==y2)?m2:12;
				for(int j=itu;j<=iden;j++)
				{
					mmyy=j.ToString().PadLeft(2,'0')+i.ToString().Substring(2,2);
					xxx=user+mmyy;
					if (bMmyy(mmyy))
					{
						//sql="select sum(sotien) sotien  from v_tamung where mabn='"+mabn+"'";
						//Binh sua lai de lay ca so bien lai tam ung
						sql="select sum(a.sotien) sotien, a.quyenso, a.sobienlai, b.sohieu  from "+xxx+".v_tamung a, "+user+".v_quyenso b where a.quyenso=b.id and a.mabn='"+mabn+"'";
						if (maql!=0) sql+=" and a.maql="+maql;
						sql+=" and to_char(a.ngay,'yyyymmdd') between '"+tu.Substring(6,4)+tu.Substring(3,2)+tu.Substring(0,2)+"' and '"+den.Substring(6,4)+den.Substring(3,2)+den.Substring(0,2)+"'";
						sql+=" and madoituong="+madoituong;
						if (amakp!="") sql+=" and a.makp in ("+amakp+")";
						if (done!=2) sql+=" and a.done="+done;
						else sql+=" and a.done=0";					
						sql+=" group by a.quyenso, b.sohieu, a.sobienlai";
						ds=get_data(sql);					
						foreach(DataRow r in ds.Tables[0].Rows)
						{
							ret+=decimal.Parse(r["sotien"].ToString());
							b_sobienlaitamung+=r["sohieu"].ToString().Trim()+"-"+r["sobienlai"].ToString().Trim()+":"+r["sotien"].ToString().Trim()+";";
						}
						if (maql_phuongluu!=0)
						{
							sql="select sum(a.sotien) sotien, a.quyenso, a.sobienlai, b.sohieu  from "+xxx+".v_tamung a, "+user+".v_quyenso b where a.quyenso=b.id and a.mabn='"+mabn+"'";
							sql+=" and a.maql="+maql_phuongluu;
							sql+=" and madoituong="+madoituong;
							if (done!=2) sql+=" and a.done="+done;
							else sql+=" and a.done=0";					
							sql+=" group by a.quyenso, b.sohieu, a.sobienlai";
							ds=get_data(sql);					
							foreach(DataRow r in ds.Tables[0].Rows)
							{
								ret+=decimal.Parse(r["sotien"].ToString());
								b_sobienlaitamung+=r["sohieu"].ToString().Trim()+"-"+r["sobienlai"].ToString().Trim()+":"+r["sotien"].ToString().Trim()+";";
							}
						}
					}
				}
			}
			return ret;
		}
		public bool get_thvpll(string tungay,string denngay,long maql)
		{
			string mmyy=denngay.Substring(3,2)+denngay.Substring(8,2);
			DataSet ds=get_data("select done from "+user+mmyy+".v_thvpll where maql="+maql+" and to_char(ngayvao,'dd/mm/yyyy')='"+tungay.Substring(0,10)+"' and to_char(ngayra,'dd/mm/yyyy')='"+denngay.Substring(0,10)+"'");
			if(ds.Tables[0].Rows.Count>0)
			{
				return ds.Tables[0].Rows[0][0].ToString()=="1";
			}
			return false;
		}
		public void updrec_ravien_ndot(DataSet ds,string mabn,long maql,long idkhoa,string hoten,string namsinh,string phai,string diachi,int madoituong,string doituong,string sothe,int maphu,
			string denngay,string noigioithieu,string noicap,string giuong,string makp,string tenkp,string ngayvao,string ngayra,string chandoan,string maicd,int sttnhom,string nhom,
			int sttloai,string loai,int ma,string ten,string dvt,decimal soluong,decimal dongia,decimal sotien,decimal bhyt,decimal tamung,
			decimal bhytt0107,string nguoinha,int hinhthuc,int phuongphap,int ketqua,string soluutru,int traituyen)
		{
			if(soluong==0) return;
			string exp="mabn='"+mabn+"'"+" and madoituong="+madoituong+" and makp="+makp+" and ma="+ma;
			DataRow r = getrowbyid (ds.Tables[0],exp); 
			if(r != null)
			{
				exp="mabn='"+mabn+"'"+" and madoituong="+madoituong+" and makp="+makp+" and ma="+ma+" and dongia="+dongia;
				r = getrowbyid (ds.Tables[0],exp); 
			}
			if ( r == null )
			{
				DataRow r1 = ds.Tables[0].NewRow();
				r1["mabn"]=mabn;
				r1["maql"]=maql;
				r1["idkhoa"]=idkhoa;
				r1["hoten"]=hoten;
				r1["namsinh"]=namsinh;
				r1["phai"]=phai;
				r1["diachi"]=diachi;
				r1["madoituong"]=madoituong;
				r1["doituong"]=doituong;
				r1["sothe"]=sothe;
				r1["maphu"]=maphu;
				r1["denngay"]=denngay;
				r1["noigioithieu"]=noigioithieu;
				r1["noicap"]=noicap;
				r1["giuong"]=giuong;
				r1["makp"]=makp;
				r1["tenkp"]=tenkp;
				r1["ngayvao"]=ngayvao;
				r1["ngayra"]=ngayra;
				r1["chandoan"]=chandoan;
				r1["maicd"]=maicd;
				r1["sttnhom"]=sttnhom;
				r1["nhom"]=nhom;
				r1["sttloai"]=sttloai;
				r1["loai"]=loai;
				r1["ma"]=ma;
				r1["ten"]=ten;
				r1["dvt"]=dvt;
				r1["soluong"]=soluong;
				r1["dongia"]=dongia;
				r1["sotien"]=sotien;
				r1["bhyt"]=bhyt;
				r1["bhytt0107"]=bhytt0107;
				r1["tamung"]=tamung;
				r1["tcsotien"]=0;
				r1["dichso"]="";
				r1["bhyttra"]=0;
				r1["mien"]=0;
				r1["bntra"]=0;
				r1["dichsotra"]="";
				r1["nguoinha"]=nguoinha;
				r1["hinhthuc"]=hinhthuc;
				r1["phuongphap"]=phuongphap;
				r1["ketqua"]=ketqua;
				r1["soluutru"]=soluutru;
				r1["traituyen"]=traituyen;
				ds.Tables[0].Rows.Add (r1) ;
			}
			else
			{
				DataRow[] dr = ds.Tables[0].Select(exp);
				if (dr.Length>0)
				{
					dr[0]["soluong"]=decimal.Parse(dr[0]["soluong"].ToString())+soluong;
					dr[0]["sotien"]=decimal.Parse(dr[0]["sotien"].ToString())+sotien;
					dr[0]["bhyt"]=decimal.Parse(dr[0]["bhyt"].ToString())+bhyt;
					dr[0]["bhytt0107"]=decimal.Parse(dr[0]["bhytt0107"].ToString())+bhytt0107;
					if(dr[0]["soluong"].ToString()=="0") dr[0].Delete();
				}
			}
		}

		public string bHiendien(string m_mabn)
		{
			try
			{
				return get_data("select trim(b.tenkp)||' '||to_char(a.ngay,'dd/mm/yyyy hh24:mi') from hiendien a,btdkp_bv b,benhandt c where a.makp=b.makp and a.maql=c.maql and a.nhapkhoa=1 and a.xuatkhoa=0 and a.mabn='"+m_mabn+"'").Tables[0].Rows[0][0].ToString();
			}
			catch{return "";}
		}

		public string bNhapvien(string m_mabn)
		{
			try
			{
				return get_data("select trim(b.tenkp)||' '||to_char(a.ngay,'dd/mm/yyyy hh24:mi') from benhandt a,btdkp_bv b where a.makp=b.makp and a.maql not in (select maql from xuatvien) and a.mabn='"+m_mabn+"'").Tables[0].Rows[0][0].ToString();
			}
			catch{return "";}
		}
		public long MaqlNhapvien(string m_mabn,int m_loaiba)
		{
			try
			{
				return long.Parse(get_data("select maql from benhandt a,btdkp_bv b where a.makp=b.makp and a.maql not in (select maql from xuatvien) and a.mabn='"+m_mabn+"' and loaiba="+m_loaiba).Tables[0].Rows[0][0].ToString());
			}
			catch{return 0;}
		}
		public DataRow get_kiemtra_thebhyt(DataSet ds,string mathe)
		{
			try
			{
				string sql="";
				if(mathe.Length==13) sql="chieudai=13";else	sql="chieudai=16";
				foreach(DataRow r in ds.Tables[0].Select(sql+" and apdung=1"))
				{
					if(r["mathe"].ToString().IndexOf(mathe.Substring(int.Parse(r["tu"].ToString()),int.Parse(r["den"].ToString())))>=0 && r["madv"].ToString()!="")
					{
						return r;
					}
				}
				return null;
			}
			catch{return null;}
		}
		public int iNgaysuavpkhoa
		{
			get
			{
				try
				{
					return int.Parse(get_data("select ten from thongso where id=300").Tables[0].Rows[0][0].ToString());
				}
				catch{return 1;}
			}
		}
		public bool bBenhNhanNamLuuSuDungThuocTuTrucCacKhoa
		{
			get
			{
				try
				{
					return get_data("select ten from thongso where id=301").Tables[0].Rows[0][0].ToString()=="1";
				}
				catch{return false;}
			}
		}
		public bool bPhongmoKhongnhapkhoa
		{
			get
			{
				try
				{
					return get_data("select ten from thongso where id=302").Tables[0].Rows[0][0].ToString()=="1";
				}
				catch{return false;}
			}
		}
		public bool bPhongmoLenlichmo
		{
			get
			{
				try
				{
					return get_data("select ten from thongso where id=303").Tables[0].Rows[0][0].ToString()=="1";
				}
				catch{return false;}
			}
		}
		public bool bLocchiphitheolannhapkhoa
		{
			get
			{
				try
				{
					return get_data("select ten from thongso where id=304").Tables[0].Rows[0][0].ToString()=="1";
				}
				catch{return false;}
			}
		}
		public bool bChuyenhtdt
		{
			get
			{
				try
				{
					return get_data("select ten from thongso where id=305").Tables[0].Rows[0][0].ToString()=="1";
				}
				catch{return false;}
			}
		}
		public bool bLaytatcadoituong
		{
			get
			{
				try
				{
					return get_data("select ten from thongso where id=306").Tables[0].Rows[0][0].ToString()=="1";
				}
				catch{return false;}
			}
		}
		public bool upd_dmgoi(decimal m_id,decimal m_stt,string m_ten)
		{
			con=new OracleConnection(sConn);
			con.Open();
			cmd=new OracleCommand("update d_dmgoi set stt="+m_stt+",ten=:m_ten where id="+m_id,con);
			try
			{
				cmd.Parameters.Add("m_ten",OracleType.NVarChar,100).Value=m_ten;
				if(cmd.ExecuteNonQuery()==0)
				{
					cmd.CommandText="insert into d_dmgoi values ("+m_id+","+m_stt+",:m_ten) ";
					cmd.ExecuteNonQuery();
				}
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,System.Environment.MachineName,"d_dmgoi");
				con.Dispose();
				cmd.Dispose();
				return false;
			}
			finally
			{
				con.Dispose();
				cmd.Dispose();
			}
			return true;
		}
		public string get_doituong_ndot(string mabn,long maql,long idkhoa,string tu,string den,string makp,DataTable dtkp,int done,bool bVienphi_phongluu)
		{
			string ret="";
			int i_makp=0,be=0;
			DataRow r1;
			DateTime dt1=StringToDate(tu).AddDays(-iNgaykiemke);
			DateTime dt2=StringToDate(den).AddDays(iNgaykiemke);
			int y1=dt1.Year,m1=dt1.Month;
			int y2=dt2.Year,m2=dt2.Month;
			int itu,iden;
			string mmyy="",xxx;
			long maql_phongluu=(bVienphi_phongluu)?get_maql_phongluu(maql):0;
			for(int i=y1;i<=y2;i++)
			{
				itu=(i==y1)?m1:1;
				iden=(i==y2)?m2:12;
				for(int j=itu;j<=iden;j++)
				{
					mmyy=j.ToString().PadLeft(2,'0')+i.ToString().Substring(2,2);
					xxx=user+"d"+mmyy;
					if (dbMmyy(mmyy))
					{
						r1=getrowbyid(dtkp,"makp='"+makp+"'");
						if (r1!=null) i_makp=int.Parse(r1["id"].ToString());
						sql="select distinct madoituong from "+xxx+".d_tienthuoc ";
						sql+=" where mabn='"+mabn+"'";
						if (maql!=0) sql+=" and maql="+maql;
						sql+=" and to_char(ngay,'yyyymmdd') between '"+tu.Substring(6,4)+tu.Substring(3,2)+tu.Substring(0,2)+"' and '"+den.Substring(6,4)+den.Substring(3,2)+den.Substring(0,2)+"'";
						if (done!=2) sql+=" and done="+done;
						if (be==0) ds=get_data(sql);
						else merge(ds,get_data(sql));// ds.Merge(get_data(sql));
						be++;
						if (maql_phongluu!=0)
						{
							sql="select distinct madoituong from "+xxx+".d_tienthuoc ";
							sql+=" where mabn='"+mabn+"'";
							sql+=" and maql="+maql_phongluu;
							if (done!=2) sql+=" and done="+done;
							merge(ds,get_data(sql));// ds.Merge(get_data(sql));
						}
					}
					xxx=user+mmyy;
					if (bMmyy(mmyy))
					{
						r1=getrowbyid(dtkp,"makp='"+makp+"'");
						if (r1!=null) i_makp=int.Parse(r1["id"].ToString());
						sql="select distinct madoituong from "+xxx+".v_vpkhoa ";
						sql+=" where mabn='"+mabn+"'";
						if (maql!=0) sql+=" and maql="+maql;
						sql+=" and to_char(ngay,'yyyymmdd') between '"+tu.Substring(6,4)+tu.Substring(3,2)+tu.Substring(0,2)+"' and '"+den.Substring(6,4)+den.Substring(3,2)+den.Substring(0,2)+"'";
						if (done!=2) sql+=" and done="+done;
						if (be==0) ds=get_data(sql);
						else merge(ds,get_data(sql));// ds.Merge(get_data(sql));
						be++;
						if (maql_phongluu!=0)
						{
							sql="select distinct madoituong from "+xxx+".v_vpkhoa ";
							sql+=" where mabn='"+mabn+"'";
							sql+=" and maql="+maql_phongluu;
							if (done!=2) sql+=" and done="+done;
							merge(ds,get_data(sql));// ds.Merge(get_data(sql));
						}
					}
				}
			}
			ds.AcceptChanges();
			if (ds.Tables[0].Rows.Count>0)
				foreach(DataRow r in ds.Tables[0].Rows) ret+=r["madoituong"].ToString().Trim()+",";
			return ret;
		}
		public long get_id_thvp(string mmyy,string mabn,long maql,long idkhoa,string ngayvao,string ngayra)
		{
			if (bMmyy(mmyy))
			{
				sql="select id from "+user+mmyy+".v_thvpll where mabn='"+mabn+"' and to_char(ngayvao,'dd/mm/yyyy hh24:mi')='"+ngayvao+"'";
				sql+=" and to_char(ngayra,'dd/mm/yyyy hh24:mi')='"+ngayra+"'";
				if (idkhoa!=0) sql+=" and idkhoa="+idkhoa;
				else sql+=" and maql="+maql;
				ds=get_data(sql);
				if (ds.Tables[0].Rows.Count>0) return long.Parse(ds.Tables[0].Rows[0]["id"].ToString());
				else return 0;
			}
			return 0;
		}
		public DataSet sort_ttravien_ct_ndot(DataTable dtdt,DataRow [] dr)
		{
			DataSet dsxml=new DataSet();
			dsxml.ReadXml("..\\..\\..\\xml\\m_inravien.xml");
			dsxml.Tables[0].Columns.Add("traituyen",typeof(decimal));
			dsxml.Tables[0].Columns.Add("tbh", typeof(decimal));
			dsxml.Tables[0].Columns.Add("tbn", typeof(decimal));
			dsxml.Tables[0].Columns.Add("tltraituyen", typeof(decimal));
			dsxml.Tables[0].Columns.Add("dbh", typeof(decimal));
			dsxml.Tables[0].Columns.Add("dbn", typeof(decimal));
			dsxml.Tables[0].Columns.Add("tlchitra", typeof(decimal));
			dichso.numbertotext doiso=new dichso.numbertotext();		
			string ma="";int madt=0;
			decimal tcsotien=0,tcbhyt=0,tcbhytt0107=0,stbhyt=0,bnt=0,bht=0,tbh,tbn,st,chitra;
			int iTraituyen=iTraituyen_bhyt,maphu=0,nhom=nhom_duoc;
			bool btraituyen_bhtra=bTraituyen_bhtra;
			

			DataRow r;			
			for(int i=0;i<dr.Length;i++)
			{
				if (ma!=dr[i]["mabn"].ToString() || madt!=int.Parse(dr[i]["madoituong"].ToString()))
				{
					ma=dr[i]["mabn"].ToString();madt=int.Parse(dr[i]["madoituong"].ToString());
					stbhyt=tcsotien=tcbhyt=tcbhytt0107=0;
				}				

				tbh=tbn=0;
				tcsotien+=decimal.Parse(dr[i]["sotien"].ToString());
				tcbhyt+=decimal.Parse(dr[i]["bhyt"].ToString());
				tcbhytt0107+=decimal.Parse(dr[i]["bhytt0107"].ToString());
				//				if (dr[i]["madoituong"].ToString()=="1" && int.Parse(dr[i]["maphu"].ToString())!=100 && int.Parse(dr[i]["maphu"].ToString())>0) 
				//					stbhyt+=0;
				//				else
				stbhyt+=decimal.Parse(dr[i]["sotien"].ToString());

				
				r=dsxml.Tables[0].NewRow();
				r["bhyttra"]=0;
				r["bntra"]=0;
				r["mabn"]=ma;
				r["hoten"]=dr[i]["hoten"].ToString();
				r["maql"]=dr[i]["maql"].ToString();
				r["idkhoa"]=dr[i]["idkhoa"].ToString();
				r["namsinh"]=dr[i]["namsinh"].ToString();
				r["phai"]=dr[i]["phai"].ToString();
				r["diachi"]=dr[i]["diachi"].ToString();
				r["madoituong"]=dr[i]["madoituong"].ToString();
				r["doituong"]=dr[i]["doituong"].ToString();
				r["sothe"]=dr[i]["sothe"].ToString();
				r["maphu"]=dr[i]["maphu"].ToString();
				r["denngay"]=dr[i]["denngay"].ToString();
				r["noigioithieu"]=dr[i]["noigioithieu"].ToString();
				r["noicap"]=dr[i]["noicap"].ToString();
				r["giuong"]=dr[i]["giuong"].ToString();
				r["makp"]=dr[i]["makp"].ToString();
				r["tenkp"]=dr[i]["tenkp"].ToString();
				r["ngayvao"]=dr[i]["ngayvao"].ToString();
				r["ngayra"]=dr[i]["ngayra"].ToString();
				r["chandoan"]=dr[i]["chandoan"].ToString();
				r["maicd"]=dr[i]["maicd"].ToString();
				r["sttnhom"]=dr[i]["sttnhom"].ToString();
				r["nhom"]=dr[i]["nhom"].ToString();
				r["sttloai"]=dr[i]["sttloai"].ToString();
				r["loai"]=dr[i]["loai"].ToString();
				r["ma"]=dr[i]["ma"].ToString();
				r["ten"]=dr[i]["ten"].ToString();
				r["dvt"]=dr[i]["dvt"].ToString();
				r["soluutru"]=dr[i]["soluutru"].ToString();
				r["nguoinha"]=dr[i]["nguoinha"].ToString();
				r["hinhthuc"]=dr[i]["hinhthuc"].ToString();
				r["phuongphap"]=dr[i]["phuongphap"].ToString();
				r["ketqua"]=dr[i]["ketqua"].ToString();
				r["soluong"]=dr[i]["soluong"].ToString();
				r["sotien"]=dr[i]["sotien"].ToString();
				r["tamung"]=dr[i]["tamung"].ToString();
				r["tcsotien"]=tcsotien;
				r["dbh"] = r["dbn"] = r["tlchitra"] = 0;
				r["tltraituyen"] = iTraituyen;
				r["mien"]=0;//BINH: GAN=0 DE KHONG BI NULL THI REPORT KHONG BI LOI
				if (bDoituong_BHYT(dr[i]["madoituong"].ToString()) || dr[i]["madoituong"].ToString()=="99") //if (dr[i]["madoituong"].ToString()=="1" || dr[i]["madoituong"].ToString()=="99") //bhyt; 99 BHYT truoc 01/07/2005
				{
					/*
					if (dr[i]["maphu"].ToString()=="0") // Ko cung chi tra
					{
						r["bhyttra"]=tcsotien;
						r["bntra"]=0;
					}
					else
					{
						r["bntra"]=tcsotien-tcbhytt0107;
						r["bhyttra"]=tcbhytt0107;
					}*/
					if (int.Parse(dr[i]["traituyen"].ToString())!=0 && iTraituyen!=0 && !btraituyen_bhtra)
					{
						chitra=iTraituyen;
						r["bhyttra"]=stbhyt*chitra/100+bnt;
						r["bntra"]=stbhyt-(stbhyt*chitra/100)+bht;
					}
					else
					{
						maphu=(dr[i]["sothe"].ToString().Trim()!="")?get_maphu_noitru(dr[i]["sothe"].ToString(),nhom,dr[i]["ngayra"].ToString().Substring(0,10)):0;
						if (maphu==0)
						{
							r["bhyttra"]=tcsotien;
							r["bntra"]=0;
						}
						else
						{
							chitra=(maphu==1)?80:95;
							r["bhyttra"]=stbhyt*chitra/100+bnt;
							r["bntra"]=stbhyt-(stbhyt*chitra/100)+bht;
						}
						r["dbh"] = r["bhyttra"].ToString();
						r["dbn"] = r["bntra"].ToString();
						if (int.Parse(dr[i]["traituyen"].ToString()) != 0 && iTraituyen != 0)
						{                            
							st = decimal.Parse(r["bhyttra"].ToString());
							chitra = iTraituyen;
							tbh = st * chitra / 100;
							tbn = st - (st * chitra / 100);
							r["bhyttra"]= tbh;
							r["bntra"]=decimal.Parse(r["bntra"].ToString()) + tbn;
							r["tlchitra"] =  decimal.Parse(r["bhyttra"].ToString()) / stbhyt * 100;
						}
					}
					r["dichsotra"]=doiso.doithapphan(r["bntra"].ToString());
				}
				else if (mien_doituong(int.Parse(dr[i]["madoituong"].ToString()),dtdt)) //mien
				{
					r["mien"]=tcsotien;r["bntra"]=0;r["bhyttra"]=0;
					r["dichsotra"]=doiso.doithapphan(r["mien"].ToString());
				}
				else
				{
					r["bntra"]=tcsotien;r["bhyttra"]=0;
					r["dichsotra"]=doiso.doithapphan(r["bntra"].ToString());
				}
				r["dichso"]=doiso.doithapphan(r["tcsotien"].ToString());
				//
				r["sbltamung"]=b_sobienlaitamung;
				r["traituyen"]=dr[i]["traituyen"].ToString();
				r["tbh"] = tbh;
				r["tbn"] = tbn;
				//
				dsxml.Tables[0].Rows.Add(r);
			}
			
			return dsxml;
		}
		#endregion

		#region LICENSE
		private LinksLicense.LibLicense license = new LinksLicense.LibLicense();
		public bool upd_md_license(string v_computer_key, string v_license_key)
		{
			if(v_computer_key=="" || v_license_key=="") return false;
			sql="update license set license_key=:v_license_key where computer_key=:v_computer_key";
			con=new OracleConnection(sConn);
			cmd=new OracleCommand(sql,con);
			cmd.CommandType=CommandType.Text;

			cmd.Parameters.Add("v_computer_key",OracleType.NVarChar,255).Value=v_computer_key;
			cmd.Parameters.Add("v_license_key",OracleType.NVarChar,255).Value=v_license_key;

			try
			{
				con.Open();
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into license(computer_key,license_key,computer) values(:v_computer_key,:v_license_key,'"+sComputer+"')";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;

					cmd.Parameters.Add("v_computer_key",OracleType.NVarChar,255).Value=v_computer_key;
					cmd.Parameters.Add("v_license_key",OracleType.NVarChar,255).Value=v_license_key;
					
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"license");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Dispose();
			}		
			return true;
		}
		public bool is_licensed
		{
			get
			{
				bool ar=false;
				try
				{
					ar = f_get_md_license(license.f_generate_computer_key(),license.f_generate_license_key()).Tables[0].Rows.Count>0;
				}
				catch
				{
					ar=false;
				}
				return ar;
			}
		}
		public DataSet f_get_md_license(string v_computer_key, string v_license_key)
		{
			DataSet ads = null;
			try
			{
				string asql="", aexp="";
				asql="select * from license";

				if(v_computer_key!="") 
				{
					if(aexp.Length>0)
					{
						aexp+=" and";
					}
					aexp+=" computer_key=:v_computer_key";
				}
				if(v_license_key!="") 
				{
					if(aexp.Length>0)
					{
						aexp+=" and";
					}
					aexp+=" license_key=:v_license_key";
				}

				if(aexp.Length>0)
				{
					asql+=" where"+aexp;
				}
	
				con=new OracleConnection(sConn);
				con.Open();
				cmd=new OracleCommand(asql,con);
				cmd.CommandType=CommandType.Text;
				
				if(v_computer_key!="") 
				{
					cmd.Parameters.Add("v_computer_key",OracleType.NVarChar,255).Value=v_computer_key;
				}
				
				if(v_license_key!="") 
				{
					cmd.Parameters.Add("v_license_key",OracleType.NVarChar,255).Value=v_license_key;
				}

				dest=new OracleDataAdapter(cmd);
				ads=new DataSet();
				dest.Fill(ads);	
				cmd.Dispose();				
				con.Dispose();
			}
			catch(OracleException ex)
			{
				f_create_md_license();
				upd_error(ex.Message.ToString().Trim(),sComputer,"license");
			}
			return ads;
		}
		public void f_set_licensed(string v_password_)
		{
			try
			{
				if(v_password_==license.f_generate_password_key())
				{
					string acomputer_key="", alicence_key="";
					acomputer_key=license.f_generate_computer_key();
					alicence_key=license.f_generate_license_key();
					if(acomputer_key!="" && alicence_key!="")
					{
						upd_md_license(acomputer_key,alicence_key);
					}
				}
			}
			catch
			{
			}
		}
		public string s_computer_key
		{
			get
			{
				return license.f_generate_computer_key();
			}
		}
		public void f_create_md_license()
		{
			try
			{
				int n = get_data("select * from license where rownum<=1").Tables[0].Rows.Count;
			}
			catch
			{
				execute_data("create table license(computer_key nvarchar2(255), license_key nvarchar2(255),computer varchar2(100),ngayud date default sysdate,constraint pk_license primary key(computer_key))");
			}
		}
		#endregion

		public bool upd_dmtheodoi(long m_id,decimal m_stt,string m_ten)
		{
			sql="update dmtheodoi set stt=:m_stt,ten=:m_ten where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
				cmd.Parameters.Add("m_ten",OracleType.NVarChar,100).Value=m_ten;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into dmtheodoi (id,stt,ten) values (:m_id,:m_stt,:m_ten)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
					cmd.Parameters.Add("m_ten",OracleType.NVarChar,100).Value=m_ten;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"dmtheodoi");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_theodoitsu(string m_mabn,string m_noidung)
		{
			sql="update theodoitsu set noidung=:m_noidung where mabn=:m_mabn";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;				
				cmd.Parameters.Add("m_noidung",OracleType.NVarChar,2000).Value=m_noidung;
				cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into theodoitsu (mabn,noidung) values (:m_mabn,:m_noidung)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
					cmd.Parameters.Add("m_noidung",OracleType.NVarChar,2000).Value=m_noidung;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"theodoitsu");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_cls_hen(string m_ngay,long m_id, int m_songay, string m_ghichu, int m_loai,string m_ngaychup,string m_ngaytra)
		{
			string xxx = user + mmyy(m_ngay);
			sql = "update " + xxx+ ".cls_hen set songay=:m_songay,ghichu=:m_ghichu,loai=:m_loai ";
			if (m_ngaychup != "") sql += ",ngaychup=to_date(:m_ngaychup,'dd/mm/yyyy hh24:mi')";
			if (m_ngaytra != "") sql += ",ngaytra=to_date(:m_ngaytra,'dd/mm/yyyy hh24:mi')";
			sql+=" where id=:m_id";
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd = new OracleCommand(sql, con);
				cmd.CommandType = CommandType.Text;
				cmd.Parameters.Add("m_songay", OracleType.Number).Value = m_songay;
				cmd.Parameters.Add("m_ghichu", OracleType.NVarChar, 254).Value = m_ghichu;
				cmd.Parameters.Add("m_loai", OracleType.Number).Value = m_loai;
				if (m_ngaychup != "") cmd.Parameters.Add("m_ngaychup", OracleType.VarChar,16).Value = m_ngaychup;
				if (m_ngaytra != "") cmd.Parameters.Add("m_ngaytra", OracleType.VarChar, 16).Value = m_ngaytra;
				cmd.Parameters.Add("m_id", OracleType.Number).Value = m_id;
				int irec = cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec == 0)
				{
					sql = "insert into " + xxx + ".cls_hen (id,songay,ghichu,loai";
					if (m_ngaychup != "") sql += ",ngaychup";
					if (m_ngaytra != "") sql += ",ngaytra";
					sql+=") values (:m_id,:m_songay,:m_ghichu,:m_loai";
					if (m_ngaychup != "") sql += ",to_date(:m_ngaychup,'dd/mm/yyyy hh24:mi')";
					if (m_ngaytra != "") sql += ",to_date(:m_ngaytra,'dd/mm/yyyy hh24:mi')";
					sql+=")";
					cmd = new OracleCommand(sql, con);
					cmd.CommandType = CommandType.Text;
					cmd.Parameters.Add("m_id", OracleType.Number).Value = m_id;
					cmd.Parameters.Add("m_songay", OracleType.Number).Value = m_songay;
					cmd.Parameters.Add("m_ghichu", OracleType.NVarChar, 254).Value = m_ghichu;
					cmd.Parameters.Add("m_loai", OracleType.Number).Value = m_loai;
					if (m_ngaychup != "") cmd.Parameters.Add("m_ngaychup", OracleType.VarChar, 16).Value = m_ngaychup;
					if (m_ngaytra != "") cmd.Parameters.Add("m_ngaytra", OracleType.VarChar, 16).Value = m_ngaytra;
					irec = cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch (OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim(), sComputer, "cls_hen");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_cls_hinh(string m_ngay,long m_id, int m_stt, string m_hinh)
		{
			string xxx = user + mmyy(m_ngay);
			sql = "update " + xxx + ".cls_hinh set stt=:m_stt,hinh=:m_hinh where id=:m_id";
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd = new OracleCommand(sql, con);
				cmd.CommandType = CommandType.Text;
				cmd.Parameters.Add("m_stt", OracleType.Number).Value = m_stt;
				cmd.Parameters.Add("m_hinh", OracleType.VarChar, 254).Value = m_hinh;
				cmd.Parameters.Add("m_id", OracleType.Number).Value = m_id;
				int irec = cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec == 0)
				{
					sql = "insert into " + xxx + ".cls_hinh (id,stt,hinh) values (:m_id,:m_stt,:m_hinh)";
					cmd = new OracleCommand(sql, con);
					cmd.CommandType = CommandType.Text;
					cmd.Parameters.Add("m_id", OracleType.Number).Value = m_id;
					cmd.Parameters.Add("m_stt", OracleType.Number).Value = m_stt;
					cmd.Parameters.Add("m_hinh", OracleType.VarChar, 254).Value = m_hinh;
					irec = cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch (OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim(), sComputer, "cls_hinh");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}
			return true;
		}


		public bool upd_cls_motact_cd(string m_ngay,long m_id,int m_gayme,int m_phanung,int m_sa)
		{
			string xxx = user + mmyy(m_ngay);
			sql = "update " + xxx + ".cls_motact set gayme=:m_gayme,phanung=:m_phanung,sa=:m_sa where id=:m_id";
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd = new OracleCommand(sql, con);
				cmd.CommandType = CommandType.Text;
				cmd.Parameters.Add("m_gayme", OracleType.Number).Value = m_gayme;
				cmd.Parameters.Add("m_phanung", OracleType.Number).Value = m_phanung;
				cmd.Parameters.Add("m_sa", OracleType.Number).Value = m_sa;
				cmd.Parameters.Add("m_id", OracleType.Number).Value = m_id;
				int irec = cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec == 0)
				{
					sql = "insert into " + xxx + ".cls_motact (id,gayme,phanung,sa) values (:m_id,:m_gayme,:m_phanung,:m_sa)";
					cmd = new OracleCommand(sql, con);
					cmd.CommandType = CommandType.Text;
					cmd.Parameters.Add("m_id", OracleType.Number).Value = m_id;
					cmd.Parameters.Add("m_gayme", OracleType.Number).Value = m_gayme;
					cmd.Parameters.Add("m_phanung", OracleType.Number).Value = m_phanung;
					cmd.Parameters.Add("m_sa", OracleType.Number).Value = m_sa;
					irec = cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch (OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim(), sComputer, "cls_motact");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_cls_motact(string m_ngay, long m_id, int m_canquang, int m_gayme, int m_phanung, int m_sa)
		{
			string xxx = user + mmyy(m_ngay);
			sql = "update " + xxx + ".cls_motact set canquang=:m_canquang,gayme=:m_gayme,phanung=:m_phanung,sa=:m_sa where id=:m_id";
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd = new OracleCommand(sql, con);
				cmd.CommandType = CommandType.Text;
				cmd.Parameters.Add("m_canquang", OracleType.Number).Value = m_canquang;
				cmd.Parameters.Add("m_gayme", OracleType.Number).Value = m_gayme;
				cmd.Parameters.Add("m_phanung", OracleType.Number).Value = m_phanung;
				cmd.Parameters.Add("m_sa", OracleType.Number).Value = m_sa;
				cmd.Parameters.Add("m_id", OracleType.Number).Value = m_id;
				int irec = cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec == 0)
				{
					sql = "insert into " + xxx + ".cls_motact (id,canquang,gayme,phanung,sa) values (:m_id,:m_canquang,:m_gayme,:m_phanung,:m_sa)";
					cmd = new OracleCommand(sql, con);
					cmd.CommandType = CommandType.Text;
					cmd.Parameters.Add("m_id", OracleType.Number).Value = m_id;
					cmd.Parameters.Add("m_canquang", OracleType.Number).Value = m_canquang;
					cmd.Parameters.Add("m_gayme", OracleType.Number).Value = m_gayme;
					cmd.Parameters.Add("m_phanung", OracleType.Number).Value = m_phanung;
					cmd.Parameters.Add("m_sa", OracleType.Number).Value = m_sa;
					irec = cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch (OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim(), sComputer, "cls_motact");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_cls_mat(string m_ngay,long m_id, int m_mp, int m_mt)
		{
			string xxx = user + mmyy(m_ngay);
			sql = "update " + xxx + ".cls_mat set mp=:m_mp,mt=:m_mt where id=:m_id";
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd = new OracleCommand(sql, con);
				cmd.CommandType = CommandType.Text;
				cmd.Parameters.Add("m_mp", OracleType.Number).Value = m_mp;
				cmd.Parameters.Add("m_mt", OracleType.Number).Value = m_mt;
				cmd.Parameters.Add("m_id", OracleType.Number).Value = m_id;
				int irec = cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec == 0)
				{
					sql = "insert into " + xxx + ".cls_mat (id,mp,mt) values (:m_id,:m_mp,:m_mt)";
					cmd = new OracleCommand(sql, con);
					cmd.CommandType = CommandType.Text;
					cmd.Parameters.Add("m_id", OracleType.Number).Value = m_id;
					cmd.Parameters.Add("m_mp", OracleType.Number).Value = m_mp;
					cmd.Parameters.Add("m_mt", OracleType.Number).Value = m_mt;
					irec = cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch (OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim(), sComputer, "cls_mat");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_cls_sdthuoc(string m_ngay,long m_id, int m_thuoc,decimal m_soluong)
		{
			string xxx = user + mmyy(m_ngay);
			sql = "update " + xxx + ".cls_sdthuoc set thuoc=:m_thuoc,soluong=:m_soluong where id=:m_id";
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd = new OracleCommand(sql, con);
				cmd.CommandType = CommandType.Text;
				cmd.Parameters.Add("m_thuoc", OracleType.Number).Value = m_thuoc;
				cmd.Parameters.Add("m_soluong", OracleType.Number).Value = m_soluong;
				cmd.Parameters.Add("m_id", OracleType.Number).Value = m_id;
				int irec = cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec == 0)
				{
					sql = "insert into " + xxx + ".cls_sdthuoc (id,thuoc,soluong) values (:m_id,:m_thuoc,:m_soluong)";
					cmd = new OracleCommand(sql, con);
					cmd.CommandType = CommandType.Text;
					cmd.Parameters.Add("m_id", OracleType.Number).Value = m_id;
					cmd.Parameters.Add("m_thuoc", OracleType.Number).Value = m_thuoc;
					cmd.Parameters.Add("m_soluong", OracleType.Number).Value = m_soluong;
					irec = cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch (OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim(), sComputer, "cls_sdthuoc");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_cls_ketqua(long m_id,int m_loai,string m_mabn,long m_maql,string m_ngay,int m_madoituong,string m_idcls,string m_idvp,string m_bscd,string m_makpcd,string m_bvcd,decimal m_cp,decimal m_lt,decimal m_bh,string m_chandoan,string m_ketqua,string m_mabs,string m_maktv,int m_idmay,int m_idvung,int m_idvungdg,int m_idloai,int m_kqcuoi,string m_madia,int m_soluongphim,string m_nhankq,int m_userid)
		{
			string xxx = user + mmyy(m_ngay);
			sql = "update " + xxx + ".cls_ketqua set loai=:m_loai,mabn=:m_mabn,";
			sql += " maql=:m_maql,ngay=to_date(:m_ngay,'dd/mm/yyyy hh24:mi'),madoituong=:m_madoituong,";
			sql += " idcls=:m_idcls,idvp=:m_idvp,bscd=:m_bscd,makpcd=:m_makpcd,bvcd=:m_bvcd,cp=:m_cp,lt=:m_lt,bh=:m_bh,";
			sql += " chandoan=:m_chandoan,";
			if (m_ketqua!="") sql += "ketqua=:m_ketqua,";
			sql += " mabs=:m_mabs,maktv=:m_maktv,idmay=:m_idmay,idvung=:m_idvung,idvungdg=:m_idvungdg,";
			sql += " idloai=:m_idloai,kqcuoi=:m_kqcuoi,madia=:m_madia,soluongphim=:m_soluongphim,nhankq=:m_nhankq,userid=:m_userid";
			sql += " where id=:m_id";
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd = new OracleCommand(sql, con);
				cmd.CommandType = CommandType.Text;
				cmd.Parameters.Add("m_loai", OracleType.Number).Value = m_loai;
				cmd.Parameters.Add("m_mabn", OracleType.VarChar, 8).Value = m_mabn;
				cmd.Parameters.Add("m_maql", OracleType.Number).Value = m_maql;
				cmd.Parameters.Add("m_ngay", OracleType.VarChar,16).Value = m_ngay;
				cmd.Parameters.Add("m_madoituong", OracleType.Number).Value = m_madoituong;
				cmd.Parameters.Add("m_idcls", OracleType.VarChar,11).Value = m_idcls;
				cmd.Parameters.Add("m_idvp", OracleType.VarChar, 12).Value = m_idvp;
				cmd.Parameters.Add("m_bscd", OracleType.NVarChar,100).Value = m_bscd;
				cmd.Parameters.Add("m_makpcd", OracleType.NVarChar,100).Value = m_makpcd;
				cmd.Parameters.Add("m_bvcd", OracleType.NVarChar,100).Value = m_bvcd;
				cmd.Parameters.Add("m_cp", OracleType.Number).Value = m_cp;
				cmd.Parameters.Add("m_lt", OracleType.Number).Value = m_lt;
				cmd.Parameters.Add("m_bh", OracleType.Number).Value = m_bh;
				cmd.Parameters.Add("m_chandoan", OracleType.NVarChar,500).Value = m_chandoan;
				if (m_ketqua != "") cmd.Parameters.Add("m_ketqua", OracleType.NVarChar,2000).Value = m_ketqua;
				cmd.Parameters.Add("m_mabs", OracleType.VarChar,4).Value = m_mabs;
				cmd.Parameters.Add("m_maktv", OracleType.VarChar,4).Value = m_maktv;
				cmd.Parameters.Add("m_idmay", OracleType.Number).Value = m_idmay;
				cmd.Parameters.Add("m_idvung", OracleType.Number).Value = m_idvung;
				cmd.Parameters.Add("m_idvungdg", OracleType.Number).Value = m_idvungdg;
				cmd.Parameters.Add("m_idloai", OracleType.Number).Value = m_idloai;
				cmd.Parameters.Add("m_kqcuoi", OracleType.Number).Value = m_kqcuoi;
				cmd.Parameters.Add("m_madia", OracleType.VarChar,20).Value = m_madia;
				cmd.Parameters.Add("m_soluongphim", OracleType.Number).Value = m_soluongphim;
				cmd.Parameters.Add("m_nhankq", OracleType.NVarChar,100).Value = m_nhankq;
				cmd.Parameters.Add("m_userid", OracleType.Number).Value = m_userid;
				cmd.Parameters.Add("m_id", OracleType.Number).Value = m_id;
				int irec = cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec == 0)
				{
					sql = "insert into " + xxx + ".cls_ketqua (id,loai,mabn,maql,ngay,madoituong,idcls,idvp,bscd,makpcd,bvcd,cp,lt,bh,chandoan,";
					if (m_ketqua!="") sql += "ketqua,";
					sql +="mabs,maktv,idmay,idvung,idvungdg,idloai,kqcuoi,madia,soluongphim,nhankq,userid) values (:m_id,:m_loai,:m_mabn,:m_maql,to_date(:m_ngay,'dd/mm/yyyy hh24:mi'),:m_madoituong,:m_idcls,:m_idvp,:m_bscd,:m_makpcd,:m_bvcd,:m_cp,:m_lt,:m_bh,:m_chandoan,";
					if (m_ketqua!="") sql += ":m_ketqua,";
					sql+=":m_mabs,:m_maktv,:m_idmay,:m_idvung,:m_idvungdg,:m_idloai,:m_kqcuoi,:m_madia,:m_soluongphim,:m_nhankq,:m_userid)";
					cmd = new OracleCommand(sql, con);
					cmd.CommandType = CommandType.Text;
					cmd.Parameters.Add("m_id", OracleType.Number).Value = m_id;
					cmd.Parameters.Add("m_loai", OracleType.Number).Value = m_loai;
					cmd.Parameters.Add("m_mabn", OracleType.VarChar, 8).Value = m_mabn;
					cmd.Parameters.Add("m_maql", OracleType.Number).Value = m_maql;
					cmd.Parameters.Add("m_ngay", OracleType.VarChar, 16).Value = m_ngay;
					cmd.Parameters.Add("m_madoituong", OracleType.Number).Value = m_madoituong;
					cmd.Parameters.Add("m_idcls", OracleType.VarChar, 11).Value = m_idcls;
					cmd.Parameters.Add("m_idvp", OracleType.VarChar, 12).Value = m_idvp;
					cmd.Parameters.Add("m_bscd", OracleType.NVarChar,100).Value = m_bscd;
					cmd.Parameters.Add("m_makpcd", OracleType.NVarChar,100).Value = m_makpcd;
					cmd.Parameters.Add("m_bvcd", OracleType.NVarChar,100).Value = m_bvcd;
					cmd.Parameters.Add("m_cp", OracleType.Number).Value = m_cp;
					cmd.Parameters.Add("m_lt", OracleType.Number).Value = m_lt;
					cmd.Parameters.Add("m_bh", OracleType.Number).Value = m_bh;
					cmd.Parameters.Add("m_chandoan", OracleType.NVarChar,500).Value = m_chandoan;
					if (m_ketqua != "") cmd.Parameters.Add("m_ketqua", OracleType.NVarChar,2000).Value = m_ketqua;
					cmd.Parameters.Add("m_mabs", OracleType.VarChar, 4).Value = m_mabs;
					cmd.Parameters.Add("m_maktv", OracleType.VarChar, 4).Value = m_maktv;
					cmd.Parameters.Add("m_idmay", OracleType.Number).Value = m_idmay;
					cmd.Parameters.Add("m_idvung", OracleType.Number).Value = m_idvung;
					cmd.Parameters.Add("m_idvungdg", OracleType.Number).Value = m_idvungdg;
					cmd.Parameters.Add("m_idloai", OracleType.Number).Value = m_idloai;
					cmd.Parameters.Add("m_kqcuoi", OracleType.Number).Value = m_kqcuoi;
					cmd.Parameters.Add("m_madia", OracleType.VarChar, 20).Value = m_madia;
					cmd.Parameters.Add("m_soluongphim", OracleType.Number).Value = m_soluongphim;
					cmd.Parameters.Add("m_nhankq", OracleType.NVarChar,100).Value = m_nhankq;
					cmd.Parameters.Add("m_userid", OracleType.Number).Value = m_userid;
					irec = cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch (OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim(), sComputer, "cls_ketqua");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_cls_ketqua_cd(long m_id, int m_loai, string m_mabn,long m_maql, string m_ngay, int m_madoituong, string m_idcls, string m_idvp, string m_bscd, string m_makpcd, string m_bvcd, decimal m_cp, decimal m_lt, decimal m_bh,string m_chandoan, int m_idmay, int m_idvung,int m_kqcuoi, string m_nhankq, int m_userid)
		{
			string xxx = user + mmyy(m_ngay);
			sql = "update " + xxx + ".cls_ketqua set loai=:m_loai,mabn=:m_mabn,";
			sql += " maql=:m_maql,ngay=to_date(:m_ngay,'dd/mm/yyyy hh24:mi'),madoituong=:m_madoituong,";
			sql += " idcls=:m_idcls,idvp=:m_idvp,bscd=:m_bscd,makpcd=:m_makpcd,bvcd=:m_bvcd,cp=:m_cp,lt=:m_lt,bh=:m_bh,";
			if (m_chandoan != "") sql += "chandoan=:m_chandoan,";
			sql += " idmay=:m_idmay,idvung=:m_idvung,";
			sql += " kqcuoi=:m_kqcuoi,nhankq=:m_nhankq,userid=:m_userid";
			sql += " where id=:m_id";
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd = new OracleCommand(sql, con);
				cmd.CommandType = CommandType.Text;
				cmd.Parameters.Add("m_loai", OracleType.Number).Value = m_loai;
				cmd.Parameters.Add("m_mabn", OracleType.VarChar, 8).Value = m_mabn;
				cmd.Parameters.Add("m_maql", OracleType.Number).Value = m_maql;
				cmd.Parameters.Add("m_ngay", OracleType.VarChar, 16).Value = m_ngay;
				cmd.Parameters.Add("m_madoituong", OracleType.Number).Value = m_madoituong;
				cmd.Parameters.Add("m_idcls", OracleType.VarChar, 11).Value = m_idcls;
				cmd.Parameters.Add("m_idvp", OracleType.VarChar, 12).Value = m_idvp;
				cmd.Parameters.Add("m_bscd", OracleType.NVarChar,100).Value = m_bscd;
				cmd.Parameters.Add("m_makpcd", OracleType.NVarChar,100).Value = m_makpcd;
				cmd.Parameters.Add("m_bvcd", OracleType.NVarChar,100).Value = m_bvcd;
				cmd.Parameters.Add("m_cp", OracleType.Number).Value = m_cp;
				cmd.Parameters.Add("m_lt", OracleType.Number).Value = m_lt;
				cmd.Parameters.Add("m_bh", OracleType.Number).Value = m_bh;
				if (m_chandoan != "") cmd.Parameters.Add("m_chandoan", OracleType.NVarChar,500).Value = m_chandoan;
				cmd.Parameters.Add("m_idmay", OracleType.Number).Value = m_idmay;
				cmd.Parameters.Add("m_idvung", OracleType.Number).Value = m_idvung;
				cmd.Parameters.Add("m_kqcuoi", OracleType.Number).Value = m_kqcuoi;
				cmd.Parameters.Add("m_nhankq", OracleType.NVarChar,100).Value = m_nhankq;
				cmd.Parameters.Add("m_userid", OracleType.Number).Value = m_userid;
				cmd.Parameters.Add("m_id", OracleType.Number).Value = m_id;
				int irec = cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec == 0)
				{
					sql = "insert into " + xxx + ".cls_ketqua (id,loai,mabn,maql,ngay,madoituong,idcls,idvp,bscd,makpcd,bvcd,cp,lt,bh,";
					if (m_chandoan != "") sql += "chandoan,";
					sql+="idmay,idvung,kqcuoi,nhankq,userid) ";
					sql+="values (:m_id,:m_loai,:m_mabn,:m_maql,to_date(:m_ngay,'dd/mm/yyyy hh24:mi'),:m_madoituong,:m_idcls,:m_idvp,:m_bscd,:m_makpcd,:m_bvcd,:m_cp,:m_lt,:m_bh,";
					if (m_chandoan != "") sql += ":m_chandoan,";
					sql+=":m_idmay,:m_idvung,:m_kqcuoi,:m_nhankq,:m_userid)";
					cmd = new OracleCommand(sql, con);
					cmd.CommandType = CommandType.Text;
					cmd.Parameters.Add("m_id", OracleType.Number).Value = m_id;
					cmd.Parameters.Add("m_loai", OracleType.Number).Value = m_loai;
					cmd.Parameters.Add("m_mabn", OracleType.VarChar, 8).Value = m_mabn;
					cmd.Parameters.Add("m_maql", OracleType.Number).Value = m_maql;
					cmd.Parameters.Add("m_ngay", OracleType.VarChar, 16).Value = m_ngay;
					cmd.Parameters.Add("m_madoituong", OracleType.Number).Value = m_madoituong;
					cmd.Parameters.Add("m_idcls", OracleType.VarChar, 11).Value = m_idcls;
					cmd.Parameters.Add("m_idvp", OracleType.VarChar, 12).Value = m_idvp;
					cmd.Parameters.Add("m_bscd", OracleType.NVarChar,100).Value = m_bscd;
					cmd.Parameters.Add("m_makpcd", OracleType.NVarChar,100).Value = m_makpcd;
					cmd.Parameters.Add("m_bvcd", OracleType.NVarChar,100).Value = m_bvcd;
					cmd.Parameters.Add("m_cp", OracleType.Number).Value = m_cp;
					cmd.Parameters.Add("m_lt", OracleType.Number).Value = m_lt;
					cmd.Parameters.Add("m_bh", OracleType.Number).Value = m_bh;
					if (m_chandoan != "") cmd.Parameters.Add("m_chandoan", OracleType.NVarChar,2000).Value = m_chandoan;
					cmd.Parameters.Add("m_idmay", OracleType.Number).Value = m_idmay;
					cmd.Parameters.Add("m_idvung", OracleType.Number).Value = m_idvung;
					cmd.Parameters.Add("m_kqcuoi", OracleType.Number).Value = m_kqcuoi;
					cmd.Parameters.Add("m_nhankq", OracleType.NVarChar,100).Value = m_nhankq;
					cmd.Parameters.Add("m_userid", OracleType.Number).Value = m_userid;
					irec = cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch (OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim(), sComputer, "cls_ketqua");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_cls_ketqua_kq(long m_id,string m_ngay,string m_bscd, string m_makpcd, string m_bvcd,string m_chandoan, string m_ketqua, string m_mabs, string m_maktv, int m_idmay, int m_idvung, int m_idvungdg, int m_idloai, int m_kqcuoi, string m_madia, int m_soluongphim)
		{
			string xxx = user + mmyy(m_ngay);
			sql = "update " + xxx + ".cls_ketqua set bscd=:m_bscd,makpcd=:m_makpcd,bvcd=:m_bvcd,chandoan=:m_chandoan,ketqua=:m_ketqua,mabs=:m_mabs,maktv=:m_maktv,idmay=:m_idmay,idvung=:m_idvung,idvungdg=:m_idvungdg,";
			sql += " idloai=:m_idloai,kqcuoi=:m_kqcuoi,madia=:m_madia,soluongphim=:m_soluongphim where id=:m_id";
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd = new OracleCommand(sql, con);
				cmd.CommandType = CommandType.Text;
				cmd.Parameters.Add("m_bscd", OracleType.NVarChar,100).Value = m_bscd;
				cmd.Parameters.Add("m_makpcd", OracleType.NVarChar,100).Value = m_makpcd;
				cmd.Parameters.Add("m_bvcd", OracleType.NVarChar,100).Value = m_bvcd;
				cmd.Parameters.Add("m_chandoan", OracleType.NVarChar,500).Value = m_chandoan;
				cmd.Parameters.Add("m_ketqua", OracleType.NVarChar,2000).Value = m_ketqua;
				cmd.Parameters.Add("m_mabs", OracleType.VarChar, 4).Value = m_mabs;
				cmd.Parameters.Add("m_maktv", OracleType.VarChar, 4).Value = m_maktv;
				cmd.Parameters.Add("m_idmay", OracleType.Number).Value = m_idmay;
				cmd.Parameters.Add("m_idvung", OracleType.Number).Value = m_idvung;
				cmd.Parameters.Add("m_idvungdg", OracleType.Number).Value = m_idvungdg;
				cmd.Parameters.Add("m_idloai", OracleType.Number).Value = m_idloai;
				cmd.Parameters.Add("m_kqcuoi", OracleType.Number).Value = m_kqcuoi;
				cmd.Parameters.Add("m_madia", OracleType.VarChar, 20).Value = m_madia;
				cmd.Parameters.Add("m_soluongphim", OracleType.Number).Value = m_soluongphim;
				cmd.Parameters.Add("m_id", OracleType.Number).Value = m_id;
				int irec = cmd.ExecuteNonQuery();
				cmd.Dispose();
			}
			catch (OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim(), sComputer, "cls_ketqua");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_cls_ketqua(string m_ngay,string m_idcls,int m_loai,string m_ketqua, string m_mabs)
		{
			string xxx = user + mmyy(m_ngay);
			sql = "update " + xxx + ".cls_ketqua set ketqua=:m_ketqua";
			if (m_mabs!="") sql+=",mabs=:m_mabs ";
			sql+=" where idcls=:m_idcls and loai=:m_loai";
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd = new OracleCommand(sql, con);
				cmd.CommandType = CommandType.Text;
				cmd.Parameters.Add("m_ketqua", OracleType.NVarChar,2000).Value = m_ketqua;
				if (m_mabs!="") cmd.Parameters.Add("m_mabs", OracleType.VarChar, 4).Value = m_mabs;
				cmd.Parameters.Add("m_idcls", OracleType.VarChar,11).Value = m_idcls;
				cmd.Parameters.Add("m_loai", OracleType.Number).Value = m_loai;
				cmd.ExecuteNonQuery();
				cmd.Dispose();
			}
			catch (OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim(), sComputer, "cls_ketqua");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_cls_motact(string m_ngay, long m_id, int m_canquang)
		{
			string xxx = user + mmyy(m_ngay);
			sql = "update " + xxx + ".cls_motact set canquang=:m_canquang where id=:m_id";
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd = new OracleCommand(sql, con);
				cmd.CommandType = CommandType.Text;
				cmd.Parameters.Add("m_canquang", OracleType.Number).Value = m_canquang;
				cmd.Parameters.Add("m_id", OracleType.Number).Value = m_id;
				int irec = cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec == 0)
				{
					sql = "insert into " + xxx + ".cls_motact (id,canquang,gayme,phanung,sa) values (:m_id,:m_canquang,0,0,0)";
					cmd = new OracleCommand(sql, con);
					cmd.CommandType = CommandType.Text;
					cmd.Parameters.Add("m_id", OracleType.Number).Value = m_id;
					cmd.Parameters.Add("m_canquang", OracleType.Number).Value = m_canquang;
					irec = cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch (OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim(), sComputer, "cls_motact");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}
			return true;
		}

		public string Kiemtra_idcls(string ngay,int loai,string mabn, string idcls)
		{
			string _mmyy = mmyy(ngay);
			if (!bMmyy(_mmyy)) return "";
			ds=get_data("select a.mabn||' '||b.hoten as hoten from " + user + _mmyy + ".cls_ketqua a,"+user+".btdbn b where a.mabn=b.mabn and a.loai=" + loai + " and a.mabn<>'" + mabn + "' and a.idcls='" + idcls + "'");
			if (ds.Tables[0].Rows.Count > 0) return ds.Tables[0].Rows[0]["hoten"].ToString();
			else return "";
		}

		public long get_id_cls_mau(int m_loai,string m_mabs,long m_vung,string m_chandoan)
		{
			ds = get_data("select id from cls_mau where mabs='" + m_mabs + "' and chandoan='" + m_chandoan + "' and loai=" + m_loai+" and vung="+m_vung);
			long l_id = (ds.Tables[0].Rows.Count == 0) ? 0 : long.Parse(ds.Tables[0].Rows[0][0].ToString());
			if (l_id == 0) l_id = get_capid(-100);
			return l_id;
		}

		public bool upd_cls_mau(long m_id, int m_loai, string m_mabs, long m_vung, string m_chandoan,string m_ten)
		{
			sql = "update cls_mau set ten=:m_ten where id=:m_id";
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd = new OracleCommand(sql, con);
				cmd.CommandType = CommandType.Text;
				cmd.Parameters.Add("m_ten", OracleType.NVarChar).Value = m_ten;
				cmd.Parameters.Add("m_id", OracleType.Number).Value = m_id;
				int irec = cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec == 0)
				{
					sql = "insert into cls_mau (id,loai,mabs,vung,chandoan,ten) values (:m_id,:m_loai,:m_mabs,:m_vung,:m_chandoan,:m_ten)";
					cmd = new OracleCommand(sql, con);
					cmd.CommandType = CommandType.Text;
					cmd.Parameters.Add("m_id", OracleType.Number).Value = m_id;
					cmd.Parameters.Add("m_loai", OracleType.Number).Value = m_loai;
					cmd.Parameters.Add("m_mabs", OracleType.VarChar, 4).Value = m_mabs;
					cmd.Parameters.Add("m_vung", OracleType.Number).Value = m_vung;
					cmd.Parameters.Add("m_chandoan", OracleType.NVarChar).Value = m_chandoan;
					cmd.Parameters.Add("m_ten", OracleType.NVarChar).Value = m_ten;
					irec = cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch (OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim(), sComputer, "cls_mau");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}
			return true;
		}
		public bool bKetqua_cls(string ngay, long id)
		{
			sql = "select * from " + user + mmyy(ngay) + ".cls_ketqua where id=" + id + " and ketqua is not null";
			return get_data(sql).Tables[0].Rows.Count > 0;
		}

		public bool upd_dausinhton(long m_maql,decimal m_mach,decimal m_nhietdo,string m_huyetap,decimal m_nhiptho,decimal m_cannang,string m_ghichu)
		{
			sql="update dausinhton set mach=:m_mach,nhietdo=:m_nhietdo,huyetap=:m_huyetap,nhiptho=:m_nhiptho,cannang=:m_cannang,ghichu=:m_ghichu";
			sql+=" where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_mach",OracleType.Number).Value=m_mach;
				cmd.Parameters.Add("m_nhietdo",OracleType.Number).Value=m_nhietdo;
				cmd.Parameters.Add("m_huyetap",OracleType.VarChar,7).Value=m_huyetap;
				cmd.Parameters.Add("m_nhiptho",OracleType.Number).Value=m_nhiptho;
				cmd.Parameters.Add("m_cannang",OracleType.Number).Value=m_cannang;
				cmd.Parameters.Add("m_ghichu",OracleType.NVarChar,254).Value=m_ghichu;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into dausinhton (maql,mach,nhietdo,huyetap,nhiptho,cannang,ghichu)";
					sql+=" values (:m_maql,:m_mach,:m_nhietdo,:m_huyetap,:m_nhiptho,:m_cannang,:m_ghichu)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_mach",OracleType.Number).Value=m_mach;
					cmd.Parameters.Add("m_nhietdo",OracleType.Number).Value=m_nhietdo;
					cmd.Parameters.Add("m_huyetap",OracleType.VarChar,7).Value=m_huyetap;
					cmd.Parameters.Add("m_nhiptho",OracleType.Number).Value=m_nhiptho;
					cmd.Parameters.Add("m_cannang",OracleType.Number).Value=m_cannang;
					cmd.Parameters.Add("m_ghichu",OracleType.NVarChar,254).Value=m_ghichu;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"dausinhton");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_thongtinchung(string m_mabn,long m_maql,string m_lydo,string m_hb_benhly,string m_hb_banthan,string m_hb_giadinh,string m_hb_toanthan,string m_hb_bophan,string m_hb_chuyenkhoa,string m_hb_tomtat,string m_hb_chandoan,string m_hb_xutri,string m_tk_benhly,string m_tk_tomtat,string m_tk_phuongphap,string m_tk_tinhtrang,string m_tk_huong,string m_tk_taicho,string m_tk_tien,decimal m_xq,decimal m_sa,decimal m_ct,decimal m_xn,decimal m_khac,string m_loaikhac,string m_nguoigiao,string m_nguoinhan,int m_userid)
		{
			sql="update thongtinchung set mabn=:m_mabn,lydo=:m_lydo,hb_benhly=:m_hb_benhly,hb_banthan=:m_hb_banthan,hb_giadinh=:m_hb_giadinh,hb_toanthan=:m_hb_toanthan,";
			sql+="hb_bophan=:m_hb_bophan,hb_chuyenkhoa=:m_hb_chuyenkhoa,hb_xutri=:m_hb_xutri,tk_benhly=:m_tk_benhly,tk_tomtat=:m_tk_tomtat,tk_phuongphap=:m_tk_phuongphap,";
			sql+="tk_tinhtrang=:m_tk_tinhtrang,tk_huong=:m_tk_huong,tk_taicho=:m_tk_taicho,tk_tien=:m_tk_tien,xq=:m_xq,ct=:m_ct,sa=:m_sa,xn=:m_xn,khac=:m_khac,loaikhac=:m_loaikhac,";
			sql+="nguoigiao=:m_nguoigiao,nguoinhan=:m_nguoinhan,userid=:m_userid where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
				cmd.Parameters.Add("m_lydo",OracleType.NVarChar,500).Value=m_lydo;
				cmd.Parameters.Add("m_hb_benhly",OracleType.NVarChar,500).Value=m_hb_benhly;
				cmd.Parameters.Add("m_hb_banthan",OracleType.NVarChar,500).Value=m_hb_banthan;
				cmd.Parameters.Add("m_hb_giadinh",OracleType.NVarChar,500).Value=m_hb_giadinh;
				cmd.Parameters.Add("m_hb_toanthan",OracleType.NVarChar,500).Value=m_hb_toanthan;
				cmd.Parameters.Add("m_hb_bophan",OracleType.NVarChar,500).Value=m_hb_bophan;
				cmd.Parameters.Add("m_hb_chuyenkhoa",OracleType.NVarChar,500).Value=m_hb_chuyenkhoa;
				cmd.Parameters.Add("m_hb_tomtat",OracleType.NVarChar,500).Value=m_hb_tomtat;
				cmd.Parameters.Add("m_hb_chandoan",OracleType.NVarChar,500).Value=m_hb_chandoan;
				cmd.Parameters.Add("m_hb_xutri",OracleType.NVarChar,500).Value=m_hb_xutri;
				cmd.Parameters.Add("m_tk_benhly",OracleType.NVarChar,2000).Value=m_tk_benhly;
				cmd.Parameters.Add("m_tk_tomtat",OracleType.NVarChar,500).Value=m_tk_tomtat;
				cmd.Parameters.Add("m_tk_phuongphap",OracleType.NVarChar,500).Value=m_tk_phuongphap;
				cmd.Parameters.Add("m_tk_tinhtrang",OracleType.NVarChar,500).Value=m_tk_tinhtrang;
				cmd.Parameters.Add("m_tk_huong",OracleType.NVarChar,500).Value=m_tk_huong;
				cmd.Parameters.Add("m_tk_taicho",OracleType.NVarChar,500).Value=m_tk_taicho;
				cmd.Parameters.Add("m_tk_tien",OracleType.NVarChar,500).Value=m_tk_tien;
				cmd.Parameters.Add("m_xq",OracleType.Number).Value=m_xq;
				cmd.Parameters.Add("m_ct",OracleType.Number).Value=m_ct;
				cmd.Parameters.Add("m_sa",OracleType.Number).Value=m_sa;
				cmd.Parameters.Add("m_xn",OracleType.Number).Value=m_xn;
				cmd.Parameters.Add("m_khac",OracleType.Number).Value=m_khac;
				cmd.Parameters.Add("m_loaikhac",OracleType.NVarChar,254).Value=m_loaikhac;
				cmd.Parameters.Add("m_nguoigiao",OracleType.VarChar,4).Value=m_nguoigiao;
				cmd.Parameters.Add("m_nguoinhan",OracleType.VarChar,4).Value=m_nguoinhan;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into thongtinchung(mabn,maql,lydo,hb_benhly,hb_banthan,hb_giadinh,hb_toanthan,hb_bophan,hb_chuyenkhoa,hb_tomtat,hb_chandoan,hb_xutri,tk_benhly,tk_tomtat,tk_phuongphap,tk_tinhtrang,tk_huong,tk_taicho,tk_tien,xq,ct,sa,xn,khac,loaikhac,nguoigiao,nguoinhan,userid)";
					sql+=" values (:m_mabn,:m_maql,:m_lydo,:m_hb_benhly,:m_hb_banthan,:m_hb_giadinh,:m_hb_toanthan,:m_hb_bophan,:m_hb_chuyenkhoa,:m_hb_tomtat,:m_hb_chandoan,:m_hb_xutri,:m_tk_benhly,:m_tk_tomtat,:m_tk_phuongphap,:m_tk_tinhtrang,:m_tk_huong,:m_tk_taicho,:m_tk_tien,:m_xq,:m_ct,:m_sa,:m_xn,:m_khac,:m_loaikhac,:m_nguoigiao,:m_nguoinhan,:m_userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_lydo",OracleType.NVarChar,500).Value=m_lydo;
					cmd.Parameters.Add("m_hb_benhly",OracleType.NVarChar,500).Value=m_hb_benhly;
					cmd.Parameters.Add("m_hb_banthan",OracleType.NVarChar,500).Value=m_hb_banthan;
					cmd.Parameters.Add("m_hb_giadinh",OracleType.NVarChar,500).Value=m_hb_giadinh;
					cmd.Parameters.Add("m_hb_toanthan",OracleType.NVarChar,500).Value=m_hb_toanthan;
					cmd.Parameters.Add("m_hb_bophan",OracleType.NVarChar,500).Value=m_hb_bophan;
					cmd.Parameters.Add("m_hb_chuyenkhoa",OracleType.NVarChar,500).Value=m_hb_chuyenkhoa;
					cmd.Parameters.Add("m_hb_tomtat",OracleType.NVarChar,500).Value=m_hb_tomtat;
					cmd.Parameters.Add("m_hb_chandoan",OracleType.NVarChar,500).Value=m_hb_chandoan;
					cmd.Parameters.Add("m_hb_xutri",OracleType.NVarChar,500).Value=m_hb_xutri;
					cmd.Parameters.Add("m_tk_benhly",OracleType.NVarChar,2000).Value=m_tk_benhly;
					cmd.Parameters.Add("m_tk_tomtat",OracleType.NVarChar,500).Value=m_tk_tomtat;
					cmd.Parameters.Add("m_tk_phuongphap",OracleType.NVarChar,500).Value=m_tk_phuongphap;
					cmd.Parameters.Add("m_tk_tinhtrang",OracleType.NVarChar,500).Value=m_tk_tinhtrang;
					cmd.Parameters.Add("m_tk_huong",OracleType.NVarChar,500).Value=m_tk_huong;
					cmd.Parameters.Add("m_tk_taicho",OracleType.NVarChar,500).Value=m_tk_taicho;
					cmd.Parameters.Add("m_tk_tien",OracleType.NVarChar,500).Value=m_tk_tien;
					cmd.Parameters.Add("m_xq",OracleType.Number).Value=m_xq;
					cmd.Parameters.Add("m_ct",OracleType.Number).Value=m_ct;
					cmd.Parameters.Add("m_sa",OracleType.Number).Value=m_sa;
					cmd.Parameters.Add("m_xn",OracleType.Number).Value=m_xn;
					cmd.Parameters.Add("m_khac",OracleType.Number).Value=m_khac;
					cmd.Parameters.Add("m_loaikhac",OracleType.NVarChar,254).Value=m_loaikhac;
					cmd.Parameters.Add("m_nguoigiao",OracleType.VarChar,4).Value=m_nguoigiao;
					cmd.Parameters.Add("m_nguoinhan",OracleType.VarChar,4).Value=m_nguoinhan;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"thongtinchung");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_thongtinmat(long m_maql,string m_vv_kk_mp,string m_vv_kk_mt,string m_vv_ck_mp,string m_vv_ck_mt,string m_vv_nhanap_mp,string m_vv_nhanap_mt,string m_vv_tt_mp,string m_vv_tt_mt,string m_rv_kk_mp,string m_rv_kk_mt,string m_rv_ck_mp,string m_rv_ck_mt,string m_rv_nhanap_mp,string m_rv_nhanap_mt)
		{
			sql="update thongtinmat set vv_kk_mp=:m_vv_kk_mp,vv_kk_mt=:m_vv_kk_mt,vv_ck_mp=:m_vv_ck_mp,vv_ck_mt=:m_vv_ck_mt,vv_nhanap_mp=:m_vv_nhanap_mp,vv_nhanap_mt=:m_vv_nhanap_mt,vv_tt_mp=:m_vv_tt_mp,vv_tt_mt=:m_vv_tt_mt,";
			sql+="rv_kk_mp=:m_rv_kk_mp,rv_kk_mt=:m_rv_kk_mt,rv_ck_mp=:m_rv_ck_mp,rv_ck_mt=:m_rv_ck_mt,rv_nhanap_mp=:m_rv_nhanap_mp,rv_nhanap_mt=:m_rv_nhanap_mt";
			sql+=" where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_vv_kk_mp",OracleType.VarChar,10).Value=m_vv_kk_mp;
				cmd.Parameters.Add("m_vv_kk_mt",OracleType.VarChar,10).Value=m_vv_kk_mt;
				cmd.Parameters.Add("m_vv_ck_mp",OracleType.VarChar,10).Value=m_vv_ck_mp;
				cmd.Parameters.Add("m_vv_ck_mt",OracleType.VarChar,10).Value=m_vv_ck_mt;
				cmd.Parameters.Add("m_vv_nhanap_mp",OracleType.VarChar,10).Value=m_vv_nhanap_mp;
				cmd.Parameters.Add("m_vv_nhanap_mt",OracleType.VarChar,10).Value=m_vv_nhanap_mt;
				cmd.Parameters.Add("m_vv_tt_mp",OracleType.VarChar,10).Value=m_vv_tt_mp;
				cmd.Parameters.Add("m_vv_tt_mt",OracleType.VarChar,10).Value=m_vv_tt_mt;
				cmd.Parameters.Add("m_rv_kk_mp",OracleType.VarChar,10).Value=m_rv_kk_mp;
				cmd.Parameters.Add("m_rv_kk_mt",OracleType.VarChar,10).Value=m_rv_kk_mt;
				cmd.Parameters.Add("m_rv_ck_mp",OracleType.VarChar,10).Value=m_rv_ck_mp;
				cmd.Parameters.Add("m_rv_ck_mt",OracleType.VarChar,10).Value=m_rv_ck_mt;
				cmd.Parameters.Add("m_rv_nhanap_mp",OracleType.VarChar,10).Value=m_rv_nhanap_mp;
				cmd.Parameters.Add("m_rv_nhanap_mt",OracleType.VarChar,10).Value=m_rv_nhanap_mt;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into thongtinmat (maql,vv_kk_mp,vv_kk_mt,vv_ck_mp,vv_ck_mt,vv_nhanap_mp,vv_nhanap_mt,vv_tt_mp,vv_tt_mt,rv_kk_mp,rv_kk_mt,rv_ck_mp,rv_ck_mt,rv_nhanap_mp,rv_nhanap_mt)";
					sql+=" values (:m_maql,:m_vv_kk_mp,:m_vv_kk_mt,:m_vv_ck_mp,:m_vv_ck_mt,:m_vv_nhanap_mp,:m_vv_nhanap_mt,:m_vv_tt_mp,:m_vv_tt_mt,:m_rv_kk_mp,:m_rv_kk_mt,:m_rv_ck_mp,:m_rv_ck_mt,:m_rv_nhanap_mp,:m_rv_nhanap_mt)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_vv_kk_mp",OracleType.VarChar,10).Value=m_vv_kk_mp;
					cmd.Parameters.Add("m_vv_kk_mt",OracleType.VarChar,10).Value=m_vv_kk_mt;
					cmd.Parameters.Add("m_vv_ck_mp",OracleType.VarChar,10).Value=m_vv_ck_mp;
					cmd.Parameters.Add("m_vv_ck_mt",OracleType.VarChar,10).Value=m_vv_ck_mt;
					cmd.Parameters.Add("m_vv_nhanap_mp",OracleType.VarChar,10).Value=m_vv_nhanap_mp;
					cmd.Parameters.Add("m_vv_nhanap_mt",OracleType.VarChar,10).Value=m_vv_nhanap_mt;
					cmd.Parameters.Add("m_vv_tt_mp",OracleType.VarChar,10).Value=m_vv_tt_mp;
					cmd.Parameters.Add("m_vv_tt_mt",OracleType.VarChar,10).Value=m_vv_tt_mt;
					cmd.Parameters.Add("m_rv_kk_mp",OracleType.VarChar,10).Value=m_rv_kk_mp;
					cmd.Parameters.Add("m_rv_kk_mt",OracleType.VarChar,10).Value=m_rv_kk_mt;
					cmd.Parameters.Add("m_rv_ck_mp",OracleType.VarChar,10).Value=m_rv_ck_mp;
					cmd.Parameters.Add("m_rv_ck_mt",OracleType.VarChar,10).Value=m_rv_ck_mt;
					cmd.Parameters.Add("m_rv_nhanap_mp",OracleType.VarChar,10).Value=m_rv_nhanap_mp;
					cmd.Parameters.Add("m_rv_nhanap_mt",OracleType.VarChar,10).Value=m_rv_nhanap_mt;					
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"thongtinmat");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_dmthongtin(long m_id,int m_loai,decimal m_stt,string m_noidung)
		{
			sql="update dmthongtin set loai=:m_loai,stt=:m_stt,noidung=:m_noidung where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
				cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
				cmd.Parameters.Add("m_noidung",OracleType.NVarChar,500).Value=m_noidung;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into dmthongtin (id,loai,stt,noidung) values (:m_id,:m_loai,:m_stt,:m_noidung)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
					cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
					cmd.Parameters.Add("m_noidung",OracleType.NVarChar,500).Value=m_noidung;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"dmthongtin");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_dmloaiphong(long m_id,decimal m_stt,string m_ma,string m_ten,int m_userid)
		{
			sql="update dmloaiphong set stt=:m_stt,ma=:m_ma,ten=:m_ten,userid=:m_userid where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
				cmd.Parameters.Add("m_ma",OracleType.VarChar,10).Value=m_ma;
				cmd.Parameters.Add("m_ten",OracleType.NVarChar,100).Value=m_ten;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into dmloaiphong (id,stt,ma,ten,userid) values (:m_id,:m_stt,:m_ma,:m_ten,:m_userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
					cmd.Parameters.Add("m_ma",OracleType.VarChar,10).Value=m_ma;
					cmd.Parameters.Add("m_ten",OracleType.NVarChar,100).Value=m_ten;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"dmloaiphong");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_dmphong(string m_makp,long m_id,decimal m_stt,string m_ma,string m_ten,int m_loai,int m_loaivp,int m_userid)
		{
			sql="update dmphong set makp=:m_makp,stt=:m_stt,ma=:m_ma,ten=:m_ten,loai=:m_loai,loaivp=:m_loaivp,userid=:m_userid where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
				cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
				cmd.Parameters.Add("m_ma",OracleType.VarChar,10).Value=m_ma;
				cmd.Parameters.Add("m_ten",OracleType.NVarChar,100).Value=m_ten;
				cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
				cmd.Parameters.Add("m_loaivp",OracleType.Number).Value=m_loaivp;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into dmphong (makp,id,stt,ma,ten,loai,loaivp,userid) values (:m_makp,:m_id,:m_stt,:m_ma,:m_ten,:m_loai,:m_loaivp,:m_userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;					
					cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
					cmd.Parameters.Add("m_ma",OracleType.VarChar,10).Value=m_ma;
					cmd.Parameters.Add("m_ten",OracleType.NVarChar,100).Value=m_ten;
					cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
					cmd.Parameters.Add("m_loaivp",OracleType.Number).Value=m_loaivp;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"dmphong");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_dmgiuong(long m_idphong,long m_id,decimal m_stt,string m_ma,string m_ten,int m_bhyt,decimal m_gia_th,decimal m_gia_bh,decimal m_gia_cs,decimal m_gia_dv,decimal m_gia_nn,int m_userid)
		{
			sql="update dmgiuong set idphong=:m_idphong,stt=:m_stt,ma=:m_ma,ten=:m_ten,bhyt=:m_bhyt,gia_th=:m_gia_th,gia_bh=:m_gia_bh,gia_cs=:m_gia_cs,gia_dv=:m_gia_dv,gia_nn=:m_gia_nn,userid=:m_userid where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_idphong",OracleType.Number).Value=m_idphong;
				cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
				cmd.Parameters.Add("m_ma",OracleType.VarChar,10).Value=m_ma;
				cmd.Parameters.Add("m_ten",OracleType.NVarChar,100).Value=m_ten;
				cmd.Parameters.Add("m_bhyt",OracleType.Number).Value=m_bhyt;
				cmd.Parameters.Add("m_gia_th",OracleType.Number).Value=m_gia_th;
				cmd.Parameters.Add("m_gia_bh",OracleType.Number).Value=m_gia_bh;
				cmd.Parameters.Add("m_gia_cs",OracleType.Number).Value=m_gia_cs;
				cmd.Parameters.Add("m_gia_dv",OracleType.Number).Value=m_gia_dv;
				cmd.Parameters.Add("m_gia_nn",OracleType.Number).Value=m_gia_nn;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into dmgiuong (idphong,id,stt,ma,ten,bhyt,gia_th,gia_bh,gia_cs,gia_dv,gia_nn,userid) values (:m_idphong,:m_id,:m_stt,:m_ma,:m_ten,:m_bhyt,:m_gia_th,:m_gia_bh,:m_gia_cs,:m_gia_dv,:m_gia_nn,:m_userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_idphong",OracleType.Number).Value=m_idphong;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
					cmd.Parameters.Add("m_ma",OracleType.VarChar,10).Value=m_ma;
					cmd.Parameters.Add("m_ten",OracleType.NVarChar,100).Value=m_ten;
					cmd.Parameters.Add("m_bhyt",OracleType.Number).Value=m_bhyt;
					cmd.Parameters.Add("m_gia_th",OracleType.Number).Value=m_gia_th;
					cmd.Parameters.Add("m_gia_bh",OracleType.Number).Value=m_gia_bh;
					cmd.Parameters.Add("m_gia_cs",OracleType.Number).Value=m_gia_cs;
					cmd.Parameters.Add("m_gia_dv",OracleType.Number).Value=m_gia_dv;
					cmd.Parameters.Add("m_gia_nn",OracleType.Number).Value=m_gia_nn;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"dmgiuong");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_dmgiuong(long m_id,string m_ghichu)
		{
			sql="update dmgiuong set ghichu=:m_ghichu where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_ghichu",OracleType.NVarChar,254).Value=m_ghichu;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.ExecuteNonQuery();
				cmd.Dispose();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"dmgiuong");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_theodoigiuong(long m_id,string m_makp,string m_mabn,long m_maql,long m_idkhoa,int m_madoituong,int m_idgiuong,string m_tu,int m_userid)
		{
			sql="update theodoigiuong set makp=:m_makp,mabn=:m_mabn,maql=:m_maql,idkhoa=:m_idkhoa,madoituong=:m_madoituong,idgiuong=:m_idgiuong,tu=:m_tu,userid=:m_userid where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
				cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				cmd.Parameters.Add("m_idkhoa",OracleType.Number).Value=m_idkhoa;
				cmd.Parameters.Add("m_madoituong",OracleType.Number).Value=m_madoituong;
				cmd.Parameters.Add("m_idgiuong",OracleType.Number).Value=m_idgiuong;
				cmd.Parameters.Add("m_tu",OracleType.DateTime).Value=StringToDateTime(m_tu);
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into theodoigiuong (id,makp,mabn,maql,idkhoa,madoituong,idgiuong,tu,userid) values (:m_id,:m_makp,:m_mabn,:m_maql,:m_idkhoa,:m_madoituong,:m_idgiuong,:m_tu,:m_userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_idkhoa",OracleType.Number).Value=m_idkhoa;
					cmd.Parameters.Add("m_madoituong",OracleType.Number).Value=m_madoituong;
					cmd.Parameters.Add("m_idgiuong",OracleType.Number).Value=m_idgiuong;
					cmd.Parameters.Add("m_tu",OracleType.DateTime).Value=StringToDateTime(m_tu);
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"theodoigiuong");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_theodoigiuong(long m_id,string m_makp,string m_mabn,long m_maql,long m_idkhoa,int m_madoituong,int m_idgiuong,string m_tu,decimal m_dongia,int m_userid)
		{
			sql="update theodoigiuong set makp=:m_makp,mabn=:m_mabn,maql=:m_maql,idkhoa=:m_idkhoa,madoituong=:m_madoituong,idgiuong=:m_idgiuong,tu=:m_tu,dongia=:m_dongia,userid=:m_userid where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
				cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				cmd.Parameters.Add("m_idkhoa",OracleType.Number).Value=m_idkhoa;
				cmd.Parameters.Add("m_madoituong",OracleType.Number).Value=m_madoituong;
				cmd.Parameters.Add("m_idgiuong",OracleType.Number).Value=m_idgiuong;
				cmd.Parameters.Add("m_tu",OracleType.DateTime).Value=StringToDateTime(m_tu);
				cmd.Parameters.Add("m_dongia",OracleType.Number).Value=m_dongia;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into theodoigiuong (id,makp,mabn,maql,idkhoa,madoituong,idgiuong,tu,dongia,userid) values (:m_id,:m_makp,:m_mabn,:m_maql,:m_idkhoa,:m_madoituong,:m_idgiuong,:m_tu,:m_dongia,:m_userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_idkhoa",OracleType.Number).Value=m_idkhoa;
					cmd.Parameters.Add("m_madoituong",OracleType.Number).Value=m_madoituong;
					cmd.Parameters.Add("m_idgiuong",OracleType.Number).Value=m_idgiuong;
					cmd.Parameters.Add("m_tu",OracleType.DateTime).Value=StringToDateTime(m_tu);
					cmd.Parameters.Add("m_dongia",OracleType.Number).Value=m_dongia;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"theodoigiuong");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_theodoigiuong(long m_id,string m_den,int m_madoituong,double m_soluong)
		{
			sql="update theodoigiuong set den=:m_den,madoituong=:m_madoituong,soluong=:m_soluong where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_den",OracleType.DateTime).Value=StringToDateTime(m_den);
				cmd.Parameters.Add("m_madoituong",OracleType.Number).Value=m_madoituong;
				cmd.Parameters.Add("m_soluong",OracleType.Number).Value=m_soluong;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.ExecuteNonQuery();
				cmd.Dispose();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"theodoigiuong");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_datgiuong(string m_mabn,string m_ngay,long m_idgiuong,string m_ghichu,int m_userid)
		{
			sql="update datgiuong set ghichu=:m_ghichu,userid=:m_userid where mabn=:m_mabn and to_char(ngay,'dd/mm/yyyy hh24:mi')=:m_ngay and idgiuong=:m_idgiuong";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_ghichu",OracleType.NVarChar,254).Value=m_ghichu;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
				cmd.Parameters.Add("m_ngay",OracleType.VarChar,16).Value=m_ngay;
				cmd.Parameters.Add("m_idgiuong",OracleType.Number).Value=m_idgiuong;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into datgiuong (mabn,ngay,idgiuong,ghichu,userid) values (:m_mabn,to_date(:m_ngay,'dd/mm/yyyy hh24:mi'),:m_idgiuong,:m_ghichu,:m_userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
					cmd.Parameters.Add("m_ngay",OracleType.VarChar,16).Value=m_ngay;
					cmd.Parameters.Add("m_idgiuong",OracleType.Number).Value=m_idgiuong;
					cmd.Parameters.Add("m_ghichu",OracleType.NVarChar,254).Value=m_ghichu;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"datgiuong");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_datgiuong(string m_mabn,string m_ngay,string m_den)
		{
			sql="update datgiuong set den=to_date(:m_den,'dd/mm/yyyy hh24:mi') where mabn=:m_mabn and to_char(ngay,'dd/mm/yyyy hh24:mi')=:m_ngay";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_den",OracleType.NVarChar,16).Value=m_den;
				cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
				cmd.Parameters.Add("m_ngay",OracleType.VarChar,16).Value=m_ngay;
				cmd.ExecuteNonQuery();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"datgiuong");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool bMagiuong(long id,string ma)
		{
			return get_data("select * from dmgiuong where ma='"+ma+"' and id<>"+id).Tables[0].Rows.Count>0;
		}

		public bool upd_ba_danhmuc(string m_table,long m_id,decimal m_stt,string m_ten,int m_userid)
		{
			sql="update "+m_table+" set stt=:m_stt,ten=:m_ten,userid=:m_userid where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
				cmd.Parameters.Add("m_ten",OracleType.NVarChar,100).Value=m_ten;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+m_table+" (id,stt,ten,userid) values (:m_id,:m_stt,:m_ten,:m_userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
					cmd.Parameters.Add("m_ten",OracleType.NVarChar,100).Value=m_ten;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,m_table);
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_danhmuc(long m_id,int m_loai,decimal m_stt,string m_ten)
		{
			sql="update ba_danhmuc set loai=:m_loai,stt=:m_stt,ten=:m_ten where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
				cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
				cmd.Parameters.Add("m_ten",OracleType.NVarChar,500).Value=m_ten;				
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into ba_danhmuc (id,loai,stt,ten) values (:m_id,:m_loai,:m_stt,:m_ten)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
					cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
					cmd.Parameters.Add("m_ten",OracleType.NVarChar,500).Value=m_ten;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_danhmuc");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_dmhoso(long m_id,decimal m_stt,string m_ten,int m_khac,int m_userid)
		{
			sql="update ba_dmhoso set stt=:m_stt,ten=:m_ten,khac=:m_khac,userid=:m_userid where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
				cmd.Parameters.Add("m_ten",OracleType.NVarChar,254).Value=m_ten;
				cmd.Parameters.Add("m_khac",OracleType.Number).Value=m_khac;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into ba_dmhoso (id,stt,ten,khac,userid) values (:m_id,:m_stt,:m_ten,:m_khac,:m_userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
					cmd.Parameters.Add("m_ten",OracleType.NVarChar,254).Value=m_ten;
					cmd.Parameters.Add("m_khac",OracleType.Number).Value=m_khac;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_dmhoso");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_dmxntienphau(long m_id,decimal m_stt,string m_ten,int m_mavp,int m_userid)
		{
			sql="update ba_dmxntienphau set stt=:m_stt,ten=:m_ten,mavp=:m_mavp,userid=:m_userid where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
				cmd.Parameters.Add("m_ten",OracleType.NVarChar,100).Value=m_ten;
				cmd.Parameters.Add("m_mavp",OracleType.Number).Value=m_mavp;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into ba_dmxntienphau (id,stt,ten,mavp,userid) values (:m_id,:m_stt,:m_ten,:m_mavp,:m_userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
					cmd.Parameters.Add("m_ten",OracleType.NVarChar,100).Value=m_ten;
					cmd.Parameters.Add("m_mavp",OracleType.Number).Value=m_mavp;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_dmxntienphau");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_dmchepham(long m_id,decimal m_stt,string m_ten,decimal m_handung,int m_userid)
		{
			sql="update ba_dmchepham set stt=:m_stt,ten=:m_ten,handung=:m_handung,userid=:m_userid where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
				cmd.Parameters.Add("m_ten",OracleType.NVarChar,100).Value=m_ten;
				cmd.Parameters.Add("m_handung",OracleType.Number).Value=m_handung;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into ba_dmchepham (id,stt,ten,handung,userid) values (:m_id,:m_stt,:m_ten,:m_handung,:m_userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
					cmd.Parameters.Add("m_ten",OracleType.NVarChar,100).Value=m_ten;
					cmd.Parameters.Add("m_handung",OracleType.Number).Value=m_handung;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_dmchepham");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_dmmau(long m_id,decimal m_stt,string m_ma,string m_ten,string m_dvt,int m_chepham,string m_thetich,int m_userid)
		{
			sql="update ba_dmmau set stt=:m_stt,ma=:m_ma,ten=:m_ten,dvt=:m_dvt,chepham=:m_chepham,thetich=:m_thetich,userid=:m_userid where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
				cmd.Parameters.Add("m_ma",OracleType.VarChar,10).Value=m_ma;
				cmd.Parameters.Add("m_ten",OracleType.NVarChar,100).Value=m_ten;
				cmd.Parameters.Add("m_dvt",OracleType.NVarChar,20).Value=m_dvt;
				cmd.Parameters.Add("m_chepham",OracleType.Number).Value=m_chepham;
				cmd.Parameters.Add("m_thetich",OracleType.NVarChar,20).Value=m_thetich;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into ba_dmmau (id,stt,ma,ten,dvt,chepham,thetich,userid) values (:m_id,:m_stt,:m_ma,:m_ten,:m_dvt,:m_chepham,:m_thetich,:m_userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
					cmd.Parameters.Add("m_ma",OracleType.VarChar,10).Value=m_ma;
					cmd.Parameters.Add("m_ten",OracleType.NVarChar,100).Value=m_ten;
					cmd.Parameters.Add("m_dvt",OracleType.NVarChar,20).Value=m_dvt;
					cmd.Parameters.Add("m_chepham",OracleType.Number).Value=m_chepham;
					cmd.Parameters.Add("m_thetich",OracleType.NVarChar,20).Value=m_thetich;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_dmmau");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_thuchien(string m_ngay,long m_id,string m_mabn,long m_maql,long m_idkhoa,string m_makp,string m_phong,string m_giuong,string m_chandoan)
		{
			string xxx = user + mmyy(m_ngay);
			sql="update "+xxx+".ba_thuchien set mabn=:m_mabn,maql=:m_maql,idkhoa=:m_idkhoa,makp=:m_makp,phong=:m_phong,giuong=:m_giuong,chandoan=:m_chandoan where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				cmd.Parameters.Add("m_idkhoa",OracleType.Number).Value=m_idkhoa;
				cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
				cmd.Parameters.Add("m_phong",OracleType.VarChar,10).Value=m_phong;
				cmd.Parameters.Add("m_giuong",OracleType.VarChar,20).Value=m_giuong;
				cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,254).Value=m_chandoan;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_thuchien (id,mabn,maql,idkhoa,makp,phong,giuong,chandoan) values (:m_id,:m_mabn,:m_maql,:m_idkhoa,:m_makp,:m_phong,:m_giuong,:m_chandoan)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_idkhoa",OracleType.Number).Value=m_idkhoa;
					cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
					cmd.Parameters.Add("m_phong",OracleType.VarChar,10).Value=m_phong;
					cmd.Parameters.Add("m_giuong",OracleType.VarChar,20).Value=m_giuong;
					cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,254).Value=m_chandoan;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_thuchien");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_chung(string m_ngay,long m_id,long m_idthuchien,string m_lydo,decimal m_lanthu,string m_hb_benhly,string m_hb_banthan,string m_hb_giadinh,string m_kb_toanthan,string m_kb_ngoai,string m_kb_tuanhoan,string m_kb_hohap,string m_kb_tieuhoa,string m_kb_than,string m_kb_thankinh,string m_kb_co,string m_kb_tmh,string m_kb_rhm,string m_kb_mat,string m_kb_noitiet,string m_kb_khac,string m_kb_tomtat,string m_phanbiet,string m_tienluong,string m_dieutri,string m_bslba,string m_tk_benhly,string m_tk_tomtat,string m_tk_phuongphap,string m_tk_tinhtrang,string m_tk_dieutri,string m_nguoigiao,string m_nguoinhan,string m_mabs,int m_userid)
		{
			string xxx = user + mmyy(m_ngay);
			sql="update "+xxx+".ba_chung set idthuchien=:m_idthuchien,lydo=:m_lydo,lanthu=:m_lanthu,hb_benhly=:m_hb_benhly,";
			sql+="hb_banthan=:m_hb_banthan,hb_giadinh=:m_hb_giadinh,kb_toanthan=:m_kb_toanthan,kb_ngoai=:m_kb_ngoai,";
			sql+="kb_tuanhoan=:m_kb_tuanhoan,kb_hohap=:m_kb_hohap,kb_tieuhoa=:m_kb_tieuhoa,kb_than=:m_kb_than,";
			sql+="kb_thankinh=:m_kb_thankinh,kb_co=:m_kb_co,kb_tmh=:m_kb_tmh,kb_rhm=:m_kb_rhm,kb_mat=:m_kb_mat,";
			sql+="kb_noitiet=:m_kb_noitiet,kb_khac=:m_kb_khac,kb_tomtat=:m_kb_tomtat,phanbiet=:m_phanbiet,";
			sql+="tienluong=:m_tienluong,dieutri=:m_dieutri,bslban=:m_bslban,tk_benhly=:m_tk_benhly,tk_tomtat=:m_tk_tomtat,";
			sql+="tk_phuongphap=:m_tk_phuongphap,tk_tinhtrang=:m_tk_tinhtrang,tk_dieutri=:m_tk_dieutri,nguoigiao=:m_nguoigiao,nguoinhan=:m_nguoinhan,";
			sql+="mabs=:m_mabs,userid=:m_userid where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_idthuchien",OracleType.Number).Value=m_idthuchien;
				cmd.Parameters.Add("m_lydo",OracleType.NVarChar,500).Value=m_lydo;
				cmd.Parameters.Add("m_lanthu",OracleType.Number).Value=m_lanthu;
				cmd.Parameters.Add("m_hb_benhly",OracleType.NVarChar,2000).Value=m_hb_benhly;
				cmd.Parameters.Add("m_hb_banthan",OracleType.NVarChar,2000).Value=m_hb_banthan;
				cmd.Parameters.Add("m_hb_giadinh",OracleType.NVarChar,2000).Value=m_hb_giadinh;
				cmd.Parameters.Add("m_kb_toanthan",OracleType.NVarChar,500).Value=m_kb_toanthan;
				cmd.Parameters.Add("m_kb_ngoai",OracleType.NVarChar,500).Value=m_kb_ngoai;
				cmd.Parameters.Add("m_kb_tuanhoan",OracleType.NVarChar,500).Value=m_kb_tuanhoan;
				cmd.Parameters.Add("m_kb_hohap",OracleType.NVarChar,500).Value=m_kb_hohap;
				cmd.Parameters.Add("m_kb_tieuhoa",OracleType.NVarChar,500).Value=m_kb_tieuhoa;
				cmd.Parameters.Add("m_kb_than",OracleType.NVarChar,500).Value=m_kb_than;
				cmd.Parameters.Add("m_kb_thankinh",OracleType.NVarChar,500).Value=m_kb_thankinh;
				cmd.Parameters.Add("m_kb_co",OracleType.NVarChar,500).Value=m_kb_co;
				cmd.Parameters.Add("m_kb_tmh",OracleType.NVarChar,500).Value=m_kb_tmh;
				cmd.Parameters.Add("m_kb_rhm",OracleType.NVarChar,500).Value=m_kb_rhm;
				cmd.Parameters.Add("m_kb_mat",OracleType.NVarChar,500).Value=m_kb_mat;
				cmd.Parameters.Add("m_kb_noitiet",OracleType.NVarChar,500).Value=m_kb_noitiet;
				cmd.Parameters.Add("m_kb_khac",OracleType.NVarChar,500).Value=m_kb_khac;
				cmd.Parameters.Add("m_kb_tomtat",OracleType.NVarChar,2000).Value=m_kb_tomtat;
				cmd.Parameters.Add("m_phanbiet",OracleType.NVarChar,500).Value=m_phanbiet;
				cmd.Parameters.Add("m_tienluong",OracleType.NVarChar,500).Value=m_tienluong;
				cmd.Parameters.Add("m_dieutri",OracleType.NVarChar,500).Value=m_dieutri;
				cmd.Parameters.Add("m_bslban",OracleType.VarChar,4).Value=m_bslba;
				cmd.Parameters.Add("m_tk_benhly",OracleType.NVarChar,2000).Value=m_tk_benhly;
				cmd.Parameters.Add("m_tk_tomtat",OracleType.NVarChar,2000).Value=m_tk_tomtat;
				cmd.Parameters.Add("m_tk_phuongphap",OracleType.NVarChar,500).Value=m_tk_phuongphap;
				cmd.Parameters.Add("m_tk_tinhtrang",OracleType.NVarChar,500).Value=m_tk_tinhtrang;
				cmd.Parameters.Add("m_tk_dieutri",OracleType.NVarChar,500).Value=m_tk_dieutri;
				cmd.Parameters.Add("m_nguoigiao",OracleType.VarChar,4).Value=m_nguoigiao;
				cmd.Parameters.Add("m_nguoinhan",OracleType.VarChar,4).Value=m_nguoinhan;
				cmd.Parameters.Add("m_mabs",OracleType.VarChar,4).Value=m_mabs;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_chung (id,idthuchien,lydo,lanthu,hb_benhly,hb_banthan,hb_giadinh,kb_toanthan,kb_ngoai,kb_tuanhoan,kb_hohap,kb_tieuhoa,kb_than,kb_thankinh,kb_co,kb_tmh,kb_rhm,kb_mat,kb_noitiet,kb_khac,kb_tomtat,phanbiet,tienluong,dieutri,bslban,tk_benhly,tk_tomtat,tk_phuongphap,tk_tinhtrang,tk_dieutri,nguoigiao,nguoinhan,mabs,userid) values (:m_id,:m_idthuchien,:m_lydo,:m_lanthu,:m_hb_benhly,:m_hb_banthan,:m_hb_giadinh,:m_kb_toanthan,:m_kb_ngoai,:m_kb_tuanhoan,:m_kb_hohap,:m_kb_tieuhoa,:m_kb_than,:m_kb_thankinh,:m_kb_co,:m_kb_tmh,:m_kb_rhm,:m_kb_mat,:m_kb_noitiet,:m_kb_khac,:m_kb_tomtat,:m_phanbiet,:m_tienluong,:m_dieutri,:m_bslban,:m_tk_benhly,:m_tk_tomtat,:m_tk_phuongphap,:m_tk_tinhtrang,:m_tk_dieutri,:m_nguoigiao,:m_nguoinhan,:m_mabs,:m_userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_idthuchien",OracleType.Number).Value=m_idthuchien;
					cmd.Parameters.Add("m_lydo",OracleType.NVarChar,500).Value=m_lydo;
					cmd.Parameters.Add("m_lanthu",OracleType.Number).Value=m_lanthu;
					cmd.Parameters.Add("m_hb_benhly",OracleType.NVarChar,2000).Value=m_hb_benhly;
					cmd.Parameters.Add("m_hb_banthan",OracleType.NVarChar,2000).Value=m_hb_banthan;
					cmd.Parameters.Add("m_hb_giadinh",OracleType.NVarChar,2000).Value=m_hb_giadinh;
					cmd.Parameters.Add("m_kb_toanthan",OracleType.NVarChar,500).Value=m_kb_toanthan;
					cmd.Parameters.Add("m_kb_ngoai",OracleType.NVarChar,500).Value=m_kb_ngoai;
					cmd.Parameters.Add("m_kb_tuanhoan",OracleType.NVarChar,500).Value=m_kb_tuanhoan;
					cmd.Parameters.Add("m_kb_hohap",OracleType.NVarChar,500).Value=m_kb_hohap;
					cmd.Parameters.Add("m_kb_tieuhoa",OracleType.NVarChar,500).Value=m_kb_tieuhoa;
					cmd.Parameters.Add("m_kb_than",OracleType.NVarChar,500).Value=m_kb_than;
					cmd.Parameters.Add("m_kb_thankinh",OracleType.NVarChar,500).Value=m_kb_thankinh;
					cmd.Parameters.Add("m_kb_co",OracleType.NVarChar,500).Value=m_kb_co;
					cmd.Parameters.Add("m_kb_tmh",OracleType.NVarChar,500).Value=m_kb_tmh;
					cmd.Parameters.Add("m_kb_rhm",OracleType.NVarChar,500).Value=m_kb_rhm;
					cmd.Parameters.Add("m_kb_mat",OracleType.NVarChar,500).Value=m_kb_mat;
					cmd.Parameters.Add("m_kb_noitiet",OracleType.NVarChar,500).Value=m_kb_noitiet;
					cmd.Parameters.Add("m_kb_khac",OracleType.NVarChar,500).Value=m_kb_khac;
					cmd.Parameters.Add("m_kb_tomtat",OracleType.NVarChar,2000).Value=m_kb_tomtat;
					cmd.Parameters.Add("m_phanbiet",OracleType.NVarChar,500).Value=m_phanbiet;
					cmd.Parameters.Add("m_tienluong",OracleType.NVarChar,500).Value=m_tienluong;
					cmd.Parameters.Add("m_dieutri",OracleType.NVarChar,500).Value=m_dieutri;
					cmd.Parameters.Add("m_bslban",OracleType.VarChar,4).Value=m_bslba;
					cmd.Parameters.Add("m_tk_benhly",OracleType.NVarChar,2000).Value=m_tk_benhly;
					cmd.Parameters.Add("m_tk_tomtat",OracleType.NVarChar,2000).Value=m_tk_tomtat;
					cmd.Parameters.Add("m_tk_phuongphap",OracleType.NVarChar,500).Value=m_tk_phuongphap;
					cmd.Parameters.Add("m_tk_tinhtrang",OracleType.NVarChar,500).Value=m_tk_tinhtrang;
					cmd.Parameters.Add("m_tk_dieutri",OracleType.NVarChar,500).Value=m_tk_dieutri;
					cmd.Parameters.Add("m_nguoigiao",OracleType.VarChar,4).Value=m_nguoigiao;
					cmd.Parameters.Add("m_nguoinhan",OracleType.VarChar,4).Value=m_nguoinhan;
					cmd.Parameters.Add("m_mabs",OracleType.VarChar,4).Value=m_mabs;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_chung");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_hinh(string m_ngay,long m_id,int m_stt,byte[] m_image)
		{
			string xxx = user + mmyy(m_ngay);
			sql="update "+xxx+".ba_hinh set image=:m_image where id=:m_id and stt=:m_stt";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_image",OracleType.Blob,m_image.Length).Value=m_image;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_hinh (id,stt,image) values (:m_id,:m_stt,:m_image)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
					cmd.Parameters.Add("m_image",OracleType.Blob,m_image.Length).Value=m_image;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_hinh");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_hinh(long m_id,int m_stt,string m_ten,byte[] m_image)
		{
			sql="update ba_hinh set ten=:m_ten,image=:m_image where id=:m_id and stt=:m_stt";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_ten",OracleType.NVarChar,254).Value=m_ten;
				cmd.Parameters.Add("m_image",OracleType.Blob,m_image.Length).Value=m_image;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into ba_hinh (id,stt,ten,image) values (:m_id,:m_stt,:m_ten,:m_image)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
					cmd.Parameters.Add("m_ten",OracleType.NVarChar,254).Value=m_ten;
					cmd.Parameters.Add("m_image",OracleType.Blob,m_image.Length).Value=m_image;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_hinh");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_hbdacdiem(string m_ngay,long m_id,int m_ma,string m_thoigian)
		{
			string xxx = user + mmyy(m_ngay);
			sql="update "+xxx+".ba_hbdacdiem set thoigian=:m_thoigian where id=:m_id and ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_thoigian",OracleType.NVarChar,100).Value=m_thoigian;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_hbdacdiem (id,ma,thoigian) values (:m_id,:m_ma,:m_thoigian)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_thoigian",OracleType.NVarChar,100).Value=m_thoigian;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_hbdacdiem");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_kbdausinhton(string m_ngay,long m_id,decimal m_mach,decimal m_nhietdo,string m_huyetap,decimal m_nhiptho,decimal m_cannang,decimal m_chieucao)
		{
			string xxx = user + mmyy(m_ngay);
			sql="update "+xxx+".ba_kbdausinhton set mach=:m_mach,nhietdo=:m_nhietdo,huyetap=:m_huyetap,nhiptho=:m_nhiptho,cannang=:m_cannang,chieucao=:m_chieucao where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_mach",OracleType.Number).Value=m_mach;
				cmd.Parameters.Add("m_nhietdo",OracleType.Number).Value=m_nhietdo;
				cmd.Parameters.Add("m_huyetap",OracleType.VarChar,7).Value=m_huyetap;
				cmd.Parameters.Add("m_nhiptho",OracleType.Number).Value=m_nhiptho;
				cmd.Parameters.Add("m_cannang",OracleType.Number).Value=m_cannang;
				cmd.Parameters.Add("m_chieucao",OracleType.Number).Value=m_chieucao;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_kbdausinhton (id,mach,nhietdo,huyetap,nhiptho,cannang,chieucao) values (:m_id,:m_mach,:m_nhietdo,:m_huyetap,:m_nhiptho,:m_cannang,:m_chieucao)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_mach",OracleType.Number).Value=m_mach;
					cmd.Parameters.Add("m_nhietdo",OracleType.Number).Value=m_nhietdo;
					cmd.Parameters.Add("m_huyetap",OracleType.VarChar,7).Value=m_huyetap;
					cmd.Parameters.Add("m_nhiptho",OracleType.Number).Value=m_nhiptho;
					cmd.Parameters.Add("m_cannang",OracleType.Number).Value=m_cannang;
					cmd.Parameters.Add("m_chieucao",OracleType.Number).Value=m_chieucao;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_kbdausinhton");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_tkhoso(string m_ngay,long m_id,int m_ma,string m_khac,decimal m_so)
		{
			string xxx = user + mmyy(m_ngay);
			sql="update "+xxx+".ba_tkhoso set khac=:m_khac,so=:m_so where id=:m_id and ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_khac",OracleType.NVarChar,254).Value=m_khac;
				cmd.Parameters.Add("m_so",OracleType.Number).Value=m_so;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_tkhoso (id,ma,khac,so) values (:m_id,:m_ma,:m_khac,:m_so)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_khac",OracleType.NVarChar,254).Value=m_khac;
					cmd.Parameters.Add("m_so",OracleType.Number).Value=m_so;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_tkhoso");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_hoichancc(string m_ngayvv,long m_id,long m_idthuchien,string m_ngay,string m_ngaymo,string m_mamau,string m_tenpt,int m_nhommau,int m_rh,decimal m_mau,string m_xnkhac,
			string m_ptdutru,string m_ptchinh,string m_ptphu,int m_phuongphap,string m_tuthe,string m_ykien,string m_bstruongk,
			string m_bstruong,string m_ptv,string m_tiensu,string m_tim,string m_phoi,string m_tienluong,string m_khac,string m_cotsong,
			string m_thankinh,string m_anlancuoi,
			string m_asa,string m_glodmann,string m_mallampati,string m_bsgayme,string m_bstruonggmhs,int m_userid)
		{
			string xxx = user + mmyy(m_ngayvv);
			sql="update "+xxx+".ba_hoichancc set idthuchien=:m_idthuchien,ngay=to_date(:m_ngay,'dd/mm/yyyy hh24:mi'),ngaymo=to_date(:m_ngaymo,'dd/mm/yyyy hh24:mi'),";
			sql+="mamau=:m_mamau,tenpt=:m_tenpt,nhommau=:m_nhommau,rh=:m_rh,mau=:m_mau,ptdutru=:m_ptdutru,ptchinh=:m_ptchinh,phuongphap=:m_phuongphap,";
			sql+="tuthe=:m_tuthe,bstruong=:m_bstruong,ptv=:m_ptv,tiensu=:m_tiensu,tim=:m_tim,phoi=:m_phoi,";
			sql+="tienluong=:m_tienluong,khac=:m_khac,cotsong=:m_cotsong,thankinh=:m_thankinh,anlancuoi=:m_anlancuoi,";
			sql+="asa=:m_asa,glodmann=:m_glodmann,mallampati=:m_mallampati,";
			sql+="bsgayme=:m_bsgayme,bstruonggmhs=:m_bstruonggmhs,userid=:m_userid where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_idthuchien",OracleType.Number).Value=m_idthuchien;
				cmd.Parameters.Add("m_ngay",OracleType.VarChar,16).Value=m_ngay;
				cmd.Parameters.Add("m_ngaymo",OracleType.VarChar,16).Value=m_ngaymo;
				cmd.Parameters.Add("m_mamau",OracleType.VarChar,10).Value=m_mamau;
				cmd.Parameters.Add("m_tenpt",OracleType.NVarChar,254).Value=m_tenpt;
				cmd.Parameters.Add("m_nhommau",OracleType.Number).Value=m_nhommau;
				cmd.Parameters.Add("m_rh",OracleType.Number).Value=m_rh;
				cmd.Parameters.Add("m_mau",OracleType.Number).Value=m_mau;
				cmd.Parameters.Add("m_ptdutru",OracleType.VarChar,4).Value=m_ptdutru;
				cmd.Parameters.Add("m_ptchinh",OracleType.VarChar,4).Value=m_ptchinh;
				cmd.Parameters.Add("m_phuongphap",OracleType.Number).Value=m_phuongphap;
				cmd.Parameters.Add("m_tuthe",OracleType.NVarChar,254).Value=m_tuthe;
				cmd.Parameters.Add("m_bstruong",OracleType.VarChar,4).Value=m_bstruong;
				cmd.Parameters.Add("m_ptv",OracleType.VarChar,4).Value=m_ptv;
				cmd.Parameters.Add("m_tiensu",OracleType.NVarChar,1000).Value=m_tiensu;
				cmd.Parameters.Add("m_tim",OracleType.NVarChar,500).Value=m_tim;
				cmd.Parameters.Add("m_phoi",OracleType.NVarChar,500).Value=m_phoi;
				cmd.Parameters.Add("m_tienluong",OracleType.NVarChar,500).Value=m_tienluong;
				cmd.Parameters.Add("m_khac",OracleType.NVarChar,500).Value=m_khac;
				cmd.Parameters.Add("m_cotsong",OracleType.NVarChar,500).Value=m_cotsong;
				cmd.Parameters.Add("m_thankinh",OracleType.NVarChar,254).Value=m_thankinh;
				cmd.Parameters.Add("m_anlancuoi",OracleType.NVarChar,254).Value=m_anlancuoi;
				cmd.Parameters.Add("m_asa",OracleType.VarChar,3).Value=m_asa;
				cmd.Parameters.Add("m_glodmann",OracleType.VarChar,3).Value=m_glodmann;
				cmd.Parameters.Add("m_mallampati",OracleType.VarChar,3).Value=m_mallampati;
				cmd.Parameters.Add("m_bsgayme",OracleType.VarChar,4).Value=m_bsgayme;
				cmd.Parameters.Add("m_bstruonggmhs",OracleType.VarChar,4).Value=m_bstruonggmhs;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_hoichancc (id,idthuchien,ngay,ngaymo,mamau,tenpt,nhommau,rh,mau,ptdutru,ptchinh,phuongphap,tuthe,bstruong,ptv,tiensu,tim,phoi,tienluong,khac,cotsong,thankinh,anlancuoi,asa,glodmann,mallampati,bsgayme,bstruonggmhs,userid) values (:m_id,:m_idthuchien,to_date(:m_ngay,'dd/mm/yyyy hh24:mi'),to_date(:m_ngaymo,'dd/mm/yyyy hh24:mi'),:m_mamau,:m_tenpt,:m_nhommau,:m_rh,:m_mau,:m_ptdutru,:m_ptchinh,:m_phuongphap,:m_tuthe,:m_bstruong,:m_ptv,:m_tiensu,:m_tim,:m_phoi,:m_tienluong,:m_khac,:m_cotsong,:m_thankinh,:m_anlancuoi,:m_asa,:m_glodmann,:m_mallampati,:m_bsgayme,:m_bstruonggmhs,:m_userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_idthuchien",OracleType.Number).Value=m_idthuchien;
					cmd.Parameters.Add("m_ngay",OracleType.VarChar,16).Value=m_ngay;
					cmd.Parameters.Add("m_ngaymo",OracleType.VarChar,16).Value=m_ngaymo;
					cmd.Parameters.Add("m_mamau",OracleType.VarChar,10).Value=m_mamau;
					cmd.Parameters.Add("m_tenpt",OracleType.NVarChar,254).Value=m_tenpt;
					cmd.Parameters.Add("m_nhommau",OracleType.Number).Value=m_nhommau;
					cmd.Parameters.Add("m_rh",OracleType.Number).Value=m_rh;
					cmd.Parameters.Add("m_mau",OracleType.Number).Value=m_mau;
					cmd.Parameters.Add("m_ptdutru",OracleType.VarChar,4).Value=m_ptdutru;
					cmd.Parameters.Add("m_ptchinh",OracleType.VarChar,4).Value=m_ptchinh;
					cmd.Parameters.Add("m_phuongphap",OracleType.Number).Value=m_phuongphap;
					cmd.Parameters.Add("m_tuthe",OracleType.NVarChar,254).Value=m_tuthe;
					cmd.Parameters.Add("m_bstruong",OracleType.VarChar,4).Value=m_bstruong;
					cmd.Parameters.Add("m_ptv",OracleType.VarChar,4).Value=m_ptv;
					cmd.Parameters.Add("m_tiensu",OracleType.NVarChar,1000).Value=m_tiensu;
					cmd.Parameters.Add("m_tim",OracleType.NVarChar,500).Value=m_tim;
					cmd.Parameters.Add("m_phoi",OracleType.NVarChar,500).Value=m_phoi;
					cmd.Parameters.Add("m_tienluong",OracleType.NVarChar,500).Value=m_tienluong;
					cmd.Parameters.Add("m_khac",OracleType.NVarChar,500).Value=m_khac;
					cmd.Parameters.Add("m_cotsong",OracleType.NVarChar,500).Value=m_cotsong;
					cmd.Parameters.Add("m_thankinh",OracleType.NVarChar,254).Value=m_thankinh;
					cmd.Parameters.Add("m_anlancuoi",OracleType.NVarChar,254).Value=m_anlancuoi;
					cmd.Parameters.Add("m_asa",OracleType.VarChar,3).Value=m_asa;
					cmd.Parameters.Add("m_glodmann",OracleType.VarChar,3).Value=m_glodmann;
					cmd.Parameters.Add("m_mallampati",OracleType.VarChar,3).Value=m_mallampati;
					cmd.Parameters.Add("m_bsgayme",OracleType.VarChar,4).Value=m_bsgayme;
					cmd.Parameters.Add("m_bstruonggmhs",OracleType.VarChar,4).Value=m_bstruonggmhs;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_hoichancc");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_hoichanccxn(string m_ngay,long m_id,int m_ma,int m_tinhtrang)
		{
			string xxx = user + mmyy(m_ngay);
			sql="update "+xxx+".ba_hoichanccxn set tinhtrang=:m_tinhtrang where id=:m_id and ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_tinhtrang",OracleType.Number).Value=m_tinhtrang;				
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_hoichanccxn (id,ma,tinhtrang) values (:m_id,:m_ma,:m_tinhtrang)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_tinhtrang",OracleType.Number).Value=m_tinhtrang;				
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_hoichanccxn");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}
		public bool upd_dmmucdo(int d_id, string d_ten)
		{//gam 01/03/2012
			sql="update dmmucdo set ten=:d_ten where id=:d_id ";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("d_ten",OracleType.VarChar,100).Value=d_ten;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into dmmucdo(ten,id) values (:d_ten,:d_id)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("d_ten",OracleType.VarChar,100).Value=d_ten;
					cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
					cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"dmmucdo");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();
			}
			return true;
		}


		public bool upd_dmketquapu(int d_id, string d_ten)
		{//gam 01/03/2012
			sql="update dmketquapu set ten=:d_ten where id=:d_id ";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("d_ten",OracleType.VarChar,100).Value=d_ten;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into dmketquapu(ten,id) values (:d_ten,:d_id)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("d_ten",OracleType.VarChar,100).Value=d_ten;
					cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
					cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"dmketquapu");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();
			}
			return true;
		}


		public bool upd_ba_hoichan(string m_ngayvv,long m_id,long m_idthuchien,string m_ngay,string m_ngaymo,string m_mamau,string m_tenpt,
			string m_thoigian,int m_sonde,int m_nhommau,int m_rh,decimal m_mau,string m_xnkhac,string m_ptdutru,string m_ptchinh,
			string m_ptphu,int m_phuongphap,string m_tuthe,int m_xq,string m_dungcu,string m_khac,string m_ykien,
			string m_giamdoc,string m_khth,string m_gayme,string m_bstruongk,string m_ptv,int m_userid)
		{
			string xxx = user + mmyy(m_ngayvv);
			sql="update "+xxx+".ba_hoichan set idthuchien=:m_idthuchien,ngay=to_date(:m_ngay,'dd/mm/yyyy'),";
			sql+="ngaymo=to_date(:m_ngaymo,'dd/mm/yyyy hh24:mi'),mamau=:m_mamau,tenpt=:m_tenpt,thoigian=:m_thoigian,sonde=:m_sonde,nhommau=:m_nhommau,";
			sql+="rh=:m_rh,mau=:m_mau,xnkhac=:m_xnkhac,ptdutru=:m_ptdutru,ptchinh=:m_ptchinh,ptphu=:m_ptphu,";
			sql+="phuongphap=:m_phuongphap,tuthe=:m_tuthe,xq=:m_xq,dungcu=:m_dungcu,khac=:m_khac,ykien=:m_ykien,";
			sql+="giamdoc=:m_giamdoc,khth=:m_khth,gayme=:m_gayme,bstruongk=:m_bstruongk,ptv=:m_ptv,userid=:m_userid where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_idthuchien",OracleType.Number).Value=m_idthuchien;
				cmd.Parameters.Add("m_ngay",OracleType.VarChar,10).Value=m_ngay;
				cmd.Parameters.Add("m_ngaymo",OracleType.VarChar,16).Value=m_ngaymo;
				cmd.Parameters.Add("m_mamau",OracleType.VarChar,10).Value=m_mamau;
				cmd.Parameters.Add("m_tenpt",OracleType.NVarChar,254).Value=m_tenpt;
				cmd.Parameters.Add("m_thoigian",OracleType.NVarChar,50).Value=m_thoigian;
				cmd.Parameters.Add("m_sonde",OracleType.Number).Value=m_sonde;
				cmd.Parameters.Add("m_nhommau",OracleType.Number).Value=m_nhommau;
				cmd.Parameters.Add("m_rh",OracleType.Number).Value=m_rh;
				cmd.Parameters.Add("m_mau",OracleType.Number).Value=m_mau;
				cmd.Parameters.Add("m_xnkhac",OracleType.NVarChar,500).Value=m_xnkhac;
				cmd.Parameters.Add("m_ptdutru",OracleType.VarChar,4).Value=m_ptdutru;
				cmd.Parameters.Add("m_ptchinh",OracleType.VarChar,4).Value=m_ptchinh;
				cmd.Parameters.Add("m_ptphu",OracleType.VarChar,4).Value=m_ptphu;
				cmd.Parameters.Add("m_phuongphap",OracleType.Number).Value=m_phuongphap;
				cmd.Parameters.Add("m_tuthe",OracleType.NVarChar,254).Value=m_tuthe;
				cmd.Parameters.Add("m_xq",OracleType.Number).Value=m_xq;
				cmd.Parameters.Add("m_dungcu",OracleType.NVarChar,254).Value=m_dungcu;
				cmd.Parameters.Add("m_khac",OracleType.NVarChar,254).Value=m_khac;
				cmd.Parameters.Add("m_ykien",OracleType.NVarChar,1000).Value=m_ykien;
				cmd.Parameters.Add("m_giamdoc",OracleType.VarChar,4).Value=m_giamdoc;
				cmd.Parameters.Add("m_khth",OracleType.VarChar,4).Value=m_khth;
				cmd.Parameters.Add("m_gayme",OracleType.VarChar,4).Value=m_gayme;
				cmd.Parameters.Add("m_bstruongk",OracleType.VarChar,4).Value=m_bstruongk;
				cmd.Parameters.Add("m_ptv",OracleType.VarChar,4).Value=m_ptv;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_hoichan (id,idthuchien,ngay,ngaymo,mamau,tenpt,thoigian,sonde,nhommau,rh,mau,xnkhac,ptdutru,ptchinh,ptphu,phuongphap,tuthe,xq,dungcu,khac,ykien,giamdoc,khth,gayme,bstruongk,ptv,userid) values (:m_id,:m_idthuchien,to_date(:m_ngay,'dd/mm/yyyy'),to_date(:m_ngaymo,'dd/mm/yyyy hh24:mi'),:m_mamau,:m_tenpt,:m_thoigian,:m_sonde,:m_nhommau,:m_rh,:m_mau,:m_xnkhac,:m_ptdutru,:m_ptchinh,:m_ptphu,:m_phuongphap,:m_tuthe,:m_xq,:m_dungcu,:m_khac,:m_ykien,:m_giamdoc,:m_khth,:m_gayme,:m_bstruongk,:m_ptv,:m_userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_idthuchien",OracleType.Number).Value=m_idthuchien;
					cmd.Parameters.Add("m_ngay",OracleType.VarChar,10).Value=m_ngay;
					cmd.Parameters.Add("m_ngaymo",OracleType.VarChar,16).Value=m_ngaymo;
					cmd.Parameters.Add("m_mamau",OracleType.VarChar,10).Value=m_mamau;
					cmd.Parameters.Add("m_tenpt",OracleType.NVarChar,254).Value=m_tenpt;
					cmd.Parameters.Add("m_thoigian",OracleType.NVarChar,50).Value=m_thoigian;
					cmd.Parameters.Add("m_sonde",OracleType.Number).Value=m_sonde;
					cmd.Parameters.Add("m_nhommau",OracleType.Number).Value=m_nhommau;
					cmd.Parameters.Add("m_rh",OracleType.Number).Value=m_rh;
					cmd.Parameters.Add("m_mau",OracleType.Number).Value=m_mau;
					cmd.Parameters.Add("m_xnkhac",OracleType.NVarChar,500).Value=m_xnkhac;
					cmd.Parameters.Add("m_ptdutru",OracleType.VarChar,4).Value=m_ptdutru;
					cmd.Parameters.Add("m_ptchinh",OracleType.VarChar,4).Value=m_ptchinh;
					cmd.Parameters.Add("m_ptphu",OracleType.VarChar,4).Value=m_ptphu;
					cmd.Parameters.Add("m_phuongphap",OracleType.Number).Value=m_phuongphap;
					cmd.Parameters.Add("m_tuthe",OracleType.NVarChar,254).Value=m_tuthe;
					cmd.Parameters.Add("m_xq",OracleType.Number).Value=m_xq;
					cmd.Parameters.Add("m_dungcu",OracleType.NVarChar,254).Value=m_dungcu;
					cmd.Parameters.Add("m_khac",OracleType.NVarChar,254).Value=m_khac;
					cmd.Parameters.Add("m_ykien",OracleType.NVarChar,1000).Value=m_ykien;
					cmd.Parameters.Add("m_giamdoc",OracleType.VarChar,4).Value=m_giamdoc;
					cmd.Parameters.Add("m_khth",OracleType.VarChar,4).Value=m_khth;
					cmd.Parameters.Add("m_gayme",OracleType.VarChar,4).Value=m_gayme;
					cmd.Parameters.Add("m_bstruongk",OracleType.VarChar,4).Value=m_bstruongk;
					cmd.Parameters.Add("m_ptv",OracleType.VarChar,4).Value=m_ptv;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_hoichan");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_hoichanxn(string m_ngay,long m_id,int m_ma,int m_tinhtrang)
		{
			string xxx = user + mmyy(m_ngay);
			sql="update "+xxx+".ba_hoichanxn set tinhtrang=:m_tinhtrang where id=:m_id and ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_tinhtrang",OracleType.Number).Value=m_tinhtrang;				
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_hoichanxn (id,ma,tinhtrang) values (:m_id,:m_ma,:m_tinhtrang)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_tinhtrang",OracleType.Number).Value=m_tinhtrang;				
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_hoichanxn");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_khamtienme(string m_ngayvv,long m_id,string m_ngay,string m_mo,int m_mete,int m_taibien,
			int m_truyenmau,string m_diung,string m_bieuhien,int m_thuocla,int m_ruou,int m_matuy,int m_caoha,
			int m_thatnguc,int m_nmct,int m_suytim,int m_timbamsinh,int m_lao,int m_phequan,int m_horamau,
			int m_copd,int m_hh_khac,int m_tamthan,int m_dongkinh,int m_tbmmn,int m_buouco,int m_maukdong,
			int m_tieuduong,int m_hethong,int m_tk_khac,int m_cauthan,int m_suythan,int m_soithan,int m_tn_khac,
			int m_vangda,int m_viemgan,int m_tieuhoa,int m_thuongvi,int m_th_khac,string m_giadinh,string m_chitiet,
			int m_map,int m_phu,int m_hong,int m_nhot,int m_yeu,int m_khotho,decimal m_glasgow,decimal m_mach,
			string m_huyetap,decimal m_nhietdo,decimal m_nhiptho,decimal m_cannang,decimal m_chieucao,int m_hanche,int m_congan,
			int m_luoito,int m_khoiu,int m_giap,int m_cungham,int m_seo,int m_ranggia,string m_tl_khac,
			int m_timmach,int m_hohap,int m_than,int m_k_tieuhoa,int m_k_khac,int m_gu,int m_cungcotsong,
			int m_cotsongcu,string m_canlamsang,string m_dieutri,string m_denghi,string m_asa,string m_glodmann,
			string m_mallampati,string m_dukien,string m_thuthuat,string m_ketluan,string m_mabs)
		{
			string xxx = user + mmyy(m_ngayvv);
			sql="update "+xxx+".ba_khamtienme set ngay=to_date(:m_ngay,'dd/mm/yyyy'),mo=:m_mo,mete=:m_mete,taibien=:m_taibien,";
			sql+="truyenmau=:m_truyenmau,diung=:m_diung,bieuhien=:m_bieuhien,thuocla=:m_thuocla,ruou=:m_ruou,matuy=:m_matuy,caoha=:m_caoha,";
			sql+="thatnguc=:m_thatnguc,nmct=:m_nmct,suytim=:m_suytim,timbamsinh=:m_timbamsinh,lao=:m_lao,phequan=:m_phequan,horamau=:m_horamau,";
			sql+="copd=:m_copd,hh_khac=:m_hh_khac,tamthan=:m_tamthan,dongkinh=:m_dongkinh,tbmmn=:m_tbmmn,buouco=:m_buouco,maukdong=:m_maukdong,";
			sql+="tieuduong=:m_tieuduong,hethong=:m_hethong,tk_khac=:m_tk_khac,cauthan=:m_cauthan,suythan=:m_suythan,soithan=:m_soithan,tn_khac=:m_tn_khac,";
			sql+="vangda=:m_vangda,viemgan=:m_viemgan,tieuhoa=:m_tieuhoa,thuongvi=:m_thuongvi,th_khac=:m_th_khac,giadinh=:m_giadinh,chitiet=:m_chitiet,";
			sql+="map=:m_map,phu=:m_phu,hong=:m_hong,nhot=:m_nhot,yeu=:m_yeu,khotho=:m_khotho,glasgow=:m_glasgow,mach=:m_mach,";
			sql+="huyetap=:m_huyetap,nhietdo=:m_nhietdo,nhiptho=:m_nhiptho,cannang=:m_cannang,chieucao=:m_chieucao,hanche=:m_hanche,congan=:m_congan,";
			sql+="luoito=:m_luoito,khoiu=:m_khoiu,giap=:m_giap,cungham=:m_cungham,seo=:m_seo,ranggia=:m_ranggia,tl_khac=:m_tl_khac,";
			sql+="timmach=:m_timmach,hohap=:m_hohap,than=:m_than,k_tieuhoa=:m_k_tieuhoa,k_khac=:m_k_khac,gu=:m_gu,cungcotsong=:m_cungcotsong,cotsongcu=:m_cotsongcu,";
			sql+="canlamsang=:m_canlamsang,dieutri=:m_dieutri,denghi=:m_denghi,asa=:m_asa,glodmann=:m_glodmann,mallampati=:m_mallampati,";
			sql+="dukien=:m_dukien,thuthuat=:m_thuthuat,ketluan=:m_ketluan,mabs=:m_mabs";
			sql+=" where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_ngay",OracleType.VarChar,10).Value=m_ngay;
				cmd.Parameters.Add("m_mo",OracleType.NVarChar,254).Value=m_mo;
				cmd.Parameters.Add("m_mete",OracleType.Number).Value=m_mete;
				cmd.Parameters.Add("m_taibien",OracleType.Number).Value=m_taibien;
				cmd.Parameters.Add("m_truyenmau",OracleType.Number).Value=m_truyenmau;
				cmd.Parameters.Add("m_diung",OracleType.NVarChar,254).Value=m_diung;
				cmd.Parameters.Add("m_bieuhien",OracleType.NVarChar,254).Value=m_bieuhien;
				cmd.Parameters.Add("m_thuocla",OracleType.Number).Value=m_thuocla;
				cmd.Parameters.Add("m_ruou",OracleType.Number).Value=m_ruou;
				cmd.Parameters.Add("m_matuy",OracleType.Number).Value=m_matuy;
				cmd.Parameters.Add("m_caoha",OracleType.Number).Value=m_caoha;
				cmd.Parameters.Add("m_thatnguc",OracleType.Number).Value=m_thatnguc;
				cmd.Parameters.Add("m_nmct",OracleType.Number).Value=m_nmct;
				cmd.Parameters.Add("m_suytim",OracleType.Number).Value=m_suytim;
				cmd.Parameters.Add("m_timbamsinh",OracleType.Number).Value=m_timbamsinh;
				cmd.Parameters.Add("m_lao",OracleType.Number).Value=m_lao;
				cmd.Parameters.Add("m_phequan",OracleType.Number).Value=m_phequan;
				cmd.Parameters.Add("m_horamau",OracleType.Number).Value=m_horamau;
				cmd.Parameters.Add("m_copd",OracleType.Number).Value=m_copd;
				cmd.Parameters.Add("m_hh_khac",OracleType.Number).Value=m_hh_khac;
				cmd.Parameters.Add("m_tamthan",OracleType.Number).Value=m_tamthan;
				cmd.Parameters.Add("m_dongkinh",OracleType.Number).Value=m_dongkinh;
				cmd.Parameters.Add("m_tbmmn",OracleType.Number).Value=m_tbmmn;
				cmd.Parameters.Add("m_buouco",OracleType.Number).Value=m_buouco;
				cmd.Parameters.Add("m_maukdong",OracleType.Number).Value=m_maukdong;
				cmd.Parameters.Add("m_tieuduong",OracleType.Number).Value=m_tieuduong;
				cmd.Parameters.Add("m_hethong",OracleType.Number).Value=m_hethong;
				cmd.Parameters.Add("m_tk_khac",OracleType.Number).Value=m_tk_khac;
				cmd.Parameters.Add("m_cauthan",OracleType.Number).Value=m_cauthan;
				cmd.Parameters.Add("m_suythan",OracleType.Number).Value=m_suythan;
				cmd.Parameters.Add("m_soithan",OracleType.Number).Value=m_soithan;
				cmd.Parameters.Add("m_tn_khac",OracleType.Number).Value=m_tn_khac;
				cmd.Parameters.Add("m_vangda",OracleType.Number).Value=m_vangda;
				cmd.Parameters.Add("m_viemgan",OracleType.Number).Value=m_viemgan;
				cmd.Parameters.Add("m_tieuhoa",OracleType.Number).Value=m_tieuhoa;
				cmd.Parameters.Add("m_thuongvi",OracleType.Number).Value=m_thuongvi;
				cmd.Parameters.Add("m_th_khac",OracleType.Number).Value=m_th_khac;
				cmd.Parameters.Add("m_giadinh",OracleType.NVarChar,1000).Value=m_giadinh;
				cmd.Parameters.Add("m_chitiet",OracleType.NVarChar,1000).Value=m_chitiet;
				cmd.Parameters.Add("m_map",OracleType.Number).Value=m_map;
				cmd.Parameters.Add("m_phu",OracleType.Number).Value=m_phu;
				cmd.Parameters.Add("m_hong",OracleType.Number).Value=m_hong;
				cmd.Parameters.Add("m_nhot",OracleType.Number).Value=m_nhot;
				cmd.Parameters.Add("m_yeu",OracleType.Number).Value=m_yeu;
				cmd.Parameters.Add("m_khotho",OracleType.Number).Value=m_khotho;
				cmd.Parameters.Add("m_glasgow",OracleType.Number).Value=m_glasgow;
				cmd.Parameters.Add("m_mach",OracleType.Number).Value=m_mach;
				cmd.Parameters.Add("m_huyetap",OracleType.VarChar,7).Value=m_huyetap;
				cmd.Parameters.Add("m_nhietdo",OracleType.Number).Value=m_nhietdo;
				cmd.Parameters.Add("m_nhiptho",OracleType.Number).Value=m_nhiptho;
				cmd.Parameters.Add("m_cannang",OracleType.Number).Value=m_cannang;
				cmd.Parameters.Add("m_chieucao",OracleType.Number).Value=m_chieucao;
				cmd.Parameters.Add("m_hanche",OracleType.Number).Value=m_hanche;
				cmd.Parameters.Add("m_congan",OracleType.Number).Value=m_congan;
				cmd.Parameters.Add("m_luoito",OracleType.Number).Value=m_luoito;
				cmd.Parameters.Add("m_khoiu",OracleType.Number).Value=m_khoiu;
				cmd.Parameters.Add("m_giap",OracleType.Number).Value=m_giap;
				cmd.Parameters.Add("m_cungham",OracleType.Number).Value=m_cungham;
				cmd.Parameters.Add("m_seo",OracleType.Number).Value=m_seo;
				cmd.Parameters.Add("m_ranggia",OracleType.Number).Value=m_ranggia;
				cmd.Parameters.Add("m_tl_khac",OracleType.NVarChar,254).Value=m_tl_khac;
				cmd.Parameters.Add("m_timmach",OracleType.Number).Value=m_timmach;
				cmd.Parameters.Add("m_hohap",OracleType.Number).Value=m_hohap;
				cmd.Parameters.Add("m_than",OracleType.Number).Value=m_than;
				cmd.Parameters.Add("m_k_tieuhoa",OracleType.Number).Value=m_k_tieuhoa;
				cmd.Parameters.Add("m_k_khac",OracleType.Number).Value=m_k_khac;
				cmd.Parameters.Add("m_gu",OracleType.Number).Value=m_gu;
				cmd.Parameters.Add("m_cungcotsong",OracleType.Number).Value=m_cungcotsong;
				cmd.Parameters.Add("m_cotsongcu",OracleType.Number).Value=m_cotsongcu;
				cmd.Parameters.Add("m_canlamsang",OracleType.NVarChar,2000).Value=m_canlamsang;
				cmd.Parameters.Add("m_dieutri",OracleType.NVarChar,500).Value=m_dieutri;
				cmd.Parameters.Add("m_denghi",OracleType.NVarChar,1000).Value=m_denghi;
				cmd.Parameters.Add("m_asa",OracleType.VarChar,3).Value=m_asa;
				cmd.Parameters.Add("m_glodmann",OracleType.VarChar,3).Value=m_glodmann;
				cmd.Parameters.Add("m_mallampati",OracleType.VarChar,3).Value=m_mallampati;
				cmd.Parameters.Add("m_dukien",OracleType.NVarChar,254).Value=m_dukien;
				cmd.Parameters.Add("m_thuthuat",OracleType.NVarChar,500).Value=m_thuthuat;
				cmd.Parameters.Add("m_ketluan",OracleType.NVarChar,500).Value=m_ketluan;
				cmd.Parameters.Add("m_mabs",OracleType.VarChar,4).Value=m_mabs;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;				
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_khamtienme (id,ngay,mo,mete,taibien,truyenmau,diung,bieuhien,thuocla,ruou,matuy,caoha,thatnguc,nmct,suytim,timbamsinh,lao,phequan,horamau,copd,hh_khac,tamthan,dongkinh,tbmmn,buouco,maukdong,tieuduong,hethong,tk_khac,cauthan,suythan,soithan,tn_khac,vangda,viemgan,tieuhoa,thuongvi,th_khac,giadinh,chitiet,map,phu,hong,nhot,yeu,khotho,glasgow,mach,huyetap,nhietdo,nhiptho,canang,chieucao,hanche,congan,luoito,khoiu,giap,cungham,seo,ranggia,tl_khac,timmach,hohap,than,k_tieuhoa,k_khac,gu,cungcotsong,cotsongcu,canlamsang,dieutri,denghi,asa,glodmann,mallampati,dukien,thuthuat,ketluan,mabs) values ";
					sql+="(:m_id,to_date(:m_ngay,'dd/mm/yyyy'),:m_mo,:m_mete,:m_taibien,:m_truyenmau,:m_diung,:m_bieuhien,:m_thuocla,:m_ruou,:m_matuy,:m_caoha,:m_thatnguc,:m_nmct,:m_suytim,:m_timbamsinh,:m_lao,:m_phequan,:m_horamau,:m_copd,:m_hh_khac,:m_tamthan,:m_dongkinh,:m_tbmmn,:m_buouco,:m_maukdong,:m_tieuduong,:m_hethong,:m_tk_khac,:m_cauthan,:m_suythan,:m_soithan,:m_tn_khac,:m_vangda,:m_viemgan,:m_tieuhoa,:m_thuongvi,:m_th_khac,:m_giadinh,:m_chitiet,:m_map,:m_phu,:m_hong,:m_nhot,:m_yeu,:m_khotho,:m_glasgow,:m_mach,:m_huyetap,:m_nhietdo,:m_nhiptho,:m_canang,:m_chieucao,:m_hanche,:m_congan,:m_luoito,:m_khoiu,:m_giap,:m_cungham,:m_seo,:m_ranggia,:m_tl_khac,:m_timmach,:m_hohap,:m_than,:m_k_tieuhoa,:m_k_khac,:m_gu,:m_cungcotsong,:m_cotsongcu,:m_canlamsang,:m_dieutri,:m_denghi,:m_asa,:m_glodmann,:m_mallampati,:m_dukien,:m_thuthuat,:m_ketluan,:m_mabs)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ngay",OracleType.VarChar,10).Value=m_ngay;
					cmd.Parameters.Add("m_mo",OracleType.NVarChar,254).Value=m_mo;
					cmd.Parameters.Add("m_mete",OracleType.Number).Value=m_mete;
					cmd.Parameters.Add("m_taibien",OracleType.Number).Value=m_taibien;
					cmd.Parameters.Add("m_truyenmau",OracleType.Number).Value=m_truyenmau;
					cmd.Parameters.Add("m_diung",OracleType.NVarChar,254).Value=m_diung;
					cmd.Parameters.Add("m_bieuhien",OracleType.NVarChar,254).Value=m_bieuhien;
					cmd.Parameters.Add("m_thuocla",OracleType.Number).Value=m_thuocla;
					cmd.Parameters.Add("m_ruou",OracleType.Number).Value=m_ruou;
					cmd.Parameters.Add("m_matuy",OracleType.Number).Value=m_matuy;
					cmd.Parameters.Add("m_caoha",OracleType.Number).Value=m_caoha;
					cmd.Parameters.Add("m_thatnguc",OracleType.Number).Value=m_thatnguc;
					cmd.Parameters.Add("m_nmct",OracleType.Number).Value=m_nmct;
					cmd.Parameters.Add("m_suytim",OracleType.Number).Value=m_suytim;
					cmd.Parameters.Add("m_timbamsinh",OracleType.Number).Value=m_timbamsinh;
					cmd.Parameters.Add("m_lao",OracleType.Number).Value=m_lao;
					cmd.Parameters.Add("m_phequan",OracleType.Number).Value=m_phequan;
					cmd.Parameters.Add("m_horamau",OracleType.Number).Value=m_horamau;
					cmd.Parameters.Add("m_copd",OracleType.Number).Value=m_copd;
					cmd.Parameters.Add("m_hh_khac",OracleType.Number).Value=m_hh_khac;
					cmd.Parameters.Add("m_tamthan",OracleType.Number).Value=m_tamthan;
					cmd.Parameters.Add("m_dongkinh",OracleType.Number).Value=m_dongkinh;
					cmd.Parameters.Add("m_tbmmn",OracleType.Number).Value=m_tbmmn;
					cmd.Parameters.Add("m_buouco",OracleType.Number).Value=m_buouco;
					cmd.Parameters.Add("m_maukdong",OracleType.Number).Value=m_maukdong;
					cmd.Parameters.Add("m_tieuduong",OracleType.Number).Value=m_tieuduong;
					cmd.Parameters.Add("m_hethong",OracleType.Number).Value=m_hethong;
					cmd.Parameters.Add("m_tk_khac",OracleType.Number).Value=m_tk_khac;
					cmd.Parameters.Add("m_cauthan",OracleType.Number).Value=m_cauthan;
					cmd.Parameters.Add("m_suythan",OracleType.Number).Value=m_suythan;
					cmd.Parameters.Add("m_soithan",OracleType.Number).Value=m_soithan;
					cmd.Parameters.Add("m_tn_khac",OracleType.Number).Value=m_tn_khac;
					cmd.Parameters.Add("m_vangda",OracleType.Number).Value=m_vangda;
					cmd.Parameters.Add("m_viemgan",OracleType.Number).Value=m_viemgan;
					cmd.Parameters.Add("m_tieuhoa",OracleType.Number).Value=m_tieuhoa;
					cmd.Parameters.Add("m_thuongvi",OracleType.Number).Value=m_thuongvi;
					cmd.Parameters.Add("m_th_khac",OracleType.Number).Value=m_th_khac;
					cmd.Parameters.Add("m_giadinh",OracleType.NVarChar,1000).Value=m_giadinh;
					cmd.Parameters.Add("m_chitiet",OracleType.NVarChar,1000).Value=m_chitiet;
					cmd.Parameters.Add("m_map",OracleType.Number).Value=m_map;
					cmd.Parameters.Add("m_phu",OracleType.Number).Value=m_phu;
					cmd.Parameters.Add("m_hong",OracleType.Number).Value=m_hong;
					cmd.Parameters.Add("m_nhot",OracleType.Number).Value=m_nhot;
					cmd.Parameters.Add("m_yeu",OracleType.Number).Value=m_yeu;
					cmd.Parameters.Add("m_khotho",OracleType.Number).Value=m_khotho;
					cmd.Parameters.Add("m_glasgow",OracleType.Number).Value=m_glasgow;
					cmd.Parameters.Add("m_mach",OracleType.Number).Value=m_mach;
					cmd.Parameters.Add("m_huyetap",OracleType.VarChar,7).Value=m_huyetap;
					cmd.Parameters.Add("m_nhietdo",OracleType.Number).Value=m_nhietdo;
					cmd.Parameters.Add("m_nhiptho",OracleType.Number).Value=m_nhiptho;
					cmd.Parameters.Add("m_cannang",OracleType.Number).Value=m_cannang;
					cmd.Parameters.Add("m_chieucao",OracleType.Number).Value=m_chieucao;
					cmd.Parameters.Add("m_hanche",OracleType.Number).Value=m_hanche;
					cmd.Parameters.Add("m_congan",OracleType.Number).Value=m_congan;
					cmd.Parameters.Add("m_luoito",OracleType.Number).Value=m_luoito;
					cmd.Parameters.Add("m_khoiu",OracleType.Number).Value=m_khoiu;
					cmd.Parameters.Add("m_giap",OracleType.Number).Value=m_giap;
					cmd.Parameters.Add("m_cungham",OracleType.Number).Value=m_cungham;
					cmd.Parameters.Add("m_seo",OracleType.Number).Value=m_seo;
					cmd.Parameters.Add("m_ranggia",OracleType.Number).Value=m_ranggia;
					cmd.Parameters.Add("m_tl_khac",OracleType.NVarChar,254).Value=m_tl_khac;
					cmd.Parameters.Add("m_timmach",OracleType.Number).Value=m_timmach;
					cmd.Parameters.Add("m_hohap",OracleType.Number).Value=m_hohap;
					cmd.Parameters.Add("m_than",OracleType.Number).Value=m_than;
					cmd.Parameters.Add("m_k_tieuhoa",OracleType.Number).Value=m_k_tieuhoa;
					cmd.Parameters.Add("m_k_khac",OracleType.Number).Value=m_k_khac;
					cmd.Parameters.Add("m_gu",OracleType.Number).Value=m_gu;
					cmd.Parameters.Add("m_cungcotsong",OracleType.Number).Value=m_cungcotsong;
					cmd.Parameters.Add("m_cotsongcu",OracleType.Number).Value=m_cotsongcu;
					cmd.Parameters.Add("m_canlamsang",OracleType.NVarChar,2000).Value=m_canlamsang;
					cmd.Parameters.Add("m_dieutri",OracleType.NVarChar,500).Value=m_dieutri;
					cmd.Parameters.Add("m_denghi",OracleType.NVarChar,1000).Value=m_denghi;
					cmd.Parameters.Add("m_asa",OracleType.VarChar,3).Value=m_asa;
					cmd.Parameters.Add("m_glodmann",OracleType.VarChar,3).Value=m_glodmann;
					cmd.Parameters.Add("m_mallampati",OracleType.VarChar,3).Value=m_mallampati;
					cmd.Parameters.Add("m_dukien",OracleType.NVarChar,254).Value=m_dukien;
					cmd.Parameters.Add("m_thuthuat",OracleType.NVarChar,500).Value=m_thuthuat;
					cmd.Parameters.Add("m_ketluan",OracleType.NVarChar,500).Value=m_ketluan;
					cmd.Parameters.Add("m_mabs",OracleType.VarChar,4).Value=m_mabs;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_khamtienme");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_khamtienme1(string m_ngayvv,long m_id,string m_ngay,string m_mo,int m_mete,int m_taibien,
			int m_truyenmau,string m_diung,string m_bieuhien,int m_thuocla,int m_ruou,int m_matuy,int m_caoha,
			int m_thatnguc,int m_nmct,int m_suytim,int m_timbamsinh,int m_lao,int m_phequan,int m_horamau,
			int m_copd,int m_hh_khac,int m_tamthan,int m_dongkinh,int m_tbmmn,int m_buouco,int m_maukdong,
			int m_tieuduong,int m_hethong,int m_tk_khac,int m_cauthan,int m_suythan)
		{
			string xxx = user + mmyy(m_ngayvv);
			sql="update "+xxx+".ba_khamtienme set ngay=to_date(:m_ngay,'dd/mm/yyyy'),mo=:m_mo,mete=:m_mete,taibien=:m_taibien,";
			sql+="truyenmau=:m_truyenmau,diung=:m_diung,bieuhien=:m_bieuhien,thuocla=:m_thuocla,ruou=:m_ruou,matuy=:m_matuy,caoha=:m_caoha,";
			sql+="thatnguc=:m_thatnguc,nmct=:m_nmct,suytim=:m_suytim,timbamsinh=:m_timbamsinh,lao=:m_lao,phequan=:m_phequan,horamau=:m_horamau,";
			sql+="copd=:m_copd,hh_khac=:m_hh_khac,tamthan=:m_tamthan,dongkinh=:m_dongkinh,tbmmn=:m_tbmmn,buouco=:m_buouco,maukdong=:m_maukdong,";
			sql+="tieuduong=:m_tieuduong,hethong=:m_hethong,tk_khac=:m_tk_khac,cauthan=:m_cauthan,suythan=:m_suythan";
			sql+=" where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_ngay",OracleType.VarChar,10).Value=m_ngay;
				cmd.Parameters.Add("m_mo",OracleType.NVarChar,254).Value=m_mo;
				cmd.Parameters.Add("m_mete",OracleType.Number).Value=m_mete;
				cmd.Parameters.Add("m_taibien",OracleType.Number).Value=m_taibien;
				cmd.Parameters.Add("m_truyenmau",OracleType.Number).Value=m_truyenmau;
				cmd.Parameters.Add("m_diung",OracleType.NVarChar,254).Value=m_diung;
				cmd.Parameters.Add("m_bieuhien",OracleType.NVarChar,254).Value=m_bieuhien;
				cmd.Parameters.Add("m_thuocla",OracleType.Number).Value=m_thuocla;
				cmd.Parameters.Add("m_ruou",OracleType.Number).Value=m_ruou;
				cmd.Parameters.Add("m_matuy",OracleType.Number).Value=m_matuy;
				cmd.Parameters.Add("m_caoha",OracleType.Number).Value=m_caoha;
				cmd.Parameters.Add("m_thatnguc",OracleType.Number).Value=m_thatnguc;
				cmd.Parameters.Add("m_nmct",OracleType.Number).Value=m_nmct;
				cmd.Parameters.Add("m_suytim",OracleType.Number).Value=m_suytim;
				cmd.Parameters.Add("m_timbamsinh",OracleType.Number).Value=m_timbamsinh;
				cmd.Parameters.Add("m_lao",OracleType.Number).Value=m_lao;
				cmd.Parameters.Add("m_phequan",OracleType.Number).Value=m_phequan;
				cmd.Parameters.Add("m_horamau",OracleType.Number).Value=m_horamau;
				cmd.Parameters.Add("m_copd",OracleType.Number).Value=m_copd;
				cmd.Parameters.Add("m_hh_khac",OracleType.Number).Value=m_hh_khac;
				cmd.Parameters.Add("m_tamthan",OracleType.Number).Value=m_tamthan;
				cmd.Parameters.Add("m_dongkinh",OracleType.Number).Value=m_dongkinh;
				cmd.Parameters.Add("m_tbmmn",OracleType.Number).Value=m_tbmmn;
				cmd.Parameters.Add("m_buouco",OracleType.Number).Value=m_buouco;
				cmd.Parameters.Add("m_maukdong",OracleType.Number).Value=m_maukdong;
				cmd.Parameters.Add("m_tieuduong",OracleType.Number).Value=m_tieuduong;
				cmd.Parameters.Add("m_hethong",OracleType.Number).Value=m_hethong;
				cmd.Parameters.Add("m_tk_khac",OracleType.Number).Value=m_tk_khac;
				cmd.Parameters.Add("m_cauthan",OracleType.Number).Value=m_cauthan;
				cmd.Parameters.Add("m_suythan",OracleType.Number).Value=m_suythan;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;				
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_khamtienme (id,ngay,mo,mete,taibien,truyenmau,diung,bieuhien,thuocla,ruou,matuy,caoha,thatnguc,nmct,suytim,timbamsinh,lao,phequan,horamau,copd,hh_khac,tamthan,dongkinh,tbmmn,buouco,maukdong,tieuduong,hethong,tk_khac,cauthan,suythan) values ";
					sql+="(:m_id,to_date(:m_ngay,'dd/mm/yyyy'),:m_mo,:m_mete,:m_taibien,:m_truyenmau,:m_diung,:m_bieuhien,:m_thuocla,:m_ruou,:m_matuy,:m_caoha,:m_thatnguc,:m_nmct,:m_suytim,:m_timbamsinh,:m_lao,:m_phequan,:m_horamau,:m_copd,:m_hh_khac,:m_tamthan,:m_dongkinh,:m_tbmmn,:m_buouco,:m_maukdong,:m_tieuduong,:m_hethong,:m_tk_khac,:m_cauthan,:m_suythan)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ngay",OracleType.VarChar,10).Value=m_ngay;
					cmd.Parameters.Add("m_mo",OracleType.NVarChar,254).Value=m_mo;
					cmd.Parameters.Add("m_mete",OracleType.Number).Value=m_mete;
					cmd.Parameters.Add("m_taibien",OracleType.Number).Value=m_taibien;
					cmd.Parameters.Add("m_truyenmau",OracleType.Number).Value=m_truyenmau;
					cmd.Parameters.Add("m_diung",OracleType.NVarChar,254).Value=m_diung;
					cmd.Parameters.Add("m_bieuhien",OracleType.NVarChar,254).Value=m_bieuhien;
					cmd.Parameters.Add("m_thuocla",OracleType.Number).Value=m_thuocla;
					cmd.Parameters.Add("m_ruou",OracleType.Number).Value=m_ruou;
					cmd.Parameters.Add("m_matuy",OracleType.Number).Value=m_matuy;
					cmd.Parameters.Add("m_caoha",OracleType.Number).Value=m_caoha;
					cmd.Parameters.Add("m_thatnguc",OracleType.Number).Value=m_thatnguc;
					cmd.Parameters.Add("m_nmct",OracleType.Number).Value=m_nmct;
					cmd.Parameters.Add("m_suytim",OracleType.Number).Value=m_suytim;
					cmd.Parameters.Add("m_timbamsinh",OracleType.Number).Value=m_timbamsinh;
					cmd.Parameters.Add("m_lao",OracleType.Number).Value=m_lao;
					cmd.Parameters.Add("m_phequan",OracleType.Number).Value=m_phequan;
					cmd.Parameters.Add("m_horamau",OracleType.Number).Value=m_horamau;
					cmd.Parameters.Add("m_copd",OracleType.Number).Value=m_copd;
					cmd.Parameters.Add("m_hh_khac",OracleType.Number).Value=m_hh_khac;
					cmd.Parameters.Add("m_tamthan",OracleType.Number).Value=m_tamthan;
					cmd.Parameters.Add("m_dongkinh",OracleType.Number).Value=m_dongkinh;
					cmd.Parameters.Add("m_tbmmn",OracleType.Number).Value=m_tbmmn;
					cmd.Parameters.Add("m_buouco",OracleType.Number).Value=m_buouco;
					cmd.Parameters.Add("m_maukdong",OracleType.Number).Value=m_maukdong;
					cmd.Parameters.Add("m_tieuduong",OracleType.Number).Value=m_tieuduong;
					cmd.Parameters.Add("m_hethong",OracleType.Number).Value=m_hethong;
					cmd.Parameters.Add("m_tk_khac",OracleType.Number).Value=m_tk_khac;
					cmd.Parameters.Add("m_cauthan",OracleType.Number).Value=m_cauthan;
					cmd.Parameters.Add("m_suythan",OracleType.Number).Value=m_suythan;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_khamtienme");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_khamtienme2(string m_ngayvv,long m_id,int m_soithan,int m_tn_khac,
			int m_vangda,int m_viemgan,int m_tieuhoa,int m_thuongvi,int m_th_khac,string m_giadinh,string m_chitiet,
			int m_map,int m_phu,int m_hong,int m_nhot,int m_yeu,int m_khotho,decimal m_glasgow,decimal m_mach,
			string m_huyetap,decimal m_nhietdo,decimal m_nhiptho,decimal m_cannang,decimal m_chieucao,int m_hanche,int m_congan,
			int m_luoito,int m_khoiu,int m_giap,int m_cungham,int m_seo,int m_ranggia)
		{
			string xxx = user + mmyy(m_ngayvv);
			sql="update "+xxx+".ba_khamtienme set soithan=:m_soithan,tn_khac=:m_tn_khac,";
			sql+="vangda=:m_vangda,viemgan=:m_viemgan,tieuhoa=:m_tieuhoa,thuongvi=:m_thuongvi,th_khac=:m_th_khac,giadinh=:m_giadinh,chitiet=:m_chitiet,";
			sql+="map=:m_map,phu=:m_phu,hong=:m_hong,nhot=:m_nhot,yeu=:m_yeu,khotho=:m_khotho,glasgow=:m_glasgow,mach=:m_mach,";
			sql+="huyetap=:m_huyetap,nhietdo=:m_nhietdo,nhiptho=:m_nhiptho,cannang=:m_cannang,chieucao=:m_chieucao,hanche=:m_hanche,congan=:m_congan,";
			sql+="luoito=:m_luoito,khoiu=:m_khoiu,giap=:m_giap,cungham=:m_cungham,seo=:m_seo,ranggia=:m_ranggia";
			sql+=" where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_soithan",OracleType.Number).Value=m_soithan;
				cmd.Parameters.Add("m_tn_khac",OracleType.Number).Value=m_tn_khac;
				cmd.Parameters.Add("m_vangda",OracleType.Number).Value=m_vangda;
				cmd.Parameters.Add("m_viemgan",OracleType.Number).Value=m_viemgan;
				cmd.Parameters.Add("m_tieuhoa",OracleType.Number).Value=m_tieuhoa;
				cmd.Parameters.Add("m_thuongvi",OracleType.Number).Value=m_thuongvi;
				cmd.Parameters.Add("m_th_khac",OracleType.Number).Value=m_th_khac;
				cmd.Parameters.Add("m_giadinh",OracleType.NVarChar,1000).Value=m_giadinh;
				cmd.Parameters.Add("m_chitiet",OracleType.NVarChar,1000).Value=m_chitiet;
				cmd.Parameters.Add("m_map",OracleType.Number).Value=m_map;
				cmd.Parameters.Add("m_phu",OracleType.Number).Value=m_phu;
				cmd.Parameters.Add("m_hong",OracleType.Number).Value=m_hong;
				cmd.Parameters.Add("m_nhot",OracleType.Number).Value=m_nhot;
				cmd.Parameters.Add("m_yeu",OracleType.Number).Value=m_yeu;
				cmd.Parameters.Add("m_khotho",OracleType.Number).Value=m_khotho;
				cmd.Parameters.Add("m_glasgow",OracleType.Number).Value=m_glasgow;
				cmd.Parameters.Add("m_mach",OracleType.Number).Value=m_mach;
				cmd.Parameters.Add("m_huyetap",OracleType.VarChar,7).Value=m_huyetap;
				cmd.Parameters.Add("m_nhietdo",OracleType.Number).Value=m_nhietdo;
				cmd.Parameters.Add("m_nhiptho",OracleType.Number).Value=m_nhiptho;
				cmd.Parameters.Add("m_cannang",OracleType.Number).Value=m_cannang;
				cmd.Parameters.Add("m_chieucao",OracleType.Number).Value=m_chieucao;
				cmd.Parameters.Add("m_hanche",OracleType.Number).Value=m_hanche;
				cmd.Parameters.Add("m_congan",OracleType.Number).Value=m_congan;
				cmd.Parameters.Add("m_luoito",OracleType.Number).Value=m_luoito;
				cmd.Parameters.Add("m_khoiu",OracleType.Number).Value=m_khoiu;
				cmd.Parameters.Add("m_giap",OracleType.Number).Value=m_giap;
				cmd.Parameters.Add("m_cungham",OracleType.Number).Value=m_cungham;
				cmd.Parameters.Add("m_seo",OracleType.Number).Value=m_seo;
				cmd.Parameters.Add("m_ranggia",OracleType.Number).Value=m_ranggia;				
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;				
				cmd.ExecuteNonQuery();
				cmd.Dispose();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_khamtienme");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_khamtienme3(string m_ngayvv,long m_id,string m_tl_khac,int m_timmach,int m_hohap,int m_than,int m_k_tieuhoa,int m_k_khac,int m_gu,int m_cungcotsong,
			int m_cotsongcu,string m_canlamsang,string m_dieutri,string m_denghi,string m_asa,string m_glodmann,
			string m_mallampati,string m_dukien,string m_thuthuat,string m_ketluan,string m_mabs)
		{
			string xxx = user + mmyy(m_ngayvv);
			sql="update "+xxx+".ba_khamtienme set tl_khac=:m_tl_khac,timmach=:m_timmach,hohap=:m_hohap,than=:m_than,k_tieuhoa=:m_k_tieuhoa,";
			sql+="k_khac=:m_k_khac,gu=:m_gu,cungcotsong=:m_cungcotsong,cotsongcu=:m_cotsongcu,canlamsang=:m_canlamsang,";
			sql+="dieutri=:m_dieutri,denghi=:m_denghi,asa=:m_asa,glodmann=:m_glodmann,mallampati=:m_mallampati,";
			sql+="dukien=:m_dukien,thuthuat=:m_thuthuat,ketluan=:m_ketluan,mabs=:m_mabs";
			sql+=" where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_tl_khac",OracleType.NVarChar,254).Value=m_tl_khac;
				cmd.Parameters.Add("m_timmach",OracleType.Number).Value=m_timmach;
				cmd.Parameters.Add("m_hohap",OracleType.Number).Value=m_hohap;
				cmd.Parameters.Add("m_than",OracleType.Number).Value=m_than;
				cmd.Parameters.Add("m_k_tieuhoa",OracleType.Number).Value=m_k_tieuhoa;
				cmd.Parameters.Add("m_k_khac",OracleType.Number).Value=m_k_khac;
				cmd.Parameters.Add("m_gu",OracleType.Number).Value=m_gu;
				cmd.Parameters.Add("m_cungcotsong",OracleType.Number).Value=m_cungcotsong;
				cmd.Parameters.Add("m_cotsongcu",OracleType.Number).Value=m_cotsongcu;
				cmd.Parameters.Add("m_canlamsang",OracleType.NVarChar,2000).Value=m_canlamsang;
				cmd.Parameters.Add("m_dieutri",OracleType.NVarChar,500).Value=m_dieutri;
				cmd.Parameters.Add("m_denghi",OracleType.NVarChar,1000).Value=m_denghi;
				cmd.Parameters.Add("m_asa",OracleType.VarChar,3).Value=m_asa;
				cmd.Parameters.Add("m_glodmann",OracleType.VarChar,3).Value=m_glodmann;
				cmd.Parameters.Add("m_mallampati",OracleType.VarChar,3).Value=m_mallampati;
				cmd.Parameters.Add("m_dukien",OracleType.NVarChar,254).Value=m_dukien;
				cmd.Parameters.Add("m_thuthuat",OracleType.NVarChar,500).Value=m_thuthuat;
				cmd.Parameters.Add("m_ketluan",OracleType.NVarChar,500).Value=m_ketluan;
				cmd.Parameters.Add("m_mabs",OracleType.VarChar,4).Value=m_mabs;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.ExecuteNonQuery();
				cmd.Dispose();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_khamtienme");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_khamtienme4(string m_ngayvv,long m_id,
			string m_tinhmach,int m_tm_bt,int m_tm_cha,int m_tm_dtn,int m_tm_ln,string m_tm_khac,int m_hh_bt,
			int m_hh_copd,int m_hh_suyen,string m_k_hh_khac,int m_nt_bt,
			int m_nt_bg,int m_nt_td,string m_nt_khac,
			int m_tk_bt,int m_tk_yeu,string m_k_tk_khac,int m_cs_bt,string m_cs_khac)
		{
			string xxx = user + mmyy(m_ngayvv);
			sql="update "+xxx+".ba_khamtienme set ";
			sql+="tinhmach=:m_tinhmach,tm_bt=:m_tm_bt,tm_cha=:m_tm_cha,tm_dtn=:m_tm_dtn,tm_ln=:m_tm_ln,tm_khac=:m_tm_khac,";
			sql+="hh_bt=:m_hh_bt,hh_copd=:m_hh_copd,hh_suyen=:m_hh_suyen,k_hh_khac=:m_k_hh_khac,nt_bt=:m_nt_bt,";
			sql+="nt_bg=:m_nt_bg,nt_td=:m_nt_td,nt_khac=:m_nt_khac,tk_bt=:m_tk_bt,tk_yeu=:m_tk_yeu,";
			sql+="k_tk_khac=:m_k_tk_khac,cs_bt=:m_cs_bt,cs_khac=:m_cs_khac ";
			sql+=" where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_tinhmach",OracleType.NVarChar,254).Value=m_tinhmach;
				cmd.Parameters.Add("m_tm_bt",OracleType.Number).Value=m_tm_bt;
				cmd.Parameters.Add("m_tm_cha",OracleType.Number).Value=m_tm_cha;
				cmd.Parameters.Add("m_tm_dtn",OracleType.Number).Value=m_tm_dtn;
				cmd.Parameters.Add("m_tm_ln",OracleType.Number).Value=m_tm_ln;
				cmd.Parameters.Add("m_tm_khac",OracleType.NVarChar,254).Value=m_tm_khac;
				cmd.Parameters.Add("m_hh_bt",OracleType.Number).Value=m_hh_bt;
				cmd.Parameters.Add("m_hh_copd",OracleType.Number).Value=m_hh_copd;
				cmd.Parameters.Add("m_hh_suyen",OracleType.Number).Value=m_hh_suyen;
				cmd.Parameters.Add("m_k_hh_khac",OracleType.NVarChar,254).Value=m_k_hh_khac;
				cmd.Parameters.Add("m_nt_bt",OracleType.Number).Value=m_nt_bt;
				cmd.Parameters.Add("m_nt_bg",OracleType.Number).Value=m_nt_bg;
				cmd.Parameters.Add("m_nt_td",OracleType.Number).Value=m_nt_td;
				cmd.Parameters.Add("m_nt_khac",OracleType.NVarChar,254).Value=m_nt_khac;
				cmd.Parameters.Add("m_tk_bt",OracleType.Number).Value=m_tk_bt;
				cmd.Parameters.Add("m_tk_yeu",OracleType.Number).Value=m_tk_yeu;
				cmd.Parameters.Add("m_k_tk_khac",OracleType.NVarChar,254).Value=m_k_tk_khac;
				cmd.Parameters.Add("m_cs_bt",OracleType.Number).Value=m_cs_bt;
				cmd.Parameters.Add("m_cs_khac",OracleType.NVarChar,254).Value=m_cs_khac;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.ExecuteNonQuery();
				cmd.Dispose();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_khamtienme");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_chamsoc(long m_id,long m_idthuchien,long m_iddieutri,string m_ngay,decimal m_sophieu,decimal m_mach,string m_huyetap,decimal m_nhietdo,decimal m_nhiptho,string m_dienbien,string m_ylenh,string m_yta,int m_userid)
		{
			string xxx = user + mmyy(m_ngay);
			sql="update "+xxx+".ba_chamsoc set idthuchien=:m_idthuchien,iddieutri=:m_iddieutri,ngay=to_date(:m_ngay,'dd/mm/yyyy hh24:mi'),";
			sql+="sophieu=:m_sophieu,mach=:m_mach,huyetap=:m_huyetap,nhietdo=:m_nhietdo,nhiptho=:m_nhiptho,dienbien=:m_dienbien,ylenh=:m_ylenh,yta=:m_yta,userid=:m_userid where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_idthuchien",OracleType.Number).Value=m_idthuchien;
				cmd.Parameters.Add("m_iddieutri",OracleType.Number).Value=m_iddieutri;
				cmd.Parameters.Add("m_ngay",OracleType.VarChar,16).Value=m_ngay;
				cmd.Parameters.Add("m_sophieu",OracleType.Number).Value=m_sophieu;
				cmd.Parameters.Add("m_mach",OracleType.Number).Value=m_mach;
				cmd.Parameters.Add("m_huyetap",OracleType.VarChar,7).Value=m_huyetap;
				cmd.Parameters.Add("m_nhietdo",OracleType.Number).Value=m_nhietdo;
				cmd.Parameters.Add("m_nhiptho",OracleType.Number).Value=m_nhiptho;
				cmd.Parameters.Add("m_dienbien",OracleType.NVarChar,1000).Value=m_dienbien;
				cmd.Parameters.Add("m_ylenh",OracleType.NVarChar,2000).Value=m_ylenh;
				cmd.Parameters.Add("m_yta",OracleType.VarChar,4).Value=m_yta;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_chamsoc (id,idthuchien,iddieutri,ngay,sophieu,mach,huyetap,nhietdo,nhiptho,dienbien,ylenh,yta,userid) values (:m_id,:m_idthuchien,:m_iddieutri,to_date(:m_ngay,'dd/mm/yyyy hh24:mi'),:m_sophieu,:m_mach,:m_huyetap,:m_nhietdo,:m_nhiptho,:m_dienbien,:m_ylenh,:m_yta,:m_userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_idthuchien",OracleType.Number).Value=m_idthuchien;	
					cmd.Parameters.Add("m_iddieutri",OracleType.Number).Value=m_iddieutri;
					cmd.Parameters.Add("m_ngay",OracleType.VarChar,16).Value=m_ngay;
					cmd.Parameters.Add("m_sophieu",OracleType.Number).Value=m_sophieu;
					cmd.Parameters.Add("m_mach",OracleType.Number).Value=m_mach;
					cmd.Parameters.Add("m_huyetap",OracleType.VarChar,7).Value=m_huyetap;
					cmd.Parameters.Add("m_nhietdo",OracleType.Number).Value=m_nhietdo;
					cmd.Parameters.Add("m_nhiptho",OracleType.Number).Value=m_nhiptho;
					cmd.Parameters.Add("m_dienbien",OracleType.NVarChar,1000).Value=m_dienbien;
					cmd.Parameters.Add("m_ylenh",OracleType.NVarChar,2000).Value=m_ylenh;
					cmd.Parameters.Add("m_yta",OracleType.VarChar,4).Value=m_yta;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_chamsoc");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_chamsocct(string m_ngay,long m_id,int m_stt,int m_loai,string m_noidung,string m_ghichu,string m_thuchien)
		{
			string xxx = user + mmyy(m_ngay);
			sql="update "+xxx+".ba_chamsocct set loai=:m_loai,noidung=:m_noidung,ghichu=:m_ghichu,thuchien=:m_thuchien";
			sql+=" where id=:m_id and stt=:m_stt";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
				cmd.Parameters.Add("m_noidung",OracleType.NVarChar,254).Value=m_noidung;
				cmd.Parameters.Add("m_ghichu",OracleType.NVarChar,254).Value=m_ghichu;
				cmd.Parameters.Add("m_thuchien",OracleType.NVarChar,500).Value=m_thuchien;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_chamsocct (id,stt,loai,noidung,ghichu,thuchien) values (:m_id,:m_stt,:m_loai,:m_noidung,:m_ghichu,:m_thuchien)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
					cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
					cmd.Parameters.Add("m_noidung",OracleType.NVarChar,254).Value=m_noidung;
					cmd.Parameters.Add("m_ghichu",OracleType.NVarChar,254).Value=m_ghichu;
					cmd.Parameters.Add("m_thuchien",OracleType.NVarChar,500).Value=m_thuchien;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_chamsocct");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_dieutri(long m_id,long m_idthuchien,decimal m_sophieu,string m_ngay,string m_dienbien,string m_ylenh,long m_idylenh,int m_chedoan,string m_mabs,int m_loai,long m_sankhoa,int m_userid)
		{
			string xxx = user + mmyy(m_ngay);
			sql="update "+xxx+".ba_dieutri set idthuchien=:m_idthuchien,sophieu=:m_sophieu,ngay=to_date(:m_ngay,'dd/mm/yyyy hh24:mi'),";
			sql+="dienbien=:m_dienbien,ylenh=:m_ylenh,idylenh=:m_idylenh,chedoan=:m_chedoan,mabs=:m_mabs,loai=:m_loai,sankhoa=:m_sankhoa,userid=:m_userid where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_idthuchien",OracleType.Number).Value=m_idthuchien;
				cmd.Parameters.Add("m_sophieu",OracleType.Number).Value=m_sophieu;
				cmd.Parameters.Add("m_ngay",OracleType.VarChar,16).Value=m_ngay;
				cmd.Parameters.Add("m_dienbien",OracleType.NVarChar,1000).Value=m_dienbien;
				cmd.Parameters.Add("m_ylenh",OracleType.NVarChar,2000).Value=m_ylenh;
				cmd.Parameters.Add("m_idylenh",OracleType.Number).Value=m_idylenh;
				cmd.Parameters.Add("m_chedoan",OracleType.Number).Value=m_chedoan;
				cmd.Parameters.Add("m_mabs",OracleType.VarChar,4).Value=m_mabs;
				cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
				cmd.Parameters.Add("m_sankhoa",OracleType.Number).Value=m_sankhoa;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_dieutri (id,idthuchien,sophieu,ngay,dienbien,ylenh,idylenh,chedoan,mabs,loai,sankhoa,userid) values (:m_id,:m_idthuchien,:m_sophieu,to_date(:m_ngay,'dd/mm/yyyy hh24:mi'),:m_dienbien,:m_ylenh,:m_idylenh,:m_chedoan,:m_mabs,:m_loai,:m_sankhoa,:m_userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_idthuchien",OracleType.Number).Value=m_idthuchien;
					cmd.Parameters.Add("m_sophieu",OracleType.Number).Value=m_sophieu;
					cmd.Parameters.Add("m_ngay",OracleType.VarChar,16).Value=m_ngay;
					cmd.Parameters.Add("m_dienbien",OracleType.NVarChar,1000).Value=m_dienbien;
					cmd.Parameters.Add("m_ylenh",OracleType.NVarChar,2000).Value=m_ylenh;
					cmd.Parameters.Add("m_idylenh",OracleType.Number).Value=m_idylenh;
					cmd.Parameters.Add("m_chedoan",OracleType.Number).Value=m_chedoan;
					cmd.Parameters.Add("m_mabs",OracleType.VarChar,4).Value=m_mabs;
					cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
					cmd.Parameters.Add("m_sankhoa",OracleType.Number).Value=m_sankhoa;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_dieutri");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_dieutrict(string m_ngay,long m_id,int m_stt,int m_loai,string m_noidung,string m_ghichu)
		{
			string xxx = user + mmyy(m_ngay);
			sql="update "+xxx+".ba_dieutrict set loai=:m_loai,noidung=:m_noidung,ghichu=:m_ghichu";
			sql+=" where id=:m_id and stt=:m_stt";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
				cmd.Parameters.Add("m_noidung",OracleType.NVarChar,254).Value=m_noidung;
				cmd.Parameters.Add("m_ghichu",OracleType.NVarChar,254).Value=m_ghichu;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_dieutrict (id,stt,loai,noidung,ghichu) values (:m_id,:m_stt,:m_loai,:m_noidung,:m_ghichu)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
					cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
					cmd.Parameters.Add("m_noidung",OracleType.NVarChar,254).Value=m_noidung;
					cmd.Parameters.Add("m_ghichu",OracleType.NVarChar,254).Value=m_ghichu;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_dieutrict");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_dieutrict(string m_ngay,long m_id,int m_stt,string m_thuchien)
		{
			string xxx = user + mmyy(m_ngay);
			sql="update "+xxx+".ba_dieutrict set thuchien=:m_thuchien";
			sql+=" where id=:m_id and stt=:m_stt";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_thuchien",OracleType.NVarChar,500).Value=m_thuchien;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
				cmd.ExecuteNonQuery();
				cmd.Dispose();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_dieutrict");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_kiemsoatcc(string m_mmyy,long m_id,long m_idthuchien,string m_ngay,string m_nhanxet,string m_ddtruong,string m_ddpmo,string m_ddphutrach,int m_userid)
		{
			string xxx = user + m_mmyy;
			sql="update "+xxx+".ba_kiemsoatcc set idthuchien=:m_idthuchien,ngay=to_date(:m_ngay,'dd/mm/yyyy hh24:mi'),";
			sql+="nhanxet=:m_nhanxet,ddtruong=:m_ddtruong,ddpmo=:m_ddpmo,ddphutrach=:m_ddphutrach,userid=:m_userid where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_idthuchien",OracleType.Number).Value=m_idthuchien;
				cmd.Parameters.Add("m_ngay",OracleType.VarChar,16).Value=m_ngay;
				cmd.Parameters.Add("m_nhanxet",OracleType.NVarChar,500).Value=m_nhanxet;
				cmd.Parameters.Add("m_ddtruong",OracleType.VarChar,4).Value=m_ddtruong;
				cmd.Parameters.Add("m_ddpmo",OracleType.VarChar,4).Value=m_ddpmo;
				cmd.Parameters.Add("m_ddphutrach",OracleType.VarChar,4).Value=m_ddphutrach;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_kiemsoatcc (id,idthuchien,ngay,nhanxet,ddtruong,ddpmo,ddphutrach,userid) values (:m_id,:m_idthuchien,to_date(:m_ngay,'dd/mm/yyyy hh24:mi'),:m_nhanxet,:m_ddtruong,:m_ddpmo,:m_ddphutrach,:m_userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_idthuchien",OracleType.Number).Value=m_idthuchien;
					cmd.Parameters.Add("m_ngay",OracleType.VarChar,16).Value=m_ngay;
					cmd.Parameters.Add("m_nhanxet",OracleType.NVarChar,500).Value=m_nhanxet;
					cmd.Parameters.Add("m_ddtruong",OracleType.VarChar,4).Value=m_ddtruong;
					cmd.Parameters.Add("m_ddpmo",OracleType.VarChar,4).Value=m_ddpmo;
					cmd.Parameters.Add("m_ddphutrach",OracleType.VarChar,4).Value=m_ddphutrach;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_kiemsoatcc");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_kiemsoatccct(string m_ngay,long m_id,int m_ma,int m_cokhong,string m_ghichu)
		{
			string xxx = user + mmyy(m_ngay);
			sql="update "+xxx+".ba_kiemsoatccct set cokhong=:m_cokhong,ghichu=:m_ghichu where id=:m_id and ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_cokhong",OracleType.Number).Value=m_cokhong;
				cmd.Parameters.Add("m_ghichu",OracleType.NVarChar,254).Value=m_ghichu;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_kiemsoatccct (id,ma,cokhong,ghichu) values (:m_id,:m_ma,:m_cokhong,:m_ghichu)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_cokhong",OracleType.Number).Value=m_cokhong;
					cmd.Parameters.Add("m_ghichu",OracleType.NVarChar,254).Value=m_ghichu;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_kiemsoatccct");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}


		public bool upd_ba_kiemsoat(string m_mmyy,long m_id,long m_idthuchien,string m_ngay,string m_thuoc,
			int m_tiembap,int m_tiemtm,decimal m_mach,decimal m_nhietdo,string m_huyetap,decimal m_nhiptho,
			string m_trigiac,string m_nhanxet,string m_ddtruong,string m_ddpmo,string m_ddphutrach,int m_userid)
		{
			string xxx = user + m_mmyy;
			sql="update "+xxx+".ba_kiemsoat set idthuchien=:m_idthuchien,ngay=to_date(:m_ngay,'dd/mm/yyyy hh24:mi'),";
			sql+="thuoc=:m_thuoc,tiembap=:m_tiembap,tiemtm=:m_tiemtm,mach=:m_mach,nhietdo=:m_nhietdo,huyetap=:m_huyetap,";
			sql+="nhiptho=:m_nhiptho,trigiac=:m_trigiac,nhanxet=:m_nhanxet,ddtruong=:m_ddtruong,ddpmo=:m_ddpmo,";
			sql+="ddphutrach=:m_ddphutrach,userid=:m_userid where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_idthuchien",OracleType.Number).Value=m_idthuchien;
				cmd.Parameters.Add("m_ngay",OracleType.VarChar,16).Value=m_ngay;
				cmd.Parameters.Add("m_thuoc",OracleType.NVarChar,500).Value=m_thuoc;
				cmd.Parameters.Add("m_tiembap",OracleType.Number).Value=m_tiembap;
				cmd.Parameters.Add("m_tiemtm",OracleType.Number).Value=m_tiemtm;
				cmd.Parameters.Add("m_mach",OracleType.Number).Value=m_mach;
				cmd.Parameters.Add("m_nhietdo",OracleType.Number).Value=m_nhietdo;
				cmd.Parameters.Add("m_huyetap",OracleType.VarChar,7).Value=m_huyetap;
				cmd.Parameters.Add("m_nhiptho",OracleType.Number).Value=m_nhiptho;
				cmd.Parameters.Add("m_trigiac",OracleType.NVarChar,100).Value=m_trigiac;
				cmd.Parameters.Add("m_nhanxet",OracleType.NVarChar,500).Value=m_nhanxet;
				cmd.Parameters.Add("m_ddtruong",OracleType.VarChar,4).Value=m_ddtruong;
				cmd.Parameters.Add("m_ddpmo",OracleType.VarChar,4).Value=m_ddpmo;
				cmd.Parameters.Add("m_ddphutrach",OracleType.VarChar,4).Value=m_ddphutrach;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_kiemsoat (id,idthuchien,ngay,thuoc,tiembap,tiemtm,mach,nhietdo,huyetap,nhiptho,trigiac,nhanxet,ddtruong,ddpmo,ddphutrach,userid) values (:m_id,:m_idthuchien,to_date(:m_ngay,'dd/mm/yyyy hh24:mi'),:m_thuoc,:m_tiembap,:m_tiemtm,:m_mach,:m_nhietdo,:m_huyetap,:m_nhiptho,:m_trigiac,:m_nhanxet,:m_ddtruong,:m_ddpmo,:m_ddphutrach,:m_userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_idthuchien",OracleType.Number).Value=m_idthuchien;
					cmd.Parameters.Add("m_ngay",OracleType.VarChar,16).Value=m_ngay;
					cmd.Parameters.Add("m_thuoc",OracleType.NVarChar,500).Value=m_thuoc;
					cmd.Parameters.Add("m_tiembap",OracleType.Number).Value=m_tiembap;
					cmd.Parameters.Add("m_tiemtm",OracleType.Number).Value=m_tiemtm;
					cmd.Parameters.Add("m_mach",OracleType.Number).Value=m_mach;
					cmd.Parameters.Add("m_nhietdo",OracleType.Number).Value=m_nhietdo;
					cmd.Parameters.Add("m_huyetap",OracleType.VarChar,7).Value=m_huyetap;
					cmd.Parameters.Add("m_nhiptho",OracleType.Number).Value=m_nhiptho;
					cmd.Parameters.Add("m_trigiac",OracleType.NVarChar,100).Value=m_trigiac;
					cmd.Parameters.Add("m_nhanxet",OracleType.NVarChar,500).Value=m_nhanxet;
					cmd.Parameters.Add("m_ddtruong",OracleType.VarChar,4).Value=m_ddtruong;
					cmd.Parameters.Add("m_ddpmo",OracleType.VarChar,4).Value=m_ddpmo;
					cmd.Parameters.Add("m_ddphutrach",OracleType.VarChar,4).Value=m_ddphutrach;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_kiemsoat");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_kiemsoatct(string m_ngay,long m_id,int m_ma,int m_cokhong,string m_ghichu)
		{
			string xxx = user + mmyy(m_ngay);
			sql="update "+xxx+".ba_kiemsoatct set cokhong=:m_cokhong,ghichu=:m_ghichu where id=:m_id and ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_cokhong",OracleType.Number).Value=m_cokhong;
				cmd.Parameters.Add("m_ghichu",OracleType.NVarChar,254).Value=m_ghichu;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_kiemsoatct (id,ma,cokhong,ghichu) values (:m_id,:m_ma,:m_cokhong,:m_ghichu)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_cokhong",OracleType.Number).Value=m_cokhong;
					cmd.Parameters.Add("m_ghichu",OracleType.NVarChar,254).Value=m_ghichu;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_kiemsoatct");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_puthuoc(long m_id,long m_idthuchien,string m_ngay,string m_ten,
			string m_phuongphap,string m_bscd,string m_nguoithu,string m_bsdoc,string m_ketqua,int m_userid)
		{
			string xxx = user + mmyy(m_ngay);
			sql="update "+xxx+".ba_puthuoc set idthuchien=:m_idthuchien,ngay=to_date(:m_ngay,'dd/mm/yyyy hh24:mi'),";
			sql+="ten=:m_ten,phuongphap=:m_phuongphap,bscd=:m_bscd,nguoithu=:m_nguoithu,bsdoc=:m_bsdoc,";
			sql+="ketqua=:m_ketqua,userid=:m_userid where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_idthuchien",OracleType.Number).Value=m_idthuchien;
				cmd.Parameters.Add("m_ngay",OracleType.VarChar,16).Value=m_ngay;
				cmd.Parameters.Add("m_ten",OracleType.NVarChar,500).Value=m_ten;
				cmd.Parameters.Add("m_phuongphap",OracleType.NVarChar,254).Value=m_phuongphap;
				cmd.Parameters.Add("m_bscd",OracleType.VarChar,4).Value=m_bscd;
				cmd.Parameters.Add("m_nguoithu",OracleType.VarChar,4).Value=m_nguoithu;
				cmd.Parameters.Add("m_bsdoc",OracleType.VarChar,4).Value=m_bsdoc;
				cmd.Parameters.Add("m_ketqua",OracleType.NVarChar,500).Value=m_ketqua;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_puthuoc (id,idthuchien,ngay,ten,phuongphap,bscd,nguoithu,bsdoc,ketqua,userid) values (:m_id,:m_idthuchien,to_date(:m_ngay,'dd/mm/yyyy hh24:mi'),:m_ten,:m_phuongphap,:m_bscd,:m_nguoithu,:m_bsdoc,:m_ketqua,:m_userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_idthuchien",OracleType.Number).Value=m_idthuchien;
					cmd.Parameters.Add("m_ngay",OracleType.VarChar,16).Value=m_ngay;
					cmd.Parameters.Add("m_ten",OracleType.NVarChar,500).Value=m_ten;
					cmd.Parameters.Add("m_phuongphap",OracleType.NVarChar,254).Value=m_phuongphap;
					cmd.Parameters.Add("m_bscd",OracleType.VarChar,4).Value=m_bscd;
					cmd.Parameters.Add("m_nguoithu",OracleType.VarChar,4).Value=m_nguoithu;
					cmd.Parameters.Add("m_bsdoc",OracleType.VarChar,4).Value=m_bsdoc;
					cmd.Parameters.Add("m_ketqua",OracleType.NVarChar,500).Value=m_ketqua;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_puthuoc");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_camdoan(long m_id,long m_idthuchien,string m_ngay,string m_hoten,int m_tuoi,string m_phai,
			string m_dantoc,string m_nghenghiep,string m_ngoaikieu,string m_diachi,string m_noilam,
			string m_nguoinha,int m_dongy,string m_ghichu,int m_userid)
		{
			string xxx = user + mmyy(m_ngay);
			sql="update "+xxx+".ba_camdoan set idthuchien=:m_idthuchien,ngay=to_date(:m_ngay,'dd/mm/yyyy hh24:mi'),";
			sql+="hoten=:m_hoten,tuoi=:m_tuoi,phai=:m_phai,dantoc=:m_dantoc,nghenghiep=:m_nghenghiep,";
			sql+="ngoaikieu=:m_ngoaikieu,diachi=:m_diachi,noilam=:m_noilam,";
			sql+="nguoinha=:m_nguoinha,dongy=:m_dongy,ghichu=:m_ghichu,userid=:m_userid where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_idthuchien",OracleType.Number).Value=m_idthuchien;
				cmd.Parameters.Add("m_ngay",OracleType.VarChar,16).Value=m_ngay;
				cmd.Parameters.Add("m_hoten",OracleType.NVarChar,100).Value=m_hoten;
				cmd.Parameters.Add("m_tuoi",OracleType.Number).Value=m_tuoi;
				cmd.Parameters.Add("m_phai",OracleType.NVarChar,10).Value=m_phai;
				cmd.Parameters.Add("m_dantoc",OracleType.NVarChar,20).Value=m_dantoc;
				cmd.Parameters.Add("m_nghenghiep",OracleType.NVarChar,100).Value=m_nghenghiep;
				cmd.Parameters.Add("m_ngoaikieu",OracleType.NVarChar,20).Value=m_ngoaikieu;
				cmd.Parameters.Add("m_diachi",OracleType.NVarChar,100).Value=m_diachi;
				cmd.Parameters.Add("m_noilam",OracleType.NVarChar,100).Value=m_noilam;
				cmd.Parameters.Add("m_nguoinha",OracleType.NVarChar,254).Value=m_nguoinha;
				cmd.Parameters.Add("m_dongy",OracleType.Number).Value=m_dongy;
				cmd.Parameters.Add("m_ghichu",OracleType.NVarChar,500).Value=m_ghichu;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_camdoan (id,idthuchien,ngay,hoten,tuoi,phai,dantoc,nghenghiep,ngoaikieu,diachi,noilam,nguoinha,dongy,ghichu,userid) values (:m_id,:m_idthuchien,to_date(:m_ngay,'dd/mm/yyyy hh24:mi'),:m_hoten,:m_tuoi,:m_phai,:m_dantoc,:m_nghenghiep,:m_ngoaikieu,:m_diachi,:m_noilam,:m_nguoinha,:m_dongy,:m_ghichu,:m_userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_idthuchien",OracleType.Number).Value=m_idthuchien;
					cmd.Parameters.Add("m_ngay",OracleType.VarChar,16).Value=m_ngay;
					cmd.Parameters.Add("m_hoten",OracleType.NVarChar,100).Value=m_hoten;
					cmd.Parameters.Add("m_tuoi",OracleType.Number).Value=m_tuoi;
					cmd.Parameters.Add("m_phai",OracleType.NVarChar,10).Value=m_phai;
					cmd.Parameters.Add("m_dantoc",OracleType.NVarChar,20).Value=m_dantoc;
					cmd.Parameters.Add("m_nghenghiep",OracleType.NVarChar,100).Value=m_nghenghiep;
					cmd.Parameters.Add("m_ngoaikieu",OracleType.NVarChar,20).Value=m_ngoaikieu;
					cmd.Parameters.Add("m_diachi",OracleType.NVarChar,100).Value=m_diachi;
					cmd.Parameters.Add("m_noilam",OracleType.NVarChar,100).Value=m_noilam;
					cmd.Parameters.Add("m_nguoinha",OracleType.NVarChar,254).Value=m_nguoinha;
					cmd.Parameters.Add("m_dongy",OracleType.Number).Value=m_dongy;
					cmd.Parameters.Add("m_ghichu",OracleType.NVarChar,500).Value=m_ghichu;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_camdoan");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_camdoan(long m_id,string m_ngay,byte[] m_image)
		{
			string xxx = user + mmyy(m_ngay);
			sql="update "+xxx+".ba_camdoan set image=:m_image where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_image",OracleType.Blob,m_image.Length).Value=m_image;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.ExecuteNonQuery();
				cmd.Dispose();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_camdoan");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_hoichanthuoc(long m_id,long m_idthuchien,string m_ngay,string m_tu,string m_den,string m_mabs,
			string m_thuky,string m_thanhvien,int m_tinhtrang,string m_gan,string m_sgot,string m_sgpt,string m_ure,
			string m_creatimin,string m_ion,string m_ctm,string m_tptnt,string m_xq,string m_vikhuan,string m_ksd,
			string m_thuoc,string m_thaythe,string m_lydo,int m_userid)
		{
			string xxx = user + mmyy(m_ngay);
			sql="update "+xxx+".ba_hoichanthuoc set idthuchien=:m_idthuchien,ngay=to_date(:m_ngay,'dd/mm/yyyy hh24:mi'),";
			sql+="tu=to_date(:m_tu,'dd/mm/yyyy'),den=to_date(:m_den,'dd/mm/yyyy'),mabs=:m_mabs,thuky=:m_thuky,";
			sql+="thanhvien=:m_thanhvien,tinhtrang=:m_tinhtrang,gan=:m_gan,sgot=:m_sgot,sgpt=:m_sgpt,ure=:m_ure,";
			sql+="creatimin=:m_creatimin,ion=:m_ion,ctm=:m_ctm,tptnt=:m_tptnt,xq=:m_xq,vikhuan=:m_vikhuan,ksd=:m_ksd,";
			sql+="thuoc=:m_thuoc,thaythe=:m_thaythe,lydo=:m_lydo,";
			sql+="userid=:m_userid where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_idthuchien",OracleType.Number).Value=m_idthuchien;
				cmd.Parameters.Add("m_ngay",OracleType.VarChar,16).Value=m_ngay;
				cmd.Parameters.Add("m_tu",OracleType.VarChar,10).Value=m_tu;
				cmd.Parameters.Add("m_den",OracleType.VarChar,10).Value=m_den;
				cmd.Parameters.Add("m_mabs",OracleType.VarChar,4).Value=m_mabs;
				cmd.Parameters.Add("m_thuky",OracleType.VarChar,4).Value=m_thuky;
				cmd.Parameters.Add("m_thanhvien",OracleType.NVarChar,500).Value=m_thanhvien;
				cmd.Parameters.Add("m_tinhtrang",OracleType.Number).Value=m_tinhtrang;
				cmd.Parameters.Add("m_gan",OracleType.NVarChar,50).Value=m_gan;
				cmd.Parameters.Add("m_sgot",OracleType.NVarChar,20).Value=m_sgot;
				cmd.Parameters.Add("m_sgpt",OracleType.NVarChar,20).Value=m_sgpt;
				cmd.Parameters.Add("m_ure",OracleType.NVarChar,20).Value=m_ure;
				cmd.Parameters.Add("m_creatimin",OracleType.NVarChar,20).Value=m_creatimin;
				cmd.Parameters.Add("m_ion",OracleType.NVarChar,254).Value=m_ion;
				cmd.Parameters.Add("m_ctm",OracleType.NVarChar,254).Value=m_ctm;
				cmd.Parameters.Add("m_tptnt",OracleType.NVarChar,254).Value=m_tptnt;
				cmd.Parameters.Add("m_xq",OracleType.NVarChar,254).Value=m_xq;
				cmd.Parameters.Add("m_vikhuan",OracleType.NVarChar,254).Value=m_vikhuan;
				cmd.Parameters.Add("m_ksd",OracleType.NVarChar,254).Value=m_ksd;
				cmd.Parameters.Add("m_thuoc",OracleType.NVarChar,500).Value=m_thuoc;
				cmd.Parameters.Add("m_thaythe",OracleType.NVarChar,500).Value=m_thaythe;
				cmd.Parameters.Add("m_lydo",OracleType.NVarChar,500).Value=m_lydo;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_hoichanthuoc (id,idthuchien,ngay,tu,den,mabs,thuky,thanhvien,tinhtrang,gan,sgot,sgpt,ure,creatimin,ion,ctm,tptnt,xq,vikhuan,ksd,thuoc,thaythe,lydo,userid) values (:m_id,:m_idthuchien,to_date(:m_ngay,'dd/mm/yyyy hh24:mi'),to_date(:m_tu,'dd/mm/yyyy'),to_date(:m_den,'dd/mm/yyyy'),:m_mabs,:m_thuky,:m_thanhvien,:m_tinhtrang,:m_gan,:m_sgot,:m_sgpt,:m_ure,:m_creatimin,:m_ion,:m_ctm,:m_tptnt,:m_xq,:m_vikhuan,:m_ksd,:m_thuoc,:m_thaythe,:m_lydo,:m_userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_idthuchien",OracleType.Number).Value=m_idthuchien;
					cmd.Parameters.Add("m_ngay",OracleType.VarChar,16).Value=m_ngay;
					cmd.Parameters.Add("m_tu",OracleType.VarChar,10).Value=m_tu;
					cmd.Parameters.Add("m_den",OracleType.VarChar,10).Value=m_den;
					cmd.Parameters.Add("m_mabs",OracleType.VarChar,4).Value=m_mabs;
					cmd.Parameters.Add("m_thuky",OracleType.VarChar,4).Value=m_thuky;
					cmd.Parameters.Add("m_thanhvien",OracleType.NVarChar,500).Value=m_thanhvien;
					cmd.Parameters.Add("m_tinhtrang",OracleType.Number).Value=m_tinhtrang;
					cmd.Parameters.Add("m_gan",OracleType.NVarChar,50).Value=m_gan;
					cmd.Parameters.Add("m_sgot",OracleType.NVarChar,20).Value=m_sgot;
					cmd.Parameters.Add("m_sgpt",OracleType.NVarChar,20).Value=m_sgpt;
					cmd.Parameters.Add("m_ure",OracleType.NVarChar,20).Value=m_ure;
					cmd.Parameters.Add("m_creatimin",OracleType.NVarChar,20).Value=m_creatimin;
					cmd.Parameters.Add("m_ion",OracleType.NVarChar,254).Value=m_ion;
					cmd.Parameters.Add("m_ctm",OracleType.NVarChar,254).Value=m_ctm;
					cmd.Parameters.Add("m_tptnt",OracleType.NVarChar,254).Value=m_tptnt;
					cmd.Parameters.Add("m_xq",OracleType.NVarChar,254).Value=m_xq;
					cmd.Parameters.Add("m_vikhuan",OracleType.NVarChar,254).Value=m_vikhuan;
					cmd.Parameters.Add("m_ksd",OracleType.NVarChar,254).Value=m_ksd;
					cmd.Parameters.Add("m_thuoc",OracleType.NVarChar,500).Value=m_thuoc;
					cmd.Parameters.Add("m_thaythe",OracleType.NVarChar,500).Value=m_thaythe;
					cmd.Parameters.Add("m_lydo",OracleType.NVarChar,500).Value=m_lydo;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_hoichanthuoc");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}


		public bool upd_ba_danhgia1(long m_id,long m_idthuchien,string m_ngay,string m_thuoc,int m_thuoc_k,decimal m_cannang,
			int m_chieucao,int m_mach,decimal m_nhietdo,string m_huyetap,int m_nhiptho,string m_diung,int m_diung_k,
			string m_tm,int m_tm_k,int m_tm_1,int m_tm_2,int m_tm_3,int m_tm_4,int m_tm_5,int m_tm_6,int m_tm_7,
			string m_hh,int m_hh_k,int m_hh_1,int m_hh_2,int m_hh_3,int m_hh_4,int m_hh_5,int m_hh_6,int m_hh_7,			
			string m_than,int m_than_k,int m_than_1,int m_than_2,int m_than_3,int m_than_4)
		{
			string xxx = user + mmyy(m_ngay);
			sql="update "+xxx+".ba_danhgia1 set idthuchien=:m_idthuchien,ngay=to_date(:m_ngay,'dd/mm/yyyy hh24:mi'),";
			sql+="thuoc=:m_thuoc,thuoc_k=:m_thuoc_k,cannang=:m_cannang,chieucao=:m_chieucao,mach=:m_mach,nhietdo=:m_nhietdo,";
			sql+="huyetap=:m_huyetap,nhiptho=:m_nhiptho,diung=:m_diung,diung_k=:m_diung_k,tm=:m_tm,tm_k=:m_tm_k,";
			sql+="tm_1=:m_tm_1,tm_2=:m_tm_2,tm_3=:m_tm_3,tm_4=:m_tm_4,tm_5=:m_tm_5,tm_6=:m_tm_6,tm_7=:m_tm_7,";
			sql+="hh=:m_hh,hh_k=:m_hh_k,hh_1=:m_hh_1,hh_2=:m_hh_2,hh_3=:m_hh_3,hh_4=:m_hh_4,hh_5=:m_hh_5,hh_6=:m_hh_6,";
			sql+="hh_7=:m_hh_7,than=:m_than,than_k=:m_than_k,than_1=:m_than_1,than_2=:m_than_2,than_3=:m_than_3,";
			sql+="than_4=:m_than_4";
			sql+=" where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_idthuchien",OracleType.Number).Value=m_idthuchien;
				cmd.Parameters.Add("m_ngay",OracleType.VarChar,16).Value=m_ngay;
				cmd.Parameters.Add("m_thuoc",OracleType.NVarChar,254).Value=m_thuoc;
				cmd.Parameters.Add("m_thuoc_k",OracleType.Number).Value=m_thuoc_k;
				cmd.Parameters.Add("m_cannang",OracleType.Number).Value=m_cannang;
				cmd.Parameters.Add("m_chieucao",OracleType.Number).Value=m_chieucao;
				cmd.Parameters.Add("m_mach",OracleType.Number).Value=m_mach;
				cmd.Parameters.Add("m_nhietdo",OracleType.Number).Value=m_nhietdo;
				cmd.Parameters.Add("m_huyetap",OracleType.VarChar,7).Value=m_huyetap;
				cmd.Parameters.Add("m_nhiptho",OracleType.Number).Value=m_nhiptho;
				cmd.Parameters.Add("m_diung",OracleType.NVarChar,254).Value=m_diung;
				cmd.Parameters.Add("m_diung_k",OracleType.Number).Value=m_diung_k;
				cmd.Parameters.Add("m_tm",OracleType.NVarChar,254).Value=m_tm;
				cmd.Parameters.Add("m_tm_k",OracleType.Number).Value=m_tm_k;
				cmd.Parameters.Add("m_tm_1",OracleType.Number).Value=m_tm_1;
				cmd.Parameters.Add("m_tm_2",OracleType.Number).Value=m_tm_2;
				cmd.Parameters.Add("m_tm_3",OracleType.Number).Value=m_tm_3;
				cmd.Parameters.Add("m_tm_4",OracleType.Number).Value=m_tm_4;
				cmd.Parameters.Add("m_tm_5",OracleType.Number).Value=m_tm_5;
				cmd.Parameters.Add("m_tm_6",OracleType.Number).Value=m_tm_6;
				cmd.Parameters.Add("m_tm_7",OracleType.Number).Value=m_tm_7;
				cmd.Parameters.Add("m_hh",OracleType.NVarChar,254).Value=m_hh;
				cmd.Parameters.Add("m_hh_k",OracleType.Number).Value=m_hh_k;
				cmd.Parameters.Add("m_hh_1",OracleType.Number).Value=m_hh_1;
				cmd.Parameters.Add("m_hh_2",OracleType.Number).Value=m_hh_2;
				cmd.Parameters.Add("m_hh_3",OracleType.Number).Value=m_hh_3;
				cmd.Parameters.Add("m_hh_4",OracleType.Number).Value=m_hh_4;
				cmd.Parameters.Add("m_hh_5",OracleType.Number).Value=m_hh_5;
				cmd.Parameters.Add("m_hh_6",OracleType.Number).Value=m_hh_6;
				cmd.Parameters.Add("m_hh_7",OracleType.Number).Value=m_hh_7;
				cmd.Parameters.Add("m_than",OracleType.NVarChar,254).Value=m_than;
				cmd.Parameters.Add("m_than_k",OracleType.Number).Value=m_than_k;
				cmd.Parameters.Add("m_than_1",OracleType.Number).Value=m_than_1;
				cmd.Parameters.Add("m_than_2",OracleType.Number).Value=m_than_2;
				cmd.Parameters.Add("m_than_3",OracleType.Number).Value=m_than_3;
				cmd.Parameters.Add("m_than_4",OracleType.Number).Value=m_than_4;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_danhgia1 (id,idthuchien,ngay,thuoc,thuoc_k,cannang,chieucao,mach,nhietdo,huyetap,nhiptho,diung,diung_k,tm,tm_k,tm_1,tm_2,tm_3,tm_4,tm_5,tm_6,tm_7,hh,hh_k,hh_1,hh_2,hh_3,hh_4,hh_5,hh_6,hh_7,than,than_k,than_1,than_2,than_3,than_4) values (:m_id,:m_idthuchien,to_date(:m_ngay,'dd/mm/yyyy hh24:mi'),:m_thuoc,:m_thuoc_k,:m_cannang,:m_chieucao,:m_mach,:m_nhietdo,:m_huyetap,:m_nhiptho,:m_diung,:m_diung_k,:m_tm,:m_tm_k,:m_tm_1,:m_tm_2,:m_tm_3,:m_tm_4,:m_tm_5,:m_tm_6,:m_tm_7,:m_hh,:m_hh_k,:m_hh_1,:m_hh_2,:m_hh_3,:m_hh_4,:m_hh_5,:m_hh_6,:m_hh_7,:m_than,:m_than_k,:m_than_1,:m_than_2,:m_than_3,:m_than_4)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_idthuchien",OracleType.Number).Value=m_idthuchien;
					cmd.Parameters.Add("m_ngay",OracleType.VarChar,16).Value=m_ngay;
					cmd.Parameters.Add("m_thuoc",OracleType.NVarChar,254).Value=m_thuoc;
					cmd.Parameters.Add("m_thuoc_k",OracleType.Number).Value=m_thuoc_k;
					cmd.Parameters.Add("m_cannang",OracleType.Number).Value=m_cannang;
					cmd.Parameters.Add("m_chieucao",OracleType.Number).Value=m_chieucao;
					cmd.Parameters.Add("m_mach",OracleType.Number).Value=m_mach;
					cmd.Parameters.Add("m_nhietdo",OracleType.Number).Value=m_nhietdo;
					cmd.Parameters.Add("m_huyetap",OracleType.VarChar,7).Value=m_huyetap;
					cmd.Parameters.Add("m_nhiptho",OracleType.Number).Value=m_nhiptho;
					cmd.Parameters.Add("m_diung",OracleType.NVarChar,254).Value=m_diung;
					cmd.Parameters.Add("m_diung_k",OracleType.Number).Value=m_diung_k;
					cmd.Parameters.Add("m_tm",OracleType.NVarChar,254).Value=m_tm;
					cmd.Parameters.Add("m_tm_k",OracleType.Number).Value=m_tm_k;
					cmd.Parameters.Add("m_tm_1",OracleType.Number).Value=m_tm_1;
					cmd.Parameters.Add("m_tm_2",OracleType.Number).Value=m_tm_2;
					cmd.Parameters.Add("m_tm_3",OracleType.Number).Value=m_tm_3;
					cmd.Parameters.Add("m_tm_4",OracleType.Number).Value=m_tm_4;
					cmd.Parameters.Add("m_tm_5",OracleType.Number).Value=m_tm_5;
					cmd.Parameters.Add("m_tm_6",OracleType.Number).Value=m_tm_6;
					cmd.Parameters.Add("m_tm_7",OracleType.Number).Value=m_tm_7;
					cmd.Parameters.Add("m_hh",OracleType.NVarChar,254).Value=m_hh;
					cmd.Parameters.Add("m_hh_k",OracleType.Number).Value=m_hh_k;
					cmd.Parameters.Add("m_hh_1",OracleType.Number).Value=m_hh_1;
					cmd.Parameters.Add("m_hh_2",OracleType.Number).Value=m_hh_2;
					cmd.Parameters.Add("m_hh_3",OracleType.Number).Value=m_hh_3;
					cmd.Parameters.Add("m_hh_4",OracleType.Number).Value=m_hh_4;
					cmd.Parameters.Add("m_hh_5",OracleType.Number).Value=m_hh_5;
					cmd.Parameters.Add("m_hh_6",OracleType.Number).Value=m_hh_6;
					cmd.Parameters.Add("m_hh_7",OracleType.Number).Value=m_hh_7;
					cmd.Parameters.Add("m_than",OracleType.NVarChar,254).Value=m_than;
					cmd.Parameters.Add("m_than_k",OracleType.Number).Value=m_than_k;
					cmd.Parameters.Add("m_than_1",OracleType.Number).Value=m_than_1;
					cmd.Parameters.Add("m_than_2",OracleType.Number).Value=m_than_2;
					cmd.Parameters.Add("m_than_3",OracleType.Number).Value=m_than_3;
					cmd.Parameters.Add("m_than_4",OracleType.Number).Value=m_than_4;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_danhgia1");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_danhgia2(long m_id2,string m_ngay,string m_noitiet,int m_noitiet_k,int m_noitiet_1,int m_noitiet_2,
			int m_noitiet_3,int m_noitiet_4,int m_noitiet_5,int m_noitiet_6,string m_tieuhoa,int m_tieuhoa_k,int m_tieuhoa_1,
			int m_tieuhoa_2,int m_tieuhoa_3,int m_tieuhoa_4,int m_tieuhoa_5,int m_tieuhoa_6,int m_tieuhoa_7,
			string m_thankinh,int m_thankinh_k,int m_thankinh_1,int m_thankinh_2,int m_thankinh_3,int m_thankinh_4,
			string m_huyethoc,int m_huyethoc_k,int m_huyethoc_1,int m_huyethoc_2,int m_huyethoc_3)
		{
			string xxx = user + mmyy(m_ngay);
			sql="update "+xxx+".ba_danhgia2 set ";
			sql+="noitiet=:m_noitiet,noitiet_k=:m_noitiet_k,noitiet_1=:m_noitiet_1,noitiet_2=:m_noitiet_2,";
			sql+="noitiet_3=:m_noitiet_3,noitiet_4=:m_noitiet_4,noitiet_5=:m_noitiet_5,noitiet_6=:m_noitiet_6,";
			sql+="tieuhoa=:m_tieuhoa,tieuhoa_k=:m_tieuhoa_k,tieuhoa_1=:m_tieuhoa_1,tieuhoa_2=:m_tieuhoa_2,";
			sql+="tieuhoa_3=:m_tieuhoa_3,tieuhoa_4=:m_tieuhoa_4,tieuhoa_5=:m_tieuhoa_5,tieuhoa_6=:m_tieuhoa_6,";
			sql+="tieuhoa_7=:m_tieuhoa_7,thankinh=:m_thankinh,thankinh_k=:m_thankinh_k,thankinh_1=:m_thankinh_1,";
			sql+="thankinh_2=:m_thankinh_2,thankinh_3=:m_thankinh_3,thankinh_4=:m_thankinh_4,huyethoc=:m_huyethoc,";
			sql+="huyethoc_k=:m_huyethoc_k,huyethoc_1=:m_huyethoc_1,huyethoc_2=:m_huyethoc_2,huyethoc_3=:m_huyethoc_3";
			sql+=" where id2=:m_id2";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_noitiet",OracleType.NVarChar,254).Value=m_noitiet;
				cmd.Parameters.Add("m_noitiet_k",OracleType.Number).Value=m_noitiet_k;
				cmd.Parameters.Add("m_noitiet_1",OracleType.Number).Value=m_noitiet_1;
				cmd.Parameters.Add("m_noitiet_2",OracleType.Number).Value=m_noitiet_2;
				cmd.Parameters.Add("m_noitiet_3",OracleType.Number).Value=m_noitiet_3;
				cmd.Parameters.Add("m_noitiet_4",OracleType.Number).Value=m_noitiet_4;
				cmd.Parameters.Add("m_noitiet_5",OracleType.Number).Value=m_noitiet_5;
				cmd.Parameters.Add("m_noitiet_6",OracleType.Number).Value=m_noitiet_6;
				cmd.Parameters.Add("m_tieuhoa",OracleType.NVarChar,254).Value=m_tieuhoa;
				cmd.Parameters.Add("m_tieuhoa_k",OracleType.Number).Value=m_tieuhoa_k;
				cmd.Parameters.Add("m_tieuhoa_1",OracleType.Number).Value=m_tieuhoa_1;
				cmd.Parameters.Add("m_tieuhoa_2",OracleType.Number).Value=m_tieuhoa_2;
				cmd.Parameters.Add("m_tieuhoa_3",OracleType.Number).Value=m_tieuhoa_3;
				cmd.Parameters.Add("m_tieuhoa_4",OracleType.Number).Value=m_tieuhoa_4;
				cmd.Parameters.Add("m_tieuhoa_5",OracleType.Number).Value=m_tieuhoa_5;
				cmd.Parameters.Add("m_tieuhoa_6",OracleType.Number).Value=m_tieuhoa_6;
				cmd.Parameters.Add("m_tieuhoa_7",OracleType.Number).Value=m_tieuhoa_7;
				cmd.Parameters.Add("m_thankinh",OracleType.NVarChar,254).Value=m_thankinh;
				cmd.Parameters.Add("m_thankinh_k",OracleType.Number).Value=m_thankinh_k;
				cmd.Parameters.Add("m_thankinh_1",OracleType.Number).Value=m_thankinh_1;
				cmd.Parameters.Add("m_thankinh_2",OracleType.Number).Value=m_thankinh_2;
				cmd.Parameters.Add("m_thankinh_3",OracleType.Number).Value=m_thankinh_3;
				cmd.Parameters.Add("m_thankinh_4",OracleType.Number).Value=m_thankinh_4;
				cmd.Parameters.Add("m_huyethoc",OracleType.NVarChar,254).Value=m_huyethoc;
				cmd.Parameters.Add("m_huyethoc_k",OracleType.Number).Value=m_huyethoc_k;
				cmd.Parameters.Add("m_huyethoc_1",OracleType.Number).Value=m_huyethoc_1;
				cmd.Parameters.Add("m_huyethoc_2",OracleType.Number).Value=m_huyethoc_2;
				cmd.Parameters.Add("m_huyethoc_3",OracleType.Number).Value=m_huyethoc_3;
				cmd.Parameters.Add("m_id2",OracleType.Number).Value=m_id2;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_danhgia2 (id2,noitiet,noitiet_k,noitiet_1,noitiet_2,noitiet_3,noitiet_4,noitiet_5,noitiet_6,tieuhoa,tieuhoa_k,tieuhoa_1,tieuhoa_2,tieuhoa_3,tieuhoa_4,tieuhoa_5,tieuhoa_6,tieuhoa_7,thankinh,thankinh_k,thankinh_1,thankinh_2,thankinh_3,thankinh_4,huyethoc,huyethoc_k,huyethoc_1,huyethoc_2,huyethoc_3) values (:m_id2,:m_noitiet,:m_noitiet_k,:m_noitiet_1,:m_noitiet_2,:m_noitiet_3,:m_noitiet_4,:m_noitiet_5,:m_noitiet_6,:m_tieuhoa,:m_tieuhoa_k,:m_tieuhoa_1,:m_tieuhoa_2,:m_tieuhoa_3,:m_tieuhoa_4,:m_tieuhoa_5,:m_tieuhoa_6,:m_tieuhoa_7,:m_thankinh,:m_thankinh_k,:m_thankinh_1,:m_thankinh_2,:m_thankinh_3,:m_thankinh_4,:m_huyethoc,:m_huyethoc_k,:m_huyethoc_1,:m_huyethoc_2,:m_huyethoc_3)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id2",OracleType.Number).Value=m_id2;
					cmd.Parameters.Add("m_noitiet",OracleType.NVarChar,254).Value=m_noitiet;
					cmd.Parameters.Add("m_noitiet_k",OracleType.Number).Value=m_noitiet_k;
					cmd.Parameters.Add("m_noitiet_1",OracleType.Number).Value=m_noitiet_1;
					cmd.Parameters.Add("m_noitiet_2",OracleType.Number).Value=m_noitiet_2;
					cmd.Parameters.Add("m_noitiet_3",OracleType.Number).Value=m_noitiet_3;
					cmd.Parameters.Add("m_noitiet_4",OracleType.Number).Value=m_noitiet_4;
					cmd.Parameters.Add("m_noitiet_5",OracleType.Number).Value=m_noitiet_5;
					cmd.Parameters.Add("m_noitiet_6",OracleType.Number).Value=m_noitiet_6;
					cmd.Parameters.Add("m_tieuhoa",OracleType.NVarChar,254).Value=m_tieuhoa;
					cmd.Parameters.Add("m_tieuhoa_k",OracleType.Number).Value=m_tieuhoa_k;
					cmd.Parameters.Add("m_tieuhoa_1",OracleType.Number).Value=m_tieuhoa_1;
					cmd.Parameters.Add("m_tieuhoa_2",OracleType.Number).Value=m_tieuhoa_2;
					cmd.Parameters.Add("m_tieuhoa_3",OracleType.Number).Value=m_tieuhoa_3;
					cmd.Parameters.Add("m_tieuhoa_4",OracleType.Number).Value=m_tieuhoa_4;
					cmd.Parameters.Add("m_tieuhoa_5",OracleType.Number).Value=m_tieuhoa_5;
					cmd.Parameters.Add("m_tieuhoa_6",OracleType.Number).Value=m_tieuhoa_6;
					cmd.Parameters.Add("m_tieuhoa_7",OracleType.Number).Value=m_tieuhoa_7;
					cmd.Parameters.Add("m_thankinh",OracleType.NVarChar,254).Value=m_thankinh;
					cmd.Parameters.Add("m_thankinh_k",OracleType.Number).Value=m_thankinh_k;
					cmd.Parameters.Add("m_thankinh_1",OracleType.Number).Value=m_thankinh_1;
					cmd.Parameters.Add("m_thankinh_2",OracleType.Number).Value=m_thankinh_2;
					cmd.Parameters.Add("m_thankinh_3",OracleType.Number).Value=m_thankinh_3;
					cmd.Parameters.Add("m_thankinh_4",OracleType.Number).Value=m_thankinh_4;
					cmd.Parameters.Add("m_huyethoc",OracleType.NVarChar,254).Value=m_huyethoc;
					cmd.Parameters.Add("m_huyethoc_k",OracleType.Number).Value=m_huyethoc_k;
					cmd.Parameters.Add("m_huyethoc_1",OracleType.Number).Value=m_huyethoc_1;
					cmd.Parameters.Add("m_huyethoc_2",OracleType.Number).Value=m_huyethoc_2;
					cmd.Parameters.Add("m_huyethoc_3",OracleType.Number).Value=m_huyethoc_3;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_danhgia2");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_danhgia3(long m_id3,string m_ngay,string m_lamsang,string m_kham,int m_kham_1,int m_kham_2,
			int m_kham_3,int m_kham_4,int m_kham_5,string m_xn,string m_cls,string m_luuy,string m_asa,int m_thaoluan_1,
			int m_thaoluan_2,int m_thaoluan_3,int m_thaoluan_4,int m_thaoluan_5,string m_kehoach,string m_mabs,int m_userid)
		{
			string xxx = user + mmyy(m_ngay);
			sql="update "+xxx+".ba_danhgia3 set ";
			sql+="lamsang=:m_lamsang,kham=:m_kham,kham_1=:m_kham_1,kham_2=:m_kham_2,kham_3=:m_kham_3,kham_4=:m_kham_4,";
			sql+="kham_5=:m_kham_5,xn=:m_xn,cls=:m_cls,luuy=:m_luuy,asa=:m_asa,thaoluan_1=:m_thaoluan_1,thaoluan_2=:m_thaoluan_2,";
			sql+="thaoluan_3=:m_thaoluan_3,thaoluan_4=:m_thaoluan_4,thaoluan_5=:m_thaoluan_5,kehoach=:m_kehoach,";
			sql+="mabs=:m_mabs,userid=:m_userid";
			sql+=" where id3=:m_id3";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_lamsang",OracleType.NVarChar,1000).Value=m_lamsang;
				cmd.Parameters.Add("m_kham",OracleType.NVarChar,254).Value=m_kham;
				cmd.Parameters.Add("m_kham_1",OracleType.Number).Value=m_kham_1;
				cmd.Parameters.Add("m_kham_2",OracleType.Number).Value=m_kham_2;
				cmd.Parameters.Add("m_kham_3",OracleType.Number).Value=m_kham_3;
				cmd.Parameters.Add("m_kham_4",OracleType.Number).Value=m_kham_4;
				cmd.Parameters.Add("m_kham_5",OracleType.Number).Value=m_kham_5;
				cmd.Parameters.Add("m_xn",OracleType.NVarChar,1000).Value=m_xn;
				cmd.Parameters.Add("m_cls",OracleType.NVarChar,1000).Value=m_cls;
				cmd.Parameters.Add("m_luuy",OracleType.NVarChar,500).Value=m_luuy;
				cmd.Parameters.Add("m_asa",OracleType.VarChar,1).Value=m_asa;
				cmd.Parameters.Add("m_thaoluan_1",OracleType.Number).Value=m_thaoluan_1;
				cmd.Parameters.Add("m_thaoluan_2",OracleType.Number).Value=m_thaoluan_2;
				cmd.Parameters.Add("m_thaoluan_3",OracleType.Number).Value=m_thaoluan_3;
				cmd.Parameters.Add("m_thaoluan_4",OracleType.Number).Value=m_thaoluan_4;
				cmd.Parameters.Add("m_thaoluan_5",OracleType.Number).Value=m_thaoluan_5;
				cmd.Parameters.Add("m_kehoach",OracleType.NVarChar,500).Value=m_kehoach;
				cmd.Parameters.Add("m_mabs",OracleType.VarChar,4).Value=m_mabs;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id3",OracleType.Number).Value=m_id3;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_danhgia3 (id3,lamsang,kham,kham_1,kham_2,kham_3,kham_4,kham_5,xn,cls,luuy,asa,thaoluan_1,thaoluan_2,thaoluan_3,thaoluan_4,thaoluan_5,kehoach,mabs,userid) values (:m_id3,:m_lamsang,:m_kham,:m_kham_1,:m_kham_2,:m_kham_3,:m_kham_4,:m_kham_5,:m_xn,:m_cls,:m_luuy,:m_asa,:m_thaoluan_1,:m_thaoluan_2,:m_thaoluan_3,:m_thaoluan_4,:m_thaoluan_5,:m_kehoach,:m_mabs,:m_userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id3",OracleType.Number).Value=m_id3;
					cmd.Parameters.Add("m_lamsang",OracleType.NVarChar,1000).Value=m_lamsang;
					cmd.Parameters.Add("m_kham",OracleType.NVarChar,254).Value=m_kham;
					cmd.Parameters.Add("m_kham_1",OracleType.Number).Value=m_kham_1;
					cmd.Parameters.Add("m_kham_2",OracleType.Number).Value=m_kham_2;
					cmd.Parameters.Add("m_kham_3",OracleType.Number).Value=m_kham_3;
					cmd.Parameters.Add("m_kham_4",OracleType.Number).Value=m_kham_4;
					cmd.Parameters.Add("m_kham_5",OracleType.Number).Value=m_kham_5;
					cmd.Parameters.Add("m_xn",OracleType.NVarChar,1000).Value=m_xn;
					cmd.Parameters.Add("m_cls",OracleType.NVarChar,1000).Value=m_cls;
					cmd.Parameters.Add("m_luuy",OracleType.NVarChar,500).Value=m_luuy;
					cmd.Parameters.Add("m_asa",OracleType.VarChar,1).Value=m_asa;
					cmd.Parameters.Add("m_thaoluan_1",OracleType.Number).Value=m_thaoluan_1;
					cmd.Parameters.Add("m_thaoluan_2",OracleType.Number).Value=m_thaoluan_2;
					cmd.Parameters.Add("m_thaoluan_3",OracleType.Number).Value=m_thaoluan_3;
					cmd.Parameters.Add("m_thaoluan_4",OracleType.Number).Value=m_thaoluan_4;
					cmd.Parameters.Add("m_thaoluan_5",OracleType.Number).Value=m_thaoluan_5;
					cmd.Parameters.Add("m_kehoach",OracleType.NVarChar,500).Value=m_kehoach;
					cmd.Parameters.Add("m_mabs",OracleType.VarChar,4).Value=m_mabs;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_danhgia3");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_theodoian(long m_id,long m_idthuchien,string m_ngay,int m_duong,int m_loai,decimal m_soluong,
			string m_truoc,string m_sau,string m_ghichu,string m_yta,int m_userid)
		{
			string xxx = user + mmyy(m_ngay);
			sql="update "+xxx+".ba_theodoian set idthuchien=:m_idthuchien,ngay=to_date(:m_ngay,'dd/mm/yyyy hh24:mi'),";
			sql+="duong=:m_duong,loai=:m_loai,soluong=:m_soluong,truoc=:m_truoc,sau=:m_sau,ghichu=:m_ghichu,";
			sql+="yta=:m_yta,userid=:m_userid where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_idthuchien",OracleType.Number).Value=m_idthuchien;
				cmd.Parameters.Add("m_ngay",OracleType.VarChar,16).Value=m_ngay;
				cmd.Parameters.Add("m_duong",OracleType.Number).Value=m_duong;
				cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
				cmd.Parameters.Add("m_soluong",OracleType.Number).Value=m_soluong;
				cmd.Parameters.Add("m_truoc",OracleType.NVarChar,254).Value=m_truoc;
				cmd.Parameters.Add("m_sau",OracleType.NVarChar,254).Value=m_sau;
				cmd.Parameters.Add("m_ghichu",OracleType.NVarChar,254).Value=m_ghichu;
				cmd.Parameters.Add("m_yta",OracleType.VarChar,4).Value=m_yta;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_theodoian (id,idthuchien,ngay,duong,loai,soluong,truoc,sau,ghichu,yta,userid) values (:m_id,:m_idthuchien,to_date(:m_ngay,'dd/mm/yyyy hh24:mi'),:m_duong,:m_loai,:m_soluong,:m_truoc,:m_sau,:m_ghichu,:m_yta,:m_userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_idthuchien",OracleType.Number).Value=m_idthuchien;
					cmd.Parameters.Add("m_ngay",OracleType.VarChar,16).Value=m_ngay;
					cmd.Parameters.Add("m_duong",OracleType.Number).Value=m_duong;
					cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
					cmd.Parameters.Add("m_soluong",OracleType.Number).Value=m_soluong;
					cmd.Parameters.Add("m_truoc",OracleType.NVarChar,254).Value=m_truoc;
					cmd.Parameters.Add("m_sau",OracleType.NVarChar,254).Value=m_sau;
					cmd.Parameters.Add("m_ghichu",OracleType.NVarChar,254).Value=m_ghichu;
					cmd.Parameters.Add("m_yta",OracleType.VarChar,4).Value=m_yta;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_theodoian");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_theodoicn(string m_ngay,long m_id,long m_idthuchien,int m_userid)
		{
			string xxx = user + mmyy(m_ngay);
			sql="update "+xxx+".ba_theodoicn set idthuchien=:m_idthuchien,userid=:m_userid where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_idthuchien",OracleType.Number).Value=m_idthuchien;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_theodoicn (id,idthuchien,userid) values (:m_id,:m_idthuchien,:m_userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_idthuchien",OracleType.Number).Value=m_idthuchien;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_theodoicn");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_theodoicnct(long m_id,string m_ngay,decimal m_mach,decimal m_nhietdo,string m_huyetap,decimal m_nhiptho,decimal m_cannang,string m_yta,int m_userid)
		{
			string xxx = user + mmyy(m_ngay);
			sql="update "+xxx+".ba_theodoicnct set mach=:m_mach,nhietdo=:m_nhietdo,";
			sql+="huyetap=:m_huyetap,nhiptho=:m_nhiptho,cannang=:m_cannang,yta=:m_yta,userid=:m_userid where id=:m_id and ngay=to_date(:m_ngay,'dd/mm/yyyy hh24:mi')";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_mach",OracleType.Number).Value=m_mach;
				cmd.Parameters.Add("m_nhietdo",OracleType.Number).Value=m_nhietdo;
				cmd.Parameters.Add("m_huyetap",OracleType.VarChar,7).Value=m_huyetap;
				cmd.Parameters.Add("m_nhiptho",OracleType.Number).Value=m_nhiptho;
				cmd.Parameters.Add("m_cannang",OracleType.Number).Value=m_cannang;
				cmd.Parameters.Add("m_yta",OracleType.VarChar,4).Value=m_yta;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ngay",OracleType.VarChar,16).Value=m_ngay;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_theodoicnct (id,ngay,mach,nhietdo,huyetap,nhiptho,cannang,yta,userid) values (:m_id,to_date(:m_ngay,'dd/mm/yyyy hh24:mi'),:m_mach,:m_nhietdo,:m_huyetap,:m_nhiptho,:m_cannang,:m_yta,:m_userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ngay",OracleType.VarChar,16).Value=m_ngay;
					cmd.Parameters.Add("m_mach",OracleType.Number).Value=m_mach;
					cmd.Parameters.Add("m_nhietdo",OracleType.Number).Value=m_nhietdo;
					cmd.Parameters.Add("m_huyetap",OracleType.VarChar,7).Value=m_huyetap;
					cmd.Parameters.Add("m_nhiptho",OracleType.Number).Value=m_nhiptho;
					cmd.Parameters.Add("m_cannang",OracleType.Number).Value=m_cannang;
					cmd.Parameters.Add("m_yta",OracleType.VarChar,4).Value=m_yta;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_theodoicnct");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_truyendich(long m_id,long m_idthuchien,string m_ngay,int m_userid)
		{
			string xxx = user + mmyy(m_ngay);
			sql="update "+xxx+".ba_truyendich set idthuchien=:m_idthuchien,ngay=to_date(:m_ngay,'dd/mm/yyyy hh24:mi'),userid=:m_userid where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_idthuchien",OracleType.Number).Value=m_idthuchien;
				cmd.Parameters.Add("m_ngay",OracleType.VarChar,16).Value=m_ngay;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_truyendich (id,idthuchien,ngay,userid) values (:m_id,:m_idthuchien,to_date(:m_ngay,'dd/mm/yyyy hh24:mi'),:m_userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_idthuchien",OracleType.Number).Value=m_idthuchien;
					cmd.Parameters.Add("m_ngay",OracleType.VarChar,16).Value=m_ngay;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_truyendich");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_truyendichct(string m_ngay,long m_id,int m_stt,string m_ten,decimal m_soluong,string m_losx,string m_tocdo,
			string m_batdau,string m_ketthuc,string m_bscd,string m_yta,string m_ghichu,int m_userid)
		{
			string xxx = user + mmyy(m_ngay);
			sql="update "+xxx+".ba_truyendichct set ten=:m_ten,";
			sql+="soluong=:m_soluong,losx=:m_losx,tocdo=:m_tocdo,batdau=to_date(:m_batdau,'dd/mm/yyyy hh24:mi'),";
			if (m_ketthuc!="") sql+="ketthuc=to_date(:m_ketthuc,'dd/mm/yyyy hh24:mi'),";
			sql+="bscd=:m_bscd,yta=:m_yta,ghichu=:m_ghichu,userid=:m_userid where id=:m_id and stt=:m_stt";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_ten",OracleType.NVarChar,100).Value=m_ten;
				cmd.Parameters.Add("m_soluong",OracleType.Number).Value=m_soluong;
				cmd.Parameters.Add("m_losx",OracleType.NVarChar,20).Value=m_losx;
				cmd.Parameters.Add("m_tocdo",OracleType.NVarChar,20).Value=m_tocdo;
				cmd.Parameters.Add("m_batdau",OracleType.VarChar,16).Value=m_batdau;
				if (m_ketthuc!="") cmd.Parameters.Add("m_ketthuc",OracleType.VarChar,16).Value=m_ketthuc;
				cmd.Parameters.Add("m_bscd",OracleType.VarChar,4).Value=m_bscd;
				cmd.Parameters.Add("m_yta",OracleType.VarChar,4).Value=m_yta;
				cmd.Parameters.Add("m_ghichu",OracleType.NVarChar,254).Value=m_ghichu;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_truyendichct (id,stt,ten,soluong,losx,tocdo,batdau,";
					if (m_ketthuc!="") sql+="ketthuc,";
					sql+="bscd,yta,ghichu,userid) values (:m_id,:m_stt,:m_ten,:m_soluong,:m_losx,:m_tocdo,to_date(:m_batdau,'dd/mm/yyyy hh24:mi'),";
					if (m_ketthuc!="") sql+="to_date(:m_ketthuc,'dd/mm/yyyy hh24:mi'),";
					sql+=":m_bscd,:m_yta,:m_ghichu,:m_userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
					cmd.Parameters.Add("m_ten",OracleType.NVarChar,100).Value=m_ten;
					cmd.Parameters.Add("m_soluong",OracleType.Number).Value=m_soluong;
					cmd.Parameters.Add("m_losx",OracleType.NVarChar,20).Value=m_losx;
					cmd.Parameters.Add("m_tocdo",OracleType.NVarChar,20).Value=m_tocdo;
					cmd.Parameters.Add("m_batdau",OracleType.VarChar,16).Value=m_batdau;
					if (m_ketthuc!="") cmd.Parameters.Add("m_ketthuc",OracleType.VarChar,16).Value=m_ketthuc;
					cmd.Parameters.Add("m_bscd",OracleType.VarChar,4).Value=m_bscd;
					cmd.Parameters.Add("m_yta",OracleType.VarChar,4).Value=m_yta;
					cmd.Parameters.Add("m_ghichu",OracleType.NVarChar,254).Value=m_ghichu;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_truyendichct");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}		

		public bool upd_ba_linhmau(string m_ngay,long m_id,long m_idthuchien,string m_sophieu,string m_ngaylinh,string m_donvi,
			string m_chepham,int m_nhommau,decimal m_lanthu,string m_nguoilinh,string m_bsdt,string m_phongphat,
			string m_bvphat,string m_dvphat,string m_ngayphat,string m_nguoiphat,string m_truongkhoa,int m_userid)
		{
			string xxx = user + mmyy(m_ngay);
			sql="update "+xxx+".ba_linhmau set idthuchien=:m_idthuchien,sophieu=:m_sophieu,";
			sql+="ngaylinh=to_date(:m_ngaylinh,'dd/mm/yyyy'),donvi=:m_donvi,";
			sql+="chepham=:m_chepham,nhommau=:m_nhommau,lanthu=:m_lanthu,nguoilinh=:m_nguoilinh,";
			sql+="bsdt=:m_bsdt,phongphat=:m_phongphat,bvphat=:m_bvphat,dvphat=:m_dvphat,";
			if (m_ngayphat!="") sql+="ngayphat=to_date(:m_ngayphat,'dd/mm/yyyy'),";
			sql+="nguoiphat=:m_nguoiphat,truongkhoa=:m_truongkhoa,";
			sql+="userid=:m_userid where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_idthuchien",OracleType.Number).Value=m_idthuchien;
				cmd.Parameters.Add("m_sophieu",OracleType.VarChar,10).Value=m_sophieu;
				cmd.Parameters.Add("m_ngaylinh",OracleType.VarChar,10).Value=m_ngaylinh;
				cmd.Parameters.Add("m_donvi",OracleType.NVarChar,20).Value=m_donvi;
				cmd.Parameters.Add("m_chepham",OracleType.NVarChar,100).Value=m_chepham;
				cmd.Parameters.Add("m_nhommau",OracleType.Number).Value=m_nhommau;
				cmd.Parameters.Add("m_lanthu",OracleType.Number).Value=m_lanthu;
				cmd.Parameters.Add("m_nguoilinh",OracleType.VarChar,4).Value=m_nguoilinh;
				cmd.Parameters.Add("m_bsdt",OracleType.VarChar,4).Value=m_bsdt;
				cmd.Parameters.Add("m_phongphat",OracleType.NVarChar,50).Value=m_phongphat;
				cmd.Parameters.Add("m_bvphat",OracleType.NVarChar,100).Value=m_bvphat;
				cmd.Parameters.Add("m_dvphat",OracleType.NVarChar,20).Value=m_dvphat;
				if (m_ngayphat!="") cmd.Parameters.Add("m_ngayphat",OracleType.VarChar,10).Value=m_ngayphat;
				cmd.Parameters.Add("m_nguoiphat",OracleType.VarChar,4).Value=m_nguoiphat;
				cmd.Parameters.Add("m_truongkhoa",OracleType.VarChar,4).Value=m_truongkhoa;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_linhmau (id,idthuchien,sophieu,ngaylinh,donvi,chepham,nhommau,lanthu,nguoilinh,bsdt,phongphat,bvphat,dvphat,";
					if (m_ngayphat!="") sql+="ngayphat,";
					sql+="nguoiphat,truongkhoa,userid) values (:m_id,:m_idthuchien,:m_sophieu,to_date(:m_ngaylinh,'dd/mm/yyyy'),";
					sql+=":m_donvi,:m_chepham,:m_nhommau,:m_lanthu,:m_nguoilinh,:m_bsdt,:m_phongphat,:m_bvphat,:m_dvphat,";
					if (m_ngayphat!="") sql+="to_date(:m_ngayphat,'dd/mm/yyyy'),";
					sql+=":m_nguoiphat,:m_truongkhoa,:m_userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_idthuchien",OracleType.Number).Value=m_idthuchien;
					cmd.Parameters.Add("m_sophieu",OracleType.VarChar,10).Value=m_sophieu;
					cmd.Parameters.Add("m_ngaylinh",OracleType.VarChar,10).Value=m_ngaylinh;
					cmd.Parameters.Add("m_donvi",OracleType.NVarChar,20).Value=m_donvi;
					cmd.Parameters.Add("m_chepham",OracleType.NVarChar,100).Value=m_chepham;
					cmd.Parameters.Add("m_nhommau",OracleType.Number).Value=m_nhommau;
					cmd.Parameters.Add("m_lanthu",OracleType.Number).Value=m_lanthu;
					cmd.Parameters.Add("m_nguoilinh",OracleType.VarChar,4).Value=m_nguoilinh;
					cmd.Parameters.Add("m_bsdt",OracleType.VarChar,4).Value=m_bsdt;
					cmd.Parameters.Add("m_phongphat",OracleType.NVarChar,50).Value=m_phongphat;
					cmd.Parameters.Add("m_bvphat",OracleType.NVarChar,100).Value=m_bvphat;
					cmd.Parameters.Add("m_dvphat",OracleType.NVarChar,20).Value=m_dvphat;
					if (m_ngayphat!="") cmd.Parameters.Add("m_ngayphat",OracleType.VarChar,10).Value=m_ngayphat;
					cmd.Parameters.Add("m_nguoiphat",OracleType.VarChar,4).Value=m_nguoiphat;
					cmd.Parameters.Add("m_truongkhoa",OracleType.VarChar,4).Value=m_truongkhoa;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_linhmau");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_linhmauct(string m_ngay,long m_id,int m_stt,string m_chepham,string m_maso,int m_nhommau)
		{
			string xxx = user + mmyy(m_ngay);
			sql="update "+xxx+".ba_linhmauct set chepham=:m_chepham,";
			sql+="maso=:m_maso,nhommau=:m_nhommau ";
			sql+="where id=:m_id and stt=:m_stt";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_chepham",OracleType.NVarChar,100).Value=m_chepham;
				cmd.Parameters.Add("m_maso",OracleType.VarChar,10).Value=m_maso;
				cmd.Parameters.Add("m_nhommau",OracleType.Number).Value=m_nhommau;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_linhmauct (id,stt,chepham,maso,nhommau) values (:m_id,:m_stt,:m_chepham,:m_maso,:m_nhommau)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
					cmd.Parameters.Add("m_chepham",OracleType.NVarChar,100).Value=m_chepham;
					cmd.Parameters.Add("m_maso",OracleType.VarChar,10).Value=m_maso;
					cmd.Parameters.Add("m_nhommau",OracleType.Number).Value=m_nhommau;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_linhmauct");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_truyenmau1(string m_ngayvv,long m_id,long m_idthuchien,string m_ngay,string m_chepham,
			string m_maso,string m_ngaylay,
			string m_handung,string m_soluong,string m_noilam,string m_kythuat,string m_sinhpham,
			int m_hbsag,int m_hcv,int m_giangmai,int m_sotret,int m_nguoicho,int m_benhnhan,
			string m_ong1,string m_ong2,string m_truongkhoa,string m_ktv1,string m_ktv2,string m_chephamtr,
			string m_masotr,string m_handungtr,decimal m_lanthu,string m_bscd,int m_nguoichotr,int m_benhnhantr,
			string m_tai,string m_soluongtr)		
		{
			string xxx = user + mmyy(m_ngayvv);
			sql="update "+xxx+".ba_truyenmau set idthuchien=:m_idthuchien,ngay=to_date(:m_ngay,'dd/mm/yyyy hh24:mi'),";
			sql+="chepham=:m_chepham,maso=:m_maso,ngaylay=to_date(:m_ngaylay,'dd/mm/yyyy'),";
			if (m_handung!="") sql+="handung=to_date(:m_handung,'dd/mm/yyyy'),";
			sql+="soluong=:m_soluong,noilam=:m_noilam,kythuat=:m_kythuat,sinhpham=:m_sinhpham,";
			sql+="hbsag=:m_hbsag,hcv=:m_hcv,giangmai=:m_giangmai,sotret=:m_sotret,";
			sql+="nguoicho=:m_nguoicho,benhnhan=:m_benhnhan,";
			sql+="ong1=:m_ong1,ong2=:m_ong2,truongkhoa=:m_truongkhoa,ktv1=:m_ktv1,ktv2=:m_ktv2,";
			sql+="chephamtr=:m_chephamtr,masotr=:m_masotr,";
			if (m_handungtr!="") sql+="handungtr=to_date(:m_handungtr,'dd/mm/yyyy'),";
			sql+="lanthu=:m_lanthu,bscd=:m_bscd,nguoichotr=:m_nguoichotr,benhnhantr=:m_benhnhantr,";
			sql+="tai=:m_tai,soluongtr=:m_soluongtr where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_idthuchien",OracleType.Number).Value=m_idthuchien;
				cmd.Parameters.Add("m_ngay",OracleType.VarChar,16).Value=m_ngay;
				cmd.Parameters.Add("m_chepham",OracleType.NVarChar,100).Value=m_chepham;
				cmd.Parameters.Add("m_maso",OracleType.VarChar,10).Value=m_maso;
				cmd.Parameters.Add("m_ngaylay",OracleType.VarChar,10).Value=m_ngaylay;
				if (m_handung!="") cmd.Parameters.Add("m_handung",OracleType.VarChar,10).Value=m_handung;
				cmd.Parameters.Add("m_soluong",OracleType.NVarChar,20).Value=m_soluong;
				cmd.Parameters.Add("m_noilam",OracleType.NVarChar,100).Value=m_noilam;
				cmd.Parameters.Add("m_kythuat",OracleType.NVarChar,100).Value=m_kythuat;
				cmd.Parameters.Add("m_sinhpham",OracleType.NVarChar,100).Value=m_sinhpham;
				cmd.Parameters.Add("m_hbsag",OracleType.Number).Value=m_hbsag;
				cmd.Parameters.Add("m_hcv",OracleType.Number).Value=m_hcv;
				cmd.Parameters.Add("m_giangmai",OracleType.Number).Value=m_giangmai;
				cmd.Parameters.Add("m_sotret",OracleType.Number).Value=m_sotret;
				cmd.Parameters.Add("m_nguoicho",OracleType.Number).Value=m_nguoicho;
				cmd.Parameters.Add("m_benhnhan",OracleType.Number).Value=m_benhnhan;
				cmd.Parameters.Add("m_ong1",OracleType.NVarChar,50).Value=m_ong1;
				cmd.Parameters.Add("m_ong2",OracleType.NVarChar,50).Value=m_ong2;
				cmd.Parameters.Add("m_truongkhoa",OracleType.VarChar,4).Value=m_truongkhoa;
				cmd.Parameters.Add("m_ktv1",OracleType.VarChar,4).Value=m_ktv1;
				cmd.Parameters.Add("m_ktv2",OracleType.VarChar,4).Value=m_ktv2;
				cmd.Parameters.Add("m_chephamtr",OracleType.NVarChar,100).Value=m_chephamtr;
				cmd.Parameters.Add("m_masotr",OracleType.VarChar,10).Value=m_masotr;
				if (m_handungtr!="") cmd.Parameters.Add("m_handungtr",OracleType.VarChar,10).Value=m_handungtr;
				cmd.Parameters.Add("m_lanthu",OracleType.Number).Value=m_lanthu;
				cmd.Parameters.Add("m_bscd",OracleType.VarChar,4).Value=m_bscd;
				cmd.Parameters.Add("m_nguoichotr",OracleType.Number).Value=m_nguoichotr;
				cmd.Parameters.Add("m_benhnhantr",OracleType.Number).Value=m_benhnhantr;
				cmd.Parameters.Add("m_tai",OracleType.NVarChar,100).Value=m_tai;
				cmd.Parameters.Add("m_soluongtr",OracleType.NVarChar,20).Value=m_soluongtr;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_truyenmau (id,idthuchien,ngay,chepham,maso,ngaylay,";
					if (m_handung!="") sql+="handung,";
					sql+="soluong,noilam,kythuat,sinhpham,hbsag,hcv,giangmai,sotret,";
					sql+="nguoicho,benhnhan,ong1,ong2,truongkhoa,ktv1,ktv2,chephamtr,masotr,";
					if (m_handungtr!="") sql+="handungtr,";
					sql+="lanthu,bscd,nguoichotr,benhnhantr,tai,soluongtr)";
					sql+=" values (:m_id,:m_idthuchien,to_date(:m_ngay,'dd/mm/yyyy hh24:mi'),:m_chepham,:m_maso,to_date(:m_ngaylay,'dd/mm/yyyy'),";
					if (m_handung!="") sql+="to_date(:m_handung,'dd/mm/yyyy'),";
					sql+=":m_soluong,:m_noilam,:m_kythuat,:m_sinhpham,:m_hbsag,:m_hcv,:m_giangmai,:m_sotret,";
					sql+=":m_nguoicho,:m_benhnhan,:m_ong1,:m_ong2,:m_truongkhoa,:m_ktv1,:m_ktv2,:m_chephamtr,:m_masotr,";
					if (m_handungtr!="") sql+="to_date(:m_handungtr,'dd/mm/yyyy'),";
					sql+=":m_lanthu,:m_bscd,:m_nguoichotr,:m_benhnhantr,:m_tai,:m_soluongtr)";

					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_idthuchien",OracleType.Number).Value=m_idthuchien;
					cmd.Parameters.Add("m_ngay",OracleType.VarChar,16).Value=m_ngay;
					cmd.Parameters.Add("m_chepham",OracleType.NVarChar,100).Value=m_chepham;
					cmd.Parameters.Add("m_maso",OracleType.VarChar,10).Value=m_maso;
					cmd.Parameters.Add("m_ngaylay",OracleType.VarChar,10).Value=m_ngaylay;
					if (m_handung!="") cmd.Parameters.Add("m_handung",OracleType.VarChar,10).Value=m_handung;
					cmd.Parameters.Add("m_soluong",OracleType.NVarChar,20).Value=m_soluong;
					cmd.Parameters.Add("m_noilam",OracleType.NVarChar,100).Value=m_noilam;
					cmd.Parameters.Add("m_kythuat",OracleType.NVarChar,100).Value=m_kythuat;
					cmd.Parameters.Add("m_sinhpham",OracleType.NVarChar,100).Value=m_sinhpham;
					cmd.Parameters.Add("m_hbsag",OracleType.Number).Value=m_hbsag;
					cmd.Parameters.Add("m_hcv",OracleType.Number).Value=m_hcv;
					cmd.Parameters.Add("m_giangmai",OracleType.Number).Value=m_giangmai;
					cmd.Parameters.Add("m_sotret",OracleType.Number).Value=m_sotret;
					cmd.Parameters.Add("m_nguoicho",OracleType.Number).Value=m_nguoicho;
					cmd.Parameters.Add("m_benhnhan",OracleType.Number).Value=m_benhnhan;
					cmd.Parameters.Add("m_ong1",OracleType.NVarChar,50).Value=m_ong1;
					cmd.Parameters.Add("m_ong2",OracleType.NVarChar,50).Value=m_ong2;
					cmd.Parameters.Add("m_truongkhoa",OracleType.VarChar,4).Value=m_truongkhoa;
					cmd.Parameters.Add("m_ktv1",OracleType.VarChar,4).Value=m_ktv1;
					cmd.Parameters.Add("m_ktv2",OracleType.VarChar,4).Value=m_ktv2;
					cmd.Parameters.Add("m_chephamtr",OracleType.NVarChar,100).Value=m_chephamtr;
					cmd.Parameters.Add("m_masotr",OracleType.VarChar,10).Value=m_masotr;
					if (m_handungtr!="") cmd.Parameters.Add("m_handungtr",OracleType.VarChar,10).Value=m_handungtr;
					cmd.Parameters.Add("m_lanthu",OracleType.Number).Value=m_lanthu;
					cmd.Parameters.Add("m_bscd",OracleType.VarChar,4).Value=m_bscd;
					cmd.Parameters.Add("m_nguoichotr",OracleType.Number).Value=m_nguoichotr;
					cmd.Parameters.Add("m_benhnhantr",OracleType.Number).Value=m_benhnhantr;
					cmd.Parameters.Add("m_tai",OracleType.NVarChar,100).Value=m_tai;
					cmd.Parameters.Add("m_soluongtr",OracleType.NVarChar,20).Value=m_soluongtr;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_truyenmau1");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_truyenmau2(string m_ngayvv,long m_id,string m_batdau,string m_ketthuc,string m_soluongthuc,
			string m_sacmat,decimal m_nhiptho,decimal m_nhietdo,string m_huyetap,decimal m_mach,
			string m_dienbien,string m_bsth,string m_yta,long m_idlinh,int m_userid)		
		{
			string xxx = user + mmyy(m_ngayvv);
			sql="update "+xxx+".ba_truyenmau set batdau=to_date(:m_batdau,'dd/mm/yyyy hh24:mi'),";
			if (m_ketthuc.Trim()!="") sql+="ketthuc=to_date(:m_ketthuc,'dd/mm/yyyy hh24:mi'),";
			sql+="soluongthuc=:m_soluongthuc,sacmat=:m_sacmat,nhiptho=:m_nhiptho,nhietdo=:m_nhietdo,";
			sql+="huyetap=:m_huyetap,mach=:m_mach,dienbien=:m_dienbien,bsth=:m_bsth,yta=:m_yta,";
			sql+="idlinh=:m_idlinh,userid=:m_userid where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_batdau",OracleType.VarChar,16).Value=m_batdau;
				if (m_ketthuc.Trim()!="") cmd.Parameters.Add("m_ketthuc",OracleType.VarChar,16).Value=m_ketthuc;
				cmd.Parameters.Add("m_soluongthuc",OracleType.NVarChar,20).Value=m_soluongthuc;
				cmd.Parameters.Add("m_sacmat",OracleType.NVarChar,50).Value=m_sacmat;
				cmd.Parameters.Add("m_nhiptho",OracleType.Number).Value=m_nhiptho;
				cmd.Parameters.Add("m_nhietdo",OracleType.Number).Value=m_nhietdo;
				cmd.Parameters.Add("m_huyetap",OracleType.VarChar,7).Value=m_huyetap;
				cmd.Parameters.Add("m_mach",OracleType.Number).Value=m_mach;
				cmd.Parameters.Add("m_dienbien",OracleType.NVarChar,100).Value=m_dienbien;
				cmd.Parameters.Add("m_bsth",OracleType.VarChar,4).Value=m_bsth;
				cmd.Parameters.Add("m_yta",OracleType.VarChar,4).Value=m_yta;
				cmd.Parameters.Add("m_idlinh",OracleType.Number).Value=m_idlinh;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.ExecuteNonQuery();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_truyenmau2");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_truyenmauct(string m_ngayvv,long m_id,int m_stt,string m_ngay,string m_sacmat,decimal m_nhiptho,decimal m_nhietdo,string m_huyetap,decimal m_mach,string m_dienbien)
		{
			string xxx = user + mmyy(m_ngayvv);
			sql="update "+xxx+".ba_truyenmauct set ngay=to_date(:m_ngay,'dd/mm/yyyy hh24:mi'),sacmat=:m_sacmat,nhiptho=:m_nhiptho,";
			sql+="nhietdo=:m_nhietdo,huyetap=:m_huyetap,mach=:m_mach,dienbien=:m_dienbien ";
			sql+="where id=:m_id and stt=:m_stt";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_ngay",OracleType.VarChar,16).Value=m_ngay;
				cmd.Parameters.Add("m_sacmat",OracleType.NVarChar,100).Value=m_sacmat;
				cmd.Parameters.Add("m_nhiptho",OracleType.Number).Value=m_nhiptho;
				cmd.Parameters.Add("m_nhietdo",OracleType.Number).Value=m_nhietdo;
				cmd.Parameters.Add("m_huyetap",OracleType.VarChar,7).Value=m_huyetap;				
				cmd.Parameters.Add("m_mach",OracleType.Number).Value=m_mach;
				cmd.Parameters.Add("m_dienbien",OracleType.NVarChar,100).Value=m_dienbien;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
				
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_truyenmauct (id,stt,ngay,sacmat,nhiptho,nhietdo,huyetap,mach,dienbien) ";
					sql+="values (:m_id,:m_stt,to_date(:m_ngay,'dd/mm/yyyy hh24:mi'),:m_sacmat,:m_nhiptho,:m_nhietdo,:m_huyetap,:m_mach,:m_dienbien)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;

					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
					cmd.Parameters.Add("m_ngay",OracleType.VarChar,16).Value=m_ngay;
					cmd.Parameters.Add("m_sacmat",OracleType.NVarChar,100).Value=m_sacmat;
					cmd.Parameters.Add("m_nhiptho",OracleType.Number).Value=m_nhiptho;
					cmd.Parameters.Add("m_nhietdo",OracleType.Number).Value=m_nhietdo;
					cmd.Parameters.Add("m_huyetap",OracleType.VarChar,7).Value=m_huyetap;				
					cmd.Parameters.Add("m_mach",OracleType.Number).Value=m_mach;
					cmd.Parameters.Add("m_dienbien",OracleType.NVarChar,100).Value=m_dienbien;

					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_truyenmauct");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_dmchidinh(long m_id,long m_idloaivp,decimal m_stt,string m_ten,string m_report,int m_tinhtrang,int m_lanthu,string m_hen,string m_noidung,string m_ketqua,int m_cannang,int m_chieucao,int m_thuchien)
		{
			sql="update dmchidinh set idloaivp=:m_idloaivp,stt=:m_stt,ten=:m_ten,report=:m_report,";
			sql+="tinhtrang=:m_tinhtrang,lanthu=:m_lanthu,hen=:m_hen,noidung=:m_noidung,ketqua=:m_ketqua,";
			sql+="cannang=:m_cannang,chieucao=:m_chieucao,thuchien=:m_thuchien where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_idloaivp",OracleType.Number).Value=m_idloaivp;
				cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
				cmd.Parameters.Add("m_ten",OracleType.NVarChar,254).Value=m_ten;
				cmd.Parameters.Add("m_report",OracleType.VarChar,50).Value=m_report;
				cmd.Parameters.Add("m_tinhtrang",OracleType.Number).Value=m_tinhtrang;
				cmd.Parameters.Add("m_lanthu",OracleType.Number).Value=m_lanthu;
				cmd.Parameters.Add("m_hen",OracleType.NVarChar,254).Value=m_hen;
				cmd.Parameters.Add("m_noidung",OracleType.NVarChar,254).Value=m_noidung;
				cmd.Parameters.Add("m_ketqua",OracleType.NVarChar,254).Value=m_ketqua;
				cmd.Parameters.Add("m_cannang",OracleType.Number).Value=m_cannang;
				cmd.Parameters.Add("m_chieucao",OracleType.Number).Value=m_chieucao;
				cmd.Parameters.Add("m_thuchien",OracleType.Number).Value=m_thuchien;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into dmchidinh (id,idloaivp,stt,ten,report,tinhtrang,lanthu,hen,noidung,ketqua,cannang,chieucao,thuchien) values (:m_id,:m_idloaivp,:m_stt,:m_ten,:m_report,:m_tinhtrang,:m_lanthu,:m_hen,:m_noidung,:m_ketqua,:m_cannang,:m_chieucao,:m_thuchien)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_idloaivp",OracleType.Number).Value=m_idloaivp;
					cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
					cmd.Parameters.Add("m_ten",OracleType.NVarChar,254).Value=m_ten;
					cmd.Parameters.Add("m_report",OracleType.VarChar,50).Value=m_report;
					cmd.Parameters.Add("m_tinhtrang",OracleType.Number).Value=m_tinhtrang;
					cmd.Parameters.Add("m_lanthu",OracleType.Number).Value=m_lanthu;
					cmd.Parameters.Add("m_hen",OracleType.NVarChar,254).Value=m_hen;
					cmd.Parameters.Add("m_noidung",OracleType.NVarChar,254).Value=m_noidung;
					cmd.Parameters.Add("m_ketqua",OracleType.NVarChar,254).Value=m_ketqua;
					cmd.Parameters.Add("m_cannang",OracleType.Number).Value=m_cannang;
					cmd.Parameters.Add("m_chieucao",OracleType.Number).Value=m_chieucao;
					cmd.Parameters.Add("m_thuchien",OracleType.Number).Value=m_thuchien;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"dmchidinh");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public int get_sophieu_ravien(string mmyy,string mabn,long maql,int loaiba,string ngay,int madoituong,int userid)
		{
			int so=0;
			bool ttrv_nam=bSophieu_ttrv_nam;
			string xxx=user+((ttrv_nam)?"":mmyy);
			DataTable dt=get_data("select so from "+xxx+".sophieurv where so<>0 and mabn='"+mabn+"' and to_char(ngay,'dd/mm/yyyy')='"+ngay.Substring(0,10)+"' and madoituong="+madoituong+" and maql="+maql).Tables[0];
			if (dt.Rows.Count>0)
			{
				so=int.Parse(dt.Rows[0]["so"].ToString());
				execute_data("update "+xxx+".sophieurv set lanin=lanin+1 where mabn='"+mabn+"' and to_char(ngay,'dd/mm/yyyy')='"+ngay.Substring(0,10)+"' and madoituong="+madoituong+" and maql="+maql);
			}
			else
			{
				if (ttrv_nam)
				{
					sql="update "+xxx+".capid set id=id+1 where ma=-980 and yy='"+mmyy.Substring(2,2)+"'";
					con=new OracleConnection(sConn);
					con.Open();
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					int irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
					if (irec==0)
					{
						sql="insert into capid(ma,yy,id) values (-980,'"+mmyy.Substring(2,2)+"',1)";
						cmd=new OracleCommand(sql,con);
						cmd.CommandType=CommandType.Text;
						cmd.ExecuteNonQuery();
						cmd.Dispose();
					}
					//
					sql="select id as sotoa from "+xxx+".capid where ma=-980 and yy='"+mmyy.Substring(2,2)+"'";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					dest=new OracleDataAdapter(cmd);
					ds=new DataSet();
					dest.Fill(ds);	
					cmd.Dispose();
					//
					con.Close();con.Dispose();
				}
				else
				{
					sql="update "+xxx+".capsotoa set sotoa=sotoa+1 where id="+loaiba+" and to_char(ngay,'dd/mm/yyyy')='"+ngay.Substring(0,10)+"'";
					if (userid!=0) sql+=" and userid="+userid;
					con=new OracleConnection(sConn);
					con.Open();
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.ExecuteNonQuery();
					cmd.Dispose();
					//
					sql="select sotoa from "+xxx+".capsotoa where id="+loaiba+" and to_char(ngay,'dd/mm/yyyy')='"+ngay.Substring(0,10)+"'";
					if (userid!=0) sql+=" and userid="+userid;
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					dest=new OracleDataAdapter(cmd);
					ds=new DataSet();
					dest.Fill(ds);	
					cmd.Dispose();
					//
					con.Close();con.Dispose();
				}
				so=int.Parse(ds.Tables[0].Rows[0]["sotoa"].ToString());
				upd_sophieurv(mmyy,mabn,maql,loaiba,ngay,madoituong,so);
			}
			return so;
		}

		public void upd_sophieurv(string mmyy,string mabn,long maql,int loaiba,string ngay,int madoituong,int so)
		{
			bool ttrv_nam=bSophieu_ttrv_nam;
			sql="insert into "+user+((ttrv_nam)?"":mmyy)+".sophieurv(mabn,maql,loaiba,ngay,madoituong,so,lanin) values ('"+mabn+"',"+maql+","+loaiba+",to_date('"+ngay+"','dd/mm/yyyy hh24:mi'),"+madoituong+","+so+",1)";
			execute_data(sql); 
		}

		public int get_laninrv(string mmyy,string mabn,long maql,string ngay,int madoituong)
		{
			bool ttrv_nam=bSophieu_ttrv_nam;
			sql="select lanin from "+user+((ttrv_nam)?"":mmyy)+".sophieurv where mabn='"+mabn+"' and to_char(ngay,'dd/mm/yyyy')='"+ngay.Substring(0,10)+"' and madoituong="+madoituong+" and maql="+maql;
			DataTable tmp=get_data(sql).Tables[0];
			if (tmp.Rows.Count==0) return 0;
			else return int.Parse(tmp.Rows[0]["lanin"].ToString());
		}

		public string get_ghichurv(string mmyy,string mabn,long maql)
		{
			bool ttrv_nam=bSophieu_ttrv_nam;
			if (!ttrv_nam && !bMmyy(mmyy)) return "";
			sql="select ghichu from "+user+((ttrv_nam)?"":mmyy)+".sophieurv where mabn='"+mabn+"' and maql="+maql;
			DataTable tmp=get_data(sql).Tables[0];
			if (tmp.Rows.Count==0) return "";
			else return tmp.Rows[0]["ghichu"].ToString();
		}

		public bool upd_sophieurv(string m_mmyy,string m_mabn,long m_maql,string m_ghichu)
		{
			bool ttrv_nam=bSophieu_ttrv_nam;
			sql="update "+user+((ttrv_nam)?"":m_mmyy)+".sophieurv set ghichu=:m_ghichu where mabn=:m_mabn and maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_ghichu",OracleType.NVarChar,254).Value=m_ghichu;
				cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				cmd.ExecuteNonQuery();
				cmd.Dispose();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"d_sophieukb");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_capsotoa(string d_mmyy,int d_id,string d_ngay,int d_loai,int d_userid)
		{
			string xxx=user+d_mmyy+".pkg_vienphi.upd_capsotoa";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(xxx,con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				cmd.Parameters.Add("d_ngay",OracleType.VarChar,10).Value=d_ngay;
				cmd.Parameters.Add("d_loai",OracleType.Number).Value=d_loai;
				cmd.Parameters.Add("d_userid",OracleType.Number).Value=d_userid;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"capsotoa");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_bavv_chung(string m_ngay,long m_maql,string m_lydo,string m_hb_benhly,string m_hb_banthan,string m_hb_giadinh,
			string m_kb_toanthan,string m_kb_bophan,string m_kb_tomtat,string m_kb_xuli,string m_kb_chuy,
			string m_sobo,string m_phanbiet,int m_userid)
		{
			string xxx = user + mmyy(m_ngay);
			sql="update "+xxx+".bavv_chung set lydo=:m_lydo,hb_benhly=:m_hb_benhly,hb_banthan=:m_hb_banthan,hb_giadinh=:m_hb_giadinh,";
			sql+="kb_toanthan=:m_kb_toanthan,kb_bophan=:m_kb_bophan,";
			sql+="kb_tomtat=:m_kb_tomtat,kb_xuli=:m_kb_xuli,kb_chuy=:m_kb_chuy,";
			sql+="sobo=:m_sobo,phanbiet=:m_phanbiet,";
			sql+="userid=:m_userid where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_lydo",OracleType.NVarChar,2000).Value=m_lydo;
				cmd.Parameters.Add("m_hb_benhly",OracleType.NVarChar,2000).Value=m_hb_benhly;
				cmd.Parameters.Add("m_hb_banthan",OracleType.NVarChar,2000).Value=m_hb_banthan;
				cmd.Parameters.Add("m_hb_giadinh",OracleType.NVarChar,2000).Value=m_hb_giadinh;
				cmd.Parameters.Add("m_kb_toanthan",OracleType.NVarChar,500).Value=m_kb_toanthan;
				cmd.Parameters.Add("m_kb_bophan",OracleType.NVarChar,500).Value=m_kb_bophan;
				cmd.Parameters.Add("m_kb_tomtat",OracleType.NVarChar,2000).Value=m_kb_tomtat;
				cmd.Parameters.Add("m_kb_xuli",OracleType.NVarChar,2000).Value=m_kb_xuli;
				cmd.Parameters.Add("m_kb_chuy",OracleType.NVarChar,500).Value=m_kb_chuy;
				cmd.Parameters.Add("m_sobo",OracleType.NVarChar,500).Value=m_sobo;
				cmd.Parameters.Add("m_phanbiet",OracleType.NVarChar,500).Value=m_phanbiet;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".bavv_chung (maql,lydo,hb_benhly,hb_banthan,hb_giadinh,kb_toanthan,kb_bophan,kb_tomtat,kb_xuli,kb_chuy,sobo,phanbiet,userid) values (:m_maql,:m_lydo,:m_hb_benhly,:m_hb_banthan,:m_hb_giadinh,:m_kb_toanthan,:m_kb_bophan,:m_kb_tomtat,:m_kb_xuli,:m_kb_chuy,:m_sobo,:m_phanbiet,:m_userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_lydo",OracleType.NVarChar,2000).Value=m_lydo;
					cmd.Parameters.Add("m_hb_benhly",OracleType.NVarChar,2000).Value=m_hb_benhly;
					cmd.Parameters.Add("m_hb_banthan",OracleType.NVarChar,2000).Value=m_hb_banthan;
					cmd.Parameters.Add("m_hb_giadinh",OracleType.NVarChar,2000).Value=m_hb_giadinh;
					cmd.Parameters.Add("m_kb_toanthan",OracleType.NVarChar,500).Value=m_kb_toanthan;
					cmd.Parameters.Add("m_kb_bophan",OracleType.NVarChar,500).Value=m_kb_bophan;
					cmd.Parameters.Add("m_kb_tomtat",OracleType.NVarChar,2000).Value=m_kb_tomtat;
					cmd.Parameters.Add("m_kb_xuli",OracleType.NVarChar,2000).Value=m_kb_xuli;
					cmd.Parameters.Add("m_kb_chuy",OracleType.NVarChar,500).Value=m_kb_chuy;
					cmd.Parameters.Add("m_sobo",OracleType.NVarChar,500).Value=m_sobo;
					cmd.Parameters.Add("m_phanbiet",OracleType.NVarChar,500).Value=m_phanbiet;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"bavv_chung");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_glocom(string m_ngay,string table,long id,long idthuchien,string ledao,string mathot,
			string mimat,string ketmac,string cuongtu,string mocu,string mong,string giacmac,string suot,string kinh,
			string docong,string mo,string tua,string cungmac,string danloi,string seomo,string tienphong,string dosau,
			string pp,string mota,string mongmat,string mausac,string thoaihoa,string dongtu,string sacto,string phanxa,
			string tinhthe,string tinhdich)
		{
			string xxx = user + mmyy(m_ngay);
			sql="update "+xxx+"."+table+" set ledao=:ledao,mathot=:mathot,mimat=:mimat,ketmac=:ketmac,cuongtu=:cuongtu,";
			sql+="mocu=:mocu,mong=:mong,giacmac=:giacmac,suot=:suot,kinh=:kinh,docong=:docong,mo=:mo,tua=:tua,";
			sql+="cungmac=:cungmac,danloi=:danloi,seomo=:seomo,tienphong=:tienphong,dosau=:dosau,pp=:pp,mota=:mota,";
			sql+="mongmat=:mongmat,mausac=:mausac,thoaihoa=:thoaihoa,dongtu=:dongtu,sacto=:sacto,phanxa=:phanxa,";
			sql+="tinhthe=:tinhthe,tinhdich=:tinhdich";
			sql+=" where id="+id;
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("ledao",OracleType.NVarChar,254).Value=ledao;
				cmd.Parameters.Add("mathot",OracleType.NVarChar,254).Value=mathot;
				cmd.Parameters.Add("mimat",OracleType.NVarChar,254).Value=mimat;
				cmd.Parameters.Add("ketmac",OracleType.NVarChar,254).Value=ketmac;
				cmd.Parameters.Add("cuongtu",OracleType.NVarChar,254).Value=cuongtu;
				cmd.Parameters.Add("mocu",OracleType.NVarChar,254).Value=mocu;
				cmd.Parameters.Add("mong",OracleType.NVarChar,254).Value=mong;
				cmd.Parameters.Add("giacmac",OracleType.NVarChar,254).Value=giacmac;
				cmd.Parameters.Add("suot",OracleType.NVarChar,254).Value=suot;
				cmd.Parameters.Add("kinh",OracleType.NVarChar,254).Value=kinh;
				cmd.Parameters.Add("docong",OracleType.NVarChar,254).Value=docong;
				cmd.Parameters.Add("mo",OracleType.NVarChar,254).Value=mo;
				cmd.Parameters.Add("tua",OracleType.NVarChar,254).Value=tua;
				cmd.Parameters.Add("cungmac",OracleType.NVarChar,254).Value=cungmac;
				cmd.Parameters.Add("danloi",OracleType.NVarChar,254).Value=danloi;
				cmd.Parameters.Add("seomo",OracleType.NVarChar,254).Value=seomo;
				cmd.Parameters.Add("tienphong",OracleType.NVarChar,254).Value=tienphong;
				cmd.Parameters.Add("dosau",OracleType.NVarChar,254).Value=dosau;
				cmd.Parameters.Add("pp",OracleType.NVarChar,254).Value=pp;
				cmd.Parameters.Add("mota",OracleType.NVarChar,254).Value=mota;
				cmd.Parameters.Add("mongmat",OracleType.NVarChar,254).Value=mongmat;
				cmd.Parameters.Add("mausac",OracleType.NVarChar,254).Value=mausac;
				cmd.Parameters.Add("thoaihoa",OracleType.NVarChar,254).Value=thoaihoa;
				cmd.Parameters.Add("dongtu",OracleType.NVarChar,254).Value=dongtu;
				cmd.Parameters.Add("sacto",OracleType.NVarChar,254).Value=sacto;
				cmd.Parameters.Add("phanxa",OracleType.NVarChar,254).Value=phanxa;
				cmd.Parameters.Add("tinhthe",OracleType.NVarChar,254).Value=tinhthe;
				cmd.Parameters.Add("tinhdich",OracleType.NVarChar,254).Value=tinhdich;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+"."+table+" (id,idthuchien,ledao,mathot,mimat,ketmac,cuongtu,mocu,mong,giacmac,";
					sql+="suot,kinh,docong,mo,tua,cungmac,danloi,seomo,tienphong,dosau,pp,mota,mongmat,mausac,thoaihoa,dongtu,";
					sql+="sacto,phanxa,tinhthe,tinhdich) values ";
					sql+="("+id+","+idthuchien+",:ledao,:mathot,:mimat,:ketmac,:cuongtu,:mocu,:mong,:giacmac,";
					sql+=":suot,:kinh,:docong,:mo,:tua,:cungmac,:danloi,:seomo,:tienphong,:dosau,:pp,:mota,:mongmat,:mausac,:thoaihoa,:dongtu,";
					sql+=":sacto,:phanxa,:tinhthe,:tinhdich)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("ledao",OracleType.NVarChar,254).Value=ledao;
					cmd.Parameters.Add("mathot",OracleType.NVarChar,254).Value=mathot;
					cmd.Parameters.Add("mimat",OracleType.NVarChar,254).Value=mimat;
					cmd.Parameters.Add("ketmac",OracleType.NVarChar,254).Value=ketmac;
					cmd.Parameters.Add("cuongtu",OracleType.NVarChar,254).Value=cuongtu;
					cmd.Parameters.Add("mocu",OracleType.NVarChar,254).Value=mocu;
					cmd.Parameters.Add("mong",OracleType.NVarChar,254).Value=mong;
					cmd.Parameters.Add("giacmac",OracleType.NVarChar,254).Value=giacmac;
					cmd.Parameters.Add("suot",OracleType.NVarChar,254).Value=suot;
					cmd.Parameters.Add("kinh",OracleType.NVarChar,254).Value=kinh;
					cmd.Parameters.Add("docong",OracleType.NVarChar,254).Value=docong;
					cmd.Parameters.Add("mo",OracleType.NVarChar,254).Value=mo;
					cmd.Parameters.Add("tua",OracleType.NVarChar,254).Value=tua;
					cmd.Parameters.Add("cungmac",OracleType.NVarChar,254).Value=cungmac;
					cmd.Parameters.Add("danloi",OracleType.NVarChar,254).Value=danloi;
					cmd.Parameters.Add("seomo",OracleType.NVarChar,254).Value=seomo;
					cmd.Parameters.Add("tienphong",OracleType.NVarChar,254).Value=tienphong;
					cmd.Parameters.Add("dosau",OracleType.NVarChar,254).Value=dosau;
					cmd.Parameters.Add("pp",OracleType.NVarChar,254).Value=pp;
					cmd.Parameters.Add("mota",OracleType.NVarChar,254).Value=mota;
					cmd.Parameters.Add("mongmat",OracleType.NVarChar,254).Value=mongmat;
					cmd.Parameters.Add("mausac",OracleType.NVarChar,254).Value=mausac;
					cmd.Parameters.Add("thoaihoa",OracleType.NVarChar,254).Value=thoaihoa;
					cmd.Parameters.Add("dongtu",OracleType.NVarChar,254).Value=dongtu;
					cmd.Parameters.Add("sacto",OracleType.NVarChar,254).Value=sacto;
					cmd.Parameters.Add("phanxa",OracleType.NVarChar,254).Value=phanxa;
					cmd.Parameters.Add("tinhthe",OracleType.NVarChar,254).Value=tinhthe;
					cmd.Parameters.Add("tinhdich",OracleType.NVarChar,254).Value=tinhdich;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,table);
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}
	
		public bool upd_ba_glocom(string m_ngay,string table,long id,string lac,string nhancau,string daymat,string gaithi,string lomgai,
			string machmau,int userid)
		{
			string xxx = user + mmyy(m_ngay);
			sql="update "+xxx+"."+table+" set lac=:lac,nhancau=:nhancau,daymat=:daymat,gaithi=:gaithi,";
			sql+="lomgai=:lomgai,machmau=:machmau,userid="+userid;
			sql+=" where id="+id;
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("lac",OracleType.NVarChar,254).Value=lac;
				cmd.Parameters.Add("nhancau",OracleType.NVarChar,254).Value=nhancau;
				cmd.Parameters.Add("daymat",OracleType.NVarChar,254).Value=daymat;
				cmd.Parameters.Add("gaithi",OracleType.NVarChar,254).Value=gaithi;
				cmd.Parameters.Add("lomgai",OracleType.NVarChar,254).Value=lomgai;
				cmd.Parameters.Add("machmau",OracleType.NVarChar,254).Value=machmau;
				cmd.ExecuteNonQuery();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,table);
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_glocom(string m_ngay,long id,long idthuchien,byte[] m_image1,byte[] m_image2)
		{
			string xxx = user + mmyy(m_ngay);
			sql="update "+xxx+".ba_glocom_i set idthuchien="+idthuchien+",image1=:m_image1,image2=:m_image2";
			sql+=" where id="+id;
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_image1",OracleType.Blob,m_image1.Length).Value=m_image1;
				cmd.Parameters.Add("m_image2",OracleType.Blob,m_image2.Length).Value=m_image2;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_glocom_i (id,idthuchien,image1,image2) values ";
					sql+="("+id+","+idthuchien+",:m_image1,:m_image2)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_image1",OracleType.Blob,m_image1.Length).Value=m_image1;
					cmd.Parameters.Add("m_image2",OracleType.Blob,m_image2.Length).Value=m_image2;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_glocom_i");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_glocom_k(string m_ngay,long id,long idthuchien,string mota,int benhly,int chamsoc,int kieng)
		{
			string xxx = user + mmyy(m_ngay);
			sql="update "+xxx+".ba_glocom_k set mota=:mota,benhly="+benhly+",chamsoc="+chamsoc+",kieng="+kieng;
			sql+=" where id="+id;
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("mota",OracleType.NVarChar,254).Value=mota;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_glocom_k(id,idthuchien,mota,benhly,chamsoc,kieng) values ";
					sql+="("+id+","+idthuchien+",:mota,"+benhly+","+chamsoc+","+kieng+")";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("mota",OracleType.NVarChar,254).Value=mota;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_glocom_k");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_bavv_mat(string m_ngay,long m_maql,string m_kb_mat,string m_tlkk_mp,string m_tlkk_mt,
			string m_tlck_mp,string m_tlck_mt,string m_na_mp,string m_na_mt,string tt_mp,string tt_mt)
		{
			string xxx = user + mmyy(m_ngay);
			sql="update "+xxx+".bavv_mat set kb_mat=:m_kb_mat,tlkk_mp=:m_tlkk_mp,tlkk_mt=:m_tlkk_mt,";
			sql+="tlck_mp=:m_tlck_mp,tlck_mt=:m_tlck_mt,na_mp=:m_na_mp,na_mt=:m_na_mt,tt_mp=:tt_mp,tt_mt=:tt_mt ";
			sql+="where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_kb_mat",OracleType.NVarChar,500).Value=m_kb_mat;
				cmd.Parameters.Add("m_tlkk_mp",OracleType.NVarChar,20).Value=m_tlkk_mp;
				cmd.Parameters.Add("m_tlkk_mt",OracleType.NVarChar,20).Value=m_tlkk_mt;
				cmd.Parameters.Add("m_tlck_mp",OracleType.NVarChar,20).Value=m_tlck_mp;
				cmd.Parameters.Add("m_tlck_mt",OracleType.NVarChar,20).Value=m_tlck_mt;
				cmd.Parameters.Add("m_na_mp",OracleType.NVarChar,20).Value=m_na_mp;
				cmd.Parameters.Add("m_na_mt",OracleType.NVarChar,20).Value=m_na_mt;
				cmd.Parameters.Add("tt_mp",OracleType.NVarChar,50).Value=tt_mp;
				cmd.Parameters.Add("tt_mt",OracleType.NVarChar,50).Value=tt_mt;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".bavv_mat (maql,kb_mat,tlkk_mp,tlkk_mt,tlck_mp,tlck_mt,na_mp,na_mt,tt_mp,tt_mt) values (:m_maql,:m_kb_mat,:m_tlkk_mp,:m_tlkk_mt,:m_tlck_mp,:m_tlck_mt,:m_na_mp,:m_na_mt,:tt_mp,:tt_mt)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_kb_mat",OracleType.NVarChar,500).Value=m_kb_mat;
					cmd.Parameters.Add("m_tlkk_mp",OracleType.NVarChar,20).Value=m_tlkk_mp;
					cmd.Parameters.Add("m_tlkk_mt",OracleType.NVarChar,20).Value=m_tlkk_mt;
					cmd.Parameters.Add("m_tlck_mp",OracleType.NVarChar,20).Value=m_tlck_mp;
					cmd.Parameters.Add("m_tlck_mt",OracleType.NVarChar,20).Value=m_tlck_mt;
					cmd.Parameters.Add("m_na_mp",OracleType.NVarChar,20).Value=m_na_mp;
					cmd.Parameters.Add("m_na_mt",OracleType.NVarChar,20).Value=m_na_mt;
					cmd.Parameters.Add("tt_mp",OracleType.NVarChar,50).Value=tt_mp;
					cmd.Parameters.Add("tt_mt",OracleType.NVarChar,50).Value=tt_mt;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"bavv_mat");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_barv_mat(string m_ngay,long m_maql,string m_tlkk_mp,string m_tlkk_mt,
			string m_tlck_mp,string m_tlck_mt,string m_na_mp,string m_na_mt,string tt_mp,string tt_mt)
		{
			string xxx = user + mmyy(m_ngay);
			sql="update "+xxx+".barv_mat set tlkk_mp=:m_tlkk_mp,tlkk_mt=:m_tlkk_mt,";
			sql+="tlck_mp=:m_tlck_mp,tlck_mt=:m_tlck_mt,na_mp=:m_na_mp,na_mt=:m_na_mt,tt_mp=:tt_mp,tt_mt=:tt_mt ";
			sql+="where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_tlkk_mp",OracleType.NVarChar,254).Value=m_tlkk_mp;
				cmd.Parameters.Add("m_tlkk_mt",OracleType.NVarChar,254).Value=m_tlkk_mt;
				cmd.Parameters.Add("m_tlck_mp",OracleType.NVarChar,254).Value=m_tlck_mp;
				cmd.Parameters.Add("m_tlck_mt",OracleType.NVarChar,254).Value=m_tlck_mt;
				cmd.Parameters.Add("m_na_mp",OracleType.NVarChar,254).Value=m_na_mp;
				cmd.Parameters.Add("m_na_mt",OracleType.NVarChar,254).Value=m_na_mt;
				cmd.Parameters.Add("tt_mp",OracleType.NVarChar,50).Value=tt_mp;
				cmd.Parameters.Add("tt_mt",OracleType.NVarChar,50).Value=tt_mt;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".barv_mat (maql,tlkk_mp,tlkk_mt,tlck_mp,tlck_mt,na_mp,na_mt,tt_mp,tt_mt) values (:m_maql,:m_tlkk_mp,:m_tlkk_mt,:m_tlck_mp,:m_tlck_mt,:m_na_mp,:m_na_mt,:tt_mp,:tt_mt)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_tlkk_mp",OracleType.NVarChar,254).Value=m_tlkk_mp;
					cmd.Parameters.Add("m_tlkk_mt",OracleType.NVarChar,254).Value=m_tlkk_mt;
					cmd.Parameters.Add("m_tlck_mp",OracleType.NVarChar,254).Value=m_tlck_mp;
					cmd.Parameters.Add("m_tlck_mt",OracleType.NVarChar,254).Value=m_tlck_mt;
					cmd.Parameters.Add("m_na_mp",OracleType.NVarChar,254).Value=m_na_mp;
					cmd.Parameters.Add("m_na_mt",OracleType.NVarChar,254).Value=m_na_mt;
					cmd.Parameters.Add("tt_mp",OracleType.NVarChar,50).Value=tt_mp;
					cmd.Parameters.Add("tt_mt",OracleType.NVarChar,50).Value=tt_mt;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"barv_mat");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_bavv_tmh(string m_ngay,long m_maql,byte[] m_image1,byte[] m_image2,byte[] m_image3,byte[] m_image4)
		{
			string xxx = user + mmyy(m_ngay);
			sql="update "+xxx+".bavv_tmh set image1=:m_image1,image2=:m_image2,image3=:m_image3,image4=:m_image4";
			sql+=" where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_image1",OracleType.Blob,m_image1.Length).Value=m_image1;
				cmd.Parameters.Add("m_image2",OracleType.Blob,m_image2.Length).Value=m_image2;
				cmd.Parameters.Add("m_image3",OracleType.Blob,m_image3.Length).Value=m_image3;
				cmd.Parameters.Add("m_image4",OracleType.Blob,m_image4.Length).Value=m_image4;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				cmd.ExecuteNonQuery();
				cmd.Dispose();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"bavv_tmh");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}


		public bool upd_bavv_tmh(string m_ngay,long m_maql,string m_tai,string m_mui,string m_hong,string m_kham)
		{
			string xxx = user + mmyy(m_ngay);
			sql="update "+xxx+".bavv_tmh set tai=:m_tai,mui=:m_mui,hong=:m_hong,kham=:m_kham ";
			sql+="where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_tai",OracleType.NVarChar,500).Value=m_tai;
				cmd.Parameters.Add("m_mui",OracleType.NVarChar,500).Value=m_mui;
				cmd.Parameters.Add("m_hong",OracleType.NVarChar,500).Value=m_hong;
				cmd.Parameters.Add("m_kham",OracleType.NVarChar,254).Value=m_kham;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".bavv_tmh (maql,tai,mui,hong,kham) values (:m_maql,:m_tai,:m_mui,:m_hong,:m_kham)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_tai",OracleType.NVarChar,500).Value=m_tai;
					cmd.Parameters.Add("m_mui",OracleType.NVarChar,500).Value=m_mui;
					cmd.Parameters.Add("m_hong",OracleType.NVarChar,500).Value=m_hong;
					cmd.Parameters.Add("m_kham",OracleType.NVarChar,254).Value=m_kham;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"bavv_tmh");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_bavv_tmhct(string m_ngay,long m_maql,int m_stt,string m_taip,string m_tait)
		{
			string xxx = user + mmyy(m_ngay);
			sql="update "+xxx+".bavv_tmhct set taip=:m_taip,tait=:m_tait ";
			sql+="where maql=:m_maql and stt=:m_stt";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_taip",OracleType.NVarChar,254).Value=m_taip;
				cmd.Parameters.Add("m_tait",OracleType.NVarChar,254).Value=m_tait;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".bavv_tmhct (maql,stt,taip,tait) values (:m_maql,:m_stt,:m_taip,:m_tait)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
					cmd.Parameters.Add("m_taip",OracleType.NVarChar,254).Value=m_taip;
					cmd.Parameters.Add("m_tait",OracleType.NVarChar,254).Value=m_tait;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"bavv_tmhct");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_bavv_rhm(string m_ngay,long m_maql,byte[] m_image,string m_nhanxet,string m_chandoan)
		{
			string xxx = user + mmyy(m_ngay);
			sql="update "+xxx+".bavv_rhm set image=:m_image,nhanxet=:m_nhanxet,chandoan=:m_chandoan";
			sql+=" where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_image",OracleType.Blob,m_image.Length).Value=m_image;
				cmd.Parameters.Add("m_nhanxet",OracleType.NVarChar,1000).Value=m_nhanxet;
				cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,500).Value=m_chandoan;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".bavv_rhm (maql,image,nhanxet,chandoan) values (:m_maql,:m_image,:m_nhanxet,:m_chandoan)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_image",OracleType.Blob,m_image.Length).Value=m_image;
					cmd.Parameters.Add("m_nhanxet",OracleType.NVarChar,1000).Value=m_nhanxet;
					cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,500).Value=m_chandoan;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"bavv_rhm");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_bavv_dausinhton(string m_ngay,long m_maql,decimal m_mach,decimal m_nhietdo,string m_huyetap,decimal m_nhiptho,decimal m_cannang)
		{
			string xxx = user + mmyy(m_ngay);
			sql="update "+xxx+".bavv_dausinhton set mach=:m_mach,nhietdo=:m_nhietdo,huyetap=:m_huyetap,nhiptho=:m_nhiptho,cannang=:m_cannang where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_mach",OracleType.Number).Value=m_mach;
				cmd.Parameters.Add("m_nhietdo",OracleType.Number).Value=m_nhietdo;
				cmd.Parameters.Add("m_huyetap",OracleType.VarChar,7).Value=m_huyetap;
				cmd.Parameters.Add("m_nhiptho",OracleType.Number).Value=m_nhiptho;
				cmd.Parameters.Add("m_cannang",OracleType.Number).Value=m_cannang;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".bavv_dausinhton (maql,mach,nhietdo,huyetap,nhiptho,cannang) values (:m_maql,:m_mach,:m_nhietdo,:m_huyetap,:m_nhiptho,:m_cannang)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_mach",OracleType.Number).Value=m_mach;
					cmd.Parameters.Add("m_nhietdo",OracleType.Number).Value=m_nhietdo;
					cmd.Parameters.Add("m_huyetap",OracleType.VarChar,7).Value=m_huyetap;
					cmd.Parameters.Add("m_nhiptho",OracleType.Number).Value=m_nhiptho;
					cmd.Parameters.Add("m_cannang",OracleType.Number).Value=m_cannang;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"bavv_dausinhton");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_bavv_dausinhton(string m_ngay,long m_maql,decimal m_mach,decimal m_nhietdo,string m_huyetap,decimal m_nhiptho,decimal m_cannang,decimal m_chieucao)
		{
			string xxx = user + mmyy(m_ngay);
			sql="update "+xxx+".bavv_dausinhton set mach=:m_mach,nhietdo=:m_nhietdo,huyetap=:m_huyetap,nhiptho=:m_nhiptho,cannang=:m_cannang,chieucao=:m_chieucao where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_mach",OracleType.Number).Value=m_mach;
				cmd.Parameters.Add("m_nhietdo",OracleType.Number).Value=m_nhietdo;
				cmd.Parameters.Add("m_huyetap",OracleType.VarChar,7).Value=m_huyetap;
				cmd.Parameters.Add("m_nhiptho",OracleType.Number).Value=m_nhiptho;
				cmd.Parameters.Add("m_cannang",OracleType.Number).Value=m_cannang;
				cmd.Parameters.Add("m_chieucao",OracleType.Number).Value=m_chieucao;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".bavv_dausinhton (maql,mach,nhietdo,huyetap,nhiptho,cannang,chieucao) values (:m_maql,:m_mach,:m_nhietdo,:m_huyetap,:m_nhiptho,:m_cannang,:m_chieucao)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_mach",OracleType.Number).Value=m_mach;
					cmd.Parameters.Add("m_nhietdo",OracleType.Number).Value=m_nhietdo;
					cmd.Parameters.Add("m_huyetap",OracleType.VarChar,7).Value=m_huyetap;
					cmd.Parameters.Add("m_nhiptho",OracleType.Number).Value=m_nhiptho;
					cmd.Parameters.Add("m_cannang",OracleType.Number).Value=m_cannang;
					cmd.Parameters.Add("m_chieucao",OracleType.Number).Value=m_chieucao;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"bavv_dausinhton");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_bavv_sankhoa(string m_ngay,long m_maql,string m_lydokham,string m_giadinh,string m_diung,
			int m_buouco,int m_tieuduong,int m_timmach,int m_lao,string m_khac,string m_ngoaikhoa,decimal m_chuky,
			int m_tinhchat,decimal m_songay,int m_luongkinh,int m_thongkinh,string m_kinhnam,string m_chongnam,
			int m_kh_vong,int m_kh_thuoc,int m_kh_baocs,int m_kh_khac,string m_phukhoa,string m_vmcngay,
			string m_lydo,string m_taibv,string m_ptkhac,string m_para,decimal m_connang,string m_namsanh,
			string m_taibien,int m_phu,string m_nieu,string m_tim,string m_phoi,string m_kb_khac,string m_kinhcc,
			string m_ngaysanh,string m_thanhbung,string m_vmc,string m_caotc,string m_dangtc,decimal m_timthai,
			string m_amho,string m_tangsinhmon,string m_cotc,int m_tinhtrangoi,string m_oiluc,string m_mauoi,
			string m_nuocoi,string m_ngoithai,string m_kieuthe,int m_dolot,string m_khungchau,string m_xuly,int m_userid)
		{
			string xxx = user + mmyy(m_ngay);
			sql="update "+xxx+".bavv_sankhoa set lydokham=:m_lydokham,giadinh=:m_giadinh,diung=:m_diung,";
			sql+="buouco=:m_buouco,tieuduong=:m_tieuduong,timmach=:m_timmach,lao=:m_lao,khac=:m_khac,";
			sql+="ngoaikhoa=:m_ngoaikhoa,chuky=:m_chuky,tinhchat=:m_tinhchat,songay=:m_songay,luongkinh=:m_luongkinh,";
			sql+="thongkinh=:m_thongkinh,kinhnam=:m_kinhnam,chongnam=:m_chongnam,kh_vong=:m_kh_vong,kh_thuoc=:m_kh_thuoc,";
			sql+="kh_baocs=:m_kh_baocs,kh_khac=:m_kh_khac,phukhoa=:m_phukhoa,vmcngay=to_date(:m_vmcngay,'dd/mm/yyyy'),";
			sql+="lydo=:m_lydo,taibv=:m_taibv,ptkhac=:m_ptkhac,para=:m_para,connang=:m_connang,namsanh=:m_namsanh,";
			sql+="taibien=:m_taibien,phu=:m_phu,nieu=:m_nieu,tim=:m_tim,phoi=:m_phoi,kb_khac=:m_kb_khac,";
			sql+="kinhcc=to_date(:m_kinhcc,'dd/mm/yyyy'),ngaysanh=to_date(:m_ngaysanh,'dd/mm/yyyy'),thanhbung=:m_thanhbung,";
			sql+="vmc=:m_vmc,caotc=:m_caotc,dangtc=:m_dangtc,timthai=:m_timthai,amho=:m_amho,tangsinhmon=:m_tangsinhmon,";
			sql+="cotc=:m_cotc,tinhtrangoi=:m_tinhtrangoi,oiluc=to_date(:m_oiluc,'dd/mm/yyyy hh24:mi'),mauoi=:m_mauoi,";
			sql+="nuocoi=:m_nuocoi,ngoithai=:m_ngoithai,kieuthe=:m_kieuthe,dolot=:m_dolot,khungchau=:m_khungchau,xuly=:m_xuly,";
			sql+="userid=:m_userid where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_lydokham",OracleType.NVarChar,500).Value=m_lydokham;
				cmd.Parameters.Add("m_giadinh",OracleType.NVarChar,500).Value=m_giadinh;
				cmd.Parameters.Add("m_diung",OracleType.NVarChar,500).Value=m_diung;
				cmd.Parameters.Add("m_buouco",OracleType.Number).Value=m_buouco;
				cmd.Parameters.Add("m_tieuduong",OracleType.Number).Value=m_tieuduong;
				cmd.Parameters.Add("m_timmach",OracleType.Number).Value=m_timmach;
				cmd.Parameters.Add("m_lao",OracleType.Number).Value=m_lao;
				cmd.Parameters.Add("m_khac",OracleType.NVarChar,254).Value=m_khac;
				cmd.Parameters.Add("m_ngoaikhoa",OracleType.NVarChar,500).Value=m_ngoaikhoa;
				cmd.Parameters.Add("m_chuky",OracleType.Number).Value=m_chuky;
				cmd.Parameters.Add("m_tinhchat",OracleType.Number).Value=m_tinhchat;
				cmd.Parameters.Add("m_songay",OracleType.Number).Value=m_songay;
				cmd.Parameters.Add("m_luongkinh",OracleType.Number).Value=m_luongkinh;
				cmd.Parameters.Add("m_thongkinh",OracleType.Number).Value=m_thongkinh;
				cmd.Parameters.Add("m_kinhnam",OracleType.VarChar,4).Value=m_kinhnam;
				cmd.Parameters.Add("m_chongnam",OracleType.VarChar,4).Value=m_chongnam;
				cmd.Parameters.Add("m_kh_vong",OracleType.Number).Value=m_kh_vong;
				cmd.Parameters.Add("m_kh_thuoc",OracleType.Number).Value=m_kh_thuoc;
				cmd.Parameters.Add("m_kh_baocs",OracleType.Number).Value=m_kh_baocs;
				cmd.Parameters.Add("m_kh_khac",OracleType.Number).Value=m_kh_khac;
				cmd.Parameters.Add("m_phukhoa",OracleType.NVarChar,254).Value=m_phukhoa;
				cmd.Parameters.Add("m_vmcngay",OracleType.VarChar,10).Value=m_vmcngay;
				cmd.Parameters.Add("m_lydo",OracleType.NVarChar,254).Value=m_lydo;
				cmd.Parameters.Add("m_taibv",OracleType.VarChar,8).Value=m_taibv;
				cmd.Parameters.Add("m_ptkhac",OracleType.NVarChar,254).Value=m_ptkhac;
				cmd.Parameters.Add("m_para",OracleType.VarChar,8).Value=m_para;
				cmd.Parameters.Add("m_connang",OracleType.Number).Value=m_connang;
				cmd.Parameters.Add("m_namsanh",OracleType.VarChar,4).Value=m_namsanh;
				cmd.Parameters.Add("m_taibien",OracleType.NVarChar,254).Value=m_taibien;
				cmd.Parameters.Add("m_phu",OracleType.Number).Value=m_phu;
				cmd.Parameters.Add("m_nieu",OracleType.NVarChar,254).Value=m_nieu;
				cmd.Parameters.Add("m_tim",OracleType.NVarChar,254).Value=m_tim;
				cmd.Parameters.Add("m_phoi",OracleType.NVarChar,254).Value=m_phoi;
				cmd.Parameters.Add("m_kb_khac",OracleType.NVarChar,254).Value=m_kb_khac;
				cmd.Parameters.Add("m_kinhcc",OracleType.VarChar,10).Value=m_kinhcc;
				cmd.Parameters.Add("m_ngaysanh",OracleType.VarChar,10).Value=m_ngaysanh;
				cmd.Parameters.Add("m_thanhbung",OracleType.NVarChar,254).Value=m_thanhbung;
				cmd.Parameters.Add("m_vmc",OracleType.NVarChar,254).Value=m_vmc;
				cmd.Parameters.Add("m_caotc",OracleType.NVarChar,50).Value=m_caotc;
				cmd.Parameters.Add("m_dangtc",OracleType.NVarChar,50).Value=m_dangtc;
				cmd.Parameters.Add("m_timthai",OracleType.Number).Value=m_timthai;
				cmd.Parameters.Add("m_amho",OracleType.NVarChar,254).Value=m_amho;
				cmd.Parameters.Add("m_tangsinhmon",OracleType.NVarChar,50).Value=m_tangsinhmon;
				cmd.Parameters.Add("m_cotc",OracleType.NVarChar,50).Value=m_cotc;
				cmd.Parameters.Add("m_tinhtrangoi",OracleType.Number).Value=m_tinhtrangoi;
				cmd.Parameters.Add("m_oiluc",OracleType.VarChar,16).Value=m_oiluc.Trim();
				cmd.Parameters.Add("m_mauoi",OracleType.NVarChar,50).Value=m_mauoi;
				cmd.Parameters.Add("m_nuocoi",OracleType.NVarChar,50).Value=m_nuocoi;
				cmd.Parameters.Add("m_ngoithai",OracleType.NVarChar,50).Value=m_ngoithai;
				cmd.Parameters.Add("m_kieuthe",OracleType.NVarChar,50).Value=m_kieuthe;
				cmd.Parameters.Add("m_dolot",OracleType.Number).Value=m_dolot;
				cmd.Parameters.Add("m_khungchau",OracleType.NVarChar,254).Value=m_khungchau;
				cmd.Parameters.Add("m_xuly",OracleType.NVarChar,254).Value=m_xuly;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".bavv_sankhoa (maql,lydokham,giadinh,diung,buouco,tieuduong,timmach,lao,khac,ngoaikhoa,chuky,tinhchat,songay,luongkinh,thongkinh,kinhnam,chongnam,kh_vong,kh_thuoc,kh_baocs,kh_khac,phukhoa,vmcngay,lydo,taibv,ptkhac,para,connang,namsanh,taibien,phu,nieu,tim,phoi,kb_khac,kinhcc,ngaysanh,thanhbung,vmc,caotc,dangtc,timthai,amho,tangsinhmon,cotc,tinhtrangoi,oiluc,mauoi,nuocoi,ngoithai,kieuthe,dolot,khungchau,xuly,userid) values ";
					sql+=" (:m_maql,:m_lydokham,:m_giadinh,:m_diung,:m_buouco,:m_tieuduong,:m_timmach,:m_lao,:m_khac,:m_ngoaikhoa,:m_chuky,:m_tinhchat,:m_songay,:m_luongkinh,:m_thongkinh,:m_kinhnam,:m_chongnam,:m_kh_vong,:m_kh_thuoc,:m_kh_baocs,:m_kh_khac,:m_phukhoa,to_date(:m_vmcngay,'dd/mm/yyyy'),:m_lydo,:m_taibv,:m_ptkhac,:m_para,:m_connang,:m_namsanh,:m_taibien,:m_phu,:m_nieu,:m_tim,:m_phoi,:m_kb_khac,to_date(:m_kinhcc,'dd/mm/yyyy'),to_date(:m_ngaysanh,'dd/mm/yyyy'),:m_thanhbung,:m_vmc,:m_caotc,:m_dangtc,:m_timthai,:m_amho,:m_tangsinhmon,:m_cotc,:m_tinhtrangoi,to_date(:m_oiluc,'dd/mm/yyyy hh24:mi'),:m_mauoi,:m_nuocoi,:m_ngoithai,:m_kieuthe,:m_dolot,:m_khungchau,:m_xuly,:m_userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_lydokham",OracleType.NVarChar,500).Value=m_lydokham;
					cmd.Parameters.Add("m_giadinh",OracleType.NVarChar,500).Value=m_giadinh;
					cmd.Parameters.Add("m_diung",OracleType.NVarChar,500).Value=m_diung;
					cmd.Parameters.Add("m_buouco",OracleType.Number).Value=m_buouco;
					cmd.Parameters.Add("m_tieuduong",OracleType.Number).Value=m_tieuduong;
					cmd.Parameters.Add("m_timmach",OracleType.Number).Value=m_timmach;
					cmd.Parameters.Add("m_lao",OracleType.Number).Value=m_lao;
					cmd.Parameters.Add("m_khac",OracleType.NVarChar,254).Value=m_khac;
					cmd.Parameters.Add("m_ngoaikhoa",OracleType.NVarChar,500).Value=m_ngoaikhoa;
					cmd.Parameters.Add("m_chuky",OracleType.Number).Value=m_chuky;
					cmd.Parameters.Add("m_tinhchat",OracleType.Number).Value=m_tinhchat;
					cmd.Parameters.Add("m_songay",OracleType.Number).Value=m_songay;
					cmd.Parameters.Add("m_luongkinh",OracleType.Number).Value=m_luongkinh;
					cmd.Parameters.Add("m_thongkinh",OracleType.Number).Value=m_thongkinh;
					cmd.Parameters.Add("m_kinhnam",OracleType.VarChar,4).Value=m_kinhnam;
					cmd.Parameters.Add("m_chongnam",OracleType.VarChar,4).Value=m_chongnam;
					cmd.Parameters.Add("m_kh_vong",OracleType.Number).Value=m_kh_vong;
					cmd.Parameters.Add("m_kh_thuoc",OracleType.Number).Value=m_kh_thuoc;
					cmd.Parameters.Add("m_kh_baocs",OracleType.Number).Value=m_kh_baocs;
					cmd.Parameters.Add("m_kh_khac",OracleType.Number).Value=m_kh_khac;
					cmd.Parameters.Add("m_phukhoa",OracleType.NVarChar,254).Value=m_phukhoa;
					cmd.Parameters.Add("m_vmcngay",OracleType.VarChar,10).Value=m_vmcngay;
					cmd.Parameters.Add("m_lydo",OracleType.NVarChar,254).Value=m_lydo;
					cmd.Parameters.Add("m_taibv",OracleType.VarChar,8).Value=m_taibv;
					cmd.Parameters.Add("m_ptkhac",OracleType.NVarChar,254).Value=m_ptkhac;
					cmd.Parameters.Add("m_para",OracleType.VarChar,8).Value=m_para;
					cmd.Parameters.Add("m_connang",OracleType.Number).Value=m_connang;
					cmd.Parameters.Add("m_namsanh",OracleType.VarChar,4).Value=m_namsanh;
					cmd.Parameters.Add("m_taibien",OracleType.NVarChar,254).Value=m_taibien;
					cmd.Parameters.Add("m_phu",OracleType.Number).Value=m_phu;
					cmd.Parameters.Add("m_nieu",OracleType.NVarChar,254).Value=m_nieu;
					cmd.Parameters.Add("m_tim",OracleType.NVarChar,254).Value=m_tim;
					cmd.Parameters.Add("m_phoi",OracleType.NVarChar,254).Value=m_phoi;
					cmd.Parameters.Add("m_kb_khac",OracleType.NVarChar,254).Value=m_kb_khac;
					cmd.Parameters.Add("m_kinhcc",OracleType.VarChar,10).Value=m_kinhcc;
					cmd.Parameters.Add("m_ngaysanh",OracleType.VarChar,10).Value=m_ngaysanh;
					cmd.Parameters.Add("m_thanhbung",OracleType.NVarChar,254).Value=m_thanhbung;
					cmd.Parameters.Add("m_vmc",OracleType.NVarChar,254).Value=m_vmc;
					cmd.Parameters.Add("m_caotc",OracleType.NVarChar,50).Value=m_caotc;
					cmd.Parameters.Add("m_dangtc",OracleType.NVarChar,50).Value=m_dangtc;
					cmd.Parameters.Add("m_timthai",OracleType.Number).Value=m_timthai;
					cmd.Parameters.Add("m_amho",OracleType.NVarChar,254).Value=m_amho;
					cmd.Parameters.Add("m_tangsinhmon",OracleType.NVarChar,50).Value=m_tangsinhmon;
					cmd.Parameters.Add("m_cotc",OracleType.NVarChar,50).Value=m_cotc;
					cmd.Parameters.Add("m_tinhtrangoi",OracleType.Number).Value=m_tinhtrangoi;
					cmd.Parameters.Add("m_oiluc",OracleType.VarChar,16).Value=m_oiluc.Trim();
					cmd.Parameters.Add("m_mauoi",OracleType.NVarChar,50).Value=m_mauoi;
					cmd.Parameters.Add("m_nuocoi",OracleType.NVarChar,50).Value=m_nuocoi;
					cmd.Parameters.Add("m_ngoithai",OracleType.NVarChar,50).Value=m_ngoithai;
					cmd.Parameters.Add("m_kieuthe",OracleType.NVarChar,50).Value=m_kieuthe;
					cmd.Parameters.Add("m_dolot",OracleType.Number).Value=m_dolot;
					cmd.Parameters.Add("m_khungchau",OracleType.NVarChar,254).Value=m_khungchau;
					cmd.Parameters.Add("m_xuly",OracleType.NVarChar,254).Value=m_xuly;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"bavv_sankhoa");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_bavv_khamthai(long m_id,long m_maql,string m_ngay,decimal m_tuoithai,decimal m_cannang,
			string m_huyetap,int m_phu,string m_bctc,string m_thaimay,string m_timthai,string m_ngoithai,string m_ctc,
			string m_tim,string m_phoi,string m_khac,string m_ketluan,string m_cls,string m_xutri,string m_mabs,int m_userid)
		{
			string xxx = user + mmyy(m_ngay);
			sql="update "+xxx+".bavv_khamthai set maql=:m_maql,ngay=to_date(:m_ngay,'dd/mm/yyyy hh24:mi'),tuoithai=:m_tuoithai,";
			sql+="cannang=:m_cannang,huyetap=:m_huyetap,phu=:m_phu,bctc=:m_bctc,thaimay=:m_thaimay,timthai=:m_timthai,";
			sql+="ngoithai=:m_ngoithai,ctc=:m_ctc,tim=:m_tim,phoi=:m_phoi,khac=:m_khac,ketluan=:m_ketluan,cls=:m_cls,";
			sql+="xutri=:m_xutri,mabs=:m_mabs,userid=:m_userid where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				cmd.Parameters.Add("m_ngay",OracleType.VarChar,16).Value=m_ngay;
				cmd.Parameters.Add("m_tuoithai",OracleType.Number).Value=m_tuoithai;
				cmd.Parameters.Add("m_cannang",OracleType.Number).Value=m_cannang;
				cmd.Parameters.Add("m_huyetap",OracleType.VarChar,7).Value=m_huyetap;
				cmd.Parameters.Add("m_phu",OracleType.Number).Value=m_phu;
				cmd.Parameters.Add("m_bctc",OracleType.NVarChar,50).Value=m_bctc;
				cmd.Parameters.Add("m_thaimay",OracleType.NVarChar,50).Value=m_thaimay;
				cmd.Parameters.Add("m_timthai",OracleType.NVarChar,50).Value=m_timthai;
				cmd.Parameters.Add("m_ngoithai",OracleType.NVarChar,50).Value=m_ngoithai;
				cmd.Parameters.Add("m_ctc",OracleType.NVarChar,50).Value=m_ctc;
				cmd.Parameters.Add("m_tim",OracleType.NVarChar,254).Value=m_tim;
				cmd.Parameters.Add("m_phoi",OracleType.NVarChar,254).Value=m_phoi;
				cmd.Parameters.Add("m_khac",OracleType.NVarChar,254).Value=m_khac;
				cmd.Parameters.Add("m_ketluan",OracleType.NVarChar,500).Value=m_ketluan;
				cmd.Parameters.Add("m_cls",OracleType.NVarChar,500).Value=m_cls;
				cmd.Parameters.Add("m_xutri",OracleType.NVarChar,254).Value=m_xutri;
				cmd.Parameters.Add("m_mabs",OracleType.VarChar,4).Value=m_mabs;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".bavv_khamthai (id,maql,ngay,tuoithai,cannang,huyetap,phu,bctc,thaimay,timthai,ngoithai,ctc,tim,phoi,khac,ketluan,cls,xutri,mabs,userid) values ";
					sql+=" (:m_id,:m_maql,to_date(:m_ngay,'dd/mm/yyyy hh24:mi'),:m_tuoithai,:m_cannang,:m_huyetap,:m_phu,:m_bctc,:m_thaimay,:m_timthai,:m_ngoithai,:m_ctc,:m_tim,:m_phoi,:m_khac,:m_ketluan,:m_cls,:m_xutri,:m_mabs,:m_userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_ngay",OracleType.VarChar,16).Value=m_ngay;
					cmd.Parameters.Add("m_tuoithai",OracleType.Number).Value=m_tuoithai;
					cmd.Parameters.Add("m_cannang",OracleType.Number).Value=m_cannang;
					cmd.Parameters.Add("m_huyetap",OracleType.VarChar,7).Value=m_huyetap;
					cmd.Parameters.Add("m_phu",OracleType.Number).Value=m_phu;
					cmd.Parameters.Add("m_bctc",OracleType.NVarChar,50).Value=m_bctc;
					cmd.Parameters.Add("m_thaimay",OracleType.NVarChar,50).Value=m_thaimay;
					cmd.Parameters.Add("m_timthai",OracleType.NVarChar,50).Value=m_timthai;
					cmd.Parameters.Add("m_ngoithai",OracleType.NVarChar,50).Value=m_ngoithai;
					cmd.Parameters.Add("m_ctc",OracleType.NVarChar,50).Value=m_ctc;
					cmd.Parameters.Add("m_tim",OracleType.NVarChar,254).Value=m_tim;
					cmd.Parameters.Add("m_phoi",OracleType.NVarChar,254).Value=m_phoi;
					cmd.Parameters.Add("m_khac",OracleType.NVarChar,254).Value=m_khac;
					cmd.Parameters.Add("m_ketluan",OracleType.NVarChar,500).Value=m_ketluan;
					cmd.Parameters.Add("m_cls",OracleType.NVarChar,500).Value=m_cls;
					cmd.Parameters.Add("m_xutri",OracleType.NVarChar,254).Value=m_xutri;
					cmd.Parameters.Add("m_mabs",OracleType.VarChar,4).Value=m_mabs;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;					
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"bavv_khamthai");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}


		public bool upd_bavv_phukhoa(string m_ngay,long m_maql,string m_lydokham,string m_giadinh,string m_diung,
			int m_buouco,int m_tieuduong,int m_timmach,int m_lao,string m_khac,string m_ngoaikhoa,decimal m_chuky,
			int m_tinhchat,decimal m_songay,int m_luongkinh,int m_thongkinh,string m_kinhnam,string m_chongnam,
			int m_kh_vong,int m_kh_thuoc,int m_kh_baocs,int m_kh_khac,string m_phukhoa,string m_vmcngay,
			string m_lydo,string m_taibv,string m_ptkhac,string m_para,decimal m_connang,string m_namsanh,
			string m_taibien,int m_phu,string m_nieu,string m_tim,string m_phoi,string m_kb_khac,string m_kinhcc,
			string m_benhly,string m_khamngoai,string m_movit,string m_amdao,string m_xuly,int m_userid)
		{
			string xxx = user + mmyy(m_ngay);
			sql="update "+xxx+".bavv_phukhoa set lydokham=:m_lydokham,giadinh=:m_giadinh,diung=:m_diung,";
			sql+="buouco=:m_buouco,tieuduong=:m_tieuduong,timmach=:m_timmach,lao=:m_lao,khac=:m_khac,";
			sql+="ngoaikhoa=:m_ngoaikhoa,chuky=:m_chuky,tinhchat=:m_tinhchat,songay=:m_songay,luongkinh=:m_luongkinh,";
			sql+="thongkinh=:m_thongkinh,kinhnam=:m_kinhnam,chongnam=:m_chongnam,kh_vong=:m_kh_vong,kh_thuoc=:m_kh_thuoc,";
			sql+="kh_baocs=:m_kh_baocs,kh_khac=:m_kh_khac,phukhoa=:m_phukhoa,vmcngay=to_date(:m_vmcngay,'dd/mm/yyyy'),";
			sql+="lydo=:m_lydo,taibv=:m_taibv,ptkhac=:m_ptkhac,para=:m_para,connang=:m_connang,namsanh=:m_namsanh,";
			sql+="taibien=:m_taibien,phu=:m_phu,nieu=:m_nieu,tim=:m_tim,phoi=:m_phoi,kb_khac=:m_kb_khac,";
			sql+="kinhcc=to_date(:m_kinhcc,'dd/mm/yyyy'),benhly=:m_benhly,khamngoai=:m_khamngoai,";
			sql+="movit=:m_movit,amdao=:m_amdao,xuly=:m_xuly,userid=:m_userid where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_lydokham",OracleType.NVarChar,500).Value=m_lydokham;
				cmd.Parameters.Add("m_giadinh",OracleType.NVarChar,500).Value=m_giadinh;
				cmd.Parameters.Add("m_diung",OracleType.NVarChar,500).Value=m_diung;
				cmd.Parameters.Add("m_buouco",OracleType.Number).Value=m_buouco;
				cmd.Parameters.Add("m_tieuduong",OracleType.Number).Value=m_tieuduong;
				cmd.Parameters.Add("m_timmach",OracleType.Number).Value=m_timmach;
				cmd.Parameters.Add("m_lao",OracleType.Number).Value=m_lao;
				cmd.Parameters.Add("m_khac",OracleType.NVarChar,254).Value=m_khac;
				cmd.Parameters.Add("m_ngoaikhoa",OracleType.NVarChar,500).Value=m_ngoaikhoa;
				cmd.Parameters.Add("m_chuky",OracleType.Number).Value=m_chuky;
				cmd.Parameters.Add("m_tinhchat",OracleType.Number).Value=m_tinhchat;
				cmd.Parameters.Add("m_songay",OracleType.Number).Value=m_songay;
				cmd.Parameters.Add("m_luongkinh",OracleType.Number).Value=m_luongkinh;
				cmd.Parameters.Add("m_thongkinh",OracleType.Number).Value=m_thongkinh;
				cmd.Parameters.Add("m_kinhnam",OracleType.VarChar,4).Value=m_kinhnam;
				cmd.Parameters.Add("m_chongnam",OracleType.VarChar,4).Value=m_chongnam;
				cmd.Parameters.Add("m_kh_vong",OracleType.Number).Value=m_kh_vong;
				cmd.Parameters.Add("m_kh_thuoc",OracleType.Number).Value=m_kh_thuoc;
				cmd.Parameters.Add("m_kh_baocs",OracleType.Number).Value=m_kh_baocs;
				cmd.Parameters.Add("m_kh_khac",OracleType.Number).Value=m_kh_khac;
				cmd.Parameters.Add("m_phukhoa",OracleType.NVarChar,254).Value=m_phukhoa;
				cmd.Parameters.Add("m_vmcngay",OracleType.VarChar,10).Value=m_vmcngay;
				cmd.Parameters.Add("m_lydo",OracleType.NVarChar,254).Value=m_lydo;
				cmd.Parameters.Add("m_taibv",OracleType.VarChar,8).Value=m_taibv;
				cmd.Parameters.Add("m_ptkhac",OracleType.NVarChar,254).Value=m_ptkhac;
				cmd.Parameters.Add("m_para",OracleType.VarChar,8).Value=m_para;
				cmd.Parameters.Add("m_connang",OracleType.Number).Value=m_connang;
				cmd.Parameters.Add("m_namsanh",OracleType.VarChar,4).Value=m_namsanh;
				cmd.Parameters.Add("m_taibien",OracleType.NVarChar,254).Value=m_taibien;
				cmd.Parameters.Add("m_phu",OracleType.Number).Value=m_phu;
				cmd.Parameters.Add("m_nieu",OracleType.NVarChar,254).Value=m_nieu;
				cmd.Parameters.Add("m_tim",OracleType.NVarChar,254).Value=m_tim;
				cmd.Parameters.Add("m_phoi",OracleType.NVarChar,254).Value=m_phoi;
				cmd.Parameters.Add("m_kb_khac",OracleType.NVarChar,254).Value=m_kb_khac;
				cmd.Parameters.Add("m_kinhcc",OracleType.VarChar,10).Value=m_kinhcc;
				cmd.Parameters.Add("m_benhly",OracleType.NVarChar,500).Value=m_benhly;
				cmd.Parameters.Add("m_khamngoai",OracleType.NVarChar,500).Value=m_khamngoai;
				cmd.Parameters.Add("m_movit",OracleType.NVarChar,254).Value=m_movit;
				cmd.Parameters.Add("m_amdao",OracleType.NVarChar,254).Value=m_amdao;
				cmd.Parameters.Add("m_xuly",OracleType.NVarChar,500).Value=m_xuly;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".bavv_phukhoa (maql,lydokham,giadinh,diung,buouco,tieuduong,timmach,lao,khac,ngoaikhoa,chuky,tinhchat,songay,luongkinh,thongkinh,kinhnam,chongnam,kh_vong,kh_thuoc,kh_baocs,kh_khac,phukhoa,vmcngay,lydo,taibv,ptkhac,para,connang,namsanh,taibien,phu,nieu,tim,phoi,kb_khac,kinhcc,benhly,khamngoai,movit,amdao,xuly,userid) values ";
					sql+=" (:m_maql,:m_lydokham,:m_giadinh,:m_diung,:m_buouco,:m_tieuduong,:m_timmach,:m_lao,:m_khac,:m_ngoaikhoa,:m_chuky,:m_tinhchat,:m_songay,:m_luongkinh,:m_thongkinh,:m_kinhnam,:m_chongnam,:m_kh_vong,:m_kh_thuoc,:m_kh_baocs,:m_kh_khac,:m_phukhoa,to_date(:m_vmcngay,'dd/mm/yyyy'),:m_lydo,:m_taibv,:m_ptkhac,:m_para,:m_connang,:m_namsanh,:m_taibien,:m_phu,:m_nieu,:m_tim,:m_phoi,:m_kb_khac,to_date(:m_kinhcc,'dd/mm/yyyy'),:m_benhly,:m_khamngoai,:m_movit,:m_amdao,:m_xuly,:m_userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
					cmd.Parameters.Add("m_lydokham",OracleType.NVarChar,500).Value=m_lydokham;
					cmd.Parameters.Add("m_giadinh",OracleType.NVarChar,500).Value=m_giadinh;
					cmd.Parameters.Add("m_diung",OracleType.NVarChar,500).Value=m_diung;
					cmd.Parameters.Add("m_buouco",OracleType.Number).Value=m_buouco;
					cmd.Parameters.Add("m_tieuduong",OracleType.Number).Value=m_tieuduong;
					cmd.Parameters.Add("m_timmach",OracleType.Number).Value=m_timmach;
					cmd.Parameters.Add("m_lao",OracleType.Number).Value=m_lao;
					cmd.Parameters.Add("m_khac",OracleType.NVarChar,254).Value=m_khac;
					cmd.Parameters.Add("m_ngoaikhoa",OracleType.NVarChar,500).Value=m_ngoaikhoa;
					cmd.Parameters.Add("m_chuky",OracleType.Number).Value=m_chuky;
					cmd.Parameters.Add("m_tinhchat",OracleType.Number).Value=m_tinhchat;
					cmd.Parameters.Add("m_songay",OracleType.Number).Value=m_songay;
					cmd.Parameters.Add("m_luongkinh",OracleType.Number).Value=m_luongkinh;
					cmd.Parameters.Add("m_thongkinh",OracleType.Number).Value=m_thongkinh;
					cmd.Parameters.Add("m_kinhnam",OracleType.VarChar,4).Value=m_kinhnam;
					cmd.Parameters.Add("m_chongnam",OracleType.VarChar,4).Value=m_chongnam;
					cmd.Parameters.Add("m_kh_vong",OracleType.Number).Value=m_kh_vong;
					cmd.Parameters.Add("m_kh_thuoc",OracleType.Number).Value=m_kh_thuoc;
					cmd.Parameters.Add("m_kh_baocs",OracleType.Number).Value=m_kh_baocs;
					cmd.Parameters.Add("m_kh_khac",OracleType.Number).Value=m_kh_khac;
					cmd.Parameters.Add("m_phukhoa",OracleType.NVarChar,254).Value=m_phukhoa;
					cmd.Parameters.Add("m_vmcngay",OracleType.VarChar,10).Value=m_vmcngay;
					cmd.Parameters.Add("m_lydo",OracleType.NVarChar,254).Value=m_lydo;
					cmd.Parameters.Add("m_taibv",OracleType.VarChar,8).Value=m_taibv;
					cmd.Parameters.Add("m_ptkhac",OracleType.NVarChar,254).Value=m_ptkhac;
					cmd.Parameters.Add("m_para",OracleType.VarChar,8).Value=m_para;
					cmd.Parameters.Add("m_connang",OracleType.Number).Value=m_connang;
					cmd.Parameters.Add("m_namsanh",OracleType.VarChar,4).Value=m_namsanh;
					cmd.Parameters.Add("m_taibien",OracleType.NVarChar,254).Value=m_taibien;
					cmd.Parameters.Add("m_phu",OracleType.Number).Value=m_phu;
					cmd.Parameters.Add("m_nieu",OracleType.NVarChar,254).Value=m_nieu;
					cmd.Parameters.Add("m_tim",OracleType.NVarChar,254).Value=m_tim;
					cmd.Parameters.Add("m_phoi",OracleType.NVarChar,254).Value=m_phoi;
					cmd.Parameters.Add("m_kb_khac",OracleType.NVarChar,254).Value=m_kb_khac;
					cmd.Parameters.Add("m_kinhcc",OracleType.VarChar,10).Value=m_kinhcc;
					cmd.Parameters.Add("m_benhly",OracleType.NVarChar,500).Value=m_benhly;
					cmd.Parameters.Add("m_khamngoai",OracleType.NVarChar,500).Value=m_khamngoai;
					cmd.Parameters.Add("m_movit",OracleType.NVarChar,254).Value=m_movit;
					cmd.Parameters.Add("m_amdao",OracleType.NVarChar,254).Value=m_amdao;
					cmd.Parameters.Add("m_xuly",OracleType.NVarChar,254).Value=m_xuly;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"bavv_phukhoa");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_benhandt(long m_maql,string m_chandoan,string m_maicd)
		{
			sql="update benhandt set chandoan=:m_chandoan,maicd=:m_maicd where maql=:m_maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,254).Value=m_chandoan;
				cmd.Parameters.Add("m_maicd",OracleType.VarChar,9).Value=m_maicd;
				cmd.Parameters.Add("m_maql",OracleType.Number).Value=m_maql;
				cmd.ExecuteNonQuery();
				cmd.Dispose();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"Benhandt");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public long get_idthuchien(string ngay,long idkhoa)
		{
			ds=get_data("select id from "+user+mmyy(ngay)+".ba_thuchien where idkhoa="+idkhoa+" order by id desc");
			if (ds.Tables[0].Rows.Count==0) return 0;
			else return long.Parse(ds.Tables[0].Rows[0]["id"].ToString());
		}
		public long get_idthuchien(string ngay,long maql,string makp,long idkhoa)
		{
			ds=get_data("select id from "+user+mmyy(ngay)+".ba_thuchien where idkhoa="+idkhoa+" order by id desc");
			if (ds.Tables[0].Rows.Count==0)
			{
				ds=get_data("select id from "+user+mmyy(ngay)+".ba_thuchien where maql="+maql+" and makp='"+makp+"' order by id desc");
				if (ds.Tables[0].Rows.Count==0) return 0;
				else return long.Parse(ds.Tables[0].Rows[0]["id"].ToString());
			}
			else return long.Parse(ds.Tables[0].Rows[0]["id"].ToString());
		}

		public long get_idthuchien_maql(string ngay,long maql)
		{
			ds=get_data("select id from "+user+mmyy(ngay)+".ba_thuchien where maql="+maql+" order by id desc");
			if (ds.Tables[0].Rows.Count==0) return 0;
			else return long.Parse(ds.Tables[0].Rows[0]["id"].ToString());
		}

		public long get_idchung(string ngay,long idthuchien)
		{
			ds=get_data("select id from "+user+mmyy(ngay)+".ba_chung where idthuchien="+idthuchien+" order by id");
			if (ds.Tables[0].Rows.Count==0) return 0;
			else return long.Parse(ds.Tables[0].Rows[0]["id"].ToString());
		}

		public long get_idgayme(string ngay,long idthuchien)
		{
			ds=get_data("select id from "+user+mmyy(ngay)+".ba_gayme where idthuchien="+idthuchien+" order by id");
			if (ds.Tables[0].Rows.Count==0) return 0;
			else return long.Parse(ds.Tables[0].Rows[0]["id"].ToString());
		}

		public long get_idgayme(string ngay,long id,int stt)
		{
			ds=get_data("select id from "+user+mmyy(ngay)+".ba_gaymehinh where idgayme="+id+" and stt="+stt);
			if (ds.Tables[0].Rows.Count==0) return 0;
			else return long.Parse(ds.Tables[0].Rows[0]["id"].ToString());
		}

		public bool upd_ba_vanchuyen(long m_id,long m_idthuchien,string m_ngay,
			string m_khoaden,string m_ngayvv,string m_ngayrk,string m_ngayvk,decimal m_m_cc,string m_ha_cc,
			decimal m_nt_cc,decimal m_t_cc,int m_tg_cc,decimal m_m_vc,string m_ha_vc,decimal m_nt_vc,decimal m_t_vc,
			int m_tg_vc,decimal m_m_kd,string m_ha_kd,decimal m_nt_kd,decimal m_t_kd,int m_tg_kd,
			string m_bs_cc,string m_dd_cc,string m_bs_vc,string m_dd_vc,string m_bs_kd,string m_dd_kd,string m_khac,
			string m_luc,string m_vedenkhoa,decimal m_thangmay,decimal m_phongmo,decimal m_nhanbenh,int m_userid)
		{
			string xxx = user + mmyy(m_ngayvv);
			sql="update "+xxx+".ba_vanchuyen set idthuchien=:m_idthuchien,ngay=to_date(:m_ngay,'dd/mm/yyyy hh24:mi'),";
			sql+="khoaden=:m_khoaden,ngayvv=to_date(:m_ngayvv,'dd/mm/yyyy hh24:mi'),ngayrk=to_date(:m_ngayrk,'dd/mm/yyyy hh24:mi'),";
			sql+="ngayvk=to_date(:m_ngayvk,'dd/mm/yyyy hh24:mi'),";
			sql+="m_cc=:m_m_cc,ha_cc=:m_ha_cc,nt_cc=:m_nt_cc,t_cc=:m_t_cc,tg_cc=:m_tg_cc,";
			sql+="m_vc=:m_m_vc,ha_vc=:m_ha_vc,nt_vc=:m_nt_vc,t_vc=:m_t_vc,tg_vc=:m_tg_vc,";
			sql+="m_kd=:m_m_kd,ha_kd=:m_ha_kd,nt_kd=:m_nt_kd,t_kd=:m_t_kd,tg_kd=:m_tg_kd,";
			sql+="bs_cc=:m_bs_cc,dd_cc=:m_dd_cc,bs_vc=:m_bs_vc,dd_vc=:m_dd_vc,bs_kd=:m_bs_kd,dd_kd=:m_dd_kd,";
			sql+="khac=:m_khac,luc=to_date(:m_luc,'dd/mm/yyyy hh24:mi'),vedenkhoa=to_date(:m_vedenkhoa,'dd/mm/yyyy hh24:mi'),";
			sql+="thangmay=:m_thangmay,phongmo=:m_phongmo,nhanbenh=:m_nhanbenh,";
			sql+="userid=:m_userid where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_idthuchien",OracleType.Number).Value=m_idthuchien;
				cmd.Parameters.Add("m_ngay",OracleType.VarChar,16).Value=m_ngay;
				cmd.Parameters.Add("m_khoaden",OracleType.NVarChar,100).Value=m_khoaden;
				cmd.Parameters.Add("m_ngayvv",OracleType.VarChar,16).Value=m_ngayvv;
				cmd.Parameters.Add("m_ngayrk",OracleType.VarChar,16).Value=m_ngayrk;
				cmd.Parameters.Add("m_ngayvk",OracleType.VarChar,16).Value=m_ngayvk;
				cmd.Parameters.Add("m_m_cc",OracleType.Number).Value=m_m_cc;
				cmd.Parameters.Add("m_ha_cc",OracleType.VarChar,7).Value=m_ha_cc;
				cmd.Parameters.Add("m_nt_cc",OracleType.Number).Value=m_nt_cc;
				cmd.Parameters.Add("m_t_cc",OracleType.Number).Value=m_t_cc;
				cmd.Parameters.Add("m_tg_cc",OracleType.Number).Value=m_tg_cc;
				cmd.Parameters.Add("m_m_vc",OracleType.Number).Value=m_m_vc;
				cmd.Parameters.Add("m_ha_vc",OracleType.VarChar,7).Value=m_ha_vc;
				cmd.Parameters.Add("m_nt_vc",OracleType.Number).Value=m_nt_vc;
				cmd.Parameters.Add("m_t_vc",OracleType.Number).Value=m_t_vc;
				cmd.Parameters.Add("m_tg_vc",OracleType.Number).Value=m_tg_vc;
				cmd.Parameters.Add("m_m_kd",OracleType.Number).Value=m_m_kd;
				cmd.Parameters.Add("m_ha_kd",OracleType.VarChar,7).Value=m_ha_kd;
				cmd.Parameters.Add("m_nt_kd",OracleType.Number).Value=m_nt_kd;
				cmd.Parameters.Add("m_t_kd",OracleType.Number).Value=m_t_kd;
				cmd.Parameters.Add("m_tg_kd",OracleType.Number).Value=m_tg_kd;
				cmd.Parameters.Add("m_bs_cc",OracleType.VarChar,4).Value=m_bs_cc;
				cmd.Parameters.Add("m_dd_cc",OracleType.VarChar,4).Value=m_dd_cc;
				cmd.Parameters.Add("m_bs_vc",OracleType.VarChar,4).Value=m_bs_vc;
				cmd.Parameters.Add("m_dd_vc",OracleType.VarChar,4).Value=m_dd_vc;
				cmd.Parameters.Add("m_bs_kd",OracleType.VarChar,4).Value=m_bs_kd;
				cmd.Parameters.Add("m_dd_kd",OracleType.VarChar,4).Value=m_dd_kd;
				cmd.Parameters.Add("m_khac",OracleType.NVarChar,1000).Value=m_khac;
				cmd.Parameters.Add("m_luc",OracleType.VarChar,16).Value=m_luc;
				cmd.Parameters.Add("m_vedenkhoa",OracleType.VarChar,16).Value=m_vedenkhoa;
				cmd.Parameters.Add("m_thangmay",OracleType.Number).Value=m_thangmay;
				cmd.Parameters.Add("m_phongmo",OracleType.Number).Value=m_phongmo;
				cmd.Parameters.Add("m_nhanbenh",OracleType.Number).Value=m_nhanbenh;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_vanchuyen (id,idthuchien,ngay,khoaden,ngayvv,ngayrk,ngayvk,m_cc,ha_cc,nt_cc,t_cc,tg_cc,";
					sql+="m_vc,ha_vc,nt_vc,t_vc,tg_vc,m_kd,ha_kd,nt_kd,t_kd,tg_kd,bs_cc,dd_cc,bs_vc,dd_vc,bs_kd,dd_kd,khac,";
					sql+="luc,vedenkhoa,thangmay,phongmo,nhanbenh,userid) values";
					sql+=" (:m_id,:m_idthuchien,to_date(:m_ngay,'dd/mm/yyyy hh24:mi'),:m_khoaden,to_date(:m_ngayvv,'dd/mm/yyyy hh24:mi'),to_date(:m_ngayrk,'dd/mm/yyyy hh24:mi'),to_date(:m_ngayvk,'dd/mm/yyyy hh24:mi'),:m_m_cc,:m_ha_cc,:m_nt_cc,:m_t_cc,:m_tg_cc,";
					sql+=":m_m_vc,:m_ha_vc,:m_nt_vc,:m_t_vc,:m_tg_vc,:m_m_kd,:m_ha_kd,:m_nt_kd,:m_t_kd,:m_tg_kd,:m_bs_cc,:m_dd_cc,:m_bs_vc,:m_dd_vc,:m_bs_kd,:m_dd_kd,:m_khac,";
					sql+="to_date(:m_luc,'dd/mm/yyyy hh24:mi'),to_date(:m_vedenkhoa,'dd/mm/yyyy hh24:mi'),:m_thangmay,:m_phongmo,:m_nhanbenh,:m_userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_idthuchien",OracleType.Number).Value=m_idthuchien;
					cmd.Parameters.Add("m_ngay",OracleType.VarChar,16).Value=m_ngay;
					cmd.Parameters.Add("m_khoaden",OracleType.NVarChar,100).Value=m_khoaden;
					cmd.Parameters.Add("m_ngayvv",OracleType.VarChar,16).Value=m_ngayvv;
					cmd.Parameters.Add("m_ngayrk",OracleType.VarChar,16).Value=m_ngayrk;
					cmd.Parameters.Add("m_ngayvk",OracleType.VarChar,16).Value=m_ngayvk;
					cmd.Parameters.Add("m_m_cc",OracleType.Number).Value=m_m_cc;
					cmd.Parameters.Add("m_ha_cc",OracleType.VarChar,7).Value=m_ha_cc;
					cmd.Parameters.Add("m_nt_cc",OracleType.Number).Value=m_nt_cc;
					cmd.Parameters.Add("m_t_cc",OracleType.Number).Value=m_t_cc;
					cmd.Parameters.Add("m_tg_cc",OracleType.Number).Value=m_tg_cc;
					cmd.Parameters.Add("m_m_vc",OracleType.Number).Value=m_m_vc;
					cmd.Parameters.Add("m_ha_vc",OracleType.VarChar,7).Value=m_ha_vc;
					cmd.Parameters.Add("m_nt_vc",OracleType.Number).Value=m_nt_vc;
					cmd.Parameters.Add("m_t_vc",OracleType.Number).Value=m_t_vc;
					cmd.Parameters.Add("m_tg_vc",OracleType.Number).Value=m_tg_vc;
					cmd.Parameters.Add("m_m_kd",OracleType.Number).Value=m_m_kd;
					cmd.Parameters.Add("m_ha_kd",OracleType.VarChar,7).Value=m_ha_kd;
					cmd.Parameters.Add("m_nt_kd",OracleType.Number).Value=m_nt_kd;
					cmd.Parameters.Add("m_t_kd",OracleType.Number).Value=m_t_kd;
					cmd.Parameters.Add("m_tg_kd",OracleType.Number).Value=m_tg_kd;
					cmd.Parameters.Add("m_bs_cc",OracleType.VarChar,4).Value=m_bs_cc;
					cmd.Parameters.Add("m_dd_cc",OracleType.VarChar,4).Value=m_dd_cc;
					cmd.Parameters.Add("m_bs_vc",OracleType.VarChar,4).Value=m_bs_vc;
					cmd.Parameters.Add("m_dd_vc",OracleType.VarChar,4).Value=m_dd_vc;
					cmd.Parameters.Add("m_bs_kd",OracleType.VarChar,4).Value=m_bs_kd;
					cmd.Parameters.Add("m_dd_kd",OracleType.VarChar,4).Value=m_dd_kd;
					cmd.Parameters.Add("m_khac",OracleType.NVarChar,1000).Value=m_khac;
					cmd.Parameters.Add("m_luc",OracleType.VarChar,16).Value=m_luc;
					cmd.Parameters.Add("m_vedenkhoa",OracleType.VarChar,16).Value=m_vedenkhoa;
					cmd.Parameters.Add("m_thangmay",OracleType.Number).Value=m_thangmay;
					cmd.Parameters.Add("m_phongmo",OracleType.Number).Value=m_phongmo;
					cmd.Parameters.Add("m_nhanbenh",OracleType.Number).Value=m_nhanbenh;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_vanchuyen");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_vanchuyenct(string m_ngayvv,long m_id,decimal m_stt,int m_cc,int m_vc,int m_kd)
		{
			string xxx = user + mmyy(m_ngayvv);
			sql="update "+xxx+".ba_vanchuyenct set cc=:m_cc,vc=:m_vc,kd=:m_kd where id=:m_id and stt=:m_stt";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_cc",OracleType.Number).Value=m_cc;
				cmd.Parameters.Add("m_vc",OracleType.Number).Value=m_vc;
				cmd.Parameters.Add("m_kd",OracleType.Number).Value=m_kd;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_vanchuyenct (id,stt,cc,vc,kd) values (:m_id,:m_stt,:m_cc,:m_vc,:m_kd)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
					cmd.Parameters.Add("m_cc",OracleType.Number).Value=m_cc;
					cmd.Parameters.Add("m_vc",OracleType.Number).Value=m_vc;
					cmd.Parameters.Add("m_kd",OracleType.Number).Value=m_kd;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_vanchuyenct");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_chuyenbenh(long m_id,long m_idthuchien,string m_ngay,
			string m_thannhan,string m_taisan,string m_ngayvv,string m_ngaycv,string m_tu,string m_den,
			string m_mabs,string m_lydo,string m_cd_noikhoa,string m_cd_ngoaikhoa,string m_cd_khac,
			string m_tongtrang,string m_giaotiep,string m_chedoan,string m_vesinh,string m_baitiet,
			string m_vandong,string m_trilieu,string m_cachly,string m_oxy,string m_luuthong,
			string m_loai,string m_khidung,string m_vetthuong,decimal m_thaybang,int m_ngoaibien,
			string m_ngoaibien_vt,int m_trungtam,string m_trungtam_vt,int m_thongtieu,
			string m_thongtieu_vt,string m_vanmach,string m_khangdong,string m_anthan,
			string m_dichtruyen,string m_mau,string m_khac,string m_bangiaokhac,string m_yta,int m_userid)
		{
			string xxx = user + mmyy(m_ngay);
			sql="update "+xxx+".ba_chuyenbenh set idthuchien=:m_idthuchien,ngay=to_date(:m_ngay,'dd/mm/yyyy hh24:mi'),";
			sql+="thannhan=:m_thannhan,taisan=:m_taisan,ngayvv=to_date(:m_ngayvv,'dd/mm/yyyy hh24:mi'),";
			sql+="ngaycv=to_date(:m_ngaycv,'dd/mm/yyyy hh24:mi'),tu=:m_tu,den=:m_den,mabs=:m_mabs,lydo=:m_lydo,";
			sql+="cd_noikhoa=:m_cd_noikhoa,cd_ngoaikhoa=:m_cd_ngoaikhoa,cd_khac=:m_cd_khac,";
			sql+="tongtrang=:m_tongtrang,giaotiep=:m_giaotiep,chedoan=:m_chedoan,vesinh=:m_vesinh,baitiet=:m_baitiet,";
			sql+="vandong=:m_vandong,trilieu=:m_trilieu,cachly=:m_cachly,oxy=:m_oxy,luuthong=:m_luuthong,";
			sql+="loai=:m_loai,khidung=:m_khidung,vetthuong=:m_vetthuong,thaybang=:m_thaybang,ngoaibien=:m_ngoaibien,";
			sql+="ngoaibien_vt=:m_ngoaibien_vt,trungtam=:m_trungtam,trungtam_vt=:m_trungtam_vt,thongtieu=:m_thongtieu,";
			sql+="thongtieu_vt=:m_thongtieu_vt,vanmach=:m_vanmach,khangdong=:m_khangdong,anthan=:m_anthan,";
			sql+="dichtruyen=:m_dichtruyen,mau=:m_mau,khac=:m_khac,bangiaokhac=:m_bangiaokhac,yta=:m_yta,";
			sql+="userid=:m_userid where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_idthuchien",OracleType.Number).Value=m_idthuchien;
				cmd.Parameters.Add("m_ngay",OracleType.VarChar,16).Value=m_ngay;
				cmd.Parameters.Add("m_thannhan",OracleType.NVarChar,254).Value=m_thannhan;
				cmd.Parameters.Add("m_taisan",OracleType.NVarChar,500).Value=m_taisan;
				cmd.Parameters.Add("m_ngayvv",OracleType.VarChar,16).Value=m_ngayvv;
				cmd.Parameters.Add("m_ngaycv",OracleType.VarChar,16).Value=m_ngaycv;
				cmd.Parameters.Add("m_tu",OracleType.NVarChar,100).Value=m_tu;
				cmd.Parameters.Add("m_den",OracleType.NVarChar,100).Value=m_den;
				cmd.Parameters.Add("m_mabs",OracleType.VarChar,4).Value=m_mabs;
				cmd.Parameters.Add("m_lydo",OracleType.NVarChar,500).Value=m_lydo;
				cmd.Parameters.Add("m_cd_noikhoa",OracleType.NVarChar,254).Value=m_cd_noikhoa;
				cmd.Parameters.Add("m_cd_ngoaikhoa",OracleType.NVarChar,254).Value=m_cd_ngoaikhoa;
				cmd.Parameters.Add("m_cd_khac",OracleType.NVarChar,254).Value=m_cd_khac;
				cmd.Parameters.Add("m_tongtrang",OracleType.NVarChar,500).Value=m_tongtrang;
				cmd.Parameters.Add("m_giaotiep",OracleType.NVarChar,254).Value=m_giaotiep;
				cmd.Parameters.Add("m_chedoan",OracleType.NVarChar,254).Value=m_chedoan;
				cmd.Parameters.Add("m_vesinh",OracleType.NVarChar,254).Value=m_vesinh;
				cmd.Parameters.Add("m_baitiet",OracleType.NVarChar,254).Value=m_baitiet;
				cmd.Parameters.Add("m_vandong",OracleType.NVarChar,254).Value=m_vandong;
				cmd.Parameters.Add("m_trilieu",OracleType.NVarChar,254).Value=m_trilieu;
				cmd.Parameters.Add("m_cachly",OracleType.NVarChar,254).Value=m_cachly;
				cmd.Parameters.Add("m_oxy",OracleType.NVarChar,50).Value=m_oxy;
				cmd.Parameters.Add("m_luuthong",OracleType.NVarChar,50).Value=m_luuthong;
				cmd.Parameters.Add("m_loai",OracleType.NVarChar,50).Value=m_loai;
				cmd.Parameters.Add("m_khidung",OracleType.NVarChar,50).Value=m_khidung;
				cmd.Parameters.Add("m_vetthuong",OracleType.NVarChar,254).Value=m_vetthuong;
				cmd.Parameters.Add("m_thaybang",OracleType.Number).Value=m_thaybang;
				cmd.Parameters.Add("m_ngoaibien",OracleType.Number).Value=m_ngoaibien;
				cmd.Parameters.Add("m_ngoaibien_vt",OracleType.NVarChar,50).Value=m_ngoaibien_vt;
				cmd.Parameters.Add("m_trungtam",OracleType.Number).Value=m_trungtam;
				cmd.Parameters.Add("m_trungtam_vt",OracleType.NVarChar,50).Value=m_trungtam_vt;
				cmd.Parameters.Add("m_thongtieu",OracleType.Number).Value=m_thongtieu;
				cmd.Parameters.Add("m_thongtieu_vt",OracleType.NVarChar,50).Value=m_thongtieu_vt;
				cmd.Parameters.Add("m_vanmach",OracleType.NVarChar,254).Value=m_vanmach;
				cmd.Parameters.Add("m_khangdong",OracleType.NVarChar,254).Value=m_khangdong;
				cmd.Parameters.Add("m_anthan",OracleType.NVarChar,254).Value=m_anthan;
				cmd.Parameters.Add("m_dichtruyen",OracleType.NVarChar,254).Value=m_dichtruyen;
				cmd.Parameters.Add("m_mau",OracleType.NVarChar,254).Value=m_mau;
				cmd.Parameters.Add("m_khac",OracleType.NVarChar,254).Value=m_khac;
				cmd.Parameters.Add("m_bangiaokhac",OracleType.NVarChar,500).Value=m_bangiaokhac;
				cmd.Parameters.Add("m_yta",OracleType.VarChar,4).Value=m_yta;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_chuyenbenh (id,idthuchien,ngay,thannhan,taisan,ngayvv,ngaycv,";
					sql+="tu,den,mabs,lydo,cd_noikhoa,cd_ngoaikhoa,cd_khac,tongtrang,giaotiep,chedoan,vesinh,baitiet,";
					sql+="vandong,trilieu,cachly,oxy,luuthong,loai,khidung,vetthuong,thaybang,ngoaibien,";
					sql+="ngoaibien_vt,trungtam,trungtam_vt,thongtieu,thongtieu_vt,vanmach,khangdong,anthan,";
					sql+="dichtruyen,mau,khac,bangiaokhac,yta,userid) values";
					sql+=" (:m_id,:m_idthuchien,to_date(:m_ngay,'dd/mm/yyyy hh24:mi'),:m_thannhan,:m_taisan,to_date(:m_ngayvv,'dd/mm/yyyy hh24:mi'),to_date(:m_ngaycv,'dd/mm/yyyy hh24:mi'),";
					sql+=":m_tu,:m_den,:m_mabs,:m_lydo,:m_cd_noikhoa,:m_cd_ngoaikhoa,:m_cd_khac,:m_tongtrang,:m_giaotiep,:m_chedoan,:m_vesinh,:m_baitiet,";
					sql+=":m_vandong,:m_trilieu,:m_cachly,:m_oxy,:m_luuthong,:m_loai,:m_khidung,:m_vetthuong,:m_thaybang,:m_ngoaibien,";
					sql+=":m_ngoaibien_vt,:m_trungtam,:m_trungtam_vt,:m_thongtieu,:m_thongtieu_vt,:m_vanmach,:m_khangdong,:m_anthan,";
					sql+=":m_dichtruyen,:m_mau,:m_khac,:m_bangiaokhac,:m_yta,:m_userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_idthuchien",OracleType.Number).Value=m_idthuchien;
					cmd.Parameters.Add("m_ngay",OracleType.VarChar,16).Value=m_ngay;
					cmd.Parameters.Add("m_thannhan",OracleType.NVarChar,254).Value=m_thannhan;
					cmd.Parameters.Add("m_taisan",OracleType.NVarChar,500).Value=m_taisan;
					cmd.Parameters.Add("m_ngayvv",OracleType.VarChar,16).Value=m_ngayvv;
					cmd.Parameters.Add("m_ngaycv",OracleType.VarChar,16).Value=m_ngaycv;
					cmd.Parameters.Add("m_tu",OracleType.NVarChar,100).Value=m_tu;
					cmd.Parameters.Add("m_den",OracleType.NVarChar,100).Value=m_den;
					cmd.Parameters.Add("m_mabs",OracleType.VarChar,4).Value=m_mabs;
					cmd.Parameters.Add("m_lydo",OracleType.NVarChar,500).Value=m_lydo;
					cmd.Parameters.Add("m_cd_noikhoa",OracleType.NVarChar,254).Value=m_cd_noikhoa;
					cmd.Parameters.Add("m_cd_ngoaikhoa",OracleType.NVarChar,254).Value=m_cd_ngoaikhoa;
					cmd.Parameters.Add("m_cd_khac",OracleType.NVarChar,254).Value=m_cd_khac;
					cmd.Parameters.Add("m_tongtrang",OracleType.NVarChar,500).Value=m_tongtrang;
					cmd.Parameters.Add("m_giaotiep",OracleType.NVarChar,254).Value=m_giaotiep;
					cmd.Parameters.Add("m_chedoan",OracleType.NVarChar,254).Value=m_chedoan;
					cmd.Parameters.Add("m_vesinh",OracleType.NVarChar,254).Value=m_vesinh;
					cmd.Parameters.Add("m_baitiet",OracleType.NVarChar,254).Value=m_baitiet;
					cmd.Parameters.Add("m_vandong",OracleType.NVarChar,254).Value=m_vandong;
					cmd.Parameters.Add("m_trilieu",OracleType.NVarChar,254).Value=m_trilieu;
					cmd.Parameters.Add("m_cachly",OracleType.NVarChar,254).Value=m_cachly;
					cmd.Parameters.Add("m_oxy",OracleType.NVarChar,50).Value=m_oxy;
					cmd.Parameters.Add("m_luuthong",OracleType.NVarChar,50).Value=m_luuthong;
					cmd.Parameters.Add("m_loai",OracleType.NVarChar,50).Value=m_loai;
					cmd.Parameters.Add("m_khidung",OracleType.NVarChar,50).Value=m_khidung;
					cmd.Parameters.Add("m_vetthuong",OracleType.NVarChar,254).Value=m_vetthuong;
					cmd.Parameters.Add("m_thaybang",OracleType.Number).Value=m_thaybang;
					cmd.Parameters.Add("m_ngoaibien",OracleType.Number).Value=m_ngoaibien;
					cmd.Parameters.Add("m_ngoaibien_vt",OracleType.NVarChar,50).Value=m_ngoaibien_vt;
					cmd.Parameters.Add("m_trungtam",OracleType.Number).Value=m_trungtam;
					cmd.Parameters.Add("m_trungtam_vt",OracleType.NVarChar,50).Value=m_trungtam_vt;
					cmd.Parameters.Add("m_thongtieu",OracleType.Number).Value=m_thongtieu;
					cmd.Parameters.Add("m_thongtieu_vt",OracleType.NVarChar,50).Value=m_thongtieu_vt;
					cmd.Parameters.Add("m_vanmach",OracleType.NVarChar,254).Value=m_vanmach;
					cmd.Parameters.Add("m_khangdong",OracleType.NVarChar,254).Value=m_khangdong;
					cmd.Parameters.Add("m_anthan",OracleType.NVarChar,254).Value=m_anthan;
					cmd.Parameters.Add("m_dichtruyen",OracleType.NVarChar,254).Value=m_dichtruyen;
					cmd.Parameters.Add("m_mau",OracleType.NVarChar,254).Value=m_mau;
					cmd.Parameters.Add("m_khac",OracleType.NVarChar,254).Value=m_khac;
					cmd.Parameters.Add("m_bangiaokhac",OracleType.NVarChar,500).Value=m_bangiaokhac;
					cmd.Parameters.Add("m_yta",OracleType.VarChar,4).Value=m_yta;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_chuyenbenh");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_chuyenbenhct(string m_ngay,long m_id,decimal m_stt,string m_ten,string m_vitri)
		{
			string xxx = user + mmyy(m_ngay);
			sql="update "+xxx+".ba_chuyenbenhct set ten=:m_ten,vitri=:m_vitri where id=:m_id and stt=:m_stt";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_ten",OracleType.NVarChar,254).Value=m_ten;
				cmd.Parameters.Add("m_vitri",OracleType.NVarChar,50).Value=m_vitri;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_chuyenbenhct (id,stt,ten,vitri) values (:m_id,:m_stt,:m_ten,:m_vitri)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
					cmd.Parameters.Add("m_ten",OracleType.NVarChar,254).Value=m_ten;
					cmd.Parameters.Add("m_vitri",OracleType.NVarChar,50).Value=m_vitri;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_chuyenbenhct");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_giaonhan(long m_id,long m_idthuchien,string m_ngay,string m_trigiac,decimal m_mach,decimal m_nhietdo,string m_huyetap,decimal m_nhiptho,decimal m_cannang,decimal m_spo2,string m_camtay,string m_yta,int m_userid)
		{
			string xxx = user + mmyy(m_ngay);
			sql="update "+xxx+".ba_giaonhan set idthuchien=:m_idthuchien,ngay=to_date(:m_ngay,'dd/mm/yyyy hh24:mi'),trigiac=:m_trigiac,mach=:m_mach,nhietdo=:m_nhietdo,huyetap=:m_huyetap,nhiptho=:m_nhiptho,cannang=:m_cannang,spo2=:m_spo2,camtay=:m_camtay,yta=:m_yta,userid=:m_userid where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_idthuchien",OracleType.Number).Value=m_idthuchien;
				cmd.Parameters.Add("m_ngay",OracleType.VarChar,16).Value=m_ngay;
				cmd.Parameters.Add("m_trigiac",OracleType.NVarChar,100).Value=m_trigiac;
				cmd.Parameters.Add("m_mach",OracleType.Number).Value=m_mach;
				cmd.Parameters.Add("m_nhietdo",OracleType.Number).Value=m_nhietdo;
				cmd.Parameters.Add("m_huyetap",OracleType.VarChar,7).Value=m_huyetap;
				cmd.Parameters.Add("m_nhiptho",OracleType.Number).Value=m_nhiptho;
				cmd.Parameters.Add("m_cannang",OracleType.Number).Value=m_cannang;
				cmd.Parameters.Add("m_spo2",OracleType.Number).Value=m_spo2;
				cmd.Parameters.Add("m_camtay",OracleType.NVarChar,500).Value=m_camtay;
				cmd.Parameters.Add("m_yta",OracleType.VarChar,4).Value=m_yta;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_giaonhan (id,idthuchien,ngay,trigiac,mach,nhietdo,huyetap,nhiptho,cannang,spo2,camtay,yta,userid) values (:m_id,:m_idthuchien,to_date(:m_ngay,'dd/mm/yyyy hh24:mi'),:m_trigiac,:m_mach,:m_nhietdo,:m_huyetap,:m_nhiptho,:m_cannang,:m_spo2,:m_camtay,:m_yta,:m_userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_idthuchien",OracleType.Number).Value=m_idthuchien;
					cmd.Parameters.Add("m_ngay",OracleType.VarChar,16).Value=m_ngay;
					cmd.Parameters.Add("m_trigiac",OracleType.NVarChar,100).Value=m_trigiac;
					cmd.Parameters.Add("m_mach",OracleType.Number).Value=m_mach;
					cmd.Parameters.Add("m_nhietdo",OracleType.Number).Value=m_nhietdo;
					cmd.Parameters.Add("m_huyetap",OracleType.VarChar,7).Value=m_huyetap;
					cmd.Parameters.Add("m_nhiptho",OracleType.Number).Value=m_nhiptho;
					cmd.Parameters.Add("m_cannang",OracleType.Number).Value=m_cannang;
					cmd.Parameters.Add("m_spo2",OracleType.Number).Value=m_spo2;
					cmd.Parameters.Add("m_camtay",OracleType.NVarChar,500).Value=m_camtay;
					cmd.Parameters.Add("m_yta",OracleType.VarChar,4).Value=m_yta;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_giaonhan");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_giaonhanct(string m_ngay,long m_id,decimal m_stt,decimal m_soluong,string m_loai)
		{
			string xxx = user + mmyy(m_ngay);
			sql="update "+xxx+".ba_giaonhanct set soluong=:m_soluong,loai=:m_loai where id=:m_id and stt=:m_stt";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_soluong",OracleType.Number).Value=m_soluong;
				cmd.Parameters.Add("m_loai",OracleType.NVarChar,254).Value=m_loai;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_giaonhanct (id,stt,soluong,loai) values (:m_id,:m_stt,:m_soluong,:m_loai)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
					cmd.Parameters.Add("m_soluong",OracleType.Number).Value=m_soluong;
					cmd.Parameters.Add("m_loai",OracleType.NVarChar,254).Value=m_loai;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_giaonhanct");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_scan(string m_ngayvv,long m_id,int m_stt,string m_ngay,int m_nhom,int m_loai,string m_ten,byte[] m_image)
		{
			string xxx = user + mmyy(m_ngayvv);
			sql="update "+xxx+".ba_scan set ngay=to_date(:m_ngay,'dd/mm/yyyy hh24:mi'),nhom=:m_nhom,loai=:m_loai,ten=:m_ten,image=:m_image where id=:m_id and stt=:m_stt";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_ngay",OracleType.VarChar,16).Value=m_ngay;
				cmd.Parameters.Add("m_nhom",OracleType.Number).Value=m_nhom;
				cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
				cmd.Parameters.Add("m_ten",OracleType.NVarChar,254).Value=m_ten;
				cmd.Parameters.Add("m_image",OracleType.Blob,m_image.Length).Value=m_image;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_scan (id,stt,ngay,nhom,loai,ten,image) values (:m_id,:m_stt,to_date(:m_ngay,'dd/mm/yyyy hh24:mi'),:m_nhom,:m_loai,:m_ten,:m_image)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
					cmd.Parameters.Add("m_ngay",OracleType.VarChar,16).Value=m_ngay;
					cmd.Parameters.Add("m_nhom",OracleType.Number).Value=m_nhom;
					cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
					cmd.Parameters.Add("m_ten",OracleType.NVarChar,254).Value=m_ten;
					cmd.Parameters.Add("m_image",OracleType.Blob,m_image.Length).Value=m_image;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_scan");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_loaiphieu(long m_id,long m_stt,string m_report,string m_ten,string m_noidung,string m_ketqua,int m_thuchien,int m_tinhtrang,int m_lanthu,string m_hen,int m_cannang,int m_chieucao)
		{
			sql="update ba_loaiphieu set stt=:m_stt,report=:m_report,ten=:m_ten,noidung=:m_noidung,ketqua=:m_ketqua,";
			sql+="thuchien=:m_thuchien,tinhtrang=:m_tinhtrang,lanthu=:m_lanthu,hen=:m_hen,cannang=:m_cannang,chieucao=:m_chieucao";
			sql+=" where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
				cmd.Parameters.Add("m_report",OracleType.VarChar,30).Value=m_report;
				cmd.Parameters.Add("m_ten",OracleType.NVarChar,254).Value=m_ten;
				cmd.Parameters.Add("m_noidung",OracleType.NVarChar,100).Value=m_noidung;
				cmd.Parameters.Add("m_ketqua",OracleType.NVarChar,100).Value=m_ketqua;
				cmd.Parameters.Add("m_thuchien",OracleType.Number).Value=m_thuchien;
				cmd.Parameters.Add("m_tinhtrang",OracleType.Number).Value=m_tinhtrang;
				cmd.Parameters.Add("m_lanthu",OracleType.Number).Value=m_lanthu;
				cmd.Parameters.Add("m_hen",OracleType.NVarChar,100).Value=m_hen;
				cmd.Parameters.Add("m_cannang",OracleType.Number).Value=m_cannang;
				cmd.Parameters.Add("m_chieucao",OracleType.Number).Value=m_chieucao;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into ba_loaiphieu (id,stt,report,ten,noidung,ketqua,thuchien,tinhtrang,lanthu,hen,cannang,chieucao) values (:m_id,:m_stt,:m_report,:m_ten,:m_noidung,:m_ketqua,:m_thuchien,:m_tinhtrang,:m_lanthu,:m_hen,:m_cannang,:m_chieucao)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
					cmd.Parameters.Add("m_report",OracleType.VarChar,30).Value=m_report;
					cmd.Parameters.Add("m_ten",OracleType.NVarChar,254).Value=m_ten;
					cmd.Parameters.Add("m_noidung",OracleType.NVarChar,100).Value=m_noidung;
					cmd.Parameters.Add("m_ketqua",OracleType.NVarChar,100).Value=m_ketqua;
					cmd.Parameters.Add("m_thuchien",OracleType.Number).Value=m_thuchien;
					cmd.Parameters.Add("m_tinhtrang",OracleType.Number).Value=m_tinhtrang;
					cmd.Parameters.Add("m_lanthu",OracleType.Number).Value=m_lanthu;
					cmd.Parameters.Add("m_hen",OracleType.NVarChar,100).Value=m_hen;
					cmd.Parameters.Add("m_cannang",OracleType.Number).Value=m_cannang;
					cmd.Parameters.Add("m_chieucao",OracleType.Number).Value=m_chieucao;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_loaiphieu");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_soket(string m_ngayvv,long m_id,long m_idthuchien,string m_ngay,string m_dienbien,string m_cls,string m_dieutri,string m_ketqua,string m_tienluong,string m_bstruong,string m_mabs,int m_userid)
		{
			string xxx = user + mmyy(m_ngayvv);
			sql="update "+xxx+".ba_soket set idthuchien=:m_idthuchien,ngay=to_date(:m_ngay,'dd/mm/yyyy hh24:mi'),";
			sql+="dienbien=:m_dienbien,cls=:m_cls,dieutri=:m_dieutri,ketqua=:m_ketqua,tienluong=:m_tienluong,";
			sql+="bstruong=:m_bstruong,mabs=:m_mabs,userid=:m_userid where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_idthuchien",OracleType.Number).Value=m_idthuchien;
				cmd.Parameters.Add("m_ngay",OracleType.VarChar,16).Value=m_ngay;
				cmd.Parameters.Add("m_dienbien",OracleType.NVarChar,1000).Value=m_dienbien;
				cmd.Parameters.Add("m_cls",OracleType.NVarChar,1000).Value=m_cls;
				cmd.Parameters.Add("m_dieutri",OracleType.NVarChar,1000).Value=m_dieutri;
				cmd.Parameters.Add("m_ketqua",OracleType.NVarChar,1000).Value=m_ketqua;
				cmd.Parameters.Add("m_tienluong",OracleType.NVarChar,1000).Value=m_tienluong;
				cmd.Parameters.Add("m_bstruong",OracleType.VarChar,4).Value=m_bstruong;
				cmd.Parameters.Add("m_mabs",OracleType.VarChar,4).Value=m_mabs;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_soket (id,idthuchien,ngay,dienbien,cls,dieutri,ketqua,tienluong,bstruong,mabs,userid) values (:m_id,:m_idthuchien,to_date(:m_ngay,'dd/mm/yyyy hh24:mi'),:m_dienbien,:m_cls,:m_dieutri,:m_ketqua,:m_tienluong,:m_bstruong,:m_mabs,:m_userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_idthuchien",OracleType.Number).Value=m_idthuchien;
					cmd.Parameters.Add("m_ngay",OracleType.VarChar,16).Value=m_ngay;
					cmd.Parameters.Add("m_dienbien",OracleType.NVarChar,1000).Value=m_dienbien;
					cmd.Parameters.Add("m_cls",OracleType.NVarChar,1000).Value=m_cls;
					cmd.Parameters.Add("m_dieutri",OracleType.NVarChar,1000).Value=m_dieutri;
					cmd.Parameters.Add("m_ketqua",OracleType.NVarChar,1000).Value=m_ketqua;
					cmd.Parameters.Add("m_tienluong",OracleType.NVarChar,1000).Value=m_tienluong;
					cmd.Parameters.Add("m_bstruong",OracleType.VarChar,4).Value=m_bstruong;
					cmd.Parameters.Add("m_mabs",OracleType.VarChar,4).Value=m_mabs;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_soket");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_tiensusk(string m_ngayvv,long m_id,decimal m_stt,string m_nam,int m_duthieu,int m_sayhutnao,int m_covac,int m_ngoaitrung,int m_chetsong,decimal m_cannang,int m_ppde,int m_taibien)
		{
			string xxx = user + mmyy(m_ngayvv);
			sql="update "+xxx+".ba_tiensusk set nam=:m_nam,duthieu=:m_duthieu,sayhutnao=:m_sayhutnao,covac=:m_covac,";
			sql+="ngoaitrung=:m_ngoaitrung,chetsong=:m_chetsong,cannang=:m_cannang,ppde=:m_ppde,taibien=:m_taibien ";
			sql+=" where id=:m_id and stt=:m_stt";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_nam",OracleType.VarChar,4).Value=m_nam;
				cmd.Parameters.Add("m_duthieu",OracleType.Number).Value=m_duthieu;
				cmd.Parameters.Add("m_sayhutnao",OracleType.Number).Value=m_sayhutnao;
				cmd.Parameters.Add("m_covac",OracleType.Number).Value=m_covac;
				cmd.Parameters.Add("m_ngoaitrung",OracleType.Number).Value=m_ngoaitrung;
				cmd.Parameters.Add("m_chetsong",OracleType.Number).Value=m_chetsong;
				cmd.Parameters.Add("m_cannang",OracleType.Number).Value=m_cannang;
				cmd.Parameters.Add("m_ppde",OracleType.Number).Value=m_ppde;
				cmd.Parameters.Add("m_taibien",OracleType.Number).Value=m_taibien;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_tiensusk (id,stt,nam,duthieu,sayhutnao,covac,ngoaitrung,chetsong,cannang,ppde,taibien) values (:m_id,:m_stt,:m_nam,:m_duthieu,:m_sayhutnao,:m_covac,:m_ngoaitrung,:m_chetsong,:m_cannang,:m_ppde,:m_taibien)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
					cmd.Parameters.Add("m_nam",OracleType.VarChar,4).Value=m_nam;
					cmd.Parameters.Add("m_duthieu",OracleType.Number).Value=m_duthieu;
					cmd.Parameters.Add("m_sayhutnao",OracleType.Number).Value=m_sayhutnao;
					cmd.Parameters.Add("m_covac",OracleType.Number).Value=m_covac;
					cmd.Parameters.Add("m_ngoaitrung",OracleType.Number).Value=m_ngoaitrung;
					cmd.Parameters.Add("m_chetsong",OracleType.Number).Value=m_chetsong;
					cmd.Parameters.Add("m_cannang",OracleType.Number).Value=m_cannang;
					cmd.Parameters.Add("m_ppde",OracleType.Number).Value=m_ppde;
					cmd.Parameters.Add("m_taibien",OracleType.Number).Value=m_taibien;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_tiensk");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_sankhoa(string m_ngayvv,long m_id,string m_tungay,string m_denngay,decimal m_tuoithai,
			string m_khamthai,int m_uonvan,decimal m_tiem,string m_chuyenda,string m_dauhieu,string m_bienchuyen,
			string m_kinhnam,string m_tinhchat,int m_chuky,string m_luongkinh,string m_chongnam,string m_dieutri,
			int m_phu,int m_ptcu,string m_dangtc,string m_tuthe,decimal m_caotc,decimal m_vongbung,string m_cotc,
			decimal m_timthai,string m_vu,decimal m_bishop,string m_amho,string m_amdao,string m_sinhmon,
			string m_tucung,string m_phanphu,int m_tinhtrangoi,string m_voluc,int m_oivo,string m_mausac,
			string m_nuocoi,string m_ngoi,string m_the,string m_kieu,int m_dolot,string m_have,string m_deluc,
			string m_theodoi,string m_chucdanh,int m_rau,string m_rauluc,string m_cachso,string m_mang,string m_mui,string m_banhrau,
			decimal m_raucannang,int m_raucuon,decimal m_raudai,int m_chaymau,decimal m_maumat,int m_kiemsoattc,
			string m_xuly,string m_ngaysaude,string m_da,int m_ppde,decimal m_mach,decimal m_nhietdo,string m_huyetap,decimal m_nhiptho,
			string m_canthiep,int m_tangsinhmon,string m_loaichi,decimal m_somui,int m_cotucung,decimal m_cao)
		{
			string xxx = user + mmyy(m_ngayvv);
			sql="update "+xxx+".ba_sankhoa set tungay=to_date(:m_tungay,'dd/mm/yyyy'),denngay=to_date(:m_denngay,'dd/mm/yyyy'),";
			sql+="tuoithai=:m_tuoithai,khamthai=:m_khamthai,uonvan=:m_uonvan,tiem=:m_tiem,chuyenda=to_date(:m_chuyenda,'dd/mm/yyyy hh24:mi'),";
			sql+="dauhieu=:m_dauhieu,bienchuyen=:m_bienchuyen,kinhnam=:m_kinhnam,tinhchat=:m_tinhchat,chuky=:m_chuky,";
			sql+="luongkinh=:m_luongkinh,chongnam=:m_chongnam,dieutri=:m_dieutri,phu=:m_phu,ptcu=:m_ptcu,dangtc=:m_dangtc,";
			sql+="tuthe=:m_tuthe,caotc=:m_caotc,vongbung=:m_vongbung,cotc=:m_cotc,timthai=:m_timthai,vu=:m_vu,bishop=:m_bishop,";
			sql+="amho=:m_amho,amdao=:m_amdao,sinhmon=:m_sinhmon,tucung=:m_tucung,phanphu=:m_phanphu,tinhtrangoi=:m_tinhtrangoi,";
			sql+="voluc=to_date(:m_voluc,'dd/mm/yyyy hh24:mi'),oivo=:m_oivo,mausac=:m_mausac,nuocoi=:m_nuocoi,ngoi=:m_ngoi,";
			sql+="the=:m_the,kieu=:m_kieu,dolot=:m_dolot,have=:m_have,deluc=to_date(:m_deluc,'dd/mm/yyyy hh24:mi'),";
			sql+="theodoi=:m_theodoi,chucdanh=:m_chucdanh,rau=:m_rau,rauluc=to_date(:m_rauluc,'dd/mm/yyyy hh24:mi'),";
			sql+="cachso=:m_cachso,mang=:m_mang,mui=:m_mui,banhrau=:m_banhrau,raucannang=:m_raucannang,raucuon=:m_raucuon,";
			sql+="raudai=:m_raudai,chaymau=:m_chaymau,maumat=:m_maumat,kiemsoattc=:m_kiemsoattc,xuly=:m_xuly,";
			sql+="ngaysaude=to_date(:m_ngaysaude,'dd/mm/yyyy hh24:mi'),da=:m_da,ppde=:m_ppde,mach=:m_mach,nhietdo=:m_nhietdo,huyetap=:m_huyetap,nhiptho=:m_nhiptho,";
			sql+="canthiep=:m_canthiep,tangsinhmon=:m_tangsinhmon,loaichi=:m_loaichi,somui=:m_somui,cotucung=:m_cotucung,cao=:m_cao ";
			sql+=" where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_tungay",OracleType.VarChar,16).Value=m_tungay.Trim();
				cmd.Parameters.Add("m_denngay",OracleType.VarChar,16).Value=m_denngay.Trim();
				cmd.Parameters.Add("m_tuoithai",OracleType.Number).Value=m_tuoithai;
				cmd.Parameters.Add("m_khamthai",OracleType.NVarChar,254).Value=m_khamthai;
				cmd.Parameters.Add("m_uonvan",OracleType.Number).Value=m_uonvan;
				cmd.Parameters.Add("m_tiem",OracleType.Number).Value=m_tiem;
				cmd.Parameters.Add("m_chuyenda",OracleType.VarChar,16).Value=m_chuyenda.Trim();
				cmd.Parameters.Add("m_dauhieu",OracleType.NVarChar,254).Value=m_dauhieu;
				cmd.Parameters.Add("m_bienchuyen",OracleType.NVarChar,254).Value=m_bienchuyen;
				cmd.Parameters.Add("m_kinhnam",OracleType.VarChar,4).Value=m_kinhnam;
				cmd.Parameters.Add("m_tinhchat",OracleType.NVarChar,50).Value=m_tinhchat;
				cmd.Parameters.Add("m_chuky",OracleType.Number).Value=m_chuky;
				cmd.Parameters.Add("m_luongkinh",OracleType.NVarChar,50).Value=m_luongkinh;
				cmd.Parameters.Add("m_chongnam",OracleType.VarChar,4).Value=m_chongnam;
				cmd.Parameters.Add("m_dieutri",OracleType.NVarChar,254).Value=m_dieutri;
				cmd.Parameters.Add("m_phu",OracleType.Number).Value=m_phu;
				cmd.Parameters.Add("m_ptcu",OracleType.Number).Value=m_ptcu;
				cmd.Parameters.Add("m_dangtc",OracleType.NVarChar,50).Value=m_dangtc;
				cmd.Parameters.Add("m_tuthe",OracleType.NVarChar,50).Value=m_tuthe;
				cmd.Parameters.Add("m_caotc",OracleType.Number).Value=m_caotc;
				cmd.Parameters.Add("m_vongbung",OracleType.Number).Value=m_vongbung;
				cmd.Parameters.Add("m_cotc",OracleType.NVarChar,50).Value=m_cotc;
				cmd.Parameters.Add("m_timthai",OracleType.Number).Value=m_timthai;
				cmd.Parameters.Add("m_vu",OracleType.NVarChar,50).Value=m_vu;
				cmd.Parameters.Add("m_bishop",OracleType.Number).Value=m_bishop;
				cmd.Parameters.Add("m_amho",OracleType.NVarChar,50).Value=m_amho;
				cmd.Parameters.Add("m_amdao",OracleType.NVarChar,50).Value=m_amdao;
				cmd.Parameters.Add("m_sinhmon",OracleType.NVarChar,50).Value=m_sinhmon;
				cmd.Parameters.Add("m_tucung",OracleType.NVarChar,50).Value=m_tucung;
				cmd.Parameters.Add("m_phanphu",OracleType.NVarChar,50).Value=m_phanphu;
				cmd.Parameters.Add("m_tinhtrangoi",OracleType.Number).Value=m_tinhtrangoi;
				cmd.Parameters.Add("m_voluc",OracleType.VarChar,16).Value=m_voluc.Trim();
				cmd.Parameters.Add("m_oivo",OracleType.Number).Value=m_oivo;
				cmd.Parameters.Add("m_mausac",OracleType.NVarChar,50).Value=m_mausac;
				cmd.Parameters.Add("m_nuocoi",OracleType.NVarChar,50).Value=m_nuocoi;
				cmd.Parameters.Add("m_ngoi",OracleType.NVarChar,50).Value=m_ngoi;
				cmd.Parameters.Add("m_the",OracleType.NVarChar,50).Value=m_the;
				cmd.Parameters.Add("m_kieu",OracleType.NVarChar,50).Value=m_kieu;
				cmd.Parameters.Add("m_dolot",OracleType.Number).Value=m_dolot;
				cmd.Parameters.Add("m_have",OracleType.NVarChar,50).Value=m_have;
				cmd.Parameters.Add("m_deluc",OracleType.VarChar,16).Value=m_deluc.Trim();
				cmd.Parameters.Add("m_theodoi",OracleType.VarChar,4).Value=m_theodoi;
				cmd.Parameters.Add("m_chucdanh",OracleType.NVarChar,50).Value=m_chucdanh;
				cmd.Parameters.Add("m_rau",OracleType.Number).Value=m_rau;
				cmd.Parameters.Add("m_rauluc",OracleType.VarChar,16).Value=m_rauluc.Trim();
				cmd.Parameters.Add("m_cachso",OracleType.NVarChar,100).Value=m_cachso;
				cmd.Parameters.Add("m_mang",OracleType.NVarChar,50).Value=m_mang;
				cmd.Parameters.Add("m_mui",OracleType.NVarChar,50).Value=m_mui;
				cmd.Parameters.Add("m_banhrau",OracleType.NVarChar,50).Value=m_banhrau;
				cmd.Parameters.Add("m_raucannang",OracleType.Number).Value=m_raucannang;
				cmd.Parameters.Add("m_raucuon",OracleType.Number).Value=m_raucuon;
				cmd.Parameters.Add("m_raudai",OracleType.Number).Value=m_raudai;
				cmd.Parameters.Add("m_chaymau",OracleType.Number).Value=m_chaymau;
				cmd.Parameters.Add("m_maumat",OracleType.Number).Value=m_maumat;
				cmd.Parameters.Add("m_kiemsoattc",OracleType.Number).Value=m_kiemsoattc;
				cmd.Parameters.Add("m_xuly",OracleType.NVarChar,254).Value=m_xuly;
				cmd.Parameters.Add("m_ngaysaude",OracleType.VarChar,16).Value=m_ngaysaude.Trim();
				cmd.Parameters.Add("m_da",OracleType.NVarChar,254).Value=m_da;
				cmd.Parameters.Add("m_ppde",OracleType.Number).Value=m_ppde;
				cmd.Parameters.Add("m_mach",OracleType.Number).Value=m_mach;
				cmd.Parameters.Add("m_nhietdo",OracleType.Number).Value=m_nhietdo;
				cmd.Parameters.Add("m_huyetap",OracleType.VarChar,7).Value=m_huyetap;
				cmd.Parameters.Add("m_nhiptho",OracleType.Number).Value=m_nhiptho;
				cmd.Parameters.Add("m_canthiep",OracleType.NVarChar,254).Value=m_canthiep;
				cmd.Parameters.Add("m_tangsinhmon",OracleType.Number).Value=m_tangsinhmon;
				cmd.Parameters.Add("m_loaichi",OracleType.NVarChar,50).Value=m_loaichi;
				cmd.Parameters.Add("m_somui",OracleType.Number).Value=m_somui;
				cmd.Parameters.Add("m_cotucung",OracleType.Number).Value=m_cotucung;
				cmd.Parameters.Add("m_cao",OracleType.Number).Value=m_cao;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_sankhoa (id,tungay,denngay,tuoithai,khamthai,uonvan,tiem,chuyenda,dauhieu,bienchuyen,kinhnam,tinhchat,chuky,luongkinh,chongnam,dieutri,phu,ptcu,dangtc,tuthe,caotc,vongbung,cotc,timthai,vu,bishop,amho,amdao,sinhmon,tucung,phanphu,tinhtrangoi,voluc,oivo,mausac,nuocoi,ngoi,the,kieu,dolot,have,deluc,theodoi,chucdanh,rau,rauluc,cachso,mang,mui,banhrau,raucannang,raucuon,raudai,chaymau,maumat,kiemsoattc,xuly,ngaysaude,da,ppde,mach,nhietdo,huyetap,nhiptho,canthiep,tangsinhmon,loaichi,somui,cotucung,cao) values ";
					sql+="(:m_id,to_date(:m_tungay,'dd/mm/yyyy hh24:mi'),to_date(:m_denngay,'dd/mm/yyyy hh24:mi'),:m_tuoithai,:m_khamthai,:m_uonvan,:m_tiem,to_date(:m_chuyenda,'dd/mm/yyyy hh24:mi'),:m_dauhieu,:m_bienchuyen,:m_kinhnam,:m_tinhchat,:m_chuky,:m_luongkinh,:m_chongnam,:m_dieutri,:m_phu,:m_ptcu,:m_dangtc,:m_tuthe,:m_caotc,:m_vongbung,:m_cotc,:m_timthai,:m_vu,:m_bishop,:m_amho,:m_amdao,:m_sinhmon,:m_tucung,:m_phanphu,:m_tinhtrangoi,to_date(:m_voluc,'dd/mm/yyyy hh24:mi'),:m_oivo,:m_mausac,:m_nuocoi,:m_ngoi,:m_the,:m_kieu,:m_dolot,:m_have,to_date(:m_deluc,'dd/mm/yyyy hh24:mi'),:m_theodoi,:m_chucdanh,:m_rau,to_date(:m_rauluc,'dd/mm/yyyy hh24:mi'),:m_cachso,:m_mang,:m_mui,:m_banhrau,:m_raucannang,:m_raucuon,:m_raudai,:m_chaymau,:m_maumat,:m_kiemsoattc,:m_xuly,to_date(:m_ngaysaude,'dd/mm/yyyy hh24:mi'),:m_da,:m_ppde,:m_mach,:m_nhietdo,:m_huyetap,:m_nhiptho,:m_canthiep,:m_tangsinhmon,:m_loaichi,:m_somui,:m_cotucung,:m_cao)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_tungay",OracleType.VarChar,16).Value=m_tungay.Trim();
					cmd.Parameters.Add("m_denngay",OracleType.VarChar,16).Value=m_denngay.Trim();
					cmd.Parameters.Add("m_tuoithai",OracleType.Number).Value=m_tuoithai;
					cmd.Parameters.Add("m_khamthai",OracleType.NVarChar,254).Value=m_khamthai;
					cmd.Parameters.Add("m_uonvan",OracleType.Number).Value=m_uonvan;
					cmd.Parameters.Add("m_tiem",OracleType.Number).Value=m_tiem;
					cmd.Parameters.Add("m_chuyenda",OracleType.VarChar,16).Value=m_chuyenda.Trim();
					cmd.Parameters.Add("m_dauhieu",OracleType.NVarChar,254).Value=m_dauhieu;
					cmd.Parameters.Add("m_bienchuyen",OracleType.NVarChar,254).Value=m_bienchuyen;
					cmd.Parameters.Add("m_kinhnam",OracleType.VarChar,4).Value=m_kinhnam;
					cmd.Parameters.Add("m_tinhchat",OracleType.NVarChar,50).Value=m_tinhchat;
					cmd.Parameters.Add("m_chuky",OracleType.Number).Value=m_chuky;
					cmd.Parameters.Add("m_luongkinh",OracleType.NVarChar,50).Value=m_luongkinh;
					cmd.Parameters.Add("m_chongnam",OracleType.VarChar,4).Value=m_chongnam;
					cmd.Parameters.Add("m_dieutri",OracleType.NVarChar,254).Value=m_dieutri;
					cmd.Parameters.Add("m_phu",OracleType.Number).Value=m_phu;
					cmd.Parameters.Add("m_ptcu",OracleType.Number).Value=m_ptcu;
					cmd.Parameters.Add("m_dangtc",OracleType.NVarChar,50).Value=m_dangtc;
					cmd.Parameters.Add("m_tuthe",OracleType.NVarChar,50).Value=m_tuthe;
					cmd.Parameters.Add("m_caotc",OracleType.Number).Value=m_caotc;
					cmd.Parameters.Add("m_vongbung",OracleType.Number).Value=m_vongbung;
					cmd.Parameters.Add("m_cotc",OracleType.NVarChar,50).Value=m_cotc;
					cmd.Parameters.Add("m_timthai",OracleType.Number).Value=m_timthai;
					cmd.Parameters.Add("m_vu",OracleType.NVarChar,50).Value=m_vu;
					cmd.Parameters.Add("m_bishop",OracleType.Number).Value=m_bishop;
					cmd.Parameters.Add("m_amho",OracleType.NVarChar,50).Value=m_amho;
					cmd.Parameters.Add("m_amdao",OracleType.NVarChar,50).Value=m_amdao;
					cmd.Parameters.Add("m_sinhmon",OracleType.NVarChar,50).Value=m_sinhmon;
					cmd.Parameters.Add("m_tucung",OracleType.NVarChar,50).Value=m_tucung;
					cmd.Parameters.Add("m_phanphu",OracleType.NVarChar,50).Value=m_phanphu;
					cmd.Parameters.Add("m_tinhtrangoi",OracleType.Number).Value=m_tinhtrangoi;
					cmd.Parameters.Add("m_voluc",OracleType.VarChar,16).Value=m_voluc.Trim();
					cmd.Parameters.Add("m_oivo",OracleType.Number).Value=m_oivo;
					cmd.Parameters.Add("m_mausac",OracleType.NVarChar,50).Value=m_mausac;
					cmd.Parameters.Add("m_nuocoi",OracleType.NVarChar,50).Value=m_nuocoi;
					cmd.Parameters.Add("m_ngoi",OracleType.NVarChar,50).Value=m_ngoi;
					cmd.Parameters.Add("m_the",OracleType.NVarChar,50).Value=m_the;
					cmd.Parameters.Add("m_kieu",OracleType.NVarChar,50).Value=m_kieu;
					cmd.Parameters.Add("m_dolot",OracleType.Number).Value=m_dolot;
					cmd.Parameters.Add("m_have",OracleType.NVarChar,50).Value=m_have;
					cmd.Parameters.Add("m_deluc",OracleType.VarChar,16).Value=m_deluc.Trim();
					cmd.Parameters.Add("m_theodoi",OracleType.VarChar,4).Value=m_theodoi;
					cmd.Parameters.Add("m_chucdanh",OracleType.NVarChar,50).Value=m_chucdanh;
					cmd.Parameters.Add("m_rau",OracleType.Number).Value=m_rau;
					cmd.Parameters.Add("m_rauluc",OracleType.VarChar,16).Value=m_rauluc.Trim();
					cmd.Parameters.Add("m_cachso",OracleType.NVarChar,100).Value=m_cachso;
					cmd.Parameters.Add("m_mang",OracleType.NVarChar,50).Value=m_mang;
					cmd.Parameters.Add("m_mui",OracleType.NVarChar,50).Value=m_mui;
					cmd.Parameters.Add("m_banhrau",OracleType.NVarChar,50).Value=m_banhrau;
					cmd.Parameters.Add("m_raucannang",OracleType.Number).Value=m_raucannang;
					cmd.Parameters.Add("m_raucuon",OracleType.Number).Value=m_raucuon;
					cmd.Parameters.Add("m_raudai",OracleType.Number).Value=m_raudai;
					cmd.Parameters.Add("m_chaymau",OracleType.Number).Value=m_chaymau;
					cmd.Parameters.Add("m_maumat",OracleType.Number).Value=m_maumat;
					cmd.Parameters.Add("m_kiemsoattc",OracleType.Number).Value=m_kiemsoattc;
					cmd.Parameters.Add("m_xuly",OracleType.NVarChar,254).Value=m_xuly;
					cmd.Parameters.Add("m_ngaysaude",OracleType.VarChar,16).Value=m_ngaysaude.Trim();
					cmd.Parameters.Add("m_da",OracleType.NVarChar,254).Value=m_da;
					cmd.Parameters.Add("m_ppde",OracleType.Number).Value=m_ppde;
					cmd.Parameters.Add("m_mach",OracleType.Number).Value=m_mach;
					cmd.Parameters.Add("m_nhietdo",OracleType.Number).Value=m_nhietdo;
					cmd.Parameters.Add("m_huyetap",OracleType.VarChar,7).Value=m_huyetap;
					cmd.Parameters.Add("m_nhiptho",OracleType.Number).Value=m_nhiptho;
					cmd.Parameters.Add("m_canthiep",OracleType.NVarChar,254).Value=m_canthiep;
					cmd.Parameters.Add("m_tangsinhmon",OracleType.Number).Value=m_tangsinhmon;
					cmd.Parameters.Add("m_loaichi",OracleType.NVarChar,50).Value=m_loaichi;
					cmd.Parameters.Add("m_somui",OracleType.Number).Value=m_somui;
					cmd.Parameters.Add("m_cotucung",OracleType.Number).Value=m_cotucung;
					cmd.Parameters.Add("m_cao",OracleType.Number).Value=m_cao;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_sankhoa");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}


		public bool upd_ba_sankhoa(string m_ngayvv,long m_id,decimal m_bishop,string m_amho,string m_amdao,string m_sinhmon,
			string m_tucung,string m_phanphu,int m_tinhtrangoi,string m_voluc,int m_oivo,string m_mausac,
			string m_nuocoi,string m_ngoi,string m_the,string m_kieu,int m_dolot,string m_have,string m_deluc,
			string m_theodoi,string m_chucdanh,int m_rau,string m_rauluc,string m_cachso,string m_mang,string m_mui,string m_banhrau,
			decimal m_raucannang,int m_raucuon,decimal m_raudai,int m_chaymau,decimal m_maumat,int m_kiemsoattc,
			string m_xuly,string m_ngaysaude,string m_da,int m_ppde,decimal m_mach,decimal m_nhietdo,string m_huyetap,decimal m_nhiptho,
			string m_canthiep,int m_tangsinhmon,string m_loaichi,decimal m_somui,int m_cotucung)
		{
			string xxx = user + mmyy(m_ngayvv);
			sql="update "+xxx+".ba_sankhoa set bishop=:m_bishop,";
			sql+="amho=:m_amho,amdao=:m_amdao,sinhmon=:m_sinhmon,tucung=:m_tucung,phanphu=:m_phanphu,tinhtrangoi=:m_tinhtrangoi,";
			sql+="voluc=to_date(:m_voluc,'dd/mm/yyyy hh24:mi'),oivo=:m_oivo,mausac=:m_mausac,nuocoi=:m_nuocoi,ngoi=:m_ngoi,";
			sql+="the=:m_the,kieu=:m_kieu,dolot=:m_dolot,have=:m_have,deluc=to_date(:m_deluc,'dd/mm/yyyy hh24:mi'),";
			sql+="theodoi=:m_theodoi,chucdanh=:m_chucdanh,rau=:m_rau,rauluc=to_date(:m_rauluc,'dd/mm/yyyy hh24:mi'),";
			sql+="cachso=:m_cachso,mang=:m_mang,mui=:m_mui,banhrau=:m_banhrau,raucannang=:m_raucannang,raucuon=:m_raucuon,";
			sql+="raudai=:m_raudai,chaymau=:m_chaymau,maumat=:m_maumat,kiemsoattc=:m_kiemsoattc,xuly=:m_xuly,";
			sql+="ngaysaude=to_date(:m_ngaysaude,'dd/mm/yyyy hh24:mi'),da=:m_da,ppde=:m_ppde,mach=:m_mach,nhietdo=:m_nhietdo,huyetap=:m_huyetap,nhiptho=:m_nhiptho,";
			sql+="canthiep=:m_canthiep,tangsinhmon=:m_tangsinhmon,loaichi=:m_loaichi,somui=:m_somui,cotucung=:m_cotucung ";
			sql+=" where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_bishop",OracleType.Number).Value=m_bishop;
				cmd.Parameters.Add("m_amho",OracleType.NVarChar,50).Value=m_amho;
				cmd.Parameters.Add("m_amdao",OracleType.NVarChar,50).Value=m_amdao;
				cmd.Parameters.Add("m_sinhmon",OracleType.NVarChar,50).Value=m_sinhmon;
				cmd.Parameters.Add("m_tucung",OracleType.NVarChar,50).Value=m_tucung;
				cmd.Parameters.Add("m_phanphu",OracleType.NVarChar,50).Value=m_phanphu;
				cmd.Parameters.Add("m_tinhtrangoi",OracleType.Number).Value=m_tinhtrangoi;
				cmd.Parameters.Add("m_voluc",OracleType.VarChar,16).Value=m_voluc.Trim();
				cmd.Parameters.Add("m_oivo",OracleType.Number).Value=m_oivo;
				cmd.Parameters.Add("m_mausac",OracleType.NVarChar,50).Value=m_mausac;
				cmd.Parameters.Add("m_nuocoi",OracleType.NVarChar,50).Value=m_nuocoi;
				cmd.Parameters.Add("m_ngoi",OracleType.NVarChar,50).Value=m_ngoi;
				cmd.Parameters.Add("m_the",OracleType.NVarChar,50).Value=m_the;
				cmd.Parameters.Add("m_kieu",OracleType.NVarChar,50).Value=m_kieu;
				cmd.Parameters.Add("m_dolot",OracleType.Number).Value=m_dolot;
				cmd.Parameters.Add("m_have",OracleType.NVarChar,50).Value=m_have;
				cmd.Parameters.Add("m_deluc",OracleType.VarChar,16).Value=m_deluc.Trim();
				cmd.Parameters.Add("m_theodoi",OracleType.VarChar,4).Value=m_theodoi;
				cmd.Parameters.Add("m_chucdanh",OracleType.NVarChar,50).Value=m_chucdanh;
				cmd.Parameters.Add("m_rau",OracleType.Number).Value=m_rau;
				cmd.Parameters.Add("m_rauluc",OracleType.VarChar,16).Value=m_rauluc.Trim();
				cmd.Parameters.Add("m_cachso",OracleType.NVarChar,100).Value=m_cachso;
				cmd.Parameters.Add("m_mang",OracleType.NVarChar,50).Value=m_mang;
				cmd.Parameters.Add("m_mui",OracleType.NVarChar,50).Value=m_mui;
				cmd.Parameters.Add("m_banhrau",OracleType.NVarChar,50).Value=m_banhrau;
				cmd.Parameters.Add("m_raucannang",OracleType.Number).Value=m_raucannang;
				cmd.Parameters.Add("m_raucuon",OracleType.Number).Value=m_raucuon;
				cmd.Parameters.Add("m_raudai",OracleType.Number).Value=m_raudai;
				cmd.Parameters.Add("m_chaymau",OracleType.Number).Value=m_chaymau;
				cmd.Parameters.Add("m_maumat",OracleType.Number).Value=m_maumat;
				cmd.Parameters.Add("m_kiemsoattc",OracleType.Number).Value=m_kiemsoattc;
				cmd.Parameters.Add("m_xuly",OracleType.NVarChar,254).Value=m_xuly;
				cmd.Parameters.Add("m_ngaysaude",OracleType.VarChar,16).Value=m_ngaysaude.Trim();
				cmd.Parameters.Add("m_da",OracleType.NVarChar,254).Value=m_da;
				cmd.Parameters.Add("m_ppde",OracleType.Number).Value=m_ppde;
				cmd.Parameters.Add("m_mach",OracleType.Number).Value=m_mach;
				cmd.Parameters.Add("m_nhietdo",OracleType.Number).Value=m_nhietdo;
				cmd.Parameters.Add("m_huyetap",OracleType.VarChar,7).Value=m_huyetap;
				cmd.Parameters.Add("m_nhiptho",OracleType.Number).Value=m_nhiptho;
				cmd.Parameters.Add("m_canthiep",OracleType.NVarChar,254).Value=m_canthiep;
				cmd.Parameters.Add("m_tangsinhmon",OracleType.Number).Value=m_tangsinhmon;
				cmd.Parameters.Add("m_loaichi",OracleType.NVarChar,50).Value=m_loaichi;
				cmd.Parameters.Add("m_somui",OracleType.Number).Value=m_somui;
				cmd.Parameters.Add("m_cotucung",OracleType.Number).Value=m_cotucung;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.ExecuteNonQuery();
				cmd.Dispose();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_sankhoa");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}


		public bool upd_ba_dbchuyenda(long m_id,long m_idthuchien,string m_ngay,
			decimal m_mach,string m_huyetap,decimal m_nhietdo,decimal m_nhiptho,decimal m_timthai,string m_tucung,
			decimal m_mo,decimal m_xoa,int m_tinhtrangoi,string m_ngoithai,string m_dolot,string m_tienluong,
			string m_xutri,string m_theodoi,int m_userid)
		{
			string xxx = user + mmyy(m_ngay);
			sql="update "+xxx+".ba_dbchuyenda set idthuchien=:m_idthuchien,ngay=to_date(:m_ngay,'dd/mm/yyyy hh24:mi'),";
			sql+="mach=:m_mach,huyetap=:m_huyetap,nhietdo=:m_nhietdo,nhiptho=:m_nhiptho,timthai=:m_timthai,";
			sql+="tucung=:m_tucung,mo=:m_mo,xoa=:m_xoa,tinhtrangoi=:m_tinhtrangoi,ngoithai=:m_ngoithai,";
			sql+="dolot=:m_dolot,tienluong=:m_tienluong,xutri=:m_xutri,theodoi=:m_theodoi,userid=:m_userid ";
			sql+=" where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_idthuchien",OracleType.Number).Value=m_idthuchien;
				cmd.Parameters.Add("m_ngay",OracleType.VarChar,16).Value=m_ngay;
				cmd.Parameters.Add("m_mach",OracleType.Number).Value=m_mach;
				cmd.Parameters.Add("m_huyetap",OracleType.VarChar,7).Value=m_huyetap;
				cmd.Parameters.Add("m_nhietdo",OracleType.Number).Value=m_nhietdo;
				cmd.Parameters.Add("m_nhiptho",OracleType.Number).Value=m_nhiptho;
				cmd.Parameters.Add("m_timthai",OracleType.Number).Value=m_timthai;
				cmd.Parameters.Add("m_tucung",OracleType.NVarChar,50).Value=m_tucung;
				cmd.Parameters.Add("m_mo",OracleType.Number).Value=m_mo;
				cmd.Parameters.Add("m_xoa",OracleType.Number).Value=m_xoa;
				cmd.Parameters.Add("m_tinhtrangoi",OracleType.Number).Value=m_tinhtrangoi;
				cmd.Parameters.Add("m_ngoithai",OracleType.VarChar,10).Value=m_ngoithai;
				cmd.Parameters.Add("m_dolot",OracleType.NVarChar,50).Value=m_dolot;
				cmd.Parameters.Add("m_tienluong",OracleType.NVarChar,500).Value=m_tienluong;
				cmd.Parameters.Add("m_xutri",OracleType.NVarChar,500).Value=m_xutri;
				cmd.Parameters.Add("m_theodoi",OracleType.VarChar,4).Value=m_theodoi;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_dbchuyenda (id,idthuchien,ngay,mach,huyetap,nhietdo,nhiptho,timthai,tucung,mo,xoa,tinhtrangoi,ngoithai,dolot,tienluong,xutri,theodoi,userid) values (:m_id,:m_idthuchien,to_date(:m_ngay,'dd/mm/yyyy hh24:mi'),:m_mach,:m_huyetap,:m_nhietdo,:m_nhiptho,:m_timthai,:m_tucung,:m_mo,:m_xoa,:m_tinhtrangoi,:m_ngoithai,:m_dolot,:m_tienluong,:m_xutri,:m_theodoi,:m_userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_idthuchien",OracleType.Number).Value=m_idthuchien;
					cmd.Parameters.Add("m_ngay",OracleType.VarChar,16).Value=m_ngay;
					cmd.Parameters.Add("m_mach",OracleType.Number).Value=m_mach;
					cmd.Parameters.Add("m_huyetap",OracleType.VarChar,7).Value=m_huyetap;
					cmd.Parameters.Add("m_nhietdo",OracleType.Number).Value=m_nhietdo;
					cmd.Parameters.Add("m_nhiptho",OracleType.Number).Value=m_nhiptho;
					cmd.Parameters.Add("m_timthai",OracleType.Number).Value=m_timthai;
					cmd.Parameters.Add("m_tucung",OracleType.NVarChar,50).Value=m_tucung;
					cmd.Parameters.Add("m_mo",OracleType.Number).Value=m_mo;
					cmd.Parameters.Add("m_xoa",OracleType.Number).Value=m_xoa;
					cmd.Parameters.Add("m_tinhtrangoi",OracleType.Number).Value=m_tinhtrangoi;
					cmd.Parameters.Add("m_ngoithai",OracleType.VarChar,10).Value=m_ngoithai;
					cmd.Parameters.Add("m_dolot",OracleType.NVarChar,50).Value=m_dolot;
					cmd.Parameters.Add("m_tienluong",OracleType.NVarChar,500).Value=m_tienluong;
					cmd.Parameters.Add("m_xutri",OracleType.NVarChar,500).Value=m_xutri;
					cmd.Parameters.Add("m_theodoi",OracleType.VarChar,4).Value=m_theodoi;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_dbchuyenda");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_hausangan(long m_id,long m_idthuchien,string m_ngay,string m_toantrang,decimal m_mach,
			string m_huyetap,decimal m_nhietdo,decimal m_nhiptho,string m_tim,string m_phoi,string m_tucung,
			decimal m_maumat,string m_tresosinh,string m_nuoctieu,string m_tienluong,string m_xutri,string m_theodoi,
			int m_tangsinhmon,int m_tinhchat,string m_khac,int m_userid)
		{
			string xxx = user + mmyy(m_ngay);
			sql="update "+xxx+".ba_hausangan set idthuchien=:m_idthuchien,ngay=to_date(:m_ngay,'dd/mm/yyyy hh24:mi'),toantrang=:m_toantrang,";
			sql+="mach=:m_mach,huyetap=:m_huyetap,nhietdo=:m_nhietdo,nhiptho=:m_nhiptho,tim=:m_tim,phoi=:m_phoi,";
			sql+="tucung=:m_tucung,maumat=:m_maumat,tresosinh=:m_tresosinh,nuoctieu=:m_nuoctieu,tienluong=:m_tienluong,";
			sql+="xutri=:m_xutri,theodoi=:m_theodoi,tangsinhmon=:m_tangsinhmon,tinhchat=:m_tinhchat,khac=:m_khac,userid=:m_userid ";
			sql+=" where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_idthuchien",OracleType.Number).Value=m_idthuchien;
				cmd.Parameters.Add("m_ngay",OracleType.VarChar,16).Value=m_ngay;
				cmd.Parameters.Add("m_toantrang",OracleType.NVarChar,500).Value=m_toantrang;
				cmd.Parameters.Add("m_mach",OracleType.Number).Value=m_mach;
				cmd.Parameters.Add("m_huyetap",OracleType.VarChar,7).Value=m_huyetap;
				cmd.Parameters.Add("m_nhietdo",OracleType.Number).Value=m_nhietdo;
				cmd.Parameters.Add("m_nhiptho",OracleType.Number).Value=m_nhiptho;
				cmd.Parameters.Add("m_tim",OracleType.NVarChar,500).Value=m_tim;
				cmd.Parameters.Add("m_phoi",OracleType.NVarChar,500).Value=m_phoi;
				cmd.Parameters.Add("m_tucung",OracleType.NVarChar,50).Value=m_tucung;
				cmd.Parameters.Add("m_maumat",OracleType.Number).Value=m_maumat;
				cmd.Parameters.Add("m_tresosinh",OracleType.NVarChar,254).Value=m_tresosinh;
				cmd.Parameters.Add("m_nuoctieu",OracleType.NVarChar,254).Value=m_nuoctieu;
				cmd.Parameters.Add("m_tienluong",OracleType.NVarChar,500).Value=m_tienluong;
				cmd.Parameters.Add("m_xutri",OracleType.NVarChar,500).Value=m_xutri;
				cmd.Parameters.Add("m_theodoi",OracleType.VarChar,4).Value=m_theodoi;
				cmd.Parameters.Add("m_tangsinhmon",OracleType.Number).Value=m_tangsinhmon;
				cmd.Parameters.Add("m_tinhchat",OracleType.Number).Value=m_tinhchat;
				cmd.Parameters.Add("m_khac",OracleType.NVarChar,254).Value=m_khac;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_hausangan (id,idthuchien,ngay,toantrang,mach,huyetap,nhietdo,nhiptho,tim,phoi,tucung,maumat,tresosinh,nuoctieu,tienluong,xutri,theodoi,tangsinhmon,tinhchat,khac,userid) values (:m_id,:m_idthuchien,to_date(:m_ngay,'dd/mm/yyyy hh24:mi'),:m_toantrang,:m_mach,:m_huyetap,:m_nhietdo,:m_nhiptho,:m_tim,:m_phoi,:m_tucung,:m_maumat,:m_tresosinh,:m_nuoctieu,:m_tienluong,:m_xutri,:m_theodoi,:m_tangsinhmon,:m_tinhchat,:m_khac,:m_userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_idthuchien",OracleType.Number).Value=m_idthuchien;
					cmd.Parameters.Add("m_ngay",OracleType.VarChar,16).Value=m_ngay;
					cmd.Parameters.Add("m_toantrang",OracleType.NVarChar,500).Value=m_toantrang;
					cmd.Parameters.Add("m_mach",OracleType.Number).Value=m_mach;
					cmd.Parameters.Add("m_huyetap",OracleType.VarChar,7).Value=m_huyetap;
					cmd.Parameters.Add("m_nhietdo",OracleType.Number).Value=m_nhietdo;
					cmd.Parameters.Add("m_nhiptho",OracleType.Number).Value=m_nhiptho;
					cmd.Parameters.Add("m_tim",OracleType.NVarChar,500).Value=m_tim;
					cmd.Parameters.Add("m_phoi",OracleType.NVarChar,500).Value=m_phoi;
					cmd.Parameters.Add("m_tucung",OracleType.NVarChar,50).Value=m_tucung;
					cmd.Parameters.Add("m_maumat",OracleType.Number).Value=m_maumat;
					cmd.Parameters.Add("m_tresosinh",OracleType.NVarChar,254).Value=m_tresosinh;
					cmd.Parameters.Add("m_nuoctieu",OracleType.NVarChar,254).Value=m_nuoctieu;
					cmd.Parameters.Add("m_tienluong",OracleType.NVarChar,500).Value=m_tienluong;
					cmd.Parameters.Add("m_xutri",OracleType.NVarChar,500).Value=m_xutri;
					cmd.Parameters.Add("m_theodoi",OracleType.VarChar,4).Value=m_theodoi;
					cmd.Parameters.Add("m_tangsinhmon",OracleType.Number).Value=m_tangsinhmon;
					cmd.Parameters.Add("m_tinhchat",OracleType.Number).Value=m_tinhchat;
					cmd.Parameters.Add("m_khac",OracleType.NVarChar,254).Value=m_khac;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_hausangan");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_hausan(long m_id,long m_idthuchien,string m_ngay,string m_toantrang,decimal m_mach,
			string m_huyetap,decimal m_nhietdo,decimal m_nhiptho,string m_tim,string m_phoi,string m_tucung,
			string m_tresosinh,string m_tienluong,string m_xutri,string m_theodoi,
			int m_tangsinhmon,int m_tinhchat,string m_khac,int m_ditieu,string m_tc_ditieu,int m_tieu,string m_tc_tieu,
			int m_sandich,int m_tc_sandich,int m_userid)
		{
			string xxx = user + mmyy(m_ngay);
			sql="update "+xxx+".ba_hausan set idthuchien=:m_idthuchien,ngay=to_date(:m_ngay,'dd/mm/yyyy hh24:mi'),toantrang=:m_toantrang,";
			sql+="mach=:m_mach,huyetap=:m_huyetap,nhietdo=:m_nhietdo,nhiptho=:m_nhiptho,tim=:m_tim,phoi=:m_phoi,";
			sql+="tucung=:m_tucung,tresosinh=:m_tresosinh,tienluong=:m_tienluong,xutri=:m_xutri,theodoi=:m_theodoi,";
			sql+="tangsinhmon=:m_tangsinhmon,tinhchat=:m_tinhchat,khac=:m_khac,ditieu=:m_ditieu,tc_ditieu=:m_tc_ditieu,";
			sql+="tieu=:m_tieu,tc_tieu=:m_tc_tieu,sandich=:m_sandich,tc_sandich=:m_tc_sandich,userid=:m_userid ";
			sql+=" where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_idthuchien",OracleType.Number).Value=m_idthuchien;
				cmd.Parameters.Add("m_ngay",OracleType.VarChar,16).Value=m_ngay;
				cmd.Parameters.Add("m_toantrang",OracleType.NVarChar,500).Value=m_toantrang;
				cmd.Parameters.Add("m_mach",OracleType.Number).Value=m_mach;
				cmd.Parameters.Add("m_huyetap",OracleType.VarChar,7).Value=m_huyetap;
				cmd.Parameters.Add("m_nhietdo",OracleType.Number).Value=m_nhietdo;
				cmd.Parameters.Add("m_nhiptho",OracleType.Number).Value=m_nhiptho;
				cmd.Parameters.Add("m_tim",OracleType.NVarChar,500).Value=m_tim;
				cmd.Parameters.Add("m_phoi",OracleType.NVarChar,500).Value=m_phoi;
				cmd.Parameters.Add("m_tucung",OracleType.NVarChar,50).Value=m_tucung;
				cmd.Parameters.Add("m_tresosinh",OracleType.NVarChar,254).Value=m_tresosinh;
				cmd.Parameters.Add("m_tienluong",OracleType.NVarChar,500).Value=m_tienluong;
				cmd.Parameters.Add("m_xutri",OracleType.NVarChar,500).Value=m_xutri;
				cmd.Parameters.Add("m_theodoi",OracleType.VarChar,4).Value=m_theodoi;
				cmd.Parameters.Add("m_tangsinhmon",OracleType.Number).Value=m_tangsinhmon;
				cmd.Parameters.Add("m_tinhchat",OracleType.Number).Value=m_tinhchat;
				cmd.Parameters.Add("m_khac",OracleType.NVarChar,254).Value=m_khac;
				cmd.Parameters.Add("m_ditieu",OracleType.Number).Value=m_ditieu;
				cmd.Parameters.Add("m_tc_ditieu",OracleType.NVarChar,254).Value=m_tc_ditieu;
				cmd.Parameters.Add("m_tieu",OracleType.Number).Value=m_tieu;
				cmd.Parameters.Add("m_tc_tieu",OracleType.NVarChar,254).Value=m_tc_tieu;
				cmd.Parameters.Add("m_sandich",OracleType.Number).Value=m_sandich;
				cmd.Parameters.Add("m_tc_sandich",OracleType.Number).Value=m_tc_sandich;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_hausan (id,idthuchien,ngay,toantrang,mach,huyetap,nhietdo,nhiptho,tim,phoi,tucung,tresosinh,tienluong,xutri,theodoi,tangsinhmon,tinhchat,khac,ditieu,tc_ditieu,tieu,tc_tieu,sandich,tc_sandich,userid) values (:m_id,:m_idthuchien,to_date(:m_ngay,'dd/mm/yyyy hh24:mi'),:m_toantrang,:m_mach,:m_huyetap,:m_nhietdo,:m_nhiptho,:m_tim,:m_phoi,:m_tucung,:m_tresosinh,:m_tienluong,:m_xutri,:m_theodoi,:m_tangsinhmon,:m_tinhchat,:m_khac,:m_ditieu,:m_tc_ditieu,:m_tieu,:m_tc_tieu,:m_sandich,:m_tc_sandich,:m_userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_idthuchien",OracleType.Number).Value=m_idthuchien;
					cmd.Parameters.Add("m_ngay",OracleType.VarChar,16).Value=m_ngay;
					cmd.Parameters.Add("m_toantrang",OracleType.NVarChar,500).Value=m_toantrang;
					cmd.Parameters.Add("m_mach",OracleType.Number).Value=m_mach;
					cmd.Parameters.Add("m_huyetap",OracleType.VarChar,7).Value=m_huyetap;
					cmd.Parameters.Add("m_nhietdo",OracleType.Number).Value=m_nhietdo;
					cmd.Parameters.Add("m_nhiptho",OracleType.Number).Value=m_nhiptho;
					cmd.Parameters.Add("m_tim",OracleType.NVarChar,500).Value=m_tim;
					cmd.Parameters.Add("m_phoi",OracleType.NVarChar,500).Value=m_phoi;
					cmd.Parameters.Add("m_tucung",OracleType.NVarChar,50).Value=m_tucung;
					cmd.Parameters.Add("m_tresosinh",OracleType.NVarChar,254).Value=m_tresosinh;
					cmd.Parameters.Add("m_tienluong",OracleType.NVarChar,500).Value=m_tienluong;
					cmd.Parameters.Add("m_xutri",OracleType.NVarChar,500).Value=m_xutri;
					cmd.Parameters.Add("m_theodoi",OracleType.VarChar,4).Value=m_theodoi;
					cmd.Parameters.Add("m_tangsinhmon",OracleType.Number).Value=m_tangsinhmon;
					cmd.Parameters.Add("m_tinhchat",OracleType.Number).Value=m_tinhchat;
					cmd.Parameters.Add("m_khac",OracleType.NVarChar,254).Value=m_khac;
					cmd.Parameters.Add("m_ditieu",OracleType.Number).Value=m_ditieu;
					cmd.Parameters.Add("m_tc_ditieu",OracleType.NVarChar,254).Value=m_tc_ditieu;
					cmd.Parameters.Add("m_tieu",OracleType.Number).Value=m_tieu;
					cmd.Parameters.Add("m_tc_tieu",OracleType.NVarChar,254).Value=m_tc_tieu;
					cmd.Parameters.Add("m_sandich",OracleType.Number).Value=m_sandich;
					cmd.Parameters.Add("m_tc_sandich",OracleType.Number).Value=m_tc_sandich;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_hausan");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_phukhoa(string m_ngayvv,long m_id,string m_kinhnam,string m_tinhchat,string m_chuky,
			decimal m_songay,string m_luongkinh,string m_kinhcc,int m_daubung,int m_thoigian,string m_chongnam,
			string m_hetkinh,string m_dieutri,string m_para,string m_da,string m_hach,string m_vu,string m_dauhieu,
			string m_moilon,string m_moinho,string m_amvat,string m_amho,string m_mangtrinh,string m_tangsinhmon,
			string m_amdao,string m_cotucung,string m_thantucung,string m_phanphu,string m_cactui)
		{
			string xxx = user + mmyy(m_ngayvv);
			sql="update "+xxx+".ba_phukhoa set kinhnam=:m_kinhnam,tinhchat=:m_tinhchat,chuky=:m_chuky,songay=:m_songay,";
			sql+="luongkinh=:m_luongkinh,kinhcc=to_date(:m_kinhcc,'dd/mm/yyyy'),daubung=:m_daubung,thoigian=:m_thoigian,";
			sql+="chongnam=:m_chongnam,hetkinh=:m_hetkinh,dieutri=:m_dieutri,para=:m_para,da=:m_da,hach=:m_hach,";
			sql+="vu=:m_vu,dauhieu=:m_dauhieu,moilon=:m_moilon,moinho=:m_moinho,amvat=:m_amvat,amho=:m_amho,";
			sql+="mangtrinh=:m_mangtrinh,tangsinhmon=:m_tangsinhmon,amdao=:m_amdao,cotucung=:m_cotucung,";
			sql+="thantucung=:m_thantucung,phanphu=:m_phanphu,cactui=:m_cactui ";
			sql+=" where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_kinhnam",OracleType.VarChar,4).Value=m_kinhnam;
				cmd.Parameters.Add("m_tinhchat",OracleType.NVarChar,50).Value=m_tinhchat;
				cmd.Parameters.Add("m_chuky",OracleType.VarChar,20).Value=m_chuky;
				cmd.Parameters.Add("m_songay",OracleType.Number).Value=m_songay;
				cmd.Parameters.Add("m_luongkinh",OracleType.NVarChar,50).Value=m_luongkinh;
				cmd.Parameters.Add("m_kinhcc",OracleType.VarChar,10).Value=m_kinhcc;
				cmd.Parameters.Add("m_daubung",OracleType.Number).Value=m_daubung;
				cmd.Parameters.Add("m_thoigian",OracleType.Number).Value=m_thoigian;
				cmd.Parameters.Add("m_chongnam",OracleType.VarChar,4).Value=m_chongnam;
				cmd.Parameters.Add("m_hetkinh",OracleType.VarChar,4).Value=m_hetkinh;
				cmd.Parameters.Add("m_dieutri",OracleType.NVarChar,254).Value=m_dieutri;
				cmd.Parameters.Add("m_para",OracleType.VarChar,8).Value=m_para;
				cmd.Parameters.Add("m_da",OracleType.NVarChar,254).Value=m_da;
				cmd.Parameters.Add("m_hach",OracleType.NVarChar,254).Value=m_hach;
				cmd.Parameters.Add("m_vu",OracleType.NVarChar,254).Value=m_vu;
				cmd.Parameters.Add("m_dauhieu",OracleType.NVarChar,254).Value=m_dauhieu;
				cmd.Parameters.Add("m_moilon",OracleType.NVarChar,254).Value=m_moilon;
				cmd.Parameters.Add("m_moinho",OracleType.NVarChar,254).Value=m_moinho;
				cmd.Parameters.Add("m_amvat",OracleType.NVarChar,254).Value=m_amvat;
				cmd.Parameters.Add("m_amho",OracleType.NVarChar,254).Value=m_amho;
				cmd.Parameters.Add("m_mangtrinh",OracleType.NVarChar,254).Value=m_mangtrinh;
				cmd.Parameters.Add("m_tangsinhmon",OracleType.NVarChar,254).Value=m_tangsinhmon;
				cmd.Parameters.Add("m_amdao",OracleType.NVarChar,254).Value=m_amdao;
				cmd.Parameters.Add("m_cotucung",OracleType.NVarChar,254).Value=m_cotucung;
				cmd.Parameters.Add("m_thantucung",OracleType.NVarChar,254).Value=m_thantucung;
				cmd.Parameters.Add("m_phanphu",OracleType.NVarChar,254).Value=m_phanphu;
				cmd.Parameters.Add("m_cactui",OracleType.NVarChar,254).Value=m_cactui;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;				
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_phukhoa (id,kinhnam,tinhchat,chuky,songay,luongkinh,kinhcc,daubung,thoigian,chongnam,hetkinh,dieutri,para,da,hach,vu,dauhieu,moilon,moinho,amvat,amho,mangtrinh,tangsinhmon,amdao,cotucung,thantucung,phanphu,cactui) values (:m_id,:m_kinhnam,:m_tinhchat,:m_chuky,:m_songay,:m_luongkinh,to_date(:m_kinhcc,'dd/mm/yyyy'),:m_daubung,:m_thoigian,:m_chongnam,:m_hetkinh,:m_dieutri,:m_para,:m_da,:m_hach,:m_vu,:m_dauhieu,:m_moilon,:m_moinho,:m_amvat,:m_amho,:m_mangtrinh,:m_tangsinhmon,:m_amdao,:m_cotucung,:m_thantucung,:m_phanphu,:m_cactui)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_kinhnam",OracleType.VarChar,4).Value=m_kinhnam;
					cmd.Parameters.Add("m_tinhchat",OracleType.NVarChar,50).Value=m_tinhchat;
					cmd.Parameters.Add("m_chuky",OracleType.VarChar,20).Value=m_chuky;
					cmd.Parameters.Add("m_songay",OracleType.Number).Value=m_songay;
					cmd.Parameters.Add("m_luongkinh",OracleType.NVarChar,50).Value=m_luongkinh;
					cmd.Parameters.Add("m_kinhcc",OracleType.VarChar,10).Value=m_kinhcc;
					cmd.Parameters.Add("m_daubung",OracleType.Number).Value=m_daubung;
					cmd.Parameters.Add("m_thoigian",OracleType.Number).Value=m_thoigian;
					cmd.Parameters.Add("m_chongnam",OracleType.VarChar,4).Value=m_chongnam;
					cmd.Parameters.Add("m_hetkinh",OracleType.VarChar,4).Value=m_hetkinh;
					cmd.Parameters.Add("m_dieutri",OracleType.NVarChar,254).Value=m_dieutri;
					cmd.Parameters.Add("m_para",OracleType.VarChar,8).Value=m_para;
					cmd.Parameters.Add("m_da",OracleType.NVarChar,254).Value=m_da;
					cmd.Parameters.Add("m_hach",OracleType.NVarChar,254).Value=m_hach;
					cmd.Parameters.Add("m_vu",OracleType.NVarChar,254).Value=m_vu;
					cmd.Parameters.Add("m_dauhieu",OracleType.NVarChar,254).Value=m_dauhieu;
					cmd.Parameters.Add("m_moilon",OracleType.NVarChar,254).Value=m_moilon;
					cmd.Parameters.Add("m_moinho",OracleType.NVarChar,254).Value=m_moinho;
					cmd.Parameters.Add("m_amvat",OracleType.NVarChar,254).Value=m_amvat;
					cmd.Parameters.Add("m_amho",OracleType.NVarChar,254).Value=m_amho;
					cmd.Parameters.Add("m_mangtrinh",OracleType.NVarChar,254).Value=m_mangtrinh;
					cmd.Parameters.Add("m_tangsinhmon",OracleType.NVarChar,254).Value=m_tangsinhmon;
					cmd.Parameters.Add("m_amdao",OracleType.NVarChar,254).Value=m_amdao;
					cmd.Parameters.Add("m_cotucung",OracleType.NVarChar,254).Value=m_cotucung;
					cmd.Parameters.Add("m_thantucung",OracleType.NVarChar,254).Value=m_thantucung;
					cmd.Parameters.Add("m_phanphu",OracleType.NVarChar,254).Value=m_phanphu;
					cmd.Parameters.Add("m_cactui",OracleType.NVarChar,254).Value=m_cactui;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_phukhoa");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
		
			return true;
		}

		public bool upd_ba_noikhoa(string m_ngay,long m_id,string m_chidinh,string m_thoigian,decimal m_soluong,string m_loai,string m_thoidiem)
		{
			string xxx = user + mmyy(m_ngay);
			sql="update "+xxx+".ba_noikhoa set chidinh=:m_chidinh,thoigian=to_date(:m_thoigian,'dd/mm/yyyy'),";
			sql+="soluong=:m_soluong,loai=:m_loai,thoidiem=to_date(:m_thoidiem,'dd/mm/yyyy') where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_chidinh",OracleType.NVarChar,254).Value=m_chidinh;
				cmd.Parameters.Add("m_thoigian",OracleType.VarChar,10).Value=m_thoigian;
				cmd.Parameters.Add("m_soluong",OracleType.Number).Value=m_soluong;
				cmd.Parameters.Add("m_loai",OracleType.NVarChar,254).Value=m_loai;
				cmd.Parameters.Add("m_thoidiem",OracleType.VarChar,10).Value=m_thoidiem;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_noikhoa (id,chidinh,thoigian,soluong,loai,thoidiem) values (:m_id,:m_chidinh,to_date(:m_thoigian,'dd/mm/yyyy'),:m_soluong,:m_loai,to_date(:m_thoidiem,'dd/mm/yyyy'))";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_chidinh",OracleType.NVarChar,254).Value=m_chidinh;
					cmd.Parameters.Add("m_thoigian",OracleType.VarChar,10).Value=m_thoigian;
					cmd.Parameters.Add("m_soluong",OracleType.Number).Value=m_soluong;
					cmd.Parameters.Add("m_loai",OracleType.NVarChar,254).Value=m_loai;
					cmd.Parameters.Add("m_thoidiem",OracleType.VarChar,10).Value=m_thoidiem;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_noikhoa");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_ungbuou(string ngay,long id,string xnmau,string xntebao,string xnblgp,string xquang,
			string sieuam,string xnkhac,int trietde,int trieuchung,string tienphau,string hach1,string donthuan,
			string hach2,string phauthuat,string hauphau,string hach3,string hoachat,string sodot,
			string dapung,int loai,string khac)
		{
			string xxx = user + mmyy(ngay);
			sql="update "+xxx+".ba_ungbuou set xnmau=:xnmau,xntebao=:xntebao,xnblgp=:xnblgp,xquang=:xquang,";
			sql+="sieuam=:sieuam,xnkhac=:xnkhac,trietde="+trietde+",trieuchung="+trieuchung+",tienphau=:tienphau,";
			sql+="hach1=:hach1,donthuan=:donthuan,hach2=:hach2,phauthuat=:phauthuat,hauphau=:hauphau,hach3=:hach3,";
			sql+="hoachat=:hoachat,sodot=:sodot,dapung=:dapung,loai="+loai+",khac=:khac where id="+id;
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("xnmau",OracleType.NVarChar,254).Value=xnmau;
				cmd.Parameters.Add("xntebao",OracleType.NVarChar,254).Value=xntebao;
				cmd.Parameters.Add("xnblgp",OracleType.NVarChar,254).Value=xnblgp;
				cmd.Parameters.Add("xquang",OracleType.NVarChar,254).Value=xquang;
				cmd.Parameters.Add("sieuam",OracleType.NVarChar,254).Value=sieuam;
				cmd.Parameters.Add("xnkhac",OracleType.NVarChar,254).Value=xnkhac;
				cmd.Parameters.Add("tienphau",OracleType.NVarChar,254).Value=tienphau;
				cmd.Parameters.Add("hach1",OracleType.NVarChar,254).Value=hach1;
				cmd.Parameters.Add("donthuan",OracleType.NVarChar,254).Value=donthuan;
				cmd.Parameters.Add("hach2",OracleType.NVarChar,254).Value=hach2;
				cmd.Parameters.Add("phauthuat",OracleType.NVarChar,254).Value=phauthuat;
				cmd.Parameters.Add("hauphau",OracleType.NVarChar,254).Value=hauphau;
				cmd.Parameters.Add("hach3",OracleType.NVarChar,254).Value=hach3;
				cmd.Parameters.Add("hoachat",OracleType.NVarChar,254).Value=hoachat;
				cmd.Parameters.Add("sodot",OracleType.NVarChar,254).Value=sodot;
				cmd.Parameters.Add("dapung",OracleType.NVarChar,254).Value=dapung;
				cmd.Parameters.Add("khac",OracleType.NVarChar,254).Value=khac;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{					
					sql="insert into "+xxx+".ba_ungbuou (id,xnmau,xntebao,xnblgp,xquang,sieuam,xnkhac,trietde,trieuchung,tienphau,hach1,donthuan,";
					sql+="hach2,phauthuat,hauphau,hach3,hoachat,sodot,dapung,loai,khac)";
					sql+=" values (";
					sql+=id+",:xnmau,:xntebao,:xnblgp,:xquang,:sieuam,:xnkhac,"+trietde+","+trieuchung+",:tienphau,:hach1,:donthuan,";
					sql+=":hach2,:phauthuat,:hauphau,:hach3,:hoachat,:sodot,:dapung,"+loai+",:khac)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("xnmau",OracleType.NVarChar,254).Value=xnmau;
					cmd.Parameters.Add("xntebao",OracleType.NVarChar,254).Value=xntebao;
					cmd.Parameters.Add("xnblgp",OracleType.NVarChar,254).Value=xnblgp;
					cmd.Parameters.Add("xquang",OracleType.NVarChar,254).Value=xquang;
					cmd.Parameters.Add("sieuam",OracleType.NVarChar,254).Value=sieuam;
					cmd.Parameters.Add("xnkhac",OracleType.NVarChar,254).Value=xnkhac;
					cmd.Parameters.Add("tienphau",OracleType.NVarChar,254).Value=tienphau;
					cmd.Parameters.Add("hach1",OracleType.NVarChar,254).Value=hach1;
					cmd.Parameters.Add("donthuan",OracleType.NVarChar,254).Value=donthuan;
					cmd.Parameters.Add("hach2",OracleType.NVarChar,254).Value=hach2;
					cmd.Parameters.Add("phauthuat",OracleType.NVarChar,254).Value=phauthuat;
					cmd.Parameters.Add("hauphau",OracleType.NVarChar,254).Value=hauphau;
					cmd.Parameters.Add("hach3",OracleType.NVarChar,254).Value=hach3;
					cmd.Parameters.Add("hoachat",OracleType.NVarChar,254).Value=hoachat;
					cmd.Parameters.Add("sodot",OracleType.NVarChar,254).Value=sodot;
					cmd.Parameters.Add("dapung",OracleType.NVarChar,254).Value=dapung;
					cmd.Parameters.Add("khac",OracleType.NVarChar,254).Value=khac;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_ungbuou");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_dongmachvanh(string m_ngay,long m_id,decimal m_stt,decimal m_soluong,string m_vitri)
		{
			string xxx = user + mmyy(m_ngay);
			sql="update "+xxx+".ba_dongmachvanh set soluong=:m_soluong,vitri=:m_vitri where id=:m_id and stt=:m_stt";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_soluong",OracleType.Number).Value=m_soluong;
				cmd.Parameters.Add("m_vitri",OracleType.NVarChar,254).Value=m_vitri;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_dongmachvanh (id,stt,soluong,vitri) values (:m_id,:m_stt,:m_soluong,:m_vitri)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
					cmd.Parameters.Add("m_soluong",OracleType.Number).Value=m_soluong;
					cmd.Parameters.Add("m_vitri",OracleType.NVarChar,254).Value=m_vitri;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_dongmachvanh");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_tomtat(string m_ngay,long m_id,string m_benhnhan,string m_lydo,string m_conang,string m_thucthe,string m_clsdaco)
		{
			string xxx = user + mmyy(m_ngay);
			sql="update "+xxx+".ba_tomtat set benhnhan=:m_benhnhan,lydo=:m_lydo,conang=:m_conang,";
			sql+="thucthe=:m_thucthe,clsdaco=:m_clsdaco where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_benhnhan",OracleType.NVarChar,254).Value=m_benhnhan;
				cmd.Parameters.Add("m_lydo",OracleType.NVarChar,254).Value=m_lydo;
				cmd.Parameters.Add("m_conang",OracleType.NVarChar,254).Value=m_conang;
				cmd.Parameters.Add("m_thucthe",OracleType.NVarChar,254).Value=m_thucthe;
				cmd.Parameters.Add("m_clsdaco",OracleType.NVarChar,254).Value=m_clsdaco;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_tomtat (id,benhnhan,lydo,conang,thucthe,clsdaco) values (:m_id,:m_benhnhan,:m_lydo,:m_conang,:m_thucthe,:m_clsdaco)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_benhnhan",OracleType.NVarChar,254).Value=m_benhnhan;
					cmd.Parameters.Add("m_lydo",OracleType.NVarChar,254).Value=m_lydo;
					cmd.Parameters.Add("m_conang",OracleType.NVarChar,254).Value=m_conang;
					cmd.Parameters.Add("m_thucthe",OracleType.NVarChar,254).Value=m_thucthe;
					cmd.Parameters.Add("m_clsdaco",OracleType.NVarChar,254).Value=m_clsdaco;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_tomtat");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}		

		public bool upd_ba_nhi(string m_ngay,long m_id,decimal m_conthu,string m_para,int m_tinhtrang,
			decimal m_cannang,int m_ditat,string m_tenditat,string m_tinhthan,string m_vandong,string m_benhlykhac,
			int m_nuoiduong,decimal m_caisua,int m_vuontre,int m_tainha,int m_lao,int m_bailiet,int m_soi,
			int m_hoga,int m_uonvan,int m_bachhau,int m_tckhac,string m_cuthe,decimal m_chieucao,
			decimal m_vongnguc,decimal m_vongdau)
		{
			string xxx = user + mmyy(m_ngay);
			sql="update "+xxx+".ba_nhi set conthu=:m_conthu,para=:m_para,tinhtrang=:m_tinhtrang,cannang=:m_cannang,";
			sql+="ditat=:m_ditat,tenditat=:m_tenditat,tinhthan=:m_tinhthan,vandong=:m_vandong,benhlykhac=:m_benhlykhac,";
			sql+="nuoiduong=:m_nuoiduong,caisua=:m_caisua,vuontre=:m_vuontre,tainha=:m_tainha,lao=:m_lao,bailiet=:m_bailiet,";
			sql+="soi=:m_soi,hoga=:m_hoga,uonvan=:m_uonvan,bachhau=:m_bachhau,tckhac=:m_tckhac,cuthe=:m_cuthe,";
			sql+="chieucao=:m_chieucao,vongnguc=:m_vongnguc,vongdau=:m_vongdau";
			sql+=" where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_conthu",OracleType.Number).Value=m_conthu;
				cmd.Parameters.Add("m_para",OracleType.VarChar,8).Value=m_para;
				cmd.Parameters.Add("m_tinhtrang",OracleType.Number).Value=m_tinhtrang;
				cmd.Parameters.Add("m_cannang",OracleType.Number).Value=m_cannang;
				cmd.Parameters.Add("m_ditat",OracleType.Number).Value=m_ditat;
				cmd.Parameters.Add("m_tenditat",OracleType.VarChar,10).Value=m_tenditat;
				cmd.Parameters.Add("m_tinhthan",OracleType.NVarChar,254).Value=m_tinhthan;
				cmd.Parameters.Add("m_vandong",OracleType.NVarChar,254).Value=m_vandong;
				cmd.Parameters.Add("m_benhlykhac",OracleType.NVarChar,254).Value=m_benhlykhac;
				cmd.Parameters.Add("m_nuoiduong",OracleType.Number).Value=m_nuoiduong;
				cmd.Parameters.Add("m_caisua",OracleType.Number).Value=m_caisua;
				cmd.Parameters.Add("m_vuontre",OracleType.Number).Value=m_vuontre;
				cmd.Parameters.Add("m_tainha",OracleType.Number).Value=m_tainha;
				cmd.Parameters.Add("m_lao",OracleType.Number).Value=m_lao;
				cmd.Parameters.Add("m_bailiet",OracleType.Number).Value=m_bailiet;
				cmd.Parameters.Add("m_soi",OracleType.Number).Value=m_soi;
				cmd.Parameters.Add("m_hoga",OracleType.Number).Value=m_hoga;
				cmd.Parameters.Add("m_uonvan",OracleType.Number).Value=m_uonvan;
				cmd.Parameters.Add("m_bachhau",OracleType.Number).Value=m_bachhau;
				cmd.Parameters.Add("m_tckhac",OracleType.Number).Value=m_tckhac;
				cmd.Parameters.Add("m_cuthe",OracleType.NVarChar,254).Value=m_cuthe;
				cmd.Parameters.Add("m_chieucao",OracleType.Number).Value=m_chieucao;
				cmd.Parameters.Add("m_vongnguc",OracleType.Number).Value=m_vongnguc;
				cmd.Parameters.Add("m_vongdau",OracleType.Number).Value=m_vongdau;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_nhi (id,conthu,para,tinhtrang,cannang,ditat,tenditat,tinhthan,vandong,benhlykhac,nuoiduong,caisua,vuontre,tainha,lao,bailiet,soi,hoga,uonvan,bachhau,tckhac,cuthe,chieucao,vongnguc,vongdau) values (:m_id,:m_conthu,:m_para,:m_tinhtrang,:m_cannang,:m_ditat,:m_tenditat,:m_tinhthan,:m_vandong,:m_benhlykhac,:m_nuoiduong,:m_caisua,:m_vuontre,:m_tainha,:m_lao,:m_bailiet,:m_soi,:m_hoga,:m_uonvan,:m_bachhau,:m_tckhac,:m_cuthe,:m_chieucao,:m_vongnguc,:m_vongdau)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_conthu",OracleType.Number).Value=m_conthu;
					cmd.Parameters.Add("m_para",OracleType.VarChar,8).Value=m_para;
					cmd.Parameters.Add("m_tinhtrang",OracleType.Number).Value=m_tinhtrang;
					cmd.Parameters.Add("m_cannang",OracleType.Number).Value=m_cannang;
					cmd.Parameters.Add("m_ditat",OracleType.Number).Value=m_ditat;
					cmd.Parameters.Add("m_tenditat",OracleType.VarChar,10).Value=m_tenditat;
					cmd.Parameters.Add("m_tinhthan",OracleType.NVarChar,254).Value=m_tinhthan;
					cmd.Parameters.Add("m_vandong",OracleType.NVarChar,254).Value=m_vandong;
					cmd.Parameters.Add("m_benhlykhac",OracleType.NVarChar,254).Value=m_benhlykhac;
					cmd.Parameters.Add("m_nuoiduong",OracleType.Number).Value=m_nuoiduong;
					cmd.Parameters.Add("m_caisua",OracleType.Number).Value=m_caisua;
					cmd.Parameters.Add("m_vuontre",OracleType.Number).Value=m_vuontre;
					cmd.Parameters.Add("m_tainha",OracleType.Number).Value=m_tainha;
					cmd.Parameters.Add("m_lao",OracleType.Number).Value=m_lao;
					cmd.Parameters.Add("m_bailiet",OracleType.Number).Value=m_bailiet;
					cmd.Parameters.Add("m_soi",OracleType.Number).Value=m_soi;
					cmd.Parameters.Add("m_hoga",OracleType.Number).Value=m_hoga;
					cmd.Parameters.Add("m_uonvan",OracleType.Number).Value=m_uonvan;
					cmd.Parameters.Add("m_bachhau",OracleType.Number).Value=m_bachhau;
					cmd.Parameters.Add("m_tckhac",OracleType.Number).Value=m_tckhac;
					cmd.Parameters.Add("m_cuthe",OracleType.NVarChar,254).Value=m_cuthe;
					cmd.Parameters.Add("m_chieucao",OracleType.Number).Value=m_chieucao;
					cmd.Parameters.Add("m_vongnguc",OracleType.Number).Value=m_vongnguc;
					cmd.Parameters.Add("m_vongdau",OracleType.Number).Value=m_vongdau;					
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_nhi");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_sosinh(string m_ngay,long m_id,string m_oivo,string m_mausac,int m_cachde,string m_luc,
			string m_lydo,int m_tinhtrang,string m_mabs,decimal m_apgar1,decimal m_apgar5,decimal m_apgar10,
			decimal m_cannang,string m_sausinh,string m_nguoichuyen,int m_ditat,int m_haumon,string m_tenditat,
			string m_tinhhinh,decimal m_can,decimal m_chieudai,decimal m_vongdau,decimal m_nhietdo,
			decimal m_nhiptho,string m_toanthan,int m_mausacda,string m_khac,string m_hohap,decimal m_nhiptho_khac,
			string m_nghephoi,decimal m_chiso,decimal m_nhiptim,string m_bung,string m_coquan,string m_xuongkhop,
			string m_phanxa,string m_lucco,string m_theodoi)
		{
	
			string xxx = user + mmyy(m_ngay);
			sql="update "+xxx+".ba_sosinh set oivo=to_date(:m_oivo,'dd/mm/yyyy hh24:mi'),mausac=:m_mausac,";
			sql+="cachde=:m_cachde,luc=to_date(:m_luc,'dd/mm/yyyy hh24:mi'),lydo=:m_lydo,tinhtrang=:m_tinhtrang,";
			sql+="mabs=:m_mabs,apgar1=:m_apgar1,apgar5=:m_apgar5,apgar10=:m_apgar10,cannang=:m_cannang,sausinh=:m_sausinh,";
			sql+="nguoichuyen=:m_nguoichuyen,ditat=:m_ditat,haumon=:m_haumon,tenditat=:m_tenditat,tinhhinh=:m_tinhhinh,";
			sql+="can=:m_can,chieudai=:m_chieudai,vongdau=:m_vongdau,nhietdo=:m_nhietdo,nhiptho=:m_nhiptho,";
			sql+="toanthan=:m_toanthan,mausacda=:m_mausacda,khac=:m_khac,hohap=:m_hohap,nhiptho_khac=:m_nhiptho_khac,";
			sql+="nghephoi=:m_nghephoi,chiso=:m_chiso,nhiptim=:m_nhiptim,bung=:m_bung,coquan=:m_coquan,xuongkhop=:m_xuongkhop,";
			sql+="phanxa=:m_phanxa,lucco=:m_lucco,theodoi=:m_theodoi where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_oivo",OracleType.VarChar,16).Value=m_oivo.Trim();
				cmd.Parameters.Add("m_mausac",OracleType.NVarChar,254).Value=m_mausac;
				cmd.Parameters.Add("m_cachde",OracleType.Number).Value=m_cachde;
				cmd.Parameters.Add("m_luc",OracleType.VarChar,16).Value=m_luc.Trim();
				cmd.Parameters.Add("m_lydo",OracleType.NVarChar,254).Value=m_lydo;
				cmd.Parameters.Add("m_tinhtrang",OracleType.Number).Value=m_tinhtrang;
				cmd.Parameters.Add("m_mabs",OracleType.VarChar,4).Value=m_mabs;
				cmd.Parameters.Add("m_apgar1",OracleType.Number).Value=m_apgar1;
				cmd.Parameters.Add("m_apgar5",OracleType.Number).Value=m_apgar5;
				cmd.Parameters.Add("m_apgar10",OracleType.Number).Value=m_apgar10;
				cmd.Parameters.Add("m_cannang",OracleType.Number).Value=m_cannang;
				cmd.Parameters.Add("m_sausinh",OracleType.NVarChar,254).Value=m_sausinh;
				cmd.Parameters.Add("m_nguoichuyen",OracleType.VarChar,4).Value=m_nguoichuyen;
				cmd.Parameters.Add("m_ditat",OracleType.Number).Value=m_ditat;
				cmd.Parameters.Add("m_haumon",OracleType.Number).Value=m_haumon;
				cmd.Parameters.Add("m_tenditat",OracleType.VarChar,10).Value=m_tenditat;
				cmd.Parameters.Add("m_tinhhinh",OracleType.NVarChar,254).Value=m_tinhhinh;
				cmd.Parameters.Add("m_can",OracleType.Number).Value=m_can;
				cmd.Parameters.Add("m_chieudai",OracleType.Number).Value=m_chieudai;
				cmd.Parameters.Add("m_vongdau",OracleType.Number).Value=m_vongdau;
				cmd.Parameters.Add("m_nhietdo",OracleType.Number).Value=m_nhietdo;
				cmd.Parameters.Add("m_nhiptho",OracleType.Number).Value=m_nhiptho;
				cmd.Parameters.Add("m_toanthan",OracleType.NVarChar,1000).Value=m_toanthan;
				cmd.Parameters.Add("m_mausacda",OracleType.Number).Value=m_mausacda;
				cmd.Parameters.Add("m_khac",OracleType.NVarChar,254).Value=m_khac;
				cmd.Parameters.Add("m_hohap",OracleType.NVarChar,254).Value=m_hohap;
				cmd.Parameters.Add("m_nhiptho_khac",OracleType.Number).Value=m_nhiptho_khac;
				cmd.Parameters.Add("m_nghephoi",OracleType.NVarChar,254).Value=m_nghephoi;
				cmd.Parameters.Add("m_chiso",OracleType.Number).Value=m_chiso;
				cmd.Parameters.Add("m_nhiptim",OracleType.Number).Value=m_nhiptim;
				cmd.Parameters.Add("m_bung",OracleType.NVarChar,254).Value=m_bung;
				cmd.Parameters.Add("m_coquan",OracleType.NVarChar,254).Value=m_coquan;
				cmd.Parameters.Add("m_xuongkhop",OracleType.NVarChar,254).Value=m_xuongkhop;
				cmd.Parameters.Add("m_phanxa",OracleType.NVarChar,254).Value=m_phanxa;
				cmd.Parameters.Add("m_lucco",OracleType.NVarChar,254).Value=m_lucco;
				cmd.Parameters.Add("m_theodoi",OracleType.NVarChar,254).Value=m_theodoi;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_sosinh (id,oivo,mausac,cachde,luc,lydo,tinhtrang,mabs,apgar1,apgar5,apgar10,cannang,sausinh,nguoichuyen,ditat,haumon,tenditat,tinhhinh,can,chieudai,vongdau,nhietdo,nhiptho,toanthan,mausacda,khac,hohap,nhiptho_khac,nghephoi,chiso,nhiptim,bung,coquan,xuongkhop,phanxa,lucco,theodoi) values (:m_id,to_date(:m_oivo,'dd/mm/yyyy hh24:mi'),:m_mausac,:m_cachde,to_date(:m_luc,'dd/mm/yyyy hh24:mi'),:m_lydo,:m_tinhtrang,:m_mabs,:m_apgar1,:m_apgar5,:m_apgar10,:m_cannang,:m_sausinh,:m_nguoichuyen,:m_ditat,:m_haumon,:m_tenditat,:m_tinhhinh,:m_can,:m_chieudai,:m_vongdau,:m_nhietdo,:m_nhiptho,:m_toanthan,:m_mausacda,:m_khac,:m_hohap,:m_nhiptho_khac,:m_nghephoi,:m_chiso,:m_nhiptim,:m_bung,:m_coquan,:m_xuongkhop,:m_phanxa,:m_lucco,:m_theodoi)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_oivo",OracleType.VarChar,16).Value=m_oivo.Trim();
					cmd.Parameters.Add("m_mausac",OracleType.NVarChar,254).Value=m_mausac;
					cmd.Parameters.Add("m_cachde",OracleType.Number).Value=m_cachde;
					cmd.Parameters.Add("m_luc",OracleType.VarChar,16).Value=m_luc.Trim();
					cmd.Parameters.Add("m_lydo",OracleType.NVarChar,254).Value=m_lydo;
					cmd.Parameters.Add("m_tinhtrang",OracleType.Number).Value=m_tinhtrang;
					cmd.Parameters.Add("m_mabs",OracleType.VarChar,4).Value=m_mabs;
					cmd.Parameters.Add("m_apgar1",OracleType.Number).Value=m_apgar1;
					cmd.Parameters.Add("m_apgar5",OracleType.Number).Value=m_apgar5;
					cmd.Parameters.Add("m_apgar10",OracleType.Number).Value=m_apgar10;
					cmd.Parameters.Add("m_cannang",OracleType.Number).Value=m_cannang;
					cmd.Parameters.Add("m_sausinh",OracleType.NVarChar,254).Value=m_sausinh;
					cmd.Parameters.Add("m_nguoichuyen",OracleType.VarChar,4).Value=m_nguoichuyen;
					cmd.Parameters.Add("m_ditat",OracleType.Number).Value=m_ditat;
					cmd.Parameters.Add("m_haumon",OracleType.Number).Value=m_haumon;
					cmd.Parameters.Add("m_tenditat",OracleType.VarChar,10).Value=m_tenditat;
					cmd.Parameters.Add("m_tinhhinh",OracleType.NVarChar,254).Value=m_tinhhinh;
					cmd.Parameters.Add("m_can",OracleType.Number).Value=m_can;
					cmd.Parameters.Add("m_chieudai",OracleType.Number).Value=m_chieudai;
					cmd.Parameters.Add("m_vongdau",OracleType.Number).Value=m_vongdau;
					cmd.Parameters.Add("m_nhietdo",OracleType.Number).Value=m_nhietdo;
					cmd.Parameters.Add("m_nhiptho",OracleType.Number).Value=m_nhiptho;
					cmd.Parameters.Add("m_toanthan",OracleType.NVarChar,1000).Value=m_toanthan;
					cmd.Parameters.Add("m_mausacda",OracleType.Number).Value=m_mausacda;
					cmd.Parameters.Add("m_khac",OracleType.NVarChar,254).Value=m_khac;
					cmd.Parameters.Add("m_hohap",OracleType.NVarChar,254).Value=m_hohap;
					cmd.Parameters.Add("m_nhiptho_khac",OracleType.Number).Value=m_nhiptho_khac;
					cmd.Parameters.Add("m_nghephoi",OracleType.NVarChar,254).Value=m_nghephoi;
					cmd.Parameters.Add("m_chiso",OracleType.Number).Value=m_chiso;
					cmd.Parameters.Add("m_nhiptim",OracleType.Number).Value=m_nhiptim;
					cmd.Parameters.Add("m_bung",OracleType.NVarChar,254).Value=m_bung;
					cmd.Parameters.Add("m_coquan",OracleType.NVarChar,254).Value=m_coquan;
					cmd.Parameters.Add("m_xuongkhop",OracleType.NVarChar,254).Value=m_xuongkhop;
					cmd.Parameters.Add("m_phanxa",OracleType.NVarChar,254).Value=m_phanxa;
					cmd.Parameters.Add("m_lucco",OracleType.NVarChar,254).Value=m_lucco;
					cmd.Parameters.Add("m_theodoi",OracleType.NVarChar,254).Value=m_theodoi;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_sosinh");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_sosinh_pp(string m_ngay,long m_id,int m_ma)
		{
			string xxx = user + mmyy(m_ngay);
			sql="update "+xxx+".ba_sosinh_pp set ma=:m_ma where id=:m_id and ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_sosinh_pp (id,ma) values (:m_id,:m_ma)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_sosinh_pp");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}
		#region normal
		public string normal(int loai)
		{
			ds=get_data("select ten from ba_danhmuc where loai="+loai);
			if (ds.Tables[0].Rows.Count>0) return ds.Tables[0].Rows[0]["ten"].ToString().Trim();
			else return "";
		}

		public string nor_toanthan
		{
			get{return normal(500);}
		}
		public string nor_tuanhoan
		{
			get{return normal(501);}
		}
		public string nor_hohap
		{
			get{return normal(502);}
		}
		public string nor_tieuhoa
		{
			get{return normal(503);}
		}
		public string nor_than
		{
			get{return normal(504);}
		}
		public string nor_thankinh
		{
			get{return normal(505);}
		}
		public string nor_co
		{
			get{return normal(506);}
		}
		public string nor_tmh
		{
			get{return normal(507);}
		}
		public string nor_rhm
		{
			get{return normal(508);}
		}
		public string nor_mat
		{
			get{return normal(509);}
		}
		public string nor_cokinhMP
		{
			get{return normal(515);}
		}
		public string nor_cokinhMT
		{
			get{return normal(516);}
		}
		public string nor_kkinhMP
		{
			get{return normal(517);}
		}
		public string nor_kkinhMT
		{
			get{return normal(518);}
		}
		public string nor_nhanapMP
		{
			get{return normal(519);}
		}
		public string nor_nhanapMT
		{
			get{return normal(520);}
		}
		public string nor_noitiet
		{
			get{return normal(510);}
		}
		public string nor_da
		{
			get{return normal(511);}
		}
		public string nor_hach
		{
			get{return normal(512);}
		}
		public string nor_vu
		{
			get{return normal(513);}
		}
		public string nor_da_mo
		{
			get{return normal(514);}
		}
		public string nor_ksk_timmach
		{
			get{return normal(900);}
		}
		public string nor_ksk_hohap
		{
			get{return normal(901);}
		}
		public string nor_ksk_tieuhoa
		{
			get{return normal(902);}
		}
		public string nor_ksk_than
		{
			get{return normal(903);}
		}
		public string nor_ksk_thankinh
		{
			get{return normal(904);}
		}
		public string nor_ksk_tongquat
		{
			get{return normal(905);}
		}
		public string nor_ksk_chanthuong
		{
			get{return normal(906);}
		}
		public string nor_ksk_dalieu
		{
			get{return normal(907);}
		}
		public string nor_ksk_tlcp
		{
			get{return normal(908);}
		}
		public string nor_ksk_tlct
		{
			get{return normal(909);}
		}
		public string nor_ksk_tlkp
		{
			get{return normal(910);}
		}
		public string nor_ksk_tlkt
		{
			get{return normal(911);}
		}
		public string nor_ksk_truoc
		{
			get{return normal(912);}
		}
		public string nor_ksk_sau
		{
			get{return normal(913);}
		}
		public string nor_ksk_nhanapp
		{
			get{return normal(914);}
		}
		public string nor_ksk_nhanapt
		{
			get{return normal(915);}
		}
		public string nor_ksk_rang
		{
			get{return normal(916);}
		}
		public string nor_ksk_tai
		{
			get{return normal(917);}
		}
		public string nor_ksk_mui
		{
			get{return normal(918);}
		}
		public string nor_ksk_hong
		{
			get{return normal(919);}
		}
		public string nor_ksk_thanhquan
		{
			get{return normal(920);}
		}
		public string nor_ksk_daumatco
		{
			get{return normal(921);}
		}
		public string nor_ksk_san
		{
			get{return normal(922);}
		}
		public string nor_ksk_phu
		{
			get{return normal(923);}
		}
		#endregion

		#region dinhduong

		public void upd_di_error(string di_message, string di_computer, string di_table)
		{
			con.Close();con.Dispose();
			sql = "insert into "+user+".di_error(message,computer,tables,ngayud) values (:di_message,:di_computer,:di_table,now())";
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd = new OracleCommand(sql, con);
				cmd.CommandType = CommandType.Text;

				cmd.Parameters.Add("di_message", OracleType.NVarChar,254).Value = di_message;
				cmd.Parameters.Add("di_computer", OracleType.VarChar, 20).Value = di_computer;
				cmd.Parameters.Add("di_table", OracleType.VarChar, 20).Value = di_table;
				cmd.ExecuteNonQuery();
			}
			catch { }
			finally
			{
				con.Close();con.Dispose();
			}
		}

		public bool upd_di_danhmuc(string di_table, long di_id, decimal di_stt, string di_ma, string di_ten, int di_userid)
		{
			sql = "update " + user+"."+di_table + " set stt=:di_stt,ma=:di_ma,ten=:di_ten,userid=:di_userid where id=:di_id";
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd = new OracleCommand(sql, con);
				cmd.CommandType = CommandType.Text;
				cmd.Parameters.Add("di_stt", OracleType.Number).Value = di_stt;
				cmd.Parameters.Add("di_ma", OracleType.VarChar, 10).Value = di_ma;
				cmd.Parameters.Add("di_ten", OracleType.NVarChar,254).Value = di_ten;
				cmd.Parameters.Add("di_userid", OracleType.Number).Value = di_userid;
				cmd.Parameters.Add("di_id", OracleType.Number).Value = di_id;
				int irec = cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec == 0)
				{
					sql = "insert into " + user+"."+di_table + " (id,stt,ma,ten,userid) values (:di_id,:di_stt,:di_ma,:di_ten,:di_userid)";
					cmd = new OracleCommand(sql, con);
					cmd.CommandType = CommandType.Text;
					cmd.Parameters.Add("di_id", OracleType.Number).Value = di_id;
					cmd.Parameters.Add("di_stt", OracleType.Number).Value = di_stt;
					cmd.Parameters.Add("di_ma", OracleType.VarChar, 10).Value = di_ma;
					cmd.Parameters.Add("di_ten", OracleType.NVarChar,254).Value = di_ten;
					cmd.Parameters.Add("di_userid", OracleType.Number).Value = di_userid;
					irec = cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch (OracleException ex)
			{
				upd_di_error(ex.Message, sComputer, di_table);
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_di_dmnhom(long di_id, decimal di_stt, string di_ma, string di_ten, int di_anlong, int di_userid)
		{
			sql = "update "+user+".di_dmnhom set stt=:di_stt,ma=:di_ma,ten=:di_ten,anlong=:di_anlong,userid=:di_userid where id=:di_id";
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd = new OracleCommand(sql, con);
				cmd.CommandType = CommandType.Text;
				cmd.Parameters.Add("di_stt", OracleType.Number).Value = di_stt;
				cmd.Parameters.Add("di_ma", OracleType.VarChar, 10).Value = di_ma;
				cmd.Parameters.Add("di_ten", OracleType.NVarChar,254).Value = di_ten;
				cmd.Parameters.Add("di_anlong", OracleType.Number).Value = di_anlong;
				cmd.Parameters.Add("di_userid", OracleType.Number).Value = di_userid;
				cmd.Parameters.Add("di_id", OracleType.Number).Value = di_id;
				int irec = cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec == 0)
				{
					sql = "insert into " + user + ".di_dmnhom (id,stt,ma,ten,anlong,userid) values (:di_id,:di_stt,:di_ma,:di_ten,:di_anlong,:di_userid)";
					cmd = new OracleCommand(sql, con);
					cmd.CommandType = CommandType.Text;
					cmd.Parameters.Add("di_id", OracleType.Number).Value = di_id;
					cmd.Parameters.Add("di_stt", OracleType.Number).Value = di_stt;
					cmd.Parameters.Add("di_ma", OracleType.VarChar, 10).Value = di_ma;
					cmd.Parameters.Add("di_ten", OracleType.NVarChar,254).Value = di_ten;
					cmd.Parameters.Add("di_anlong", OracleType.Number).Value = di_anlong;
					cmd.Parameters.Add("di_userid", OracleType.Number).Value = di_userid;
					irec = cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch (OracleException ex)
			{
				upd_di_error(ex.Message, sComputer, "di_dmnhom");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_di_dmchedoan(long di_id, decimal di_stt, int di_idnhom, string di_ma, string di_ten, int di_tuan, int di_thu, decimal di_p, decimal di_l, decimal di_g, decimal di_e,decimal di_dongia,int di_userid)
		{
			sql = "update " + user + ".di_dmchedoan set stt=:di_stt,idnhom=:di_idnhom,ma=:di_ma,ten=:di_ten,tuan=:di_tuan,thu=:di_thu,p=:di_p,l=:di_l,g=:di_g,e=:di_e,dongia=:di_dongia,userid=:di_userid where id=:di_id";
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd = new OracleCommand(sql, con);
				cmd.CommandType = CommandType.Text;
				cmd.Parameters.Add("di_stt", OracleType.Number).Value = di_stt;
				cmd.Parameters.Add("di_idnhom", OracleType.Number).Value = di_idnhom;
				cmd.Parameters.Add("di_ma", OracleType.VarChar, 10).Value = di_ma;
				cmd.Parameters.Add("di_ten", OracleType.NVarChar,254).Value = di_ten;
				cmd.Parameters.Add("di_tuan", OracleType.Number).Value = di_tuan;
				cmd.Parameters.Add("di_thu", OracleType.Number).Value = di_thu;
				cmd.Parameters.Add("di_p", OracleType.Number).Value = di_p;
				cmd.Parameters.Add("di_l", OracleType.Number).Value = di_l;
				cmd.Parameters.Add("di_g", OracleType.Number).Value = di_g;
				cmd.Parameters.Add("di_e", OracleType.Number).Value = di_e;
				cmd.Parameters.Add("di_dongia", OracleType.Number).Value = di_dongia;
				cmd.Parameters.Add("di_userid", OracleType.Number).Value = di_userid;
				cmd.Parameters.Add("di_id", OracleType.Number).Value = di_id;
				int irec = cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec == 0)
				{
					sql = "insert into " + user + ".di_dmchedoan (id,stt,idnhom,ma,ten,tuan,thu,p,l,g,e,dongia,userid) values (:di_id,:di_stt,:di_idnhom,:di_ma,:di_ten,:di_tuan,:di_thu,:di_p,:di_l,:di_g,:di_e,:di_dongia,:di_userid)";
					cmd = new OracleCommand(sql, con);
					cmd.CommandType = CommandType.Text;
					cmd.Parameters.Add("di_id", OracleType.Number).Value = di_id;
					cmd.Parameters.Add("di_stt", OracleType.Number).Value = di_stt;
					cmd.Parameters.Add("di_idnhom", OracleType.Number).Value = di_idnhom;
					cmd.Parameters.Add("di_ma", OracleType.VarChar, 10).Value = di_ma;
					cmd.Parameters.Add("di_ten", OracleType.NVarChar,254).Value = di_ten;
					cmd.Parameters.Add("di_tuan", OracleType.Number).Value = di_tuan;
					cmd.Parameters.Add("di_thu", OracleType.Number).Value = di_thu;
					cmd.Parameters.Add("di_p", OracleType.Number).Value = di_p;
					cmd.Parameters.Add("di_l", OracleType.Number).Value = di_l;
					cmd.Parameters.Add("di_g", OracleType.Number).Value = di_g;
					cmd.Parameters.Add("di_e", OracleType.Number).Value = di_e;
					cmd.Parameters.Add("di_dongia", OracleType.Number).Value = di_dongia;
					cmd.Parameters.Add("di_userid", OracleType.Number).Value = di_userid;
					irec = cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch (OracleException ex)
			{
				upd_di_error(ex.Message, sComputer, "di_dmchedoan");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_di_dmthu(long di_id, string di_anh, string di_viet)
		{
			sql = "update " + user + ".di_dmthu set anh=:di_anh,viet=:di_viet where id=:di_id";
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd = new OracleCommand(sql, con);
				cmd.CommandType = CommandType.Text;
				cmd.Parameters.Add("di_anh", OracleType.VarChar, 3).Value = di_anh;
				cmd.Parameters.Add("di_viet", OracleType.NVarChar, 20).Value = di_viet;
				cmd.Parameters.Add("di_id", OracleType.Number).Value = di_id;
				int irec = cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec == 0)
				{
					sql = "insert into " + user + ".di_dmthu (id,anh,viet) values (:di_id,:di_anh,:di_viet)";
					cmd = new OracleCommand(sql, con);
					cmd.CommandType = CommandType.Text;
					cmd.Parameters.Add("di_id", OracleType.Number).Value = di_id;
					cmd.Parameters.Add("di_anh", OracleType.VarChar, 3).Value = di_anh;
					cmd.Parameters.Add("di_viet", OracleType.NVarChar, 20).Value = di_viet;
					irec = cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch (OracleException ex)
			{
				upd_di_error(ex.Message, sComputer, "di_dmthu");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_di_dmcu(long di_id, decimal di_stt, string di_idgioan, string di_ma, string di_ten, int di_userid)
		{
			sql = "update " + user + ".di_dmcu set stt=:di_stt,idgioan=:di_idgioan,ma=:di_ma,ten=:di_ten,userid=:di_userid where id=:di_id";
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd = new OracleCommand(sql, con);
				cmd.CommandType = CommandType.Text;
				cmd.Parameters.Add("di_stt", OracleType.Number).Value = di_stt;
				cmd.Parameters.Add("di_idgioan", OracleType.VarChar, 50).Value = di_idgioan;
				cmd.Parameters.Add("di_ma", OracleType.VarChar, 10).Value = di_ma;
				cmd.Parameters.Add("di_ten", OracleType.NVarChar,254).Value = di_ten;
				cmd.Parameters.Add("di_userid", OracleType.Number).Value = di_userid;
				cmd.Parameters.Add("di_id", OracleType.Number).Value = di_id;
				int irec = cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec == 0)
				{
					sql = "insert into " + user + ".di_dmcu (id,stt,idgioan,ma,ten,userid) values (:di_id,:di_stt,:di_idgioan,:di_ma,:di_ten,:di_userid)";
					cmd = new OracleCommand(sql, con);
					cmd.CommandType = CommandType.Text;
					cmd.Parameters.Add("di_id", OracleType.Number).Value = di_id;
					cmd.Parameters.Add("di_stt", OracleType.Number).Value = di_stt;
					cmd.Parameters.Add("di_idgioan", OracleType.VarChar, 50).Value = di_idgioan;
					cmd.Parameters.Add("di_ma", OracleType.VarChar, 10).Value = di_ma;
					cmd.Parameters.Add("di_ten", OracleType.NVarChar,254).Value = di_ten;
					cmd.Parameters.Add("di_userid", OracleType.Number).Value = di_userid;
					irec = cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch (OracleException ex)
			{
				upd_di_error(ex.Message, sComputer, "di_dmcu");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_di_dmthucpham(long di_id, decimal di_stt, int di_idloai, string di_ma, string di_ten, string di_dvt,decimal di_protein,decimal di_lipid,decimal di_glucid,decimal di_nangluong,decimal di_kali,decimal di_natri,decimal di_dongia,int di_thietyeu,decimal di_soluong,int di_userid)
		{
			sql = "update " + user + ".di_dmthucpham set stt=:di_stt,idloai=:di_idloai,ma=:di_ma,ten=:di_ten,dvt=:di_dvt,protein=:di_protein,lipid=:di_lipid,glucid=:di_glucid,nangluong=:di_nangluong,kali=:di_kali,natri=:di_natri,dongia=:di_dongia,thietyeu=:di_thietyeu,soluong=:di_soluong,userid=:di_userid where id=:di_id";
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd = new OracleCommand(sql, con);
				cmd.CommandType = CommandType.Text;
				cmd.Parameters.Add("di_stt", OracleType.Number).Value = di_stt;
				cmd.Parameters.Add("di_idloai", OracleType.Number).Value = di_idloai;
				cmd.Parameters.Add("di_ma", OracleType.VarChar, 10).Value = di_ma;
				cmd.Parameters.Add("di_ten", OracleType.NVarChar,254).Value = di_ten;
				cmd.Parameters.Add("di_dvt", OracleType.NVarChar, 20).Value = di_dvt;
				cmd.Parameters.Add("di_protein", OracleType.Number).Value = di_protein;
				cmd.Parameters.Add("di_lipid", OracleType.Number).Value = di_lipid;
				cmd.Parameters.Add("di_glucid", OracleType.Number).Value = di_glucid;
				cmd.Parameters.Add("di_nangluong", OracleType.Number).Value = di_nangluong;
				cmd.Parameters.Add("di_kali", OracleType.Number).Value = di_kali;
				cmd.Parameters.Add("di_natri", OracleType.Number).Value = di_natri;
				cmd.Parameters.Add("di_dongia", OracleType.Number).Value = di_dongia;
				cmd.Parameters.Add("di_thietyeu", OracleType.Number).Value = di_thietyeu;
				cmd.Parameters.Add("di_soluong", OracleType.Number).Value = di_soluong;
				cmd.Parameters.Add("di_userid", OracleType.Number).Value = di_userid;
				cmd.Parameters.Add("di_id", OracleType.Number).Value = di_id;
				int irec = cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec == 0)
				{
					sql = "insert into " + user + ".di_dmthucpham (id,stt,idloai,ma,ten,dvt,protein,lipid,glucid,nangluong,kali,natri,dongia,thietyeu,soluong,userid) values (:di_id,:di_stt,:di_idloai,:di_ma,:di_ten,:di_dvt,:di_protein,:di_lipid,:di_glucid,:di_nangluong,:di_kali,:di_natri,:di_dongia,:di_thietyeu,:di_soluong,:di_userid)";
					cmd = new OracleCommand(sql, con);
					cmd.CommandType = CommandType.Text;
					cmd.Parameters.Add("di_id", OracleType.Number).Value = di_id;
					cmd.Parameters.Add("di_stt", OracleType.Number).Value = di_stt;
					cmd.Parameters.Add("di_idloai", OracleType.Number).Value = di_idloai;
					cmd.Parameters.Add("di_ma", OracleType.VarChar, 10).Value = di_ma;
					cmd.Parameters.Add("di_ten", OracleType.NVarChar,254).Value = di_ten;
					cmd.Parameters.Add("di_dvt", OracleType.NVarChar, 20).Value = di_dvt;
					cmd.Parameters.Add("di_protein", OracleType.Number).Value = di_protein;
					cmd.Parameters.Add("di_lipid", OracleType.Number).Value = di_lipid;
					cmd.Parameters.Add("di_glucid", OracleType.Number).Value = di_glucid;
					cmd.Parameters.Add("di_nangluong", OracleType.Number).Value = di_nangluong;
					cmd.Parameters.Add("di_kali", OracleType.Number).Value = di_kali;
					cmd.Parameters.Add("di_natri", OracleType.Number).Value = di_natri;
					cmd.Parameters.Add("di_dongia", OracleType.Number).Value = di_dongia;
					cmd.Parameters.Add("di_thietyeu", OracleType.Number).Value = di_thietyeu;
					cmd.Parameters.Add("di_soluong", OracleType.Number).Value = di_soluong;
					cmd.Parameters.Add("di_userid", OracleType.Number).Value = di_userid;
					irec = cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch (OracleException ex)
			{
				upd_di_error(ex.Message, sComputer, "di_dmthucpham");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_di_dmtpngay(long di_id,string di_ngay,decimal di_dongia,int di_thietyeu,int di_userid)
		{
			sql = "update " + user + ".di_dmtpngay set dongia=:di_dongia,thietyeu=:di_thietyeu,userid=:di_userid where id=:di_id and to_char(ngay,'dd/mm/yyyy')=:di_ngay";
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd = new OracleCommand(sql, con);
				cmd.CommandType = CommandType.Text;
				cmd.Parameters.Add("di_dongia", OracleType.Number).Value = di_dongia;
				cmd.Parameters.Add("di_thietyeu", OracleType.Number).Value = di_thietyeu;
				cmd.Parameters.Add("di_userid", OracleType.Number).Value = di_userid;
				cmd.Parameters.Add("di_id", OracleType.Number).Value = di_id;
				cmd.Parameters.Add("di_ngay", OracleType.VarChar,10).Value = di_ngay;
				int irec = cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec == 0)
				{
					sql = "insert into " + user + ".di_dmtpngay (id,ngay,dongia,thietyeu,userid) values (:di_id,to_date(:di_ngay,'dd/mm/yyyy'),:di_dongia,:di_thietyeu,:di_userid)";
					cmd = new OracleCommand(sql, con);
					cmd.CommandType = CommandType.Text;
					cmd.Parameters.Add("di_id", OracleType.Number).Value = di_id;
					cmd.Parameters.Add("di_ngay", OracleType.VarChar, 10).Value = di_ngay;
					cmd.Parameters.Add("di_dongia", OracleType.Number).Value = di_dongia;
					cmd.Parameters.Add("di_thietyeu", OracleType.Number).Value = di_thietyeu;
					cmd.Parameters.Add("di_userid", OracleType.Number).Value = di_userid;
					irec = cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch (OracleException ex)
			{
				upd_di_error(ex.Message, sComputer, "di_dmtpngay");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_di_dmtdngay(long di_id, string di_ngay,decimal di_dongia, int di_userid)
		{
			sql = "update " + user + ".di_dmtdngay set dongia=:di_dongia,userid=:di_userid where id=:di_id and to_char(ngay,'dd/mm/yyyy')=:di_ngay";
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd = new OracleCommand(sql, con);
				cmd.CommandType = CommandType.Text;
				cmd.Parameters.Add("di_dongia", OracleType.Number).Value = di_dongia;
				cmd.Parameters.Add("di_userid", OracleType.Number).Value = di_userid;
				cmd.Parameters.Add("di_id", OracleType.Number).Value = di_id;
				cmd.Parameters.Add("di_ngay", OracleType.VarChar, 10).Value = di_ngay;
				int irec = cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec == 0)
				{
					sql = "insert into " + user + ".di_dmtdngay (id,ngay,dongia,userid) values (:di_id,to_date(:di_ngay,'dd/mm/yyyy'),:di_dongia,:di_userid)";
					cmd = new OracleCommand(sql, con);
					cmd.CommandType = CommandType.Text;
					cmd.Parameters.Add("di_id", OracleType.Number).Value = di_id;
					cmd.Parameters.Add("di_ngay", OracleType.VarChar, 10).Value = di_ngay;
					cmd.Parameters.Add("di_dongia", OracleType.Number).Value = di_dongia;
					cmd.Parameters.Add("di_userid", OracleType.Number).Value = di_userid;
					irec = cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch (OracleException ex)
			{
				upd_di_error(ex.Message, sComputer, "di_dmtdngay");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_di_dmthucdon(long di_id, decimal di_stt, long di_idchedoan, string di_idgioan, string di_ma, string di_ten, decimal di_dongia,decimal di_e,decimal di_p,decimal di_l,decimal di_g,int di_benhly,int di_userid)
		{
			sql = "update " + user + ".di_dmthucdon set stt=:di_stt,idchedoan=:di_idchedoan,idgioan=:di_idgioan,";
			sql += "ma=:di_ma,ten=:di_ten,dongia=:di_dongia,e=:di_e,p=:di_p,l=:di_l,g=:di_g,benhly=:di_benhly,userid=:di_userid ";
			sql +=" where id=:di_id";
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd = new OracleCommand(sql, con);
				cmd.CommandType = CommandType.Text;
				cmd.Parameters.Add("di_stt", OracleType.Number).Value = di_stt;
				cmd.Parameters.Add("di_idchedoan", OracleType.Number).Value = di_idchedoan;
				cmd.Parameters.Add("di_idgioan", OracleType.VarChar,20).Value = di_idgioan;
				cmd.Parameters.Add("di_ma", OracleType.VarChar, 10).Value = di_ma;
				cmd.Parameters.Add("di_ten", OracleType.NVarChar,254).Value = di_ten;
				cmd.Parameters.Add("di_dongia", OracleType.Number).Value = di_dongia;
				cmd.Parameters.Add("di_e", OracleType.Number).Value = di_e;
				cmd.Parameters.Add("di_p", OracleType.Number).Value = di_p;
				cmd.Parameters.Add("di_l", OracleType.Number).Value = di_l;
				cmd.Parameters.Add("di_g", OracleType.Number).Value = di_g;
				cmd.Parameters.Add("di_benhly", OracleType.Number).Value = di_benhly;
				cmd.Parameters.Add("di_userid", OracleType.Number).Value = di_userid;
				cmd.Parameters.Add("di_id", OracleType.Number).Value = di_id;
				int irec = cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec == 0)
				{
					sql = "insert into " + user + ".di_dmthucdon (id,stt,idchedoan,idgioan,ma,ten,dongia,e,p,l,g,benhly,userid) values (:di_id,:di_stt,:di_idchedoan,:di_idgioan,:di_ma,:di_ten,:di_dongia,:di_e,:di_p,:di_l,:di_g,:di_benhly,:di_userid)";
					cmd = new OracleCommand(sql, con);
					cmd.CommandType = CommandType.Text;
					cmd.Parameters.Add("di_id", OracleType.Number).Value = di_id;
					cmd.Parameters.Add("di_stt", OracleType.Number).Value = di_stt;
					cmd.Parameters.Add("di_idchedoan", OracleType.Number).Value = di_idchedoan;
					cmd.Parameters.Add("di_idgioan", OracleType.VarChar, 20).Value = di_idgioan;
					cmd.Parameters.Add("di_ma", OracleType.VarChar, 10).Value = di_ma;
					cmd.Parameters.Add("di_ten", OracleType.NVarChar,254).Value = di_ten;
					cmd.Parameters.Add("di_dongia", OracleType.Number).Value = di_dongia;
					cmd.Parameters.Add("di_e", OracleType.Number).Value = di_e;
					cmd.Parameters.Add("di_p", OracleType.Number).Value = di_p;
					cmd.Parameters.Add("di_l", OracleType.Number).Value = di_l;
					cmd.Parameters.Add("di_g", OracleType.Number).Value = di_g;
					cmd.Parameters.Add("di_benhly", OracleType.Number).Value = di_benhly;
					cmd.Parameters.Add("di_userid", OracleType.Number).Value = di_userid;
					irec = cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch (OracleException ex)
			{
				upd_di_error(ex.Message, sComputer, "di_dmthucdon");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_di_dmthucdonct(long di_id, decimal di_stt, long di_idthucdon, string di_tuan, string di_thu, decimal di_dongia)
		{
			sql = "update " + user + ".di_dmthucdonct set stt=:di_stt,idthucdon=:di_idthucdon,tuan=:di_tuan,thu=:di_thu,dongia=:di_dongia where id=:di_id";
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd = new OracleCommand(sql, con);
				cmd.CommandType = CommandType.Text;
				cmd.Parameters.Add("di_stt", OracleType.Number).Value = di_stt;
				cmd.Parameters.Add("di_idthucdon", OracleType.Number).Value = di_idthucdon;
				cmd.Parameters.Add("di_tuan", OracleType.VarChar, 2).Value = di_tuan;
				cmd.Parameters.Add("di_thu", OracleType.VarChar, 3).Value = di_thu;
				cmd.Parameters.Add("di_dongia", OracleType.Number).Value = di_dongia;
				cmd.Parameters.Add("di_id", OracleType.Number).Value = di_id;
				int irec = cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec == 0)
				{
					sql = "insert into " + user + ".di_dmthucdonct (id,stt,idthucdon,tuan,thu,dongia) values (:di_id,:di_stt,:di_idthucdon,:di_tuan,:di_thu,:di_dongia)";
					cmd = new OracleCommand(sql, con);
					cmd.CommandType = CommandType.Text;
					cmd.Parameters.Add("di_id", OracleType.Number).Value = di_id;
					cmd.Parameters.Add("di_stt", OracleType.Number).Value = di_stt;
					cmd.Parameters.Add("di_idthucdon", OracleType.Number).Value = di_idthucdon;
					cmd.Parameters.Add("di_tuan", OracleType.VarChar, 2).Value = di_tuan;
					cmd.Parameters.Add("di_thu", OracleType.VarChar, 3).Value = di_thu;
					cmd.Parameters.Add("di_dongia", OracleType.Number).Value = di_dongia;
					irec = cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch (OracleException ex)
			{
				upd_di_error(ex.Message, sComputer, "di_dmthucdonct");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_di_dmthucdontp(long di_id, decimal di_stt, long di_idthucdonct, long di_idthucpham, decimal di_soluong,int di_tt,decimal di_e,decimal di_p,decimal di_l,decimal di_g)
		{
			sql = "update " + user + ".di_dmthucdontp set stt=:di_stt,idthucdonct=:di_idthucdonct,idthucpham=:di_idthucpham,soluong=:di_soluong,tt=:di_tt,e=:di_e,p=:di_p,l=:di_l,g=:di_g where id=:di_id";
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd = new OracleCommand(sql, con);
				cmd.CommandType = CommandType.Text;
				cmd.Parameters.Add("di_stt", OracleType.Number).Value = di_stt;
				cmd.Parameters.Add("di_idthucdonct", OracleType.Number).Value = di_idthucdonct;
				cmd.Parameters.Add("di_idthucpham", OracleType.Number).Value = di_idthucpham;
				cmd.Parameters.Add("di_soluong", OracleType.Number).Value = di_soluong;
				cmd.Parameters.Add("di_tt", OracleType.Number).Value = di_tt;
				cmd.Parameters.Add("di_e", OracleType.Number).Value = di_e;
				cmd.Parameters.Add("di_p", OracleType.Number).Value = di_p;
				cmd.Parameters.Add("di_l", OracleType.Number).Value = di_l;
				cmd.Parameters.Add("di_g", OracleType.Number).Value = di_g;
				cmd.Parameters.Add("di_id", OracleType.Number).Value = di_id;
				int irec = cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec == 0)
				{
					sql = "insert into " + user + ".di_dmthucdontp (id,stt,idthucdonct,idthucpham,soluong,tt,e,p,l,g) values (:di_id,:di_stt,:di_idthucdonct,:di_idthucpham,:di_soluong,:di_tt,:di_e,:di_p,:di_l,:di_g)";
					cmd = new OracleCommand(sql, con);
					cmd.CommandType = CommandType.Text;
					cmd.Parameters.Add("di_id", OracleType.Number).Value = di_id;
					cmd.Parameters.Add("di_stt", OracleType.Number).Value = di_stt;
					cmd.Parameters.Add("di_idthucdonct", OracleType.Number).Value = di_idthucdonct;
					cmd.Parameters.Add("di_idthucpham", OracleType.Number).Value = di_idthucpham;
					cmd.Parameters.Add("di_soluong", OracleType.Number).Value = di_soluong;
					cmd.Parameters.Add("di_tt", OracleType.Number).Value = di_tt;
					cmd.Parameters.Add("di_e", OracleType.Number).Value = di_e;
					cmd.Parameters.Add("di_p", OracleType.Number).Value = di_p;
					cmd.Parameters.Add("di_l", OracleType.Number).Value = di_l;
					cmd.Parameters.Add("di_g", OracleType.Number).Value = di_g;
					irec = cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch (OracleException ex)
			{
				upd_di_error(ex.Message, sComputer, "di_dmthucdontp");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_di_thongso(long di_id, string di_loai, string di_ten)
		{
			sql = "update " + user + ".di_thongso set loai=:di_loai,ten=:di_ten where id=:di_id";
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd = new OracleCommand(sql, con);
				cmd.CommandType = CommandType.Text;
				cmd.Parameters.Add("di_loai", OracleType.VarChar, 50).Value = di_loai;
				cmd.Parameters.Add("di_ten", OracleType.NVarChar,254).Value = di_ten;
				cmd.Parameters.Add("di_id", OracleType.Number).Value = di_id;
				int irec = cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec == 0)
				{
					sql = "insert into " + user + ".di_thongso (id,loai,ten) values (:di_id,:di_loai,:di_ten)";
					cmd = new OracleCommand(sql, con);
					cmd.CommandType = CommandType.Text;
					cmd.Parameters.Add("di_id", OracleType.Number).Value = di_id;
					cmd.Parameters.Add("di_loai", OracleType.VarChar, 50).Value = di_loai;
					cmd.Parameters.Add("di_ten", OracleType.NVarChar,254).Value = di_ten;
					irec = cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch (OracleException ex)
			{
				upd_di_error(ex.Message, sComputer, "di_thongso");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_di_dlogin(long di_id, string di_hoten, string di_userid, string di_password_, string di_right_, int di_tao, int di_admin)
		{
			sql = "update " + user + ".di_dlogin set hoten=:di_hoten,userid=:di_userid,password_=:di_password_,right_=:di_right_,tao=:di_tao,admin=:di_admin where id=:di_id";
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd = new OracleCommand(sql, con);
				cmd.CommandType = CommandType.Text;
				cmd.Parameters.Add("di_hoten", OracleType.NVarChar,254).Value = di_hoten;
				cmd.Parameters.Add("di_userid", OracleType.VarChar, 20).Value = di_userid;
				cmd.Parameters.Add("di_password_", OracleType.VarChar, 20).Value = di_password_;
				cmd.Parameters.Add("di_right_", OracleType.NVarChar,1000).Value = di_right_;
				cmd.Parameters.Add("di_tao", OracleType.Number).Value = di_tao;
				cmd.Parameters.Add("di_admin", OracleType.Number).Value = di_admin;
				cmd.Parameters.Add("di_id", OracleType.Number).Value = di_id;
				int irec = cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec == 0)
				{
					sql = "insert into " + user + ".di_dlogin (id,hoten,userid,password_,right_,tao,admin) values (:di_id,:di_hoten,:di_userid,:di_password_,:di_right_,:di_tao,:di_admin)";
					cmd = new OracleCommand(sql, con);
					cmd.CommandType = CommandType.Text;
					cmd.Parameters.Add("di_id", OracleType.Number).Value = di_id;
					cmd.Parameters.Add("di_hoten", OracleType.NVarChar,254).Value = di_hoten;
					cmd.Parameters.Add("di_userid", OracleType.VarChar, 20).Value = di_userid;
					cmd.Parameters.Add("di_password_", OracleType.VarChar, 20).Value = di_password_;
					cmd.Parameters.Add("di_right_", OracleType.NVarChar,1000).Value = di_right_;
					cmd.Parameters.Add("di_tao", OracleType.Number).Value = di_tao;
					cmd.Parameters.Add("di_admin", OracleType.Number).Value = di_admin;
					irec = cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch (OracleException ex)
			{
				upd_di_error(ex.Message, sComputer, "di_dlogin");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_di_dlogin_right(long di_id, string di_right_)
		{
			sql = "update " + user + ".di_dlogin set right_=:di_right_ where id=:di_id";
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd = new OracleCommand(sql, con);
				cmd.CommandType = CommandType.Text;
				cmd.Parameters.Add("di_right_", OracleType.NVarChar,1000).Value = di_right_;
				cmd.Parameters.Add("di_id", OracleType.Number).Value = di_id;
				cmd.ExecuteNonQuery();
				cmd.Dispose();
			}
			catch (Exception ex)
			{
				upd_di_error(ex.Message, sComputer, "di_dlogin");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}
			return true;
		}

		public void updrec(DataTable dt, long id, string userid, string password, string right)
		{
			string exp = "id=" + id;
			DataRow r = getrowbyid(dt, exp);
			if (r == null)
			{
				DataRow nrow = dt.NewRow();
				nrow["id"] = id;
				nrow["userid"] = userid;
				nrow["password_"] = password;
				nrow["right_"] = right;
				dt.Rows.Add(nrow);
			}
			else
			{
				DataRow[] dr = dt.Select(exp);
				dr[0]["right_"] = right;
			}
		}

		public void updrec_right(DataTable dt, long id, string right)
		{
			string exp = "id=" + id;
			DataRow r = getrowbyid(dt, exp);
			if (r == null)
			{
				DataRow nrow = dt.NewRow();
				nrow["id"] = id;
				nrow["right_"] = right;
				dt.Rows.Add(nrow);
			}
			else
			{
				DataRow[] dr = dt.Select(exp);
				dr[0]["right_"] = right;
			}
		}

		public int di_loaivp
		{
			get
			{
				try
				{
					DataSet ds = get_data("select ten from " + user + ".di_thongso where id=1");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch { return 0; }
			}
		}

		public bool bdi_vpkhoa
		{
			get
			{
				try
				{
					DataSet ds = get_data("select ten from " + user + ".di_thongso where id=2");
					return ds.Tables[0].Rows[0][0].ToString() == "1";
				}
				catch { return false; }
			}
		}

		private long get_capid_may(int m_ma, string m_computer)
		{
			sql = "update " + user + ".d_capid set id=id+1 where ma=:m_ma and computer=:m_computer";
			con = new OracleConnection(sConn);
			con.Open();
			cmd = new OracleCommand(sql, con);
			cmd.CommandType = CommandType.Text;
			cmd.Parameters.Add("m_ma", OracleType.Number).Value = m_ma;
			cmd.Parameters.Add("m_computer", OracleType.VarChar, 20).Value = m_computer;
			int irec = cmd.ExecuteNonQuery();
			cmd.Dispose();
			if (irec == 0)
			{
				sql = "insert into " + user + ".d_capid(ma,ten,id,computer) values (:m_ma,:m_ten,1,:m_computer)";
				cmd = new OracleCommand(sql, con);
				cmd.CommandType = CommandType.Text;
				cmd.Parameters.Add("m_ma", OracleType.Number).Value = m_ma;
				cmd.Parameters.Add("m_ten", OracleType.VarChar, 20).Value = m_computer;
				cmd.Parameters.Add("m_computer", OracleType.VarChar, 20).Value = m_computer;
				cmd.ExecuteNonQuery();
				cmd.Dispose();
			}
			sql = "select id from " + user + ".d_capid where ma=" + m_ma + " and computer='" + m_computer + "'";
			cmd = new OracleCommand(sql, con);
			cmd.CommandType = CommandType.Text;
			dest = new OracleDataAdapter(cmd);
			ds = new DataSet();
			dest.Fill(ds);
			cmd.Dispose();
			con.Close();con.Dispose();
			return long.Parse(ds.Tables[0].Rows[0][0].ToString());
		}

		public long get_id_di_duyet { get { return long.Parse(iRownum.ToString().PadLeft(3, '0') + get_capid_may(-999, sComputer).ToString().PadLeft(9, '0')); } }
		public long get_id_di_kthucdonll { get { return long.Parse(iRownum.ToString().PadLeft(3, '0') + get_capid_may(-998, sComputer).ToString().PadLeft(9, '0')); } }
		public long get_id_di_thucdonll { get { return long.Parse(iRownum.ToString().PadLeft(3, '0') + get_capid_may(-997, sComputer).ToString().PadLeft(9, '0')); } }
		public long get_id_di_nauan { get { return long.Parse(iRownum.ToString().PadLeft(3, '0') + get_capid_may(-996, sComputer).ToString().PadLeft(9, '0')); } }
		public long get_id_di_dmthucdon { get { return get_capid(-995); } }

		public bool upd_di_duyet(string mmyy, long id, string ngay, string makp, int phieu, int sobn, int hienco, int vao, int ra, int cat, int bao,int userid)
		{
			con = new OracleConnection(sConn);
			con.Open();
			string sql = "update " + user + mmyy + ".di_duyet set sobn=" + sobn + ",hienco=" + hienco + ",vao=" + vao + ",ra=" + ra + ",cat=" + cat + ",bao=" + bao + " where id=" + id;
			cmd = new OracleCommand(sql, con);
			try
			{
				if (cmd.ExecuteNonQuery() == 0)
				{
					sql = "insert into " + user + mmyy + ".di_duyet(id,ngay,makp,phieu,sobn,hienco,vao,ra,cat,bao,done,userid) values(" + id + ",to_date('" + ngay + "','dd/mm/yyyy'),'" + makp + "'," + phieu + "," + sobn + "," + hienco + "," + vao + "," + ra + "," + cat + "," + bao + ",0," + userid + ")";
					cmd.CommandText = sql;
					cmd.ExecuteNonQuery();
				}
			}
			catch (Exception ex) { upd_di_error(ex.Message, sComputer, "di_duyet"); return false; }
			finally {con.Close();con.Dispose();}
			return true;
		}
		public bool upd_di_kthucdonll1(string mmyy, long id, long idduyet,string mabn, long maql, long idkhoa, int madoituong, int idcu, int moi, int dacbiet, string giuong,string maicd,string chandoan,string mabs,string yta)
		{
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				string sql = "update " + user + mmyy + ".di_kthucdonll set mabn='" + mabn + "',maql=" + maql + ",idkhoa=" + idkhoa ;
				sql+=",madoituong=" + madoituong + ",idcu=" + idcu + ",moi=" + moi + ",dacbiet=" + dacbiet + ",giuong='" + giuong + "'";
				sql+=",maicd='"+maicd+"'";
				sql+=",chandoan=:chandoan";
				sql+=",mabs='"+mabs+"',yta='"+yta+"' where id=" + id;
				cmd = new OracleCommand(sql, con);
				cmd.Parameters.Add("chandoan", OracleType.NVarChar,254).Value = chandoan;
				if (cmd.ExecuteNonQuery() == 0)
				{
					sql = "insert into " + user + mmyy + ".di_kthucdonll(id,idduyet,mabn,maql,idkhoa,madoituong,idcu,moi,dacbiet,giuong,maicd,chandoan,mabs,yta)";
					sql += " values(" + id + "," + idduyet + ",'" + mabn + "'," + maql + "," + idkhoa + "," + madoituong + "," + idcu + "," + moi + "," + dacbiet + ",'" + giuong + "','"+maicd+"',:chandoan,'"+mabs+"','"+yta+"')";
					cmd.CommandText = sql;
					cmd.Parameters.Add("chandoan", OracleType.NVarChar,254).Value = chandoan;
					cmd.ExecuteNonQuery();
				}
			}
			catch (Exception ex) { upd_di_error(ex.Message, sComputer, "di_kthucdonll"); return false; }
			finally {con.Close();con.Dispose();}
			return true;
		}
		// hien sua
		public bool upd_di_kthucdonll(string mmyy, long id, long idduyet,string mabn, long maql, long idkhoa, int madoituong, int idcu, int moi, int dacbiet, string giuong,string maicd,string chandoan,string mabs,string yta,string ghichu)
		{
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				string sql = "update " + user + mmyy + ".di_kthucdonll set mabn='" + mabn + "',maql=" + maql + ",idkhoa=" + idkhoa ;
				sql+=",madoituong=" + madoituong + ",idcu=" + idcu + ",moi=" + moi + ",dacbiet=" + dacbiet + ",giuong='" + giuong + "'";
				sql+=",maicd='"+maicd+"'";
				sql+=",chandoan=:chandoan";
				sql+=",mabs='"+mabs+"',yta='"+yta+"',ghichu=:ghichu where id=" + id;
				cmd = new OracleCommand(sql, con);
				cmd.Parameters.Add("chandoan", OracleType.NVarChar,254).Value = chandoan;
				cmd.Parameters.Add("ghichu", OracleType.NVarChar,254).Value = ghichu;
				if (cmd.ExecuteNonQuery() == 0)
				{
					sql = "insert into " + user + mmyy + ".di_kthucdonll(id,idduyet,mabn,maql,idkhoa,madoituong,idcu,moi,dacbiet,giuong,maicd,chandoan,mabs,yta,ghichu)";
					sql += " values(" + id + "," + idduyet + ",'" + mabn + "'," + maql + "," + idkhoa + "," + madoituong + "," + idcu + "," + moi + "," + dacbiet + ",'" + giuong + "','"+maicd+"',:chandoan,'"+mabs+"','"+yta+"',:ghichu)";
					cmd.CommandText = sql;
					cmd.Parameters.Add("chandoan", OracleType.NVarChar,254).Value = chandoan;
					cmd.Parameters.Add("ghichu", OracleType.NVarChar,254).Value = ghichu;
					cmd.ExecuteNonQuery();
				}
			}
			catch (Exception ex) { upd_di_error(ex.Message, sComputer, "di_kthucdonll"); return false; }
			finally {con.Close();con.Dispose();}
			return true;
		}
		public bool upd_di_kthucdonct(string mmyy, long id, int stt, int idgioan, int idthucdon, int soluong,decimal e,decimal p,decimal l,decimal g,int idchedoan,decimal dongia)
		{
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				string sql = "update " + user + mmyy + ".di_kthucdonct set idgioan="+idgioan+",idthucdon="+idthucdon+",dongia="+dongia+",soluong=" + soluong + ",e="+e+",p="+p+",l="+l+",g="+g+",idchedoan="+idchedoan+" where id=" + id + " and stt=" + stt;
				cmd = new OracleCommand(sql, con);
				if (cmd.ExecuteNonQuery() == 0)
				{
					sql = "insert into " + user + mmyy + ".di_kthucdonct(id,stt,idgioan,idthucdon,soluong,e,p,l,g,idchedoan,dongia)";
					sql += " values(" + id + "," + stt + "," + idgioan + "," + idthucdon + "," + soluong + "," + e+","+p+","+l+","+g+","+idchedoan+","+dongia + ")";
					cmd.CommandText = sql;
					cmd.ExecuteNonQuery();
				}
			}
			catch (Exception ex) { upd_di_error(ex.Message, sComputer, "di_kthucdonct"); return false; }
			finally {con.Close();con.Dispose();}
			return true;
		}
		public bool upd_di_anlong(string mmyy, long id, int idchedoan, string sang, string chieu)
		{
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				string sql = "update " + user + mmyy + ".di_anlong set sang=:sang,chieu=:chieu where id=" + id;
				cmd = new OracleCommand(sql, con);
				cmd.Parameters.Add("sang", OracleType.NVarChar,1000).Value = sang;
				cmd.Parameters.Add("chieu", OracleType.NVarChar,1000).Value = chieu;
				if (cmd.ExecuteNonQuery() == 0)
				{
					sql = "insert into " + user + mmyy + ".di_anlong(id,idchedoan,sang,chieu)";
					sql += " values(" + id + "," + idchedoan + ":sang,:chieu)";
					cmd.CommandText = sql;
					cmd.Parameters.Add("sang", OracleType.NVarChar,1000).Value = sang;
					cmd.Parameters.Add("chieu", OracleType.NVarChar,1000).Value = chieu;
					cmd.ExecuteNonQuery();
				}
			}
			catch (Exception ex) { upd_di_error(ex.Message, sComputer, "di_anlong"); return false; }
			finally {con.Close();con.Dispose();}
			return true;
		}
		public bool upd_di_thucdonll(string mmyy, long id, long idduyet, string mabn, long maql, long idkhoa,string makp,string ngay,int phieu,int madoituong, int idcu, int moi, int dacbiet, string giuong,string mabs,string yta, int userid, int loai)
		{
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				string sql = "update " + user + mmyy + ".di_thucdonll set mabn='" + mabn + "',maql=" + maql + ",idkhoa=" + idkhoa + ",makp='"+makp+"',ngay=to_date('"+ngay+"','dd/mm/yyyy'),phieu="+phieu+",madoituong=" + madoituong + ",idcu=" + idcu + ",moi=" + moi + ",dacbiet=" + dacbiet + ",giuong='" + giuong + "',mabs='"+mabs+"',yta='"+yta+"', loai ="+loai+" where id=" + id;
				cmd = new OracleCommand(sql, con);
				if (cmd.ExecuteNonQuery() == 0)
				{
					sql = "insert into " + user + mmyy + ".di_thucdonll(id,idduyet,mabn,maql,idkhoa,makp,ngay,phieu,madoituong,idcu,moi,dacbiet,giuong,mabs,yta,userid, loai)";
					sql += " values(" + id + "," + idduyet + ",'" + mabn + "'," + maql + "," + idkhoa + ",'"+makp+"',to_date('" + ngay+"','dd/mm/yyyy'),"+phieu+","+madoituong + "," + idcu + "," + moi + "," + dacbiet + ",'" + giuong + "','" + mabs+"','"+yta+"',"+userid+","+loai+")";
					cmd.CommandText = sql;
					cmd.ExecuteNonQuery();
				}
			}
			catch (Exception ex) { upd_di_error(ex.Message, sComputer, "di_thucdonll"); return false; }
			finally {con.Close();con.Dispose();}
			return true;
		}
		public bool upd_di_thucdonct__(string mmyy, long id, int stt, int idgioan, long idthucdon, int soluong,decimal e,decimal p,decimal l,decimal g,long idchedoan,decimal dongia,long vpkhoa)
		{
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				string sql = "update " + user + mmyy + ".di_thucdonct set idgioan="+idgioan+",idthucdon="+idthucdon+",soluong=" + soluong + ",e="+e+",p="+p+",l="+l+",g="+g+",idchedoan="+idchedoan+",vpkhoa="+vpkhoa+" where id=" + id + " and stt=" + stt;
				cmd = new OracleCommand(sql, con);
				if (cmd.ExecuteNonQuery() == 0)
				{
					sql = "insert into " + user + mmyy + ".di_thucdonct(id,stt,idgioan,idthucdon,soluong,e,p,l,g,idchedoan,dongia,vpkhoa)";
					sql += " values(" + id + "," + stt + "," + idgioan + "," + idthucdon + "," + soluong + "," + e+","+p+","+l+","+g+","+idchedoan+","+dongia + ","+vpkhoa+")";
					cmd.CommandText = sql;
					cmd.ExecuteNonQuery();
				}
			}
			catch (Exception ex) { upd_di_error(ex.Message, sComputer, "di_thucdonct"); return false; }
			finally {con.Close();con.Dispose();}
			return true;
		}
		public bool upd_di_thucdonct(string mmyy, long id, int stt, int idgioan, long idthucdon, int soluong,decimal e,decimal p,decimal l,decimal g,long idchedoan,decimal dongia,long vpkhoa)
		{
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				string sql = "update " + user + mmyy + ".di_thucdonct set idgioan="+idgioan+",idthucdon="+idthucdon+",soluong=" + soluong + ",slthuc="+soluong+",e="+e+",p="+p+",l="+l+",g="+g+",idchedoan="+idchedoan+",vpkhoa="+vpkhoa+" where id=" + id + " and stt=" + stt;
				cmd = new OracleCommand(sql, con);
				cmd.CommandType=CommandType.Text;
				if (cmd.ExecuteNonQuery() == 0)
				{
					cmd.Dispose();
					sql = "insert into " + user + mmyy + ".di_thucdonct(id,stt,idgioan,idthucdon,soluong,slthuc,e,p,l,g,idchedoan,dongia,vpkhoa)";
					sql += " values(" + id + "," + stt + "," + idgioan + "," + idthucdon + "," + soluong + ","+soluong+"," + e+","+p+","+l+","+g+","+idchedoan+","+dongia + ","+vpkhoa+")";
					cmd = new OracleCommand(sql, con);
					cmd.CommandType=CommandType.Text;
					cmd.ExecuteNonQuery();
				}
			}
			catch (Exception ex) { upd_di_error(ex.Message, sComputer, "di_thucdonct"); return false; }
			finally {con.Close();con.Dispose();}
			return true;
		}
		public bool upd_di_thucdonct(string mmyy, long id, int stt, int idgioan, long idthucdon, int soluong,int slthuc,decimal e,decimal p,decimal l,decimal g,long idchedoan,decimal dongia,long vpkhoa)
		{
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				string sql = "update " + user + mmyy + ".di_thucdonct set idgioan="+idgioan+",idthucdon="+idthucdon+",soluong=" + soluong + ",slthuc=slthuc+"+slthuc+",e="+e+",p="+p+",l="+l+",g="+g+",idchedoan="+idchedoan+",vpkhoa="+vpkhoa+" where id=" + id + " and stt=" + stt;
				cmd = new OracleCommand(sql, con);
				cmd.CommandType=CommandType.Text;
				if (cmd.ExecuteNonQuery() == 0)
				{
					cmd.Dispose();
					sql = "insert into " + user + mmyy + ".di_thucdonct(id,stt,idgioan,idthucdon,soluong,slthuc,e,p,l,g,idchedoan,dongia,vpkhoa)";
					sql += " values(" + id + "," + stt + "," + idgioan + "," + idthucdon + "," + soluong + ","+slthuc+"," + e+","+p+","+l+","+g+","+idchedoan+","+dongia + ","+vpkhoa+")";
					cmd = new OracleCommand(sql, con);
					cmd.CommandType=CommandType.Text;
					cmd.ExecuteNonQuery();
				}
			}
			catch (Exception ex) { upd_di_error(ex.Message, sComputer, "di_thucdonct"); return false; }
			finally {con.Close();con.Dispose();}
			return true;
		}
		public bool upd_di_nauan(string mmyy, long id, string ngay, string ghichu1, string ghichu2, int userid)
		{
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				string sql = "update " + user + mmyy + ".di_nauan set ghichu1=:ghichu1,ghichu2=:ghichu2,ngayud=now() where id=" + id;
				cmd = new OracleCommand(sql, con);
				cmd.Parameters.Add("ghichu1", OracleType.NVarChar,1000).Value = ghichu1;
				cmd.Parameters.Add("ghichu2", OracleType.NVarChar,1000).Value = ghichu2;
				if (cmd.ExecuteNonQuery() == 0)
				{
					sql = "insert into " + user + mmyy + ".di_nauan(id,ngay,ghichu1,ghichu2,userid,ngayud)";
					sql += " values(" + id + ",to_date('" + ngay + "','dd/mm/yyyy'),:ghichu1,:ghichu2," + userid + ",now())";
					cmd.CommandText = sql;
					cmd.ExecuteNonQuery();
				}
			}
			catch (Exception ex) { upd_di_error(ex.Message, sComputer, "di_nauan"); return false; }
			finally {con.Close();con.Dispose();}
			return true;
		}
		public bool upd_di_nauanct(string mmyy, long id, int idgioan, string chedoan, string thucpham)
		{
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				string sql = "update " + user + mmyy + ".di_nauanct set chedoan=:chedoan,thucpham=:thucpham where id=" + id;
				cmd = new OracleCommand(sql, con);
				cmd.Parameters.Add("chedoan", OracleType.NVarChar,1000).Value = chedoan;
				cmd.Parameters.Add("thucpham", OracleType.NVarChar,1000).Value = thucpham;
				if (cmd.ExecuteNonQuery() == 0)
				{
					sql = "insert into " + user + mmyy + ".di_nauanct(id,idgioan,chedoan,thucpham)";
					sql += " values(" + id + "," + idgioan + ",:chedoan,:thucpham)";
					cmd.CommandText = sql;
					cmd.ExecuteNonQuery();
				}
			}
			catch (Exception ex) { upd_di_error(ex.Message, sComputer, "di_nauanct"); return false; }
			finally {con.Close();con.Dispose();}
			return true;
		}

		public bool upd_di_giabenhly(decimal tu,decimal den,decimal dongia,int userid)
		{
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				string sql = "update " + user + ".di_giabenhly set dongia=:dongia,userid=:userid where tu=" + tu+" and den="+den;
				cmd = new OracleCommand(sql, con);
				cmd.Parameters.Add("dongia", OracleType.Number).Value = dongia;
				cmd.Parameters.Add("userid", OracleType.Number).Value = userid;
				if (cmd.ExecuteNonQuery() == 0)
				{
					sql = "insert into " + user + ".di_giabenhly(tu,den,dongia,userid)";
					sql += " values(" + tu + "," + den + ",:dongia,:userid)";
					cmd.CommandText = sql;
					cmd.ExecuteNonQuery();
				}
			}
			catch (Exception ex) { upd_di_error(ex.Message, sComputer, "di_giabenhly"); return false; }
			finally {con.Close();con.Dispose();}
			return true;
		}

		public bool upd_di_dmtdche(long id,string ngay,string mabn,long idkthucdonct,int stt,long idchedoan,int idgioan,decimal e,decimal p,decimal l,decimal g,decimal soluong)
		{
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				string sql = "update " + user + ".di_dmtdche set ngay=to_date('"+ngay+"','dd/mm/yyyy'),mabn='"+mabn+"',idkthucdonct="+idkthucdonct+",stt="+stt+",idchedoan="+idchedoan+",idgioan="+idgioan+",e="+e+",p="+p+",l="+l+",g="+g+",soluong="+soluong+" where id="+id;
				cmd = new OracleCommand(sql, con);
				if (cmd.ExecuteNonQuery() == 0)
				{
					sql = "insert into " + user + ".di_dmtdche(id,ngay,mabn,idkthucdonct,stt,idchedoan,idgioan,e,p,l,g,soluong)";
					sql += " values(" + id + ",to_date('" + ngay+ "','dd/mm/yyyy'),'" + mabn + "'," + idkthucdonct + "," +stt + "," + idchedoan+","+idgioan +","+ e + "," + p + "," + l + "," + g + "," + soluong + ")";
					cmd.CommandText = sql;
					cmd.ExecuteNonQuery();
				}
			}
			catch (Exception ex) { upd_di_error(ex.Message, sComputer, "di_dmtdche"); return false; }
			finally {con.Close();con.Dispose();}
			return true;
		}

		public bool upd_di_dmtdicd(long id, string maicd,string chandoan,long idchedoan, decimal e, decimal p, decimal l, decimal g)
		{
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				string sql = "update " + user + ".di_dmtdicd set maicd='" + maicd + "'";
				sql+=",chandoan=:chandoan";
				sql+=",e=" + e + ",p=" + p + ",l=" + l + ",g=" + g +" where id="+id;
				cmd = new OracleCommand(sql, con);
				cmd.Parameters.Add("chandoan", OracleType.NVarChar,254).Value = chandoan;
				if (cmd.ExecuteNonQuery() == 0)
				{
					sql = "insert into " + user + ".di_dmtdicd(id,maicd,chandoan,idchedoan,e,p,l,g)";
					sql += " values(" + id + ",'" + maicd + "',:chandoan," + idchedoan + "," + e + "," + p + "," + l + "," + g +")";
					cmd.CommandText = sql;
					cmd.Parameters.Add("chandoan", OracleType.NVarChar,254).Value = chandoan;
					cmd.ExecuteNonQuery();
				}
			}
			catch (Exception ex) { upd_di_error(ex.Message, sComputer, "di_dmtdicd"); return false; }
			finally {con.Close();con.Dispose();}
			return true;
		}

		public bool upd_di_ngayduyet(string mmyy,string makp,string ngay,long idduyet,int phieu, int loai)
		{
			con = new OracleConnection(sConn);
			con.Open();
			string sql = "update " + user + mmyy + ".di_ngayduyet set makp='" + makp + "' where makp='" + makp + "' and to_char(ngay,'dd/mm/yyyy')='" + ngay + "' and idduyet=" + idduyet + " and phieu=" + phieu + " and loai="+loai;
			cmd = new OracleCommand(sql, con);
			try
			{
				if (cmd.ExecuteNonQuery() == 0)
				{
					sql = "insert into " + user +mmyy+ ".di_ngayduyet(makp,ngay,idduyet,phieu,loai)";
					sql += " values('" + makp + "',to_date('" +ngay + "','dd/mm/yyyy')," + idduyet + "," + phieu + ","+loai+")";
					cmd.CommandText = sql;
					cmd.ExecuteNonQuery();
				}
			}
			catch (Exception ex) { upd_di_error(ex.Message, sComputer, "di_ngayduyet"); return false; }
			finally {con.Close();con.Dispose();}
			return true;
		}

		public void del_di_ngayduyet(string mmyy, string makp, string ngay,int phieu)
		{
			execute_data("delete from " + user + mmyy + ".di_ngayduyet where makp='" + makp + "' and to_char(ngay,'dd/mm/yyyy')='" + ngay + "' and phieu=" + phieu);
		}

		public bool get_di_ngayduyet(string s_mmyy,string makp,string ngay,int phieu)
		{
			sql = "select * from " + user + s_mmyy + ".di_ngayduyet where makp='"+makp+"' and to_char(ngay,'dd/mm/yyyy')='"+ngay+"' and phieu="+phieu;
			return get_data(sql).Tables[0].Rows.Count > 0;
		}

		public DataSet getinbaoan(string tu,string den,string cont,bool khoa)
		{
			string usr = user;
			sql = "select '' as mainkey,b.dacbiet,g.ten as nhom,k.ten as gioan,e.ten as thucdon,";
			sql+= "case when b.dacbiet=1 then f.ten else e.ten end as chedoan,e.ma as mathucdon,";
			sql+= "case when b.dacbiet=1 then f.ma else e.ma end as machedoan,";
			sql+= "to_char(a.ngay,'dd/mm/yyyy') as ngay,b.moi,b.giuong,";
			if (khoa) sql += "b.chandoan,";
			else sql += "j.chandoan,";
			sql += "h.hoten as tenbs,i.hoten as tenyta,d.mabn,d.hoten,d.hoten as ten,";
			sql += "to_number(to_char(sysdate,'yyyy'),'9999')-to_number(d.namsinh,'9999') as tuoi,d.namsinh,d.phai,";
			sql += "c.e,c.p,c.l,c.g,c.slthuc as soluong,c.dongia,c.slthuc*c.dongia as sotien,a.sobn,a.hienco,a.vao,a.ra,a.cat,a.bao,";
			sql += "g.stt as tt1,k.stt as tt2,f.stt as tt3, a.loai";
			if (khoa)
			{
				sql += " from xxx.di_duyet a inner join xxx.di_kthucdonll b on a.id=b.idduyet ";
				sql += " inner join xxx.di_kthucdonct c on b.id=c.id ";
			}
			else
			{
				sql += " from xxx.di_duyet a inner join xxx.di_thucdonll b on a.id=b.idduyet ";
				sql += " inner join xxx.di_thucdonct c on b.id=c.id ";
			}
			sql += " inner join " + usr + ".btdbn d on b.mabn=d.mabn ";
			sql += " left join " + usr + ".di_dmthucdon e on c.idthucdon=e.id ";
			sql += " inner join " + usr + ".di_dmchedoan f on c.idchedoan=f.id ";
			sql += " inner join " + usr + ".di_dmnhom g on f.idnhom=g.id ";
			sql += " left join " + usr + ".dmbs h on b.mabs=h.ma";
			sql += " left join " + usr + ".dmbs i on b.yta=h.ma ";
			if (!khoa) sql += " inner join xxx.di_kthucdonll j on b.id=j.id ";
			sql += " inner join " + usr + ".di_dmgioan k on c.idgioan=k.id ";
			sql += cont;
			sql += " order by b.dacbiet,g.stt,k.stt,f.stt";
			DataSet tmp = get_data_mmyy(sql, tu, den,false);
			ds = new DataSet();
			ds = tmp.Copy();
			ds.Clear();
			string s = "";
			DataRow[] dr;
			DataRow r1, r2;
			foreach (DataRow r in tmp.Tables[0].Rows)
			{
				sql = "nhom='" + r["nhom"].ToString() + "' and gioan='" + r["gioan"].ToString() + "' and chedoan='" + r["chedoan"].ToString() + "'";
				sql+=" and dacbiet="+int.Parse(r["dacbiet"].ToString());
				if (r["dacbiet"].ToString() == "1") sql += " and mabn='" + r["mabn"].ToString() + "'";
				r1 = getrowbyid(ds.Tables[0], sql);
				if (r1 == null)
				{
					r2 = ds.Tables[0].NewRow();
					r2["mainkey"] = r["dacbiet"].ToString() + r["tt1"].ToString().PadLeft(10, '0') + r["tt2"].ToString().PadLeft(10, '0') + r["tt3"].ToString().PadLeft(10, '0');
					r2["tt1"]=r["tt1"].ToString();
					r2["tt2"] = r["tt2"].ToString();
					r2["tt3"] = r["tt3"].ToString();
					r2["nhom"] = r["nhom"].ToString();
					r2["gioan"] = r["gioan"].ToString();
					r2["thucdon"] = r["thucdon"].ToString();
					r2["chedoan"] = r["chedoan"].ToString();
					r2["mathucdon"] = r["mathucdon"].ToString();
					r2["machedoan"]=r["machedoan"].ToString();
					r2["ngay"]=r["ngay"].ToString();
					r2["moi"] = r["moi"].ToString();
					r2["dacbiet"] = r["dacbiet"].ToString();
					r2["giuong"] = r["giuong"].ToString();
					r2["chandoan"] = r["chandoan"].ToString();
					r2["tenbs"] = r["tenbs"].ToString();
					r2["tenyta"] = r["tenyta"].ToString();
					r2["mabn"] = r["mabn"].ToString();
					r2["hoten"] = r["hoten"].ToString();
					r2["ten"] = holot_ten(r["ten"].ToString().Trim())+((r["giuong"].ToString()!="")?"("+r["giuong"].ToString().Trim()+")":"");
					r2["tuoi"] = r["tuoi"].ToString();
					r2["namsinh"] = r["namsinh"].ToString();
					r2["phai"] = r["phai"].ToString();
					r2["e"] = r["e"].ToString();
					r2["p"] = r["p"].ToString();
					r2["l"] = r["l"].ToString();
					r2["g"] = r["g"].ToString();
					r2["soluong"] = r["soluong"].ToString();
					r2["dongia"] = r["dongia"].ToString();
					r2["sotien"] = r["sotien"].ToString();
					r2["sobn"] = r["sobn"].ToString();
					r2["hienco"] = r["hienco"].ToString();
					r2["vao"] = r["vao"].ToString();
					r2["ra"] = r["ra"].ToString();
					r2["cat"] = r["cat"].ToString();
					r2["bao"] = r["bao"].ToString();
					r2["loai"] = r["loai"].ToString();
					ds.Tables[0].Rows.Add(r2);
				}
				else
				{
					dr = ds.Tables[0].Select(sql);
					if (dr.Length > 0)
					{
						s = dr[0]["ten"].ToString().Trim() + "," + holot_ten(r["ten"].ToString().Trim()) + ((r["giuong"].ToString() != "") ? "(" + r["giuong"].ToString().Trim() + ")" : "");
						dr[0]["soluong"] = decimal.Parse(dr[0]["soluong"].ToString()) + decimal.Parse(r["soluong"].ToString());
						dr[0]["sotien"] = decimal.Parse(dr[0]["sotien"].ToString()) + decimal.Parse(r["sotien"].ToString());
						dr[0]["ten"] = s;
					}
				}
			}
			return ds;
		}

		public DataSet getinbaoan_tra(string tu,string den,string cont,bool khoa)
		{
			string usr = user;
			sql = "select '' as mainkey,b.dacbiet,g.ten as nhom,k.ten as gioan,e.ten as thucdon,";
			sql+= "case when b.dacbiet=1 then f.ten else e.ten end as chedoan,e.ma as mathucdon,";
			sql+= "case when b.dacbiet=1 then f.ma else e.ma end as machedoan,";
			sql+= "to_char(a.ngay,'dd/mm/yyyy') as ngay,b.moi,b.giuong,";
			if (khoa) sql += "b.chandoan,";
			else sql += "j.chandoan,";
			sql += "h.hoten as tenbs,i.hoten as tenyta,d.mabn,d.hoten,d.hoten as ten,";
			sql += "to_number(to_char(sysdate,'yyyy'),'9999')-to_number(d.namsinh,'9999') as tuoi,d.namsinh,d.phai,";
			sql += "c.e,c.p,c.l,c.g,c.soluong,c.dongia,c.soluong*c.dongia as sotien,a.sobn,a.hienco,a.vao,a.ra,a.cat,a.bao,";
			sql += "nvl(g.stt,0) as tt1,nvl(k.stt,0) as tt2,nvl(f.stt,0) as tt3, a.loai";
			if (khoa)
			{
				sql += " from xxx.di_duyet a left join xxx.di_kthucdonll b on a.id=b.idduyet ";
				sql += " left join xxx.di_kthucdonct c on b.id=c.id ";
			}
			else
			{
				sql += " from xxx.di_duyet a inner join xxx.di_thucdonll b on a.id=b.idduyet ";
				sql += " inner join xxx.di_thucdonct c on b.id=c.id ";
			}
			sql += " inner join " + usr + ".btdbn d on b.mabn=d.mabn ";
			sql += " left join " + usr + ".di_dmthucdon e on c.idthucdon=e.id ";
			sql += " left join " + usr + ".di_dmchedoan f on c.idchedoan=f.id ";
			sql += " left join " + usr + ".di_dmnhom g on f.idnhom=g.id ";
			sql += " left join " + usr + ".dmbs h on b.mabs=h.ma";
			sql += " left join " + usr + ".dmbs i on b.yta=h.ma ";
			if (!khoa) sql += " left join xxx.di_kthucdonll j on b.id=j.id ";
			sql += " left join " + usr + ".di_dmgioan k on c.idgioan=k.id ";
			sql += cont;
			sql += " order by b.dacbiet,g.stt,k.stt,f.stt";
			DataSet tmp = get_data_mmyy(sql, tu, den,false);
			ds = new DataSet();
			ds = tmp.Copy();
			ds.Clear();
			string s = "";
			DataRow[] dr;
			DataRow r1, r2;
			foreach (DataRow r in tmp.Tables[0].Rows)
			{
				sql = "nhom='" + r["nhom"].ToString() + "' and gioan='" + r["gioan"].ToString() + "' and chedoan='" + r["chedoan"].ToString() + "'";
				sql+=" and dacbiet="+int.Parse(r["dacbiet"].ToString());
				if (r["dacbiet"].ToString() == "1") sql += " and mabn='" + r["mabn"].ToString() + "'";
				r1 = getrowbyid(ds.Tables[0], sql);
				if (r1 == null)
				{
					r2 = ds.Tables[0].NewRow();
					r2["mainkey"] = r["dacbiet"].ToString() + r["tt1"].ToString().PadLeft(10, '0') + r["tt2"].ToString().PadLeft(10, '0') + r["tt3"].ToString().PadLeft(10, '0');
					r2["tt1"]=r["tt1"].ToString();
					r2["tt2"] = r["tt2"].ToString();
					r2["tt3"] = r["tt3"].ToString();
					r2["nhom"] = r["nhom"].ToString();
					r2["gioan"] = r["gioan"].ToString();
					r2["thucdon"] = r["thucdon"].ToString();
					r2["chedoan"] = r["chedoan"].ToString();
					r2["mathucdon"] = r["mathucdon"].ToString();
					r2["machedoan"]=r["machedoan"].ToString();
					r2["ngay"]=r["ngay"].ToString();
					r2["moi"] = r["moi"].ToString();
					r2["dacbiet"] = r["dacbiet"].ToString();
					r2["giuong"] = r["giuong"].ToString();
					r2["chandoan"] = r["chandoan"].ToString();
					r2["tenbs"] = r["tenbs"].ToString();
					r2["tenyta"] = r["tenyta"].ToString();
					r2["mabn"] = r["mabn"].ToString();
					r2["hoten"] = r["hoten"].ToString();
					r2["ten"] = holot_ten(r["ten"].ToString().Trim())+((r["giuong"].ToString()!="")?"("+r["giuong"].ToString().Trim()+")":"");
					r2["tuoi"] = r["tuoi"].ToString();
					r2["namsinh"] = r["namsinh"].ToString();
					r2["phai"] = r["phai"].ToString();
					r2["e"] = r["e"].ToString();
					r2["p"] = r["p"].ToString();
					r2["l"] = r["l"].ToString();
					r2["g"] = r["g"].ToString();
					r2["soluong"] = r["soluong"].ToString();
					r2["dongia"] = r["dongia"].ToString();
					r2["sotien"] = r["sotien"].ToString();
					r2["sobn"] = r["sobn"].ToString();
					r2["hienco"] = r["hienco"].ToString();
					r2["vao"] = r["vao"].ToString();
					r2["ra"] = r["ra"].ToString();
					r2["cat"] = r["cat"].ToString();
					r2["bao"] = r["bao"].ToString();
					r2["loai"] = r["loai"].ToString();
					ds.Tables[0].Rows.Add(r2);
				}
				else
				{
					dr = ds.Tables[0].Select(sql);
					if (dr.Length > 0)
					{
						s = dr[0]["ten"].ToString().Trim() + "," + holot_ten(r["ten"].ToString().Trim()) + ((r["giuong"].ToString() != "") ? "(" + r["giuong"].ToString().Trim() + ")" : "");
						dr[0]["soluong"] = decimal.Parse(dr[0]["soluong"].ToString()) + decimal.Parse(r["soluong"].ToString());
						dr[0]["sotien"] = decimal.Parse(dr[0]["sotien"].ToString()) + decimal.Parse(r["sotien"].ToString());
						dr[0]["ten"] = s;
					}
				}
			}
			return ds;
		}

		public DataSet getinnauan1(string tu, string den, string cont)
		{
			string usr = user;
			sql = "select to_char(b.ngay,'dd/mm/yyyy') as ngay,to_char(b.ngay,'dd/mm/yyyy')||to_char(g.stt,'0000000000')||to_char(k.stt,'0000000000')||to_char(f.stt,'0000000000')||to_char(l.stt,'0000000000')||to_char(i.stt,'0000000000') as mainkey,";
			sql += "g.ten as nhom,k.ten as gioan,e.ten as chedoan,";
			sql += "i.ten as tenthucpham,i.dvt,sum(h.soluong) as soluong";            
			sql += " from xxx.di_duyet a inner join xxx.di_thucdonll b on a.id=b.idduyet ";
			sql += " inner join xxx.di_thucdonct c on b.id=c.id ";
			sql += " left join " + usr + ".di_dmthucdon e on c.idthucdon=e.id ";
			sql += " inner join " + usr + ".di_dmchedoan f on c.idchedoan=f.id ";
			sql += " inner join " + usr + ".di_dmnhom g on f.idnhom=g.id ";
			sql += " left join " + usr + ".di_dmthucdontp h on e.id=h.idthucdonct";
			sql += " left join " + usr + ".di_dmthucpham i on h.idthucpham=i.id ";
			sql += " inner join " + usr + ".di_dmgioan k on c.idgioan=k.id ";
			sql += " left join " + usr + ".di_dmloaitp l on i.idloai=l.id";
			sql += cont;
			sql += " group by to_char(b.ngay,'dd/mm/yyyy'),to_char(b.ngay,'dd/mm/yyyy')||to_char(g.stt,'0000000000')||to_char(k.stt,'0000000000')||to_char(f.stt,'0000000000')||to_char(l.stt,'0000000000')||to_char(i.stt,'0000000000'),";
			sql += "g.ten,k.ten,e.ten,i.ten,i.dvt";
			return get_data_mmyy(sql, tu, den, false);
		}

		public DataSet getinnauan2(string tu, string den, string cont)
		{
			string usr = user;
			sql = "select to_char(b.ngay,'dd/mm/yyyy') as ngay,";
			sql += "l.ten as loaithucpham,i.ten as tenthucpham,i.dvt,sum(h.soluong) as soluong";
			sql += " from xxx.di_duyet a inner join xxx.di_thucdonll b on a.id=b.idduyet ";
			sql += " inner join xxx.di_thucdonct c on b.id=c.id ";
			sql += " left join " + usr + ".di_dmthucdon e on c.idthucdon=e.id ";
			sql += " left join " + usr + ".di_dmthucdontp h on e.id=h.idthucdonct";
			sql += " left join " + usr + ".di_dmthucpham i on h.idthucpham=i.id ";
			sql += " left join " + usr + ".di_dmloaitp l on i.idloai=l.id";
			sql += cont;
			sql += " group by to_char(b.ngay,'dd/mm/yyyy'),l.ten,i.ten,i.dvt";
			return get_data_mmyy(sql, tu, den, false);
		}
        
		public int get_duyetnhaan(string mmyy, long id)
		{
			try
			{
				ds = get_data("select done from " + user + mmyy + ".di_duyet where id=" + id);
				if (ds.Tables[0].Rows.Count == 0) return 0;
				else return int.Parse(ds.Tables[0].Rows[0][0].ToString());
			}
			catch { return 0; }
		}

		public void updrec_kthucdonll(DataTable dt, long id, string mabn, string hoten, long maql, long idkhoa,
			string ngayvv, int madoituong, int idcu, int moi, int dacbiet, string maicd, string chandoan, string giuong, string mabs, string yta)
		{
			string exp = "id=" + id;
			DataRow r = getrowbyid(dt, exp);
			if (r == null)
			{
				DataRow nrow = dt.NewRow();
				nrow["id"] = id;
				nrow["mabn"] = mabn;
				nrow["hoten"] = hoten;
				nrow["maql"] = maql;
				nrow["idkhoa"] = idkhoa;
				nrow["ngayvv"] = ngayvv;
				nrow["madoituong"] = madoituong;
				nrow["idcu"] = idcu;
				nrow["moi"] = moi;
				nrow["dacbiet"] = dacbiet;
				nrow["maicd"] = maicd;
				nrow["chandoan"] = chandoan;
				nrow["giuong"] = giuong;
				nrow["mabs"] = mabs;
				nrow["yta"] = yta;
				dt.Rows.Add(nrow);
			}
			else
			{
				DataRow[] dr = dt.Select(exp);
				dr[0]["mabn"] = mabn;
				dr[0]["hoten"] = hoten;
				dr[0]["maql"] = maql;
				dr[0]["idkhoa"] = idkhoa;
				dr[0]["ngayvv"] = ngayvv;
				dr[0]["madoituong"] = madoituong;
				dr[0]["idcu"] = idcu;
				dr[0]["moi"] = moi;
				dr[0]["dacbiet"] = dacbiet;
				dr[0]["maicd"] = maicd;
				dr[0]["chandoan"] = chandoan;
				dr[0]["giuong"] = giuong;
				dr[0]["mabs"] = mabs;
				dr[0]["yta"] = yta;
			}
		}

		public void updrec_kthucdonll(DataTable dt, long id, string mabn, string hoten, long maql, long idkhoa,
			string ngayvv, int madoituong, int idcu, int moi, int dacbiet, string maicd, string chandoan, string giuong, 
			string mabs, string yta,string ghichu)
		{
			string exp = "id=" + id;
			DataRow r = getrowbyid(dt, exp);
			if (r == null)
			{
				DataRow nrow = dt.NewRow();
				nrow["id"] = id;
				nrow["mabn"] = mabn;
				nrow["hoten"] = hoten;
				nrow["maql"] = maql;
				nrow["idkhoa"] = idkhoa;
				nrow["ngayvv"] = ngayvv;
				nrow["madoituong"] = madoituong;
				nrow["idcu"] = idcu;
				nrow["moi"] = moi;
				nrow["dacbiet"] = dacbiet;
				nrow["maicd"] = maicd;
				nrow["chandoan"] = chandoan;
				nrow["giuong"] = giuong;
				nrow["mabs"] = mabs;
				nrow["yta"] = yta;
				nrow["ghichu"] = ghichu;
				dt.Rows.Add(nrow);
			}
			else
			{
				DataRow[] dr = dt.Select(exp);
				dr[0]["mabn"] = mabn;
				dr[0]["hoten"] = hoten;
				dr[0]["maql"] = maql;
				dr[0]["idkhoa"] = idkhoa;
				dr[0]["ngayvv"] = ngayvv;
				dr[0]["madoituong"] = madoituong;
				dr[0]["idcu"] = idcu;
				dr[0]["moi"] = moi;
				dr[0]["dacbiet"] = dacbiet;
				dr[0]["maicd"] = maicd;
				dr[0]["chandoan"] = chandoan;
				dr[0]["giuong"] = giuong;
				dr[0]["mabs"] = mabs;
				dr[0]["yta"] = yta;
				dr[0]["ghichu"] = ghichu;
			}
		}

		public void updrec_kthucdonct(DataTable dt, int stt, int idgioan, int idthucdon, string gioan, string ma, string tenthucdon, decimal e, decimal p, decimal l, decimal g, int idchedoan, decimal soluong, decimal dongia, decimal sotien)
		{
			string exp = "stt=" + stt;
			DataRow r = getrowbyid(dt, exp);
			if (r == null)
			{
				DataRow nrow = dt.NewRow();
				nrow["stt"] = stt;
				nrow["idgioan"] = idgioan;
				nrow["idthucdon"] = idthucdon;
				nrow["gioan"] = gioan;
				nrow["ma"] = ma;
				nrow["tenthucdon"] = tenthucdon;
				nrow["e"] = e;
				nrow["p"] = p;
				nrow["l"] = l;
				nrow["g"] = g;
				nrow["idchedoan"] = idchedoan;
				nrow["soluong"] = soluong;
				nrow["dongia"] = dongia;
				nrow["sotien"] = sotien;
				dt.Rows.Add(nrow);
			}
			else
			{
				DataRow[] dr = dt.Select(exp);
				dr[0]["idgioan"] = idgioan;
				dr[0]["idthucdon"] = idthucdon;
				dr[0]["gioan"] = gioan;
				dr[0]["ma"] = ma;
				dr[0]["tenthucdon"] = tenthucdon;
				dr[0]["e"] = e;
				dr[0]["p"] = p;
				dr[0]["l"] = l;
				dr[0]["g"] = g;
				dr[0]["idchedoan"] = idchedoan;
				dr[0]["soluong"] = soluong;
				dr[0]["dongia"] = dongia;
				dr[0]["sotien"] = sotien;
			}
		}
		public long get_cholai(string d_tu, string d_den, string d_mabn, int d_phieu, string d_table)
		{
			long ret = 0;
			sql="select a.id,to_char(b.ngay,'yyyymmdd') as ngay from xxx." + d_table + " a,xxx.di_duyet b where a.idduyet=b.id and a.mabn='" + d_mabn + "'";
			if(d_phieu>0) sql+=" and b.phieu=" + d_phieu;
			ds = get_data_mmyy(sql, d_tu, d_den, false);
			if (ds.Tables[0].Rows.Count > 0)
				foreach (DataRow r in ds.Tables[0].Select("true", "ngay desc"))
				{
					ret = long.Parse(r["id"].ToString());
					break;
				}
			return ret;
		}

		public DataTable getdmthucdon(string ngay)
		{
			string usr = user;
			sql = "select to_char(ngay,'dd/mm/yyyy') as ngay,to_char(ngay,'yyyymmdd') as yymmdd ";
			sql+=" from " + usr + ".di_dmtdngay ";
			sql += " where to_date(ngay,'dd/mm/yy')<= to_date('" + ngay + "','dd/mm/yy')";
			sql += " order by yymmdd desc";
			DataTable tmp = get_data(sql).Tables[0];
			if (tmp.Rows.Count > 0)
			{
				ngay = tmp.Rows[0]["ngay"].ToString();
				sql = "select a.id,a.idgioan,a.ma,a.ten,c.ten as chedoan,d.dongia,a.stt,a.idchedoan,";
				sql += "a.e,a.p,a.l,a.g";
				sql += " from " + usr + ".di_dmthucdon a," + usr + ".di_dmchedoan c," + usr + ".di_dmtdngay d";
				sql += " where a.id=d.id and a.idchedoan=c.id and to_char(d.ngay,'dd/mm/yyyy')='" + ngay + "' order by a.stt";
			}
			else
			{
				sql = "select a.id,a.idgioan,a.ma,a.ten,c.ten as chedoan,a.dongia,a.stt,a.idchedoan,";
				sql += "a.e,a.p,a.l,a.g";
				sql += " from " + usr + ".di_dmthucdon a," + usr + ".di_dmchedoan c";
				sql += " where a.idchedoan=c.id and a.benhly=0 order by a.stt";
			}            
			return get_data(sql).Tables[0];
		}

		private void sumeplg(DataTable dt)
		{
			_e = 0; _p = 0; _l = 0; _g = 0;
			foreach (DataRow r in dt.Select("soluong>0"))
			{
				_e += decimal.Parse(r["e"].ToString());
				_p += decimal.Parse(r["p"].ToString());
				_l += decimal.Parse(r["l"].ToString());
				_g += decimal.Parse(r["g"].ToString());
			}
		}
		public DataTable getsoluong(DataTable dt, decimal e, decimal p, decimal l, decimal g)
		{
			decimal pg = e * p / 100 / 4, lg = e * l / 100 / 9, gg = e * g / 100 / 4;
			decimal sl=0,x=0,p1,l1,g1;
			foreach (DataRow r in dt.Select("soluong=0","g desc,p desc ,l desc ,stt"))
			{
				sumeplg(dt);
				g = decimal.Parse(r["g"].ToString());
				sl = decimal.Parse(r["sl"].ToString());
				l = decimal.Parse(r["l"].ToString());
				p = decimal.Parse(r["p"].ToString());
				if (g > 0)
				{
					g1 = gg - _g;
					if (g1 > 0)
					{
						x = g1 * sl / g;
						r["soluong"] = x;
						r["p"] = x / sl * p;
						r["l"] = x / sl * l;
						r["g"] = g1;
						r["e"] = decimal.Parse(r["p"].ToString()) * 4 + decimal.Parse(r["l"].ToString()) * 9 + decimal.Parse(r["g"].ToString()) * 4;
						r["tt"] = 1;
					}
				}
				else if (p > 0)
				{
					p1 = pg - _p;
					if (p1 > 0)
					{
						x = p1 * sl / p;
						l1 = x / sl * l;
						r["soluong"] = x;
						r["p"] = p1;
						r["l"] = l1;
						r["e"] = decimal.Parse(r["p"].ToString()) * 4 + decimal.Parse(r["l"].ToString()) * 9 + decimal.Parse(r["g"].ToString()) * 4;
						r["tt"] = 1;
					}
				}
				else if (l > 0)
				{
					l1 = lg - _l;
					x = l1 / sl;
					r["l"] = l1;
					r["soluong"] = x;
					r["e"] = decimal.Parse(r["p"].ToString()) * 4 + decimal.Parse(r["l"].ToString()) * 9 + decimal.Parse(r["g"].ToString()) * 4;
					r["tt"] = 1;
				}
			}
			return dt;
		}

		#endregion

		public bool upd_ba_gayme(long m_id,string m_ngayvv,long m_idthuchien,string m_ngay,string m_diung,string m_tenpt,
			int m_nhommau,decimal m_cannang,string m_ptv,string m_bsgmhs,string m_ktvgm,string m_asa,
			string m_mallampati,int m_tuthe,int m_dau,int m_sankhoa,int m_modetho,int m_nkq,int m_npq,
			decimal m_so,decimal m_dosau,int m_baloon,int m_thuong,int m_loxo,int m_mieng,int m_mui,int m_mtq,
			decimal m_mtq_so,decimal m_mtq_dosau,int m_mtq_baloon,int m_classic,int m_seal,int m_tienme,
			int m_metm,int m_tts,string m_tts_tt,string m_tts_vitri,decimal m_tts_so,int m_tnmc,
			string m_tnmc_tt,string m_tnmc_vitri,decimal m_tnmc_luon,int m_tetung,int m_nach,int m_cobac,
			int m_khac,int m_ttc,int m_tieu,int m_daday,int m_cvp,string m_cvp_vitri,decimal m_cvp_dosau,
			int m_abp,string m_abp_vitri,int m_iv,string m_iv_vitri,int m_mar,string m_mar_lieu,int m_mar_dd,
			int m_mar_cd,int m_fen,string m_fen_lieu,int m_fen_dd,int m_fen_cd,int m_lid,
			string m_lid_lieu,int m_lid_dd,int m_lid_cd,int m_bomdien,string m_ghichu,int m_userid)
		{
			string xxx = user + mmyy(m_ngayvv);
			sql="update "+xxx+".ba_gayme set ";
			sql+="idthuchien=:m_idthuchien,ngay=to_date(:m_ngay,'dd/mm/yyyy'),diung=:m_diung,tenpt=:m_tenpt,";
			sql+="nhommau=:m_nhommau,cannang=:m_cannang,ptv=:m_ptv,bsgmhs=:m_bsgmhs,ktvgm=:m_ktvgm,asa=:m_asa,";
			sql+="mallampati=:m_mallampati,tuthe=:m_tuthe,dau=:m_dau,sankhoa=:m_sankhoa,modetho=:m_modetho,";
			sql+="nkq=:m_nkq,npq=:m_npq,so=:m_so,dosau=:m_dosau,baloon=:m_baloon,thuong=:m_thuong,loxo=:m_loxo,";
			sql+="mieng=:m_mieng,mui=:m_mui,mtq=:m_mtq,mtq_so=:m_mtq_so,mtq_dosau=:m_mtq_dosau,mtq_baloon=:m_mtq_baloon,";
			sql+="classic=:m_classic,seal=:m_seal,tienme=:m_tienme,metm=:m_metm,tts=:m_tts,tts_tt=:m_tts_tt,";
			sql+="tts_vitri=:m_tts_vitri,tts_so=:m_tts_so,tnmc=:m_tnmc,tnmc_tt=:m_tnmc_tt,tnmc_vitri=:m_tnmc_vitri,";
			sql+="tnmc_luon=:m_tnmc_luon,tetung=:m_tetung,nach=:m_nach,cobac=:m_cobac,khac=:m_khac,ttc=:m_ttc,";
			sql+="tieu=:m_tieu,daday=:m_daday,cvp=:m_cvp,cvp_vitri=:m_cvp_vitri,cvp_dosau=:m_cvp_dosau,";
			sql+="abp=:m_abp,abp_vitri=:m_abp_vitri,iv=:m_iv,iv_vitri=:m_iv_vitri,mar=:m_mar,mar_lieu=:m_mar_lieu,";
			sql+="mar_dd=:m_mar_dd,mar_cd=:m_mar_cd,fen=:m_fen,fen_lieu=:m_fen_lieu,fen_dd=:m_fen_dd,fen_cd=:m_fen_cd,";
			sql+="lid=:m_lid,lid_lieu=:m_lid_lieu,lid_dd=:m_lid_dd,lid_cd=:m_lid_cd,bomdien=:m_bomdien,";
			sql+="ghichu=:m_ghichu,userid=:m_userid ";
			sql+=" where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_idthuchien",OracleType.Number).Value=m_idthuchien;
				cmd.Parameters.Add("m_ngay",OracleType.VarChar,10).Value=m_ngay;
				cmd.Parameters.Add("m_diung",OracleType.NVarChar,254).Value=m_diung;
				cmd.Parameters.Add("m_tenpt",OracleType.NVarChar,254).Value=m_tenpt;
				cmd.Parameters.Add("m_nhommau",OracleType.Number).Value=m_nhommau;
				cmd.Parameters.Add("m_cannang",OracleType.Number).Value=m_cannang;
				cmd.Parameters.Add("m_ptv",OracleType.VarChar,4).Value=m_ptv;
				cmd.Parameters.Add("m_bsgmhs",OracleType.VarChar,4).Value=m_bsgmhs;
				cmd.Parameters.Add("m_ktvgm",OracleType.VarChar,4).Value=m_ktvgm;
				cmd.Parameters.Add("m_asa",OracleType.VarChar,3).Value=m_asa;
				cmd.Parameters.Add("m_mallampati",OracleType.VarChar,3).Value=m_mallampati;
				cmd.Parameters.Add("m_tuthe",OracleType.Number).Value=m_tuthe;
				cmd.Parameters.Add("m_dau",OracleType.Number).Value=m_dau;
				cmd.Parameters.Add("m_sankhoa",OracleType.Number).Value=m_sankhoa;
				cmd.Parameters.Add("m_modetho",OracleType.Number).Value=m_modetho;
				cmd.Parameters.Add("m_nkq",OracleType.Number).Value=m_nkq;
				cmd.Parameters.Add("m_npq",OracleType.Number).Value=m_npq;
				cmd.Parameters.Add("m_so",OracleType.Number).Value=m_so;
				cmd.Parameters.Add("m_dosau",OracleType.Number).Value=m_dosau;
				cmd.Parameters.Add("m_baloon",OracleType.Number).Value=m_baloon;
				cmd.Parameters.Add("m_thuong",OracleType.Number).Value=m_thuong;
				cmd.Parameters.Add("m_loxo",OracleType.Number).Value=m_loxo;
				cmd.Parameters.Add("m_mieng",OracleType.Number).Value=m_mieng;
				cmd.Parameters.Add("m_mui",OracleType.Number).Value=m_mui;
				cmd.Parameters.Add("m_mtq",OracleType.Number).Value=m_mtq;
				cmd.Parameters.Add("m_mtq_so",OracleType.Number).Value=m_mtq_so;
				cmd.Parameters.Add("m_mtq_dosau",OracleType.Number).Value=m_mtq_dosau;
				cmd.Parameters.Add("m_mtq_baloon",OracleType.Number).Value=m_mtq_baloon;
				cmd.Parameters.Add("m_classic",OracleType.Number).Value=m_classic;
				cmd.Parameters.Add("m_seal",OracleType.Number).Value=m_seal;
				cmd.Parameters.Add("m_tienme",OracleType.Number).Value=m_tienme;
				cmd.Parameters.Add("m_metm",OracleType.Number).Value=m_metm;
				cmd.Parameters.Add("m_tts",OracleType.Number).Value=m_tts;
				cmd.Parameters.Add("m_tts_tt",OracleType.NVarChar,50).Value=m_tts_tt;
				cmd.Parameters.Add("m_tts_vitri",OracleType.NVarChar,50).Value=m_tts_vitri;
				cmd.Parameters.Add("m_tts_so",OracleType.Number).Value=m_tts_so;
				cmd.Parameters.Add("m_tnmc",OracleType.Number).Value=m_tnmc;
				cmd.Parameters.Add("m_tnmc_tt",OracleType.NVarChar,50).Value=m_tnmc_tt;
				cmd.Parameters.Add("m_tnmc_vitri",OracleType.NVarChar,50).Value=m_tnmc_vitri;
				cmd.Parameters.Add("m_tnmc_luon",OracleType.Number).Value=m_tnmc_luon;
				cmd.Parameters.Add("m_tetung",OracleType.Number).Value=m_tetung;
				cmd.Parameters.Add("m_nach",OracleType.Number).Value=m_nach;
				cmd.Parameters.Add("m_cobac",OracleType.Number).Value=m_cobac;
				cmd.Parameters.Add("m_khac",OracleType.Number).Value=m_khac;
				cmd.Parameters.Add("m_ttc",OracleType.Number).Value=m_ttc;
				cmd.Parameters.Add("m_tieu",OracleType.Number).Value=m_tieu;
				cmd.Parameters.Add("m_daday",OracleType.Number).Value=m_daday;
				cmd.Parameters.Add("m_cvp",OracleType.Number).Value=m_cvp;
				cmd.Parameters.Add("m_cvp_vitri",OracleType.NVarChar,50).Value=m_cvp_vitri;
				cmd.Parameters.Add("m_cvp_dosau",OracleType.Number).Value=m_cvp_dosau;
				cmd.Parameters.Add("m_abp",OracleType.Number).Value=m_abp;
				cmd.Parameters.Add("m_abp_vitri",OracleType.NVarChar,50).Value=m_abp_vitri;
				cmd.Parameters.Add("m_iv",OracleType.Number).Value=m_iv;
				cmd.Parameters.Add("m_iv_vitri",OracleType.NVarChar,50).Value=m_iv_vitri;
				cmd.Parameters.Add("m_mar",OracleType.Number).Value=m_mar;
				cmd.Parameters.Add("m_mar_lieu",OracleType.NVarChar,50).Value=m_mar_lieu;
				cmd.Parameters.Add("m_mar_dd",OracleType.Number).Value=m_mar_dd;
				cmd.Parameters.Add("m_mar_cd",OracleType.Number).Value=m_mar_cd;
				cmd.Parameters.Add("m_fen",OracleType.Number).Value=m_fen;
				cmd.Parameters.Add("m_fen_lieu",OracleType.NVarChar,50).Value=m_fen_lieu;
				cmd.Parameters.Add("m_fen_dd",OracleType.Number).Value=m_fen_dd;
				cmd.Parameters.Add("m_fen_cd",OracleType.Number).Value=m_fen_cd;
				cmd.Parameters.Add("m_lid",OracleType.Number).Value=m_lid;
				cmd.Parameters.Add("m_lid_lieu",OracleType.NVarChar,50).Value=m_lid_lieu;
				cmd.Parameters.Add("m_lid_dd",OracleType.Number).Value=m_lid_dd;
				cmd.Parameters.Add("m_lid_cd",OracleType.Number).Value=m_lid_cd;
				cmd.Parameters.Add("m_bomdien",OracleType.Number).Value=m_bomdien;
				cmd.Parameters.Add("m_ghichu",OracleType.NVarChar,1000).Value=m_ghichu;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_gayme (id,idthuchien,ngay,diung,tenpt,nhommau,cannang,ptv,bsgmhs,";
					sql+="ktvgm,asa,mallampati,tuthe,dau,sankhoa,modetho,nkq,npq,so,dosau,baloon,thuong,loxo,mieng,";
					sql+="mui,mtq,mtq_so,mtq_dosau,mtq_baloon,classic,seal,tienme,metm,tts,tts_tt,tts_vitri,tts_so,";
					sql+="tnmc,tnmc_tt,tnmc_vitri,tnmc_luon,tetung,nach,cobac,khac,ttc,tieu,daday,cvp,cvp_vitri,";
					sql+="cvp_dosau,abp,abp_vitri,iv,iv_vitri,mar,mar_lieu,mar_dd,mar_cd,fen,fen_lieu,fen_dd,fen_cd,";
					sql+="lid,lid_lieu,lid_dd,lid_cd,bomdien,ghichu,userid) values ";
					sql+="(:m_id,:m_idthuchien,to_date(:m_ngay,'dd/mm/yyyy'),:m_diung,:m_tenpt,:m_nhommau,:m_cannang,";
					sql+=":m_ptv,:m_bsgmhs,:m_ktvgm,:m_asa,:m_mallampati,:m_tuthe,:m_dau,:m_sankhoa,:m_modetho,:m_nkq,";
					sql+=":m_npq,:m_so,:m_dosau,:m_baloon,:m_thuong,:m_loxo,:m_mieng,:m_mui,:m_mtq,:m_mtq_so,";
					sql+=":m_mtq_dosau,:m_mtq_baloon,:m_classic,:m_seal,:m_tienme,:m_metm,:m_tts,:m_tts_tt,";
					sql+=":m_tts_vitri,:m_tts_so,:m_tnmc,:m_tnmc_tt,:m_tnmc_vitri,:m_tnmc_luon,:m_tetung,:m_nach,";
					sql+=":m_cobac,:m_khac,:m_ttc,:m_tieu,:m_daday,:m_cvp,:m_cvp_vitri,:m_cvp_dosau,:m_abp,";
					sql+=":m_abp_vitri,:m_iv,:m_iv_vitri,:m_mar,:m_mar_lieu,:m_mar_dd,:m_mar_cd,:m_fen,:m_fen_lieu,";
					sql+=":m_fen_dd,:m_fen_cd,:m_lid,:m_lid_lieu,:m_lid_dd,:m_lid_cd,:m_bomdien,:m_ghichu,:m_userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_idthuchien",OracleType.Number).Value=m_idthuchien;
					cmd.Parameters.Add("m_ngay",OracleType.VarChar,10).Value=m_ngay;
					cmd.Parameters.Add("m_diung",OracleType.NVarChar,254).Value=m_diung;
					cmd.Parameters.Add("m_tenpt",OracleType.NVarChar,254).Value=m_tenpt;
					cmd.Parameters.Add("m_nhommau",OracleType.Number).Value=m_nhommau;
					cmd.Parameters.Add("m_cannang",OracleType.Number).Value=m_cannang;
					cmd.Parameters.Add("m_ptv",OracleType.VarChar,4).Value=m_ptv;
					cmd.Parameters.Add("m_bsgmhs",OracleType.VarChar,4).Value=m_bsgmhs;
					cmd.Parameters.Add("m_ktvgm",OracleType.VarChar,4).Value=m_ktvgm;
					cmd.Parameters.Add("m_asa",OracleType.VarChar,3).Value=m_asa;
					cmd.Parameters.Add("m_mallampati",OracleType.VarChar,3).Value=m_mallampati;
					cmd.Parameters.Add("m_tuthe",OracleType.Number).Value=m_tuthe;
					cmd.Parameters.Add("m_dau",OracleType.Number).Value=m_dau;
					cmd.Parameters.Add("m_sankhoa",OracleType.Number).Value=m_sankhoa;
					cmd.Parameters.Add("m_modetho",OracleType.Number).Value=m_modetho;
					cmd.Parameters.Add("m_nkq",OracleType.Number).Value=m_nkq;
					cmd.Parameters.Add("m_npq",OracleType.Number).Value=m_npq;
					cmd.Parameters.Add("m_so",OracleType.Number).Value=m_so;
					cmd.Parameters.Add("m_dosau",OracleType.Number).Value=m_dosau;
					cmd.Parameters.Add("m_baloon",OracleType.Number).Value=m_baloon;
					cmd.Parameters.Add("m_thuong",OracleType.Number).Value=m_thuong;
					cmd.Parameters.Add("m_loxo",OracleType.Number).Value=m_loxo;
					cmd.Parameters.Add("m_mieng",OracleType.Number).Value=m_mieng;
					cmd.Parameters.Add("m_mui",OracleType.Number).Value=m_mui;
					cmd.Parameters.Add("m_mtq",OracleType.Number).Value=m_mtq;
					cmd.Parameters.Add("m_mtq_so",OracleType.Number).Value=m_mtq_so;
					cmd.Parameters.Add("m_mtq_dosau",OracleType.Number).Value=m_mtq_dosau;
					cmd.Parameters.Add("m_mtq_baloon",OracleType.Number).Value=m_mtq_baloon;
					cmd.Parameters.Add("m_classic",OracleType.Number).Value=m_classic;
					cmd.Parameters.Add("m_seal",OracleType.Number).Value=m_seal;
					cmd.Parameters.Add("m_tienme",OracleType.Number).Value=m_tienme;
					cmd.Parameters.Add("m_metm",OracleType.Number).Value=m_metm;
					cmd.Parameters.Add("m_tts",OracleType.Number).Value=m_tts;
					cmd.Parameters.Add("m_tts_tt",OracleType.NVarChar,50).Value=m_tts_tt;
					cmd.Parameters.Add("m_tts_vitri",OracleType.NVarChar,50).Value=m_tts_vitri;
					cmd.Parameters.Add("m_tts_so",OracleType.Number).Value=m_tts_so;
					cmd.Parameters.Add("m_tnmc",OracleType.Number).Value=m_tnmc;
					cmd.Parameters.Add("m_tnmc_tt",OracleType.NVarChar,50).Value=m_tnmc_tt;
					cmd.Parameters.Add("m_tnmc_vitri",OracleType.NVarChar,50).Value=m_tnmc_vitri;
					cmd.Parameters.Add("m_tnmc_luon",OracleType.Number).Value=m_tnmc_luon;
					cmd.Parameters.Add("m_tetung",OracleType.Number).Value=m_tetung;
					cmd.Parameters.Add("m_nach",OracleType.Number).Value=m_nach;
					cmd.Parameters.Add("m_cobac",OracleType.Number).Value=m_cobac;
					cmd.Parameters.Add("m_khac",OracleType.Number).Value=m_khac;
					cmd.Parameters.Add("m_ttc",OracleType.Number).Value=m_ttc;
					cmd.Parameters.Add("m_tieu",OracleType.Number).Value=m_tieu;
					cmd.Parameters.Add("m_daday",OracleType.Number).Value=m_daday;
					cmd.Parameters.Add("m_cvp",OracleType.Number).Value=m_cvp;
					cmd.Parameters.Add("m_cvp_vitri",OracleType.NVarChar,50).Value=m_cvp_vitri;
					cmd.Parameters.Add("m_cvp_dosau",OracleType.Number).Value=m_cvp_dosau;
					cmd.Parameters.Add("m_abp",OracleType.Number).Value=m_abp;
					cmd.Parameters.Add("m_abp_vitri",OracleType.NVarChar,50).Value=m_abp_vitri;
					cmd.Parameters.Add("m_iv",OracleType.Number).Value=m_iv;
					cmd.Parameters.Add("m_iv_vitri",OracleType.NVarChar,50).Value=m_iv_vitri;
					cmd.Parameters.Add("m_mar",OracleType.Number).Value=m_mar;
					cmd.Parameters.Add("m_mar_lieu",OracleType.NVarChar,50).Value=m_mar_lieu;
					cmd.Parameters.Add("m_mar_dd",OracleType.Number).Value=m_mar_dd;
					cmd.Parameters.Add("m_mar_cd",OracleType.Number).Value=m_mar_cd;
					cmd.Parameters.Add("m_fen",OracleType.Number).Value=m_fen;
					cmd.Parameters.Add("m_fen_lieu",OracleType.NVarChar,50).Value=m_fen_lieu;
					cmd.Parameters.Add("m_fen_dd",OracleType.Number).Value=m_fen_dd;
					cmd.Parameters.Add("m_fen_cd",OracleType.Number).Value=m_fen_cd;
					cmd.Parameters.Add("m_lid",OracleType.Number).Value=m_lid;
					cmd.Parameters.Add("m_lid_lieu",OracleType.NVarChar,50).Value=m_lid_lieu;
					cmd.Parameters.Add("m_lid_dd",OracleType.Number).Value=m_lid_dd;
					cmd.Parameters.Add("m_lid_cd",OracleType.Number).Value=m_lid_cd;
					cmd.Parameters.Add("m_bomdien",OracleType.Number).Value=m_bomdien;
					cmd.Parameters.Add("m_ghichu",OracleType.NVarChar,1000).Value=m_ghichu;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_gayme");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_gaymect(string m_ngay,long m_id,int m_ma,string m_ten,string m_c01,string m_c02,string m_c03,
			string m_c04,string m_c05,string m_c06,string m_c11,string m_c12,string m_c13,string m_c14,
			string m_c15,string m_c16,string m_c21,string m_c22,string m_c23,string m_c24,string m_c25,
			string m_c26,string m_c31,string m_c32,string m_c33,string m_c34)
		{
			string xxx = user + mmyy(m_ngay);
			sql="update "+xxx+".ba_gaymect set ten=:m_ten,c01=:m_c01,c02=:m_c02,c03=:m_c03,c04=:m_c04,c05=:m_c05,c06=:m_c06,";
			sql+="c11=:m_c11,c12=:m_c12,c13=:m_c13,c14=:m_c14,c15=:m_c15,c16=:m_c16,c21=:m_c21,c22=:m_c22,";
			sql+="c23=:m_c23,c24=:m_c24,c25=:m_c25,c26=:m_c26,c31=:m_c31,c32=:m_c32,c33=:m_c33,c34=:m_c34";
			sql+=" where id=:m_id and ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_ten",OracleType.NVarChar,254).Value=m_ten;
				cmd.Parameters.Add("m_c01",OracleType.NVarChar,20).Value=m_c01;
				cmd.Parameters.Add("m_c02",OracleType.NVarChar,20).Value=m_c02;
				cmd.Parameters.Add("m_c03",OracleType.NVarChar,20).Value=m_c03;
				cmd.Parameters.Add("m_c04",OracleType.NVarChar,20).Value=m_c04;
				cmd.Parameters.Add("m_c05",OracleType.NVarChar,20).Value=m_c05;
				cmd.Parameters.Add("m_c06",OracleType.NVarChar,20).Value=m_c06;
				cmd.Parameters.Add("m_c11",OracleType.NVarChar,20).Value=m_c11;
				cmd.Parameters.Add("m_c12",OracleType.NVarChar,20).Value=m_c12;
				cmd.Parameters.Add("m_c13",OracleType.NVarChar,20).Value=m_c13;
				cmd.Parameters.Add("m_c14",OracleType.NVarChar,20).Value=m_c14;
				cmd.Parameters.Add("m_c15",OracleType.NVarChar,20).Value=m_c15;
				cmd.Parameters.Add("m_c16",OracleType.NVarChar,20).Value=m_c16;
				cmd.Parameters.Add("m_c21",OracleType.NVarChar,20).Value=m_c21;
				cmd.Parameters.Add("m_c22",OracleType.NVarChar,20).Value=m_c22;
				cmd.Parameters.Add("m_c23",OracleType.NVarChar,20).Value=m_c23;
				cmd.Parameters.Add("m_c24",OracleType.NVarChar,20).Value=m_c24;
				cmd.Parameters.Add("m_c25",OracleType.NVarChar,20).Value=m_c25;
				cmd.Parameters.Add("m_c26",OracleType.NVarChar,20).Value=m_c26;
				cmd.Parameters.Add("m_c31",OracleType.NVarChar,20).Value=m_c31;
				cmd.Parameters.Add("m_c32",OracleType.NVarChar,20).Value=m_c32;
				cmd.Parameters.Add("m_c33",OracleType.NVarChar,20).Value=m_c33;
				cmd.Parameters.Add("m_c34",OracleType.NVarChar,20).Value=m_c34;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_gaymect (id,ma,ten,c01,c02,c03,c04,c05,c06,c11,c12,c13,c14,c15,c16,c21,c22,c23,c24,c25,c26,c31,c32,c33,c34) values (:m_id,:m_ma,:m_ten,:m_c01,:m_c02,:m_c03,:m_c04,:m_c05,:m_c06,:m_c11,:m_c12,:m_c13,:m_c14,:m_c15,:m_c16,:m_c21,:m_c22,:m_c23,:m_c24,:m_c25,:m_c26,:m_c31,:m_c32,:m_c33,:m_c34)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ten",OracleType.NVarChar,254).Value=m_ten;
					cmd.Parameters.Add("m_c01",OracleType.NVarChar,20).Value=m_c01;
					cmd.Parameters.Add("m_c02",OracleType.NVarChar,20).Value=m_c02;
					cmd.Parameters.Add("m_c03",OracleType.NVarChar,20).Value=m_c03;
					cmd.Parameters.Add("m_c04",OracleType.NVarChar,20).Value=m_c04;
					cmd.Parameters.Add("m_c05",OracleType.NVarChar,20).Value=m_c05;
					cmd.Parameters.Add("m_c06",OracleType.NVarChar,20).Value=m_c06;
					cmd.Parameters.Add("m_c11",OracleType.NVarChar,20).Value=m_c11;
					cmd.Parameters.Add("m_c12",OracleType.NVarChar,20).Value=m_c12;
					cmd.Parameters.Add("m_c13",OracleType.NVarChar,20).Value=m_c13;
					cmd.Parameters.Add("m_c14",OracleType.NVarChar,20).Value=m_c14;
					cmd.Parameters.Add("m_c15",OracleType.NVarChar,20).Value=m_c15;
					cmd.Parameters.Add("m_c16",OracleType.NVarChar,20).Value=m_c16;
					cmd.Parameters.Add("m_c21",OracleType.NVarChar,20).Value=m_c21;
					cmd.Parameters.Add("m_c22",OracleType.NVarChar,20).Value=m_c22;
					cmd.Parameters.Add("m_c23",OracleType.NVarChar,20).Value=m_c23;
					cmd.Parameters.Add("m_c24",OracleType.NVarChar,20).Value=m_c24;
					cmd.Parameters.Add("m_c25",OracleType.NVarChar,20).Value=m_c25;
					cmd.Parameters.Add("m_c26",OracleType.NVarChar,20).Value=m_c26;
					cmd.Parameters.Add("m_c31",OracleType.NVarChar,20).Value=m_c31;
					cmd.Parameters.Add("m_c32",OracleType.NVarChar,20).Value=m_c32;
					cmd.Parameters.Add("m_c33",OracleType.NVarChar,20).Value=m_c33;
					cmd.Parameters.Add("m_c34",OracleType.NVarChar,20).Value=m_c34;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_gaymect");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_gaymethuoc(string m_ngay,long m_id,int m_ma,string m_ten)
		{
			string xxx = user + mmyy(m_ngay);
			sql="update "+xxx+".ba_gaymethuoc set ten=:m_ten where id=:m_id and ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_ten",OracleType.NVarChar,254).Value=m_ten;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_gaymethuoc (id,ma,ten) values (:m_id,:m_ma,:m_ten)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
					cmd.Parameters.Add("m_ten",OracleType.NVarChar,254).Value=m_ten;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_gaymethuoc");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_gaymehinh(string m_ngay,long m_id,long m_idgayme,int m_stt,byte[] m_image)
		{
			string xxx = user + mmyy(m_ngay);
			sql="update "+xxx+".ba_gaymehinh set idgayme=:m_idgayme,stt=:m_stt,image=:m_image where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_idgayme",OracleType.Number).Value=m_idgayme;
				cmd.Parameters.Add("m_image",OracleType.Blob,m_image.Length).Value=m_image;
				cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;				
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_gaymehinh (id,idgayme,stt,image) values (:m_id,:m_idgayme,:m_stt,:m_image)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;				
					cmd.Parameters.Add("m_idgayme",OracleType.Number).Value=m_idgayme;
					cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
					cmd.Parameters.Add("m_image",OracleType.Blob,m_image.Length).Value=m_image;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_gaymehinh");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool get_dain(string mmyy,long id)
		{
			return get_data("select * from "+user+mmyy+".v_chidinh where id="+id+" and lan>0").Tables[0].Rows.Count>0;
		}

		public bool upd_sttnhom(long m_id,decimal m_stt,string m_ten,decimal m_so,string m_makp)
		{
			sql="update sttnhom set stt=:m_stt,ten=:m_ten,so=:m_so,makp=:m_makp where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
				cmd.Parameters.Add("m_ten",OracleType.NVarChar,100).Value=m_ten;
				cmd.Parameters.Add("m_so",OracleType.Number).Value=m_so;
				cmd.Parameters.Add("m_makp",OracleType.VarChar,500).Value=m_makp;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into sttnhom (id,stt,ten,so,makp) values (:m_id,:m_stt,:m_ten,:m_so,:m_makp)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
					cmd.Parameters.Add("m_ten",OracleType.NVarChar,100).Value=m_ten;
					cmd.Parameters.Add("m_so",OracleType.Number).Value=m_so;
					cmd.Parameters.Add("m_makp",OracleType.VarChar,500).Value=m_makp;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"sttnhom");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public long get_stt_kham(string m_ngay,string m_makp)
		{
			string xxx=user+mmyy(m_ngay);
			sql="update "+xxx+".sttkham set so=so+1 where to_char(ngay,'dd/mm/yyyy')=:m_ngay and makp=:m_makp";
			con=new OracleConnection(sConn);
			con.Open();
			cmd=new OracleCommand(sql,con);
			cmd.CommandType=CommandType.Text;
			cmd.Parameters.Add("m_ngay",OracleType.VarChar,10).Value=m_ngay;
			cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
			int irec=cmd.ExecuteNonQuery();
			cmd.Dispose();
			if (irec==0)
			{
				sql="insert into "+xxx+".sttkham (ngay,makp,so) values (to_date(:m_ngay,'dd/mm/yyyy'),:m_makp,1)";
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_ngay",OracleType.VarChar,10).Value=m_ngay;
				cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
				cmd.ExecuteNonQuery();
				cmd.Dispose();
			}
			sql="select so from "+xxx+".sttkham where to_char(ngay,'dd/mm/yyyy')='"+m_ngay+"' and makp='"+m_makp+"'";
			cmd=new OracleCommand(sql,con);
			cmd.CommandType=CommandType.Text;
			dest=new OracleDataAdapter(cmd);
			ds=new DataSet();
			dest.Fill(ds);	
			cmd.Dispose();				
			con.Close();con.Dispose();
			return long.Parse(ds.Tables[0].Rows[0][0].ToString());
		}

		public long get_stt_ngay(string m_ngay)
		{
			string xxx=user+mmyy(m_ngay);
			sql="update "+xxx+".sttngay set so=so+1 where to_char(ngay,'dd/mm/yyyy')=:m_ngay";
			con=new OracleConnection(sConn);
			con.Open();
			cmd=new OracleCommand(sql,con);
			cmd.CommandType=CommandType.Text;
			cmd.Parameters.Add("m_ngay",OracleType.VarChar,10).Value=m_ngay;
			int irec=cmd.ExecuteNonQuery();
			cmd.Dispose();
			if (irec==0)
			{
				sql="insert into "+xxx+".sttngay (ngay,so) values (to_date(:m_ngay,'dd/mm/yyyy'),1)";
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_ngay",OracleType.VarChar,10).Value=m_ngay;
				cmd.ExecuteNonQuery();
				cmd.Dispose();
			}
			sql="select so from "+xxx+".sttngay where to_char(ngay,'dd/mm/yyyy')='"+m_ngay+"'";
			cmd=new OracleCommand(sql,con);
			cmd.CommandType=CommandType.Text;
			dest=new OracleDataAdapter(cmd);
			ds=new DataSet();
			dest.Fill(ds);	
			cmd.Dispose();				
			con.Close();con.Dispose();
			return long.Parse(ds.Tables[0].Rows[0][0].ToString());
		}

		public bool upd_sttkham(string m_ngay,string m_makp)
		{
			string xxx=user+mmyy(m_ngay);
			sql="update "+xxx+".sttkham set makp=:m_makp where to_char(ngay,'dd/mm/yyyy')=:m_ngay and makp=:m_makp";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
				cmd.Parameters.Add("m_ngay",OracleType.VarChar,10).Value=m_ngay;
				cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".sttkham (ngay,makp) values (to_date(:m_ngay,'dd/mm/yyyy'),:m_makp)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_ngay",OracleType.VarChar,10).Value=m_ngay;
					cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
					cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"sttkham");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_sttkham(string m_ngay,string m_makp,long m_stt)
		{
			string xxx=user+mmyy(m_ngay);
			sql="update "+xxx+".sttkham set so=so+1,stt=:m_stt where to_char(ngay,'dd/mm/yyyy')=:m_ngay and makp=:m_makp";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
				cmd.Parameters.Add("m_ngay",OracleType.VarChar,10).Value=m_ngay;
				cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".sttkham (ngay,makp,so,stt) values (to_date(:m_ngay,'dd/mm/yyyy'),:m_makp,1,:m_stt)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_ngay",OracleType.VarChar,10).Value=m_ngay;
					cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
					cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
					cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"sttkham");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public long getSttkham(string ngay,string makp)
		{
			string xxx=user+mmyy(ngay);
			long so=get_stt_ngay(ngay);
			upd_sttkham(ngay,makp,so);
			upd_sttchitiet(ngay,makp,so);
			return so;
		}

		public bool upd_sttchitiet(string m_ngay,string m_makp,long m_stt)
		{
			string xxx=user+mmyy(m_ngay);
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				sql="insert into "+xxx+".sttchitiet (ngay,makp,stt) values (to_date(:m_ngay,'dd/mm/yyyy'),:m_makp,:m_stt)";
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_ngay",OracleType.VarChar,10).Value=m_ngay;
				cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
				cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
				cmd.ExecuteNonQuery();
				cmd.Dispose();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"sttchitiet");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_sttnghi(string m_ngay,string m_makp,long m_userid)
		{
			string xxx=user+mmyy(m_ngay);
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				sql="insert into "+xxx+".sttnghi (ngay,makp,userid) values (to_date(:m_ngay,'dd/mm/yyyy'),:m_makp,:m_userid)";
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_ngay",OracleType.VarChar,10).Value=m_ngay;
				cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.ExecuteNonQuery();
				cmd.Dispose();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"sttnghi");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_sttkhoamo(string m_ngay,string m_makp,int m_tinhtrang,long m_userid)
		{
			string xxx=user+mmyy(m_ngay);
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				sql="insert into "+xxx+".sttkhoamo (ngay,makp,tinhtrang,userid) values (to_date(:m_ngay,'dd/mm/yyyy'),:m_makp,:m_tinhtrang,:m_userid)";
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_ngay",OracleType.VarChar,10).Value=m_ngay;
				cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
				cmd.Parameters.Add("m_tinhtrang",OracleType.Number).Value=m_tinhtrang;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.ExecuteNonQuery();
				cmd.Dispose();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"sttkhoamo");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public long getSttkham_hen(string ngay,string makp)
		{
			long so=get_stt_ngay_hen(ngay);
			upd_sttkham_hen(ngay,makp,so);
			upd_sttchitiet_hen(ngay,makp,so);
			return so;
		}

		public long get_stt_ngay_hen(string m_ngay)
		{
			sql="update sttngay set so=so+1 where to_char(ngay,'dd/mm/yyyy')=:m_ngay";
			con=new OracleConnection(sConn);
			con.Open();
			cmd=new OracleCommand(sql,con);
			cmd.CommandType=CommandType.Text;
			cmd.Parameters.Add("m_ngay",OracleType.VarChar,10).Value=m_ngay;
			int irec=cmd.ExecuteNonQuery();
			cmd.Dispose();
			if (irec==0)
			{
				sql="insert into sttngay (ngay,so) values (to_date(:m_ngay,'dd/mm/yyyy'),1)";
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_ngay",OracleType.VarChar,10).Value=m_ngay;
				cmd.ExecuteNonQuery();
				cmd.Dispose();
			}
			sql="select so from sttngay where to_char(ngay,'dd/mm/yyyy')='"+m_ngay+"'";
			cmd=new OracleCommand(sql,con);
			cmd.CommandType=CommandType.Text;
			dest=new OracleDataAdapter(cmd);
			ds=new DataSet();
			dest.Fill(ds);	
			cmd.Dispose();				
			con.Close();con.Dispose();
			return long.Parse(ds.Tables[0].Rows[0][0].ToString());
		}

		public bool upd_sttkham_hen(string m_ngay,string m_makp)
		{
			sql="update sttkham set makp=:m_makp where to_char(ngay,'dd/mm/yyyy')=:m_ngay and makp=:m_makp";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
				cmd.Parameters.Add("m_ngay",OracleType.VarChar,10).Value=m_ngay;
				cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into sttkham (ngay,makp) values (to_date(:m_ngay,'dd/mm/yyyy'),:m_makp)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_ngay",OracleType.VarChar,10).Value=m_ngay;
					cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
					cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"sttkham");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_sttkham_hen(string m_ngay,string m_makp,long m_stt)
		{
			sql="update sttkham set so=so+1,stt=:m_stt where to_char(ngay,'dd/mm/yyyy')=:m_ngay and makp=:m_makp";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
				cmd.Parameters.Add("m_ngay",OracleType.VarChar,10).Value=m_ngay;
				cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into sttkham (ngay,makp,so,stt) values (to_date(:m_ngay,'dd/mm/yyyy'),:m_makp,1,:m_stt)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_ngay",OracleType.VarChar,10).Value=m_ngay;
					cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
					cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
					cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"sttkham");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_sttchitiet_hen(string m_ngay,string m_makp,long m_stt)
		{
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				sql="insert into sttchitiet (ngay,makp,stt) values (to_date(:m_ngay,'dd/mm/yyyy'),:m_makp,:m_stt)";
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_ngay",OracleType.VarChar,10).Value=m_ngay;
				cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
				cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
				cmd.ExecuteNonQuery();
				cmd.Dispose();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"sttchitiet");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public void upd_remark(string m_makp,int m_remark)
		{
			execute_data("update btdkp_bv set remark="+m_remark+" where makp='"+m_makp+"'");
		}
		public bool get_remark(string m_makp)
		{
			return get_data("select * from btdkp_bv where makp='"+m_makp+"' and remark=1").Tables[0].Rows.Count>0;
		}

		public bool upd_chiphikb(string m_mabn,string m_ngay,long m_mavaovien,decimal m_tamung)
		{
			string xxx=user+mmyy(m_ngay);
			sql="update "+xxx+".chiphikb set tamung=tamung+:m_tamung where mavaovien=:m_mavaovien";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_tamung",OracleType.Number).Value=m_tamung;
				cmd.Parameters.Add("m_mavaovien",OracleType.Number).Value=m_mavaovien;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".chiphikb (mabn,ngay,mavaovien,tamung) values (:m_mabn,to_date(:m_ngay,'dd/mm/yyyy'),:m_mavaovien,:m_tamung)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
					cmd.Parameters.Add("m_ngay",OracleType.VarChar,10).Value=m_ngay;
					cmd.Parameters.Add("m_mavaovien",OracleType.Number).Value=m_mavaovien;
					cmd.Parameters.Add("m_tamung",OracleType.Number).Value=m_tamung;
					cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"chiphikb");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_chiphikb(string m_ngay,long m_mavaovien,decimal m_sotien)
		{
			string xxx=user+mmyy(m_ngay);
			sql="update "+xxx+".chiphikb set sotien=sotien+:m_sotien where mavaovien=:m_mavaovien";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_sotien",OracleType.Number).Value=m_sotien;
				cmd.Parameters.Add("m_mavaovien",OracleType.Number).Value=m_mavaovien;
				cmd.ExecuteNonQuery();
				cmd.Dispose();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"chiphikb");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public decimal get_chiphikb(string m_ngay,long m_mavaovien)
		{
			ds=get_data("select tamung-sotien+thuathieu as conlai from "+user+mmyy(m_ngay)+".chiphikb where mavaovien="+m_mavaovien);
			if (ds.Tables[0].Rows.Count>0) return decimal.Parse(ds.Tables[0].Rows[0]["conlai"].ToString());
			else return 0;
		}

		public bool chiphikb(string m_ngay,long m_mavaovien)
		{
			return get_data("select * from "+user+mmyy(m_ngay)+".chiphikb where mavaovien="+m_mavaovien+" and done=1").Tables[0].Rows.Count>0;
		}

		public decimal get_tyle_tamung(decimal sotien)
		{
			decimal ret=0;
			sql="select tyle from v_tylethe where tu<="+sotien+" and den>="+sotien+" order by to_char(ngay,'yyyymmdd'),id desc";
			DataTable tmp=get_data(sql).Tables[0];
			if (tmp.Rows.Count>0) ret=decimal.Parse(tmp.Rows[0]["tyle"].ToString());
			else
			{
				sql="select tyle from v_tylethe where den<="+sotien+" order by den desc,to_char(ngay,'yyyymmdd'),id desc";
				tmp=get_data(sql).Tables[0];
				if (tmp.Rows.Count>0) ret=decimal.Parse(tmp.Rows[0]["tyle"].ToString());
			}
			return ret;
		}

		//Lấy giá trị hiện tại của hệ thống ngày giờ
		private void get_current()
		{
			try
			{		
				//
				DataSet lds=new DataSet();
				if(File.Exists("..\\..\\..\\xml\\date_format.xml")==false)
				{
					DataTable ldt=new DataTable(); 
					ldt.TableName="t_date";
					ldt.Columns.Add("sShortDate");
					ldt.Columns.Add("sLongDate");
					ldt.Columns.Add("sDecimal");
					ldt.Columns.Add("sThousand");
					ldt.Columns.Add("sNegativeSign");				
					ldt.Columns.Add("iLZero");
					ldt.Columns.Add("sTime");
					ldt.Columns.Add("sDate");
					ldt.Columns.Add("sTimeFormat");
					ldt.Columns.Add("s1159");
					ldt.Columns.Add("s2359");
					//
					DataRow dr= ldt.NewRow();
					dr[0]=" ";
					dr[1]=" ";
					dr[2]=" ";
					dr[3]=" ";
					dr[4]=" ";
					dr[5]=" ";
					dr[6]=" ";
					dr[7]=" ";
					dr[8]=" ";
					dr[9]=" ";
					dr[10]=" ";
					ldt.Rows.Add(dr);
					ldt.AcceptChanges();
					//
					lds.Tables.Add(ldt);
					lds.AcceptChanges();				
					lds.WriteXml("..\\..\\..\\xml\\date_format.xml");
					lds.Dispose();
				}
				lds.ReadXml("..\\..\\..\\xml\\date_format.xml");
				lds.Tables[0].Clear();
				//
				string path = "Control Panel\\International";
				RegistryKey k = Registry.CurrentUser;//chỉ ảnh hưởng user hiện tại
				k = k.OpenSubKey(path, true);
				DataRow r = lds.Tables[0].NewRow();
				
				r["sShortDate"]=k.GetValue("sShortDate").ToString();//ngày kiểu shortdate
				r["sLongDate"]=k.GetValue("sLongDate").ToString();//, "dddd, MMMM dd, yyyy");//ngày kiểu longdate
				r["sDecimal"]=k.GetValue("sDecimal").ToString();//, ".");//giá trị thập phân
				r["sThousand"]=k.GetValue("sThousand").ToString();//, ",");//dấu nhóm chữ số 1,000,000
				r["sNegativeSign"]=k.GetValue("sNegativeSign").ToString();//, "-");//ký hiệu âm
				r["iLZero"]=k.GetValue("iLZero").ToString();//, "0");// 1:có '0' đứng trước 0.7; 0 ngược lại

				r["sTime"]=k.GetValue("sTime").ToString();//, ":");//dấu cách giữ hh:mm:ss
				r["sDate"]=k.GetValue("sDate").ToString();//, "/");//dấu cách giữ MM/dd/yyyy
				r["sTimeFormat"]=k.GetValue("sTimeFormat").ToString();//, "hh:mm:ss tt");//định định dạng thời gian
				r["s1159"]=k.GetValue("s1159").ToString();//, "AM");//buổi sáng
				r["s2359"]=k.GetValue("s2359").ToString();//, "PM");//buổi chiều				
				
				lds.Tables[0].Rows.Add(r);
				lds.AcceptChanges();
				lds.WriteXml("..\\..\\..\\xml\\date_format.xml");								

				k.Flush();

				lds.Dispose();
			}
			catch
			{ }
		}

		//set hệ thống ngày giờ theo quy định của chương trình
		public void setStandar()
		{
			get_current();
			try
			{
				string path = "Control Panel\\International";
				RegistryKey k = Registry.CurrentUser;//chỉ ảnh hưởng user hiện tại
				k = k.OpenSubKey(path, true);
				k.SetValue("sShortDate", "MM/dd/yyyy");//ngày kiểu shortdate
				k.SetValue("sLongDate", "dddd, MMMM dd, yyyy");//ngày kiểu longdate
				k.SetValue("sDecimal", ".");//giá trị thập phân
				k.SetValue("sThousand", ",");//dấu nhóm chữ số 1,000,000
				k.SetValue("sNegativeSign", "-");//ký hiệu âm
				k.SetValue("iLZero", "0");// 1:có '0' đứng trước 0.7; 0 ngược lại

				k.SetValue("sTime", ":");//dấu cách giữ hh:mm:ss
				k.SetValue("sDate", "/");//dấu cách giữ MM/dd/yyyy
				k.SetValue("sTimeFormat", "hh:mm:ss tt");//định định dạng thời gian
				k.SetValue("s1159", "AM");//buổi sáng
				k.SetValue("s2359", "PM");//buổi chiều

				k.Flush();
			}
			catch
			{ }
		}

		//trả lại ngày giờ hệ thống của máy lúc đầu.
		public void set_current()
		{
			try
			{
				string path = "Control Panel\\International";
				RegistryKey k = Registry.CurrentUser;//chỉ ảnh hưởng user hiện tại
				k = k.OpenSubKey(path, true);
				//
				//
				DataSet lds=new DataSet();
				lds.ReadXml("..\\..\\..\\xml\\date_format.xml");
				foreach(DataRow r in lds.Tables[0].Rows)
				{
					//
					k.SetValue("sShortDate", (r["sShortDate"].ToString()!="")?r["sShortDate"].ToString():"MM/dd/yyyy");//ngày kiểu shortdate
					k.SetValue("sLongDate", (r["sLongDate"].ToString()!="")?r["sLongDate"].ToString():"dddd, MMMM dd, yyyy");//ngày kiểu longdate
					k.SetValue("sDecimal", (r["sDecimal"].ToString()!="")?r["sDecimal"].ToString():".");//giá trị thập phân
					k.SetValue("sThousand", (r["sThousand"].ToString()!="")?r["sThousand"].ToString():",");//dấu nhóm chữ số 1,000,000
					k.SetValue("sNegativeSign", (r["sNegativeSign"].ToString()!="")?r["sNegativeSign"].ToString():"-");//ký hiệu âm
					k.SetValue("iLZero",(r["iLZero"].ToString()!="")?r["iLZero"].ToString():"0");// 1:có '0' đứng trước 0.7; 0 ngược lại

					k.SetValue("sTime", (r["sTime"].ToString()!="")?r["sTime"].ToString():":");//dấu cách giữ hh:mm:ss
					k.SetValue("sDate",(r["sDate"].ToString()!="")?r["sDate"].ToString(): "/");//dấu cách giữ MM/dd/yyyy
					k.SetValue("sTimeFormat", (r["sTimeFormat"].ToString()!="")?r["sTimeFormat"].ToString():"hh:mm:ss tt");//định định dạng thời gian
					k.SetValue("s1159", (r["s1159"].ToString()!="")?r["s1159"].ToString():"AM");//buổi sáng
					k.SetValue("s2359", (r["s2359"].ToString()!="")?r["s2359"].ToString():"PM");//buổi chiều

					k.Flush();
					break;
				}
			}
			catch
			{ }
		}

		public string getkho(string s_ngay,int nhom,int thuoc,bool bThua,DataTable dtmakp,int makp,int loai,DataTable dtletet,bool bNgoaigio_ylenh)
		{
			string sql="";
			string s_makho="",s_kho="",s_nguon_khoa="",s_khong="",sngoaigio_makp=sNgoaigio_makp;
			DataRow r;
			sql="select * from d_dmkho where nhom="+nhom;
			if (thuoc==1) sql+=" and loai="+thuoc;
			if (bThua) sql+=" and thua=1";
			else
			{
				r=getrowbyid(dtmakp,"id="+makp);
				if (r!=null)
				{
					s_kho=r["makho"].ToString();
					s_khong=s_kho;
					s_nguon_khoa=r["nguon"].ToString();
				}
				s_makho=get_data("select kho from d_dmphieu where id="+loai).Tables[0].Rows[0][0].ToString();
				int hh1,hh2,hh3,mm1,mm2,mm3,hh4,hh5,hh6,mm4,mm5,mm6;
				string kho="";	
				if(bPhanbietkholinh_tronggio_ngoaigio)
				{
					r=getrowbyid(dtletet,"ngay='"+s_ngay.Substring(0,5)+"'");
					bool bLetet=r!=null;
					hh3=int.Parse(sGiobaocao.Substring(0,2));
					mm3=int.Parse(sGiobaocao.Substring(3,2));
					hh4=int.Parse(sGiotrua_tu.Substring(0,2));
					mm4=int.Parse(sGiotrua_tu.Substring(3,2));
					hh5=int.Parse(sGiotrua_den.Substring(0,2));
					mm5=int.Parse(sGiotrua_den.Substring(3,2));
					hh6=int.Parse(sGiochunhat.Substring(0,2));
					mm6=int.Parse(sGiochunhat.Substring(3,2));
					DateTime dt=(bNgoaigio_ylenh)?StringToDate(s_ngay.Substring(0,10)):StringToDate(ngayhienhanh_server.Substring(0,10));
					string ddd=dt.DayOfWeek.ToString().Substring(0,3);
					if (loai==1 && nhom==nhom_duoc && s_makho!="" && (gio_linh!="00:00" || sGiochunhat!="00:00") && (sGiotrua_tu!=sGiotrua_den))
					{
						hh1=int.Parse(s_ngay.Substring(11,2));
						mm1=int.Parse(s_ngay.Substring(14,2));
						hh2=int.Parse(gio_linh.Substring(0,2));
						mm2=int.Parse(gio_linh.Substring(3,2));
						kho=kho_linh;
						if (kho!="") kho+=",";
						if (gio_linh!="00:00")
						{
							if (hh6!=0 || mm6!=0)
							{
								if (bLetet 
									|| ((ddd=="Sat") && (hh1>hh6 || (hh1==hh6 && mm1>mm6)))
									|| ((ddd=="Sun") && (hh1>hh6 || (hh1==hh6 && mm1>mm6)))
									|| hh1>hh2 || (hh1==hh2 && mm1>mm2) || hh1<hh3 || (hh1==hh3 && mm1<mm3)
									|| ((ddd!="Sat" || ddd!="Sun") && (hh1>hh4 || (hh1==hh4 && mm1>mm4)) && (hh1<hh5 || (hh1==hh5 && mm1<mm5)))) 
								{
									s_makho=kho;
									s_kho="";
								}
								else
								{
									if (kho!="" && s_makho!="" && s_makho.IndexOf(kho)!=-1) s_makho=s_makho.Remove(s_makho.IndexOf(kho),kho.Length);
									if (kho!="" && s_kho!="" && s_kho.IndexOf(kho)!=-1) s_kho=s_kho.Remove(s_kho.IndexOf(kho),kho.Length);
								}
							}
							else if (bLetet || ddd=="Sat" || ddd=="Sun" || hh1>hh2 || (hh1==hh2 && mm1>mm2) || hh1<hh3 || (hh1==hh3 && mm1<mm3)
								|| ((ddd!="Sat" || ddd!="Sun") && (hh1>hh4 || (hh1==hh4 && mm1>mm4)) && (hh1<hh5 || (hh1==hh5 && mm1<mm5)))) 
							{
								s_makho=kho;
								s_kho="";
							}
							else 
							{
								if (kho!="" && s_makho!="" && s_makho.IndexOf(kho)!=-1) s_makho=s_makho.Remove(s_makho.IndexOf(kho),kho.Length);
								if (kho!="" && s_kho!="" && s_kho.IndexOf(kho)!=-1) s_kho=s_kho.Remove(s_kho.IndexOf(kho),kho.Length);
							}
						}
						else
						{
							if (bLetet || ddd=="Sat" || ddd=="Sun"	
								|| ((ddd=="Fri") && (hh1>hh6 || (hh1==hh6 && mm1>mm6)))
								|| ((ddd=="Mon") && (hh1<hh3 || (hh1==hh3 && mm1<mm3))))
							{
								s_makho=kho;
								s_kho="";
							}
							else
							{
								if (kho!="" && s_makho!="" && s_makho.IndexOf(kho)!=-1) s_makho=s_makho.Remove(s_makho.IndexOf(kho),kho.Length);
								if (kho!="" && s_kho!="" && s_kho.IndexOf(kho)!=-1) s_kho=s_kho.Remove(s_kho.IndexOf(kho),kho.Length);
							}
						}
						if (s_makho==kho_linh+"," && s_kho=="")
						{
							foreach(DataRow r1 in get_data("select * from d_dmkho where ngoaigio=0 and nhom="+nhom).Tables[0].Rows)
								if (s_khong.IndexOf(r1["id"].ToString()+",")!=-1) s_makho+=r1["id"].ToString()+",";
						}
					}
				}
				//
				if (s_makho!="") sql+=" and id in ("+s_makho.Substring(0,s_makho.Length-1)+")";
				if (s_kho!="") sql+=" and id in ("+s_kho.Substring(0,s_kho.Length-1)+")";
			}
			sql+=" order by stt";
			return sql;
		}

		public string getkho_ttb(string s_ngay,int nhom,int thuoc,bool bThua,DataTable dtmakp,int makp,int loai,DataTable dtletet,bool bNgoaigio_ylenh)
		{
			string sql="";
			string s_makho="",s_kho="",s_nguon_khoa="",s_khong="",sngoaigio_makp=sNgoaigio_makp;
			DataRow r;
			sql="select * from ttb_dmkho where nhom="+nhom;
			if (thuoc==1) sql+=" and loai="+thuoc;
			if (bThua) sql+=" and thua=1";
			else
			{
				r=getrowbyid(dtmakp,"id="+makp);
				if (r!=null)
				{
					s_kho=r["makho"].ToString();
					s_khong=s_kho;
					s_nguon_khoa=r["nguon"].ToString();
				}
				s_makho=get_data("select kho from ttb_dmphieu where id="+loai).Tables[0].Rows[0][0].ToString();
				int hh1,hh2,hh3,mm1,mm2,mm3,hh4,hh5,hh6,mm4,mm5,mm6;
				string kho="";	
				if(bPhanbietkholinh_tronggio_ngoaigio)
				{
					r=getrowbyid(dtletet,"ngay='"+s_ngay.Substring(0,5)+"'");
					bool bLetet=r!=null;
					hh3=int.Parse(sGiobaocao.Substring(0,2));
					mm3=int.Parse(sGiobaocao.Substring(3,2));
					hh4=int.Parse(sGiotrua_tu.Substring(0,2));
					mm4=int.Parse(sGiotrua_tu.Substring(3,2));
					hh5=int.Parse(sGiotrua_den.Substring(0,2));
					mm5=int.Parse(sGiotrua_den.Substring(3,2));
					hh6=int.Parse(sGiochunhat.Substring(0,2));
					mm6=int.Parse(sGiochunhat.Substring(3,2));
					DateTime dt=(bNgoaigio_ylenh)?StringToDate(s_ngay.Substring(0,10)):StringToDate(ngayhienhanh_server.Substring(0,10));
					string ddd=dt.DayOfWeek.ToString().Substring(0,3);
					if (loai==1 && nhom==nhom_duoc && s_makho!="" && (gio_linh!="00:00" || sGiochunhat!="00:00") && (sGiotrua_tu!=sGiotrua_den))
					{
						hh1=int.Parse(s_ngay.Substring(11,2));
						mm1=int.Parse(s_ngay.Substring(14,2));
						hh2=int.Parse(gio_linh.Substring(0,2));
						mm2=int.Parse(gio_linh.Substring(3,2));
						kho=kho_linh;
						if (kho!="") kho+=",";
						if (gio_linh!="00:00")
						{
							if (hh6!=0 || mm6!=0)
							{
								if (bLetet 
									|| ((ddd=="Sat") && (hh1>hh6 || (hh1==hh6 && mm1>mm6)))
									|| ((ddd=="Sun") && (hh1>hh6 || (hh1==hh6 && mm1>mm6)))
									|| hh1>hh2 || (hh1==hh2 && mm1>mm2) || hh1<hh3 || (hh1==hh3 && mm1<mm3)
									|| ((ddd!="Sat" || ddd!="Sun") && (hh1>hh4 || (hh1==hh4 && mm1>mm4)) && (hh1<hh5 || (hh1==hh5 && mm1<mm5)))) 
								{
									s_makho=kho;
									s_kho="";
								}
								else
								{
									if (kho!="" && s_makho!="" && s_makho.IndexOf(kho)!=-1) s_makho=s_makho.Remove(s_makho.IndexOf(kho),kho.Length);
									if (kho!="" && s_kho!="" && s_kho.IndexOf(kho)!=-1) s_kho=s_kho.Remove(s_kho.IndexOf(kho),kho.Length);
								}
							}
							else if (bLetet || ddd=="Sat" || ddd=="Sun" || hh1>hh2 || (hh1==hh2 && mm1>mm2) || hh1<hh3 || (hh1==hh3 && mm1<mm3)
								|| ((ddd!="Sat" || ddd!="Sun") && (hh1>hh4 || (hh1==hh4 && mm1>mm4)) && (hh1<hh5 || (hh1==hh5 && mm1<mm5)))) 
							{
								s_makho=kho;
								s_kho="";
							}
							else 
							{
								if (kho!="" && s_makho!="" && s_makho.IndexOf(kho)!=-1) s_makho=s_makho.Remove(s_makho.IndexOf(kho),kho.Length);
								if (kho!="" && s_kho!="" && s_kho.IndexOf(kho)!=-1) s_kho=s_kho.Remove(s_kho.IndexOf(kho),kho.Length);
							}
						}
						else
						{
							if (bLetet || ddd=="Sat" || ddd=="Sun"	
								|| ((ddd=="Fri") && (hh1>hh6 || (hh1==hh6 && mm1>mm6)))
								|| ((ddd=="Mon") && (hh1<hh3 || (hh1==hh3 && mm1<mm3))))
							{
								s_makho=kho;
								s_kho="";
							}
							else
							{
								if (kho!="" && s_makho!="" && s_makho.IndexOf(kho)!=-1) s_makho=s_makho.Remove(s_makho.IndexOf(kho),kho.Length);
								if (kho!="" && s_kho!="" && s_kho.IndexOf(kho)!=-1) s_kho=s_kho.Remove(s_kho.IndexOf(kho),kho.Length);
							}
						}
						if (s_makho==kho_linh+"," && s_kho=="")
						{
							foreach(DataRow r1 in get_data("select * from ttb_dmkho where ngoaigio=0 and nhom="+nhom).Tables[0].Rows)
								if (s_khong.IndexOf(r1["id"].ToString()+",")!=-1) s_makho+=r1["id"].ToString()+",";
						}
					}
				}
				//
				if (s_makho!="") sql+=" and id in ("+s_makho.Substring(0,s_makho.Length-1)+")";
				if (s_kho!="") sql+=" and id in ("+s_kho.Substring(0,s_kho.Length-1)+")";
			}
			sql+=" order by stt";
			return sql;
		}

		public void upd_giuongdieutri(string mabn,long maql,long idkhoa,string ngayvao,string ngayra,string makp,int madoituong,int _userid)
		{			
			int _madoituong=madoituong_giuongdieutri;
			if (_madoituong!=0) madoituong=_madoituong;
			
			long id=get_id_vpkhoa;
			int mavp=iGiuongdieutri,noisoi=0,loai1=0;
			decimal sl=0,dg=0,so=0;
			bool bTungay=bGiuongdieutri_tungay;
			string ngaypt="",ngayde="",_mmyy=mmyy(ngayra),mapt="";
			String sql="select a.mapt,c.ma,to_char(a.ngay,'dd/mm/yyyy hh24:mi') as ngay,a.noisoi from pttt a,dmpttt b,loaipttt c where a.mapt=b.mapt and b.loaipt=c.ma and a.mabn='"+mabn+"'";
			sql+=" and to_date(a.ngay,'dd/mm/yy') between to_date('"+ngayvao.Substring(0,10)+"','dd/mm/yy') and to_date('"+ngayra.Substring(0,10)+"','dd/mm/yy')";
			sql+=" order by a.ngay";
			foreach(DataRow r in get_data(sql).Tables[0].Rows)
			{
				mapt=r["mapt"].ToString();
				ngaypt=r["ngay"].ToString().Substring(0,10);
				noisoi=int.Parse(r["noisoi"].ToString());
				loai1=(int.Parse(r["ma"].ToString())<5)?1:0;
				break;
			}
			if (ngaypt=="")
			{
				foreach(DataRow r in get_data("select to_char(ngay,'dd/mm/yyyy hh24:mi') as ngay from cdsankhoa where maql="+maql).Tables[0].Rows)
					ngayde=r["ngay"].ToString().Substring(0,10);
			}
			if (ngaypt!="")
			{
				if (mapt.Substring(0,1)=="T")
				{
					sl=Math.Max(1,songay(StringToDateTime(ngayra),StringToDateTime(ngayvao),0));
					dg=dGtruocpt;
					upd_vpkhoa(_mmyy,id,mabn,maql,idkhoa,ngayra,makp,madoituong,mavp,sl,dg,0,_userid,0);
				}
				else
				{
					sl=Math.Max(0,songay(StringToDateTime(ngaypt).AddDays((bTungay)?0:-1),StringToDateTime(ngayvao),0));
					dg=dGtruocpt;
					if (sl>0) upd_vpkhoa(_mmyy,id,mabn,maql,idkhoa,ngayra,makp,madoituong,mavp,sl,dg,0,_userid,0);
					if (noisoi==1)
					{
						if(!bGiuongthuong_dichvu){so=songay(StringToDateTime(ngayra),(sl==0)?StringToDateTime(ngayvao):StringToDateTime(ngaypt).AddDays((bTungay)?0:-1),0);}
						else {so=(decimal)songay_1(StringToDateTime(ngayra),(sl==0)?StringToDateTime(ngayvao):StringToDateTime(ngaypt).AddDays((bTungay)?0:-1));}
						if (so>0)
						{
							sl=Math.Min(so,lGnsdau);
							dg=dGnsstdau;
							id=get_id_vpkhoa;
							upd_vpkhoa(_mmyy,id,mabn,maql,idkhoa,ngayra,makp,madoituong,mavp,sl,dg,0,_userid,0);
							so-=sl;
							if (so>0)
							{
								sl=Math.Min(so,lGnstiep);
								dg=dGnssttiep;
								id=get_id_vpkhoa;
								upd_vpkhoa(_mmyy,id,mabn,maql,idkhoa,ngayra,makp,madoituong,mavp,sl,dg,0,_userid,0);
								so-=sl;
								if (so>0)
								{
									sl=so;
									dg=dGnsstcon;
									id=get_id_vpkhoa;
									upd_vpkhoa(_mmyy,id,mabn,maql,idkhoa,ngayra,makp,madoituong,mavp,sl,dg,0,_userid,0);
								}
							}
						}
					}
					else if (loai1==1)
					{
						if(!bGiuongthuong_dichvu){so=songay(StringToDateTime(ngayra),(sl==0)?StringToDateTime(ngayvao):StringToDateTime(ngaypt).AddDays((bTungay)?0:-1),0);}
						else {so=(decimal)songay_1(StringToDateTime(ngayra),(sl==0)?StringToDateTime(ngayvao):StringToDateTime(ngaypt).AddDays((bTungay)?0:-1));}
						if (so>0)
						{
							sl=Math.Min(so,lGl1dau);
							dg=dGl1stdau;
							id=get_id_vpkhoa;
							upd_vpkhoa(_mmyy,id,mabn,maql,idkhoa,ngayra,makp,madoituong,mavp,sl,dg,0,_userid,0);
							so-=sl;
							if (so>0)
							{
								sl=Math.Min(so,lGl1tiep);
								dg=dGl1sttiep;
								id=get_id_vpkhoa;
								upd_vpkhoa(_mmyy,id,mabn,maql,idkhoa,ngayra,makp,madoituong,mavp,sl,dg,0,_userid,0);
								so-=sl;
								if (so>0)
								{
									sl=so;
									dg=dGl1stcon;
									id=get_id_vpkhoa;
									upd_vpkhoa(_mmyy,id,mabn,maql,idkhoa,ngayra,makp,madoituong,mavp,sl,dg,0,_userid,0);
								}
							}
						}
					}
					else
					{
						if(!bGiuongthuong_dichvu){so=songay(StringToDateTime(ngayra),(sl==0)?StringToDateTime(ngayvao):StringToDateTime(ngaypt).AddDays((bTungay)?0:-1),0);}
						else {so=(decimal)songay_1(StringToDateTime(ngayra),(sl==0)?StringToDateTime(ngayvao):StringToDateTime(ngaypt).AddDays((bTungay)?0:-1));}
						if (so>0)
						{
							sl=Math.Min(so,lGl2dau);
							dg=dGl2stdau;
							id=get_id_vpkhoa;
							upd_vpkhoa(_mmyy,id,mabn,maql,idkhoa,ngayra,makp,madoituong,mavp,sl,dg,0,_userid,0);
							so-=sl;
							if (so>0)
							{
								sl=Math.Min(so,lGl2tiep);
								dg=dGl2sttiep;
								id=get_id_vpkhoa;
								upd_vpkhoa(_mmyy,id,mabn,maql,idkhoa,ngayra,makp,madoituong,mavp,sl,dg,0,_userid,0);
								so-=sl;
								if (so>0)
								{
									sl=so;
									dg=dGl2stcon;
									id=get_id_vpkhoa;
									upd_vpkhoa(_mmyy,id,mabn,maql,idkhoa,ngayra,makp,madoituong,mavp,sl,dg,0,_userid,0);
								}
							}
						}
					}
				}
			}
			else if (ngayde!="")
			{
				sl=Math.Max(0,songay(StringToDateTime(ngayde).AddDays((bTungay)?0:-1),StringToDateTime(ngayvao),0));
				dg=dGtruocde;
				if (sl>0) upd_vpkhoa(_mmyy,id,mabn,maql,idkhoa,ngayra,makp,madoituong,mavp,sl,dg,0,_userid,0);
				so=songay(StringToDateTime(ngayra),(sl==0)?StringToDateTime(ngayvao):StringToDateTime(ngayde).AddDays((bTungay)?0:-1),0);
				if (so>0)
				{
					sl=Math.Min(so,lGdedau);
					try
					{
						if(get_data("select cachthucde from cdsankhoa where maql="+maql).Tables[0].Rows[0]["cachthucde"].ToString()!="DT"){dg=dGdestdau;}
					}
					catch{dg=dGdestdau;}
					id=get_id_vpkhoa;
					upd_vpkhoa(_mmyy,id,mabn,maql,idkhoa,ngayra,makp,madoituong,mavp,sl,dg,0,_userid,0);
					so-=sl;
					if (so>0)
					{
						sl=Math.Min(so,lGdetiep);
						dg=dGdesttiep;
						id=get_id_vpkhoa;
						upd_vpkhoa(_mmyy,id,mabn,maql,idkhoa,ngayra,makp,madoituong,mavp,sl,dg,0,_userid,0);
						so-=sl;
						if (so>0)
						{
							sl=so;
							dg=dGdestcon;
							id=get_id_vpkhoa;
							upd_vpkhoa(_mmyy,id,mabn,maql,idkhoa,ngayra,makp,madoituong,mavp,sl,dg,0,_userid,0);
						}
					}
				}
			}
			else
			{
				sl=Math.Max(1,songay(StringToDateTime(ngayra),StringToDateTime(ngayvao),0));
				dg=dGtruocde;
				upd_vpkhoa(_mmyy,id,mabn,maql,idkhoa,ngayra,makp,madoituong,mavp,sl,dg,0,_userid,0);
			}
		}

		public void upd_giuongtt14(string mabn,long maql,long idkhoa,string ngayvao,string ngayra,string makp,int madoituong,int _userid)
		{			
			long id=get_id_vpkhoa;
			int mavp=iGiuongthongtu14,loai=1;
			decimal sl=0,dg=0,so=0;
			string ngaypt="",_mmyy=mmyy(ngayra);
			String sql="select c.ma,to_char(a.ngay,'dd/mm/yyyy hh24:mi') as ngay,a.noisoi from pttt a,dmpttt b,loaipttt c where a.mapt=b.mapt and b.loaipt=c.ma and a.mabn='"+mabn+"'";
			sql+=" and to_date(a.ngay,'dd/mm/yy') between to_date('"+ngayvao.Substring(0,10)+"','dd/mm/yy') and to_date('"+ngayra.Substring(0,10)+"','dd/mm/yy')";
			sql+=" order by a.ngay";
			foreach(DataRow r in get_data(sql).Tables[0].Rows)
			{
				ngaypt=r["ngay"].ToString().Substring(0,10);
				loai=(int.Parse(r["ma"].ToString())<5)?1:(int.Parse(r["ma"].ToString())<8)?2:3;
				break;
			}
			if (ngaypt!="")
			{
				sl=Math.Max(0,songay(StringToDateTime(ngaypt).AddDays(-1),StringToDateTime(ngayvao),0));
				dg=dGtruoc14;
				if (sl>0) upd_vpkhoa(_mmyy,id,mabn,maql,idkhoa,ngayra,makp,madoituong,mavp,sl,dg,0,_userid,0);
				so=songay(StringToDateTime(ngayra),(sl==0)?StringToDateTime(ngayvao):StringToDateTime(ngaypt).AddDays(-1),0);
				if (so>0)
				{
					sl=Math.Min(so,lGdau14);
					dg=(loai==1)?dGl1s14:(loai==2)?dGl2s14:dGl3s14;
					id=get_id_vpkhoa;
					upd_vpkhoa(_mmyy,id,mabn,maql,idkhoa,ngayra,makp,madoituong,mavp,sl,dg,0,_userid,0);
					so-=sl;
					if (so>0)
					{
						sl=so;
						id=get_id_vpkhoa;
						upd_vpkhoa(_mmyy,id,mabn,maql,idkhoa,ngayra,makp,madoituong,mavp,sl,dg,0,_userid,0);
					}
				}
			}
			/*
			else
			{
				sl=Math.Max(1,songay(StringToDateTime(ngayra),StringToDateTime(ngayvao),1));
				dg=dGtruoc14;
				upd_vpkhoa(_mmyy,id,mabn,maql,idkhoa,ngayra,makp,madoituong,mavp,sl,dg,0,_userid,0);
			}
			*/
		}

		public DataTable dtPtttchidinh(string ngay,string mabn,string makp)
		{
			string snhompttt=sNhompttt;
			sql="select c.id,to_char(c.ngay,'dd/mm/yyyy hh24:mi') as ngay,c.mavp from v_giavp a,v_loaivp b,xxx.v_chidinh c where a.id_loai=b.id and a.id=c.mavp";
			if (iThongtu03!=0) sql+=" and b.id="+iThongtu03;
			else if (snhompttt!="") sql+=" and b.id_nhom in ("+snhompttt+")";
			sql+=" and c.mabn='"+mabn+"' and c.makp='"+makp+"' and c.done=0";
			sql+=" order by c.ngay desc";
			return get_data_mmyy(sql,ngay,ngay,true).Tables[0];
		}

		public string exp_chidinh(string v_mmyy, string v_id,string v_tra)
		{
			DataSet ads;
			string asql = "", apath = "", afield = "", arecord = "", aid_loai = "", aactive = "", adatatag = "", adatatag1 = "";
			try
			{
				foreach (DataRow r in get_data("select * from "+user+".links_histhongso where id in (1,2,3,4,5,6)").Tables[0].Rows)
				{
					if (r["id"].ToString() == "1")
					{
						apath = r["giatri"].ToString();
					}
					if (r["id"].ToString() == "2")
					{
						afield = r["giatri"].ToString().Trim();
					}
					if (r["id"].ToString() == "3")
					{
						arecord = r["giatri"].ToString().Trim();
					}
					if (r["id"].ToString() == "4")
					{
						aactive = r["giatri"].ToString().Trim();
					}
					if (r["id"].ToString() == "5")
					{
						aid_loai = r["giatri"].ToString().Trim();
					}
					if (r["id"].ToString() == "6")
					{
						adatatag = r["giatri"].ToString().Trim();
					}
				}
			}
			catch
			{
				apath = "";
				afield = "";
				arecord = "";
				aid_loai = "";
				aactive = "";
				adatatag = "";
			}

			try
			{
				if (apath == "" || afield == "" || arecord == "" || aid_loai == "")// || aactive != "1")
				{
					return "0";
				}

				string atenfile = "";//yymmddhhmmssxxxx.txt
				atenfile=get_data("select to_char(sysdate,'yymmddhh24miss') as ngay from dual").Tables[0].Rows[0]["ngay"].ToString();

				//atenfile = DateTime.Now.Year.ToString().Substring(2) + DateTime.Now.Month.ToString().PadLeft(2, '0') + DateTime.Now.Day.ToString().PadLeft(2, '0') + DateTime.Now.Hour.ToString().PadLeft(2, '0') + DateTime.Now.Minute.ToString().PadLeft(2, '0') + DateTime.Now.Second.ToString().PadLeft(2, '0') + DateTime.Now.Millisecond.ToString().PadLeft(4, '0');
				//asql = "select a.id,a.sobienlai,a.hoten,a.mabn,to_char(a.ngay,'yyyymmdd')||to_char(a.ngayud,'hhmmss') as ngaygio,e.phai as gioitinh,to_number(to_char(a.ngay,'yyyy'),9999) as tuoi1, a.namsinh as tuoi, b.mabs,'' as chandoan,b.makp,b.mavp as id_giavp,c.ma as mavp, c.ten, b.soluong*b.dongia as sotien,'N' as khan, case when b.tra>0 then '1' else '0' end as tra from medibvmmyy.v_vienphill a inner join medibvmmyy.v_vienphict b on a.id=b.id inner join medibv.v_giavp c on b.mavp=c.id inner join medibv.v_loaivp d on c.id_loai=d.id inner join medibv.btdbn e on a.mabn=e.mabn where a.id=" + v_id + " and d.id in (" + aid_loai + ")";
				
				asql=" select a.id,e.hoten,a.mabn,to_char(a.ngay,'yyyymmdd')||to_char(a.ngayud,'hhmmss') as ngaygio,e.phai as gioitinh,to_number(to_char(a.ngay,'yyyy'),9999) as tuoi1, e.namsinh as tuoi, a.mabs,'' as chandoan,a.makp,a.mavp as id_giavp,b.ma as mavp, c.ten, a.soluong*a.dongia as sotien,'N' as khan";
				asql+=" from "+user+v_mmyy+".v_chidinh a inner join "+user+".v_giavp b on a.mavp=b.id inner join "+user+".v_loaivp c on b.id_loai=c.id inner join "+user+".btdbn e on a.mabn=e.mabn";
				asql+=" where a.id="+ v_id +" and c.id in ("+aid_loai+")";
				ads = get_data(asql);
				if (ads.Tables[0].Rows.Count <= 0)
				{
					return "0";
				}
				apath = apath + "" + atenfile + ".txt";
				System.IO.StreamWriter sw = new System.IO.StreamWriter(apath, false, System.Text.Encoding.UTF8);
				string astr = "";
				decimal atuoi=1;
				foreach (DataRow r in ads.Tables[0].Rows)
				{
					astr += decimal.Parse(r["id"].ToString()).ToString() + afield;
					astr += r["hoten"].ToString().Trim() + afield;
					astr += r["mabn"].ToString() + afield;
					astr += r["ngaygio"].ToString() + afield;
					astr += (r["gioitinh"].ToString().Trim() == "1" ? "0" : "1") + afield;
					try
					{
						atuoi = decimal.Parse(r["tuoi1"].ToString().Trim()) - decimal.Parse(r["tuoi"].ToString().Trim());
					}
					catch
					{
						atuoi = 1;
					}
					astr += atuoi.ToString() + afield;
					astr += r["mabs"].ToString() + afield;
					astr += r["chandoan"].ToString() + afield;
					astr += r["makp"].ToString() + afield;
					astr += r["mavp"].ToString() + afield;
					astr += decimal.Parse(r["sotien"].ToString()).ToString("###") + afield;
					astr += r["khan"].ToString() + afield;
					astr += v_tra + afield;
					astr += r["ten"].ToString();
					astr += arecord;
				}
				if (adatatag.Trim() != "")
				{
					adatatag1 = adatatag.Substring(0, 1) + "/" + adatatag.Substring(1);
					astr = adatatag + astr + adatatag1;
				}
				sw.Write(astr);
				sw.Close();
				return "1";
			}
			catch
			{
				return "0";
			}
		}

		public int getRandom()
		{
			System.Threading.Thread.Sleep(10);
			Random r = new Random();
			return r.Next(999);
		}

		public string getyymmddhhmisslocalhost()
		{
			return DateTime.Now.Year.ToString().PadLeft(4,'0').Substring(2,2)+DateTime.Now.Month.ToString().PadLeft(2,'0')+DateTime.Now.Day.ToString().PadLeft(2,'0')+DateTime.Now.Hour.ToString().PadLeft(2,'0')+DateTime.Now.Minute.ToString().PadLeft(2,'0')+DateTime.Now.Second.ToString().PadLeft(2,'0');
		}

		public string getyymmddhhmiss()
		{
			return get_data("select to_char(sysdate,'yyMMddHH24miss') from dual").Tables[0].Rows[0][0].ToString();
		}

		public long getidyymmddhhmiss_stt_computer
		{
			get
			{
				return long.Parse(getyymmddhhmiss()+getRandom().ToString().PadLeft(3,'0')+iRownum.ToString().PadLeft(3,'0'));
			}
		}

		public long getidyymmddhhmiss_stt_computer_localhost
		{
			get
			{
				return long.Parse(getyymmddhhmisslocalhost()+getRandom().ToString().PadLeft(3,'0')+iRownum.ToString().PadLeft(3,'0'));
			}
		}

		public decimal getidyymmddhhmiss_stt_computer_localhost_mabv
		{
			get
			{
				return decimal.Parse(getyymmddhhmisslocalhost()+getRandom().ToString().PadLeft(3,'0')+iRownum.ToString().PadLeft(3,'0')+Mabv_so.ToString().PadLeft(6,'0'));
			}
		}

		public string get_maso(long maql,string tu,string den)
		{
			string ret="";
			DateTime dt1=StringToDate(tu);
			DateTime dt2=StringToDate(den);
			int y1=dt1.Year,m1=dt1.Month;
			int y2=dt2.Year,m2=dt2.Month;
			int itu,iden;
			string mmyy="";
			for(int i=y1;i<=y2;i++)
			{
				itu=(i==y1)?m1:1;
				iden=(i==y2)?m2:12;
				for(int j=itu;j<=iden;j++)
				{
					mmyy=j.ToString().PadLeft(2,'0')+i.ToString().Substring(2,2);
					if (bMmyy(mmyy))
					{
						sql="select maql from "+user+mmyy+".benhandt where mangtr="+maql;
						sql+=" and to_date(ngay,'dd/mm/yy') between to_date('"+tu.Substring(0,10)+"','dd/mm/yy') and to_date('"+den.Substring(0,10)+"','dd/mm/yy')";
						foreach(DataRow r in get_data(sql).Tables[0].Rows)
							ret+=r["maql"].ToString().Trim()+",";
					}
				}  
			}
			return ret;
		}

		public bool get_thvp_done(string mabn,string maso,string tu,string den)
		{
			sql="select a.done from xxx.v_thvpll a,"+user+".btdkp_bv b where a.makp=b.makp";
			sql+=" and a.mabn='"+mabn+"'";
			if (maso!="") sql+=" and a.maql in ("+maso.Substring(0,maso.Length-1)+")";
			sql+=" and a.done=1";
			return get_data_mmyy(sql,tu,den,true).Tables[0].Rows.Count>0;
		}
		public string get_maso_khambenh(long maql,string ngay, string mabn,int loaiba)
		{
			string maso=maql.ToString().Trim()+",";
			bool bFound=false;
			DataSet lds=new DataSet();
			string s_mabn=mabn;
			//			try
			//			{
			//				s_mabn=get_data("select distinct mabn from hiendien where maql="+maql).Tables[0].Rows[0]["mabn"].ToString();
			//			}
			//			catch{}
			if(bMmyy(mmyy(ngay)))
			{
				sql="select distinct mavaovien from "+user+mmyy(ngay)+".benhandt where maql="+maql;
				lds=get_data(sql);
				if(lds!=null) {lds.Merge(get_data("select distinct maql as mavaovien from "+user+mmyy(ngay)+".benhandt where mabn='"+s_mabn+"'"));}
				if(lds!=null && loaiba==2) {lds.Merge(get_data("select distinct maql as mavaovien from benhandt where mabn='"+s_mabn+"' and loaiba=2"));}
				else {lds.Merge(get_data("select distinct maql as mavaovien from benhandt where mabn='"+s_mabn+"'"));}
			}
			else
			{
				sql="select distinct mavaovien from xxx.benhandt where maql="+maql;
				lds=get_data_mmyy (sql,ngay,Ngayhienhanh.Substring(0,10),true);
			}
			if(lds!=null && lds.Tables.Count>0)
			{
				foreach(DataRow r in lds.Tables[0].Rows)
				{
					if (maso.IndexOf(r["mavaovien"].ToString().Trim()+",")==-1) maso+=r["mavaovien"].ToString().Trim()+",";
					if (long.Parse(r["mavaovien"].ToString())>0)
					{
						foreach(DataRow r1 in get_data_mmyy("select distinct maql from xxx.benhandt where mavaovien="+long.Parse(r["mavaovien"].ToString()),ngay,ngay,Taikham_songay).Tables[0].Rows)
							if (maso.IndexOf(r1["maql"].ToString().Trim()+",")==-1) maso+=r1["maql"].ToString().Trim()+",";

						foreach(DataRow r1 in get_data_mmyy("select distinct maql from xxx.tiepdon where mavaovien="+long.Parse(r["mavaovien"].ToString()),ngay,ngay,Taikham_songay).Tables[0].Rows)
							if (maso.IndexOf(r1["maql"].ToString().Trim()+",")==-1) maso+=r1["maql"].ToString().Trim()+",";
					}
					bFound=true;
				}
			}
			if (!bFound)
			{
				string s="";
				foreach(DataRow r in get_data("select distinct matiepdon from sukien where matiepdon>0 and macap="+maql).Tables[0].Rows)
					s+=r["matiepdon"].ToString()+",";
				if (s!="")
				{
					if(bMmyy(mmyy(ngay)))
					{
						foreach(DataRow r1 in get_data_mmyy("select distinct maql from xxx.benhandt where mavaovien in ("+s.Substring(0,s.Length-1)+")",ngay,ngay,Taikham_songay).Tables[0].Rows)
							if (maso.IndexOf(r1["maql"].ToString().Trim()+",")==-1) maso+=r1["maql"].ToString().Trim()+",";

						foreach(DataRow r1 in get_data_mmyy("select distinct maql from xxx.tiepdon where mavaovien in("+s.Trim().Trim(',')+")",ngay,ngay,Taikham_songay).Tables[0].Rows)
							if (maso.IndexOf(r1["maql"].ToString().Trim()+",")==-1) maso+=r1["maql"].ToString().Trim()+",";
					}
				}
			}
			return maso;
		}

		public string get_maso_khambenh(long maql,string ngay, string mabn)
		{
			string maso=maql.ToString().Trim()+",";
			bool bFound=false;
			DataSet lds=new DataSet();
			string s_mabn=mabn;
			//			try
			//			{
			//				s_mabn=get_data("select distinct mabn from hiendien where maql="+maql).Tables[0].Rows[0]["mabn"].ToString();
			//			}
			//			catch{}
			if(bMmyy(mmyy(ngay)))
			{
				sql="select distinct mavaovien from "+user+mmyy(ngay)+".benhandt where maql="+maql;
				lds=get_data(sql);
				if(lds!=null) {lds.Merge(get_data("select distinct maql as mavaovien from "+user+mmyy(ngay)+".benhandt where mabn='"+s_mabn+"'"));}
				if(lds!=null) {lds.Merge(get_data("select distinct maql as mavaovien from benhandt where mabn='"+s_mabn+"'"));}
			}
			else
			{
				sql="select distinct mavaovien from xxx.benhandt where maql="+maql;
				lds=get_data_mmyy (sql,ngay,Ngayhienhanh.Substring(0,10),true);
			}
			if(lds!=null && lds.Tables.Count>0)
			{
				foreach(DataRow r in lds.Tables[0].Rows)
				{
					if (maso.IndexOf(r["mavaovien"].ToString().Trim()+",")==-1) maso+=r["mavaovien"].ToString().Trim()+",";
					if (long.Parse(r["mavaovien"].ToString())>0)
					{
						foreach(DataRow r1 in get_data_mmyy("select distinct maql from xxx.benhandt where mavaovien="+long.Parse(r["mavaovien"].ToString()),ngay,ngay,Taikham_songay).Tables[0].Rows)
							if (maso.IndexOf(r1["maql"].ToString().Trim()+",")==-1) maso+=r1["maql"].ToString().Trim()+",";

						foreach(DataRow r1 in get_data_mmyy("select distinct maql from xxx.tiepdon where mavaovien="+long.Parse(r["mavaovien"].ToString()),ngay,ngay,Taikham_songay).Tables[0].Rows)
							if (maso.IndexOf(r1["maql"].ToString().Trim()+",")==-1) maso+=r1["maql"].ToString().Trim()+",";
					}
					bFound=true;
				}
			}
			if (!bFound)
			{
				string s="";
				foreach(DataRow r in get_data("select distinct matiepdon from sukien where matiepdon>0 and macap="+maql).Tables[0].Rows)
					s+=r["matiepdon"].ToString()+",";
				if (s!="")
				{
					if(bMmyy(mmyy(ngay)))
					{
						foreach(DataRow r1 in get_data_mmyy("select distinct maql from xxx.benhandt where mavaovien in ("+s.Substring(0,s.Length-1)+")",ngay,ngay,Taikham_songay).Tables[0].Rows)
							if (maso.IndexOf(r1["maql"].ToString().Trim()+",")==-1) maso+=r1["maql"].ToString().Trim()+",";

						foreach(DataRow r1 in get_data_mmyy("select distinct maql from xxx.tiepdon where mavaovien in("+s.Trim().Trim(',')+")",ngay,ngay,Taikham_songay).Tables[0].Rows)
							if (maso.IndexOf(r1["maql"].ToString().Trim()+",")==-1) maso+=r1["maql"].ToString().Trim()+",";
					}
				}
			}
			return maso;
		}

		public string get_maso_khambenh(long maql,string ngay)
		{
			string maso=maql.ToString().Trim()+",";
			bool bFound=false;
			DataSet lds=new DataSet();
			string s_mabn="";
			try
			{
				s_mabn=get_data("select distinct mabn from hiendien where maql="+maql).Tables[0].Rows[0]["mabn"].ToString();
			}
			catch{}
			if(bMmyy(mmyy(ngay)))
			{
				sql="select distinct mavaovien from "+user+mmyy(ngay)+".benhandt where maql="+maql;
				lds=get_data(sql);
				if(lds!=null) lds.Merge(get_data("select distinct maql as mavaovien from "+user+mmyy(ngay)+".benhandt where mabn='"+s_mabn+"'"));
			}
			else
			{
				sql="select distinct mavaovien from xxx.benhandt where maql="+maql;
				lds=get_data_mmyy (sql,ngay,Ngayhienhanh.Substring(0,10),true);
			}
			if(lds!=null && lds.Tables.Count>0)
			{
				foreach(DataRow r in lds.Tables[0].Rows)
				{
					if (maso.IndexOf(r["mavaovien"].ToString().Trim()+",")==-1) maso+=r["mavaovien"].ToString().Trim()+",";
					if (long.Parse(r["mavaovien"].ToString())>0)
					{
						foreach(DataRow r1 in get_data_mmyy("select distinct maql from xxx.benhandt where mavaovien="+long.Parse(r["mavaovien"].ToString()),ngay,ngay,Taikham_songay).Tables[0].Rows)
							if (maso.IndexOf(r1["maql"].ToString().Trim()+",")==-1) maso+=r1["maql"].ToString().Trim()+",";

						foreach(DataRow r1 in get_data_mmyy("select distinct maql from xxx.tiepdon where mavaovien="+long.Parse(r["mavaovien"].ToString()),ngay,ngay,Taikham_songay).Tables[0].Rows)
							if (maso.IndexOf(r1["maql"].ToString().Trim()+",")==-1) maso+=r1["maql"].ToString().Trim()+",";
					}
					bFound=true;
				}
			}
			if (!bFound)
			{
				string s="";
				foreach(DataRow r in get_data("select distinct matiepdon from sukien where matiepdon>0 and macap="+maql).Tables[0].Rows)
					s+=r["matiepdon"].ToString()+",";
				if (s!="")
				{
					if(bMmyy(mmyy(ngay)))
					{
						foreach(DataRow r1 in get_data_mmyy("select distinct maql from xxx.benhandt where mavaovien in ("+s.Substring(0,s.Length-1)+")",ngay,ngay,Taikham_songay).Tables[0].Rows)
							if (maso.IndexOf(r1["maql"].ToString().Trim()+",")==-1) maso+=r1["maql"].ToString().Trim()+",";

						foreach(DataRow r1 in get_data_mmyy("select distinct maql from xxx.tiepdon where mavaovien in("+s.Trim().Trim(',')+")",ngay,ngay,Taikham_songay).Tables[0].Rows)
							if (maso.IndexOf(r1["maql"].ToString().Trim()+",")==-1) maso+=r1["maql"].ToString().Trim()+",";
					}
				}
			}
			return maso;
		}

		public string get_maso_pl_kb(string maql,string ngay)
		{
			string s="",maso="";
			foreach(DataRow r in get_data("select distinct matiepdon from sukien where matiepdon>0 and macap in ("+maql.Substring(0,maql.Length-1)+")").Tables[0].Rows)
			{
				s+=r["matiepdon"].ToString()+",";
				
			}
			if (s!="")
			{
				foreach(DataRow r1 in get_data_mmyy("select distinct maql from xxx.benhandt where mavaovien in ("+s.Substring(0,s.Length-1)+")",ngay,ngay,Taikham_songay).Tables[0].Rows)
					if (maso.IndexOf(r1["maql"].ToString().Trim()+",")==-1) maso+=r1["maql"].ToString().Trim()+",";

				foreach(DataRow r1 in get_data_mmyy("select distinct macap as maql from sukien where noitiepdon=3 and matiepdon in ("+s.Substring(0,s.Length-1)+")",ngay,ngay,Taikham_songay).Tables[0].Rows)
					if (maso.IndexOf(r1["maql"].ToString().Trim()+",")==-1) maso+=r1["maql"].ToString().Trim()+",";
				
			}
			return maso;
		}
		
		public string get_maso_phongluu(string maql,string ngay)
		{
			string s="",maso="";
			foreach(DataRow r in get_data("select distinct matiepdon from sukien where matiepdon>0 and macap in ("+maql.Substring(0,maql.Length-1)+")").Tables[0].Rows)
			{
				s+=r["matiepdon"].ToString()+",";
				
			}
			if (s!="")
			{		
				try
				{
					foreach(DataRow r1 in get_data_mmyy("select distinct macap as maql from sukien where noitiepdon=3 and matiepdon in ("+s.Substring(0,s.Length-1)+")",ngay,ngay,Taikham_songay).Tables[0].Rows)
						if (maso.IndexOf(r1["maql"].ToString().Trim()+",")==-1) maso+=r1["maql"].ToString().Trim()+",";
				}
				catch{}
				
			}
			return maso;
		}
		public string Khoacdkham(string mabn,long maql,string tu,string den)
		{
			string maso="";
			long mm_mavaovien=0;
			mm_mavaovien=get_mavaovien(maql,mmyy(tu.Substring(0,10)));
			if (get_data("select * from khoacdkham where mabn='"+mabn+"' and to_date(ngay,'dd/mm/yy') between to_date('"+tu+"','dd/mm/yy') and to_date('"+den+"','dd/mm/yy')").Tables[0].Rows.Count>0)
			{
				foreach(DataRow r in get_data_mmyy("select maql from xxx.benhandt where mavaovien="+mm_mavaovien,tu,den,false).Tables[0].Rows)
					maso+=r["maql"].ToString().Trim()+",";
			}
			return maso;
		}

		public string get_maso_maql(long maql,string ngay,int noitiepdon)
		{
			string maso="";
			long mavaovien=0;int _noitiepdon=0;
			sql="select * from sukien where matiepdon>0 and macap="+maql;
			sql+=" order by noitiepdon";
			foreach(DataRow row in get_data(sql).Tables[0].Rows)
			{
				mavaovien=long.Parse(row["matiepdon"].ToString());
				maso+=mavaovien.ToString().Trim()+",";
				_noitiepdon=int.Parse(row["noitiepdon"].ToString());
				if (noitiepdon==0) break;
			}
			if (noitiepdon==0)
			{
				DataSet lds=new DataSet();
				if(bMmyy(mmyy(ngay)))
				{
					sql="select distinct maql from "+user+mmyy(ngay)+".benhandt where mavaovien="+mavaovien;
					lds=get_data(sql);
				}
				else 
				{
					sql="select distinct maql from xxx.benhandt where mavaovien="+mavaovien;
					lds=get_data_mmyy (sql,ngay,Ngayhienhanh.Substring(0,10),true);
				}
				if(lds!=null && lds.Tables.Count>0)
				{
					foreach(DataRow r1 in lds.Tables[0].Rows)
						if (maso.IndexOf(r1["maql"].ToString().Trim()+",")==-1) maso+=r1["maql"].ToString().Trim()+",";
				}
			}
			else if (_noitiepdon==4)
			{
				sql="select * from sukien where matiepdon>0 and macap="+mavaovien;
				foreach(DataRow row in get_data(sql).Tables[0].Rows)
					maso+=row["matiepdon"].ToString().Trim()+",";
				maso+=get_maso_khambenh(mavaovien,ngay);
			}
			return maso;
		}

		public string get_maso_ngoai_noi(long maql)
		{
			string maso="";
			sql="select distinct matiepdon from sukien where matiepdon>0 and macap="+maql+" and noitiepdon=4";
			foreach(DataRow r in get_data(sql).Tables[0].Rows)
			{
				sql="select distinct macap from sukien where matiepdon="+long.Parse(r["matiepdon"].ToString())+" and noitiepdon=2";
				foreach(DataRow r1 in get_data(sql).Tables[0].Rows)
					if (maso.IndexOf(r1["macap"].ToString().Trim()+",")==-1) maso+=r1["macap"].ToString().Trim()+",";
			}
			return maso;
		}

		public bool upd_ba_locmauct(string m_ngayvv,long m_id,int m_stt,string m_ngay,decimal m_mach,string m_huyetap,
			decimal m_nhietdo,decimal m_nhiptho,decimal m_tocdo,string m_dm,string m_tm,decimal m_sieuloc,string m_taibien,
			string m_thuoc,string m_mabs,string m_yta)
		{
			string xxx = user + mmyy(m_ngayvv);
			sql="update "+xxx+".ba_locmauct set ngay=to_date(:m_ngay,'dd/mm/yyyy hh24:mi'),";
			sql+="mach=:m_mach,huyetap=:m_huyetap,nhietdo=:m_nhietdo,nhiptho=:m_nhiptho,tocdo=:m_tocdo,";
			sql+="dm=:m_dm,tm=:m_tm,sieuloc=:m_sieuloc,taibien=:m_taibien,thuoc=:m_thuoc,mabs=:m_mabs,yta=:m_yta ";
			sql+="where id=:m_id and stt=:m_stt";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("m_ngay",OracleType.VarChar,16).Value=m_ngay;
				cmd.Parameters.Add("m_mach",OracleType.Number).Value=m_mach;
				cmd.Parameters.Add("m_huyetap",OracleType.VarChar,7).Value=m_huyetap;
				cmd.Parameters.Add("m_nhietdo",OracleType.Number).Value=m_nhietdo;
				cmd.Parameters.Add("m_nhiptho",OracleType.Number).Value=m_nhiptho;
				cmd.Parameters.Add("m_tocdo",OracleType.Number).Value=m_tocdo;
				cmd.Parameters.Add("m_dm",OracleType.NVarChar,20).Value=m_dm;
				cmd.Parameters.Add("m_tm",OracleType.NVarChar,20).Value=m_tm;
				cmd.Parameters.Add("m_sieuloc",OracleType.Number).Value=m_sieuloc;
				cmd.Parameters.Add("m_taibien",OracleType.NVarChar,500).Value=m_taibien;
				cmd.Parameters.Add("m_thuoc",OracleType.NVarChar,1000).Value=m_thuoc;
				cmd.Parameters.Add("m_mabs",OracleType.VarChar,4).Value=m_mabs;
				cmd.Parameters.Add("m_yta",OracleType.VarChar,4).Value=m_yta;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
				
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_locmauct (id,stt,ngay,mach,huyetap,nhietdo,nhiptho,tocdo,dm,tm,sieuloc,taibien,thuoc,mabs,yta) ";
					sql+="values (:m_id,:m_stt,to_date(:m_ngay,'dd/mm/yyyy hh24:mi'),:m_mach,:m_huyetap,:m_nhietdo,:m_nhiptho,:m_tocdo,:m_dm,:m_tm,:m_sieuloc,:m_taibien,:m_thuoc,:m_mabs,:m_yta)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;

					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
					cmd.Parameters.Add("m_ngay",OracleType.VarChar,16).Value=m_ngay;
					cmd.Parameters.Add("m_mach",OracleType.Number).Value=m_mach;
					cmd.Parameters.Add("m_huyetap",OracleType.VarChar,7).Value=m_huyetap;
					cmd.Parameters.Add("m_nhietdo",OracleType.Number).Value=m_nhietdo;
					cmd.Parameters.Add("m_nhiptho",OracleType.Number).Value=m_nhiptho;
					cmd.Parameters.Add("m_tocdo",OracleType.Number).Value=m_tocdo;
					cmd.Parameters.Add("m_dm",OracleType.NVarChar,20).Value=m_dm;
					cmd.Parameters.Add("m_tm",OracleType.NVarChar,20).Value=m_tm;
					cmd.Parameters.Add("m_sieuloc",OracleType.Number).Value=m_sieuloc;
					cmd.Parameters.Add("m_taibien",OracleType.NVarChar,500).Value=m_taibien;
					cmd.Parameters.Add("m_thuoc",OracleType.NVarChar,1000).Value=m_thuoc;
					cmd.Parameters.Add("m_mabs",OracleType.VarChar,4).Value=m_mabs;
					cmd.Parameters.Add("m_yta",OracleType.VarChar,4).Value=m_yta;

					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_locmauct");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_ba_locmaull(string m_ngayvv,long m_id,long m_idthuchien,string m_ngaybd,decimal m_cantloc,
			decimal m_rutnuoc,decimal m_dichvamau,decimal m_cansloc,int m_fav,int m_ttmd,int m_mtct,int m_tmdd,
			int m_heparin,int m_tlpt,string m_lieudau,string m_duytri,string m_tonglieu,int m_lientuc,int m_cachquang,
			string m_khac,string m_ngaykt,string m_mangloc,string m_nhanhieu,string m_dientich,string m_heso,
			string m_baoquan,decimal m_landung,string m_mabs,string m_yta,int m_userid)
		{
			string xxx = user + mmyy(m_ngayvv);
			sql="update "+xxx+".ba_locmaull set idthuchien=:m_idthuchien,ngaybd=to_date(:m_ngaybd,'dd/mm/yyyy hh24:mi'),";
			sql+="cantloc=:m_cantloc,rutnuoc=:m_rutnuoc,dichvamau=:m_dichvamau,cansloc=:m_cansloc,fav=:m_fav,ttmd=:m_ttmd,";
			sql+="mtct=:m_mtct,tmdd=:m_tmdd,heparin=:m_heparin,tlpt=:m_tlpt,lieudau=:m_lieudau,duytri=:m_duytri,";
			sql+="tonglieu=:m_tonglieu,lientuc=:m_lientuc,cachquang=:m_cachquang,khac=:m_khac,";
			if (m_ngaykt.Trim()!="") sql+="ngaykt=to_date(:m_ngaykt,'dd/mm/yyyy hh24:mi'),";
			sql+="mangloc=:m_mangloc,nhanhieu=:m_nhanhieu,dientich=:m_dientich,heso=:m_heso,baoquan=:m_baoquan,";
			sql+="landung=:m_landung,mabs=:m_mabs,yta=:m_yta,userid=:m_userid where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_idthuchien",OracleType.Number).Value=m_idthuchien;
				cmd.Parameters.Add("m_ngaybd",OracleType.VarChar,16).Value=m_ngaybd;
				cmd.Parameters.Add("m_cantloc",OracleType.Number).Value=m_cantloc;
				cmd.Parameters.Add("m_rutnuoc",OracleType.Number).Value=m_rutnuoc;
				cmd.Parameters.Add("m_dichvamau",OracleType.Number).Value=m_dichvamau;
				cmd.Parameters.Add("m_cansloc",OracleType.Number).Value=m_cansloc;
				cmd.Parameters.Add("m_fav",OracleType.Number).Value=m_fav;
				cmd.Parameters.Add("m_ttmd",OracleType.Number).Value=m_ttmd;
				cmd.Parameters.Add("m_mtct",OracleType.Number).Value=m_mtct;
				cmd.Parameters.Add("m_tmdd",OracleType.Number).Value=m_tmdd;
				cmd.Parameters.Add("m_heparin",OracleType.Number).Value=m_heparin;
				cmd.Parameters.Add("m_tlpt",OracleType.Number).Value=m_tlpt;
				cmd.Parameters.Add("m_lieudau",OracleType.NVarChar,20).Value=m_lieudau;
				cmd.Parameters.Add("m_duytri",OracleType.NVarChar,20).Value=m_duytri;
				cmd.Parameters.Add("m_tonglieu",OracleType.NVarChar,20).Value=m_tonglieu;
				cmd.Parameters.Add("m_lientuc",OracleType.Number).Value=m_lientuc;
				cmd.Parameters.Add("m_cachquang",OracleType.Number).Value=m_cachquang;
				cmd.Parameters.Add("m_khac",OracleType.NVarChar,100).Value=m_khac;
				if (m_ngaykt.Trim()!="") cmd.Parameters.Add("m_ngaykt",OracleType.VarChar,16).Value=m_ngaykt.Trim();
				cmd.Parameters.Add("m_mangloc",OracleType.NVarChar,50).Value=m_mangloc;
				cmd.Parameters.Add("m_nhanhieu",OracleType.NVarChar,50).Value=m_nhanhieu;
				cmd.Parameters.Add("m_dientich",OracleType.NVarChar,50).Value=m_dientich;
				cmd.Parameters.Add("m_heso",OracleType.NVarChar,50).Value=m_heso;
				cmd.Parameters.Add("m_baoquan",OracleType.NVarChar,50).Value=m_baoquan;
				cmd.Parameters.Add("m_landung",OracleType.Number).Value=m_landung;
				cmd.Parameters.Add("m_mabs",OracleType.VarChar,4).Value=m_mabs;
				cmd.Parameters.Add("m_yta",OracleType.VarChar,4).Value=m_yta;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;				
				
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".ba_locmaull (id,idthuchien,ngaybd,cantloc,rutnuoc,dichvamau,cansloc,fav,ttmd,mtct,tmdd,heparin,tlpt,lieudau,duytri,tonglieu,lientuc,cachquang,khac,";
					if (m_ngaykt.Trim()!="") sql+="ngaykt,";
					sql+="mangloc,nhanhieu,dientich,heso,baoquan,landung,mabs,yta,userid) ";
					sql+="values (:m_id,:m_idthuchien,to_date(:m_ngaybd,'dd/mm/yyyy hh24:mi'),:m_cantloc,:m_rutnuoc,:m_dichvamau,:m_cansloc,:m_fav,:m_ttmd,:m_mtct,:m_tmdd,:m_heparin,:m_tlpt,:m_lieudau,:m_duytri,:m_tonglieu,:m_lientuc,:m_cachquang,:m_khac,";
					if (m_ngaykt.Trim()!="") sql+="to_date(:m_ngaykt,'dd/mm/yyyy hh24:mi'),";
					sql+=":m_mangloc,:m_nhanhieu,:m_dientich,:m_heso,:m_baoquan,:m_landung,:m_mabs,:m_yta,:m_userid) ";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;

					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_idthuchien",OracleType.Number).Value=m_idthuchien;
					cmd.Parameters.Add("m_ngaybd",OracleType.VarChar,16).Value=m_ngaybd;
					cmd.Parameters.Add("m_cantloc",OracleType.Number).Value=m_cantloc;
					cmd.Parameters.Add("m_rutnuoc",OracleType.Number).Value=m_rutnuoc;
					cmd.Parameters.Add("m_dichvamau",OracleType.Number).Value=m_dichvamau;
					cmd.Parameters.Add("m_cansloc",OracleType.Number).Value=m_cansloc;
					cmd.Parameters.Add("m_fav",OracleType.Number).Value=m_fav;
					cmd.Parameters.Add("m_ttmd",OracleType.Number).Value=m_ttmd;
					cmd.Parameters.Add("m_mtct",OracleType.Number).Value=m_mtct;
					cmd.Parameters.Add("m_tmdd",OracleType.Number).Value=m_tmdd;
					cmd.Parameters.Add("m_heparin",OracleType.Number).Value=m_heparin;
					cmd.Parameters.Add("m_tlpt",OracleType.Number).Value=m_tlpt;
					cmd.Parameters.Add("m_lieudau",OracleType.NVarChar,20).Value=m_lieudau;
					cmd.Parameters.Add("m_duytri",OracleType.NVarChar,20).Value=m_duytri;
					cmd.Parameters.Add("m_tonglieu",OracleType.NVarChar,20).Value=m_tonglieu;
					cmd.Parameters.Add("m_lientuc",OracleType.Number).Value=m_lientuc;
					cmd.Parameters.Add("m_cachquang",OracleType.Number).Value=m_cachquang;
					cmd.Parameters.Add("m_khac",OracleType.NVarChar,100).Value=m_khac;
					if (m_ngaykt.Trim()!="") cmd.Parameters.Add("m_ngaykt",OracleType.VarChar,16).Value=m_ngaykt.Trim();
					cmd.Parameters.Add("m_mangloc",OracleType.NVarChar,50).Value=m_mangloc;
					cmd.Parameters.Add("m_nhanhieu",OracleType.NVarChar,50).Value=m_nhanhieu;
					cmd.Parameters.Add("m_dientich",OracleType.NVarChar,50).Value=m_dientich;
					cmd.Parameters.Add("m_heso",OracleType.NVarChar,50).Value=m_heso;
					cmd.Parameters.Add("m_baoquan",OracleType.NVarChar,50).Value=m_baoquan;
					cmd.Parameters.Add("m_landung",OracleType.Number).Value=m_landung;
					cmd.Parameters.Add("m_mabs",OracleType.VarChar,4).Value=m_mabs;
					cmd.Parameters.Add("m_yta",OracleType.VarChar,4).Value=m_yta;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;

					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"ba_locmaull");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}
		public bool upd_bask_donvi(string ngay,string mabn,long maql,long madonvi,decimal mach,string huyetap,
			decimal cannang,decimal chieucao)
		{
			string xxx = user + mmyy(ngay);
			sql="update "+xxx+".bask_donvi set mabn=:mabn,madonvi=:madonvi,";
			sql+="mach=:mach,huyetap=:huyetap,cannang=:cannang,chieucao=:chieucao ";
			sql+="where maql=:maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("mabn",OracleType.VarChar,8).Value=mabn;
				cmd.Parameters.Add("madonvi",OracleType.Number).Value=madonvi;
				cmd.Parameters.Add("mach",OracleType.Number).Value=mach;
				cmd.Parameters.Add("huyetap",OracleType.VarChar,7).Value=huyetap;
				cmd.Parameters.Add("cannang",OracleType.Number).Value=cannang;
				cmd.Parameters.Add("chieucao",OracleType.Number).Value=chieucao;
				cmd.Parameters.Add("maql",OracleType.Number).Value=maql;
				
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".bask_donvi (mabn,maql,madonvi,mach,huyetap,cannang,chieucao) ";
					sql+="values (:mabn,:maql,:madonvi,:mach,:huyetap,:cannang,:chieucao)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;

					cmd.Parameters.Add("mabn",OracleType.VarChar,8).Value=mabn;
					cmd.Parameters.Add("maql",OracleType.Number).Value=maql;
					cmd.Parameters.Add("madonvi",OracleType.Number).Value=madonvi;
					cmd.Parameters.Add("mach",OracleType.Number).Value=mach;
					cmd.Parameters.Add("huyetap",OracleType.VarChar,7).Value=huyetap;
					cmd.Parameters.Add("cannang",OracleType.Number).Value=cannang;
					cmd.Parameters.Add("chieucao",OracleType.Number).Value=chieucao;					

					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"bask_donvi");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_bask_chiso(string mabn,long maql,string ngay,string mantinh,string namvien,string pttt,
			string chanthuong,string para,int docthan,string kinhnguyet,string sankhoa,string phukhoa,int ruou,
			int thuocla,int diung,string tendiung,int viemgana,int viemganb,string khac,int soi,int viemnao,int lao,
			int uonvan,int bachhau,int cum,int userid)
		{
			string xxx = user + mmyy(ngay);
			sql="update "+xxx+".bask_chiso set mabn=:mabn,ngay=to_date(:ngay,'dd/mm/yyyy hh24:mi'),mantinh=:mantinh,";
			sql+="namvien=:namvien,pttt=:pttt,chanthuong=:chanthuong,para=:para,docthan=:docthan,kinhnguyet=:kinhnguyet,";
			sql+="sankhoa=:sankhoa,phukhoa=:phukhoa,ruou=:ruou,thuocla=:thuocla,diung=:diung,tendiung=:tendiung,";
			sql+="viemgana=:viemgana,viemganb=:viemganb,khac=:khac,soi=:soi,viemnao=:viemnao,lao=:lao,";
			sql+="uonvan=:uonvan,bachhau=:bachhau,cum=:cum,userid=:userid ";
			sql+="where maql=:maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("mabn",OracleType.VarChar,8).Value=mabn;
				cmd.Parameters.Add("ngay",OracleType.VarChar,16).Value=ngay;
				cmd.Parameters.Add("mantinh",OracleType.NVarChar,1000).Value=mantinh;
				cmd.Parameters.Add("namvien",OracleType.NVarChar,1000).Value=namvien;
				cmd.Parameters.Add("pttt",OracleType.NVarChar,1000).Value=pttt;
				cmd.Parameters.Add("chanthuong",OracleType.NVarChar,1000).Value=chanthuong;
				cmd.Parameters.Add("para",OracleType.VarChar,8).Value=para;
				cmd.Parameters.Add("docthan",OracleType.Number).Value=docthan;
				cmd.Parameters.Add("kinhnguyet",OracleType.NVarChar,1000).Value=kinhnguyet;
				cmd.Parameters.Add("phukhoa",OracleType.NVarChar,1000).Value=phukhoa;
				cmd.Parameters.Add("ruou",OracleType.Number).Value=ruou;
				cmd.Parameters.Add("thuocla",OracleType.Number).Value=thuocla;
				cmd.Parameters.Add("diung",OracleType.Number).Value=diung;
				cmd.Parameters.Add("tendiung",OracleType.NVarChar,254).Value=tendiung;
				cmd.Parameters.Add("viemgana",OracleType.Number).Value=viemgana;
				cmd.Parameters.Add("viemganb",OracleType.Number).Value=viemganb;
				cmd.Parameters.Add("khac",OracleType.NVarChar,254).Value=khac;
				cmd.Parameters.Add("soi",OracleType.Number).Value=soi;
				cmd.Parameters.Add("viemnao",OracleType.Number).Value=viemnao;
				cmd.Parameters.Add("lao",OracleType.Number).Value=lao;
				cmd.Parameters.Add("uonvan",OracleType.Number).Value=uonvan;
				cmd.Parameters.Add("bachhau",OracleType.Number).Value=bachhau;
				cmd.Parameters.Add("cum",OracleType.Number).Value=cum;
				cmd.Parameters.Add("userid",OracleType.Number).Value=userid;
				cmd.Parameters.Add("maql",OracleType.Number).Value=maql;
				
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".bask_chiso (mabn,maql,ngay,mantinh,namvien,pttt,chanthuong,para,docthan,kinhnguyet,phukhoa,ruou,thuocla,diung,tendiung,viemgana,viemganb,khac,soi,viemnao,lao,uonvan,bachhau,cum,userid) ";
					sql+="values (:mabn,:maql,to_date(:ngay,'dd/mm/yyyy hh24:mi'),:mantinh,:namvien,:pttt,:chanthuong,:para,:docthan,:kinhnguyet,:phukhoa,:ruou,:thuocla,:diung,:tendiung,:viemgana,:viemganb,:khac,:soi,:viemnao,:lao,:uonvan,:bachhau,:cum,:userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;

					cmd.Parameters.Add("mabn",OracleType.VarChar,8).Value=mabn;
					cmd.Parameters.Add("maql",OracleType.Number).Value=maql;
					cmd.Parameters.Add("ngay",OracleType.VarChar,16).Value=ngay;
					cmd.Parameters.Add("mantinh",OracleType.NVarChar,1000).Value=mantinh;
					cmd.Parameters.Add("namvien",OracleType.NVarChar,1000).Value=namvien;
					cmd.Parameters.Add("pttt",OracleType.NVarChar,1000).Value=pttt;
					cmd.Parameters.Add("chanthuong",OracleType.NVarChar,1000).Value=chanthuong;
					cmd.Parameters.Add("para",OracleType.VarChar,8).Value=para;
					cmd.Parameters.Add("docthan",OracleType.Number).Value=docthan;
					cmd.Parameters.Add("kinhnguyet",OracleType.NVarChar,1000).Value=kinhnguyet;
					cmd.Parameters.Add("phukhoa",OracleType.NVarChar,1000).Value=phukhoa;
					cmd.Parameters.Add("ruou",OracleType.Number).Value=ruou;
					cmd.Parameters.Add("thuocla",OracleType.Number).Value=thuocla;
					cmd.Parameters.Add("diung",OracleType.Number).Value=diung;
					cmd.Parameters.Add("tendiung",OracleType.NVarChar,254).Value=tendiung;
					cmd.Parameters.Add("viemgana",OracleType.Number).Value=viemgana;
					cmd.Parameters.Add("viemganb",OracleType.Number).Value=viemganb;
					cmd.Parameters.Add("khac",OracleType.NVarChar,254).Value=khac;
					cmd.Parameters.Add("soi",OracleType.Number).Value=soi;
					cmd.Parameters.Add("viemnao",OracleType.Number).Value=viemnao;
					cmd.Parameters.Add("lao",OracleType.Number).Value=lao;
					cmd.Parameters.Add("uonvan",OracleType.Number).Value=uonvan;
					cmd.Parameters.Add("bachhau",OracleType.Number).Value=bachhau;
					cmd.Parameters.Add("cum",OracleType.Number).Value=cum;
					cmd.Parameters.Add("userid",OracleType.Number).Value=userid;

					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"bask_chiso");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_bask_noikhoa(string ngay,long mavaovien,string makp,string timmach,string hohap,string tieuhoa,
			string than,string thankinh,string khac,string mabs,int userid)
		{
			string xxx = user + mmyy(ngay);
			sql="update "+xxx+".bask_noikhoa set ngay=to_date(:ngay,'dd/mm/yyyy hh24:mi'),makp=:makp,timmach=:timmach,hohap=:hohap,";
			sql+="tieuhoa=:tieuhoa,than=:than,thankinh=:thankinh,khac=:khac,mabs=:mabs,userid=:userid ";
			sql+="where mavaovien=:mavaovien";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("ngay",OracleType.VarChar,16).Value=ngay;
				cmd.Parameters.Add("makp",OracleType.VarChar,2).Value=makp;
				cmd.Parameters.Add("timmach",OracleType.NVarChar,1000).Value=timmach;
				cmd.Parameters.Add("hohap",OracleType.NVarChar,1000).Value=hohap;
				cmd.Parameters.Add("tieuhoa",OracleType.NVarChar,1000).Value=tieuhoa;
				cmd.Parameters.Add("than",OracleType.NVarChar,1000).Value=than;
				cmd.Parameters.Add("thankinh",OracleType.NVarChar,1000).Value=thankinh;
				cmd.Parameters.Add("khac",OracleType.NVarChar,1000).Value=khac;
				cmd.Parameters.Add("mabs",OracleType.VarChar,4).Value=mabs;
				cmd.Parameters.Add("userid",OracleType.Number).Value=userid;
				cmd.Parameters.Add("mavaovien",OracleType.Number).Value=mavaovien;
				
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".bask_noikhoa (mavaovien,maql,ngay,makp,timmach,hohap,tieuhoa,than,thankinh,khac,mabs,userid) ";
					sql+="values (:mavaovien,:mavaovien,to_date(:ngay,'dd/mm/yyyy hh24:mi'),:makp,:timmach,:hohap,:tieuhoa,:than,:thankinh,:khac,:mabs,:userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;

					cmd.Parameters.Add("mavaovien",OracleType.Number).Value=mavaovien;
					cmd.Parameters.Add("mavaovien",OracleType.Number).Value=mavaovien;
					cmd.Parameters.Add("ngay",OracleType.VarChar,16).Value=ngay;
					cmd.Parameters.Add("makp",OracleType.VarChar,2).Value=makp;
					cmd.Parameters.Add("timmach",OracleType.NVarChar,1000).Value=timmach;
					cmd.Parameters.Add("hohap",OracleType.NVarChar,1000).Value=hohap;
					cmd.Parameters.Add("tieuhoa",OracleType.NVarChar,1000).Value=tieuhoa;
					cmd.Parameters.Add("than",OracleType.NVarChar,1000).Value=than;
					cmd.Parameters.Add("thankinh",OracleType.NVarChar,1000).Value=thankinh;
					cmd.Parameters.Add("khac",OracleType.NVarChar,1000).Value=khac;
					cmd.Parameters.Add("mabs",OracleType.VarChar,4).Value=mabs;
					cmd.Parameters.Add("userid",OracleType.Number).Value=userid;

					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"bask_noikhoa");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}
		public bool upd_bask_ngkhoa(string ngay,long mavaovien,string makp,string tongquat,string chanthuong,
			string dalieu,string khac,string mabs,int userid)
		{
			string xxx = user + mmyy(ngay);
			sql="update "+xxx+".bask_ngkhoa set ngay=to_date(:ngay,'dd/mm/yyyy hh24:mi'),makp=:makp,tongquat=:tongquat,chanthuong=:chanthuong,";
			sql+="dalieu=:dalieu,khac=:khac,mabs=:mabs,userid=:userid ";
			sql+="where mavaovien=:mavaovien";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("ngay",OracleType.VarChar,16).Value=ngay;
				cmd.Parameters.Add("makp",OracleType.VarChar,2).Value=makp;
				cmd.Parameters.Add("tongquat",OracleType.NVarChar,1000).Value=tongquat;
				cmd.Parameters.Add("chanthuong",OracleType.NVarChar,1000).Value=chanthuong;
				cmd.Parameters.Add("dalieu",OracleType.NVarChar,1000).Value=dalieu;
				cmd.Parameters.Add("khac",OracleType.NVarChar,1000).Value=khac;
				cmd.Parameters.Add("mabs",OracleType.VarChar,4).Value=mabs;
				cmd.Parameters.Add("userid",OracleType.Number).Value=userid;
				cmd.Parameters.Add("mavaovien",OracleType.Number).Value=mavaovien;
				
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".bask_ngkhoa (mavaovien,maql,ngay,makp,tongquat,chanthuong,dalieu,khac,mabs,userid) ";
					sql+="values (:mavaovien,:mavaovien,to_date(:ngay,'dd/mm/yyyy hh24:mi'),:makp,:tongquat,:chanthuong,:dalieu,:khac,:mabs,:userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;

					cmd.Parameters.Add("mavaovien",OracleType.Number).Value=mavaovien;
					cmd.Parameters.Add("mavaovien",OracleType.Number).Value=mavaovien;
					cmd.Parameters.Add("ngay",OracleType.VarChar,16).Value=ngay;
					cmd.Parameters.Add("makp",OracleType.VarChar,2).Value=makp;
					cmd.Parameters.Add("tongquat",OracleType.NVarChar,1000).Value=tongquat;
					cmd.Parameters.Add("chanthuong",OracleType.NVarChar,1000).Value=chanthuong;
					cmd.Parameters.Add("dalieu",OracleType.NVarChar,1000).Value=dalieu;
					cmd.Parameters.Add("khac",OracleType.NVarChar,1000).Value=khac;
					cmd.Parameters.Add("mabs",OracleType.VarChar,4).Value=mabs;
					cmd.Parameters.Add("userid",OracleType.Number).Value=userid;

					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"bask_ngkhoa");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}
		public bool upd_bask_mat(string ngay,long mavaovien,string makp,string tlckp,string tlckt,string tlkkp,string tlkkt,
			string truoc,string sau,string nhanapp,string nhanapt,string khac,string mabs,int userid)
		{
			string xxx = user + mmyy(ngay);
			sql="update "+xxx+".bask_mat set ngay=to_date(:ngay,'dd/mm/yyyy hh24:mi'),makp=:makp,tlcp=:tlckp,tlct=:tlckt,tlkp=:tlkkp,tlkt=:tlkkt,";
			sql+="truoc=:truoc,sau=:sau,nhanapp=:nhanapp,nhanapt=:nhanapt,khac=:khac,mabs=:mabs,userid=:userid ";
			sql+="where mavaovien=:mavaovien";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("ngay",OracleType.VarChar,16).Value=ngay;
				cmd.Parameters.Add("makp",OracleType.VarChar,2).Value=makp;
				cmd.Parameters.Add("tlckp",OracleType.NVarChar,50).Value=tlckp;
				cmd.Parameters.Add("tlckt",OracleType.NVarChar,50).Value=tlckt;
				cmd.Parameters.Add("tlkkp",OracleType.NVarChar,50).Value=tlkkp;
				cmd.Parameters.Add("tlkkt",OracleType.NVarChar,50).Value=tlkkt;
				cmd.Parameters.Add("truoc",OracleType.NVarChar,254).Value=truoc;
				cmd.Parameters.Add("sau",OracleType.NVarChar,254).Value=sau;
				cmd.Parameters.Add("nhanapp",OracleType.NVarChar,254).Value=nhanapp;
				cmd.Parameters.Add("nhanapt",OracleType.NVarChar,254).Value=nhanapt;
				cmd.Parameters.Add("khac",OracleType.NVarChar,1000).Value=khac;
				cmd.Parameters.Add("mabs",OracleType.VarChar,4).Value=mabs;
				cmd.Parameters.Add("userid",OracleType.Number).Value=userid;
				cmd.Parameters.Add("mavaovien",OracleType.Number).Value=mavaovien;
				
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".bask_mat (mavaovien,maql,ngay,makp,tlcp,tlct,tlkp,tlkt,truoc,sau,nhanap,nhanapt,khac,mabs,userid) ";
					sql+="values (:mavaovien,:mavaovien,to_date(:ngay,'dd/mm/yyyy hh24:mi'),:makp,:tlckp,:tlckt,:tlkkp,:tlkkt,:truoc,:sau,:nhanap,:nhanapt,:khac,:mabs,:userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;

					cmd.Parameters.Add("mavaovien",OracleType.Number).Value=mavaovien;
					cmd.Parameters.Add("mavaovien",OracleType.Number).Value=mavaovien;
					cmd.Parameters.Add("ngay",OracleType.VarChar,16).Value=ngay;
					cmd.Parameters.Add("makp",OracleType.VarChar,2).Value=makp;
					cmd.Parameters.Add("tlckp",OracleType.NVarChar,50).Value=tlckp;
					cmd.Parameters.Add("tlckt",OracleType.NVarChar,50).Value=tlckt;
					cmd.Parameters.Add("tlkkp",OracleType.NVarChar,50).Value=tlkkp;
					cmd.Parameters.Add("tlkkt",OracleType.NVarChar,50).Value=tlkkt;
					cmd.Parameters.Add("truoc",OracleType.NVarChar,254).Value=truoc;
					cmd.Parameters.Add("sau",OracleType.NVarChar,254).Value=sau;
					cmd.Parameters.Add("nhanapp",OracleType.NVarChar,254).Value=nhanapp;
					cmd.Parameters.Add("nhanapt",OracleType.NVarChar,254).Value=nhanapt;
					cmd.Parameters.Add("khac",OracleType.NVarChar,1000).Value=khac;
					cmd.Parameters.Add("mabs",OracleType.VarChar,4).Value=mabs;
					cmd.Parameters.Add("userid",OracleType.Number).Value=userid;

					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"bask_mat");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}
		public bool upd_bask_rhm(string ngay,long mavaovien,string makp,byte[] image,string nhanxet,string khac,string mabs,int userid)
		{
			string xxx = user + mmyy(ngay);
			sql="update "+xxx+".bask_rhm set ngay=to_date(:ngay,'dd/mm/yyyy hh24:mi'),makp=:makp,image=:image,nhanxet=:nhanxet,";
			sql+="khac=:khac,mabs=:mabs,userid=:userid ";
			sql+="where mavaovien=:mavaovien";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("ngay",OracleType.VarChar,16).Value=ngay;
				cmd.Parameters.Add("makp",OracleType.VarChar,2).Value=makp;
				cmd.Parameters.Add("image",OracleType.Blob,image.Length).Value=image;
				cmd.Parameters.Add("nhanxet",OracleType.NVarChar,1000).Value=nhanxet;
				cmd.Parameters.Add("khac",OracleType.NVarChar,1000).Value=khac;
				cmd.Parameters.Add("mabs",OracleType.VarChar,4).Value=mabs;
				cmd.Parameters.Add("userid",OracleType.Number).Value=userid;
				cmd.Parameters.Add("mavaovien",OracleType.Number).Value=mavaovien;
				
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".bask_rhm (mavaovien,maql,ngay,makp,image,nhanxet,khac,mabs,userid) ";
					sql+="values (:mavaovien,:mavaovien,to_date(:ngay,'dd/mm/yyyy hh24:mi'),:makp,:image,:nhanxet,:khac,:mabs,:userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;

					cmd.Parameters.Add("mavaovien",OracleType.Number).Value=mavaovien;
					cmd.Parameters.Add("mavaovien",OracleType.Number).Value=mavaovien;
					cmd.Parameters.Add("ngay",OracleType.VarChar,16).Value=ngay;
					cmd.Parameters.Add("makp",OracleType.VarChar,2).Value=makp;
					cmd.Parameters.Add("image",OracleType.Blob,image.Length).Value=image;
					cmd.Parameters.Add("nhanxet",OracleType.NVarChar,1000).Value=nhanxet;
					cmd.Parameters.Add("khac",OracleType.NVarChar,1000).Value=khac;
					cmd.Parameters.Add("mabs",OracleType.VarChar,4).Value=mabs;
					cmd.Parameters.Add("userid",OracleType.Number).Value=userid;

					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"bask_rhm");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_bask_tmh(string ngay,long mavaovien,string makp,string tai,string mui,string hong,string thanhquan,
			string daumatco,string khac,string mabs,int userid)
		{
			string xxx = user + mmyy(ngay);
			sql="update "+xxx+".bask_tmh set ngay=to_date(:ngay,'dd/mm/yyyy hh24:mi'),makp=:makp,tai=:tai,mui=:mui,hong=:hong,thanhquan=:thanhquan,";
			sql+="daumatco=:daumatco,khac=:khac,mabs=:mabs,userid=:userid ";
			sql+="where mavaovien=:mavaovien";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("ngay",OracleType.VarChar,16).Value=ngay;
				cmd.Parameters.Add("makp",OracleType.VarChar,2).Value=makp;
				cmd.Parameters.Add("tai",OracleType.NVarChar,1000).Value=tai;
				cmd.Parameters.Add("mui",OracleType.NVarChar,1000).Value=mui;
				cmd.Parameters.Add("hong",OracleType.NVarChar,1000).Value=hong;
				cmd.Parameters.Add("thanhquan",OracleType.NVarChar,1000).Value=thanhquan;
				cmd.Parameters.Add("daumatco",OracleType.NVarChar,1000).Value=daumatco;
				cmd.Parameters.Add("khac",OracleType.NVarChar,1000).Value=khac;
				cmd.Parameters.Add("mabs",OracleType.VarChar,4).Value=mabs;
				cmd.Parameters.Add("userid",OracleType.Number).Value=userid;
				cmd.Parameters.Add("mavaovien",OracleType.Number).Value=mavaovien;
				
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".bask_tmh (mavaovien,maql,ngay,makp,tai,mui,hong,thanhquan,daumatco,khac,mabs,userid) ";
					sql+="values (:mavaovien,:mavaovien,to_date(:ngay,'dd/mm/yyyy hh24:mi'),:makp,:tai,:mui,:hong,:thanhquan,:daumatco,:khac,:mabs,:userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;

					cmd.Parameters.Add("mavaovien",OracleType.Number).Value=mavaovien;
					cmd.Parameters.Add("mavaovien",OracleType.Number).Value=mavaovien;
					cmd.Parameters.Add("ngay",OracleType.VarChar,16).Value=ngay;
					cmd.Parameters.Add("makp",OracleType.VarChar,2).Value=makp;
					cmd.Parameters.Add("tai",OracleType.NVarChar,1000).Value=tai;
					cmd.Parameters.Add("mui",OracleType.NVarChar,1000).Value=mui;
					cmd.Parameters.Add("hong",OracleType.NVarChar,1000).Value=hong;
					cmd.Parameters.Add("thanhquan",OracleType.NVarChar,1000).Value=thanhquan;
					cmd.Parameters.Add("daumatco",OracleType.NVarChar,1000).Value=daumatco;
					cmd.Parameters.Add("khac",OracleType.NVarChar,1000).Value=khac;
					cmd.Parameters.Add("mabs",OracleType.VarChar,4).Value=mabs;
					cmd.Parameters.Add("userid",OracleType.Number).Value=userid;

					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"bask_tmh");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}
		public bool upd_bask_sanphu(string ngay,long mavaovien,string makp,string san,string phu,string khac,string mabs,int userid)
		{
			string xxx = user + mmyy(ngay);
			sql="update "+xxx+".bask_sanphu set ngay=to_date(:ngay,'dd/mm/yyyy hh24:mi'),makp=:makp,san=:san,phu=:phu,";
			sql+="khac=:khac,mabs=:mabs,userid=:userid ";
			sql+="where mavaovien=:mavaovien";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("ngay",OracleType.VarChar,16).Value=ngay;
				cmd.Parameters.Add("makp",OracleType.VarChar,2).Value=makp;
				cmd.Parameters.Add("san",OracleType.NVarChar,1000).Value=san;
				cmd.Parameters.Add("phu",OracleType.NVarChar,1000).Value=phu;
				cmd.Parameters.Add("khac",OracleType.NVarChar,1000).Value=khac;
				cmd.Parameters.Add("mabs",OracleType.VarChar,4).Value=mabs;
				cmd.Parameters.Add("userid",OracleType.Number).Value=userid;
				cmd.Parameters.Add("mavaovien",OracleType.Number).Value=mavaovien;
				
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".bask_sanphu (mavaovien,maql,ngay,makp,san,phu,khac,mabs,userid) ";
					sql+="values (:mavaovien,:mavaovien,to_date(:ngay,'dd/mm/yyyy hh24:mi'),:makp,:san,:phu,:khac,:mabs,:userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;

					cmd.Parameters.Add("mavaovien",OracleType.Number).Value=mavaovien;
					cmd.Parameters.Add("mavaovien",OracleType.Number).Value=mavaovien;
					cmd.Parameters.Add("ngay",OracleType.VarChar,16).Value=ngay;
					cmd.Parameters.Add("makp",OracleType.VarChar,2).Value=makp;
					cmd.Parameters.Add("san",OracleType.NVarChar,1000).Value=san;
					cmd.Parameters.Add("phu",OracleType.NVarChar,1000).Value=phu;
					cmd.Parameters.Add("khac",OracleType.NVarChar,1000).Value=khac;
					cmd.Parameters.Add("mabs",OracleType.VarChar,4).Value=mabs;
					cmd.Parameters.Add("userid",OracleType.Number).Value=userid;

					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"bask_sanphu");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}
		public bool upd_bask_tongket(string ngay,long mavaovien,string makp,string nhanxet,string ketluan,int phanloai,
			string denghi,string khac,string mabs,int userid)
		{
			string xxx = user + mmyy(ngay);
			sql="update "+xxx+".bask_tongket set ngay=to_date(:ngay,'dd/mm/yyyy hh24:mi'),makp=:makp,nhanxet=:nhanxet,ketluan=:ketluan,phanloai=:phanloai,";
			sql+="denghi=:denghi,khac=:khac,mabs=:mabs,userid=:userid ";
			sql+="where mavaovien=:mavaovien";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("ngay",OracleType.VarChar,16).Value=ngay;
				cmd.Parameters.Add("makp",OracleType.VarChar,2).Value=makp;
				cmd.Parameters.Add("nhanxet",OracleType.NVarChar,1000).Value=nhanxet;
				cmd.Parameters.Add("ketluan",OracleType.NVarChar,1000).Value=ketluan;
				cmd.Parameters.Add("phanloai",OracleType.Number).Value=phanloai;
				cmd.Parameters.Add("denghi",OracleType.NVarChar,1000).Value=denghi;
				cmd.Parameters.Add("khac",OracleType.NVarChar,1000).Value=khac;
				cmd.Parameters.Add("mabs",OracleType.VarChar,4).Value=mabs;
				cmd.Parameters.Add("userid",OracleType.Number).Value=userid;
				cmd.Parameters.Add("mavaovien",OracleType.Number).Value=mavaovien;
				
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".bask_tongket (mavaovien,maql,ngay,makp,nhanxet,ketluan,phanloai,denghi,khac,mabs,userid) ";
					sql+="values (:mavaovien,:mavaovien,to_date(:ngay,'dd/mm/yyyy hh24:mi'),:makp,:nhanxet,:ketluan,:phanloai,:denghi,:khac,:mabs,:userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;

					cmd.Parameters.Add("mavaovien",OracleType.Number).Value=mavaovien;
					cmd.Parameters.Add("mavaovien",OracleType.Number).Value=mavaovien;
					cmd.Parameters.Add("ngay",OracleType.VarChar,16).Value=ngay;
					cmd.Parameters.Add("makp",OracleType.VarChar,2).Value=makp;
					cmd.Parameters.Add("nhanxet",OracleType.NVarChar,1000).Value=nhanxet;
					cmd.Parameters.Add("ketluan",OracleType.NVarChar,1000).Value=ketluan;
					cmd.Parameters.Add("phanloai",OracleType.Number).Value=phanloai;
					cmd.Parameters.Add("denghi",OracleType.NVarChar,1000).Value=denghi;
					cmd.Parameters.Add("khac",OracleType.NVarChar,1000).Value=khac;
					cmd.Parameters.Add("mabs",OracleType.VarChar,4).Value=mabs;
					cmd.Parameters.Add("userid",OracleType.Number).Value=userid;

					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"bask_tongket");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_bask_chiso(string mabn,long maql,string ngay,int userid)
		{
			string xxx = user + mmyy(ngay);
			sql="update "+xxx+".bask_chiso set mabn=:mabn,maql=:maql,ngay=to_date(:ngay,'dd/mm/yyyy hh24:mi') ";
			sql+="where maql=:maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("mabn",OracleType.VarChar,8).Value=mabn;
				cmd.Parameters.Add("maql",OracleType.Number).Value=maql;
				cmd.Parameters.Add("ngay",OracleType.VarChar,16).Value=ngay;
				cmd.Parameters.Add("maql",OracleType.Number).Value=maql;
				
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".bask_chiso (mabn,maql,ngay,userid) ";
					sql+="values (:mabn,:maql,to_date(:ngay,'dd/mm/yyyy hh24:mi'),:userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;

					cmd.Parameters.Add("mabn",OracleType.VarChar,8).Value=mabn;
					cmd.Parameters.Add("maql",OracleType.Number).Value=maql;
					cmd.Parameters.Add("ngay",OracleType.VarChar,16).Value=ngay;
					cmd.Parameters.Add("userid",OracleType.Number).Value=userid;

					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"bask_chiso");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}
		public bool upd_bask_noikhoa(string ngay,long mavaovien,string makp,int userid)
		{
			string xxx = user + mmyy(ngay);
			sql="update "+xxx+".bask_noikhoa set makp=:makp where mavaovien=:mavaovien";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("makp",OracleType.VarChar,2).Value=makp;
				cmd.Parameters.Add("mavaovien",OracleType.Number).Value=mavaovien;
				
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".bask_noikhoa (mavaovien,maql,makp,userid) ";
					sql+="values (:mavaovien,"+getidyymmddhhmiss_stt_computer_localhost+",:makp,:userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;

					cmd.Parameters.Add("mavaovien",OracleType.Number).Value=mavaovien;
					cmd.Parameters.Add("makp",OracleType.VarChar,2).Value=makp;
					cmd.Parameters.Add("userid",OracleType.Number).Value=userid;


					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"bask_noikhoa");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}
		public bool upd_bask_noikhoa(string ngay,long mavaovien,string makp,int userid,string mabn)
		{
			string xxx = user + mmyy(ngay);
			sql="update "+xxx+".bask_noikhoa set makp=:makp where mavaovien=:mavaovien and mabn=:mabn";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("makp",OracleType.VarChar,2).Value=makp;
				cmd.Parameters.Add("mavaovien",OracleType.Number).Value=mavaovien;
				cmd.Parameters.Add("mabn",OracleType.VarChar,8).Value=mabn;
				
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".bask_noikhoa (mabn,mavaovien,maql,makp,userid) ";
					sql+="values (:mabn,:mavaovien,"+getidyymmddhhmiss_stt_computer_localhost+",:makp,:userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;

					cmd.Parameters.Add("mabn",OracleType.VarChar,8).Value=mabn;
					cmd.Parameters.Add("mavaovien",OracleType.Number).Value=mavaovien;
					cmd.Parameters.Add("makp",OracleType.VarChar,2).Value=makp;
					cmd.Parameters.Add("userid",OracleType.Number).Value=userid;


					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"bask_noikhoa");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}
		public bool upd_bask_ngkhoa(string ngay,long mavaovien,string makp,int userid)
		{
			string xxx = user + mmyy(ngay);
			sql="update "+xxx+".bask_ngkhoa set makp=:makp where mavaovien=:mavaovien";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("makp",OracleType.VarChar,2).Value=makp;
				cmd.Parameters.Add("mavaovien",OracleType.Number).Value=mavaovien;
				
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".bask_ngkhoa (mavaovien,maql,makp,userid) ";
					sql+="values (:mavaovien,"+getidyymmddhhmiss_stt_computer_localhost+",:makp,:userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;

					cmd.Parameters.Add("mavaovien",OracleType.Number).Value=mavaovien;
					cmd.Parameters.Add("makp",OracleType.VarChar,2).Value=makp;
					cmd.Parameters.Add("userid",OracleType.Number).Value=userid;


					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"bask_ngkhoa");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}
		public bool upd_bask_ngkhoa(string ngay,long mavaovien,string makp,int userid, string mabn)
		{
			string xxx = user + mmyy(ngay);
			sql="update "+xxx+".bask_ngkhoa set makp=:makp where mavaovien=:mavaovien and mabn=:mabn";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("makp",OracleType.VarChar,2).Value=makp;
				cmd.Parameters.Add("mavaovien",OracleType.Number).Value=mavaovien;
				cmd.Parameters.Add("mabn",OracleType.VarChar,8).Value=mabn;
				
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".bask_ngkhoa (mabn,mavaovien,maql,makp,userid) ";
					sql+="values (:mabn,:mavaovien,"+getidyymmddhhmiss_stt_computer_localhost+",:makp,:userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;

					cmd.Parameters.Add("mabn",OracleType.VarChar,8).Value=mabn;
					cmd.Parameters.Add("mavaovien",OracleType.Number).Value=mavaovien;
					cmd.Parameters.Add("makp",OracleType.VarChar,2).Value=makp;
					cmd.Parameters.Add("userid",OracleType.Number).Value=userid;


					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"bask_ngkhoa");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}
		public bool upd_bask_mat(string ngay,long mavaovien,string makp,int userid)
		{
			string xxx = user + mmyy(ngay);
			sql="update "+xxx+".bask_mat set makp=:makp where mavaovien=:mavaovien";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("makp",OracleType.VarChar,2).Value=makp;
				cmd.Parameters.Add("mavaovien",OracleType.Number).Value=mavaovien;
				
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".bask_mat (mavaovien,maql,makp,userid) ";
					sql+="values (:mavaovien,"+getidyymmddhhmiss_stt_computer_localhost+",:makp,:userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;

					cmd.Parameters.Add("mavaovien",OracleType.Number).Value=mavaovien;
					cmd.Parameters.Add("makp",OracleType.VarChar,2).Value=makp;
					cmd.Parameters.Add("userid",OracleType.Number).Value=userid;

					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"bask_mat");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}
		public bool upd_bask_mat(string ngay,long mavaovien,string makp,int userid,string mabn)
		{
			string xxx = user + mmyy(ngay);
			sql="update "+xxx+".bask_mat set makp=:makp where mavaovien=:mavaovien and mabn=:mabn";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("makp",OracleType.VarChar,2).Value=makp;
				cmd.Parameters.Add("mavaovien",OracleType.Number).Value=mavaovien;
				cmd.Parameters.Add("mabn",OracleType.VarChar,8).Value=mabn;
				
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".bask_mat (mabn,mavaovien,maql,makp,userid) ";
					sql+="values (:mabn,:mavaovien,"+getidyymmddhhmiss_stt_computer_localhost+",:makp,:userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;

					cmd.Parameters.Add("mabn",OracleType.VarChar,8).Value=mabn;
					cmd.Parameters.Add("mavaovien",OracleType.Number).Value=mavaovien;
					cmd.Parameters.Add("makp",OracleType.VarChar,2).Value=makp;
					cmd.Parameters.Add("userid",OracleType.Number).Value=userid;

					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"bask_mat");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}
		public bool upd_bask_rhm(string ngay,long mavaovien,string makp,int userid)
		{
			string xxx = user + mmyy(ngay);
			sql="update "+xxx+".bask_rhm set makp=:makp where mavaovien=:mavaovien";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("makp",OracleType.VarChar,2).Value=makp;
				cmd.Parameters.Add("mavaovien",OracleType.Number).Value=mavaovien;
				
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{					
					sql="insert into "+xxx+".bask_rhm (mavaovien,maql,makp,userid) ";
					sql+="values (:mavaovien,"+getidyymmddhhmiss_stt_computer_localhost+",:makp,:userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;

					cmd.Parameters.Add("mavaovien",OracleType.Number).Value=mavaovien;
					cmd.Parameters.Add("makp",OracleType.VarChar,2).Value=makp;
					cmd.Parameters.Add("userid",OracleType.Number).Value=userid;


					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"bask_rhm");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_bask_rhm(string ngay,long mavaovien,string makp,int userid,string mabn)
		{
			string xxx = user + mmyy(ngay);
			sql="update "+xxx+".bask_rhm set makp=:makp where mavaovien=:mavaovien and mabn=:mabn";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("makp",OracleType.VarChar,2).Value=makp;
				cmd.Parameters.Add("mavaovien",OracleType.Number).Value=mavaovien;
				cmd.Parameters.Add("mabn",OracleType.VarChar,8).Value=mabn;
				
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{					
					sql="insert into "+xxx+".bask_rhm (mabn,mavaovien,maql,makp,userid) ";
					sql+="values (:mabn,:mavaovien,"+getidyymmddhhmiss_stt_computer_localhost+",:makp,:userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;

					cmd.Parameters.Add("mabn",OracleType.VarChar,8).Value=mabn;
					cmd.Parameters.Add("mavaovien",OracleType.Number).Value=mavaovien;
					cmd.Parameters.Add("makp",OracleType.VarChar,2).Value=makp;
					cmd.Parameters.Add("userid",OracleType.Number).Value=userid;


					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"bask_rhm");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}
		public bool upd_bask_tmh(string ngay,long mavaovien,string makp,int userid)
		{
			string xxx = user + mmyy(ngay);
			sql="update "+xxx+".bask_tmh set makp=:makp where mavaovien=:mavaovien";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("makp",OracleType.VarChar,2).Value=makp;
				cmd.Parameters.Add("mavaovien",OracleType.Number).Value=mavaovien;
				
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".bask_tmh (mavaovien,maql,makp,userid) ";
					sql+="values (:mavaovien,"+getidyymmddhhmiss_stt_computer_localhost+",:makp,:userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;

					cmd.Parameters.Add("mavaovien",OracleType.Number).Value=mavaovien;
					cmd.Parameters.Add("makp",OracleType.VarChar,2).Value=makp;
					cmd.Parameters.Add("userid",OracleType.Number).Value=userid;

					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"bask_tmh");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}
		public bool upd_bask_tmh(string ngay,long mavaovien,string makp,int userid,string mabn)
		{
			string xxx = user + mmyy(ngay);
			sql="update "+xxx+".bask_tmh set makp=:makp where mavaovien=:mavaovien and mabn=:mabn";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("makp",OracleType.VarChar,2).Value=makp;
				cmd.Parameters.Add("mavaovien",OracleType.Number).Value=mavaovien;
				cmd.Parameters.Add("mabn",OracleType.VarChar,8).Value=mabn;
				
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".bask_tmh (mabn,mavaovien,maql,makp,userid) ";
					sql+="values (:mabn,:mavaovien,"+getidyymmddhhmiss_stt_computer_localhost+",:makp,:userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;

					cmd.Parameters.Add("mabn",OracleType.VarChar,8).Value=mabn;
					cmd.Parameters.Add("mavaovien",OracleType.Number).Value=mavaovien;
					cmd.Parameters.Add("makp",OracleType.VarChar,2).Value=makp;
					cmd.Parameters.Add("userid",OracleType.Number).Value=userid;

					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"bask_tmh");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}
		public bool upd_bask_sanphu(string ngay,long mavaovien,string makp,int userid)
		{
			string xxx = user + mmyy(ngay);
			sql="update "+xxx+".bask_sanphu set makp=:makp where mavaovien=:mavaovien";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("makp",OracleType.VarChar,2).Value=makp;
				cmd.Parameters.Add("mavaovien",OracleType.Number).Value=mavaovien;
				
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".bask_sanphu (mavaovien,maql,makp,userid) ";
					sql+="values (:mavaovien,"+getidyymmddhhmiss_stt_computer_localhost+",:makp,:userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;

					cmd.Parameters.Add("mavaovien",OracleType.Number).Value=mavaovien;
					cmd.Parameters.Add("makp",OracleType.VarChar,2).Value=makp;
					cmd.Parameters.Add("userid",OracleType.Number).Value=userid;

					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"bask_sanphu");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}
		public bool upd_bask_sanphu(string ngay,long mavaovien,string makp,int userid,string mabn)
		{
			string xxx = user + mmyy(ngay);
			sql="update "+xxx+".bask_sanphu set makp=:makp where mavaovien=:mavaovien and mabn=:mabn";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("makp",OracleType.VarChar,2).Value=makp;
				cmd.Parameters.Add("mavaovien",OracleType.Number).Value=mavaovien;
				cmd.Parameters.Add("mabn",OracleType.VarChar,8).Value=mabn;
				
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".bask_sanphu (mabn,mavaovien,maql,makp,userid) ";
					sql+="values (:mabn,:mavaovien,"+getidyymmddhhmiss_stt_computer_localhost+",:makp,:userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;

					cmd.Parameters.Add("mabn",OracleType.VarChar,8).Value=mabn;
					cmd.Parameters.Add("mavaovien",OracleType.Number).Value=mavaovien;
					cmd.Parameters.Add("makp",OracleType.VarChar,2).Value=makp;
					cmd.Parameters.Add("userid",OracleType.Number).Value=userid;

					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"bask_sanphu");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}
		public bool upd_bask_tongket(string ngay,long mavaovien,string makp,int userid)
		{
			string xxx = user + mmyy(ngay);
			sql="update "+xxx+".bask_tongket set makp=:makp where mavaovien=:mavaovien";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				
				cmd.Parameters.Add("makp",OracleType.VarChar,2).Value=makp;
				cmd.Parameters.Add("mavaovien",OracleType.Number).Value=mavaovien;
				
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".bask_tongket (mavaovien,maql,makp,userid) ";
					sql+="values (:mavaovien,"+getidyymmddhhmiss_stt_computer_localhost+",:makp,:userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;

					cmd.Parameters.Add("mavaovien",OracleType.Number).Value=mavaovien;
					cmd.Parameters.Add("makp",OracleType.VarChar,2).Value=makp;
					cmd.Parameters.Add("userid",OracleType.Number).Value=userid;

					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"bask_tongket");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_bask_tongket(string ngay,long mavaovien,string makp,int userid,string mabn)
		{
			string xxx = user + mmyy(ngay);
			sql="update "+xxx+".bask_tongket set makp=:makp where mavaovien=:mavaovien and mabn=:mabn";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				
				cmd.Parameters.Add("makp",OracleType.VarChar,2).Value=makp;
				cmd.Parameters.Add("mavaovien",OracleType.Number).Value=mavaovien;
				cmd.Parameters.Add("mabn",OracleType.VarChar,8).Value=mabn;
				
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".bask_tongket (mabn,mavaovien,maql,makp,userid) ";
					sql+="values (:mabn,:mavaovien,"+getidyymmddhhmiss_stt_computer_localhost+",:makp,:userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;

					cmd.Parameters.Add("mabn",OracleType.VarChar,8).Value=mabn;
					cmd.Parameters.Add("mavaovien",OracleType.Number).Value=mavaovien;
					cmd.Parameters.Add("makp",OracleType.VarChar,2).Value=makp;
					cmd.Parameters.Add("userid",OracleType.Number).Value=userid;

					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"bask_tongket");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}
		public bool upd_kskdoan(long id,string sohd,string ngay,int loai,string ma,string ten,string diachi,
			string dienthoai,string fax,string email,string masothue,string nguoilienhe,string ghichu,int userid)
		{
			sql = "update kskdoan set sohd=:sohd,ngay=to_date(:ngay,'dd/mm/yyyy'),loai=:loai,";
			sql += "ma=:ma,ten=:ten,diachi=:diachi,dienthoai=:dienthoai,fax=:fax,email=:email,";
			sql += " masothue=:masothue,nguoilienhe=:nguoilienhe,ghichu=:ghichu,";
			sql += " userid=:userid where id=:id";
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd = new OracleCommand(sql, con);
				cmd.CommandType = CommandType.Text;
				cmd.Parameters.Add("sohd", OracleType.VarChar,20).Value = sohd;
				cmd.Parameters.Add("ngay", OracleType.VarChar,10).Value = ngay;
				cmd.Parameters.Add("loai", OracleType.Number).Value = loai;
				cmd.Parameters.Add("ma", OracleType.VarChar,3).Value = ma;
				cmd.Parameters.Add("ten", OracleType.NVarChar,254).Value = ten;
				cmd.Parameters.Add("diachi", OracleType.NVarChar,254).Value = diachi;
				cmd.Parameters.Add("dienthoai", OracleType.VarChar,50).Value = dienthoai;
				cmd.Parameters.Add("fax", OracleType.VarChar,50).Value = fax;
				cmd.Parameters.Add("email", OracleType.NVarChar,254).Value = email;
				cmd.Parameters.Add("masothue", OracleType.VarChar,20).Value = masothue;
				cmd.Parameters.Add("nguoilienhe", OracleType.NVarChar,254).Value = nguoilienhe;
				cmd.Parameters.Add("ghichu", OracleType.NVarChar,254).Value = ghichu;
				cmd.Parameters.Add("userid", OracleType.Number).Value = userid;
				cmd.Parameters.Add("id", OracleType.Number).Value = id;
				int irec = cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec == 0)
				{
					sql = "insert into kskdoan (id,sohd,ngay,loai,ma,ten,diachi,dienthoai,fax,email,masothue,nguoilienhe,ghichu,userid) values (:id,:sohd,to_date(:ngay,'dd/mm/yyyy'),:loai,:ma,:ten,:diachi,:dienthoai,:fax,:email,:masothue,:nguoilienhe,:ghichu,:userid)";
					cmd = new OracleCommand(sql, con);
					cmd.CommandType = CommandType.Text;
					cmd.Parameters.Add("id", OracleType.Number).Value = id;
					cmd.Parameters.Add("sohd", OracleType.VarChar,20).Value = sohd;
					cmd.Parameters.Add("ngay", OracleType.VarChar,10).Value = ngay;
					cmd.Parameters.Add("loai", OracleType.Number).Value = loai;
					cmd.Parameters.Add("ma", OracleType.VarChar,3).Value = ma;
					cmd.Parameters.Add("ten", OracleType.NVarChar,254).Value = ten;
					cmd.Parameters.Add("diachi", OracleType.NVarChar,254).Value = diachi;
					cmd.Parameters.Add("dienthoai", OracleType.VarChar,50).Value = dienthoai;
					cmd.Parameters.Add("fax", OracleType.VarChar,50).Value = fax;
					cmd.Parameters.Add("email", OracleType.NVarChar,254).Value = email;
					cmd.Parameters.Add("masothue", OracleType.VarChar,20).Value = masothue;
					cmd.Parameters.Add("nguoilienhe", OracleType.NVarChar,254).Value = nguoilienhe;
					cmd.Parameters.Add("ghichu", OracleType.NVarChar,254).Value = ghichu;
					cmd.Parameters.Add("userid", OracleType.Number).Value = userid;
					irec = cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch (OracleException ex)
			{
				upd_error(ex.Message, sComputer, "kskdoan");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_kskdonvi(long id, long iddoan,decimal stt, string ma, string ten,string tu,string den,int userid)
		{
			sql = "update kskdonvi set iddoan=:iddoan,stt=:stt,";
			sql += "ma=:ma,ten=:ten,tu=to_date(:tu,'dd/mm/yyyy'),den=to_date(:den,'dd/mm/yyyy'),userid=:userid";
			sql += " where id=:id";
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd = new OracleCommand(sql, con);
				cmd.CommandType = CommandType.Text;
				cmd.Parameters.Add("iddoan", OracleType.Number).Value = iddoan;
				cmd.Parameters.Add("stt", OracleType.Number).Value = stt;
				cmd.Parameters.Add("ma", OracleType.VarChar, 2).Value = ma;
				cmd.Parameters.Add("ten", OracleType.NVarChar,254).Value = ten;
				cmd.Parameters.Add("tu", OracleType.VarChar, 10).Value = tu;
				cmd.Parameters.Add("den", OracleType.VarChar, 10).Value = den;
				cmd.Parameters.Add("userid", OracleType.Number).Value = userid;
				cmd.Parameters.Add("id", OracleType.Number).Value = id;
				int irec = cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec == 0)
				{
					sql = "insert into kskdonvi (id,iddoan,stt,ma,ten,tu,den,userid) values (:id,:iddoan,:stt,:ma,:ten,to_date(:tu,'dd/mm/yyyy'),to_date(:den,'dd/mm/yyyy'),:userid)";
					cmd = new OracleCommand(sql, con);
					cmd.CommandType = CommandType.Text;
					cmd.Parameters.Add("id", OracleType.Number).Value = id;
					cmd.Parameters.Add("iddoan", OracleType.Number).Value = iddoan;
					cmd.Parameters.Add("stt", OracleType.Number).Value = stt;
					cmd.Parameters.Add("ma", OracleType.VarChar, 2).Value = ma;
					cmd.Parameters.Add("ten", OracleType.NVarChar,254).Value = ten;
					cmd.Parameters.Add("tu", OracleType.VarChar, 10).Value = tu;
					cmd.Parameters.Add("den", OracleType.VarChar, 10).Value = den;
					cmd.Parameters.Add("userid", OracleType.Number).Value = userid;
					irec = cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch (OracleException ex)
			{
				upd_error(ex.Message, sComputer, "kskdonvi");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_kskmuc(long id,long iddoan,decimal stt,int phai,string tt,string namsinh,string ghichu)
		{
			sql = "update kskmuc set iddoan=:iddoan,stt=:stt,phai=:phai,tt=:tt,namsinh=:namsinh,ghichu=:ghichu where id=:id";
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd = new OracleCommand(sql, con);
				cmd.CommandType = CommandType.Text;
				cmd.Parameters.Add("iddoan", OracleType.Number).Value = iddoan;
				cmd.Parameters.Add("stt", OracleType.Number).Value = stt;
				cmd.Parameters.Add("phai", OracleType.Number).Value = phai;
				cmd.Parameters.Add("tt", OracleType.VarChar, 2).Value = tt;
				cmd.Parameters.Add("namsinh", OracleType.VarChar,4).Value = namsinh;
				cmd.Parameters.Add("ghichu", OracleType.NVarChar,254).Value = ghichu;
				cmd.Parameters.Add("id", OracleType.Number).Value = id;
				int irec = cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec == 0)
				{
					sql = "insert into kskmuc (id,iddoan,stt,phai,tt,namsinh,ghichu) values (:id,:iddoan,:stt,:phai,:tt,:namsinh,:ghichu)";
					cmd = new OracleCommand(sql, con);
					cmd.CommandType = CommandType.Text;
					cmd.Parameters.Add("id", OracleType.Number).Value = id;
					cmd.Parameters.Add("iddoan", OracleType.Number).Value = iddoan;
					cmd.Parameters.Add("stt", OracleType.Number).Value = stt;
					cmd.Parameters.Add("phai", OracleType.Number).Value = phai;
					cmd.Parameters.Add("tt", OracleType.VarChar, 2).Value = tt;
					cmd.Parameters.Add("namsinh", OracleType.VarChar, 4).Value = namsinh;
					cmd.Parameters.Add("ghichu", OracleType.NVarChar,254).Value = ghichu;
					irec = cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch (OracleException ex)
			{
				upd_error(ex.Message, sComputer, "kskmuc");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_kskmucct(long id,long mavp,decimal stt,decimal gia_nv,decimal gia_ngv,string ghichu)
		{
			sql = "update kskmucct set stt=:stt,gia_nv=:gia_nv,gia_ngv=:gia_ngv,ghichu=:ghichu where id=:id and mavp=:mavp";
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd = new OracleCommand(sql, con);
				cmd.CommandType = CommandType.Text;
				cmd.Parameters.Add("stt", OracleType.Number).Value = stt;
				cmd.Parameters.Add("gia_nv", OracleType.Number).Value = gia_nv;
				cmd.Parameters.Add("gia_ngv", OracleType.Number).Value = gia_ngv;
				cmd.Parameters.Add("ghichu", OracleType.NVarChar,254).Value = ghichu;
				cmd.Parameters.Add("id", OracleType.Number).Value = id;
				cmd.Parameters.Add("mavp", OracleType.Number).Value = mavp;
				int irec = cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec == 0)
				{
					sql = "insert into kskmucct (id,stt,mavp,gia_nv,gia_ngv,ghichu) values (:id,:stt,:mavp,:gia_nv,:gia_ngv,:ghichu)";
					cmd = new OracleCommand(sql, con);
					cmd.CommandType = CommandType.Text;
					cmd.Parameters.Add("id", OracleType.Number).Value = id;
					cmd.Parameters.Add("stt", OracleType.Number).Value = stt;
					cmd.Parameters.Add("mavp", OracleType.Number).Value = mavp;
					cmd.Parameters.Add("gia_nv", OracleType.Number).Value = gia_nv;
					cmd.Parameters.Add("gia_ngv", OracleType.Number).Value = gia_ngv;
					cmd.Parameters.Add("ghichu", OracleType.NVarChar,254).Value = ghichu;
					irec = cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch (OracleException ex)
			{
				upd_error(ex.Message, sComputer, "kskmucct");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}
			return true;
		}

		public string get_ma_doan(string ngay)
		{
			int ma = 1;
			sql = "select max(ma) as ma from kskdoan where to_char(ngay,'yyyy')='" + ngay.Substring(6, 4) + "'";
			ds = get_data(sql);
			if (ds.Tables[0].Rows[0]["ma"].ToString()!="")
			{
				ma = int.Parse(ds.Tables[0].Rows[0]["ma"].ToString()) + 1;
			}
			return ma.ToString().PadLeft(3, '0');
		}

		public string get_ma_donvi(long iddoan)
		{
			int ma = 1;
			sql = "select max(ma) as ma from kskdonvi where iddoan="+iddoan;
			ds = get_data(sql);
			if (ds.Tables[0].Rows[0]["ma"].ToString() != "")
			{
				ma = int.Parse(ds.Tables[0].Rows[0]["ma"].ToString()) + 1;
			}
			return ma.ToString().PadLeft(2, '0');
		}

		public bool upd_kskbtdbn(long iddonvi,decimal stt,string mabn,string hoten,string namsinh,int phai,string mann,string dienthoai,string diachi,int userid)
		{
			string hotenkdau = Hoten_khongdau(hoten);
			sql = "update kskbtdbn set stt=:stt,hoten=:hoten,namsinh=:namsinh,phai=:phai,mann=:mann,dienthoai=:dienthoai,diachi=:diachi,hotenkdau=:hotenkdau,userid=:userid where mabn=:mabn and iddonvi=:iddonvi";
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd = new OracleCommand(sql, con);
				cmd.CommandType = CommandType.Text;
				cmd.Parameters.Add("stt", OracleType.Number).Value = stt;
				cmd.Parameters.Add("hoten", OracleType.NVarChar,100).Value = hoten;
				cmd.Parameters.Add("namsinh", OracleType.VarChar,4).Value = namsinh;
				cmd.Parameters.Add("phai", OracleType.Number).Value = phai;
				cmd.Parameters.Add("mann", OracleType.VarChar,2).Value = mann;
				cmd.Parameters.Add("dienthoai", OracleType.VarChar,50).Value = dienthoai;
				cmd.Parameters.Add("diachi", OracleType.NVarChar,254).Value = diachi;
				cmd.Parameters.Add("hotenkdau", OracleType.VarChar,100).Value = hotenkdau;
				cmd.Parameters.Add("userid", OracleType.Number).Value = userid;
				cmd.Parameters.Add("mabn", OracleType.VarChar,8).Value = mabn;
				cmd.Parameters.Add("iddonvi", OracleType.Number).Value = iddonvi;
				int irec = cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec == 0)
				{
					sql = "insert into kskbtdbn (iddonvi,stt,mabn,hoten,namsinh,phai,mann,dienthoai,diachi,hotenkdau,userid) values (:iddonvi,:stt,:mabn,:hoten,:namsinh,:phai,:mann,:dienthoai,:diachi,:hotenkdau,:userid)";
					cmd = new OracleCommand(sql, con);
					cmd.CommandType = CommandType.Text;
					cmd.Parameters.Add("iddonvi", OracleType.Number).Value = iddonvi;
					cmd.Parameters.Add("stt", OracleType.Number).Value = stt;
					cmd.Parameters.Add("mabn", OracleType.VarChar,8).Value = mabn;
					cmd.Parameters.Add("hoten", OracleType.NVarChar,100).Value = hoten;
					cmd.Parameters.Add("namsinh", OracleType.VarChar,4).Value = namsinh;
					cmd.Parameters.Add("phai", OracleType.Number).Value = phai;
					cmd.Parameters.Add("mann", OracleType.VarChar,2).Value = mann;
					cmd.Parameters.Add("dienthoai", OracleType.VarChar,50).Value = dienthoai;
					cmd.Parameters.Add("diachi", OracleType.NVarChar,254).Value = diachi;
					cmd.Parameters.Add("hotenkdau", OracleType.VarChar,100).Value = hotenkdau;
					cmd.Parameters.Add("userid", OracleType.Number).Value = userid;
					irec = cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch (OracleException ex)
			{
				upd_error(ex.Message, sComputer, "kskbtdbn");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}
			return true;
		}

		public void ksk_chidinh(string mabn,string ngay,long maql,string makp,int madoituong,int _userid,long doan,string namsinh,int phai,int loaiksk)
		{
			DataTable dtmuc = get_data("select * from kskmuc where iddoan=" + doan + " order by stt").Tables[0];
			DataTable dtmucct = get_data("select b.*,c.ten from kskmuc a,kskmucct b,v_giavp c where a.id=b.id and b.mavp=c.id and a.iddoan=" + doan + " order by b.stt").Tables[0];
			updrec(dtmuc,dtmucct,ngay,mabn,maql,makp,madoituong,_userid,namsinh,phai,loaiksk);
		}

		private void updrec(DataTable dtmuc,DataTable dtmucct,string ngay,string mabn,long maql,string makp,int madoituong,int _userid,string namsinh,int phai,int loaiksk)
		{
			DataRow[] dr;
			bool bFound = false;
			sql = "true";
			if (phai != -1) sql += " and phai=" + phai;
			foreach (DataRow r2 in dtmuc.Select(sql, "stt"))
			{
				sql = "true";
				if (phai != -1) sql += " and phai=" + phai;
				if (namsinh != "") sql += " and namsinh<>'' and namsinh" + r2["tt"].ToString().Trim() + "'" + namsinh + "'";
				foreach (DataRow r in dtmuc.Select(sql, "stt"))
				{
					sql = "true";
					if (phai != -1) sql += " and phai=" + phai;
					if (namsinh != "" && r["namsinh"].ToString() != "") sql += " and namsinh" + r["tt"].ToString().Trim() + "'" + namsinh + "'";
					dr = dtmuc.Select(sql);
					if (dr.Length > 0)
					{
						ins_items(dtmucct,ngay,mabn,maql,makp,madoituong,_userid,long.Parse(r["id"].ToString()),loaiksk);
						bFound = true;
						break;
					}
				}
				if (bFound) break;
			}
			if (!bFound)
			{
				sql = "true";
				if (phai != -1) sql += " and phai=" + phai;
				foreach (DataRow r in dtmuc.Select(sql, "phai,namsinh,stt"))
				{
					sql = "true";
					if (phai != -1 && r["phai"].ToString() != "-1") sql += " and phai=" + phai;
					if (namsinh != "" && r["namsinh"].ToString() != "") sql += " and namsinh" + r["tt"].ToString().Trim() + "'" + namsinh + "'";
					dr = dtmuc.Select(sql);
					if (dr.Length > 0)
					{
						ins_items(dtmucct,ngay,mabn,maql,makp,madoituong,_userid,long.Parse(r["id"].ToString()),loaiksk);
						break;
					}
				}
			}
		}

		private void ins_items(DataTable dtmucct,string ngay,string mabn,long maql,string makp,int madoituong,int _userid,long id,int loaiksk)
		{
			
			long _id=0;
			foreach (DataRow r1 in dtmucct.Select("id=" + id, "stt"))
			{
				_id=get_id_chidinh_v;
				upd_chidinh(mmyy(ngay),_id,mabn,maql,0,ngay,iNgoaitru,makp,madoituong,int.Parse(r1["mavp"].ToString()),1,(loaiksk==0)?decimal.Parse(r1["gia_nv"].ToString()):decimal.Parse(r1["gia_ngv"].ToString()),0,_userid,1,1,"","Khám sức khỏe tổng quát",maql,_id);
			}
		}

		public bool upd_bask_chiso_noikhoa(long maql,string ngay,string mantinh,string namvien,int ruou,
			int thuocla,int diung,string tendiung,int viemgana,int viemganb,string khac,int soi,int viemnao,int lao,
			int uonvan,int bachhau,int cum)
		{
			string xxx = user + mmyy(ngay);
			sql="update "+xxx+".bask_chiso set mantinh=:mantinh,";
			sql+="namvien=:namvien,ruou=:ruou,thuocla=:thuocla,diung=:diung,tendiung=:tendiung,";
			sql+="viemgana=:viemgana,viemganb=:viemganb,khac=:khac,soi=:soi,viemnao=:viemnao,lao=:lao,";
			sql+="uonvan=:uonvan,bachhau=:bachhau,cum=:cum ";
			sql+="where maql=:maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("mantinh",OracleType.NVarChar,1000).Value=mantinh;
				cmd.Parameters.Add("namvien",OracleType.NVarChar,1000).Value=namvien;
				cmd.Parameters.Add("ruou",OracleType.Number).Value=ruou;
				cmd.Parameters.Add("thuocla",OracleType.Number).Value=thuocla;
				cmd.Parameters.Add("diung",OracleType.Number).Value=diung;
				cmd.Parameters.Add("tendiung",OracleType.NVarChar,254).Value=tendiung;
				cmd.Parameters.Add("viemgana",OracleType.Number).Value=viemgana;
				cmd.Parameters.Add("viemganb",OracleType.Number).Value=viemganb;
				cmd.Parameters.Add("khac",OracleType.NVarChar,254).Value=khac;
				cmd.Parameters.Add("soi",OracleType.Number).Value=soi;
				cmd.Parameters.Add("viemnao",OracleType.Number).Value=viemnao;
				cmd.Parameters.Add("lao",OracleType.Number).Value=lao;
				cmd.Parameters.Add("uonvan",OracleType.Number).Value=uonvan;
				cmd.Parameters.Add("bachhau",OracleType.Number).Value=bachhau;
				cmd.Parameters.Add("cum",OracleType.Number).Value=cum;
				cmd.Parameters.Add("maql",OracleType.Number).Value=maql;
				
				cmd.ExecuteNonQuery();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"bask_chiso_noikhoa");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_bask_chiso_ngkhoa(long maql,string ngay,string pttt,string chanthuong)
		{
			string xxx = user + mmyy(ngay);
			sql="update "+xxx+".bask_chiso set pttt=:pttt,chanthuong=:chanthuong ";
			sql+="where maql=:maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("pttt",OracleType.NVarChar,1000).Value=pttt;
				cmd.Parameters.Add("chanthuong",OracleType.NVarChar,1000).Value=chanthuong;
				cmd.Parameters.Add("maql",OracleType.Number).Value=maql;
				
				cmd.ExecuteNonQuery();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"bask_chiso_ngkhoa");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_bask_chiso_sanphu(long maql,string ngay,string para,int docthan,string kinhnguyet,
			string sankhoa,string phukhoa)
		{
			string xxx = user + mmyy(ngay);
			sql="update "+xxx+".bask_chiso set para=:para,docthan=:docthan,kinhnguyet=:kinhnguyet,";
			sql+="sankhoa=:sankhoa,phukhoa=:phukhoa ";
			sql+="where maql=:maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("para",OracleType.VarChar,8).Value=para;
				cmd.Parameters.Add("docthan",OracleType.Number).Value=docthan;
				cmd.Parameters.Add("kinhnguyet",OracleType.NVarChar,1000).Value=kinhnguyet;
				cmd.Parameters.Add("sankhoa",OracleType.NVarChar,1000).Value=sankhoa;
				cmd.Parameters.Add("phukhoa",OracleType.NVarChar,1000).Value=phukhoa;
				cmd.Parameters.Add("maql",OracleType.Number).Value=maql;
				
				cmd.ExecuteNonQuery();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"bask_chiso_sanphu");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_bask_donvi(string ngay,string mabn,long maql,decimal mach,string huyetap,
			decimal cannang,decimal chieucao)
		{
			string xxx = user + mmyy(ngay);
			sql="update "+xxx+".bask_donvi set mabn=:mabn,";
			sql+="mach=:mach,huyetap=:huyetap,cannang=:cannang,chieucao=:chieucao ";
			sql+="where maql=:maql";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("mabn",OracleType.VarChar,8).Value=mabn;
				cmd.Parameters.Add("mach",OracleType.Number).Value=mach;
				cmd.Parameters.Add("huyetap",OracleType.VarChar,7).Value=huyetap;
				cmd.Parameters.Add("cannang",OracleType.Number).Value=cannang;
				cmd.Parameters.Add("chieucao",OracleType.Number).Value=chieucao;
				cmd.Parameters.Add("maql",OracleType.Number).Value=maql;
				
				cmd.ExecuteNonQuery();
				cmd.Dispose();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"bask_donvi");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_lydohuy(string mabn,long maql,string tu,string den,string makp,string lydo,int loai,int userid)
		{			
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				sql = "insert into lydohuy (mabn,maql,tu,den,makp,lydo,loai,userid,computer)";
				sql+=" values (:mabn,:maql,to_date(:tu,'dd/mm/yyyy hh24:mi'),to_date(:den,'dd/mm/yyyy hh24:mi'),:makp,:lydo,:loai,:userid,'"+sComputer+"')";
				cmd = new OracleCommand(sql, con);
				cmd.CommandType = CommandType.Text;
				cmd.Parameters.Add("mabn", OracleType.VarChar,8).Value = mabn;
				cmd.Parameters.Add("maql", OracleType.Number).Value = maql;
				cmd.Parameters.Add("tu", OracleType.VarChar,16).Value = tu;
				cmd.Parameters.Add("den", OracleType.VarChar,16).Value = den;
				cmd.Parameters.Add("makp", OracleType.VarChar,16).Value = makp;
				cmd.Parameters.Add("lydo", OracleType.NVarChar,254).Value = lydo;
				cmd.Parameters.Add("loai", OracleType.Number).Value = loai;
				cmd.Parameters.Add("userid", OracleType.Number).Value = userid;
				cmd.ExecuteNonQuery();
				cmd.Dispose();
			}
			catch (OracleException ex)
			{
				upd_error(ex.Message, sComputer, "lydohuy");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_capthevip(string mabn,long maql,int nguoicap,string ngaycap,int userid)
		{
			sql = "update capthevip set mabn=:mabn,nguoicap=:nguoicap,ngaycap=to_date(:ngaycap,'dd/mm/yyyy'),userid=:userid where maql=:maql";
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd = new OracleCommand(sql, con);
				cmd.CommandType = CommandType.Text;
				cmd.Parameters.Add("mabn", OracleType.VarChar,8).Value = mabn;
				cmd.Parameters.Add("nguoicap", OracleType.Number).Value = nguoicap;
				cmd.Parameters.Add("ngaycap", OracleType.VarChar,10).Value = ngaycap;
				cmd.Parameters.Add("userid", OracleType.Number).Value = userid;
				cmd.Parameters.Add("maql", OracleType.Number).Value = maql;
				int irec = cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec == 0)
				{
					sql = "insert into capthevip (mabn,maql,nguoicap,ngaycap,userid) values (:mabn,:maql,:nguoicap,to_date(:ngaycap,'dd/mm/yyyy'),:userid)";
					cmd = new OracleCommand(sql, con);
					cmd.CommandType = CommandType.Text;
					cmd.Parameters.Add("mabn", OracleType.VarChar,8).Value = mabn;
					cmd.Parameters.Add("maql", OracleType.Number).Value = maql;
					cmd.Parameters.Add("nguoicap", OracleType.Number).Value = nguoicap;
					cmd.Parameters.Add("ngaycap", OracleType.VarChar,10).Value = ngaycap;
					cmd.Parameters.Add("userid", OracleType.Number).Value = userid;
					irec = cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch (OracleException ex)
			{
				upd_error(ex.Message, sComputer, "capthevip");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_nhapkhoabmi(long id,long maql,decimal chieucao,decimal cannang)
		{
			sql="update nhapkhoabmi set maql=:maql,chieucao=:chieucao,cannang=:cannang ";
			sql+="where id=:id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("maql",OracleType.Number).Value=maql;
				cmd.Parameters.Add("chieucao",OracleType.Number).Value=chieucao;
				cmd.Parameters.Add("cannang",OracleType.Number).Value=cannang;
				cmd.Parameters.Add("id",OracleType.Number).Value=id;
				
				int irec = cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec == 0)
				{
					sql = "insert into nhapkhoabmi (id,maql,chieucao,cannang) values (:id,:maql,:chieucao,:cannang)";
					cmd = new OracleCommand(sql, con);
					cmd.CommandType = CommandType.Text;
					cmd.Parameters.Add("id",OracleType.Number).Value=id;
					cmd.Parameters.Add("maql",OracleType.Number).Value=maql;
					cmd.Parameters.Add("chieucao",OracleType.Number).Value=chieucao;
					cmd.Parameters.Add("cannang",OracleType.Number).Value=cannang;				
					irec = cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"nhapkhoabmi");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_pttt_phucap(long id,long nhom,long idptss,long idpcct,string mabn,long maql,long idkhoa,
			string ngay,string makp,string mabs,int userid)
		{
			sql="update pttt_phucap set nhom=:nhom,idptss=:idptss,idpcct=:idpcct,mabn=:mabn,maql=:maql,idkhoa=:idkhoa,";
			sql+="ngay=to_date(:ngay,'dd/mm/yyyy hh24:mi'),makp=:makp,mabs=:mabs,userid=:userid ";
			sql+="where id=:id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("nhom",OracleType.Number).Value=nhom;
				cmd.Parameters.Add("idptss",OracleType.Number).Value=idptss;
				cmd.Parameters.Add("idpcct",OracleType.Number).Value=idpcct;
				cmd.Parameters.Add("mabn",OracleType.VarChar,8).Value=mabn;
				cmd.Parameters.Add("maql",OracleType.Number).Value=maql;
				cmd.Parameters.Add("idkhoa",OracleType.Number).Value=idkhoa;
				cmd.Parameters.Add("ngay",OracleType.VarChar,16).Value=ngay;
				cmd.Parameters.Add("makp",OracleType.VarChar,2).Value=makp;
				cmd.Parameters.Add("mabs",OracleType.VarChar,4).Value=mabs;
				cmd.Parameters.Add("userid",OracleType.Number).Value=userid;
				cmd.Parameters.Add("id",OracleType.Number).Value=id;
				
				int irec = cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec == 0)
				{
					sql = "insert into pttt_phucap (id,nhom,idptss,idpcct,mabn,maql,idkhoa,ngay,makp,mabs,userid) values (:id,:nhom,:idptss,:idpcct,:mabn,:maql,:idkhoa,to_date(:ngay,'dd/mm/yyyy hh24:mi'),:makp,:mabs,:userid)";
					cmd = new OracleCommand(sql, con);
					cmd.CommandType = CommandType.Text;
					cmd.Parameters.Add("id",OracleType.Number).Value=id;
					cmd.Parameters.Add("nhom",OracleType.Number).Value=nhom;
					cmd.Parameters.Add("idptss",OracleType.Number).Value=idptss;
					cmd.Parameters.Add("idpcct",OracleType.Number).Value=idpcct;
					cmd.Parameters.Add("mabn",OracleType.VarChar,8).Value=mabn;
					cmd.Parameters.Add("maql",OracleType.Number).Value=maql;
					cmd.Parameters.Add("idkhoa",OracleType.Number).Value=idkhoa;
					cmd.Parameters.Add("ngay",OracleType.VarChar,16).Value=ngay;
					cmd.Parameters.Add("makp",OracleType.VarChar,2).Value=makp;
					cmd.Parameters.Add("mabs",OracleType.VarChar,4).Value=mabs;
					cmd.Parameters.Add("userid",OracleType.Number).Value=userid;
					irec = cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"pttt_phucap");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_pttt_nhompc(long m_id,decimal m_stt,int m_loai,string m_ma,string m_ten,long m_mavp)
		{
			sql="update pttt_nhompc set stt=:m_stt,loai=:m_loai,ma=:m_ma,ten=:m_ten,mavp=:m_mavp where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
				cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
				cmd.Parameters.Add("m_ma",OracleType.VarChar,10).Value=m_ma;
				cmd.Parameters.Add("m_ten",OracleType.NVarChar,254).Value=m_ten;
				cmd.Parameters.Add("m_mavp",OracleType.Number).Value=m_mavp;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into pttt_nhompc (id,stt,loai,ma,ten,mavp) values (:m_id,:m_stt,:m_loai,:m_ma,:m_ten,:m_mavp)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
					cmd.Parameters.Add("m_loai",OracleType.Number).Value=m_loai;
					cmd.Parameters.Add("m_ma",OracleType.VarChar,10).Value=m_ma;
					cmd.Parameters.Add("m_ten",OracleType.NVarChar,254).Value=m_ten;
					cmd.Parameters.Add("m_mavp",OracleType.Number).Value=m_mavp;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"pttt_nhompc");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}
		public bool upd_pttt_nhompcct(long m_id,long m_idpc,decimal m_stt,string m_ten,int m_khoa,decimal m_sotien,decimal m_tyle)
		{
			sql="update pttt_nhompcct set idpc=:m_idpc,stt=:m_stt,ten=:m_ten,khoa=:m_khoa,sotien=:m_sotien,tyle=:m_tyle where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_idpc",OracleType.Number).Value=m_idpc;
				cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
				cmd.Parameters.Add("m_ten",OracleType.NVarChar,254).Value=m_ten;
				cmd.Parameters.Add("m_khoa",OracleType.Number).Value=m_khoa;
				cmd.Parameters.Add("m_sotien",OracleType.Number).Value=m_sotien;
				cmd.Parameters.Add("m_tyle",OracleType.Number).Value=m_tyle;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into pttt_nhompcct (id,idpc,stt,ten,khoa,sotien,tyle) values (:m_id,:m_idpc,:m_stt,:m_ten,:m_khoa,:m_sotien,:m_tyle)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_idpc",OracleType.Number).Value=m_idpc;
					cmd.Parameters.Add("m_stt",OracleType.Number).Value=m_stt;
					cmd.Parameters.Add("m_ten",OracleType.NVarChar,254).Value=m_ten;
					cmd.Parameters.Add("m_khoa",OracleType.Number).Value=m_khoa;
					cmd.Parameters.Add("m_sotien",OracleType.Number).Value=m_sotien;
					cmd.Parameters.Add("m_tyle",OracleType.Number).Value=m_tyle;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"pttt_nhompcct");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}
		public bool upd_stttiepdon(int m_id,string m_ngay,long m_stt)
		{
			con = new OracleConnection(sConn);
			con.Open();
			string sql = "update " + user + mmyy(m_ngay) + ".stttiepdon set stt="+m_stt+" where id=" + m_id+" and to_char(ngay,'dd/mm/yyyy')='"+m_ngay+"'";
			cmd = new OracleCommand(sql, con);
			try
			{
				if (cmd.ExecuteNonQuery() == 0)
				{
					sql = "insert into " + user + mmyy(m_ngay) + ".stttiepdon(id,ngay,stt)";
					sql += " values(" + m_id + ",to_date('" + m_ngay + "','dd/mm/yyyy'),"+m_stt+")";
					cmd.CommandText = sql;
					cmd.ExecuteNonQuery();
				}
			}
			catch (Exception ex) { upd_error(ex.Message, sComputer, "stttiepdon"); return false; }
			finally {con.Close();con.Dispose();}
			return true;
		}

		private void Play(string num)
		{
			ArrayList m_afile = new ArrayList();
			char num0 = '0', num1 = '0', num2 = '0', num3 = '0';
			num = num.TrimStart("0".ToCharArray());
			bool bChucngantram = bChuctramngan;
			m_afile.Clear();
			int delay = _delay5;
			if (num.Length == 4) { num0 = num[0]; num1 = num[1]; num2 = num[2]; num3 = num[3]; }
			if (num.Length == 3) { num0 = '0'; num1 = num[0]; num2 = num[1]; num3 = num[2]; }
			if (num.Length == 2) { num0 = '0'; num1 = '0'; num2 = num[0]; num3 = num[1]; }
			if (num.Length == 1) { num0 = '0'; num1 = '0'; num2 = '0'; num3 = num[0]; }

			if (!bChucngantram)
			{
				if (num.Length == 4) m_afile.Add("..\\..\\..\\data\\num\\s" + num0.ToString() + ".wav");
				if (num.Length >= 3) m_afile.Add("..\\..\\..\\data\\num\\s" + num1.ToString() + ".wav");
				if (num.Length >= 2) m_afile.Add("..\\..\\..\\data\\num\\s" + num1.ToString() + ".wav");
				if (num.Length >= 1) m_afile.Add("..\\..\\..\\data\\num\\s" + num3.ToString() + ".wav");
			}
			else
			{
				if (num.Length == 4)
				{
					m_afile.Add("..\\..\\..\\data\\num\\s" + num0.ToString() + ".wav");
					m_afile.Add("..\\..\\..\\data\\num\\sg.wav");
				}
				if (num.Length >= 3)
				{
					if (num1 != '0' || num2 != '0' || num3 != '0')
					{
						m_afile.Add("..\\..\\..\\data\\num\\s" + num1.ToString() + ".wav");
						m_afile.Add("..\\..\\..\\data\\num\\sa.wav");
					}
				}
				if (num.Length >= 2)
				{
					if (num2 != '0')
					{
						if (num2 == '1')
						{
							m_afile.Add("..\\..\\..\\data\\num\\sb.wav");
						}
						else
						{
							m_afile.Add("..\\..\\..\\data\\num\\s" + num2.ToString() + ".wav");
							m_afile.Add("..\\..\\..\\data\\num\\sc.wav");
						}
					}
					else
					{
						if (num3 != '0')
						{
							m_afile.Add("..\\..\\..\\data\\num\\sf.wav");
						}
					}
				}
				if (num.Length >= 1)
				{
					if (num3 != '0')
					{
						if (num3 == '1' && num2 > '1')
						{
							m_afile.Add("..\\..\\..\\data\\num\\sd.wav");
						}
						else if (num3 == '5' && num2 != '0')
						{
							m_afile.Add("..\\..\\..\\data\\num\\se.wav");
						}
						else
						{
							m_afile.Add("..\\..\\..\\data\\num\\s" + num3.ToString() + ".wav");
						}
					}
				}
			}
			if (m_afile.Count > 0)
			{
				foreach (string t in m_afile.ToArray())
				{
					System.Threading.Thread.Sleep(delay);
					PlaySound(t, 0, 1);
				}
			}
		}

		public void goi_dangky(string ngay,int id,string s1,string s2,bool update)
		{			
			string s=Hoten_khongdau(sComputer).Trim();
			int d1 = _delay1, d2 = _delay2, d3 = _delay3, d4 = _delay4,d5=_delay6;
			if (s1 == s2)
			{
				PlaySound("..\\..\\..\\data\\lyric\\m4.wav", 0, 1);
				System.Threading.Thread.Sleep(d2);
				Play(s1);
				System.Threading.Thread.Sleep(d4);
				PlaySound("..\\..\\..\\data\\lyric\\m3.wav", 0, 1);
				if (System.IO.File.Exists("..\\..\\..\\data\\td\\" + s + ".wav"))
				{
					System.Threading.Thread.Sleep(d5);
					PlaySound("..\\..\\..\\data\\td\\" + s + ".wav", 0, 1);
				}
			}
			else
			{
				PlaySound("..\\..\\..\\data\\lyric\\m1.wav", 0, 1);
				System.Threading.Thread.Sleep(d1);
				Play(s1);
				System.Threading.Thread.Sleep(d2);
				PlaySound("..\\..\\..\\data\\lyric\\m2.wav", 0, 1);
				System.Threading.Thread.Sleep(d3);
				Play(s2);
				System.Threading.Thread.Sleep(d4);
				PlaySound("..\\..\\..\\data\\lyric\\m3.wav", 0, 1);
				if (System.IO.File.Exists("..\\..\\..\\data\\td\\" +  s + ".wav"))
				{
					System.Threading.Thread.Sleep(d5);
					PlaySound("..\\..\\..\\data\\td\\" +  s + ".wav", 0, 1);
				}
			}
			if (update) upd_stttiepdon(id, ngay, long.Parse(s2));
		}
		public void goi_PhatRaAmThanh()//cao vũ 06/03/2013
		{
			PlaySound("..\\..\\..\\data\\lyric\\ding_dong.wav", 0, 1);
		}
		public void goi_kham(string ngay, string makp, string s1, string s2, bool update)
		{
			int d1 = _delay1, d2 = _delay2, d3 = _delay3, d4 = _delay6,d6=_delay7;
			if (s1 == s2)
			{
				PlaySound("..\\..\\..\\data\\lyric\\m4.wav", 0, 1);
				System.Threading.Thread.Sleep(d2);
				Play(s1);
				System.Threading.Thread.Sleep(d4);
				PlaySound("..\\..\\..\\data\\lyric\\m5.wav", 0, 1);
				if (System.IO.File.Exists("..\\..\\..\\data\\pk\\" + makp + ".wav"))
				{
					System.Threading.Thread.Sleep(d6);
					PlaySound("..\\..\\..\\data\\pk\\" + makp + ".wav", 0, 1);
				}
			}
			else
			{
				PlaySound("..\\..\\..\\data\\lyric\\m1.wav", 0, 1);
				System.Threading.Thread.Sleep(d1);
				Play(s1);
				System.Threading.Thread.Sleep(d2);
				PlaySound("..\\..\\..\\data\\lyric\\m2.wav", 0, 1);
				System.Threading.Thread.Sleep(d3);
				Play(s2);
				System.Threading.Thread.Sleep(d4);
				PlaySound("..\\..\\..\\data\\lyric\\m5.wav", 0, 1);
				if (System.IO.File.Exists("..\\..\\..\\data\\pk\\" + makp + ".wav"))
				{
					System.Threading.Thread.Sleep(d6);
					PlaySound("..\\..\\..\\data\\pk\\" + makp + ".wav", 0, 1);
				}
			}
			if (update) upd_sttkham(makp, ngay, long.Parse(s2));
		}
		public decimal goidangky(string ngay, int id)
		{
			try
			{
				DataTable tmp = get_data("select stt from " + user + mmyy(ngay) + ".stttiepdon where to_char(ngay,'dd/mm/yyyy')='" + ngay + "' and id=" + id).Tables[0];
				if (tmp.Rows.Count > 0) return decimal.Parse(tmp.Rows[0]["stt"].ToString());			
				else return 0;
			}
			catch{return 0;}
		}
		public decimal goikham(string ngay, string makp)
		{
			DataTable tmp = get_data("select stt from " + user + mmyy(ngay) + ".sttkham where to_char(ngay,'dd/mm/yyyy')='" + ngay + "' and makp='" + makp+"'").Tables[0];
			if (tmp.Rows.Count > 0) return decimal.Parse(tmp.Rows[0]["stt"].ToString());
			else return 0;
		}

		
		#region vs Report		

		public bool upd_r_tenobject(long id,decimal stt,string ten,string tt)
		{
			sql="update r_tenobject set stt=:stt,ten=:ten,tt=:tt where id=:id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("stt",OracleType.Number).Value=stt;
				cmd.Parameters.Add("ten",OracleType.VarChar,50).Value=ten;
				cmd.Parameters.Add("tt",OracleType.VarChar,20).Value=tt;
				cmd.Parameters.Add("id",OracleType.Number).Value=id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into r_tenobject(id,stt,ten,tt) values (:id,:stt,:ten,:tt)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("id",OracleType.Number).Value=id;
					cmd.Parameters.Add("stt",OracleType.Number).Value=stt;
					cmd.Parameters.Add("ten",OracleType.VarChar,50).Value=ten;
					cmd.Parameters.Add("tt",OracleType.VarChar,20).Value=tt;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"r_tenobject");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_phanhe(long id,decimal stt,string ten,string sql1)
		{
			sql="update phanhe set stt=:stt,ten=:ten,sql=:sql1 where id=:id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("stt",OracleType.Number).Value=stt;
				cmd.Parameters.Add("ten",OracleType.NVarChar,254).Value=ten;
				cmd.Parameters.Add("sql1",OracleType.VarChar,4000).Value=sql1;
				cmd.Parameters.Add("id",OracleType.Number).Value=id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into phanhe(id,stt,ten,sql) values (:id,:stt,:ten,:sql1)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("id",OracleType.Number).Value=id;
					cmd.Parameters.Add("stt",OracleType.Number).Value=stt;
					cmd.Parameters.Add("ten",OracleType.NVarChar,254).Value=ten;
					cmd.Parameters.Add("sql1",OracleType.VarChar,4000).Value=sql1;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"phanhe");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_r_nhom(long id,long phanhe,decimal stt,string ten)
		{
			sql="update r_nhom set phanhe="+phanhe+",stt=:stt,ten=:ten where id=:id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("stt",OracleType.Number).Value=stt;
				cmd.Parameters.Add("ten",OracleType.NVarChar,254).Value=ten;
				cmd.Parameters.Add("id",OracleType.Number).Value=id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into r_nhom(id,phanhe,stt,ten) values (:id,"+phanhe+",:stt,:ten)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("id",OracleType.Number).Value=id;
					cmd.Parameters.Add("stt",OracleType.Number).Value=stt;
					cmd.Parameters.Add("ten",OracleType.NVarChar,254).Value=ten;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"r_nhom");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_r_listinput(long id,decimal stt,string ten,string diengiai,string caulenh,string format,int tenobj,
			decimal h,decimal w,int kieu,long sql2)
		{
			sql="update r_listinput set stt=:stt,ten=:ten,diengiai=:diengiai,sql=:caulenh,format=:format,tenobj=:tenobj,h="+h+",w="+w+",kieu="+kieu+",sql2="+sql2+" where id=:id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("stt",OracleType.Number).Value=stt;
				cmd.Parameters.Add("ten",OracleType.VarChar,50).Value=ten;
				cmd.Parameters.Add("diengiai",OracleType.NVarChar,254).Value=diengiai;
				cmd.Parameters.Add("caulenh",OracleType.VarChar,4000).Value=caulenh;
				cmd.Parameters.Add("format",OracleType.VarChar,500).Value=format;
				cmd.Parameters.Add("tenobj",OracleType.Number).Value=tenobj;
				cmd.Parameters.Add("id",OracleType.Number).Value=id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into r_listinput(id,stt,ten,diengiai,sql,format,tenobj,h,w,kieu,sql2) values (:id,:stt,:ten,:diengiai,:caulenh,:format,:tenobj,"+h+","+w+","+kieu+","+sql2+")";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("id",OracleType.Number).Value=id;
					cmd.Parameters.Add("stt",OracleType.Number).Value=stt;
					cmd.Parameters.Add("ten",OracleType.VarChar,50).Value=ten;
					cmd.Parameters.Add("diengiai",OracleType.NVarChar,254).Value=diengiai;
					cmd.Parameters.Add("caulenh",OracleType.VarChar,4000).Value=caulenh;
					cmd.Parameters.Add("format",OracleType.VarChar,500).Value=format;
					cmd.Parameters.Add("tenobj",OracleType.Number).Value=tenobj;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"r_listinput");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}
		
		public bool upd_r_dateinput(long id,decimal stt,string ten,string diengiai,string format,int tenobj,decimal h,decimal w)
		{
			sql="update r_dateinput set stt=:stt,ten=:ten,diengiai=:diengiai,format=:format,tenobj=:tenobj,h="+h+",w="+w+" where id=:id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("stt",OracleType.Number).Value=stt;
				cmd.Parameters.Add("ten",OracleType.VarChar,50).Value=ten;
				cmd.Parameters.Add("diengiai",OracleType.NVarChar,254).Value=diengiai;
				cmd.Parameters.Add("format",OracleType.VarChar,500).Value=format;
				cmd.Parameters.Add("tenobj",OracleType.Number).Value=tenobj;
				cmd.Parameters.Add("id",OracleType.Number).Value=id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into r_dateinput(id,stt,ten,diengiai,format,tenobj,h,w) values (:id,:stt,:ten,:diengiai,:format,:tenobj,"+h+","+w+")";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("id",OracleType.Number).Value=id;
					cmd.Parameters.Add("stt",OracleType.Number).Value=stt;
					cmd.Parameters.Add("ten",OracleType.VarChar,50).Value=ten;
					cmd.Parameters.Add("diengiai",OracleType.NVarChar,254).Value=diengiai;
					cmd.Parameters.Add("format",OracleType.VarChar,500).Value=format;
					cmd.Parameters.Add("tenobj",OracleType.Number).Value=tenobj;					
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"r_dateinput");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_r_function(long id,decimal stt,string ma,string ten,string diengiai,string tenfile,int phanhe,int loai,int kieu,string s,
			string f,string w,string caulenh,string g,string o,string dong,string cot,string ailam,int hide,int ketxuat,string sort,
			string sum,string sngay)
		{
			sql="update r_function set stt="+stt+",ma=:ma,ten=:ten,diengiai=:diengiai,tenfile=:tenfile,phanhe="+phanhe+",loai="+loai+",kieu="+kieu;
			sql+=",s=:s,f=:f,w=:w,sql=:caulenh,g=:g,o=:o,dong=:dong,cot=:cot,ailam=:ailam,hide="+hide+",ketxuat="+ketxuat+",sort=:sort,sum=:sum,sngay=:sngay where id="+id;
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("ma",OracleType.VarChar,20).Value=ma;
				cmd.Parameters.Add("ten",OracleType.NVarChar,254).Value=ten;
				cmd.Parameters.Add("diengiai",OracleType.NVarChar,2000).Value=diengiai;
				cmd.Parameters.Add("tenfile",OracleType.VarChar,50).Value=tenfile;
				cmd.Parameters.Add("s",OracleType.VarChar,4000).Value=s;
				cmd.Parameters.Add("f",OracleType.VarChar,4000).Value=f;
				cmd.Parameters.Add("w",OracleType.VarChar,4000).Value=w;
				cmd.Parameters.Add("caulenh",OracleType.VarChar,4000).Value=caulenh;
				cmd.Parameters.Add("g",OracleType.VarChar,4000).Value=g;
				cmd.Parameters.Add("o",OracleType.VarChar,4000).Value=o;
				cmd.Parameters.Add("dong",OracleType.VarChar,4000).Value=dong;
				cmd.Parameters.Add("cot",OracleType.VarChar,4000).Value=cot;
				cmd.Parameters.Add("ailam",OracleType.NVarChar,254).Value=ailam;
				cmd.Parameters.Add("sort",OracleType.VarChar,254).Value=sort;
				cmd.Parameters.Add("sum",OracleType.VarChar,254).Value=sum;
				cmd.Parameters.Add("sngay",OracleType.VarChar,254).Value=sngay;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into r_function(id,stt,ma,ten,diengiai,tenfile,phanhe,loai,kieu,s,f,w,sql,g,o,dong,cot,ailam,hide,ketxuat,sort,sum,sngay) values ("+id+","+stt+",:ma,:ten,:diengiai,:tenfile,"+phanhe+","+loai+","+kieu+",:s,:f,:w,:caulenh,:g,:o,:dong,:cot,:ailam,"+hide+","+ketxuat+",:sort,:sum,:sngay)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("ma",OracleType.VarChar,20).Value=ma;
					cmd.Parameters.Add("ten",OracleType.NVarChar,254).Value=ten;
					cmd.Parameters.Add("diengiai",OracleType.NVarChar,2000).Value=diengiai;
					cmd.Parameters.Add("tenfile",OracleType.VarChar,50).Value=tenfile;
					cmd.Parameters.Add("s",OracleType.VarChar,4000).Value=s;
					cmd.Parameters.Add("f",OracleType.VarChar,4000).Value=f;
					cmd.Parameters.Add("w",OracleType.VarChar,4000).Value=w;
					cmd.Parameters.Add("caulenh",OracleType.VarChar,4000).Value=caulenh;
					cmd.Parameters.Add("g",OracleType.VarChar,4000).Value=g;
					cmd.Parameters.Add("o",OracleType.VarChar,4000).Value=o;
					cmd.Parameters.Add("dong",OracleType.VarChar,4000).Value=dong;
					cmd.Parameters.Add("cot",OracleType.VarChar,4000).Value=cot;
					cmd.Parameters.Add("ailam",OracleType.NVarChar,254).Value=ailam;
					cmd.Parameters.Add("sort",OracleType.VarChar,254).Value=sort;
					cmd.Parameters.Add("sum",OracleType.VarChar,254).Value=sum;
					cmd.Parameters.Add("sngay",OracleType.VarChar,254).Value=sngay;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"r_function");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_r_ftables(long id,long idr,decimal stt,string ten,string viettat)
		{
			sql="update r_ftables set idr="+idr+",stt="+stt+",ten='"+ten+"',viettat='"+viettat+"' where id="+id;
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into r_ftables(id,idr,stt,ten,viettat) values ("+id+","+idr+","+stt+",'"+ten+"','"+viettat+"')";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"r_ftables");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_r_ffields(long id,long idr,decimal stt,string fie,string ten,string diengiai,long idf)
		{
			sql="update r_ffields set idr="+idr+",stt="+stt+",fie='"+fie+"',ten=:ten,diengiai=:diengiai,idf="+idf+" where id="+id;
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("ten",OracleType.VarChar,254).Value=ten;
				cmd.Parameters.Add("diengiai",OracleType.NVarChar,254).Value=diengiai;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into r_ffields(id,idr,stt,fie,ten,diengiai,idf) values ("+id+","+idr+","+stt+",'"+fie+"',:ten,:diengiai,"+idf+")";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("ten",OracleType.VarChar,254).Value=ten;
					cmd.Parameters.Add("diengiai",OracleType.NVarChar,254).Value=diengiai;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"r_ffields");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_r_finputs(long id,long idr,decimal stt,string fie,string ten,string diengiai,long loai,string tenobject)
		{
			sql="update r_finputs set idr="+idr+",stt="+stt+",fie='"+fie+"',ten=:ten,diengiai=:diengiai,loai="+loai+",tenobject='"+tenobject+"' where id="+id;
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("ten",OracleType.VarChar,254).Value=ten;
				cmd.Parameters.Add("diengiai",OracleType.NVarChar,254).Value=diengiai;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into r_finputs(id,idr,stt,fie,ten,diengiai,loai,tenobject) values ("+id+","+idr+","+stt+",'"+fie+"',:ten,:diengiai,"+loai+",'"+tenobject+"')";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("ten",OracleType.VarChar,254).Value=ten;
					cmd.Parameters.Add("diengiai",OracleType.NVarChar,254).Value=diengiai;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"r_finputs");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_r_diengiai(string ma,string ten)
		{
			sql="update r_diengiai set ten=:ten where ma=:ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("ten",OracleType.NVarChar,254).Value=ten;
				cmd.Parameters.Add("ma",OracleType.VarChar,254).Value=ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into r_diengiai(ma,ten) values (:ma,:ten)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("ma",OracleType.VarChar,254).Value=ma;
					cmd.Parameters.Add("ten",OracleType.NVarChar,254).Value=ten;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"r_diengiai");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_r_diengiai(string ma,string ten,decimal w)
		{
			sql="update r_diengiai set ten=:ten,w="+w+" where ma=:ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("ten",OracleType.NVarChar,254).Value=ten;
				cmd.Parameters.Add("ma",OracleType.VarChar,254).Value=ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into r_diengiai(ma,ten,w) values (:ma,:ten,"+w+")";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("ma",OracleType.VarChar,254).Value=ma;
					cmd.Parameters.Add("ten",OracleType.NVarChar,254).Value=ten;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"r_diengiai");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_r_format(string ma,string ten)
		{
			sql="update r_format set ten=:ten where ma=:ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("ten",OracleType.NVarChar,254).Value=ten;
				cmd.Parameters.Add("ma",OracleType.VarChar,254).Value=ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into r_format(ma,ten) values (:ma,:ten)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("ma",OracleType.VarChar,254).Value=ma;
					cmd.Parameters.Add("ten",OracleType.NVarChar,254).Value=ten;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"r_format");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_r_report(decimal id,decimal idf,decimal stt,string ma,string ten,string diengiai,string tenfile,
			int phanhe,int loai,int kieu,string s,string f,string w,string caulenh,string g,string o,string dong,string cot,
			string ailam,int hide,int ketxuat,string sort,string sum,string sngay)
		{
			sql="update r_report set idf="+idf+",stt="+stt+",ma=:ma,ten=:ten,diengiai=:diengiai,tenfile=:tenfile,phanhe="+phanhe+",loai="+loai+",kieu="+kieu;
			sql+=",s=:s,f=:f,w=:w,sql=:caulenh,g=:g,o=:o,dong=:dong,cot=:cot,ailam=:ailam,hide="+hide+",ketxuat="+ketxuat+",sort=:sort,sum=:sum,sngay=:sngay where id="+id;
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("ma",OracleType.NVarChar,50).Value=ma;
				cmd.Parameters.Add("ten",OracleType.NVarChar,254).Value=ten;
				cmd.Parameters.Add("diengiai",OracleType.NVarChar,2000).Value=diengiai;
				cmd.Parameters.Add("tenfile",OracleType.NVarChar,50).Value=tenfile;
				cmd.Parameters.Add("s",OracleType.VarChar,4000).Value=s;
				cmd.Parameters.Add("f",OracleType.VarChar,4000).Value=f;
				cmd.Parameters.Add("w",OracleType.VarChar,4000).Value=w;
				cmd.Parameters.Add("caulenh",OracleType.VarChar,4000).Value=caulenh;
				cmd.Parameters.Add("g",OracleType.VarChar,4000).Value=g;
				cmd.Parameters.Add("o",OracleType.VarChar,4000).Value=o;
				cmd.Parameters.Add("dong",OracleType.VarChar,4000).Value=dong;
				cmd.Parameters.Add("cot",OracleType.VarChar,4000).Value=cot;
				cmd.Parameters.Add("ailam",OracleType.NVarChar,254).Value=ailam;
				cmd.Parameters.Add("sort",OracleType.VarChar,254).Value=sort;
				cmd.Parameters.Add("sum",OracleType.VarChar,254).Value=sum;
				cmd.Parameters.Add("sngay",OracleType.VarChar,254).Value=sngay;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into r_report(id,idf,stt,ma,ten,diengiai,tenfile,phanhe,loai,kieu,s,f,w,sql,g,o,dong,cot,ailam,computer,hide,ketxuat,sort,sum,sngay) values ("+id+","+idf+","+stt+",:ma,:ten,:diengiai,:tenfile,"+phanhe+","+loai+","+kieu+",:s,:f,:w,:caulenh,:g,:o,:dong,:cot,:ailam,'"+sComputer+"',"+hide+","+ketxuat+",:sort,:sum,:sngay)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("ma",OracleType.NVarChar,50).Value=ma;
					cmd.Parameters.Add("ten",OracleType.NVarChar,254).Value=ten;
					cmd.Parameters.Add("diengiai",OracleType.NVarChar,2000).Value=diengiai;
					cmd.Parameters.Add("tenfile",OracleType.NVarChar,50).Value=tenfile;
					cmd.Parameters.Add("s",OracleType.VarChar,4000).Value=s;
					cmd.Parameters.Add("f",OracleType.VarChar,4000).Value=f;
					cmd.Parameters.Add("w",OracleType.VarChar,4000).Value=w;
					cmd.Parameters.Add("caulenh",OracleType.VarChar,4000).Value=caulenh;
					cmd.Parameters.Add("g",OracleType.VarChar,4000).Value=g;
					cmd.Parameters.Add("o",OracleType.VarChar,4000).Value=o;
					cmd.Parameters.Add("dong",OracleType.VarChar,4000).Value=dong;
					cmd.Parameters.Add("cot",OracleType.VarChar,4000).Value=cot;
					cmd.Parameters.Add("ailam",OracleType.NVarChar,254).Value=ailam;
					cmd.Parameters.Add("sort",OracleType.VarChar,254).Value=sort;
					cmd.Parameters.Add("sum",OracleType.VarChar,254).Value=sum;
					cmd.Parameters.Add("sngay",OracleType.VarChar,254).Value=sngay;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"r_report");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_r_tables(decimal id,decimal idr,decimal stt,string ten,string viettat)
		{
			sql="update r_tables set idr="+idr+",stt="+stt+",ten='"+ten+"',viettat='"+viettat+"' where id="+id;
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into r_tables(id,idr,stt,ten,viettat) values ("+id+","+idr+","+stt+",'"+ten+"','"+viettat+"')";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"r_tables");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_r_fields(decimal id,decimal idr,decimal stt,string fie,string ten,string diengiai,decimal idf)
		{
			sql="update r_fields set idr="+idr+",stt="+stt+",fie='"+fie+"',ten=:ten,diengiai=:diengiai,idf="+idf+" where id="+id;
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("ten",OracleType.VarChar,254).Value=ten;
				cmd.Parameters.Add("diengiai",OracleType.NVarChar,254).Value=diengiai;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into r_fields(id,idr,stt,fie,ten,diengiai,idf) values ("+id+","+idr+","+stt+",'"+fie+"',:ten,:diengiai,"+idf+")";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("ten",OracleType.VarChar,254).Value=ten;
					cmd.Parameters.Add("diengiai",OracleType.NVarChar,254).Value=diengiai;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"r_fields");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_r_inputs(decimal id,decimal idr,decimal stt,string fie,string ten,string diengiai,long loai,string tenobject)
		{
			sql="update r_inputs set idr="+idr+",stt="+stt+",fie='"+fie+"',ten=:ten,diengiai=:diengiai,loai="+loai+",tenobject='"+tenobject+"' where id="+id;
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("ten",OracleType.VarChar,254).Value=ten;
				cmd.Parameters.Add("diengiai",OracleType.NVarChar,254).Value=diengiai;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into r_inputs(id,idr,stt,fie,ten,diengiai,loai,tenobject) values ("+id+","+idr+","+stt+",'"+fie+"',:ten,:diengiai,"+loai+",'"+tenobject+"')";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("ten",OracleType.VarChar,254).Value=ten;
					cmd.Parameters.Add("diengiai",OracleType.NVarChar,254).Value=diengiai;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"r_inputs");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_login(long id,string hoten,string userid,string password_,string nhom,string makho,
			string madoituong,string makp,string loai,int admin,int tao,int thuhoi)
		{
			sql="update login set hoten=:hoten,userid=:userid,password_=:password_,nhom=:nhom,makho=:makho,";
			sql+="madoituong=:madoituong,makp=:makp,loai=:loai,admin="+admin+",tao="+tao+",thuhoi="+thuhoi;
			sql+=" where id="+id;
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("hoten",OracleType.NVarChar,100).Value=hoten;
				cmd.Parameters.Add("userid",OracleType.VarChar,20).Value=userid;
				cmd.Parameters.Add("password_",OracleType.VarChar,20).Value=password_;
				cmd.Parameters.Add("nhom",OracleType.VarChar,254).Value=nhom;
				cmd.Parameters.Add("makho",OracleType.VarChar,254).Value=makho;
				cmd.Parameters.Add("madoituong",OracleType.VarChar,254).Value=madoituong;
				cmd.Parameters.Add("makp",OracleType.VarChar,254).Value=makp;
				cmd.Parameters.Add("loai",OracleType.VarChar,254).Value=loai;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into login(id,hoten,userid,password_,nhom,makho,madoituong,makp,loai,admin,tao,thuhoi) values ("+id+",:hoten,:userid,:password_,:nhom,:makho,:madoituong,:makp,:loai,"+admin+","+tao+","+thuhoi+")";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("hoten",OracleType.NVarChar,100).Value=hoten;
					cmd.Parameters.Add("userid",OracleType.VarChar,20).Value=userid;
					cmd.Parameters.Add("password_",OracleType.VarChar,20).Value=password_;
					cmd.Parameters.Add("nhom",OracleType.VarChar,254).Value=nhom;
					cmd.Parameters.Add("makho",OracleType.VarChar,254).Value=makho;
					cmd.Parameters.Add("madoituong",OracleType.VarChar,254).Value=madoituong;
					cmd.Parameters.Add("makp",OracleType.VarChar,254).Value=makp;
					cmd.Parameters.Add("loai",OracleType.VarChar,254).Value=loai;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"login");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_right(long id,long phanhe,string right_)
		{
			sql="update right set right_=:right_ where id="+id+" and phanhe="+phanhe;
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("right_",OracleType.VarChar,4000).Value=right_;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into right(id,phanhe,right_) values ("+id+","+phanhe+",:right_)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("right_",OracleType.VarChar,4000).Value=right_;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"right");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_menubar(long id,int phanhe,decimal stt,int loai,string ten)
		{
			sql="update menubar set phanhe="+phanhe+",stt="+stt+",loai="+loai+",ten=:ten where id="+id;
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("ten",OracleType.NVarChar,254).Value=ten;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into menubar(id,phanhe,stt,loai,ten) values ("+id+","+phanhe+","+stt+","+loai+",:ten)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("ten",OracleType.NVarChar,254).Value=ten;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"menubar");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_menuloai(long id,int phanhe,decimal stt,string ten)
		{
			sql="update menuloai set phanhe="+phanhe+",stt="+stt+",ten=:ten where id="+id;
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("ten",OracleType.NVarChar,254).Value=ten;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into menuloai(id,phanhe,stt,ten) values ("+id+","+phanhe+","+stt+",:ten)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("ten",OracleType.NVarChar,254).Value=ten;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"menuloai");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		#endregion

		public bool upd_dmthe(string sothe,string mathe,string madt,string makcb,string hoten,string namsinh,
			int gioitinh,string diachi,string matt,string maqu,string maphuongxa,string cholam,string tungay,
			string denngay,string mabv,int madoituong,string quanhe,string hotenqh)
		{
			sql="update dmthe set mathe=:mathe,madt=:madt,makcb=:makcb,hoten=:hoten,namsinh=:namsinh,";
			sql+="gioitinh="+gioitinh+",diachi=:diachi,matt=:matt,maqu=:maqu,maphuongxa=:maphuongxa,cholam=:cholam";
			if (tungay!="") sql+=",tungay=to_date(:tungay,'dd/mm/yyyy')";
			if (denngay!="") sql+=",denngay=to_date(:denngay,'dd/mm/yyyy')";
			sql+=",mabv=:mabv,madoituong="+madoituong+",quanhe=:quanhe,hotenqh=:hotenqh";
			sql+=" where sothe=:sothe";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("mathe",OracleType.VarChar,13).Value=mathe;
				cmd.Parameters.Add("madt",OracleType.VarChar,2).Value=madt;
				cmd.Parameters.Add("makcb",OracleType.VarChar,5).Value=makcb;
				cmd.Parameters.Add("hoten",OracleType.NVarChar,70).Value=hoten;
				cmd.Parameters.Add("namsinh",OracleType.VarChar,4).Value=namsinh;
				cmd.Parameters.Add("diachi",OracleType.NVarChar,150).Value=diachi;
				cmd.Parameters.Add("matt",OracleType.VarChar,3).Value=matt;
				cmd.Parameters.Add("maqu",OracleType.VarChar,5).Value=maqu;
				cmd.Parameters.Add("maphuongxa",OracleType.VarChar,7).Value=maphuongxa;
				cmd.Parameters.Add("cholam",OracleType.NVarChar,150).Value=cholam;
				if (tungay!="") cmd.Parameters.Add("tungay",OracleType.VarChar,10).Value=tungay;
				if (denngay!="") cmd.Parameters.Add("denngay",OracleType.VarChar,10).Value=denngay;
				cmd.Parameters.Add("mabv",OracleType.VarChar,8).Value=mabv;
				cmd.Parameters.Add("quanhe",OracleType.NVarChar,50).Value=quanhe;
				cmd.Parameters.Add("hotenqh",OracleType.NVarChar,100).Value=hotenqh;
				cmd.Parameters.Add("sothe",OracleType.VarChar,20).Value=sothe;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into dmthe(sothe,mathe,madt,makcb,hoten,namsinh,gioitinh,diachi,matt,maqu,maphuongxa,cholam";
					if (tungay!="") sql+=",tungay";
					if (denngay!="") sql+=",denngay";
					sql+=",mabv,madoituong,quanhe,hotenqh) values (:sothe,:mathe,:madt,:makcb,:hoten,:namsinh,"+gioitinh+",:diachi,:matt,:maqu,:maphuongxa,:cholam";
					if (tungay!="") sql+=",to_date(:tungay,'dd/mm/yyyy')";
					if (denngay!="") sql+=",to_date(:denngay,'dd/mm/yyyy')";
					sql+=",:mabv,"+madoituong+",:quanhe,:hotenqh)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("sothe",OracleType.VarChar,20).Value=sothe;
					cmd.Parameters.Add("mathe",OracleType.VarChar,13).Value=mathe;
					cmd.Parameters.Add("madt",OracleType.VarChar,2).Value=madt;
					cmd.Parameters.Add("makcb",OracleType.VarChar,5).Value=makcb;
					cmd.Parameters.Add("hoten",OracleType.NVarChar,70).Value=hoten;
					cmd.Parameters.Add("namsinh",OracleType.VarChar,4).Value=namsinh;
					cmd.Parameters.Add("diachi",OracleType.NVarChar,150).Value=diachi;
					cmd.Parameters.Add("matt",OracleType.VarChar,3).Value=matt;
					cmd.Parameters.Add("maqu",OracleType.VarChar,5).Value=maqu;
					cmd.Parameters.Add("maphuongxa",OracleType.VarChar,7).Value=maphuongxa;
					cmd.Parameters.Add("cholam",OracleType.NVarChar,150).Value=cholam;
					if (tungay!="") cmd.Parameters.Add("tungay",OracleType.VarChar,10).Value=tungay;
					if (denngay!="") cmd.Parameters.Add("denngay",OracleType.VarChar,10).Value=denngay;
					cmd.Parameters.Add("mabv",OracleType.VarChar,8).Value=mabv;
					cmd.Parameters.Add("quanhe",OracleType.NVarChar,50).Value=quanhe;
					cmd.Parameters.Add("hotenqh",OracleType.NVarChar,100).Value=hotenqh;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,sothe);
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_dmthe(string mabn,string sothe,string hoten,string namsinh,
			int gioitinh,string diachi,string matt,string maqu,string maphuongxa,string cholam,string tungay,string denngay,string mabv)
		{
			sql="update dmthe set mabn=:mabn,hoten=:hoten,namsinh=:namsinh,";
			sql+="gioitinh="+gioitinh+",diachi=:diachi,matt=:matt,maqu=:maqu,maphuongxa=:maphuongxa,cholam=:cholam";
			if (tungay!="") sql+=",tungay=to_date(:tungay,'dd/mm/yyyy')";
			if (denngay!="") sql+=",denngay=to_date(:denngay,'dd/mm/yyyy')";
			sql+=" ,mabv=:mabv where sothe=:sothe";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("mabn",OracleType.VarChar,8).Value=mabn;
				cmd.Parameters.Add("hoten",OracleType.NVarChar,70).Value=hoten;
				cmd.Parameters.Add("namsinh",OracleType.VarChar,4).Value=namsinh;
				cmd.Parameters.Add("diachi",OracleType.NVarChar,150).Value=diachi;
				cmd.Parameters.Add("matt",OracleType.VarChar,3).Value=matt;
				cmd.Parameters.Add("maqu",OracleType.VarChar,5).Value=maqu;
				cmd.Parameters.Add("maphuongxa",OracleType.VarChar,7).Value=maphuongxa;
				cmd.Parameters.Add("cholam",OracleType.NVarChar,150).Value=cholam;
				if (tungay!="") cmd.Parameters.Add("tungay",OracleType.VarChar,10).Value=tungay;
				if (denngay!="") cmd.Parameters.Add("denngay",OracleType.VarChar,10).Value=denngay;
				cmd.Parameters.Add("mabv",OracleType.VarChar,8).Value=mabv;
				cmd.Parameters.Add("sothe",OracleType.VarChar,20).Value=sothe;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into dmthe(mabn,sothe,hoten,namsinh,gioitinh,diachi,matt,maqu,maphuongxa,cholam";
					if (tungay!="") sql+=",tungay";
					if (denngay!="") sql+=",denngay";
					sql+=",mabv) values (:mabn,:sothe,:hoten,:namsinh,"+gioitinh+",:diachi,:matt,:maqu,:maphuongxa,:cholam";
					if (tungay!="") sql+=",to_date(:tungay,'dd/mm/yyyy')";
					if (denngay!="") sql+=",to_date(:denngay,'dd/mm/yyyy')";
					sql+=",:mabv)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("mabn",OracleType.VarChar,8).Value=mabn;
					cmd.Parameters.Add("sothe",OracleType.VarChar,20).Value=sothe;					
					cmd.Parameters.Add("hoten",OracleType.NVarChar,70).Value=hoten;
					cmd.Parameters.Add("namsinh",OracleType.VarChar,4).Value=namsinh;
					cmd.Parameters.Add("diachi",OracleType.NVarChar,150).Value=diachi;
					cmd.Parameters.Add("matt",OracleType.VarChar,3).Value=matt;
					cmd.Parameters.Add("maqu",OracleType.VarChar,5).Value=maqu;
					cmd.Parameters.Add("maphuongxa",OracleType.VarChar,7).Value=maphuongxa;
					cmd.Parameters.Add("cholam",OracleType.NVarChar,150).Value=cholam;
					if (tungay!="") cmd.Parameters.Add("tungay",OracleType.VarChar,10).Value=tungay;
					if (denngay!="") cmd.Parameters.Add("denngay",OracleType.VarChar,10).Value=denngay;
					cmd.Parameters.Add("mabv",OracleType.VarChar,8).Value=mabv;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"dmthe");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_dmloaithe(string ma,string ten,int nhom,int thu20)
		{
			sql="update dmloaithe set ten=:ten,nhom="+nhom+",thu20="+thu20+" where ma=:ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("ten",OracleType.NVarChar,254).Value=ten;
				cmd.Parameters.Add("ma",OracleType.VarChar,2).Value=ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into dmloaithe(ma,ten,nhom,thu20) values (:ma,:ten,"+nhom+","+thu20+")";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("ma",OracleType.VarChar,2).Value=ma;
					cmd.Parameters.Add("ten",OracleType.NVarChar,254).Value=ten;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"dmloaithe");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public DataSet getdmthe(string mabn,string sothe,string ngayvao)
		{
			sql="select a.mabn,a.sothe,a.hoten,a.namsinh,a.gioitinh,a.diachi,a.matt,a.maqu,a.maphuongxa,a.cholam,to_char(a.tungay,'dd/mm/yyyy') as tungay,to_char(a.denngay,'dd/mm/yyyy') as denngay,a.mabv,b.tenbv,a.madoituong,a.quanhe,a.hotenqh from dmthe a,dmnoicapbhyt b where a.mabv=b.mabv(+) and a.sudung=1";
			sql+=" and to_date(a.denngay,'dd/mm/yy')>=to_date('"+ngayvao.Substring(0,10)+"','dd/mm/yy')";
			if (mabn!="") sql+=" and a.mabn='"+mabn+"'";
			if (sothe!="") sql+=" and a.sothe like '%"+sothe+"%'";
			return get_data(sql);
		}

		public void upd_hen(string ngay)
		{
			if (bMmyy(mmyy(ngay)))
			{
				string xxx=user+mmyy(ngay);
				sql = "select a.*,to_char(a.ngay,'dd/mm/yyyy hh24:mi') as ngayvao,nvl(b.sothe,' ') as sothe,";
				sql += "to_char(b.tungay,'dd/mm/yyyy') as tungay,to_char(b.denngay,'dd/mm/yyyy') as denngay,b.mabv,";
				sql += " nvl(b.maphu,0) as maphu,c.sonha,c.thon,c.cholam,c.matt,c.maqu,c.maphuongxa,c.soluutru,c.honnhan,c.mabs,b.traituyen ";
				sql += " from tiepdon a left join bhyt b on a.maql=b.maql ";
				sql += " left join lienhe c on a.maql=c.maql ";
				sql += " where to_char(a.ngay,'dd/mm/yyyy')='" + ngay.Substring(0,10) + "' order by a.maql";
				foreach (DataRow r in get_data(sql).Tables[0].Rows)
				{
					upd_tiepdon_mmyy(r["mabn"].ToString(),long.Parse(r["maql"].ToString()),
						r["makp"].ToString(), r["ngayvao"].ToString(), int.Parse(r["madoituong"].ToString()), r["sovaovien"].ToString(),
						r["tuoivao"].ToString(), int.Parse(r["bnmoi"].ToString()),int.Parse(r["userid"].ToString()), int.Parse(r["noitiepdon"].ToString()), int.Parse(r["loai"].ToString()), long.Parse(r["mavaovien"].ToString()));
					if (r["sothe"].ToString().Trim() != "")
						upd_bhyt(r["ngayvao"].ToString(), r["mabn"].ToString(), long.Parse(r["maql"].ToString()), r["sothe"].ToString(), r["denngay"].ToString(), r["mabv"].ToString(), int.Parse(r["maphu"].ToString()), r["tungay"].ToString(),int.Parse(r["traituyen"].ToString()));
					upd_lienhe(r["ngayvao"].ToString(), long.Parse(r["maql"].ToString()), r["sonha"].ToString(), r["thon"].ToString(), r["cholam"].ToString(),
						r["matt"].ToString(), r["maqu"].ToString(), r["maphuongxa"].ToString(), r["tuoivao"].ToString(), int.Parse(r["loai"].ToString()), int.Parse(r["bnmoi"].ToString()));
					execute_data("delete from tiepdon where maql=" + long.Parse(r["maql"].ToString()));
					if (r["sothe"].ToString().Trim()!="")
						execute_data("delete from bhyt where maql=" + long.Parse(r["maql"].ToString()));
					execute_data("delete from lienhe where maql=" + long.Parse(r["maql"].ToString()));
				}
				execute_data("insert into "+xxx+".sttchitiet select * from sttchitiet where to_char(ngay,'dd/mm/yyyy')='"+ngay.Substring(0,10)+"'");				
				execute_data("delete from sttchitiet where to_char(ngay,'dd/mm/yyyy')='"+ngay.Substring(0,10)+"'");
				execute_data("insert into "+xxx+".sttkham select * from sttkham where to_char(ngay,'dd/mm/yyyy')='"+ngay.Substring(0,10)+"'");				
				execute_data("delete from sttkham where to_char(ngay,'dd/mm/yyyy')='"+ngay.Substring(0,10)+"'");
				execute_data("insert into "+xxx+".sttngay select * from sttngay where to_char(ngay,'dd/mm/yyyy')='"+ngay.Substring(0,10)+"'");				
				execute_data("delete from sttngay where to_char(ngay,'dd/mm/yyyy')='"+ngay.Substring(0,10)+"'");
			}
		}

		public long get_sokham_hen(string m_ngay,string m_makp,int m_sokham)
		{
			try
			{
				sql="select max(to_number(sovaovien)) from tiepdon where to_char(ngay,'dd/mm/yyyy')='"+m_ngay+"'";
				if (m_sokham==2) sql+=" and makp='"+m_makp+"'";
				ds=get_data(sql);
				if (ds.Tables[0].Rows.Count==0) return 1;
				else
				{
					try
					{
						return long.Parse(ds.Tables[0].Rows[0][0].ToString())+1;
					}
					catch{return 1;}
				}
			}
			catch{return 1;}
		}

		public bool upd_tainangt(long maql,string sophieu,string ngay,int socap,string ptvv,string pttn,int ptgaytn,
			string ptgaykhac,int mubaohiem,int gaiquai,int bivo,string loaimu,int ruoubia,int camquan,int mau,int hoitho,
			int sonao,int glassgow,int cotsongco,int thuongkhac,int nhapvien,int mocapcuu,int tuvong,int xinve,string mabv,
			string manv)
		{
			sql="update tainangt set sophieu=:sophieu,ngay=to_date(:ngay,'dd/mm/yyyy hh24:mi'),socap="+socap;
			sql+=",ptvv=:ptvv,pttn=:pttn,ptgaytn="+ptgaytn+",ptgaykhac=:ptgaykhac,mubaohiem="+mubaohiem;
			sql+=",gaiquai="+gaiquai+",bivo="+bivo+",loaimu=:loaimu,ruoubia="+ruoubia+",camquan="+camquan+",mau="+mau;
			sql+=",hoitho="+hoitho+",sonao="+sonao+",glassgow="+glassgow+",cotsongco="+cotsongco+",thuongkhac="+thuongkhac;
			sql+=",nhapvien="+nhapvien+",mocapcuu="+mocapcuu+",tuvong="+tuvong+",xinve="+xinve+",mabv=:mabv,manv=:manv";
			sql+=" where maql="+maql;
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("sophieu",OracleType.VarChar,10).Value=sophieu;
				cmd.Parameters.Add("ngay",OracleType.VarChar,16).Value=ngay;
				cmd.Parameters.Add("ptvv",OracleType.NVarChar,254).Value=ptvv;
				cmd.Parameters.Add("pttn",OracleType.NVarChar,254).Value=pttn;
				cmd.Parameters.Add("ptgaykhac",OracleType.NVarChar,254).Value=ptgaykhac;
				cmd.Parameters.Add("loaimu",OracleType.NVarChar,254).Value=loaimu;
				cmd.Parameters.Add("mabv",OracleType.VarChar,8).Value=mabv;
				cmd.Parameters.Add("manv",OracleType.VarChar,4).Value=manv;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into tainangt(maql,sophieu,ngay,socap,ptvv,pttn,ptgaytn,ptgaykhac,mubaohiem,gaiquai,bivo,loaimu,";
					sql+="ruoubia,camquan,mau,hoitho,sonao,glassgow,cotsongco,thuongkhac,nhapvien,mocapcuu,tuvong,xinve,mabv,manv)";
					sql+=" values ";
					sql+="("+maql+",:sophieu,to_date(:ngay,'dd/mm/yyyy hh24:mi'),"+socap+",:ptvv,:pttn,"+ptgaytn+",:ptgaykhac,"+mubaohiem+","+gaiquai+","+bivo+",:loaimu,";
					sql+=ruoubia+","+camquan+","+mau+","+hoitho+","+sonao+","+glassgow+","+cotsongco+","+thuongkhac+","+nhapvien+","+mocapcuu+","+tuvong+","+xinve+",:mabv,:manv)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("sophieu",OracleType.VarChar,10).Value=sophieu;
					cmd.Parameters.Add("ngay",OracleType.VarChar,16).Value=ngay;
					cmd.Parameters.Add("ptvv",OracleType.NVarChar,254).Value=ptvv;
					cmd.Parameters.Add("pttn",OracleType.NVarChar,254).Value=pttn;
					cmd.Parameters.Add("ptgaykhac",OracleType.NVarChar,254).Value=ptgaykhac;
					cmd.Parameters.Add("loaimu",OracleType.NVarChar,254).Value=loaimu;
					cmd.Parameters.Add("mabv",OracleType.VarChar,8).Value=mabv;
					cmd.Parameters.Add("manv",OracleType.VarChar,4).Value=manv;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"tainangt");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_benhmantinh(string m_mabn,string m_chandoan,string m_maicd,string m_ghichu,int m_userid)
		{
			sql = "update " + user + ".benhmantinh set chandoan=:m_chandoan,ghichu=:m_ghichu";
			sql+=" where mabn='" + m_mabn+"' and maicd='"+m_maicd+"'";
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd = new OracleCommand(sql, con);
				cmd.CommandType = CommandType.Text;
				cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,254).Value=m_chandoan;
				cmd.Parameters.Add("m_ghichu",OracleType.NVarChar,2000).Value=m_ghichu;
				int irec = cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec == 0)
				{
					sql = "insert into " + user + ".benhmantinh(mabn,chandoan,maicd,ghichu,userid) ";
					sql += " values ('" + m_mabn + "',:m_chandoan,'" + m_maicd + "',:m_ghichu," + m_userid + ")";
					cmd = new OracleCommand(sql, con);
					cmd.CommandType = CommandType.Text;
					cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,254).Value=m_chandoan;
					cmd.Parameters.Add("m_ghichu",OracleType.NVarChar,2000).Value=m_ghichu;
					irec = cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch (OracleException ex)
			{
				upd_error(ex.Message, sComputer, "benhmantinh");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool kiemtra_ba_namsinh(int maba,string namsinh)
		{
			bool ret=true;
			DataTable dt=get_data("select * from dmbenhan where maba="+maba).Tables[0];
			decimal tu=0,den=0;
			int tuoi=int.Parse(ngayhienhanh_server.Substring(6,4))-int.Parse(namsinh);
			if (dt.Rows.Count>0)
			{
				tu=decimal.Parse(dt.Rows[0]["tu"].ToString());
				den=decimal.Parse(dt.Rows[0]["den"].ToString());
				if (tu==0 && den!=0) ret=tuoi<den;
				else if (tu!=0 && den==0) ret=tuoi>tu;
				else if (tu!=0 && den!=0) ret=tuoi>tu && tuoi<den;
			}
			return ret;
		}

		public string field_gia(int madoituong)
		{
			string f1="gia_th",f2="vattu_th";
			DataTable dtdt=get_data("select * from doituong").Tables[0];
			DataRow r=getrowbyid(dtdt,"madoituong="+madoituong);
			if (r!=null)
			{
				f1="gia_"+r["field_gia"].ToString().Substring(4);
				f2="vattu_"+r["field_gia"].ToString().Substring(4);
			}
			return f1+"^"+f2;
		}

		public string getPathTemp
		{
			get
			{
				return System.IO.Path.GetTempPath();
			}
		}

		public void delFileTemp()
		{
			string[] files = System.IO.Directory.GetFiles(getPathTemp);
			for (int i = 0; i < files.GetLength(0); i++)
			{
				if (files[i].ToString().ToLower().IndexOf(".rpt") != -1 || files[i].ToString().ToLower().IndexOf(".tmp") != -1)
				{
					try
					{
						System.IO.File.Delete(files[i].ToString());
					}
					catch { }
				}
			}
		}

		public bool upd_datkham(string m_mabn,string m_ngay,string m_dienthoai,string m_didong,
			string m_kham,string m_ghichu,string m_mabs,int m_userid)
		{
			sql="update datkham set dienthoai=:m_dienthoai,didong=:m_didong,kham=:m_kham,ghichu=:m_ghichu,mabs=:m_mabs,userid=:m_userid where mabn=:m_mabn and to_char(ngay,'dd/mm/yyyy hh24:mi')=:m_ngay";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_dienthoai",OracleType.VarChar,30).Value=m_dienthoai;
				cmd.Parameters.Add("m_didong",OracleType.VarChar,20).Value=m_didong;
				cmd.Parameters.Add("m_kham",OracleType.NVarChar,254).Value=m_kham;
				cmd.Parameters.Add("m_ghichu",OracleType.NVarChar,500).Value=m_ghichu;
				cmd.Parameters.Add("m_mabs",OracleType.VarChar,4).Value=m_mabs;
				cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
				cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
				cmd.Parameters.Add("m_ngay",OracleType.VarChar,16).Value=m_ngay;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into datkham (mabn,ngay,dienthoai,didong,kham,ghichu,mabs,userid) values (:m_mabn,to_date(:m_ngay,'dd/mm/yyyy hh24:mi'),:m_dienthoai,:m_didong,:m_kham,:m_ghichu,:m_mabs,:m_userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
					cmd.Parameters.Add("m_ngay",OracleType.VarChar,16).Value=m_ngay;
					cmd.Parameters.Add("m_dienthoai",OracleType.VarChar,30).Value=m_dienthoai;
					cmd.Parameters.Add("m_didong",OracleType.VarChar,20).Value=m_didong;
					cmd.Parameters.Add("m_kham",OracleType.NVarChar,254).Value=m_kham;
					cmd.Parameters.Add("m_ghichu",OracleType.NVarChar,500).Value=m_ghichu;
					cmd.Parameters.Add("m_mabs",OracleType.VarChar,4).Value=m_mabs;
					cmd.Parameters.Add("m_userid",OracleType.Number).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"datkham");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_datkham(string m_mabn,string m_ngay,string m_den)
		{
			sql="update datkham set den=to_date(:m_den,'dd/mm/yyyy hh24:mi') where mabn=:m_mabn and to_char(ngay,'dd/mm/yyyy hh24:mi')=:m_ngay";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_den",OracleType.NVarChar,16).Value=m_den;
				cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
				cmd.Parameters.Add("m_ngay",OracleType.VarChar,16).Value=m_ngay;
				cmd.ExecuteNonQuery();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"datkham");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}
		public bool upd_trieuchung(string ngay, long m_maql, string m_ten)
		{
			sql = "update " + user + mmyy(ngay) + ".trieuchung set ten=:m_ten where maql=:m_maql";
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd = new OracleCommand(sql, con);
				cmd.CommandType = CommandType.Text;
				cmd.Parameters.Add("m_ten", OracleType.NVarChar,500).Value = m_ten;
				cmd.Parameters.Add("m_maql", OracleType.Number).Value = m_maql;
				int irec = cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec == 0)
				{
					sql = "insert into " + user + mmyy(ngay) + ".trieuchung(maql,ten) values ";
					sql += "(:m_maql,:m_ten)";
					cmd = new OracleCommand(sql, con);
					cmd.CommandType = CommandType.Text;
					cmd.Parameters.Add("m_maql", OracleType.Number).Value = m_maql;
					cmd.Parameters.Add("m_ten", OracleType.NVarChar,500).Value = m_ten;					
					irec = cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch (OracleException ex)
			{
				upd_error(ex.Message, sComputer, "trieuchung");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}
			return true;
		}

		public string get_trieuchung(string ngay, long maql)
		{
			ds = get_data("select ten from " + user + mmyy(ngay) + ".trieuchung where maql=" + maql);
			if (ds.Tables[0].Rows.Count > 0) return ds.Tables[0].Rows[0]["ten"].ToString();
			else return "";
		}

		public bool upd_dmtkbn(long m_id,string m_mabn,string m_sotk,string m_ngay,decimal m_sotien,int m_userid)
		{
			sql="update dmtkbn set mabn='"+m_mabn+"',sotk='"+m_sotk+"',ngay=to_date('"+m_ngay+"','dd/mm/yyyy hh24:mi'),sotien="+m_sotien+",userid="+m_userid+" where id="+m_id;
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into dmtkbn (id,mabn,sotk,ngay,sotien,userid) values ("+m_id+",'"+m_mabn+"','"+m_sotk+"',to_date('"+m_ngay+"','dd/mm/yyyy hh24:mi'),"+m_sotien+","+m_userid+")";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"dmtkbn");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_dmtkbnct(long m_id,long m_idtk,int m_loaibn,string m_ngay,string m_mmyy,string m_tables,
			long m_idct,long m_stt,decimal m_sotien)
		{
			sql="update dmtkbnct set idtk="+m_idtk+",loaibn="+m_loaibn+",ngay=to_date('"+m_ngay+"','dd/mm/yyyy'),";
			sql+="mmyy='"+m_mmyy+"',tables='"+m_tables+"',idct="+m_idct+",stt="+m_stt+",sotien="+m_sotien+" where id="+m_id;
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into dmtkbnct (id,idtk,loaibn,ngay,mmyy,tables,idct,stt,sotien) ";
					sql+=" values ("+m_id+","+m_idtk+","+m_loaibn+",to_date('"+m_ngay+"','dd/mm/yyyy'),'"+m_mmyy+"','"+m_tables+"',"+m_idct+","+m_stt+","+m_sotien+")";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"dmtkbnct");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public decimal get_dmtkbn(string m_mabn)
		{
			decimal ret=0;
			foreach(DataRow r in get_data("select tamung-sotien+thuathieu as conlai from dmtkbn where mabn='"+m_mabn+"'").Tables[0].Rows)
				ret+=decimal.Parse(r["conlai"].ToString());
			return ret;
		}

		public bool dmtkbn(string m_mabn)
		{
			return get_data("select * from dmtkbn where mabn='"+m_mabn+"' and done=1").Tables[0].Rows.Count>0;
		}

		public long get_id_dmtkbn(string m_mabn,string m_ngay)
		{
			sql="select id from dmtkbn where mabn='"+m_mabn+"' and to_char(ngay,'dd/mm/yyyy hh24:mi')='"+m_ngay+"'";
			ds=get_data(sql);
			long id=(ds.Tables[0].Rows.Count==0)?0:long.Parse(ds.Tables[0].Rows[0][0].ToString());
			if (id==0) id=getidyymmddhhmiss_stt_computer;
			return id;
		}

		public bool bMahoamatkhau
		{
			get
			{
				return get_data("select ten from thongso where id=-13").Tables[0].Rows.Count>0;
			}
		}

		public bool bMahoamatkhau_v
		{
			get
			{
				return get_data("select ten from v_thongso where id=-13").Tables[0].Rows.Count>0;
			}
		}
		public bool bMahoamatkhau_d
		{
			get
			{
				return get_data("select ten from d_thongso where id=-13").Tables[0].Rows.Count>0;
			}
		}
		public string encode(string s)
		{
			string s1="";
			char c;
			byte b;
			s=s.Trim();
			for(int i=0;i<s.Length;i++)
			{
				c=Convert.ToChar(s.Substring(i,1).ToUpper());
				b=(byte)(c);
				s1=s1+Convert.ToChar((b%2==0)?b+128:b+96);
			}
			return s1;
		}

		public string decode(string s)
		{
			string s1="";
			char c;
			byte b;
			s=s.Trim();
			for(int i=0;i<s.Length;i++)
			{
//				c=s[i];// Convert.ToChar(s.Substring(i,1));
//				b=(byte)(c);
//				s1=s1+Convert.ToChar((b%2==0)?b-128:b-96);
				c = s[i];// Convert.ToChar(s.Substring(i,1));
				b = (byte)(c);
				int so = (b % 2 == 0) ? b - 128 : b - 96;
				string t = Convert.ToChar(so).ToString();
				s1 = s1 + t;
			}
			return s1;
		}

		public bool upd_m_menuitem(string id, string id_menu, string id_goc, decimal stt, string ten)
		{
			sql = "update " + user + ".m_menuitem set id_menu=:id_menu,id_goc=:id_goc, stt=:stt,ten=:ten where id=:id ";
			con = new OracleConnection(sConn);
			try
			{
				try
				{
					con.Open();
					cmd = new OracleCommand(sql, con);
					cmd.CommandType = CommandType.Text;
					cmd.Parameters.Add("id", OracleType.VarChar,5).Value = id;
					cmd.Parameters.Add("id_menu", OracleType.VarChar,5).Value = id_menu;
					cmd.Parameters.Add("id_goc", OracleType.VarChar,5).Value = id_goc;
					cmd.Parameters.Add("stt", OracleType.Number).Value = stt;
					cmd.Parameters.Add("ten", OracleType.NVarChar,500).Value = ten;
					int num = cmd.ExecuteNonQuery();
					cmd.Dispose();
					if (num == 0)
					{
						sql = "insert into " + user + ".m_menuitem(id,id_menu,id_goc,stt,ten) values (:id,:id_menu,:id_goc,:stt,:ten)";
						cmd = new OracleCommand(sql, con);
						cmd.CommandType = CommandType.Text;
						cmd.Parameters.Add("id", OracleType.VarChar,5).Value = id;
						cmd.Parameters.Add("id_menu", OracleType.VarChar,5).Value = id_menu;
						cmd.Parameters.Add("id_goc", OracleType.VarChar,5).Value = id_goc;
						cmd.Parameters.Add("stt", OracleType.Number).Value = stt;
						cmd.Parameters.Add("ten", OracleType.NVarChar,500).Value = ten;
						num = cmd.ExecuteNonQuery();
						cmd.Dispose();
					}
				}
				catch (OracleException exception)
				{
					upd_error(exception.Message, sComputer, "m_menuitem");
					return false;
				}
			}
			finally
			{
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_sokhamthai(string m_ngay, string m_mabn, long m_mavaovien, decimal m_cao, string m_para, string m_dacdiem, decimal m_chuky,
			int m_tinhchat, int m_luongkinh, decimal m_songay, string m_vat1, string m_vat2, string m_tiensu, string m_ngaykc, string m_ngaydd,decimal lan, int m_userid)
		{
			sql = "update " + user + mmyy(m_ngay) + ".sokhamthai set mabn=:m_mabn,cao=:m_cao,para=:m_para,dacdiem=:m_dacdiem,";
			sql += "chuky=:m_chuky,tinhchat=:m_tinhchat,luongkinh=:m_luongkinh,songay=:m_songay,vat1=:m_vat1,vat2=:m_vat2,";
			sql += "tiensu=:m_tiensu,";
			if (m_ngaykc != "") sql += "ngaykc=to_date(:m_ngaykc,'dd/mm/yyyy'),";
			if (m_ngaydd != "") sql += "ngaydd=to_date(:m_ngaydd,'dd/mm/yyyy'),";
			sql += " userid=:m_userid,lan="+lan;
			sql += " where mavaovien=:m_mavaovien";
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd = new OracleCommand(sql, con);
				cmd.CommandType = CommandType.Text;
				cmd.Parameters.Add("m_mabn", OracleType.VarChar,8).Value = m_mabn;
				cmd.Parameters.Add("m_cao", OracleType.Number).Value = m_cao;
				cmd.Parameters.Add("m_para", OracleType.VarChar, 8).Value = m_para;
				cmd.Parameters.Add("m_dacdiem", OracleType.NVarChar,254).Value = m_dacdiem;
				cmd.Parameters.Add("m_chuky", OracleType.Number).Value = m_chuky;
				cmd.Parameters.Add("m_tinhchat", OracleType.Number).Value = m_tinhchat;
				cmd.Parameters.Add("m_luongkinh", OracleType.Number).Value = m_luongkinh;
				cmd.Parameters.Add("m_songay", OracleType.Number).Value = m_songay;
				cmd.Parameters.Add("m_vat1", OracleType.NVarChar,254).Value = m_vat1;
				cmd.Parameters.Add("m_vat2", OracleType.NVarChar,254).Value = m_vat2;
				cmd.Parameters.Add("m_tiensu", OracleType.NVarChar,254).Value = m_tiensu;
				if (m_ngaykc != "") cmd.Parameters.Add("m_ngaykc", OracleType.VarChar,16).Value = m_ngaykc;
				if (m_ngaydd != "") cmd.Parameters.Add("m_ngaydd", OracleType.VarChar,16).Value = m_ngaydd;
				cmd.Parameters.Add("m_userid", OracleType.Number).Value = m_userid;
				cmd.Parameters.Add("m_mavaovien", OracleType.Number).Value = m_mavaovien;
				int irec = cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec == 0)
				{
					sql = "insert into " + user + mmyy(m_ngay) + ".sokhamthai(mabn,mavaovien,cao,para,dacdiem,chuky,tinhchat,";
					sql+="luongkinh,songay,vat1,vat2,tiensu,";
					if (m_ngaykc != "") sql += "ngaykc,";
					if (m_ngaydd != "") sql += "ngaydd,";
					sql+="lan,userid) values ";
					sql += "(:m_mabn,:m_mavaovien,:m_cao,:m_para,:m_dacdiem,:m_chuky,:m_tinhchat,";
					sql += ":m_luongkinh,:m_songay,:m_vat1,:m_vat2,:m_tiensu,";
					if (m_ngaykc != "") sql += "to_date(:m_ngaykc,'dd/mm/yyyy'),";
					if (m_ngaydd != "") sql += "to_date(:m_ngaydd,'dd/mm/yyyy'),";
					sql += lan+",:m_userid)";
					cmd = new OracleCommand(sql, con);
					cmd.CommandType = CommandType.Text;
					cmd.Parameters.Add("m_mabn", OracleType.VarChar,8).Value = m_mabn;
					cmd.Parameters.Add("m_mavaovien", OracleType.Number).Value = m_mavaovien;
					cmd.Parameters.Add("m_cao", OracleType.Number).Value = m_cao;
					cmd.Parameters.Add("m_para", OracleType.VarChar, 8).Value = m_para;
					cmd.Parameters.Add("m_dacdiem", OracleType.NVarChar,254).Value = m_dacdiem;
					cmd.Parameters.Add("m_chuky", OracleType.Number).Value = m_chuky;
					cmd.Parameters.Add("m_tinhchat", OracleType.Number).Value = m_tinhchat;
					cmd.Parameters.Add("m_luongkinh", OracleType.Number).Value = m_luongkinh;
					cmd.Parameters.Add("m_songay", OracleType.Number).Value = m_songay;
					cmd.Parameters.Add("m_vat1", OracleType.NVarChar,254).Value = m_vat1;
					cmd.Parameters.Add("m_vat2", OracleType.NVarChar,254).Value = m_vat2;
					cmd.Parameters.Add("m_tiensu", OracleType.NVarChar,254).Value = m_tiensu;
					if (m_ngaykc != "") cmd.Parameters.Add("m_ngaykc", OracleType.VarChar,16).Value = m_ngaykc;
					if (m_ngaydd != "") cmd.Parameters.Add("m_ngaydd", OracleType.VarChar,16).Value = m_ngaydd;
					cmd.Parameters.Add("m_userid", OracleType.Number).Value = m_userid;
					irec = cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch (OracleException ex)
			{
				upd_error(ex.Message, sComputer, "sokhamthai");
				return false;
			}
			finally
			{
                
				con.Close(); con.Dispose();
			}
			return true;
		}
		public bool upd_sokhamthaict(string m_ngaykham, long m_mavaovien, long m_maql, string m_ngay, decimal m_cannang, string m_huyetap,
			decimal m_mach, int m_phu, string m_bctc, string m_timthai, int m_ngoi, string m_ketluan)
		{
			sql = "update " + user + mmyy(m_ngaykham) + ".sokhamthaict set mavaovien=:m_mavaovien,ngay=to_date(:m_ngay,'dd/mm/yyyy hh24:mi'),";
			sql += "cannang=:m_cannang,huyetap=:m_huyetap,mach=:m_mach,phu=:m_phu,bctc=:m_bctc,timthai=:m_timthai,ngoi=:m_ngoi,";
			sql += "ketluan=:m_ketluan where maql=:m_maql";
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd = new OracleCommand(sql, con);
				cmd.CommandType = CommandType.Text;
				cmd.Parameters.Add("m_mavaovien", OracleType.Number).Value = m_mavaovien;
				cmd.Parameters.Add("m_ngay", OracleType.VarChar, 16).Value = m_ngay;
				cmd.Parameters.Add("m_cannang", OracleType.Number).Value = m_cannang;
				cmd.Parameters.Add("m_huyetap", OracleType.VarChar, 7).Value = m_huyetap;
				cmd.Parameters.Add("m_mach", OracleType.Number).Value = m_mach;
				cmd.Parameters.Add("m_phu", OracleType.Number).Value = m_phu;
				cmd.Parameters.Add("m_bctc", OracleType.NVarChar,254).Value = m_bctc;
				cmd.Parameters.Add("m_timthai", OracleType.NVarChar,254).Value = m_timthai;
				cmd.Parameters.Add("m_ngoi", OracleType.Number).Value = m_ngoi;
				cmd.Parameters.Add("m_ketluan", OracleType.NVarChar,254).Value = m_ketluan;
				cmd.Parameters.Add("m_maql", OracleType.Number).Value = m_maql;
				int irec = cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec == 0)
				{
					sql = "insert into " + user + mmyy(m_ngaykham) + ".sokhamthaict(maql,mavaovien,ngay,cannang,huyetap,mach,phu,bctc,timthai,ngoi,ketluan)";
					sql += " values (:m_maql,:m_mavaovien,to_date(:m_ngay,'dd/mm/yyyy hh24:mi'),:m_cannang,:m_huyetap,:m_mach,:m_phu,:m_bctc,:m_timthai,:m_ngoi,:m_ketluan)";
					cmd = new OracleCommand(sql, con);
					cmd.CommandType = CommandType.Text;
					cmd.Parameters.Add("m_maql", OracleType.Number).Value = m_maql; 
					cmd.Parameters.Add("m_mavaovien", OracleType.Number).Value = m_mavaovien;
					cmd.Parameters.Add("m_ngay", OracleType.VarChar, 16).Value = m_ngay;
					cmd.Parameters.Add("m_cannang", OracleType.Number).Value = m_cannang;
					cmd.Parameters.Add("m_huyetap", OracleType.VarChar, 7).Value = m_huyetap;
					cmd.Parameters.Add("m_mach", OracleType.Number).Value = m_mach;
					cmd.Parameters.Add("m_phu", OracleType.Number).Value = m_phu;
					cmd.Parameters.Add("m_bctc", OracleType.NVarChar,254).Value = m_bctc;
					cmd.Parameters.Add("m_timthai", OracleType.NVarChar,254).Value = m_timthai;
					cmd.Parameters.Add("m_ngoi", OracleType.Number).Value = m_ngoi;
					cmd.Parameters.Add("m_ketluan", OracleType.NVarChar,254).Value = m_ketluan;                    
					irec = cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch (OracleException ex)
			{
				upd_error(ex.Message, sComputer, "sokhamthaict");
				return false;
			}
			finally
			{
                
				con.Close(); con.Dispose();
			}
			return true;
		}		

		#region vienphi

		public string Mausobienlai{get{return Thongsov("c12");}}
		public string Masothue{get{return Thongsov("c13");}}

		public string Thongsov(string sql)
		{
			XmlDocument doc=new XmlDocument();
			doc.Load("..\\..\\..\\xml\\v_thongso.xml");
			XmlNodeList nodeLst=doc.GetElementsByTagName(sql);
			return nodeLst.Item(0).InnerText;
		}

		public long get_id_vienphi_v
		{
			get
			{
				return getidyymmdd_v(5);
			}
		}
		public long get_id_tamung_v
		{
			get
			{
				return getidyymmdd_v(6);
			}
		}
		public long get_id_hoantra
		{
			get
			{
				return getidyymmdd_v(8);
			}
		}
		public long get_id_chidinh_v
		{
			get
			{
				return getidyymmdd_v(9);
			}
		}
		public long get_id_chidinhll
		{
			get
			{				
				return long.Parse(iRownum.ToString().PadLeft(3, '0')+get_capid_may_v(-9, sComputer).ToString().PadLeft(9, '0'));//getidyymmddhhmiss_stt_computer;//long.Parse(iRownum.ToString().PadLeft(3,'0')+get_capid_may(-9,sComputer).ToString().PadLeft(9,'0'));
			}
		}
		public long get_id_thanhtoanravien
		{
			get
			{
				return getidyymmdd_v(10);
			}
		}
		public long get_id_vpkhoa
		{
			get
			{
				return getidyymmdd_v(11);
			}
		}
		public long get_id_phieuchi
		{
			get
			{
				return getidyymmddhhmiss_stt_computer;//long.Parse(iRownum.ToString().PadLeft(3,'0')+get_capid_may(12,sComputer).ToString().PadLeft(9,'0'));
			}
		}
		public int get_lanin_tructiep(long v_id){return get_lanin("v_vienphill",v_id);}
		public long get_id_thvp()
		{
			return getidyymmdd_v(13);
		}

		public long getidyymmdd(int id)
		{
			return long.Parse(getyymmdd() + get_capid_may_v(id, sComputer).ToString().PadLeft(9, '0') + iRownum.ToString().PadLeft(3, '0'));
		}
		public string getyymmdd()
		{
			return get_data("select to_char(sysdate,'yyMMdd') from dual").Tables[0].Rows[0][0].ToString();
		}

		public string get_id_thvp(int khu,string mabn,long maql,long idkhoa,string ngayvao,string ngayra,string ngayserver,bool chitiet)
		{
			DateTime dt1 = StringToDate(ngayserver).AddDays(-1*iNgaykiemke);
			DateTime dt2 = StringToDate(ngayserver);
			int y1 = dt1.Year, m1 = dt1.Month;
			int y2 = dt2.Year, m2 = dt2.Month;
			int itu, iden;
			string mmyy = "",xxx;
			long id=0;
			for (int i = y1; i <= y2; i++)
			{
				itu = (i == y1) ? m1 : 1;
				iden = (i == y2) ? m2 : 12;
				for (int j = itu; j <= iden; j++)
				{
					mmyy = j.ToString().PadLeft(2, '0') + i.ToString().Substring(2, 2);
					xxx=user+mmyy;
					if (bMmyy(mmyy))
					{
						sql="select id from "+xxx+".v_thvpll where mabn='"+mabn+"'";
						if (chitiet) sql+=" and to_char(ngayvao,'dd/mm/yyyy')='"+ngayvao.Substring(0,10)+"' and done=0";//and to_char(ngayra,'dd/mm/yyyy')='"+ngayra.Substring(0,10)+"'
						else sql+=" and to_char(ngayvao,'dd/mm/yyyy hh24:mi')='"+ngayvao+"'";
						if (idkhoa!=0) sql+=" and idkhoa="+idkhoa;
						else sql+=" and maql="+maql;
						if (khu!=0) sql+=" and khu="+khu;
						ds=get_data(sql);
						if (ds.Tables[0].Rows.Count>0) 
						{
							id=long.Parse(ds.Tables[0].Rows[0]["id"].ToString());
							break;
						}
					}
				}
			}
			return (id==0)?"":mmyy+id.ToString().Trim();
		}

		public bool get_done_thvp(int khu,string mmyy,string mabn,long maql,long idkhoa,string ngayvao)
		{
			if (bMmyy(mmyy))
			{
				string xxx=user+mmyy;
				sql="select done from "+xxx+".v_thvpll where mabn='"+mabn+"' and to_char(ngayvao,'dd/mm/yyyy hh24:mi')='"+ngayvao+"'";
				if (idkhoa!=0) sql+=" and idkhoa="+idkhoa;
				else sql+=" and maql="+maql;
				if (khu!=0) sql+=" and khu="+khu;
				ds=get_data(sql);
				if (ds.Tables[0].Rows.Count>0) return ds.Tables[0].Rows[0]["done"].ToString()=="1";
				else return false;
			}
			return false;
		}

		public bool get_done_thvp_mmyy(int khu,string den,string mabn,long maql,long idkhoa,string ngayvao)
		{
			DateTime dt1 = StringToDate(ngayvao).AddDays(iNgaykiemke);
			DateTime dt2 = StringToDate(den).AddDays(iNgaykiemke);
			int y1 = dt1.Year, m1 = dt1.Month;
			int y2 = dt2.Year, m2 = dt2.Month;
			int itu, iden;
			string sql,mmyy = "",xxx;
			bool ret=false;
			for (int i = y1; i <= y2; i++)
			{
				itu = (i == y1) ? m1 : 1;
				iden = (i == y2) ? m2 : 12;
				for (int j = itu; j <= iden; j++)
				{
					mmyy = j.ToString().PadLeft(2, '0') + i.ToString().Substring(2, 2);
					xxx=user+mmyy;
					if (bMmyy(mmyy))
					{
						sql="select done from "+xxx+".v_thvpll where mabn='"+mabn+"' and to_char(ngayvao,'dd/mm/yyyy')='"+ngayvao.Substring(0,10)+"'";
						if (idkhoa!=0) sql+=" and idkhoa="+idkhoa;
						else sql+=" and maql="+maql;
						if (khu!=0) sql+=" and khu="+khu;
						ret=get_data(sql).Tables[0].Rows.Count>0;
						if (ret) break;
					}
				}
			}
			return ret;
		}

		public long get_id_thngay()
		{
			return getidyymmddhhmiss_stt_computer;//long.Parse(iRownum.ToString().PadLeft(3,'0')+get_capid_may(14,sComputer).ToString().PadLeft(9,'0'));
		}

		public long get_id_thngay(string mmyy,int madoituong,string mabn,long maql,string makp,string tu,string den,bool tang)
		{
			if (bMmyy(mmyy))
			{
				sql="select id from "+user+mmyy+".v_thngayll where madoituong="+madoituong+" and mabn='"+mabn+"' and maql="+maql+" and to_char(tu,'dd/mm/yyyy')='"+tu.Substring(0,10)+"' and to_char(den,'dd/mm/yyyy')='"+den.Substring(0,10)+"' and makp='"+makp+"'";
				ds=get_data(sql);
				if (ds.Tables[0].Rows.Count>0) return long.Parse(ds.Tables[0].Rows[0]["id"].ToString());
				else return (tang)?get_id_thngay():0;
			}
			return (tang)?get_id_thngay():0;
		}

		private long get_capid_v(int m_ma)
		{
			sql="update v_capid set id=id+1 where ma=:m_ma";
			con=new OracleConnection(sConn);
			con.Open();
			cmd=new OracleCommand(sql,con);
			cmd.CommandType=CommandType.Text;
			cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
			int irec=cmd.ExecuteNonQuery();
			cmd.Dispose();
			if (irec==0)
			{
				sql="insert into v_capid(ma,ten,id) values (:m_ma,:m_ten,1)";
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_ma",OracleType.Int16).Value=m_ma;
				cmd.Parameters.Add("m_ten",OracleType.VarChar,20).Value=sComputer;
				cmd.ExecuteNonQuery();
				cmd.Dispose();
			}
			sql="select id from v_capid where ma="+m_ma;
			cmd=new OracleCommand(sql,con);
			cmd.CommandType=CommandType.Text;
			dest=new OracleDataAdapter(cmd);
			ds=new DataSet();
			dest.Fill(ds);	
			cmd.Dispose();				
			con.Close();con.Dispose();
			return long.Parse(ds.Tables[0].Rows[0][0].ToString());
		}

		private long get_capid(string table,int m_ma)
		{
			sql="update "+table+" set id=id+1 where ma=:m_ma";
			con=new OracleConnection(sConn);
			con.Open();
			cmd=new OracleCommand(sql,con);
			cmd.CommandType=CommandType.Text;
			cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
			int irec=cmd.ExecuteNonQuery();
			cmd.Dispose();
			if (irec==0)
			{
				sql="insert into "+table+"(ma,ten,id) values (:m_ma,:m_ten,1)";
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_ma",OracleType.Int16).Value=m_ma;
				cmd.Parameters.Add("m_ten",OracleType.VarChar,20).Value=sComputer;
				cmd.ExecuteNonQuery();
				cmd.Dispose();
			}
			sql="select id from "+table+" where ma="+m_ma;
			cmd=new OracleCommand(sql,con);
			cmd.CommandType=CommandType.Text;
			dest=new OracleDataAdapter(cmd);
			ds=new DataSet();
			dest.Fill(ds);	
			cmd.Dispose();				
			con.Close();con.Dispose();
			return long.Parse(ds.Tables[0].Rows[0][0].ToString());
		}

		private long get_capid_may_v(int m_ma,string m_computer)
		{
			sql="update v_capid set id=id+1 where ma=:m_ma and computer=:m_computer";
			con=new OracleConnection(sConn);
			con.Open();
			cmd=new OracleCommand(sql,con);
			cmd.CommandType=CommandType.Text;
			cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
			cmd.Parameters.Add("m_computer",OracleType.VarChar,20).Value=m_computer;
			int irec=cmd.ExecuteNonQuery();
			cmd.Dispose();
			if (irec==0)
			{
				sql="insert into v_capid(ma,ten,id,computer) values (:m_ma,:m_ten,1,:m_computer)";
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_ma",OracleType.Int16).Value=m_ma;
				cmd.Parameters.Add("m_ten",OracleType.VarChar,20).Value=m_computer;
				cmd.Parameters.Add("m_computer",OracleType.VarChar,20).Value=m_computer;
				cmd.ExecuteNonQuery();
				cmd.Dispose();
			}
			sql="select id from v_capid where ma="+m_ma+" and computer='"+m_computer+"'";
			cmd=new OracleCommand(sql,con);
			cmd.CommandType=CommandType.Text;
			dest=new OracleDataAdapter(cmd);
			ds=new DataSet();
			dest.Fill(ds);	
			cmd.Dispose();				
			con.Close();con.Dispose();
			return long.Parse(ds.Tables[0].Rows[0][0].ToString());
		}

		private int get_lanin(string m_table,long m_id)
		{
			sql="update "+m_table+" set lanin=lanin+1 where id=:m_id";
			con=new OracleConnection(sConn);
			con.Open();
			cmd=new OracleCommand(sql,con);
			cmd.CommandType=CommandType.Text;
			cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
			int irec=cmd.ExecuteNonQuery();
			cmd.Dispose();
			if (irec==0) return 1;
			else return int.Parse(get_data("select lanin from "+m_table+" where id="+m_id).Tables[0].Rows[0][0].ToString());
		}

		public bool upd_trongoi(long v_id,int v_stt,long v_id_nhom,long v_id_loai,long v_id_gia,decimal v_sotien)
		{
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand("pkg_vienphi.upd_trongoi",con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("v_id",OracleType.Number).Value=v_id;
				cmd.Parameters.Add("v_stt",OracleType.Number).Value=v_stt;
				cmd.Parameters.Add("v_id_nhom",OracleType.Number).Value=v_id_nhom;
				cmd.Parameters.Add("v_id_loai",OracleType.Number).Value=v_id_loai;
				cmd.Parameters.Add("v_id_gia",OracleType.Number).Value=v_id_gia;
				cmd.Parameters.Add("v_sotien",OracleType.Number).Value=v_sotien;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"v_trongoi");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_tygia(string v_ngay,decimal v_tygia,int v_userid)
		{
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand("pkg_vienphi.upd_tygia",con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("v_ngay",OracleType.VarChar,10).Value=v_ngay;
				cmd.Parameters.Add("v_tygia",OracleType.Number).Value=v_tygia;
				cmd.Parameters.Add("v_userid",OracleType.Number).Value=v_userid;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"v_tygia");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_vienphill(string v_mmyy,long v_id,long v_quyenso,long v_sobienlai,string v_ngay,string v_mabn,long v_maql,long v_idkhoa,string v_makp,string v_hoten,string v_namsinh,string v_diachi,int v_loai,int v_loaibn,int v_userid)
		{
			string xxx=user+v_mmyy+".pkg_vienphi.upd_vienphill";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(xxx,con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("v_id",OracleType.Number).Value=v_id;
				cmd.Parameters.Add("v_quyenso",OracleType.Number).Value=v_quyenso;
				cmd.Parameters.Add("v_sobienlai",OracleType.Number).Value=v_sobienlai;
				cmd.Parameters.Add("v_ngay",OracleType.VarChar,16).Value=v_ngay;
				cmd.Parameters.Add("v_mabn",OracleType.VarChar,8).Value=v_mabn;
				cmd.Parameters.Add("v_maql",OracleType.Number).Value=v_maql;
				cmd.Parameters.Add("v_idkhoa",OracleType.Number).Value=v_idkhoa;
				cmd.Parameters.Add("v_makp",OracleType.VarChar,2).Value=v_makp;
				cmd.Parameters.Add("v_hoten",OracleType.NVarChar,50).Value=v_hoten;
				cmd.Parameters.Add("v_namsinh",OracleType.VarChar,4).Value=v_namsinh;
				cmd.Parameters.Add("v_diachi",OracleType.NVarChar,100).Value=v_diachi;
				cmd.Parameters.Add("v_loai",OracleType.Number).Value=v_loai;
				cmd.Parameters.Add("v_loaibn",OracleType.Number).Value=v_loaibn;
				cmd.Parameters.Add("v_userid",OracleType.Number).Value=v_userid;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"v_vienphill");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_vienphict(string v_mmyy,long v_id,int v_stt,int v_madoituong,int v_mavp,string v_ten,decimal v_soluong,decimal v_dongia,decimal v_mien,decimal v_thieu,decimal v_vattu,string v_mabs,string v_makp)
		{
			string xxx=user+v_mmyy+".pkg_vienphi.upd_vienphict";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(xxx,con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("v_id",OracleType.Number).Value=v_id;
				cmd.Parameters.Add("v_stt",OracleType.Number).Value=v_stt;
				cmd.Parameters.Add("v_madoituong",OracleType.Number).Value=v_madoituong;
				cmd.Parameters.Add("v_mavp",OracleType.Number).Value=v_mavp;
				cmd.Parameters.Add("v_ten",OracleType.NVarChar,100).Value=(v_ten.Length>100)?v_ten.Substring(0,100):v_ten;
				cmd.Parameters.Add("v_soluong",OracleType.Number).Value=v_soluong;
				cmd.Parameters.Add("v_dongia",OracleType.Number).Value=v_dongia;
				cmd.Parameters.Add("v_mien",OracleType.Number).Value=v_mien;
				cmd.Parameters.Add("v_thieu",OracleType.Number).Value=v_thieu;
				cmd.Parameters.Add("v_vattu",OracleType.Number).Value=v_vattu;
				cmd.Parameters.Add("v_mabs",OracleType.VarChar,4).Value=v_mabs;
				cmd.Parameters.Add("v_makp",OracleType.VarChar,2).Value=v_makp;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"v_vienphict");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_nhom(string v_mmyy,long v_id,int v_ma,decimal v_sotien)
		{
			string xxx=user+v_mmyy+".pkg_vienphi.upd_nhom";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(xxx,con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("v_id",OracleType.Number).Value=v_id;
				cmd.Parameters.Add("v_ma",OracleType.Number).Value=v_ma;
				cmd.Parameters.Add("v_sotien",OracleType.Number).Value=v_sotien;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"v_nhom");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_trongoi(string v_mmyy,long v_id,decimal v_sotien,decimal v_tamung,decimal v_hoantra,int v_pm,int v_yc,string v_ghichu)
		{
			string xxx=user+v_mmyy+".pkg_vienphi.upd_trongoi";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(xxx,con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("v_id",OracleType.Number).Value=v_id;
				cmd.Parameters.Add("v_sotien",OracleType.Number).Value=v_sotien;
				cmd.Parameters.Add("v_tamung",OracleType.Number).Value=v_tamung;
				cmd.Parameters.Add("v_hoantra",OracleType.Number).Value=v_hoantra;
				cmd.Parameters.Add("v_pm",OracleType.Number).Value=v_pm;
				cmd.Parameters.Add("v_yc",OracleType.Number).Value=v_yc;
				cmd.Parameters.Add("v_ghichu",OracleType.NVarChar,100).Value=v_ghichu;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"v_giuong");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}


		public bool upd_giuong(string v_mmyy,long v_id,int v_mavp,string v_ngay,decimal v_dongia)
		{
			string xxx=user+v_mmyy+".pkg_vienphi.upd_giuong";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(xxx,con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("v_id",OracleType.Number).Value=v_id;
				cmd.Parameters.Add("v_mavp",OracleType.Number).Value=v_mavp;
				cmd.Parameters.Add("v_ngay",OracleType.VarChar,10).Value=v_ngay;
				cmd.Parameters.Add("v_dongia",OracleType.Number).Value=v_dongia;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"v_giuong");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_bhyt(string v_mmyy,long v_id,string v_sothe,int v_maphu,string v_mabv,string v_noigioithieu,int v_traituyen)
		{
			string xxx=user+v_mmyy+".pkg_vienphi.upd_bhyt";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(xxx,con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("v_id",OracleType.Number).Value=v_id;
				cmd.Parameters.Add("v_sothe",OracleType.VarChar,20).Value=v_sothe;
				cmd.Parameters.Add("v_maphu",OracleType.Number).Value=v_maphu;
				cmd.Parameters.Add("v_mabv",OracleType.VarChar,8).Value=v_mabv;
				cmd.Parameters.Add("v_noigioithieu",OracleType.VarChar,8).Value=v_noigioithieu;
				cmd.Parameters.Add("v_traituyen",OracleType.Number).Value=v_traituyen;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"v_bhyt");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_mienngtru(string v_mmyy,long v_id,decimal v_sotien,string v_ghichu,int v_maduyet,int v_lydo)
		{
			string xxx=user+v_mmyy+".pkg_vienphi.upd_mienngtru";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(xxx,con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("v_id",OracleType.Number).Value=v_id;
				cmd.Parameters.Add("v_sotien",OracleType.Number).Value=v_sotien;
				cmd.Parameters.Add("v_ghichu",OracleType.NVarChar,100).Value=v_ghichu;
				cmd.Parameters.Add("v_maduyet",OracleType.Number).Value=v_maduyet;
				cmd.Parameters.Add("v_lydo",OracleType.Number).Value=v_lydo;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"v_mienngtru");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}
		
		public bool upd_dsduyet(int v_ma,string v_ten)
		{
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand("pkg_vienphi.upd_dsduyet",con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("v_ma",OracleType.Number).Value=v_ma;
				cmd.Parameters.Add("v_ten",OracleType.NVarChar,50).Value=v_ten;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"v_dsduyet");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_hoantra(string v_mmyy,long v_id,long v_quyenso,long v_sobienlai,string v_ngay,string v_mabn,string v_hoten,string v_makp,decimal v_sotien,string v_ghichu,int v_userid,int v_loai,int v_loaibn,string v_ngaythu)
		{
			string xxx=user+v_mmyy+".pkg_vienphi.upd_hoantra";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(xxx,con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("v_id",OracleType.Number).Value=v_id;
				cmd.Parameters.Add("v_quyenso",OracleType.Number).Value=v_quyenso;
				cmd.Parameters.Add("v_sobienlai",OracleType.Number).Value=v_sobienlai;
				cmd.Parameters.Add("v_ngay",OracleType.VarChar,16).Value=v_ngay;
				cmd.Parameters.Add("v_mabn",OracleType.VarChar,8).Value=v_mabn;
				cmd.Parameters.Add("v_hoten",OracleType.NVarChar,50).Value=v_hoten;
				cmd.Parameters.Add("v_makp",OracleType.VarChar,2).Value=v_makp;
				cmd.Parameters.Add("v_sotien",OracleType.Number).Value=v_sotien;
				cmd.Parameters.Add("v_ghichu",OracleType.NVarChar,50).Value=v_ghichu;
				cmd.Parameters.Add("v_userid",OracleType.Number).Value=v_userid;
				cmd.Parameters.Add("v_loai",OracleType.Number).Value=v_loai;
				cmd.Parameters.Add("v_loaibn",OracleType.Number).Value=v_loaibn;
				cmd.Parameters.Add("v_ngaythu",OracleType.VarChar,16).Value=v_ngaythu;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"v_hoantra");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_hoantract(string v_mmyy,long v_id,int v_loaivp,decimal v_sotien)
		{
			string xxx=user+v_mmyy+".pkg_vienphi.upd_hoantract";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(xxx,con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("v_id",OracleType.Number).Value=v_id;
				cmd.Parameters.Add("v_loaivp",OracleType.Number).Value=v_loaivp;
				cmd.Parameters.Add("v_sotien",OracleType.Number).Value=v_sotien;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"v_hoantract");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_tamung(string v_mmyy,long v_id,string v_mabn,long v_maql,long v_idkhoa,long v_quyenso,long v_sobienlai,string v_ngay,int v_loai,int v_loaibn,string v_makp,int v_madoituong,decimal v_sotien,int v_userid)
		{
			string xxx=user+v_mmyy+".pkg_vienphi.upd_tamung";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(xxx,con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("v_id",OracleType.Number).Value=v_id;
				cmd.Parameters.Add("v_mabn",OracleType.VarChar,8).Value=v_mabn;
				cmd.Parameters.Add("v_maql",OracleType.Number).Value=v_maql;
				cmd.Parameters.Add("v_idkhoa",OracleType.Number).Value=v_idkhoa;
				cmd.Parameters.Add("v_quyenso",OracleType.Number).Value=v_quyenso;
				cmd.Parameters.Add("v_sobienlai",OracleType.Number).Value=v_sobienlai;
				cmd.Parameters.Add("v_ngay",OracleType.VarChar,16).Value=v_ngay;
				cmd.Parameters.Add("v_loai",OracleType.Number).Value=v_loai;
				cmd.Parameters.Add("v_loaibn",OracleType.Number).Value=v_loaibn;
				cmd.Parameters.Add("v_makp",OracleType.VarChar,2).Value=v_makp;
				cmd.Parameters.Add("v_madoituong",OracleType.Number).Value=v_madoituong;
				cmd.Parameters.Add("v_sotien",OracleType.Number).Value=v_sotien;
				cmd.Parameters.Add("v_userid",OracleType.Number).Value=v_userid;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"v_tamung");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_tamung(string v_mmyy,long v_id,string v_mabn,long v_maql,long v_idkhoa,long v_quyenso,long v_sobienlai,string v_ngay,int v_loai,int v_loaibn,string v_makp,int v_madoituong,decimal v_stung,decimal v_tyle,decimal v_sotien,int v_userid,long v_mavaovien)
		{
			string xxx=user+v_mmyy+".pkg_vienphi.upd_tamung";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(xxx,con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("v_id",OracleType.Number).Value=v_id;
				cmd.Parameters.Add("v_mabn",OracleType.VarChar,8).Value=v_mabn;
				cmd.Parameters.Add("v_maql",OracleType.Number).Value=v_maql;
				cmd.Parameters.Add("v_idkhoa",OracleType.Number).Value=v_idkhoa;
				cmd.Parameters.Add("v_quyenso",OracleType.Number).Value=v_quyenso;
				cmd.Parameters.Add("v_sobienlai",OracleType.Number).Value=v_sobienlai;
				cmd.Parameters.Add("v_ngay",OracleType.VarChar,16).Value=v_ngay;
				cmd.Parameters.Add("v_loai",OracleType.Number).Value=v_loai;
				cmd.Parameters.Add("v_loaibn",OracleType.Number).Value=v_loaibn;
				cmd.Parameters.Add("v_makp",OracleType.VarChar,2).Value=v_makp;
				cmd.Parameters.Add("v_madoituong",OracleType.Number).Value=v_madoituong;
				cmd.Parameters.Add("v_stung",OracleType.Number).Value=v_stung;
				cmd.Parameters.Add("v_tyle",OracleType.Number).Value=v_tyle;
				cmd.Parameters.Add("v_sotien",OracleType.Number).Value=v_sotien;
				cmd.Parameters.Add("v_userid",OracleType.Number).Value=v_userid;
				cmd.Parameters.Add("v_mavaovien",OracleType.Number).Value=v_mavaovien;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"v_tamung");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_tamungct(string v_mmyy,long v_id,int v_loaivp,decimal v_sotien)
		{
			string xxx=user+v_mmyy+".pkg_vienphi.upd_tamungct";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(xxx,con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("v_id",OracleType.Number).Value=v_id;
				cmd.Parameters.Add("v_loaivp",OracleType.Number).Value=v_loaivp;
				cmd.Parameters.Add("v_sotien",OracleType.Number).Value=v_sotien;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"v_tamungct");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}
		public bool upd_chidinh(string v_mmyy,long v_id,string v_mabn,long v_maql,long v_idkhoa,string v_ngay,int v_loai,string v_makp,int v_madoituong,int v_mavp,decimal v_soluong,decimal v_dongia,decimal v_vattu,int v_userid,int v_tinhtrang,int v_thuchien)
		{
			string xxx=user+v_mmyy+".pkg_vienphi.upd_chidinh";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(xxx,con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("v_id",OracleType.Number).Value=v_id;
				cmd.Parameters.Add("v_mabn",OracleType.VarChar,8).Value=v_mabn;
				cmd.Parameters.Add("v_maql",OracleType.Number).Value=v_maql;
				cmd.Parameters.Add("v_idkhoa",OracleType.Number).Value=v_idkhoa;
				cmd.Parameters.Add("v_ngay",OracleType.VarChar,16).Value=v_ngay;
				cmd.Parameters.Add("v_loai",OracleType.Number).Value=v_loai;
				cmd.Parameters.Add("v_makp",OracleType.VarChar,2).Value=v_makp;
				cmd.Parameters.Add("v_madoituong",OracleType.Number).Value=v_madoituong;
				cmd.Parameters.Add("v_mavp",OracleType.Number).Value=v_mavp;
				cmd.Parameters.Add("v_soluong",OracleType.Number).Value=v_soluong;
				cmd.Parameters.Add("v_dongia",OracleType.Number).Value=v_dongia;
				cmd.Parameters.Add("v_vattu",OracleType.Number).Value=v_vattu;
				cmd.Parameters.Add("v_userid",OracleType.Number).Value=v_userid;
				cmd.Parameters.Add("v_tinhtrang",OracleType.Number).Value=v_tinhtrang;
				cmd.Parameters.Add("v_thuchien",OracleType.Number).Value=v_thuchien;
				cmd.Parameters.Add("v_computer",OracleType.VarChar,20).Value=sComputer;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"v_chidinh");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_chidinh(string v_mmyy,long v_id,string v_mabn,long v_maql,long v_idkhoa,string v_ngay,int v_loai,string v_makp,int v_madoituong,int v_mavp,decimal v_soluong,decimal v_dongia,decimal v_vattu,int v_userid,int v_tinhtrang,int v_thuchien,string v_mabs,string v_chandoan)
		{
			string xxx=user+v_mmyy+".pkg_vienphi.upd_chidinh";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(xxx,con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("v_id",OracleType.Number).Value=v_id;
				cmd.Parameters.Add("v_mabn",OracleType.VarChar,8).Value=v_mabn;
				cmd.Parameters.Add("v_maql",OracleType.Number).Value=v_maql;
				cmd.Parameters.Add("v_idkhoa",OracleType.Number).Value=v_idkhoa;
				cmd.Parameters.Add("v_ngay",OracleType.VarChar,16).Value=v_ngay;
				cmd.Parameters.Add("v_loai",OracleType.Number).Value=v_loai;
				cmd.Parameters.Add("v_makp",OracleType.VarChar,2).Value=v_makp;
				cmd.Parameters.Add("v_madoituong",OracleType.Number).Value=v_madoituong;
				cmd.Parameters.Add("v_mavp",OracleType.Number).Value=v_mavp;
				cmd.Parameters.Add("v_soluong",OracleType.Number).Value=v_soluong;
				cmd.Parameters.Add("v_dongia",OracleType.Number).Value=v_dongia;
				cmd.Parameters.Add("v_vattu",OracleType.Number).Value=v_vattu;
				cmd.Parameters.Add("v_userid",OracleType.Number).Value=v_userid;
				cmd.Parameters.Add("v_tinhtrang",OracleType.Number).Value=v_tinhtrang;
				cmd.Parameters.Add("v_thuchien",OracleType.Number).Value=v_thuchien;
				cmd.Parameters.Add("v_computer",OracleType.VarChar,20).Value=sComputer;
				cmd.Parameters.Add("v_mabs",OracleType.VarChar,4).Value=v_mabs;
				cmd.Parameters.Add("v_chandoan",OracleType.NVarChar,500).Value=v_chandoan;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"v_chidinh");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_chidinh(string v_mmyy,long v_id,string v_mabn,long v_maql,long v_idkhoa,string v_ngay,int v_loai,string v_makp,int v_madoituong,int v_mavp,decimal v_soluong,decimal v_dongia,decimal v_vattu,int v_userid,int v_tinhtrang,int v_thuchien,string v_mabs,string v_chandoan,long v_mavaovien,long v_idchidinh)
		{
			string xxx=user+v_mmyy+".pkg_vienphi.upd_chidinh";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(xxx,con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("v_id",OracleType.Number).Value=v_id;
				cmd.Parameters.Add("v_mabn",OracleType.VarChar,8).Value=v_mabn;
				cmd.Parameters.Add("v_maql",OracleType.Number).Value=v_maql;
				cmd.Parameters.Add("v_idkhoa",OracleType.Number).Value=v_idkhoa;
				cmd.Parameters.Add("v_ngay",OracleType.VarChar,16).Value=v_ngay;
				cmd.Parameters.Add("v_loai",OracleType.Number).Value=v_loai;
				cmd.Parameters.Add("v_makp",OracleType.VarChar,2).Value=v_makp;
				cmd.Parameters.Add("v_madoituong",OracleType.Number).Value=v_madoituong;
				cmd.Parameters.Add("v_mavp",OracleType.Number).Value=v_mavp;
				cmd.Parameters.Add("v_soluong",OracleType.Number).Value=v_soluong;
				cmd.Parameters.Add("v_dongia",OracleType.Number).Value=v_dongia;
				cmd.Parameters.Add("v_vattu",OracleType.Number).Value=v_vattu;
				cmd.Parameters.Add("v_userid",OracleType.Number).Value=v_userid;
				cmd.Parameters.Add("v_tinhtrang",OracleType.Number).Value=v_tinhtrang;
				cmd.Parameters.Add("v_thuchien",OracleType.Number).Value=v_thuchien;
				cmd.Parameters.Add("v_computer",OracleType.VarChar,20).Value=sComputer;
				cmd.Parameters.Add("v_mabs",OracleType.VarChar,4).Value=v_mabs;
				cmd.Parameters.Add("v_chandoan",OracleType.NVarChar,500).Value=v_chandoan;
				cmd.Parameters.Add("v_mavaovien",OracleType.Number).Value=v_mavaovien;
				cmd.Parameters.Add("v_idchidinh",OracleType.Number).Value=v_idchidinh;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"v_chidinh");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_chidinh2(string v_mmyy,long v_id,long v_idthuchien,string v_phong,string v_giuong,decimal v_lanthu,string v_ghichu,string v_hen,decimal v_cannang,decimal v_chieucao,string v_ketqua)
		{
			string xxx=user+v_mmyy+".pkg_vienphi.upd_chidinh2";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(xxx,con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("v_id",OracleType.Number).Value=v_id;
				cmd.Parameters.Add("v_idthuchien",OracleType.Number).Value=v_idthuchien;
				cmd.Parameters.Add("v_phong",OracleType.VarChar,10).Value=v_phong;
				cmd.Parameters.Add("v_giuong",OracleType.VarChar,20).Value=v_giuong;
				cmd.Parameters.Add("v_lanthu",OracleType.Number).Value=v_lanthu;
				cmd.Parameters.Add("v_ghichu",OracleType.NVarChar,254).Value=v_ghichu;
				cmd.Parameters.Add("v_hen",OracleType.VarChar,16).Value=v_hen;
				cmd.Parameters.Add("v_cannang",OracleType.Number).Value=v_cannang;
				cmd.Parameters.Add("v_chieucao",OracleType.Number).Value=v_chieucao;
				cmd.Parameters.Add("v_ketqua",OracleType.NVarChar,500).Value=v_ketqua;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"v_chidinh2");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_ttrvll(string v_mmyy,long v_id,int v_loaibn,int v_loai,long v_quyenso,long v_sobienlai,string v_ngay,string v_makp,decimal v_sotien,decimal v_tamung,decimal v_mien,decimal v_bhyt,decimal v_nopthem,decimal v_thieu,decimal v_vattu,decimal v_chenhlech,int v_userid,long v_idtonghop)
		{
			string xxx=user+v_mmyy+".pkg_vienphi.upd_ttrvll";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(xxx,con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("v_id",OracleType.Number).Value=v_id;
				cmd.Parameters.Add("v_loaibn",OracleType.Number).Value=v_loaibn;
				cmd.Parameters.Add("v_loai",OracleType.Number).Value=v_loai;
				cmd.Parameters.Add("v_quyenso",OracleType.Number).Value=v_quyenso;
				cmd.Parameters.Add("v_sobienlai",OracleType.Number).Value=v_sobienlai;
				cmd.Parameters.Add("v_ngay",OracleType.VarChar,16).Value=v_ngay;
				cmd.Parameters.Add("v_makp",OracleType.VarChar,2).Value=v_makp;
				cmd.Parameters.Add("v_sotien",OracleType.Number).Value=v_sotien;
				cmd.Parameters.Add("v_tamung",OracleType.Number).Value=v_tamung;
				cmd.Parameters.Add("v_mien",OracleType.Number).Value=v_mien;
				cmd.Parameters.Add("v_bhyt",OracleType.Number).Value=v_bhyt;
				cmd.Parameters.Add("v_nopthem",OracleType.Number).Value=v_nopthem;
				cmd.Parameters.Add("v_thieu",OracleType.Number).Value=v_thieu;
				cmd.Parameters.Add("v_vattu",OracleType.Number).Value=v_vattu;
				cmd.Parameters.Add("v_chenhlech",OracleType.Number).Value=v_chenhlech;
				cmd.Parameters.Add("v_userid",OracleType.Number).Value=v_userid;
				cmd.Parameters.Add("v_idtonghop",OracleType.Number).Value=v_idtonghop;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"v_ttrvll");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_ttrvthue(string mmyy,long id,long quyenso,long sobienlai,decimal sotien)
		{
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				string sql = "update " + user + mmyy + ".v_ttrvthue set quyenso=" + quyenso + ",sobienlai=" + sobienlai + ",sotien=" + sotien ;
				sql+=" where id=" + id;
				cmd = new OracleCommand(sql, con);
				if (cmd.ExecuteNonQuery() == 0)
				{
					sql = "insert into " + user + mmyy + ".v_ttrvthue(id,quyenso,sobienlai,sotien)";
					sql += " values(" + id + "," + quyenso + "," + sobienlai + "," + sotien+")";
					cmd.CommandText = sql;
					cmd.ExecuteNonQuery();
				}
			}
			catch (Exception ex) { upd_error(ex.Message, sComputer, "v_ttrvthue"); return false; }
			finally {con.Close();con.Dispose();}
			return true;
		}

		public bool upd_ttrvct(string v_mmyy,long v_id,int v_stt,string v_ngay,string v_makp,int v_madoituong,
			long v_mavp,decimal v_soluong,decimal v_dongia,int v_vat,decimal v_vattu,decimal v_sotien,string v_sothe)
		{
			string xxx=user+v_mmyy+".pkg_vienphi.upd_ttrvct";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(xxx,con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("v_id",OracleType.Number).Value=v_id;
				cmd.Parameters.Add("v_stt",OracleType.Number).Value=v_stt;
				cmd.Parameters.Add("v_ngay",OracleType.VarChar,10).Value=v_ngay;
				cmd.Parameters.Add("v_makp",OracleType.VarChar,2).Value=v_makp;
				cmd.Parameters.Add("v_madoituong",OracleType.Number).Value=v_madoituong;
				cmd.Parameters.Add("v_mavp",OracleType.Number).Value=v_mavp;
				cmd.Parameters.Add("v_soluong",OracleType.Number).Value=v_soluong;
				cmd.Parameters.Add("v_dongia",OracleType.Number).Value=v_dongia;
				cmd.Parameters.Add("v_vat",OracleType.Number).Value=v_vat;
				cmd.Parameters.Add("v_vattu",OracleType.Number).Value=v_vattu;
				cmd.Parameters.Add("v_sotien",OracleType.Number).Value=v_sotien;
				cmd.Parameters.Add("v_sothe",OracleType.VarChar,20).Value=v_sothe;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"v_ttrvct");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_ttrvnhom(string v_mmyy,long v_id,int v_ma,decimal v_sotien)
		{
			string xxx=user+v_mmyy+".pkg_vienphi.upd_ttrvnhom";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(xxx,con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("v_id",OracleType.Number).Value=v_id;
				cmd.Parameters.Add("v_ma",OracleType.Number).Value=v_ma;
				cmd.Parameters.Add("v_sotien",OracleType.Number).Value=v_sotien;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"v_ttrvnhom");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_ttrvpttt(string v_mmyy,long v_id,string v_ngay,int v_songay_tpt,int v_songay_spt,int v_mavp,string v_tenpt,int v_so,int v_loaipt)
		{
			string xxx=user+v_mmyy+".pkg_vienphi.upd_ttrvpttt";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(xxx,con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("v_id",OracleType.Number).Value=v_id;
				cmd.Parameters.Add("v_ngay",OracleType.VarChar,10).Value=v_ngay;
				cmd.Parameters.Add("v_songay_tpt",OracleType.Number).Value=v_songay_tpt;
				cmd.Parameters.Add("v_songay_spt",OracleType.Number).Value=v_songay_spt;
				cmd.Parameters.Add("v_mavp",OracleType.Number).Value=v_mavp;
				cmd.Parameters.Add("v_tenpt",OracleType.NVarChar,254).Value=v_tenpt;
				cmd.Parameters.Add("v_so",OracleType.Number).Value=v_so;
				cmd.Parameters.Add("v_loaipt",OracleType.Number).Value=v_loaipt;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"v_ttrvpttt");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_ttrvptttct(string v_mmyy,long v_id,int v_stt,int v_loaipt,int v_songay,decimal v_dongia)
		{
			string xxx=user+v_mmyy+".pkg_vienphi.upd_ttrvptttct";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(xxx,con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("v_id",OracleType.Number).Value=v_id;
				cmd.Parameters.Add("v_stt",OracleType.Number).Value=v_stt;
				cmd.Parameters.Add("v_loaipt",OracleType.Number).Value=v_loaipt;
				cmd.Parameters.Add("v_songay",OracleType.Number).Value=v_songay;
				cmd.Parameters.Add("v_dongia",OracleType.Number).Value=v_dongia;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"v_ttrvptttct");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_ttrvds(string v_mmyy,long v_id,string v_mabn,long v_maql,long v_idkhoa,string v_giuong,string v_ngayvao,string v_ngayra,string v_chandoan,string v_maicd)
		{
			string xxx=user+v_mmyy+".pkg_vienphi.upd_ttrvds";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(xxx,con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("v_id",OracleType.Number).Value=v_id;
				cmd.Parameters.Add("v_mabn",OracleType.VarChar,8).Value=v_mabn;
				cmd.Parameters.Add("v_maql",OracleType.Number).Value=v_maql;
				cmd.Parameters.Add("v_idkhoa",OracleType.Number).Value=v_idkhoa;
				cmd.Parameters.Add("v_giuong",OracleType.VarChar,10).Value=v_giuong;
				cmd.Parameters.Add("v_ngayvao",OracleType.VarChar,16).Value=v_ngayvao;
				cmd.Parameters.Add("v_ngayra",OracleType.VarChar,16).Value=v_ngayra;
				cmd.Parameters.Add("v_chandoan",OracleType.NVarChar,500).Value=v_chandoan;
				cmd.Parameters.Add("v_maicd",OracleType.VarChar,50).Value=v_maicd;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"v_ttrvds");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_ttrvds(string v_mmyy,long v_id,string v_mabn,long v_maql,long v_idkhoa,string v_giuong,string v_ngayvao,string v_ngayra,string v_chandoan,string v_maicd,string v_tenbs)
		{
			string xxx=user+v_mmyy+".pkg_vienphi.upd_ttrvds";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(xxx,con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("v_id",OracleType.Number).Value=v_id;
				cmd.Parameters.Add("v_mabn",OracleType.VarChar,8).Value=v_mabn;
				cmd.Parameters.Add("v_maql",OracleType.Number).Value=v_maql;
				cmd.Parameters.Add("v_idkhoa",OracleType.Number).Value=v_idkhoa;
				cmd.Parameters.Add("v_giuong",OracleType.VarChar,10).Value=v_giuong;
				cmd.Parameters.Add("v_ngayvao",OracleType.VarChar,16).Value=v_ngayvao;
				cmd.Parameters.Add("v_ngayra",OracleType.VarChar,16).Value=v_ngayra;
				cmd.Parameters.Add("v_chandoan",OracleType.NVarChar,500).Value=v_chandoan;
				cmd.Parameters.Add("v_maicd",OracleType.VarChar,50).Value=v_maicd;
				cmd.Parameters.Add("v_tenbs",OracleType.NVarChar,100).Value=v_tenbs;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"v_ttrvds");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_ttrvbhyt(string v_mmyy,long v_id,string v_sothe,int v_maphu,string v_tungay,string v_ngay,string v_mabv,string v_noigioithieu)
		{
			string xxx=user+v_mmyy+".pkg_vienphi.upd_ttrvbhyt";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(xxx,con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("v_id",OracleType.Number).Value=v_id;
				cmd.Parameters.Add("v_sothe",OracleType.VarChar,20).Value=v_sothe;
				cmd.Parameters.Add("v_maphu",OracleType.Number).Value=v_maphu;
				cmd.Parameters.Add("v_tungay",OracleType.VarChar,10).Value=v_tungay;
				cmd.Parameters.Add("v_ngay",OracleType.VarChar,10).Value=v_ngay;
				cmd.Parameters.Add("v_mabv",OracleType.VarChar,8).Value=v_mabv;
				cmd.Parameters.Add("v_noigioithieu",OracleType.VarChar,8).Value=v_noigioithieu;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"v_ttrvbhyt");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_miennoitru(string v_mmyy,long v_id,int v_lydo,string v_ghichu,int v_maduyet)
		{
			string xxx=user+v_mmyy+".pkg_vienphi.upd_miennoitru";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(xxx,con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("v_id",OracleType.Number).Value=v_id;
				cmd.Parameters.Add("v_lydo",OracleType.Number).Value=v_lydo;
				cmd.Parameters.Add("v_ghichu",OracleType.NVarChar,100).Value=v_ghichu;
				cmd.Parameters.Add("v_maduyet",OracleType.Number).Value=v_maduyet;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"v_miennoitru");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_vpkhoa(string v_mmyy,long v_id,string v_mabn,long v_maql,long v_idkhoa,string v_ngay,string v_makp,int v_madoituong,int v_mavp,decimal v_soluong,decimal v_dongia,decimal v_vattu,int v_userid,int v_buoi)
		{
			string xxx=user+v_mmyy+".pkg_vienphi.upd_vpkhoa";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(xxx,con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("v_id",OracleType.Number).Value=v_id;
				cmd.Parameters.Add("v_mabn",OracleType.VarChar,8).Value=v_mabn;
				cmd.Parameters.Add("v_maql",OracleType.Number).Value=v_maql;
				cmd.Parameters.Add("v_idkhoa",OracleType.Number).Value=v_idkhoa;
				cmd.Parameters.Add("v_ngay",OracleType.VarChar,16).Value=v_ngay;
				cmd.Parameters.Add("v_makp",OracleType.VarChar,2).Value=v_makp;
				cmd.Parameters.Add("v_madoituong",OracleType.Number).Value=v_madoituong;
				cmd.Parameters.Add("v_mavp",OracleType.Number).Value=v_mavp;
				cmd.Parameters.Add("v_soluong",OracleType.Number).Value=v_soluong;
				cmd.Parameters.Add("v_dongia",OracleType.Number).Value=v_dongia;
				cmd.Parameters.Add("v_vattu",OracleType.Number).Value=v_vattu;
				cmd.Parameters.Add("v_userid",OracleType.Number).Value=v_userid;
				cmd.Parameters.Add("v_buoi",OracleType.Number).Value=v_buoi;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"v_vpkhoa");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_lydomien(int v_id,string v_ten)
		{
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand("pkg_vienphi.upd_lydomien",con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("v_id",OracleType.Number).Value=v_id;
				cmd.Parameters.Add("v_ten",OracleType.NVarChar,100).Value=v_ten;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"v_lydomien");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_phieuchill(string v_mmyy,long v_id,long v_quyenso,long v_sobienlai,string v_ngay,string v_mabn,long v_maql,long v_idkhoa,string v_makp,string v_hoten,int v_loai,int v_loaibn,int v_userid)
		{
			string xxx=user+v_mmyy+".pkg_vienphi.upd_phieuchill";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(xxx,con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("v_id",OracleType.Number).Value=v_id;
				cmd.Parameters.Add("v_quyenso",OracleType.Number).Value=v_quyenso;
				cmd.Parameters.Add("v_sobienlai",OracleType.Number).Value=v_sobienlai;
				cmd.Parameters.Add("v_ngay",OracleType.VarChar,16).Value=v_ngay;
				cmd.Parameters.Add("v_mabn",OracleType.VarChar,8).Value=v_mabn;
				cmd.Parameters.Add("v_maql",OracleType.Number).Value=v_maql;
				cmd.Parameters.Add("v_idkhoa",OracleType.Number).Value=v_idkhoa;
				cmd.Parameters.Add("v_makp",OracleType.VarChar,2).Value=v_makp;
				cmd.Parameters.Add("v_hoten",OracleType.NVarChar,50).Value=v_hoten;
				cmd.Parameters.Add("v_loai",OracleType.Number).Value=v_loai;
				cmd.Parameters.Add("v_loaibn",OracleType.Number).Value=v_loaibn;
				cmd.Parameters.Add("v_userid",OracleType.Number).Value=v_userid;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"v_phieuchill");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_phieuchict(string v_mmyy,long v_id,int v_stt,int v_mavp,decimal v_sotien)
		{
			string xxx=user+v_mmyy+".pkg_vienphi.upd_phieuchict";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(xxx,con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("v_id",OracleType.Number).Value=v_id;
				cmd.Parameters.Add("v_stt",OracleType.Number).Value=v_stt;
				cmd.Parameters.Add("v_mavp",OracleType.Number).Value=v_mavp;
				cmd.Parameters.Add("v_sotien",OracleType.Number).Value=v_sotien;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"v_phieuchict");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}
		public bool upd_hc_thanhvien(long m_id,string m_manv)
		{
			sql = "update " + user + ".hc_thanhvien set manv=:m_manv";
			sql += " where id=:m_id and manv=:m_manv";
			if (con != null)
			{
				con.Close(); con.Dispose();
			}
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd = new OracleCommand(sql, con);
				cmd.CommandType = CommandType.Text;
				cmd.Parameters.Add("m_manv", OracleType.VarChar).Value = m_manv;
				cmd.Parameters.Add("m_id", OracleType.Number).Value = m_id;
				int irec = cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec == 0)
				{
					sql = "insert into " + user + ".hc_thanhvien(id,manv)";
					sql += " values (:m_id,:m_manv)";
					cmd = new OracleCommand(sql, con);
					cmd.CommandType = CommandType.Text;
					cmd.Parameters.Add("m_id", OracleType.Number).Value = m_id;
					cmd.Parameters.Add("m_manv", OracleType.VarChar).Value = m_manv;
					irec = cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch (Exception ex)
			{
				upd_error(ex.Message, sComputer, "hc_thanhvien");
				return false;
			}
			finally
			{
				con.Close(); con.Dispose();
			}
			return true;
		}
		public bool upd_hc_hoichan(long m_id, long m_maql, int m_loaiba, string m_ngay, string m_denngay, string m_machutoa,
			string m_mathuky, string m_tomtat, string m_ketluan, string m_huongdieutri,int m_userid, string m_tomtatcls)
		{

			sql = "update " + user + ".hc_hoichan set maql=:m_maql,loaiba=:m_loaiba,";
			sql += "ngay=to_date('"+m_ngay+"','dd/MM/yyyy hh24:mi'),denngay=to_date('"+m_denngay+"','dd/MM/yyyy hh24:mi'),machutoa=:m_machutoa,";
			sql += "mathuky=:m_mathuky,tomtat=:m_tomtat,ketluan=:m_ketluan,";
			sql += "huongdieutri=:m_huongdieutri,userid=:m_userid,tomtatcls=:m_tomtatcls ";
			sql += " where id=:m_id ";
			if (con != null)
			{
				con.Close(); con.Dispose();
			}
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd = new OracleCommand(sql, con);
				cmd.CommandType = CommandType.Text;
				cmd.Parameters.Add("m_maql", OracleType.Number).Value = m_maql;
				cmd.Parameters.Add("m_loaiba", OracleType.Number).Value = m_loaiba;
				cmd.Parameters.Add("m_machutoa", OracleType.VarChar).Value = (m_machutoa == ""?"" : m_machutoa);
				cmd.Parameters.Add("m_mathuky", OracleType.VarChar).Value = (m_mathuky == "" ? " " : m_mathuky);
				cmd.Parameters.Add("m_tomtat", OracleType.NVarChar).Value = (m_tomtat == "" ? " " : m_tomtat);
				cmd.Parameters.Add("m_ketluan", OracleType.NVarChar).Value = ( m_ketluan == "" ? " " : m_ketluan);
				cmd.Parameters.Add("m_huongdieutri", OracleType.NVarChar).Value = (m_huongdieutri == "" ? " " : m_huongdieutri);
				cmd.Parameters.Add("m_userid", OracleType.Number).Value = m_userid;
				cmd.Parameters.Add("m_tomtatcls", OracleType.NVarChar).Value = m_tomtatcls;
				cmd.Parameters.Add("m_id", OracleType.Number).Value = m_id;
				int irec = cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec == 0)
				{
					sql = "insert into " + user + ".hc_hoichan(id,maql,loaiba,ngay,denngay,machutoa,";
					sql += "mathuky,tomtat,ketluan,huongdieutri,ngayud,userid,tomtatcls)";
					sql += " values (:m_id,:m_maql,:m_loaiba,to_date('"+m_ngay+"','dd/mm/yyyy hh24:mi'),";
					sql += "to_date('"+m_denngay+"','dd/mm/yyyy hh24:mi'),:m_machutoa,:m_mathuky,";
					sql += ":m_tomtat,:m_ketluan,:m_huongdieutri,sysdate,:m_userid,:m_tomtatcls)";
					cmd = new OracleCommand(sql, con);
					cmd.CommandType = CommandType.Text;
					cmd.Parameters.Add("m_id", OracleType.Number).Value = m_id;
					cmd.Parameters.Add("m_maql", OracleType.Number).Value = m_maql;
					cmd.Parameters.Add("m_loaiba", OracleType.Number).Value = m_loaiba;
					cmd.Parameters.Add("m_machutoa", OracleType.VarChar).Value = (m_machutoa == ""?"" : m_machutoa);
					cmd.Parameters.Add("m_mathuky", OracleType.VarChar).Value = (m_mathuky == "" ? " " : m_mathuky);
					cmd.Parameters.Add("m_tomtat", OracleType.NVarChar).Value = (m_tomtat == "" ? " " : m_tomtat);
					cmd.Parameters.Add("m_ketluan", OracleType.NVarChar).Value = ( m_ketluan == "" ? " " : m_ketluan);
					cmd.Parameters.Add("m_huongdieutri", OracleType.NVarChar).Value = (m_huongdieutri == "" ? " " : m_huongdieutri);
					cmd.Parameters.Add("m_userid", OracleType.Number).Value = m_userid;
					cmd.Parameters.Add("m_tomtatcls", OracleType.NVarChar).Value = m_tomtatcls;
					irec = cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch (Exception ex)
			{
				upd_error(ex.Message, sComputer, "hc_hoichan");
				return false;
			}
			finally
			{
				con.Close(); con.Dispose();
			}
			return true;
		}
		public bool upd_phanungthuoc_adr(long m_id, string m_mabn, long m_maql, long m_mavaovien, string m_msbcdonvi
			, string m_msbctt, double m_cannang, double m_chieucao, string m_ngayphanung, string m_motaphanung,
			string m_chandoandieutri, string m_taisudungthuoc, int m_trieuchungcu, string m_thuocsudungdongthoi,
			string m_benhsulienquan, int m_userid, string m_ngaybaocao, int m_dangbaocao,string m_xetnghiem,string m_tgxhpu, int m_mdopu, int m_kqxtpu)
		{

			sql = "update " + user + ".phanungthuoc_adr set mabn=:m_mabn,maql=:m_maql,mavaovien=:m_mavaovien,";
			sql += "msbcdonvi=:m_msbcdonvi,msbctt=:m_msbctt,cannang=:m_cannang,chieucao=:m_chieucao";
			sql += ",ngayphanung=to_date('"+m_ngayphanung+"','dd/MM/yyyy hh24:mi'),motaphanung=:m_motaphanung,";
			sql += "chandoandieutri=:m_chandoandieutri,taisudungthuoc=:m_taisudungthuoc,trieuchungcu=:m_trieuchungcu,";
			sql += "thuocsudungdongthoi=:m_thuocsudungdongthoi,benhsulienquan=:m_benhsulienquan,";
			sql += "ngaybaocao=to_date('"+m_ngaybaocao+"','dd/MM/yyyy hh24:mi'),dangbaocao=:m_dangbaocao,xetnghiem=:m_xetnghiem,thoigianxuathienphanung=:m_tgxhpu,mucdopu=:m_mdopu,kqxutripu=:m_kqxtpu ";
			sql += " where id=:m_id ";
			if (con != null)
			{
				con.Close(); con.Dispose();
			}
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd = new OracleCommand(sql, con);
				cmd.CommandType = CommandType.Text;
				cmd.Parameters.Add("m_mabn", OracleType.VarChar).Value = (m_mabn == "" ? " " : m_mabn);
				cmd.Parameters.Add("m_maql", OracleType.Number).Value = m_maql;
				cmd.Parameters.Add("m_mavaovien", OracleType.Number).Value = m_mavaovien;
				cmd.Parameters.Add("m_msbcdonvi", OracleType.VarChar).Value = (m_msbcdonvi == "" ? " " : m_msbcdonvi);
				cmd.Parameters.Add("m_msbctt", OracleType.VarChar).Value = (m_msbctt == "" ? " " : m_msbctt);
				cmd.Parameters.Add("m_cannang", OracleType.Number).Value = m_cannang;
				cmd.Parameters.Add("m_chieucao", OracleType.Number).Value = m_chieucao;
				//cmd.Parameters.Add("m_ngayphanung", OracleType.VarChar).Value = (m_ngayphanung == "" ? " " : m_ngayphanung) ;
				cmd.Parameters.Add("m_motaphanung", OracleType.NVarChar).Value = (m_motaphanung == "" ? " " : m_motaphanung);
				cmd.Parameters.Add("m_chandoandieutri", OracleType.NVarChar).Value = ( m_chandoandieutri == "" ? " " : m_chandoandieutri);
				cmd.Parameters.Add("m_taisudungthuoc", OracleType.NVarChar).Value = (m_taisudungthuoc == "" ? " " : m_taisudungthuoc);
				cmd.Parameters.Add("m_trieuchungcu", OracleType.Number).Value = m_trieuchungcu;
				cmd.Parameters.Add("m_thuocsudungdongthoi", OracleType.NVarChar).Value = (m_thuocsudungdongthoi == "" ? " " :m_thuocsudungdongthoi);
				cmd.Parameters.Add("m_benhsulienquan", OracleType.NVarChar).Value = (m_benhsulienquan == "" ? " " : m_benhsulienquan);
				//cmd.Parameters.Add("m_ngaybaocao", OracleType.VarChar).Value = (m_ngaybaocao == "" ? " " : m_ngaybaocao);
				cmd.Parameters.Add("m_dangbaocao", OracleType.Number).Value = m_dangbaocao;
				cmd.Parameters.Add("m_xetnghiem", OracleType.VarChar).Value = (m_xetnghiem == "" ? " " : m_xetnghiem) ;
				cmd.Parameters.Add("m_tgxhpu", OracleType.VarChar).Value = (m_tgxhpu == "" ? " " : m_tgxhpu);
				cmd.Parameters.Add("m_mdopu", OracleType.Number).Value = m_mdopu;
				cmd.Parameters.Add("m_kqxtpu", OracleType.Number).Value = m_kqxtpu;
				cmd.Parameters.Add("m_id", OracleType.Number).Value = m_id;
				int irec = cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec == 0)
				{
					sql = "insert into " + user + ".phanungthuoc_adr(id,mabn,maql,mavaovien,msbcdonvi,msbctt,";
					sql += "cannang,chieucao,ngayphanung,motaphanung,chandoandieutri,taisudungthuoc,trieuchungcu,";
					sql += "thuocsudungdongthoi,benhsulienquan,userid,ngayud,ngaybaocao,dangbaocao,xetnghiem,thoigianxuathienphanung,mucdopu,kqxutripu)";
					sql += " values (:m_id,:m_mabn,:m_maql,:m_mavaovien,:m_msbcdonvi,:m_msbctt,:m_cannang,:m_chieucao";
					sql += ",to_date('"+m_ngayphanung+"','dd/mm/yyyy hh24:mi'),:m_motaphanung,:m_chandoandieutri,";
					sql += ":m_taisudungthuoc,:m_trieuchungcu,:m_thuocsudungdongthoi,:m_benhsulienquan,";
					sql += ":m_userid,sysdate,to_date('"+m_ngaybaocao+"','dd/mm/yyyy hh24:mi'),:m_dangbaocao,:m_xetnghiem,:m_tgxhpu,:m_mdopu,:m_kqxtpu)";
					cmd = new OracleCommand(sql, con);
					cmd.CommandType = CommandType.Text;
					cmd.Parameters.Add("m_id", OracleType.Number).Value = m_id;
					cmd.Parameters.Add("m_mabn", OracleType.VarChar).Value = (m_mabn == "" ? " " : m_mabn);
					cmd.Parameters.Add("m_maql", OracleType.Number).Value = m_maql;
					cmd.Parameters.Add("m_mavaovien", OracleType.Number).Value = m_mavaovien;
					cmd.Parameters.Add("m_msbcdonvi", OracleType.VarChar).Value = (m_msbcdonvi == "" ? " " : m_msbcdonvi);
					cmd.Parameters.Add("m_msbctt", OracleType.VarChar).Value = (m_msbctt == "" ? " " : m_msbctt);
					cmd.Parameters.Add("m_cannang", OracleType.Number).Value = m_cannang;
					cmd.Parameters.Add("m_chieucao", OracleType.Number).Value = m_chieucao;
					//cmd.Parameters.Add("m_ngayphanung", OracleType.VarChar).Value = (m_ngayphanung == "" ? " " : m_ngayphanung);
					cmd.Parameters.Add("m_motaphanung", OracleType.NVarChar).Value = (m_motaphanung == "" ? " " :m_motaphanung  );
					cmd.Parameters.Add("m_chandoandieutri", OracleType.NVarChar).Value = ( m_chandoandieutri == "" ? " " :m_chandoandieutri);
					cmd.Parameters.Add("m_taisudungthuoc", OracleType.NVarChar).Value = (m_taisudungthuoc == "" ? " " :m_taisudungthuoc);
					cmd.Parameters.Add("m_trieuchungcu", OracleType.Number).Value = m_trieuchungcu;
					cmd.Parameters.Add("m_thuocsudungdongthoi", OracleType.NVarChar).Value = (m_thuocsudungdongthoi == "" ? " " : m_thuocsudungdongthoi);
					cmd.Parameters.Add("m_benhsulienquan", OracleType.NVarChar).Value = (m_benhsulienquan == "" ? " " : m_benhsulienquan);
					cmd.Parameters.Add("m_userid", OracleType.Number).Value = m_userid;
					//cmd.Parameters.Add("m_ngaybaocao", OracleType.VarChar).Value = (m_ngaybaocao == "" ? " " : m_ngaybaocao);
					cmd.Parameters.Add("m_dangbaocao", OracleType.Number).Value = m_dangbaocao;
					cmd.Parameters.Add("m_xetnghiem", OracleType.VarChar).Value = (m_xetnghiem == "" ? " " : m_xetnghiem);
					cmd.Parameters.Add("m_tgxhpu", OracleType.VarChar).Value = (m_tgxhpu == "" ? " " : m_tgxhpu);
					cmd.Parameters.Add("m_mdopu", OracleType.Number).Value = m_mdopu;
					cmd.Parameters.Add("m_kqxtpu", OracleType.Number).Value = m_kqxtpu;
					irec = cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch (Exception ex)
			{
				upd_error(ex.Message, sComputer, "phanungthuoc_adr");
				return false;
			}
			finally
			{
				con.Close(); con.Dispose();
			}
			return true;
		}

		public bool upd_thuocnghingo_adr(long m_id, int m_stt, int m_mabd, string m_lieudungmotngay
			, int m_solantrongngay, string m_lydodungthuoc,string m_ngaybatdau, string m_ngayketthuc, string m_losx, int m_caithien,int m_taiphanung,int m_moilan,int m_userid)
		{
			sql = "update " + user + ".thuocnghingo_adr set mabd=:m_mabd,lieudungmotlan=:m_lieudungmotngay,";
			sql += "solantrongngay=:m_solantrongngay,lydodungthuoc =:m_lydodungthuoc,ngaybatdau=to_date(:m_ngaybatdau,'dd/MM/yyyy hh24:mi'),";
			sql += "ngayketthuc=to_date(:m_ngayketthuc,'dd/MM/yyyy hh24:mi'),losx=:m_losx,caithien=:m_caithien,taiphanung=:m_taiphanung,moilan=:m_moilan ";
			sql += " where id=:m_id and stt=:m_stt ";
			if (con != null)
			{
				con.Close(); con.Dispose();
			}
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd = new OracleCommand(sql, con);
				cmd.CommandType = CommandType.Text;
				cmd.Parameters.Add("m_mabd", OracleType.Number).Value = m_mabd;
				cmd.Parameters.Add("m_lieudungmotngay", OracleType.NVarChar).Value = (m_lieudungmotngay == "" ? " " : m_lieudungmotngay);
				cmd.Parameters.Add("m_solantrongngay", OracleType.Number).Value = m_solantrongngay;
				cmd.Parameters.Add("m_lydodungthuoc", OracleType.NVarChar).Value = (m_lydodungthuoc == "" ? " " : m_lydodungthuoc);
				cmd.Parameters.Add("m_ngaybatdau", OracleType.VarChar, 16).Value = (m_ngaybatdau == "" ? " " : m_ngaybatdau);
				if (m_ngayketthuc == "") cmd.Parameters.Add("m_ngayketthuc", OracleType.VarChar, 16).Value = DBNull.Value;
				else cmd.Parameters.Add("m_ngayketthuc", OracleType.VarChar, 16).Value = (m_ngayketthuc == "" ? " " : m_ngayketthuc);
				cmd.Parameters.Add("m_losx", OracleType.NVarChar).Value = (m_losx == "" ? " " : m_losx);
				cmd.Parameters.Add("m_caithien", OracleType.Number).Value = m_caithien;
				cmd.Parameters.Add("m_taiphanung", OracleType.Number).Value = m_taiphanung;
				cmd.Parameters.Add("m_moilan", OracleType.Number).Value = m_moilan;
				cmd.Parameters.Add("m_id", OracleType.Number).Value = m_id;
				cmd.Parameters.Add("m_stt", OracleType.Number).Value = m_stt;
				int irec = cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec == 0)
				{
					sql = "insert into " + user + ".thuocnghingo_adr(id,stt,mabd,lieudungmotlan,solantrongngay,lydodungthuoc,";
					sql += "ngaybatdau,ngayketthuc,losx,userid,ngayud,caithien,taiphanung,moilan)";
					sql += " values (:m_id,:m_stt,:m_mabd,:m_lieudungmotngay,";
					sql += ":m_solantrongngay,:m_lydodungthuoc,to_date(:m_ngaybatdau,'dd/MM/yyyy hh24:mi'),";
					sql += "to_date(:m_ngayketthuc,'dd/MM/yyyy hh24:mi'),:m_losx,:m_userid,sysdate,:m_caithien,:m_taiphanung,:m_moilan)";
					cmd = new OracleCommand(sql, con);
					cmd.CommandType = CommandType.Text;
					cmd.Parameters.Add("m_id", OracleType.Number).Value = m_id;
					cmd.Parameters.Add("m_stt", OracleType.Number).Value = m_stt;
					cmd.Parameters.Add("m_mabd", OracleType.Number).Value = m_mabd;
					cmd.Parameters.Add("m_lieudungmotngay", OracleType.NVarChar).Value = (m_lieudungmotngay == "" ? " " : m_lieudungmotngay);
					cmd.Parameters.Add("m_solantrongngay", OracleType.Number).Value = m_solantrongngay;
					cmd.Parameters.Add("m_lydodungthuoc", OracleType.NVarChar).Value = (m_lydodungthuoc == "" ? " " : m_lydodungthuoc);
					cmd.Parameters.Add("m_ngaybatdau", OracleType.VarChar, 16).Value = (m_ngaybatdau == "" ? " " : m_ngaybatdau);
					if (m_ngayketthuc == "") cmd.Parameters.Add("m_ngayketthuc", OracleType.VarChar, 16).Value = DBNull.Value;
					else cmd.Parameters.Add("m_ngayketthuc", OracleType.VarChar, 16).Value = m_ngayketthuc;
					cmd.Parameters.Add("m_losx", OracleType.NVarChar).Value = (m_losx == "" ? " " : m_losx);
					cmd.Parameters.Add("m_userid", OracleType.Number).Value = m_userid;
					cmd.Parameters.Add("m_caithien", OracleType.Number).Value = m_caithien;
					cmd.Parameters.Add("m_taiphanung", OracleType.Number).Value = m_taiphanung;
					cmd.Parameters.Add("m_moilan", OracleType.Number).Value = m_moilan;
					irec = cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch (Exception ex)
			{
				upd_error(ex.Message, sComputer, "thuocnghingo_adr");
				return false;
			}
			finally
			{
				con.Close(); con.Dispose();
			}
			return true;
		}
		public bool upd_thuocsudungdongthoi(long m_id, int m_stt, int m_mabd, string m_ngaybatdau, string m_ngayketthuc, int m_userid)
		{
			sql = "update " + user + ".thuocsudungdongthoi set mabd=:m_mabd,";
			sql += "ngaybatdau=to_date(:m_ngaybatdau,'dd/MM/yyyy hh24:mi'),";
			sql += "ngayketthuc=to_date(:m_ngayketthuc,'dd/MM/yyyy hh24:mi') ";
			sql += " where id=:m_id and stt=:m_stt ";
			if (con != null)
			{
				con.Close(); con.Dispose();
			}
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd = new OracleCommand(sql, con);
				cmd.CommandType = CommandType.Text;
				cmd.Parameters.Add("m_mabd", OracleType.Number).Value = m_mabd;
				cmd.Parameters.Add("m_ngaybatdau", OracleType.VarChar, 16).Value = (m_ngaybatdau == "" ? " " : m_ngaybatdau);
				if (m_ngayketthuc == "") cmd.Parameters.Add("m_ngayketthuc", OracleType.VarChar, 16).Value = DBNull.Value;
				else cmd.Parameters.Add("m_ngayketthuc", OracleType.VarChar, 16).Value = m_ngayketthuc;
				cmd.Parameters.Add("m_id", OracleType.Number).Value = m_id;
				cmd.Parameters.Add("m_stt", OracleType.Number).Value = m_stt;
				int irec = cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec == 0)
				{
					sql = "insert into " + user + ".thuocsudungdongthoi(id,stt,mabd,";
					sql += "ngaybatdau,ngayketthuc,userid,ngayud)";
					sql += " values (:m_id,:m_stt,:m_mabd,";
					sql += "to_date(:m_ngaybatdau,'dd/MM/yyyy hh24:mi'),";
					sql += "to_date(:m_ngayketthuc,'dd/MM/yyyy hh24:mi'),:m_userid,sysdate)";
					cmd = new OracleCommand(sql, con);
					cmd.CommandType = CommandType.Text;
					cmd.Parameters.Add("m_id", OracleType.Number).Value = m_id;
					cmd.Parameters.Add("m_stt", OracleType.Number).Value = m_stt;
					cmd.Parameters.Add("m_mabd", OracleType.Number).Value = m_mabd;
					cmd.Parameters.Add("m_ngaybatdau", OracleType.VarChar, 16).Value = (m_ngaybatdau == "" ? " " : m_ngaybatdau);
					if (m_ngayketthuc == "") cmd.Parameters.Add("m_ngayketthuc", OracleType.VarChar, 16).Value = DBNull.Value;
					else cmd.Parameters.Add("m_ngayketthuc", OracleType.VarChar, 16).Value = m_ngayketthuc;
              
					cmd.Parameters.Add("m_userid", OracleType.Number).Value = m_userid;
					irec = cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch (Exception ex)
			{
				upd_error(ex.Message, sComputer, "thuocsudungdongthoi");
				return false;
			}
			finally
			{
				con.Close(); con.Dispose();
			}
			return true;
		}
		public bool upd_xutri_adr(long m_id, string m_ngungdungthuoc, int m_ngung_tientrien, int m_ngung_dieutri
			, string m_sudungthuockhac, int m_sudung_tientrien, int m_sudung_dieutri, int m_ketquaxutriadr,
			string m_bsbinhluan, int m_thamdinhadr_dvyte, int m_thamdinhadr_chuyengia, string m_ykienchuyengia,
			int m_userid)
		{
			sql = "update " + user + ".xutri_adr set ngungdungthuoc=:m_ngungdungthuoc,ngung_tientrien=:m_ngung_tientrien,";
			sql += "ngung_dieutri=:m_ngung_dieutri,sudungthuockhac=:m_sudungthuockhac,sudung_tientrien=:m_sudung_tientrien,";
			sql += "sudung_dieutri=:m_sudung_dieutri,ketquaxutriadr=:m_ketquaxutriadr,bsbinhluan=:m_bsbinhluan,";
			sql += "thamdinhadr_dvyte=:m_thamdinhadr_dvyte,thamdinhadr_chuyengia=:m_thamdinhadr_chuyengia,";
			sql += "ykienchuyengia=:m_ykienchuyengia ";
			sql += " where id=:m_id ";
			if (con != null)
			{
				con.Close(); con.Dispose();
			}
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd = new OracleCommand(sql, con);
				cmd.CommandType = CommandType.Text;
				cmd.Parameters.Add("m_ngungdungthuoc", OracleType.VarChar).Value = (m_ngungdungthuoc == "" ? " " : m_ngungdungthuoc);
				cmd.Parameters.Add("m_ngung_tientrien", OracleType.VarChar).Value = m_ngung_tientrien;
				cmd.Parameters.Add("m_ngung_dieutri", OracleType.Number).Value = m_ngung_dieutri;
				cmd.Parameters.Add("m_sudungthuockhac", OracleType.NVarChar).Value = (m_sudungthuockhac == "" ? " " :m_sudungthuockhac);
				cmd.Parameters.Add("m_sudung_tientrien", OracleType.Number).Value = m_sudung_tientrien;
				cmd.Parameters.Add("m_sudung_dieutri", OracleType.Number).Value = m_sudung_dieutri;
				cmd.Parameters.Add("m_ketquaxutriadr", OracleType.Number).Value = m_ketquaxutriadr;
				cmd.Parameters.Add("m_bsbinhluan", OracleType.NVarChar).Value = (m_bsbinhluan == "" ? " " :m_bsbinhluan);
				cmd.Parameters.Add("m_thamdinhadr_dvyte", OracleType.Number).Value = m_thamdinhadr_dvyte;
				cmd.Parameters.Add("m_thamdinhadr_chuyengia", OracleType.Number).Value =m_thamdinhadr_chuyengia;
				cmd.Parameters.Add("m_ykienchuyengia", OracleType.NVarChar).Value = (m_ykienchuyengia == "" ? " " : m_ykienchuyengia);
				cmd.Parameters.Add("m_id", OracleType.Number).Value = m_id;
				int irec = cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec == 0)
				{
					sql = "insert into " + user + ".xutri_adr(id,ngungdungthuoc,ngung_tientrien,ngung_dieutri,";
					sql += "sudungthuockhac,sudung_tientrien,sudung_dieutri,ketquaxutriadr,bsbinhluan,";
					sql += "thamdinhadr_dvyte,thamdinhadr_chuyengia,ykienchuyengia)";
					sql += " values (:m_id,:m_ngungdungthuoc,:m_ngung_tientrien,:m_ngung_dieutri,";
					sql += ":m_sudungthuockhac,:m_sudung_tientrien,:m_sudung_dieutri,:m_ketquaxutriadr,:m_bsbinhluan,";
					sql += ":m_thamdinhadr_dvyte,:m_thamdinhadr_chuyengia,:m_ykienchuyengia)";
					cmd = new OracleCommand(sql, con);
					cmd.CommandType = CommandType.Text;
					cmd.Parameters.Add("m_id", OracleType.Number).Value = m_id;
					cmd.Parameters.Add("m_ngungdungthuoc", OracleType.VarChar).Value = (m_ngungdungthuoc == "" ? " " : m_ngungdungthuoc);
					cmd.Parameters.Add("m_ngung_tientrien", OracleType.Number).Value = m_ngung_tientrien;
					cmd.Parameters.Add("m_ngung_dieutri", OracleType.Number).Value = m_ngung_dieutri;
					cmd.Parameters.Add("m_sudungthuockhac", OracleType.NVarChar).Value = (m_sudungthuockhac == "" ? " " : m_sudungthuockhac);
					cmd.Parameters.Add("m_sudung_tientrien", OracleType.Number).Value = m_sudung_tientrien;
					cmd.Parameters.Add("m_sudung_dieutri", OracleType.Number).Value = m_sudung_dieutri;
					cmd.Parameters.Add("m_ketquaxutriadr", OracleType.Number).Value = m_ketquaxutriadr;
					cmd.Parameters.Add("m_bsbinhluan", OracleType.NVarChar).Value = (m_bsbinhluan == "" ? " " : m_bsbinhluan);
					cmd.Parameters.Add("m_thamdinhadr_dvyte", OracleType.Number).Value = m_thamdinhadr_dvyte;
					cmd.Parameters.Add("m_thamdinhadr_chuyengia", OracleType.Number).Value =m_thamdinhadr_chuyengia;
					cmd.Parameters.Add("m_ykienchuyengia", OracleType.NVarChar).Value = (m_ykienchuyengia == "" ? " " : m_ykienchuyengia );
					irec = cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch (Exception ex)
			{
				upd_error(ex.Message, sComputer, "xutri_adr");
				return false;
			}
			finally
			{
				con.Close(); con.Dispose();
			}
			return true;
		}


		public bool upd_lydonopthem(long v_id,int v_id_lydo)
		{
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand("pkg_vienphi.upd_lydonopthem",con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("v_id",OracleType.Number).Value=v_id;
				cmd.Parameters.Add("v_id_lydo",OracleType.Number).Value=v_id_lydo;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"v_lydonopthem");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_lydothieu(long v_id,int v_id_lydo)
		{
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand("pkg_vienphi.upd_lydothieu",con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("v_id",OracleType.Number).Value=v_id;
				cmd.Parameters.Add("v_id_lydo",OracleType.Number).Value=v_id_lydo;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"v_lydothieu");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}
		public bool upd_dmlydonopthem(long v_id,string v_ten)
		{
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand("pkg_vienphi.upd_dmlydonopthem",con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("v_id",OracleType.Number).Value=v_id;
				cmd.Parameters.Add("v_ten",OracleType.NVarChar,50).Value=v_ten;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"v_dmlydonopthem");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_dmlydothieu(long v_id,string v_ten)
		{
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand("pkg_vienphi.upd_dmlydothieu",con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("v_id",OracleType.Number).Value=v_id;
				cmd.Parameters.Add("v_ten",OracleType.NVarChar,50).Value=v_ten;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"v_dmlydothieu");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_thvpll(string v_mmyy,long v_id,string v_mabn,long v_maql,long v_idkhoa,string v_ngayvao,string v_ngayra,string v_giuong,string v_makp,string v_chandoan,string v_maicd,decimal v_sotien,decimal v_tamung,decimal v_bhyt,decimal v_mien,int v_khu)
		{
			string xxx=user+v_mmyy+".pkg_vienphi.upd_thvpll";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(xxx,con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("v_id",OracleType.Number).Value=v_id;
				cmd.Parameters.Add("v_mabn",OracleType.VarChar,8).Value=v_mabn;
				cmd.Parameters.Add("v_maql",OracleType.Number).Value=v_maql;
				cmd.Parameters.Add("v_idkhoa",OracleType.Number).Value=v_idkhoa;
				cmd.Parameters.Add("v_ngayvao",OracleType.VarChar,16).Value=v_ngayvao;
				cmd.Parameters.Add("v_ngayra",OracleType.VarChar,16).Value=v_ngayra;
				cmd.Parameters.Add("v_giuong",OracleType.VarChar,50).Value=v_giuong;
				cmd.Parameters.Add("v_makp",OracleType.VarChar,2).Value=v_makp;
				cmd.Parameters.Add("v_chandoan",OracleType.NVarChar,500).Value=v_chandoan;
				cmd.Parameters.Add("v_maicd",OracleType.VarChar,50).Value=v_maicd;
				cmd.Parameters.Add("v_sotien",OracleType.Number).Value=v_sotien;
				cmd.Parameters.Add("v_tamung",OracleType.Number).Value=v_tamung;
				cmd.Parameters.Add("v_bhyt",OracleType.Number).Value=v_bhyt;
				cmd.Parameters.Add("v_mien",OracleType.Number).Value=v_mien;
				cmd.Parameters.Add("v_khu",OracleType.Number).Value=v_khu;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"v_thvpll");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_giavp(long v_id,long v_id_loai,int v_stt,string v_ma,string v_ten,string v_dvt,decimal v_gia_th,decimal v_gia_bh,decimal v_gia_dv,decimal v_gia_nn,int v_bhyt,int v_userid,decimal v_vattu_th,decimal v_vattu_bh,decimal v_vattu_dv,decimal v_vattu_nn,int v_loaibn,int v_theobs,int v_chenhlech)
		{
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand("pkg_vienphi.upd_giavp",con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("v_id",OracleType.Number).Value=v_id;
				cmd.Parameters.Add("v_id_loai",OracleType.Number).Value=v_id_loai;
				cmd.Parameters.Add("v_stt",OracleType.Number).Value=v_stt;
				cmd.Parameters.Add("v_ma",OracleType.NVarChar,50).Value=v_ma;
				cmd.Parameters.Add("v_ten",OracleType.NVarChar,254).Value=v_ten;
				cmd.Parameters.Add("v_dvt",OracleType.NVarChar,20).Value=v_dvt;
				cmd.Parameters.Add("v_gia_th",OracleType.Number).Value=v_gia_th;
				cmd.Parameters.Add("v_gia_bh",OracleType.Number).Value=v_gia_bh;
				cmd.Parameters.Add("v_gia_dv",OracleType.Number).Value=v_gia_dv;
				cmd.Parameters.Add("v_gia_nn",OracleType.Number).Value=v_gia_nn;
				cmd.Parameters.Add("v_bhyt",OracleType.Number).Value=v_bhyt;
				cmd.Parameters.Add("v_userid",OracleType.Number).Value=v_userid;
				cmd.Parameters.Add("v_vattu_th",OracleType.Number).Value=v_vattu_th;
				cmd.Parameters.Add("v_vattu_bh",OracleType.Number).Value=v_vattu_bh;
				cmd.Parameters.Add("v_vattu_dv",OracleType.Number).Value=v_vattu_dv;
				cmd.Parameters.Add("v_vattu_nn",OracleType.Number).Value=v_vattu_nn;
				cmd.Parameters.Add("v_loaibn",OracleType.Number).Value=v_loaibn;
				cmd.Parameters.Add("v_theobs",OracleType.Number).Value=v_theobs;
				cmd.Parameters.Add("v_chenhlech",OracleType.Number).Value=v_chenhlech;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"v_giavp");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}
		public bool upd_thvpct(string v_mmyy,long v_id,string v_ngay,string v_makp,int v_madoituong,long v_mavp,decimal v_soluong,
			decimal v_dongia,decimal v_sotien,decimal v_vattu,string v_sothe,decimal v_id_ktcao)
		{
			//ThanhCuong 29/02/2012
			string xxx=user+v_mmyy;//+".pkg_vienphi.upd_thvpct";
			sql="update "+xxx+".v_thvpct set soluong=soluong+:v_soluong,sotien=sotien+:v_sotien,vattu=:v_vattu where id=:v_id and to_char(ngay,'dd/MM/yyyy')=:v_ngay and makp=:v_makp and madoituong=:v_madoituong and mavp=:v_mavp and dongia=:v_dongia and id_ktcao=:v_id_ktcao";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("v_soluong",OracleType.Number).Value=v_soluong;
				cmd.Parameters.Add("v_sotien",OracleType.Number).Value=v_sotien;
				cmd.Parameters.Add("v_vattu",OracleType.Number).Value=v_vattu;
				cmd.Parameters.Add("v_id",OracleType.Number).Value=v_id;
				cmd.Parameters.Add("v_ngay",OracleType.VarChar,10).Value=v_ngay;
				cmd.Parameters.Add("v_makp",OracleType.VarChar,2).Value=v_makp;
				cmd.Parameters.Add("v_madoituong",OracleType.Number).Value=v_madoituong;
				cmd.Parameters.Add("v_mavp",OracleType.Number).Value=v_mavp;
				cmd.Parameters.Add("v_dongia",OracleType.Number).Value=v_dongia;
				cmd.Parameters.Add("v_id_ktcao",OracleType.Number).Value=v_id_ktcao;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".v_thvpct(id,ngay,makp,madoituong,mavp,soluong,dongia,sotien,vattu,sothe,id_ktcao) values (:v_id,to_date(:v_ngay,'dd/MM/yyyy'),:v_makp,:v_madoituong,:v_mavp,:v_soluong,:v_dongia,:v_sotien,:v_vattu,:v_sothe,:v_id_ktcao)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("v_id",OracleType.Number).Value=v_id;
					cmd.Parameters.Add("v_ngay",OracleType.VarChar,10).Value=v_ngay;
					cmd.Parameters.Add("v_makp",OracleType.VarChar,2).Value=v_makp;
					cmd.Parameters.Add("v_madoituong",OracleType.Number).Value=v_madoituong;
					cmd.Parameters.Add("v_mavp",OracleType.Number).Value=v_mavp;
					cmd.Parameters.Add("v_soluong",OracleType.Number).Value=v_soluong;
					cmd.Parameters.Add("v_dongia",OracleType.Number).Value=v_dongia;
					cmd.Parameters.Add("v_sotien",OracleType.Number).Value=v_sotien;
					cmd.Parameters.Add("v_vattu",OracleType.Number).Value=v_vattu;
					cmd.Parameters.Add("v_sothe",OracleType.VarChar,20).Value=v_sothe;
					cmd.Parameters.Add("v_id_ktcao",OracleType.Number).Value=v_id_ktcao;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"v_thvpct");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}
		public bool upd_thvpct(string v_mmyy,long v_id,string v_ngay,string v_makp,int v_madoituong,long v_mavp,decimal v_soluong,
			decimal v_dongia,decimal v_sotien,decimal v_vattu,string v_sothe)
		{
			string xxx=user+v_mmyy+".pkg_vienphi.upd_thvpct";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(xxx,con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("v_id",OracleType.Number).Value=v_id;
				cmd.Parameters.Add("v_ngay",OracleType.VarChar,10).Value=v_ngay;
				cmd.Parameters.Add("v_makp",OracleType.VarChar,2).Value=v_makp;
				cmd.Parameters.Add("v_madoituong",OracleType.Number).Value=v_madoituong;
				cmd.Parameters.Add("v_mavp",OracleType.Number).Value=v_mavp;
				cmd.Parameters.Add("v_soluong",OracleType.Number).Value=v_soluong;
				cmd.Parameters.Add("v_dongia",OracleType.Number).Value=v_dongia;
				cmd.Parameters.Add("v_sotien",OracleType.Number).Value=v_sotien;
				cmd.Parameters.Add("v_vattu",OracleType.Number).Value=v_vattu;
				cmd.Parameters.Add("v_sothe",OracleType.VarChar,20).Value=v_sothe;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"v_thvpct");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}
		public bool upd_thvpbhyt(string v_mmyy,long v_id,string v_sothe,int v_maphu,string v_noigioithieu,
			string v_noicap,int v_traituyen)
		{
			string xxx=user+v_mmyy+".pkg_vienphi.upd_thvpbhyt";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(xxx,con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("v_id",OracleType.Number).Value=v_id;
				cmd.Parameters.Add("v_sothe",OracleType.VarChar,20).Value=v_sothe;
				cmd.Parameters.Add("v_maphu",OracleType.Number).Value=v_maphu;
				cmd.Parameters.Add("v_noigioithieu",OracleType.VarChar,8).Value=v_noigioithieu;
				cmd.Parameters.Add("v_noicap",OracleType.VarChar,8).Value=v_noicap;
				cmd.Parameters.Add("v_traituyen",OracleType.Number).Value=v_traituyen;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"v_thvpbhyt");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_paid(string v_mabn,long v_maql,long v_idkhoa,string v_ngayvao,string v_ngayra)
		{
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand("pkg_vienphi.upd_paid",con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("v_mabn",OracleType.VarChar,8).Value=v_mabn;
				cmd.Parameters.Add("v_maql",OracleType.Number).Value=v_maql;
				cmd.Parameters.Add("v_idkhoa",OracleType.Number).Value=v_idkhoa;
				cmd.Parameters.Add("v_ngayvao",OracleType.VarChar,16).Value=v_ngayvao;
				cmd.Parameters.Add("v_ngayra",OracleType.VarChar,16).Value=v_ngayra;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"v_paid");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_thngayll(string v_mmyy,long v_id,int v_madoituong,string v_mabn,long v_maql,string v_ngayvao,string v_tu,string v_den,string v_giuong,string v_makp)
		{
			string xxx=user+v_mmyy+".pkg_vienphi.upd_thngayll";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(xxx,con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("v_id",OracleType.Number).Value=v_id;
				cmd.Parameters.Add("v_madoituong",OracleType.Number).Value=v_madoituong;
				cmd.Parameters.Add("v_mabn",OracleType.VarChar,8).Value=v_mabn;
				cmd.Parameters.Add("v_maql",OracleType.Number).Value=v_maql;
				cmd.Parameters.Add("v_ngayvao",OracleType.VarChar,10).Value=v_ngayvao;
				cmd.Parameters.Add("v_tu",OracleType.VarChar,10).Value=v_tu;
				cmd.Parameters.Add("v_den",OracleType.VarChar,10).Value=v_den;
				cmd.Parameters.Add("v_giuong",OracleType.VarChar,10).Value=v_giuong;
				cmd.Parameters.Add("v_makp",OracleType.VarChar,2).Value=v_makp;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"v_thngayll");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_thngayct(string v_mmyy,long v_id,string v_ngay,long v_mavp,decimal v_soluong,decimal v_dongia,decimal v_sotien)
		{
			string xxx=user+v_mmyy+".pkg_vienphi.upd_thngayct";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(xxx,con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("v_id",OracleType.Number).Value=v_id;
				cmd.Parameters.Add("v_ngay",OracleType.VarChar,10).Value=v_ngay;
				cmd.Parameters.Add("v_mavp",OracleType.Number).Value=v_mavp;
				cmd.Parameters.Add("v_soluong",OracleType.Number).Value=v_soluong;
				cmd.Parameters.Add("v_dongia",OracleType.Number).Value=v_dongia;
				cmd.Parameters.Add("v_sotien",OracleType.Number).Value=v_sotien;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"v_thngayct");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}
	
		public bool upd_ghichu(int v_id,string v_ten)
		{
			sql="update v_ghichu set ten=:v_ten where id=:v_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("v_ten",OracleType.NVarChar,50).Value=v_ten;
				cmd.Parameters.Add("v_id",OracleType.Number).Value=v_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into v_ghichu (id,ten) values (:v_id,:v_ten)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("v_ten",OracleType.NVarChar,50).Value=v_ten;
					cmd.Parameters.Add("v_id",OracleType.Number).Value=v_id;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim(),sComputer,"v_ghichu");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}		
			return true;
		}

		public DataSet get_vienphi(string tu,string den,string str)
		{
			DataSet tmp = new DataSet();
			DateTime dt1 = StringToDate(tu);
			DateTime dt2 = StringToDate(den);
			int y1 = dt1.Year, m1 = dt1.Month;
			int y2 = dt2.Year, m2 = dt2.Month;
			int itu, iden;
			string mmyy = "";
			bool be = true;
			for (int i = y1; i <= y2; i++)
			{
				itu = (i == y1) ? m1 : 1;
				iden = (i == y2) ? m2 : 12;
				for (int j = itu; j <= iden; j++)
				{
					mmyy = j.ToString().PadLeft(2, '0') + i.ToString().Substring(2, 2);
					if (bMmyy(mmyy))
					{
						sql = str.Replace("xxx", user + mmyy);
						if (be)
						{
							tmp = get_data(sql);
							be = false;
						}
						else tmp.Merge(get_data(sql));
					}
				}
			}
			return tmp;
		}
	
		public bool upd_huybienlai(long v_id,string v_tables,int v_loai,string v_mabn,string v_hoten,string v_makp,string v_ngay,long v_quyenso,long v_sobienlai,string v_lydo,int v_userid)
		{
			string xxx=user+mmyy(v_ngay)+".pkg_vienphi.upd_huybienlai";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(xxx,con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("v_id",OracleType.Number).Value=v_id;
				cmd.Parameters.Add("v_tables",OracleType.VarChar,20).Value=v_tables;
				cmd.Parameters.Add("v_loai",OracleType.Number).Value=v_loai;
				cmd.Parameters.Add("v_mabn",OracleType.VarChar,8).Value=v_mabn;
				cmd.Parameters.Add("v_hoten",OracleType.NVarChar,70).Value=v_hoten;
				cmd.Parameters.Add("v_makp",OracleType.VarChar,2).Value=v_makp;
				cmd.Parameters.Add("v_ngay",OracleType.VarChar,10).Value=v_ngay;
				cmd.Parameters.Add("v_quyenso",OracleType.Number).Value=v_quyenso;
				cmd.Parameters.Add("v_sobienlai",OracleType.Number).Value=v_sobienlai;
				cmd.Parameters.Add("v_userid",OracleType.Number).Value=v_userid;
				cmd.Parameters.Add("v_lydo",OracleType.NVarChar,100).Value=v_lydo;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"v_huybienlai");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool kiemtra_sobienlai(long id,string ngay,long quyenso,long sobienlai,int userid)
		{
			sql="select sobienlai from "+user+mmyy(ngay)+".v_vienphill where id<>"+id+" and to_char(ngay,'dd/MM/yyyy')='"+ngay+"' and quyenso="+quyenso+" and sobienlai="+sobienlai+" and userid="+userid;
			return get_data(sql).Tables[0].Rows.Count>0;
		}


		public bool upd_tamungcd(long v_id,string v_mabn,long v_mavaovien,long v_maql,long v_idkhoa,string v_makp,string v_ngay,int v_madoituong,int v_loai,int v_loaibn,string v_ten,decimal v_sotien,int v_userid)
		{
			string xxx=user+mmyy(v_ngay)+".pkg_vienphi.upd_tamungcd";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(xxx,con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("v_id",OracleType.Number).Value=v_id;
				cmd.Parameters.Add("v_mabn",OracleType.VarChar,8).Value=v_mabn;
				cmd.Parameters.Add("v_mavaovien",OracleType.Number).Value=v_mavaovien;
				cmd.Parameters.Add("v_maql",OracleType.Number).Value=v_maql;
				cmd.Parameters.Add("v_idkhoa",OracleType.Number).Value=v_idkhoa;
				cmd.Parameters.Add("v_makp",OracleType.VarChar,2).Value=v_makp;
				cmd.Parameters.Add("v_ngay",OracleType.VarChar,16).Value=v_ngay;			
				cmd.Parameters.Add("v_madoituong",OracleType.Number).Value=v_madoituong;
				cmd.Parameters.Add("v_loai",OracleType.Number).Value=v_loai;
				cmd.Parameters.Add("v_loaibn",OracleType.Number).Value=v_loaibn;
				cmd.Parameters.Add("v_ten",OracleType.NVarChar,100).Value=v_ten;
				cmd.Parameters.Add("v_sotien",OracleType.Number).Value=v_sotien;
				cmd.Parameters.Add("v_userid",OracleType.Number).Value=v_userid;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"v_tamungcd");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}
		public long getidyymmdd_v(int id)
		{
			return long.Parse(getyymmdd() + get_capid_may_v(id, sComputer).ToString().PadLeft(9, '0') + iRownum.ToString().PadLeft(3, '0'));
		}
		public bool bThongtu14
		{
			get
			{
				ds=get_data("select ten from v_thongso where id=31");
				if (ds.Tables[0].Rows.Count==0) return false;
				else return ds.Tables[0].Rows[0]["ten"].ToString().Trim()=="1";
			}
		}

		public bool bThongtu03
		{
			get
			{
				ds=get_data("select ten from v_thongso where id=71");
				if (ds.Tables[0].Rows.Count==0) return false;
				else return ds.Tables[0].Rows[0]["ten"].ToString().Trim()=="1";
			}
		}
		public int iNoitru{get{return 1;}}
		public int iNgoaitru{get{return 2;}}
		public int Nhom_khac
		{
			get
			{
				try
				{
					ds=get_data("select ten from v_thongso where id=48");
					if (ds.Tables[0].Rows.Count==0) return 0;
					else return int.Parse(ds.Tables[0].Rows[0]["ten"].ToString().Trim());
				}
				catch{return 0;}
			}
		}
		public long Tienkhac
		{
			get
			{
				ds=get_data("select ten from v_thongso where id=44");
				if (ds.Tables[0].Rows.Count==0) return 5000;
				else return int.Parse(ds.Tables[0].Rows[0]["ten"].ToString().Trim());
			}
		}
		#endregion

		#region duoc
		public string thetunguyen(int d_nhom)
		{
			ds=get_data("select ten from d_thongso where id=120 and nhom="+d_nhom);
			if (ds.Tables[0].Rows.Count==0) return "SS,RR,TT";
			return ds.Tables[0].Rows[0][0].ToString();
		}

		public string thetunguyen_vitri(int d_nhom)
		{
			string ret="4,2";
			ds=get_data("select ten from d_thongso where id=121 and nhom="+d_nhom);
			if (ds.Tables[0].Rows.Count>0)
			{
				ret=ds.Tables[0].Rows[0][0].ToString().Trim();
				int pos=ret.IndexOf(",");
				if (pos!=-1)
				{
					int p1=int.Parse(ret.Substring(0,pos))-1;
					int p2=int.Parse(ret.Substring(pos+1));
					ret=p1.ToString()+","+p2.ToString();
				}
			}
			return ret;
		}
		public string thetunguyen_vitri_ora(int d_nhom)
		{
			string ret="5,2";
			ds=get_data("select ten from d_thongso where id=121 and nhom="+d_nhom);
			if (ds.Tables[0].Rows.Count>0) ret=ds.Tables[0].Rows[0][0].ToString().Trim();
			return ret;
		}

		public bool dbMmyy(string mmyy)
		{
			return get_data("select * from d_table where mmyy='"+mmyy+"'").Tables[0].Rows.Count>0;
		}

		public int get_maphu_ngtru(string sothe,decimal sotien,int nhom,string ngay)
		{
			decimal m13_st=ma13_st(nhom),m16_st=ma16_st(nhom);
			int m131=4,m132=1,m161=4,m162=2,pos=0;
			string ma13=ma13_vitri.ToString(),ma16=ma16_vitri.ToString();			
			try
			{
				if (ma13!="")
				{
					pos=ma13.IndexOf(",");
					if (pos!=-1)
					{
						m131=int.Parse(ma13.Substring(0,pos))-1;
						m132=int.Parse(ma13.Substring(pos+1));
					}
				}
				if (ma16!="")
				{
					pos=ma16.IndexOf(",");
					if (pos!=-1)
					{
						m161=int.Parse(ma16.Substring(0,pos))-1;
						m162=int.Parse(ma16.Substring(pos+1));
					}
				}
			}
			catch{m131=4;m132=1;m161=4;m162=2;}
			int ma=get_maphu(sothe,ngay);
			if (sothe.Trim().Length==18 || sothe.Trim().Length==13)	return (ma!=0 && sotien>m16_st)?ma:0;//
			else if (sothe.Trim().Length==16) return 0;
			else if (sothe.Trim().Length>m131)	return (ma!=0 && sotien>m13_st)?ma:0;
			else return 0;
		}

		public int get_maphu_noitru(string sothe, int nhom)
		{
			string ma13 = ma13_vitri.ToString();
			string ma16 = ma16_vitri.ToString();
			int m131 = 4;
			int m132 = 1;
			int m161 = 4;
			int m162 = 2;
			int pos = 0;
			decimal m13_st = ma13_st(nhom);
			decimal m16_st = ma16_st(nhom);
			try
			{
				if (ma13 != "")
				{
					pos = ma13.IndexOf(",");
					if (pos != -1)
					{
						m131 = int.Parse(ma13.Substring(0, pos)) - 1;
						m132 = int.Parse(ma13.Substring(pos + 1));
					}
				}
				if (ma16 != "")
				{
					pos = ma16.IndexOf(",");
					if (pos != -1)
					{
						m161 = int.Parse(ma16.Substring(0, pos)) - 1;
						m162 = int.Parse(ma16.Substring(pos + 1));
					}
				}
			}
			catch
			{
				m131 = 4;
				m132 = 1;
				m161 = 4;
				m162 = 2;
			}
			return get_maphu(sothe, nhom);
		}
		public int get_maphu(string sothe, int inhom)
		{
			try
			{
				string ma13 = ma13_vitri_fix(inhom).ToString();
				string ma16 = ma16_vitri_fix(inhom).ToString();
				int m131 = 4;
				int m132 = 1;
				int m161 = 4;
				int m162 = 2;
				int pos = 0;
				try
				{
					if (ma13 != "")
					{
						pos = ma13.IndexOf(",");
						if (pos != -1)
						{
							m131 = int.Parse(ma13.Substring(0, pos)) - 1;
							m132 = int.Parse(ma13.Substring(pos + 1));
						}
					}
					if (ma16 != "")
					{
						pos = ma16.IndexOf(",");
						if (pos != -1)
						{
							m161 = int.Parse(ma16.Substring(0, pos)) - 1;
							m162 = int.Parse(ma16.Substring(pos + 1));
						}
					}
				}
				catch
				{
					m131 = 4;
					m132 = 1;
					m161 = 4;
					m162 = 2;
				}
				if (sothe.Trim().Length == 0x12)
				{
					return ((ma16_ngtru_fix.IndexOf(sothe.Trim().Substring(m161, m162)) != -1) ? 1 : ((ma16_ngtru_quyenloimoi.IndexOf(sothe.Trim().Substring(m161, m162)) != -1) ? 2 : ((ma18_ngtru_khongchitra.IndexOf(sothe.Trim().Substring(m161, m162)) == -1) ? 1 : 0)));
				}
				return ((ma13_ngtru_80_fix.IndexOf(sothe.Trim().Substring(m131, m132)) != -1) ? 1 : ((ma13_ngtru_95_fix.IndexOf(sothe.Trim().Substring(m131, m132)) != -1) ? 2 : 0));
			}
			catch
			{
				return 0;
			}
		}
		public string ma13_vitri_fix(int d_nhom)
		{
			ds = get_data("select ten from d_thongso where id=52 and nhom=" + d_nhom.ToString() + "");
			if (ds.Tables[0].Rows.Count == 0)
			{
				return "3,1";
			}
			return ds.Tables[0].Rows[0][0].ToString().Trim();
		}
		public string ma13_ngtru_95_fix
		{
			get
			{
				ds = get_data("select ten from thongso where id=-50");
				if (ds.Tables[0].Rows.Count == 0)
				{
					return "";
				}
				return ds.Tables[0].Rows[0][0].ToString().Trim();
			}
		}
 


		public string ma16_vitri_fix(int d_nhom)
		{
			ds = get_data("select ten from d_thongso where id=53 and nhom=" + d_nhom.ToString() + "");
			if (ds.Tables[0].Rows.Count == 0)
			{
				return "14,2";
			}
			return ds.Tables[0].Rows[0][0].ToString().Trim();
		}

 

 

		public string ma13_ngtru_80_fix
		{
			get
			{
				ds = get_data("select ten from thongso where id=49");
				if (ds.Tables[0].Rows.Count == 0)
				{
					return "";
				}
				return ds.Tables[0].Rows[0][0].ToString().Trim();
			}
		}
		public string ma16_ngtru_fix
		{
			get
			{
				this.ds = get_data("select ten from thongso where id=50");
				if (ds.Tables[0].Rows.Count == 0)
				{
					return "";
				}
				return ds.Tables[0].Rows[0][0].ToString().Trim();
			}
		}
 

 


		public int get_maphu_noitru(string sothe,int nhom,string ngay)
		{
			return get_maphu(sothe,ngay);
		}

		public int get_maphu(string sothe,int nhom,string ngay)
		{
			return get_maphu(sothe,ngay);
		}

		public string ma13_ngtru(int d_nhom)
		{
			ds=get_data("select ten from d_thongso where id=48 and nhom="+d_nhom);
			if (ds.Tables[0].Rows.Count==0) return "";
			return ds.Tables[0].Rows[0][0].ToString().Trim();
		}

		public string ma16_ngtru(int d_nhom)
		{
			ds=get_data("select ten from d_thongso where id=49 and nhom="+d_nhom);
			if (ds.Tables[0].Rows.Count==0) return "";
			return ds.Tables[0].Rows[0][0].ToString().Trim();
		}

		public string ma16_ngtru_95(int d_nhom)
		{
			ds=get_data("select ten from d_thongso where id=211 and nhom="+d_nhom);
			if (ds.Tables[0].Rows.Count==0) return "";
			return ds.Tables[0].Rows[0][0].ToString().Trim();
		}

		public decimal ma13_st(int d_nhom)
		{
			ds=get_data("select ten from d_thongso where id=50 and nhom="+d_nhom);
			if (ds.Tables[0].Rows.Count==0) return 20000;
			return decimal.Parse(ds.Tables[0].Rows[0][0].ToString());
		}

		public decimal ma16_st(int d_nhom)
		{			
			ds=get_data("select ten from d_thongso where id=51 and nhom="+d_nhom);
			if (ds.Tables[0].Rows.Count==0) return 20000;
			return decimal.Parse(ds.Tables[0].Rows[0][0].ToString());
		}

		public string ma13_vitri
		{
			get
			{
				ds=get_data("select ten from d_thongso where id=52");
				if (ds.Tables[0].Rows.Count==0) return "5,1";
				return ds.Tables[0].Rows[0][0].ToString().Trim();
			}
		}

		public string ma16_vitri
		{
			get
			{
				ds=get_data("select ten from d_thongso where id=53");
				if (ds.Tables[0].Rows.Count==0) return "5,2";
				return ds.Tables[0].Rows[0][0].ToString().Trim();
			}
		}
		
		public string mathecu_95
		{
			get
			{
				ds=get_data("select ten from d_thongso where id=215");
				if (ds.Tables[0].Rows.Count==0) return "GL+JL+HN+HL";
				return ds.Tables[0].Rows[0][0].ToString();
			}
		}

		public int get_maphu(string sothe,string ngay)
		{
			try
			{
				string ma13=ma13_vitri.ToString(),ma16=ma16_vitri.ToString();
				int m131=4,m132=1,m161=4,m162=2,pos=0;
				try
				{
					if (ma13!="")
					{
						pos=ma13.IndexOf(",");
						if (pos!=-1)
						{
							m131=int.Parse(ma13.Substring(0,pos))-1;
							m132=int.Parse(ma13.Substring(pos+1));
						}
					}
					if (ma16!="")
					{
						pos=ma16.IndexOf(",");
						if (pos!=-1)
						{
							m161=int.Parse(ma16.Substring(0,pos))-1;
							m162=int.Parse(ma16.Substring(pos+1));
						}
					}
				}
				catch{m131=4;m132=1;m161=4;m162=2;}
				if (sothe.Trim().Length==18 || sothe.Trim().Length==13) 
				{
					string _mathecu_95=mathecu_95;
					bool b31122009=bNgay(ngay,"01/01/2010");
					return (b31122009 && _mathecu_95.IndexOf(sothe.Trim().Substring(m161, m162)) != -1) ? 2 : (get_ma16.IndexOf(sothe.Trim().Substring(m161,m162))!=-1)?1:0;//1: chi tra 80%
					//return (get_ma16.IndexOf(sothe.Trim().Substring(m161,m162))!=-1)?1:0;//1: chi tra 80%
				}
				else if (sothe.Trim().Length==16) //the cu truoc nam 2007
					return 0;//0: khong cung chi tra
				else 
					return (get_ma13.IndexOf(sothe.Trim().Substring(m131,m132))!=-1)?1:(get_ma16_95.IndexOf(sothe.Trim().Substring(m131,m132))!=-1)?2:0;//2: chi tra 95%
			}
			catch{return 0;}
		}

		public string get_sothe(string sothe)
		{
			string ma="",ma13=ma13_vitri.ToString(),ma16=ma16_vitri.ToString();
			int m131=4,m132=1,m161=4,m162=2,pos=0;
			try
			{
				try
				{
					if (ma13!="" && (sothe.Length==20 || sothe.Length==15))
					{
						pos=ma13.IndexOf(",");
						if (pos!=-1)
						{
							m131=int.Parse(ma13.Substring(0,pos))-1;
							m132=int.Parse(ma13.Substring(pos+1));
							ma=sothe.Substring(m131,m132);
						}
					}
					else if (ma16!="")
					{
						pos=ma16.IndexOf(",");
						if (pos!=-1)
						{
							m161=int.Parse(ma16.Substring(0,pos))-1;
							m162=int.Parse(ma16.Substring(pos+1));
							ma=sothe.Substring(m161,m162);
						}
					}
				}
				catch{}
			}
			catch{}
			return ma;
		}

		private string get_ma13{get{return get_data("select ten from thongso where id=49").Tables[0].Rows[0][0].ToString();}}
		private string get_ma16{get{return get_data("select ten from thongso where id=50").Tables[0].Rows[0][0].ToString();}}
		private string get_ma16_95{get{return get_data("select ten from thongso where id=-50").Tables[0].Rows[0][0].ToString();}}
		public bool get_nhom(string sothe,string ma,int nhom)
		{
			int m161=4,m162=2,pos=0;
			string ma16=ma16_vitri.ToString();
			
			if(sothe.Trim().Trim(';').Length!=15 && sothe.Trim().Trim(';').Length !=20)
			{
				try
				{
					if (ma16!="")
					{
						pos=ma16.IndexOf(",");
						if (pos!=-1)
						{
							m161=int.Parse(ma16.Substring(0,pos))-1;
							m162=int.Parse(ma16.Substring(pos+1));
						}
					}
				}
				catch{m161=4;m162=2;}
			}
			else
			{
				m161=0;
				m162=3;
			}			
			return ma.IndexOf(sothe.Substring(m161,m162))!=-1;
		}

		public void upd_laitienthuoc(string mabn,long maql,string ngayvao,string ngayra,bool kiemtra)
		{
			if (kiemtra && get_dasuamadt(maql,0)) return;
			DateTime dt1=StringToDate(ngayvao.Substring(0,10)).AddDays(-iNgaykiemke);
			DateTime dt2=StringToDate(ngayra.Substring(0,10)).AddDays(iNgaykiemke);
			int y1=dt1.Year,m1=dt1.Month;
			int y2=dt2.Year,m2=dt2.Month;
			int itu,iden;
			string mmyy="";
			for(int i=y1;i<=y2;i++)
			{
				itu=(i==y1)?m1:1;
				iden=(i==y2)?m2:12;
				for(int j=itu;j<=iden;j++)
				{
					mmyy=j.ToString().PadLeft(2,'0')+i.ToString().Substring(2,2);
					if (dbMmyy(mmyy)) kiemtratienthuoc(mmyy,mabn,maql);
				}
			}
		}
		public void kiemtratienthuoc(string s_mmyy, string b_mabn, long b_maql)
		{						
			string xxx=user+"d"+s_mmyy+".pkg_duoc.update_tienthuocbn";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(xxx,con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_mabn",OracleType.VarChar,8).Value=b_mabn;
				cmd.Parameters.Add("d_maql",OracleType.Number).Value=b_maql;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_tienthuoc");
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}			
		}

		public bool bKhoaso(int d_nhom,string d_mmyy)
		{
			return get_data("select * from d_khoaso where nhom="+d_nhom+" and mmyy='"+d_mmyy+"'").Tables[0].Rows.Count>0;
		}

		public int iBhyt_inrieng(int d_nhom)
		{
			ds=get_data("select ten from d_thongso where id=128 and nhom="+d_nhom);
			if (ds.Tables[0].Rows.Count==0) return 0;
			return int.Parse(ds.Tables[0].Rows[0][0].ToString().Trim());
		}

		public string get_dmkho(int loai)
		{
			try
			{
				return get_data("select kho from d_dmphieu where id="+loai).Tables[0].Rows[0][0].ToString();
			}
			catch{return "";}
		}

		public string get_manguon(int loai)
		{
			try
			{
				return get_data("select nguon from d_dmphieu where id="+loai).Tables[0].Rows[0][0].ToString();
			}
			catch{return "";}
		}

		public string get_manguon_doituong(int madoituong)
		{
			try
			{
				return get_data("select nguon from d_doituong where madoituong="+madoituong).Tables[0].Rows[0][0].ToString();
			}
			catch{return "";}
		}

		public bool bBucstt_nguon(int d_nhom)
		{
			ds=get_data("select ten from d_thongso where id=54 and nhom="+d_nhom);
			if (ds.Tables[0].Rows.Count==0) return false;
			return ds.Tables[0].Rows[0][0].ToString()=="1";
		}
		public string Thongsod(string sql)
		{
			try
			{
				XmlDocument doc=new XmlDocument();
				doc.Load("..\\..\\..\\xml\\d_thongso.xml");
				XmlNodeList nodeLst=doc.GetElementsByTagName(sql);
				return nodeLst.Item(0).InnerText;
			}
			catch
			{
				ds=new DataSet();
				ds.ReadXml("..\\..\\..\\xml\\d_thongso.xml");
				DataColumn dc=new DataColumn();
				dc.ColumnName=sql;
				dc.DataType=Type.GetType("System.String");
				ds.Tables[0].Columns.Add(dc);
				ds.Tables[0].Rows[0][sql]="0";
				ds.WriteXml("..\\..\\..\\xml\\d_thongso.xml");
				return "0";
			}
		}
		public bool bLocbaohiem{get{return Thongsod("c30")=="1";}}
		public bool bNhapmaso{get{return Thongsod("c26")=="1";}}
		public int get_stt(DataTable dt,string cot)
		{
			try
			{
				if (dt.Rows.Count==0) return 1;
				else return int.Parse(dt.Rows[dt.Rows.Count-1][cot].ToString())+1;
			}
			catch{return 1;}
		}

		public int get_stt_bhyt(DataTable dt)
		{
			try
			{
				return dt.Rows.Count+1;
			}
			catch{return 1;}
		}

		public int get_stt_d(DataTable dt)
		{
			if (dt.Rows.Count==0) return 1;
			else return int.Parse(dt.Rows[dt.Rows.Count-1]["stt"].ToString())+1;
		}
		public bool bTru_tonao(int d_nhom)
		{
			ds=get_data("select ten from d_thongso where id=119 and nhom="+d_nhom);
			if (ds.Tables[0].Rows.Count==0) return false;
			return ds.Tables[0].Rows[0][0].ToString().Trim()=="1";
		}
		public bool bCapnhat_tonkho(int d_nhom)
		{
			ds=get_data("select ten from d_thongso where id=122 and nhom="+d_nhom);
			if (ds.Tables[0].Rows.Count==0) return false;
			return ds.Tables[0].Rows[0][0].ToString().Trim()=="1";
		}
		public bool upd_tonkho(string d_mmyy,int d_makho)
		{
			string xxx=user+"d"+d_mmyy+".pkg_duoc.upd_tonkho";
			con=new OracleConnection(sConn);//get_conn(d_mmyy)
			try
			{
				con.Open();
				cmd=new OracleCommand(xxx,con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_mmyy",OracleType.VarChar,4).Value=d_mmyy;
				cmd.Parameters.Add("d_makho",OracleType.Number).Value=d_makho;

				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"tonkho");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}
		public DataTable get_tonkhoth_dutru_bhyt(int nhom,string mmyy,string makho,string manguon,int madoituong)
		{
			string xxx=user+"d"+mmyy;
			string s_madoituong_bhyt=","+sMaDoituong_BHYT();
			if (bCapnhat_tonkho(nhom))
			{
				sql="select id from d_dmkho where nhom="+nhom;
				if (makho!="") sql+=" and id in ("+makho.Substring(0,makho.Length-1)+")";
				foreach(DataRow r in get_data(sql).Tables[0].Rows) upd_tonkho(mmyy,int.Parse(r["id"].ToString()));
			}
			sql="select rownum stt,d.ten tennguon,b.ma,trim(b.ten)||' '||b.hamluong ten,b.tenhc,b.dang,c.ten tenkho,";
			sql+="a.tondau+a.slnhap-a.slxuat-case when a.slyeucau>0 then a.slyeucau else 0 end soluong,b.id,a.makho,b.bhyt,b.mahc,";
			sql+="a.manguon,0 tutruc,b.dongia,b.sothe, b.duongdung,(case when b.ketoa=1 then 'Theo toa' else '' end) ketoa ";
			sql+=" from "+xxx+".d_tonkhoth a,"+user+".d_dmbd b,"+user+".d_dmkho c,"+user+".d_dmnguon d ";
			sql+="where a.mabd=b.id and a.makho=c.id and a.manguon=d.id and c.nhom="+nhom;
			if (makho!="") sql+=" and a.makho in ("+makho.Substring(0,makho.Length-1)+")";
			if (manguon!="") sql+=" and a.manguon in ("+manguon.Substring(0,manguon.Length-1)+")";
			if (s_madoituong_bhyt.IndexOf(","+madoituong.ToString()+",")!=-1) sql+=" and b.bhyt<>0";//if(madoituong.ToString()==1)sql+=" and b.bhyt<>0";
			if (bSort_mabd) sql+=" order by c.stt,b.ma";
			else sql+=" order by c.stt,b.ten";
			DataTable tmp=get_data(sql).Tables[0];
			if(Thongso("luu_sql")=="1")upd_error(sql,System.Environment.MachineName,"BH");
			string mmyys="";
			DataRow r1;
			foreach(DataRow r2 in get_data("select mmyy from d_table where substr(mmyy,3,2)||substr(mmyy,1,2)>'"+mmyy.Substring(2,2)+mmyy.Substring(0,2)+"'").Tables[0].Rows)
			{
				mmyys=r2["mmyy"].ToString();
				xxx=user+"d"+mmyys;
				sql="select a.makho,a.mabd,a.manguon,sum(a.slxuat+case when a.slyeucau>0 then a.slyeucau else 0 end) soluong from "+xxx+".d_tonkhoth a,"+user+".d_dmbd b where a.mabd=b.id and a.slxuat+case when a.slyeucau>0 then a.slyeucau else 0 end>0 and a.mmyy='"+mmyys+"'";
				if (makho!="") sql+=" and a.makho in ("+makho.Substring(0,makho.Length-1)+")";
				if (manguon!="") sql+=" and a.manguon in ("+manguon.Substring(0,manguon.Length-1)+")";
				if (s_madoituong_bhyt.IndexOf(","+madoituong.ToString()+",")!=-1) sql+=" and b.bhyt<>0";//if (madoituong==1) sql+=" and b.bhyt<>0";
				sql+=" group by a.makho,a.mabd,a.manguon";
				if(Thongso("luu_sql")=="1")upd_error(sql,System.Environment.MachineName,"BH");
				foreach(DataRow r in get_data(sql).Tables[0].Rows)
				{
					r1=getrowbyid(tmp,"makho="+int.Parse(r["makho"].ToString())+" and id="+int.Parse(r["mabd"].ToString())+" and manguon="+int.Parse(r["manguon"].ToString()));
					if (r1!=null) r1["soluong"]=decimal.Parse(r1["soluong"].ToString())-decimal.Parse(r["soluong"].ToString());
				}
			}
			return tmp;
		}

		
		public bool get_done_thuocbhyt(string d_ngay,long d_id)
		{
			ds=get_data("select done from "+user+mmyy(d_ngay)+".d_thuocbhytll where id="+d_id);
			if (ds.Tables[0].Rows.Count==0) return false;
			else return ds.Tables[0].Rows[0]["done"].ToString().Trim()!="0";
		}

		public bool get_done_bhytkb(string d_mmyy,long d_id)
		{
			ds=get_data("select done from "+user+"d"+d_mmyy+".bhytkb where id="+d_id);
			if (ds.Tables[0].Rows.Count==0) return false;
			else return ds.Tables[0].Rows[0]["done"].ToString().Trim()!="0";
		}
		public bool get_toathuoc_daduyet(string d_mmyy,string d_mabn, string d_mavaovien, string d_makp)
		{
			//kiem tra xem phong kham do toa thuoc da duoc duyet chua?
			ds=get_data("select done from "+user+"d"+d_mmyy+".bhytkb a,  "+user+"d"+d_mmyy+".bhytthuoc where mabn='"+d_mabn+"' and mavaovien="+d_mavaovien+" and makp='"+d_makp+"'");
			if (ds.Tables[0].Rows.Count==0) return false;
			else return ds.Tables[0].Rows.Count>0;
		}
		public string kiemtra_toathuoc(DataTable dtdmbd,DataTable dtct,string mabn,int nhom,string ngay,long id,bool bHoatchat)
		{
			string ret="",ma1="",xxx=user+mmyy(ngay);
			dtct.AcceptChanges();
			DataRow r;
			foreach(DataRow r1 in dtct.Select("soluong>0","mabd"))
			{
				if (bHoatchat) ma1+=r1["tenhc"].ToString().Trim()+"+";
				else ma1+=r1["mabd"].ToString().Trim().PadLeft(7,'0')+",";
			}
			string[] s1,s2;
			if (bHoatchat) ma1=(ma1!="")?ma1.Substring(0,ma1.Length-1):ma1;
			s1 = ma1.Split('+');
			sql="select d.tenkp,e.hoten,";
			if (bHoatchat) sql+="nvl(f.tenhc,' ') as mabd,";
			else sql+="b.mabd,";
			sql+="sum(b.slyeucau) as soluong from "+xxx+".d_thuocbhytll a,"+xxx+".d_thuocbhytct b,btdkp_bv d,dmbs e,d_dmbd f";
			sql+=" where a.id=b.id and a.makp=d.makp and a.mabs=e.ma and b.mabd=f.id ";
			sql+=" and a.mabn='"+mabn+"' and a.nhom="+nhom+" and to_char(a.ngay,'dd/MM/yyyy')='"+ngay.Substring(0,10)+"'";
			sql+=" and a.id<>"+id;
			sql+=" group by d.tenkp,e.hoten,";
			if (bHoatchat) sql+="nvl(f.tenhc,' ')";
			else sql+="b.mabd";
			sql+=" order by d.tenkp,e.hoten,";
			if (bHoatchat) sql+="nvl(f.tenhc,' ')";
			else sql+="b.mabd";
			bool bFound=false;
			foreach(DataRow r1 in get_data(sql).Tables[0].Rows)
			{
				if (bHoatchat && r1["mabd"].ToString()!="")
				{
					bFound=false;
					s2 = r1["mabd"].ToString().Split('+');
					//if ((ma1.IndexOf(r1["mabd"].ToString().Trim())!=-1 || r1["mabd"].ToString().Trim().IndexOf(ma1)!=-1) && r1["mabd"].ToString().Trim()!="")
					for(int i=0;i<s1.Length;i++)
						for(int j=0;j<s2.Length;j++)
						{
							if (s1[i].ToString().Trim().ToLower()==s2[j].ToString().Trim().ToLower())
							{
								bFound=true;
								break;
							}
						}
					if (bFound)	ret=ret+r1["tenkp"].ToString().Trim()+";BÁC SỸ : "+r1["hoten"].ToString().Trim()+";"+r1["mabd"].ToString().Trim()+"("+r1["soluong"].ToString().Trim()+")\n";
				}
				else
				{
					if (ma1.IndexOf(r1["mabd"].ToString().Trim().PadLeft(7,'0')+",")!=-1)
					{
						r=getrowbyid(dtdmbd,"id="+int.Parse(r1["mabd"].ToString()));
						if (r!=null)
							ret=ret+r1["tenkp"].ToString().Trim()+";BÁC SỸ : "+r1["hoten"].ToString().Trim()+";"+r["ten"].ToString().Trim()+" "+r["hamluong"].ToString().Trim()+" "+r["dang"].ToString()+"("+r1["soluong"].ToString().Trim()+")\n";
					}
				}
			}
			return ret;
		}
		public long get_id_bhyt
		{
			get
			{
				return getidyymmdd_d(12);
			}
		}
		public long getidyymmdd_d(int id)
		{
			return long.Parse(getyymmdd() + get_capid_may_d(id, sComputer).ToString().PadLeft(9, '0') + iRownum.ToString().PadLeft(3, '0'));
		}

		private long get_capid_may_d(int m_ma,string m_computer)
		{
			sql="update d_capid set id=id+1 where ma=:m_ma and computer=:m_computer";
			con=new OracleConnection(sConn);
			con.Open();
			cmd=new OracleCommand(sql,con);
			cmd.CommandType=CommandType.Text;
			cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
			cmd.Parameters.Add("m_computer",OracleType.VarChar,20).Value=m_computer;
			int irec=cmd.ExecuteNonQuery();
			cmd.Dispose();
			if (irec==0)
			{
				sql="insert into d_capid(ma,ten,id,computer) values (:m_ma,:m_ten,1,:m_computer)";
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_ma",OracleType.Int16).Value=m_ma;
				cmd.Parameters.Add("m_ten",OracleType.VarChar,20).Value=m_computer;
				cmd.Parameters.Add("m_computer",OracleType.VarChar,20).Value=m_computer;
				cmd.ExecuteNonQuery();
				cmd.Dispose();
			}
			sql="select id from d_capid where ma="+m_ma+" and computer='"+m_computer+"'";
			cmd=new OracleCommand(sql,con);
			cmd.CommandType=CommandType.Text;
			dest=new OracleDataAdapter(cmd);
			ds=new DataSet();
			dest.Fill(ds);	
			cmd.Dispose();				
			con.Close();con.Dispose();
			return long.Parse(ds.Tables[0].Rows[0][0].ToString());
		}
		
		public long get_capid_d(int m_ma)
		{
			sql="update d_capid set id=id+1 where ma=:m_ma";
			con=new OracleConnection(sConn);
			con.Open();
			cmd=new OracleCommand(sql,con);
			cmd.CommandType=CommandType.Text;
			cmd.Parameters.Add("m_ma",OracleType.Number).Value=m_ma;
			int irec=cmd.ExecuteNonQuery();
			cmd.Dispose();
			if (irec==0)
			{
				sql="insert into d_capid(ma,ten,id,computer) values (:m_ma,:m_ten,1,:m_computer)";
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_ma",OracleType.Int16).Value=m_ma;
				cmd.Parameters.Add("m_ten",OracleType.VarChar,20).Value=sComputer;
				cmd.Parameters.Add("m_computer",OracleType.VarChar,20).Value=sComputer;
				cmd.ExecuteNonQuery();
				cmd.Dispose();
			}
			sql="select id from d_capid where ma="+m_ma;
			cmd=new OracleCommand(sql,con);
			cmd.CommandType=CommandType.Text;
			dest=new OracleDataAdapter(cmd);
			ds=new DataSet();
			dest.Fill(ds);	
			cmd.Dispose();				
			con.Close();con.Dispose();
			return long.Parse(ds.Tables[0].Rows[0][0].ToString());
		}

		public bool bSort_mabd{get{return Thongsod("c101")=="1";}}

		public void updrec_dutruct_solan(string tt,DataTable dt,int stt,string doituong,int mabd,string ma,string ten,string tenhc,string dang,string tenkho,decimal soluong,int madoituong,int makho,string cachdung,string mahc,int manguon,int tutruc,long idvpkhoa,decimal solan,decimal lan,DataTable dtton,int ketoa)
		{
			string exp="stt="+stt;
			DataRow r = getrowbyid (dt,exp); 
			if ( r == null )
			{
				DataRow nrow = dt.NewRow ( ) ;
				nrow["stt"] = stt;
				nrow["doituong"] = doituong;
				nrow["mabd"] = mabd;
				nrow["ma"] = ma;
				nrow["ten"] = ten;
				nrow["tenhc"] = tenhc;
				nrow["dang"] = dang;
				nrow["tenkho"] = tenkho;
				nrow["soluong"] = soluong;
				nrow["madoituong"] = madoituong;
				nrow["makho"] = makho;
				nrow["cachdung"]=cachdung;
				nrow["mahc"]=mahc;
				nrow["manguon"]=manguon;
				nrow["tutruc"]=tutruc;
				nrow["idvpkhoa"]=idvpkhoa;
				nrow["solan"]=solan;
				nrow["lan"]=lan;
				nrow["ketoa"]=ketoa;
				dt.Rows.Add ( nrow ) ;
				if (dtton!=null && idvpkhoa==0) updrec_tonkho_tutruc(dtton,makho,mabd,tutruc,soluong,tt);
			}
			else
			{
				DataRow[] dr = dt.Select(exp);
				if (dtton!=null && idvpkhoa==0)
				{
					decimal sl=decimal.Parse(dr[0]["soluong"].ToString());
					updrec_tonkho_tutruc(dtton,makho,mabd,tutruc,sl,"+");
					updrec_tonkho_tutruc(dtton,makho,mabd,tutruc,soluong,"-");
				}
				dr[0]["doituong"] = doituong;
				dr[0]["mabd"] = mabd;
				dr[0]["ma"] = ma;
				dr[0]["ten"] = ten;
				dr[0]["tenhc"] = tenhc;
				dr[0]["dang"] = dang;
				dr[0]["tenkho"] = tenkho;
				dr[0]["soluong"] = soluong;
				dr[0]["madoituong"] = madoituong;
				dr[0]["makho"] = makho;
				dr[0]["cachdung"]=cachdung;
				dr[0]["mahc"]=mahc;
				dr[0]["manguon"]=manguon;
				dr[0]["tutruc"]=tutruc;
				dr[0]["idvpkhoa"]=idvpkhoa;
				dr[0]["solan"]=solan;
				dr[0]["lan"]=lan;
				dr[0]["ketoa"]=ketoa;
			}
		}
		public void updrec_dutruct_solan(string tt,DataTable dt,int stt,string doituong,int mabd,string ma,string ten,string tenhc,string dang,string tenkho,decimal soluong,int madoituong,int makho,string cachdung,string mahc,int manguon,int tutruc,long idvpkhoa,decimal solan,decimal lan,DataTable dtton,int ketoa,int songay)
		{
			string exp="stt="+stt;
			DataRow r = getrowbyid (dt,exp); 
			if ( r == null )
			{
				DataRow nrow = dt.NewRow ( ) ;
				nrow["stt"] = stt;
				nrow["doituong"] = doituong;
				nrow["mabd"] = mabd;
				nrow["ma"] = ma;
				nrow["ten"] = ten;
				nrow["tenhc"] = tenhc;
				nrow["dang"] = dang;
				nrow["tenkho"] = tenkho;
				nrow["soluong"] = soluong;
				nrow["madoituong"] = madoituong;
				nrow["makho"] = makho;
				nrow["cachdung"]=cachdung;
				nrow["mahc"]=mahc;
				nrow["manguon"]=manguon;
				nrow["tutruc"]=tutruc;
				nrow["idvpkhoa"]=idvpkhoa;
				nrow["solan"]=solan;
				nrow["lan"]=lan;
				nrow["ketoa"]=ketoa;
				nrow["songay"]=songay;
				dt.Rows.Add ( nrow ) ;
				if (dtton!=null && idvpkhoa==0) updrec_tonkho_tutruc(dtton,makho,mabd,tutruc,soluong,tt);
			}
			else
			{
				DataRow[] dr = dt.Select(exp);
				if (dtton!=null && idvpkhoa==0)
				{
					decimal sl=decimal.Parse(dr[0]["soluong"].ToString());
					updrec_tonkho_tutruc(dtton,makho,mabd,tutruc,sl,"+");
					updrec_tonkho_tutruc(dtton,makho,mabd,tutruc,soluong,"-");
				}
				dr[0]["doituong"] = doituong;
				dr[0]["mabd"] = mabd;
				dr[0]["ma"] = ma;
				dr[0]["ten"] = ten;
				dr[0]["tenhc"] = tenhc;
				dr[0]["dang"] = dang;
				dr[0]["tenkho"] = tenkho;
				dr[0]["soluong"] = soluong;
				dr[0]["madoituong"] = madoituong;
				dr[0]["makho"] = makho;
				dr[0]["cachdung"]=cachdung;
				dr[0]["mahc"]=mahc;
				dr[0]["manguon"]=manguon;
				dr[0]["tutruc"]=tutruc;
				dr[0]["idvpkhoa"]=idvpkhoa;
				dr[0]["solan"]=solan;
				dr[0]["lan"]=lan;
				dr[0]["ketoa"]=ketoa;
				dr[0]["songay"]=songay;
			}
		}
		public void updrec_dutruct(string tt,DataTable dt,int stt,string doituong,int mabd,string ma,string ten,string tenhc,string dang,string tenkho,decimal soluong,int madoituong,int makho,string cachdung,string mahc,int manguon,int tutruc,long idvpkhoa,DataTable dtton,int ketoa)
		{
			string exp="stt="+stt;
			DataRow r = getrowbyid (dt,exp); 
			if ( r == null )
			{
				DataRow nrow = dt.NewRow ( ) ;
				nrow["stt"] = stt;
				nrow["doituong"] = doituong;
				nrow["mabd"] = mabd;
				nrow["ma"] = ma;
				nrow["ten"] = ten;
				nrow["tenhc"] = tenhc;
				nrow["dang"] = dang;
				nrow["tenkho"] = tenkho;
				nrow["soluong"] = soluong;
				nrow["madoituong"] = madoituong;
				nrow["makho"] = makho;
				nrow["cachdung"]=cachdung;
				nrow["mahc"]=mahc;
				nrow["manguon"]=manguon;
				nrow["tutruc"]=tutruc;
				nrow["idvpkhoa"]=idvpkhoa;
				nrow["ketoa"]=ketoa;
				dt.Rows.Add ( nrow ) ;
				if (dtton!=null && idvpkhoa==0) updrec_tonkho_tutruc(dtton,makho,mabd,tutruc,soluong,tt);
			}
			else
			{
				DataRow[] dr = dt.Select(exp);
				if (dtton!=null && idvpkhoa==0)
				{
					decimal sl=decimal.Parse(dr[0]["soluong"].ToString());
					updrec_tonkho_tutruc(dtton,makho,mabd,tutruc,sl,"+");
					updrec_tonkho_tutruc(dtton,makho,mabd,tutruc,soluong,"-");
				}
				dr[0]["doituong"] = doituong;
				dr[0]["mabd"] = mabd;
				dr[0]["ma"] = ma;
				dr[0]["ten"] = ten;
				dr[0]["tenhc"] = tenhc;
				dr[0]["dang"] = dang;
				dr[0]["tenkho"] = tenkho;
				dr[0]["soluong"] = soluong;
				dr[0]["madoituong"] = madoituong;
				dr[0]["makho"] = makho;
				dr[0]["cachdung"]=cachdung;
				dr[0]["mahc"]=mahc;
				dr[0]["manguon"]=manguon;
				dr[0]["tutruc"]=tutruc;
				dr[0]["idvpkhoa"]=idvpkhoa;
				dr[0]["ketoa"]=ketoa;
			}
		}

		public void updrec_dutruct(string tt,DataTable dt,int stt,string doituong,int mabd,string ma,string ten,string tenhc,string dang,string tenkho,decimal soluong,int madoituong,int makho,string cachdung,string mahc,int manguon,int tutruc,long idvpkhoa,DataTable dtton)
		{
			string exp="stt="+stt;
			DataRow r = getrowbyid (dt,exp); 
			if ( r == null )
			{
				DataRow nrow = dt.NewRow ( ) ;
				nrow["stt"] = stt;
				nrow["doituong"] = doituong;
				nrow["mabd"] = mabd;
				nrow["ma"] = ma;
				nrow["ten"] = ten;
				nrow["tenhc"] = tenhc;
				nrow["dang"] = dang;
				nrow["tenkho"] = tenkho;
				nrow["soluong"] = soluong;
				nrow["madoituong"] = madoituong;
				nrow["makho"] = makho;
				nrow["cachdung"]=cachdung;
				nrow["mahc"]=mahc;
				nrow["manguon"]=manguon;
				nrow["tutruc"]=tutruc;
				nrow["idvpkhoa"]=idvpkhoa;
				dt.Rows.Add ( nrow ) ;
				if (dtton!=null && idvpkhoa==0) updrec_tonkho_tutruc(dtton,makho,mabd,tutruc,soluong,tt);
			}
			else
			{
				DataRow[] dr = dt.Select(exp);
				if (dtton!=null && idvpkhoa==0)
				{
					decimal sl=decimal.Parse(dr[0]["soluong"].ToString());
					updrec_tonkho_tutruc(dtton,makho,mabd,tutruc,sl,"+");
					updrec_tonkho_tutruc(dtton,makho,mabd,tutruc,soluong,"-");
				}
				dr[0]["doituong"] = doituong;
				dr[0]["mabd"] = mabd;
				dr[0]["ma"] = ma;
				dr[0]["ten"] = ten;
				dr[0]["tenhc"] = tenhc;
				dr[0]["dang"] = dang;
				dr[0]["tenkho"] = tenkho;
				dr[0]["soluong"] = soluong;
				dr[0]["madoituong"] = madoituong;
				dr[0]["makho"] = makho;
				dr[0]["cachdung"]=cachdung;
				dr[0]["mahc"]=mahc;
				dr[0]["manguon"]=manguon;
				dr[0]["tutruc"]=tutruc;
				dr[0]["idvpkhoa"]=idvpkhoa;
			}
		}

		public void updrec_dutruct(string tt,DataTable dt,int stt,string doituong,int mabd,string ma,string ten,string tenhc,string dang,string tenkho,decimal soluong,int madoituong,int makho,string cachdung,string mahc,int manguon,int tutruc,long idvpkhoa,DataTable dtton, string ghichu,decimal songay,  decimal c1,decimal c2,decimal c3,decimal c4,decimal moilan,int ketoa)
		{
			string exp="stt="+stt;
			DataRow r = getrowbyid (dt,exp); 
			if ( r == null )
			{
				DataRow nrow = dt.NewRow ( ) ;
				nrow["stt"] = stt;
				nrow["doituong"] = doituong;
				nrow["mabd"] = mabd;
				nrow["ma"] = ma;
				nrow["ten"] = ten;
				nrow["tenhc"] = tenhc;
				nrow["dang"] = dang;
				nrow["tenkho"] = tenkho;
				nrow["soluong"] = soluong;
				nrow["madoituong"] = madoituong;
				nrow["makho"] = makho;
				nrow["cachdung"]=cachdung;
				nrow["mahc"]=mahc;
				nrow["manguon"]=manguon;
				nrow["tutruc"]=tutruc;
				nrow["idvpkhoa"]=idvpkhoa;
				//
				nrow["songay"]=songay ;
				nrow["ghichu"]=ghichu;
				nrow["moilan"]=moilan;
				nrow["c1"]=c1;
				nrow["c2"]=c2;
				nrow["c3"]=c3;
				nrow["c4"]=c4;

				//
				nrow["ketoa"]=ketoa;
				dt.Rows.Add ( nrow ) ;
				if (dtton!=null && idvpkhoa==0) updrec_tonkho_tutruc(dtton,makho,mabd,tutruc,soluong,tt);
			}
			else
			{
				DataRow[] dr = dt.Select(exp);
				if (dtton!=null && idvpkhoa==0)
				{
					decimal sl=decimal.Parse(dr[0]["soluong"].ToString());
					updrec_tonkho_tutruc(dtton,makho,mabd,tutruc,sl,"+");
					updrec_tonkho_tutruc(dtton,makho,mabd,tutruc,soluong,"-");
				}
				dr[0]["doituong"] = doituong;
				dr[0]["mabd"] = mabd;
				dr[0]["ma"] = ma;
				dr[0]["ten"] = ten;
				dr[0]["tenhc"] = tenhc;
				dr[0]["dang"] = dang;
				dr[0]["tenkho"] = tenkho;
				dr[0]["soluong"] = soluong;
				dr[0]["madoituong"] = madoituong;
				dr[0]["makho"] = makho;
				dr[0]["cachdung"]=cachdung;
				dr[0]["mahc"]=mahc;
				dr[0]["manguon"]=manguon;
				dr[0]["tutruc"]=tutruc;
				dr[0]["idvpkhoa"]=idvpkhoa;
				//
				dr[0]["songay"]=songay ;
				dr[0]["ghichu"]=ghichu;
				dr[0]["moilan"]=moilan;
				dr[0]["c1"]=c1;
				dr[0]["c2"]=c2;
				dr[0]["c3"]=c3;
				dr[0]["c4"]=c4;
				//
				dr[0]["ketoa"]=ketoa;
			}
		}
		public decimal get_slton_nguon_tutruc(DataTable dt,int makho,int mabd,int manguon,int tutruc,decimal soluong)
		{
			DataRow r=getrowbyid(dt,"makho="+makho+" and id="+mabd+" and manguon="+manguon+" and tutruc="+tutruc);
			if (r==null) return 0;
			else return decimal.Parse(r["soluong"].ToString())+soluong;
		}

		public void upd_tonkhoct_xuat(string tt,string mmyy,long stt,int makho,int manguon,int nhomcc,int mabd,string handung,string losx,decimal soluong,decimal sotien,decimal giaban,decimal giamua)
		{
			string xxx=user+"d"+mmyy;
			if (tt==delete)
				execute_data("update "+xxx+".d_tonkhoct set slxuat=slxuat-"+soluong+",stxuat=stxuat-"+sotien+"	where mmyy='"+mmyy+"' and makho="+makho+" and stt="+stt);
			else if (tt==insert)
				upd_tonkhoct(mmyy,makho,manguon,nhomcc,stt,mabd,handung,losx,soluong,sotien,giaban,giamua,"slxuat","stxuat");			
			upd_tonkhoth(tt,mmyy,makho,mabd,manguon,soluong,"slxuat");
		}

		public bool upd_thuocbhytll(long d_id,int d_nhom,string d_ngay,string d_mabn,long d_maql,int d_madoituong,string d_ghichu,decimal d_songay,string d_makp,string d_mabs,string d_chandoan,string d_maicd,int d_loaiba,int d_userid,long d_mavaovien)
		{
			string xxx=user+mmyy(d_ngay);
			sql="update "+xxx+".d_thuocbhytll set nhom=:d_nhom,ngay=to_date(:d_ngay,'dd/MM/yyyy hh24:mi'),";
			sql+="mabn=:d_mabn,maql=:d_maql,madoituong=:d_madoituong,ghichu=:d_ghichu,songay=:d_songay,makp=:d_makp,";
			sql+="mabs=:d_mabs,chandoan=:d_chandoan,maicd=:d_maicd,loaiba=:d_loaiba,userid=:d_userid,mavaovien=:d_mavaovien ";
			sql+="where id=:d_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("d_nhom",OracleType.Number).Value=d_nhom;
				cmd.Parameters.Add("d_ngay",OracleType.VarChar,16).Value=d_ngay;
				cmd.Parameters.Add("d_mabn",OracleType.VarChar,8).Value=d_mabn;
				cmd.Parameters.Add("d_maql",OracleType.Number).Value=d_maql;
				cmd.Parameters.Add("d_madoituong",OracleType.Number).Value=d_madoituong;
				cmd.Parameters.Add("d_ghichu",OracleType.NVarChar,254).Value=d_ghichu;
				cmd.Parameters.Add("d_songay",OracleType.Number).Value=d_songay;
				cmd.Parameters.Add("d_makp",OracleType.VarChar,2).Value=d_makp;
				cmd.Parameters.Add("d_mabs",OracleType.VarChar,4).Value=d_mabs;
				cmd.Parameters.Add("d_chandoan",OracleType.NVarChar,254).Value=d_chandoan;
				cmd.Parameters.Add("d_maicd",OracleType.VarChar,9).Value=d_maicd;
				cmd.Parameters.Add("d_loaiba",OracleType.Number).Value=d_loaiba;
				cmd.Parameters.Add("d_userid",OracleType.Number).Value=d_userid;
				cmd.Parameters.Add("d_mavaovien",OracleType.Number).Value=d_mavaovien;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".d_thuocbhytll (id,nhom,ngay,mabn,maql,madoituong,ghichu,songay,makp,mabs,chandoan,maicd,loaiba,userid,mavaovien)";
					sql+=" values (:d_id,:d_nhom,to_date(:d_ngay,'dd/MM/yyyy hh24:mi'),:d_mabn,:d_maql,:d_madoituong,:d_ghichu,:d_songay,:d_makp,:d_mabs,:d_chandoan,:d_maicd,:d_loaiba,:d_userid,:d_mavaovien)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
					cmd.Parameters.Add("d_nhom",OracleType.Number).Value=d_nhom;
					cmd.Parameters.Add("d_ngay",OracleType.VarChar,16).Value=d_ngay;
					cmd.Parameters.Add("d_mabn",OracleType.VarChar,8).Value=d_mabn;
					cmd.Parameters.Add("d_maql",OracleType.Number).Value=d_maql;
					cmd.Parameters.Add("d_madoituong",OracleType.Number).Value=d_madoituong;
					cmd.Parameters.Add("d_ghichu",OracleType.NVarChar,100).Value=d_ghichu;
					cmd.Parameters.Add("d_songay",OracleType.Number).Value=d_songay;
					cmd.Parameters.Add("d_makp",OracleType.VarChar,2).Value=d_makp;
					cmd.Parameters.Add("d_mabs",OracleType.VarChar,4).Value=d_mabs;
					cmd.Parameters.Add("d_chandoan",OracleType.NVarChar,254).Value=d_chandoan;
					cmd.Parameters.Add("d_maicd",OracleType.VarChar,9).Value=d_maicd;
					cmd.Parameters.Add("d_loaiba",OracleType.Number).Value=d_loaiba;
					cmd.Parameters.Add("d_userid",OracleType.Number).Value=d_userid;
					cmd.Parameters.Add("d_mavaovien",OracleType.Number).Value=d_mavaovien;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_thuocbhytll");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_thuocbhytct(string d_ngay,long d_id,int d_stt,int d_makho,int d_mabd,decimal d_slyeucau,string d_cachdung,int d_manguon,decimal d_solan,decimal d_lan,int d_madoituong, decimal d_songay, decimal d_moilan, string d_ghichu)
		{
			string xxx=user+mmyy(d_ngay);
			sql="update "+xxx+".d_thuocbhytct set makho=:d_makho,mabd=:d_mabd,slyeucau=:d_slyeucau,cachdung=:d_cachdung,manguon=:d_manguon,solan=:d_solan,lan=:d_lan,madoituong=:d_madoituong ";
			sql+=", ghichu=:d_ghichu, songay=:d_songay, moilan=:d_moilan ";
			sql+="where id=:d_id and stt=:d_stt";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("d_makho",OracleType.Number).Value=d_makho;
				cmd.Parameters.Add("d_mabd",OracleType.Number).Value=d_mabd;
				cmd.Parameters.Add("d_slyeucau",OracleType.Number).Value=d_slyeucau;
				cmd.Parameters.Add("d_cachdung",OracleType.NVarChar,254).Value=d_cachdung;
				cmd.Parameters.Add("d_manguon",OracleType.Number).Value=d_manguon;
				cmd.Parameters.Add("d_solan",OracleType.Number).Value=d_solan;
				cmd.Parameters.Add("d_lan",OracleType.Number).Value=d_lan;
				cmd.Parameters.Add("d_madoituong",OracleType.Number).Value=d_madoituong;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				cmd.Parameters.Add("d_stt",OracleType.Number).Value=d_stt;
				cmd.Parameters.Add("d_ghichu",OracleType.NVarChar,254).Value=d_ghichu;
				cmd.Parameters.Add("d_songay",OracleType.Number).Value=d_songay;
				cmd.Parameters.Add("d_moilan",OracleType.Number).Value=d_moilan;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".d_thuocbhytct (id,stt,makho,mabd,slyeucau,cachdung,manguon,solan,lan,madoituong,ghichu,songay,moilan)";
					sql+=" values (:d_id,:d_stt,:d_makho,:d_mabd,:d_slyeucau,:d_cachdung,:d_manguon,:d_solan,:d_lan,:d_madoituong,:d_ghichu, :d_songay, :d_moilan)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
					cmd.Parameters.Add("d_stt",OracleType.Number).Value=d_stt;
					cmd.Parameters.Add("d_makho",OracleType.Number).Value=d_makho;
					cmd.Parameters.Add("d_mabd",OracleType.Number).Value=d_mabd;
					cmd.Parameters.Add("d_slyeucau",OracleType.Number).Value=d_slyeucau;
					cmd.Parameters.Add("d_cachdung",OracleType.NVarChar,254).Value=d_cachdung;
					cmd.Parameters.Add("d_manguon",OracleType.Number).Value=d_manguon;
					cmd.Parameters.Add("d_solan",OracleType.Number).Value=d_solan;
					cmd.Parameters.Add("d_lan",OracleType.Number).Value=d_lan;
					cmd.Parameters.Add("d_madoituong",OracleType.Number).Value=d_madoituong;
					cmd.Parameters.Add("d_ghichu",OracleType.NVarChar,254).Value=d_ghichu;
					cmd.Parameters.Add("d_songay",OracleType.Number).Value=d_songay;
					cmd.Parameters.Add("d_moilan",OracleType.Number).Value=d_moilan;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_thuocbhytct");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_thuocbhytct(string d_ngay,long d_id,int d_stt,int d_makho,int d_mabd,decimal d_slyeucau,string d_cachdung,int d_manguon,decimal d_solan,decimal d_lan,int d_madoituong)
		{
			string xxx=user+mmyy(d_ngay);
			sql="update "+xxx+".d_thuocbhytct set makho=:d_makho,mabd=:d_mabd,slyeucau=:d_slyeucau,cachdung=:d_cachdung,manguon=:d_manguon,solan=:d_solan,lan=:d_lan,madoituong=:d_madoituong ";
			sql+="where id=:d_id and stt=:d_stt";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("d_makho",OracleType.Number).Value=d_makho;
				cmd.Parameters.Add("d_mabd",OracleType.Number).Value=d_mabd;
				cmd.Parameters.Add("d_slyeucau",OracleType.Number).Value=d_slyeucau;
				cmd.Parameters.Add("d_cachdung",OracleType.NVarChar,254).Value=d_cachdung;
				cmd.Parameters.Add("d_manguon",OracleType.Number).Value=d_manguon;
				cmd.Parameters.Add("d_solan",OracleType.Number).Value=d_solan;
				cmd.Parameters.Add("d_lan",OracleType.Number).Value=d_lan;
				cmd.Parameters.Add("d_madoituong",OracleType.Number).Value=d_madoituong;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				cmd.Parameters.Add("d_stt",OracleType.Number).Value=d_stt;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".d_thuocbhytct (id,stt,makho,mabd,slyeucau,cachdung,manguon,solan,lan,madoituong)";
					sql+=" values (:d_id,:d_stt,:d_makho,:d_mabd,:d_slyeucau,:d_cachdung,:d_manguon,:d_solan,:d_lan,:d_madoituong)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
					cmd.Parameters.Add("d_stt",OracleType.Number).Value=d_stt;
					cmd.Parameters.Add("d_makho",OracleType.Number).Value=d_makho;
					cmd.Parameters.Add("d_mabd",OracleType.Number).Value=d_mabd;
					cmd.Parameters.Add("d_slyeucau",OracleType.Number).Value=d_slyeucau;
					cmd.Parameters.Add("d_cachdung",OracleType.NVarChar,254).Value=d_cachdung;
					cmd.Parameters.Add("d_manguon",OracleType.Number).Value=d_manguon;
					cmd.Parameters.Add("d_solan",OracleType.Number).Value=d_solan;
					cmd.Parameters.Add("d_lan",OracleType.Number).Value=d_lan;
					cmd.Parameters.Add("d_madoituong",OracleType.Number).Value=d_madoituong;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_thuocbhytct");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_thuocbhytct(string d_ngay,long d_id,int d_stt,int d_makho,int d_mabd,decimal d_slyeucau,string d_cachdung,int d_manguon,int d_madoituong)
		{
			string xxx=user+mmyy(d_ngay);
			sql="update "+xxx+".d_thuocbhytct set makho=:d_makho,mabd=:d_mabd,slyeucau=:d_slyeucau,cachdung=:d_cachdung,manguon=:d_manguon,madoituong=:d_madoituong ";
			sql+="where id=:d_id and stt=:d_stt";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;

				cmd.Parameters.Add("d_makho",OracleType.Number).Value=d_makho;
				cmd.Parameters.Add("d_mabd",OracleType.Number).Value=d_mabd;
				cmd.Parameters.Add("d_slyeucau",OracleType.Number).Value=d_slyeucau;
				cmd.Parameters.Add("d_cachdung",OracleType.NVarChar,254).Value=d_cachdung;
				cmd.Parameters.Add("d_manguon",OracleType.Number).Value=d_manguon;
				cmd.Parameters.Add("d_madoituong",OracleType.Number).Value=d_madoituong;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				cmd.Parameters.Add("d_stt",OracleType.Number).Value=d_stt;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".d_thuocbhytct (id,stt,makho,mabd,slyeucau,cachdung,manguon,madoituong)";
					sql+=" values (:d_id,:d_stt,:d_makho,:d_mabd,:d_slyeucau,:d_cachdung,:d_manguon,:d_madoituong)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
					cmd.Parameters.Add("d_stt",OracleType.Number).Value=d_stt;
					cmd.Parameters.Add("d_makho",OracleType.Number).Value=d_makho;
					cmd.Parameters.Add("d_mabd",OracleType.Number).Value=d_mabd;
					cmd.Parameters.Add("d_slyeucau",OracleType.Number).Value=d_slyeucau;
					cmd.Parameters.Add("d_cachdung",OracleType.NVarChar,254).Value=d_cachdung;
					cmd.Parameters.Add("d_manguon",OracleType.Number).Value=d_manguon;
					cmd.Parameters.Add("d_madoituong",OracleType.Number).Value=d_madoituong;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_thuocbhytct");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_thuocbhytll(long d_id,int d_nhom,string d_ngay,string d_mabn,long d_maql,string d_mmyy,int d_userid,int d_madoituong,string d_ghichu,decimal d_songay)
		{
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand("pkg_duoc.upd_thuocbhytll",con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				cmd.Parameters.Add("d_nhom",OracleType.Number).Value=d_nhom;
				cmd.Parameters.Add("d_ngay",OracleType.VarChar,10).Value=d_ngay;
				cmd.Parameters.Add("d_mabn",OracleType.VarChar,8).Value=d_mabn;
				cmd.Parameters.Add("d_maql",OracleType.Number).Value=d_maql;
				cmd.Parameters.Add("d_mmyy",OracleType.VarChar,4).Value=d_mmyy;
				cmd.Parameters.Add("d_userid",OracleType.Number).Value=d_userid;
				cmd.Parameters.Add("d_madoituong",OracleType.Number).Value=d_madoituong;
				cmd.Parameters.Add("d_ghichu",OracleType.NVarChar,254).Value=d_ghichu;
				cmd.Parameters.Add("d_songay",OracleType.Number).Value=d_songay;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_thuocbhytll");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_thuocbhytct(long d_id,int d_stt,int d_makho,int d_mabd,decimal d_slyeucau,string d_cachdung,int d_manguon)
		{
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand("pkg_duoc.upd_thuocbhytct",con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				cmd.Parameters.Add("d_stt",OracleType.Number).Value=d_stt;
				cmd.Parameters.Add("d_makho",OracleType.Number).Value=d_makho;
				cmd.Parameters.Add("d_mabd",OracleType.Number).Value=d_mabd;
				cmd.Parameters.Add("d_slyeucau",OracleType.Number).Value=d_slyeucau;
				cmd.Parameters.Add("d_cachdung",OracleType.NVarChar,254).Value=d_cachdung;
				cmd.Parameters.Add("d_manguon",OracleType.Number).Value=d_manguon;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_thuocbhytct");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_thuocbhytct(long d_id,int d_stt,int d_makho,int d_mabd,decimal d_slyeucau,string d_cachdung,int d_manguon,decimal d_solan,decimal d_lan)
		{
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand("pkg_duoc.upd_thuocbhytct",con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				cmd.Parameters.Add("d_stt",OracleType.Number).Value=d_stt;
				cmd.Parameters.Add("d_makho",OracleType.Number).Value=d_makho;
				cmd.Parameters.Add("d_mabd",OracleType.Number).Value=d_mabd;
				cmd.Parameters.Add("d_slyeucau",OracleType.Number).Value=d_slyeucau;
				cmd.Parameters.Add("d_cachdung",OracleType.NVarChar,254).Value=d_cachdung;
				cmd.Parameters.Add("d_manguon",OracleType.Number).Value=d_manguon;
				cmd.Parameters.Add("d_solan",OracleType.Number).Value=d_solan;
				cmd.Parameters.Add("d_lan",OracleType.Number).Value=d_lan;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_thuocbhytct");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public void upd_tonkhoth_dutru(string tt,int nhom,string mmyy,int makho,int manguon,int mabd,decimal soluong)
		{
			string xxx=user+"d"+mmyy;
			if (bTru_tonao(nhom))
			{
				string skho_truao=kho_truao(nhom);
				if (skho_truao.IndexOf(makho.ToString()+",")!=-1 || skho_truao=="")
				{
					if (tt==dutru || tt==insert) execute_data("update "+xxx+".d_tonkhoth set slyeucau=slyeucau+"+soluong+" where makho="+makho+" and manguon="+manguon+" and mabd="+mabd);
					else if (tt==duyet || tt==delete) execute_data("update "+xxx+".d_tonkhoth set slyeucau=slyeucau-"+soluong+" where makho="+makho+" and manguon="+manguon+" and mabd="+mabd);
				}
			}
		}

		public bool upd_dmcachdung(string d_ten)
		{
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand("pkg_duoc.upd_dmcachdung",con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_ten",OracleType.NVarChar,100).Value=d_ten;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_dmcachdung");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}
		public bool upd_dmcachdung(string d_ten,int d_stt)
		{
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand("pkg_duoc.upd_dmcachdung",con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_ten",OracleType.NVarChar,100).Value=d_ten;
				cmd.Parameters.Add("d_stt",OracleType.Number).Value=d_stt;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_dmcachdung");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_dmcachdung(string d_ten,int d_stt, string d_tencu)
		{
			con=new OracleConnection(sConn);
			try
			{
				sql="update d_dmcachdung set ten=:d_ten, stt=:d_stt where ten=:d_tencu";
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("d_ten",OracleType.NVarChar,100).Value=d_ten;
				cmd.Parameters.Add("d_stt",OracleType.Number).Value=d_stt;
				cmd.Parameters.Add("d_tencu",OracleType.NVarChar,100).Value=d_tencu;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_dmcachdung");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}
		public bool del_dmcachdung(string d_ten)
		{
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand("pkg_duoc.del_dmcachdung",con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_ten",OracleType.NVarChar,50).Value=d_ten;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_dmcachdung");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public void updrec_thuocbhytll(DataTable dt,long id,string ngay,string mabn,long maql,string hoten,string namsinh,string sothe,string chandoan,string maicd,string tenpk,string tenbs,string ghichu, long sotoa)
		{
			string exp="id="+id;
			DataRow r = getrowbyid (dt,exp); 
			if ( r == null )
			{
				DataRow nrow = dt.NewRow ( ) ;
				nrow["id"] = id;
				nrow["ngay"]=ngay;
				nrow["mabn"]=mabn;
				nrow["maql"]=maql;
				nrow["hoten"]=hoten;
				nrow["namsinh"]=namsinh;
				nrow["sothe"]=sothe;
				nrow["tenkp"]=tenpk;
				nrow["tenbs"]=tenbs;
				nrow["chandoan"]=chandoan;
				nrow["maicd"]=maicd;
				nrow["ghichu"]=ghichu;
				nrow["sotoa"]=sotoa;
				dt.Rows.Add ( nrow ) ;
			}
			else
			{
				DataRow[] dr = dt.Select(exp);
				dr[0]["ngay"]=ngay;
				dr[0]["mabn"]=mabn;
				dr[0]["maql"]=maql;
				dr[0]["hoten"]=hoten;
				dr[0]["namsinh"]=namsinh;
				dr[0]["sothe"]=sothe;
				dr[0]["tenkp"]=tenpk;
				dr[0]["tenbs"]=tenbs;
				dr[0]["chandoan"]=chandoan;
				dr[0]["maicd"]=maicd;
				dr[0]["ghichu"]=ghichu;
				dr[0]["sotoa"]=sotoa;
			}
		}

		public long upd_tonkhoct(string mmyy,int makho,int manguon,int nhomcc,long idn,int sttn,int mabd,string handung,string losx,decimal soluong,decimal sotien,decimal giaban,decimal giamua,decimal chietkhau,string fie1,string fie2)
		{
			long stt=getidyymmdd_d(9);
			string xxx=user+"d"+mmyy;
			sql="update "+xxx+".d_tonkhoct set "+fie1+"="+fie1+"+:soluong,"+fie2+"="+fie2+"+:sotien,";
			sql+="manguon=:manguon,nhomcc=:nhomcc,mabd=:mabd,handung=:handung,losx=:losx,";
			sql+="giaban=:giaban,giamua=:giamua ";
			sql+="where makho=:makho and idn=:idn and sttn=:sttn";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("soluong",OracleType.Number).Value=soluong;
				cmd.Parameters.Add("sotien",OracleType.Number).Value=sotien;
				cmd.Parameters.Add("manguon",OracleType.Number).Value=manguon;
				cmd.Parameters.Add("nhomcc",OracleType.Number).Value=nhomcc;
				cmd.Parameters.Add("mabd",OracleType.Number).Value=mabd;
				cmd.Parameters.Add("handung",OracleType.VarChar,4).Value=handung;
				cmd.Parameters.Add("losx",OracleType.VarChar,20).Value=losx;
				cmd.Parameters.Add("giaban",OracleType.Number).Value=giaban;
				cmd.Parameters.Add("giamua",OracleType.Number).Value=giamua;
				cmd.Parameters.Add("makho",OracleType.Number).Value=makho;
				cmd.Parameters.Add("idn",OracleType.Number).Value=idn;
				cmd.Parameters.Add("sttn",OracleType.Number).Value=sttn;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					//stt=getidyymmdd(9);//getidyymmddhhmiss_stt_computer_localhost;//get_id_tonkhoct(9);
					sql="insert into "+xxx+".d_tonkhoct(mmyy,manguon,nhomcc,stt,mabd,handung,losx,giaban,giamua,makho,idn,sttn,"+fie1+","+fie2+") values ";
					sql+="(:mmyy,:manguon,:nhomcc,:stt,:mabd,:handung,:losx,:giaban,:giamua,:makho,:idn,:sttn,:soluong,:sotien)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("mmyy",OracleType.VarChar,4).Value=mmyy;
					cmd.Parameters.Add("manguon",OracleType.Number).Value=manguon;
					cmd.Parameters.Add("nhomcc",OracleType.Number).Value=nhomcc;
					cmd.Parameters.Add("stt",OracleType.Number).Value=stt;
					cmd.Parameters.Add("mabd",OracleType.Number).Value=mabd;
					cmd.Parameters.Add("handung",OracleType.VarChar,4).Value=handung;
					cmd.Parameters.Add("losx",OracleType.VarChar,20).Value=losx;
					cmd.Parameters.Add("giaban",OracleType.Number).Value=giaban;
					cmd.Parameters.Add("giamua",OracleType.Number).Value=giamua;
					cmd.Parameters.Add("makho",OracleType.Number).Value=makho;
					cmd.Parameters.Add("idn",OracleType.Number).Value=idn;
					cmd.Parameters.Add("sttn",OracleType.Number).Value=sttn;
					cmd.Parameters.Add("soluong",OracleType.Number).Value=soluong;
					cmd.Parameters.Add("sotien",OracleType.Number).Value=sotien;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
					upd_dmbd_sudung(mabd);
					upd_theodoi(mmyy,stt,mabd,manguon,nhomcc,handung,losx,"",0,0,0,0,0,giamua,giaban,chietkhau,0,0,0,0,giamua);
				}
				else stt = get_stt_tonkhoct(mmyy, makho, idn, sttn);
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"d_tonkhoct");
				return stt;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}		
			return stt;
		}
		public bool upd_dmbd_sudung(int mabd)
		{
			sql="update d_dmbd_sudung set mabd=:mabd where mabd=:mabd";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("mabd",OracleType.Number).Value=mabd;
				cmd.Parameters.Add("mabd",OracleType.Number).Value=mabd;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into d_dmbd_sudung(mabd) values (:mabd)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("mabd",OracleType.Number).Value=mabd;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"d_dmbd_sudung");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}		
			return true;
		}
		public bool upd_theodoi(string d_mmyy,long d_id,int d_mabd,int d_manguon,int d_nhomcc,string d_handung,string d_losx,string d_sothe,int d_namsx,int d_namsd,int d_baohanh,int d_nguongoc,int d_tinhtrang,decimal d_giamua,decimal d_giaban,decimal d_chietkhau)
		{
			string xxx=user+"d"+d_mmyy+".pkg_duoc.upd_theodoi";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(xxx,con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				cmd.Parameters.Add("d_mabd",OracleType.Number).Value=d_mabd;
				cmd.Parameters.Add("d_manguon",OracleType.Number).Value=d_manguon;
				cmd.Parameters.Add("d_nhomcc",OracleType.Number).Value=d_nhomcc;
				cmd.Parameters.Add("d_handung",OracleType.VarChar,4).Value=d_handung;
				cmd.Parameters.Add("d_losx",OracleType.VarChar,20).Value=d_losx;
				cmd.Parameters.Add("d_sothe",OracleType.VarChar,20).Value=d_sothe;
				cmd.Parameters.Add("d_namsx",OracleType.Number).Value=d_namsx;
				cmd.Parameters.Add("d_namsd",OracleType.Number).Value=d_namsd;
				cmd.Parameters.Add("d_baohanh",OracleType.Number).Value=d_baohanh;
				cmd.Parameters.Add("d_nguongoc",OracleType.Number).Value=d_nguongoc;
				cmd.Parameters.Add("d_tinhtrang",OracleType.Number).Value=d_tinhtrang;
				cmd.Parameters.Add("d_giamua",OracleType.Number).Value=d_giamua;
				cmd.Parameters.Add("d_giaban",OracleType.Number).Value=d_giaban;
				cmd.Parameters.Add("d_chietkhau",OracleType.Number).Value=d_chietkhau;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_theodoi");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}
		
		public bool upd_theodoi(string d_mmyy,long d_id,int d_mabd,int d_manguon,int d_nhomcc,string d_handung,string d_losx,
			string d_sothe,int d_namsx,int d_namsd,int d_baohanh,int d_nguongoc,int d_tinhtrang,decimal d_giamua,
			decimal d_giaban,decimal d_chietkhau,decimal d_tlhaohut,decimal d_giahaohut,decimal d_tylecs,decimal d_gia_cs)
		{
			string xxx=user+"d"+d_mmyy+".pkg_duoc.upd_theodoi";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(xxx,con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				cmd.Parameters.Add("d_mabd",OracleType.Number).Value=d_mabd;
				cmd.Parameters.Add("d_manguon",OracleType.Number).Value=d_manguon;
				cmd.Parameters.Add("d_nhomcc",OracleType.Number).Value=d_nhomcc;
				cmd.Parameters.Add("d_handung",OracleType.VarChar,4).Value=d_handung;
				cmd.Parameters.Add("d_losx",OracleType.VarChar,20).Value=d_losx;
				cmd.Parameters.Add("d_sothe",OracleType.VarChar,20).Value=d_sothe;
				cmd.Parameters.Add("d_namsx",OracleType.Number).Value=d_namsx;
				cmd.Parameters.Add("d_namsd",OracleType.Number).Value=d_namsd;
				cmd.Parameters.Add("d_baohanh",OracleType.Number).Value=d_baohanh;
				cmd.Parameters.Add("d_nguongoc",OracleType.Number).Value=d_nguongoc;
				cmd.Parameters.Add("d_tinhtrang",OracleType.Number).Value=d_tinhtrang;
				cmd.Parameters.Add("d_giamua",OracleType.Number).Value=d_giamua;
				cmd.Parameters.Add("d_giaban",OracleType.Number).Value=d_giaban;
				cmd.Parameters.Add("d_chietkhau",OracleType.Number).Value=d_chietkhau;
				cmd.Parameters.Add("d_tlhaohut",OracleType.Number).Value=d_tlhaohut;
				cmd.Parameters.Add("d_giahaohut",OracleType.Number).Value=d_giahaohut;
				cmd.Parameters.Add("d_tylecs",OracleType.Number).Value=d_tylecs;
				cmd.Parameters.Add("d_gia_cs",OracleType.Number).Value=d_gia_cs;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_theodoi");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_theodoi(string d_mmyy,long d_id,int d_mabd,int d_manguon,int d_nhomcc,string d_handung,string d_losx,
			string d_sothe,int d_namsx,int d_namsd,int d_baohanh,int d_nguongoc,int d_tinhtrang,decimal d_giamua,
			decimal d_giaban,decimal d_chietkhau,decimal d_tlhaohut,decimal d_giahaohut,decimal d_tylecs,
			decimal d_gia_cs,decimal d_gianovat)
		{
			string xxx=user+"d"+d_mmyy+".pkg_duoc.upd_theodoi";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(xxx,con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				cmd.Parameters.Add("d_mabd",OracleType.Number).Value=d_mabd;
				cmd.Parameters.Add("d_manguon",OracleType.Number).Value=d_manguon;
				cmd.Parameters.Add("d_nhomcc",OracleType.Number).Value=d_nhomcc;
				cmd.Parameters.Add("d_handung",OracleType.VarChar,4).Value=d_handung;
				cmd.Parameters.Add("d_losx",OracleType.VarChar,20).Value=d_losx;
				cmd.Parameters.Add("d_sothe",OracleType.VarChar,20).Value=d_sothe;
				cmd.Parameters.Add("d_namsx",OracleType.Number).Value=d_namsx;
				cmd.Parameters.Add("d_namsd",OracleType.Number).Value=d_namsd;
				cmd.Parameters.Add("d_baohanh",OracleType.Number).Value=d_baohanh;
				cmd.Parameters.Add("d_nguongoc",OracleType.Number).Value=d_nguongoc;
				cmd.Parameters.Add("d_tinhtrang",OracleType.Number).Value=d_tinhtrang;
				cmd.Parameters.Add("d_giamua",OracleType.Number).Value=d_giamua;
				cmd.Parameters.Add("d_giaban",OracleType.Number).Value=d_giaban;
				cmd.Parameters.Add("d_chietkhau",OracleType.Number).Value=d_chietkhau;
				cmd.Parameters.Add("d_tlhaohut",OracleType.Number).Value=d_tlhaohut;
				cmd.Parameters.Add("d_giahaohut",OracleType.Number).Value=d_giahaohut;
				cmd.Parameters.Add("d_tylecs",OracleType.Number).Value=d_tylecs;
				cmd.Parameters.Add("d_gia_cs",OracleType.Number).Value=d_gia_cs;
				cmd.Parameters.Add("d_gianovat",OracleType.Number).Value=d_gianovat;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_theodoi");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public long get_stt_tonkhoct(string mmyy, int makho,long idn, int sttn)
		{
			string xxx=user+"d"+mmyy;
			DataTable tmp = get_data("select stt from "+xxx+".d_tonkhoct where makho=" + makho + " and idn=" + idn + " and sttn=" + sttn).Tables[0];
			if (tmp.Rows.Count > 0) return long.Parse(tmp.Rows[0]["stt"].ToString());
			else return 0;
		}
		public bool upd_tonkhoct(string d_mmyy,int d_makho,int d_manguon,int d_nhomcc,long d_stt,int d_mabd,string d_handung,string d_losx,decimal d_tondau,decimal d_sttondau,decimal d_giaban,decimal d_giamua)
		{
			string xxx=user+"d"+d_mmyy+".pkg_duoc.upd_tonkhoct";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(xxx,con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_mmyy",OracleType.VarChar,4).Value=d_mmyy;
				cmd.Parameters.Add("d_makho",OracleType.Number).Value=d_makho;
				cmd.Parameters.Add("d_manguon",OracleType.Number).Value=d_manguon;
				cmd.Parameters.Add("d_nhomcc",OracleType.Number).Value=d_nhomcc;
				cmd.Parameters.Add("d_stt",OracleType.Number).Value=d_stt;
				cmd.Parameters.Add("d_mabd",OracleType.Number).Value=d_mabd;
				cmd.Parameters.Add("d_handung",OracleType.VarChar,4).Value=d_handung;
				cmd.Parameters.Add("d_losx",OracleType.VarChar,20).Value=d_losx;
				cmd.Parameters.Add("d_tondau",OracleType.Number).Value=d_tondau;
				cmd.Parameters.Add("d_sttondau",OracleType.Number).Value=d_sttondau;
				cmd.Parameters.Add("d_giaban",OracleType.Number).Value=d_giaban;
				cmd.Parameters.Add("d_giamua",OracleType.Number).Value=d_giamua;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_tonkhoct");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_tonkhoth(string mmyy,int makho,int manguon,int mabd,decimal soluong,string fie)
		{
			string xxx=user+"d"+mmyy;
			sql="update "+xxx+".d_tonkhoth set "+fie+"="+fie+"+:soluong where makho=:makho and manguon=:manguon and mabd=:mabd";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("soluong",OracleType.Number).Value=soluong;
				cmd.Parameters.Add("makho",OracleType.Number).Value=makho;
				cmd.Parameters.Add("manguon",OracleType.Number).Value=manguon;
				cmd.Parameters.Add("mabd",OracleType.Number).Value=mabd;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".d_tonkhoth(mmyy,makho,manguon,mabd,"+fie+") values ";
					sql+="(:mmyy,:makho,:manguon,:mabd,:soluong)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("mmyy",OracleType.VarChar,4).Value=mmyy;
					cmd.Parameters.Add("makho",OracleType.Number).Value=makho;
					cmd.Parameters.Add("manguon",OracleType.Number).Value=manguon;
					cmd.Parameters.Add("mabd",OracleType.Number).Value=mabd;
					cmd.Parameters.Add("soluong",OracleType.Number).Value=soluong;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"d_tonkhoth");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_tonkhoct(string mmyy,int makho,int manguon,int nhomcc,long stt,int mabd,string handung,string losx,decimal soluong,decimal sotien,decimal giaban,decimal giamua,string fie1,string fie2)
		{
			string xxx=user+"d"+mmyy;
			sql="update "+xxx+".d_tonkhoct set "+fie1+"="+fie1+"+:soluong,"+fie2+"="+fie2+"+:sotien,";
			sql+="manguon=:manguon,nhomcc=:nhomcc,mabd=:mabd,handung=:handung,losx=:losx,";
			sql+="giaban=:giaban,giamua=:giamua ";
			sql+="where makho=:makho and stt=:stt";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("soluong",OracleType.Number).Value=soluong;
				cmd.Parameters.Add("sotien",OracleType.Number).Value=sotien;
				cmd.Parameters.Add("manguon",OracleType.Number).Value=manguon;
				cmd.Parameters.Add("nhomcc",OracleType.Number).Value=nhomcc;
				cmd.Parameters.Add("mabd",OracleType.Number).Value=mabd;
				cmd.Parameters.Add("handung",OracleType.VarChar,4).Value=handung;
				cmd.Parameters.Add("losx",OracleType.VarChar,20).Value=losx;
				cmd.Parameters.Add("giaban",OracleType.Number).Value=giaban;
				cmd.Parameters.Add("giamua",OracleType.Number).Value=giamua;
				cmd.Parameters.Add("makho",OracleType.Number).Value=makho;
				cmd.Parameters.Add("stt",OracleType.Number).Value=stt;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".d_tonkhoct(mmyy,manguon,nhomcc,stt,mabd,handung,losx,giaban,giamua,makho,"+fie1+","+fie2+",idn,sttn) values ";
					sql+="(:mmyy,:manguon,:nhomcc,:stt,:mabd,:handung,:losx,:giaban,:giamua,:makho,:soluong,:sotien,0,0)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("mmyy",OracleType.VarChar,4).Value=mmyy;
					cmd.Parameters.Add("manguon",OracleType.Number).Value=manguon;
					cmd.Parameters.Add("nhomcc",OracleType.Number).Value=nhomcc;
					cmd.Parameters.Add("stt",OracleType.Number).Value=stt;
					cmd.Parameters.Add("mabd",OracleType.Number).Value=mabd;
					cmd.Parameters.Add("handung",OracleType.VarChar,4).Value=handung;
					cmd.Parameters.Add("losx",OracleType.VarChar,20).Value=losx;
					cmd.Parameters.Add("giaban",OracleType.Number).Value=giaban;
					cmd.Parameters.Add("giamua",OracleType.Number).Value=giamua;
					cmd.Parameters.Add("makho",OracleType.Number).Value=makho;
					cmd.Parameters.Add("soluong",OracleType.Number).Value=soluong;
					cmd.Parameters.Add("sotien",OracleType.Number).Value=sotien;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"d_tonkhoct");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}		
			return true;
		}
		public void upd_tonkhoth(string tt,string mmyy,int makho,int mabd,int manguon,decimal soluong,string fie)
		{
			string xxx=user+"d"+mmyy;
			if (tt==delete) execute_data("update "+xxx+".d_tonkhoth set "+fie+"="+fie+"-"+soluong+" where mmyy='"+mmyy+"' and makho="+makho+" and mabd="+mabd+" and manguon="+manguon);
			else if (tt==insert) upd_tonkhoth(mmyy,makho,manguon,mabd,soluong,fie);
		}
		public string kho_truao(int d_nhom)
		{
			ds=get_data("select ten from d_thongso where id=189 and nhom="+d_nhom);
			if (ds.Tables[0].Rows.Count==0) return "";
			else return ds.Tables[0].Rows[0][0].ToString();
		}
		public void updrec_tonkho_tutruc(DataTable dt,long sttt,int kho,int mabd,int tutruc,decimal soluong,string toantu)
		{
			DataRow[] r=dt.Select("sttt="+sttt+" and makho="+kho+" and id="+mabd+" and tutruc="+tutruc);
			if (r.Length>0)
			{
				if (toantu=="+")
					r[0]["soluong"]=decimal.Parse(r[0]["soluong"].ToString())+soluong;
				else
					r[0]["soluong"]=decimal.Parse(r[0]["soluong"].ToString())-soluong;
			}
		}

		public void updrec_tonkho_tutruc(DataTable dt,int kho,int mabd,int tutruc,decimal soluong,string toantu)
		{
			DataRow[] r=dt.Select("makho="+kho+" and id="+mabd+" and tutruc="+tutruc);
			if (r.Length>0)
			{
				if (toantu=="+")
					r[0]["soluong"]=decimal.Parse(r[0]["soluong"].ToString())+soluong;
				else
					r[0]["soluong"]=decimal.Parse(r[0]["soluong"].ToString())-soluong;
			}
		}
		public long get_id_donthuoc_bacsy()
		{
			return getidyymmdd_d(18);
		}
		public long get_id_donthuoc_bacsy(string mabs,string maicd)
		{
			ds=get_data("select id from d_theodonll where mabs='"+mabs+"' and maicd='"+maicd+"'");
			return (ds.Tables[0].Rows.Count>0)?long.Parse(ds.Tables[0].Rows[0]["id"].ToString()):0;
		}
		public bool upd_theodonll(long d_id,string d_mabs,string d_maicd,string d_ghichu,int d_stt,int d_so,decimal d_songay)
		{
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand("pkg_duoc.upd_theodonll",con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				cmd.Parameters.Add("d_mabs",OracleType.VarChar,4).Value=d_mabs;
				cmd.Parameters.Add("d_maicd",OracleType.VarChar,9).Value=d_maicd;
				cmd.Parameters.Add("d_ghichu",OracleType.NVarChar,254).Value=d_ghichu;
				cmd.Parameters.Add("d_stt",OracleType.Number).Value=d_stt;
				cmd.Parameters.Add("d_so",OracleType.Number).Value=d_so;
				cmd.Parameters.Add("d_songay",OracleType.Number).Value=d_songay;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_theodonll");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_theodonct(long d_id,long d_mabd,long d_stt,decimal d_soluong,string d_cachdung)
		{
			sql="update d_theodonct set stt=:d_stt,soluong=:d_soluong,cachdung=:d_cachdung where id=:d_id and mabd=:d_mabd";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("d_stt",OracleType.Number).Value=d_stt;
				cmd.Parameters.Add("d_soluong",OracleType.Number).Value=d_soluong;
				cmd.Parameters.Add("d_cachdung",OracleType.NVarChar,254).Value=d_cachdung;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				cmd.Parameters.Add("d_mabd",OracleType.Number).Value=d_mabd;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into d_theodonct(id,mabd,stt,soluong,cachdung) values (:d_id,:d_mabd,:d_stt,:d_soluong,:d_cachdung)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
					cmd.Parameters.Add("d_mabd",OracleType.Number).Value=d_mabd;
					cmd.Parameters.Add("d_stt",OracleType.Number).Value=d_stt;
					cmd.Parameters.Add("d_soluong",OracleType.Number).Value=d_soluong;
					cmd.Parameters.Add("d_cachdung",OracleType.NVarChar,254).Value=d_cachdung;
					cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"d_theodonct");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}		
			return true;
		}
		public long get_id_dmbd{get{return get_capid_d(1);}}
		public string Mabd(string s,int so)
		{
			DataSet ds=new DataSet();
			ds.ReadXml("..\\..\\..\\xml\\khongdau.xml");
			string s1=s.Trim().ToUpper(),s2="";
			DataRow r;
			for(int i=0;i<s1.Length;i++)
			{
				if (s1[i].ToString().Trim()!="")
				{	
					r=getrowbyid(ds.Tables[0],"codau='"+s1[i].ToString()+"'");
					if (r!=null) s2+=r[1].ToString();
					else s2+=s1[i];
				}
				if (s2.Length==so) break;
			}
			return s2.PadRight(3,'0');
		}

		public string getMabd(string table,string s,int manhom)
		{
			string s1=Mabd(s,3);
			int i=1;
			try
			{
				sql="select max(substr(ma,4)) from "+table+" where substr(ma,1,3)='"+s1.ToUpper()+"' and nhom="+manhom;
				string stt=get_data(sql).Tables[0].Rows[0][0].ToString();
				i=int.Parse(stt)+1;
			}
			catch{}
			return s1+i.ToString().PadLeft(6-s1.Length,'0');
		}
		public bool upd_dmthuoc(long d_id,string d_ten,string d_dang,string d_cachdung,string d_tenhc)
		{
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand("pkg_duoc.upd_dmthuoc",con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				cmd.Parameters.Add("d_ten",OracleType.NVarChar,100).Value=d_ten;
				cmd.Parameters.Add("d_dang",OracleType.NVarChar,20).Value=d_dang;
				cmd.Parameters.Add("d_cachdung",OracleType.NVarChar,50).Value=d_cachdung;
				cmd.Parameters.Add("d_tenhc",OracleType.NVarChar,254).Value=d_tenhc;				
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_dmthuoc");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}
		public bool upd_dmthuoc(long d_id,string d_ten,string d_dang,string d_cachdung,string d_tenhc, string d_duongdung)
		{
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand("pkg_duoc.upd_dmthuoc",con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				cmd.Parameters.Add("d_ten",OracleType.NVarChar,100).Value=d_ten;
				cmd.Parameters.Add("d_dang",OracleType.NVarChar,20).Value=d_dang;
				cmd.Parameters.Add("d_cachdung",OracleType.NVarChar,50).Value=d_cachdung;
				cmd.Parameters.Add("d_tenhc",OracleType.NVarChar,254).Value=d_tenhc;
				cmd.Parameters.Add("d_duongdung",OracleType.NVarChar,100).Value=d_duongdung;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_dmthuoc");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}
		public bool upd_dmthuoc(long d_id,string d_ten,string d_dang,string d_cachdung,string d_tenhc,int d_hide)
		{
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand("pkg_duoc.upd_dmthuoc",con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				cmd.Parameters.Add("d_ten",OracleType.NVarChar,100).Value=d_ten;
				cmd.Parameters.Add("d_dang",OracleType.NVarChar,20).Value=d_dang;
				cmd.Parameters.Add("d_cachdung",OracleType.NVarChar,50).Value=d_cachdung;
				cmd.Parameters.Add("d_tenhc",OracleType.NVarChar,254).Value=d_tenhc;
				cmd.Parameters.Add("d_hide",OracleType.Number).Value=d_hide;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_dmthuoc");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}
		public bool upd_dmbd(long d_id,string d_ma,string d_ten,string d_dang,string d_hamluong,int d_manhom,int d_maloai,int d_mahang,int d_manuoc,int d_nhombo,int d_bhyt,int d_thietyeu,int d_sotk,string d_tenhc,string d_mahc,int d_soluong,int d_nhom,string d_sodk,decimal d_sltoithieu,int d_ngaytra,int d_tutruc,int d_phatsau,decimal d_tyle,decimal d_stt,string d_hinh,int d_nhomin,int d_sunghiep,string d_duongdung,string d_congsuat,int d_madv,string d_donvi)
		{
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand("pkg_duoc.upd_dmbd",con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				cmd.Parameters.Add("d_ma",OracleType.VarChar,10).Value=d_ma.Trim();
				cmd.Parameters.Add("d_ten",OracleType.NVarChar,100).Value=d_ten;
				cmd.Parameters.Add("d_dang",OracleType.NVarChar,20).Value=d_dang;
				cmd.Parameters.Add("d_hamluong",OracleType.NVarChar,20).Value=d_hamluong;
				cmd.Parameters.Add("d_manhom",OracleType.Number).Value=d_manhom;
				cmd.Parameters.Add("d_maloai",OracleType.Number).Value=d_maloai;
				cmd.Parameters.Add("d_mahang",OracleType.Number).Value=d_mahang;
				cmd.Parameters.Add("d_manuoc",OracleType.Number).Value=d_manuoc;
				cmd.Parameters.Add("d_nhombo",OracleType.Number).Value=d_nhombo;
				cmd.Parameters.Add("d_bhyt",OracleType.Number).Value=d_bhyt;
				cmd.Parameters.Add("d_thietyeu",OracleType.Number).Value=d_thietyeu;
				cmd.Parameters.Add("d_sotk",OracleType.Number).Value=d_sotk;
				cmd.Parameters.Add("d_tenhc",OracleType.NVarChar,254).Value=d_tenhc;
				cmd.Parameters.Add("d_mahc",OracleType.VarChar,50).Value=d_mahc;
				cmd.Parameters.Add("d_soluong",OracleType.Number).Value=d_soluong;
				cmd.Parameters.Add("d_nhom",OracleType.Number).Value=d_nhom;
				cmd.Parameters.Add("d_sodk",OracleType.VarChar,20).Value=d_sodk;
				cmd.Parameters.Add("d_sltoithieu",OracleType.Number).Value=d_sltoithieu;
				cmd.Parameters.Add("d_ngaytra",OracleType.Number).Value=d_ngaytra;
				cmd.Parameters.Add("d_tutruc",OracleType.Number).Value=d_tutruc;
				cmd.Parameters.Add("d_phatsau",OracleType.Number).Value=d_phatsau;
				cmd.Parameters.Add("d_tyle",OracleType.Number).Value=d_tyle;
				cmd.Parameters.Add("d_stt",OracleType.Number).Value=d_stt;
				cmd.Parameters.Add("d_hinh",OracleType.VarChar,100).Value=d_hinh;
				cmd.Parameters.Add("d_nhomin",OracleType.Number).Value=d_nhomin;
				cmd.Parameters.Add("d_sunghiep",OracleType.Number).Value=d_sunghiep;
				cmd.Parameters.Add("d_duongdung",OracleType.NVarChar,100).Value=d_duongdung;
				cmd.Parameters.Add("d_congsuat",OracleType.NVarChar,50).Value=d_congsuat;
				cmd.Parameters.Add("d_madv",OracleType.Number).Value=d_madv;
				cmd.Parameters.Add("d_donvi",OracleType.NVarChar,20).Value=d_donvi;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_dmbd-"+d_ma);
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}
			return true;
		}
		public long get_cholai_bhyt(string d_nam,string d_ngay,string d_mabn)
		{
			try
			{
				ds=(d_nam!="")?get_data_nam_dec(d_nam,"select id,to_char(ngay,'yyyymmdd') ngay from xxx.d_thuocbhytll where mabn='"+d_mabn+"' order by ngay desc"):get_data("select id,to_char(ngay,'yyyymmdd') ngay from "+user+mmyy(d_ngay)+".d_thuocbhytll where mabn='"+d_mabn+"' order by ngay desc");
				if (ds.Tables[0].Rows.Count==0) return 0;
				else return long.Parse(ds.Tables[0].Rows[0]["id"].ToString());
			}
			catch{return 0;}
		}
		public long get_cholai(string d_mabn,int d_phieu,string d_table)
		{
			try
			{
				ds=get_data("select a.id,to_char(b.ngay,'yyyymmdd') ngay from "+d_table+" a,d_duyet b where a.idduyet=b.id and b.phieu="+d_phieu+" and a.mabn='"+d_mabn+"'"+" order by b.ngay desc");
				if (ds.Tables[0].Rows.Count==0) return 0;
				else return long.Parse(ds.Tables[0].Rows[0]["id"].ToString());
			}
			catch{return 0;}
		}
		public bool upd_bhytkb(long d_id,int d_nhom,long d_quyenso,long d_sobienlai,string d_ngay,string d_mabn,long d_maql,string d_makp,string d_chandoan,string d_maicd,string d_mabs,string d_sothe,int d_maphu,string d_mabv,decimal d_congkham,decimal d_thuoc,decimal d_cls,decimal d_bntra,decimal d_bhyttra,string d_mmyy,int d_userid,int d_loaiba)
		{
			string xxx=user+"d"+d_mmyy+".pkg_duoc.upd_bhytkb";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(xxx,con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				cmd.Parameters.Add("d_nhom",OracleType.Number).Value=d_nhom;
				cmd.Parameters.Add("d_quyenso",OracleType.Number).Value=d_quyenso;
				cmd.Parameters.Add("d_sobienlai",OracleType.Number).Value=d_sobienlai;
				cmd.Parameters.Add("d_ngay",OracleType.VarChar,10).Value=d_ngay;
				cmd.Parameters.Add("d_mabn",OracleType.VarChar,8).Value=d_mabn;
				cmd.Parameters.Add("d_maql",OracleType.Number).Value=d_maql;
				cmd.Parameters.Add("d_makp",OracleType.VarChar,2).Value=d_makp;
				cmd.Parameters.Add("d_chandoan",OracleType.NVarChar,254).Value=d_chandoan;
				cmd.Parameters.Add("d_maicd",OracleType.VarChar,9).Value=d_maicd;
				cmd.Parameters.Add("d_mabs",OracleType.VarChar,4).Value=d_mabs;
				cmd.Parameters.Add("d_sothe",OracleType.VarChar,20).Value=d_sothe;
				cmd.Parameters.Add("d_maphu",OracleType.Number).Value=d_maphu;
				cmd.Parameters.Add("d_mabv",OracleType.VarChar,8).Value=d_mabv;
				cmd.Parameters.Add("d_congkham",OracleType.Number).Value=d_congkham;
				cmd.Parameters.Add("d_thuoc",OracleType.Number).Value=d_thuoc;
				cmd.Parameters.Add("d_cls",OracleType.Number).Value=d_cls;
				cmd.Parameters.Add("d_bntra",OracleType.Number).Value=d_bntra;
				cmd.Parameters.Add("d_bhyttra",OracleType.Number).Value=d_bhyttra;
				cmd.Parameters.Add("d_mmyy",OracleType.VarChar,4).Value=d_mmyy;
				cmd.Parameters.Add("d_userid",OracleType.Number).Value=d_userid;
				cmd.Parameters.Add("d_loaiba",OracleType.Number).Value=d_loaiba;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"bhytkb");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			upd_hcton(d_nhom,d_mmyy,d_userid);
			return true;
		}
		public bool upd_bhytkb(long d_id,int d_nhom,string d_ngay,string d_mabn,long d_maql,string d_makp,string d_chandoan,string d_maicd,string d_mabs,string d_sothe,int d_maphu,string d_mabv,string d_mmyy,int d_userid,int d_loaiba)
		{
			string xxx=user+"d"+d_mmyy+".pkg_duoc.upd_bhytkb";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(xxx,con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				cmd.Parameters.Add("d_nhom",OracleType.Number).Value=d_nhom;
				cmd.Parameters.Add("d_ngay",OracleType.VarChar,10).Value=d_ngay;
				cmd.Parameters.Add("d_mabn",OracleType.VarChar,8).Value=d_mabn;
				cmd.Parameters.Add("d_maql",OracleType.Number).Value=d_maql;
				cmd.Parameters.Add("d_makp",OracleType.VarChar,2).Value=d_makp;
				cmd.Parameters.Add("d_chandoan",OracleType.NVarChar,254).Value=d_chandoan;
				cmd.Parameters.Add("d_maicd",OracleType.VarChar,9).Value=d_maicd;
				cmd.Parameters.Add("d_mabs",OracleType.VarChar,4).Value=d_mabs;
				cmd.Parameters.Add("d_sothe",OracleType.VarChar,20).Value=d_sothe;
				cmd.Parameters.Add("d_maphu",OracleType.Number).Value=d_maphu;
				cmd.Parameters.Add("d_mabv",OracleType.VarChar,8).Value=d_mabv;
				cmd.Parameters.Add("d_mmyy",OracleType.VarChar,4).Value=d_mmyy;
				cmd.Parameters.Add("d_userid",OracleType.Number).Value=d_userid;
				cmd.Parameters.Add("d_loaiba",OracleType.Number).Value=d_loaiba;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"bhytkb");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			upd_hcton(d_nhom,d_mmyy,d_userid);
			return true;
		}
		public bool upd_bhytds(string d_mmyy,string d_mabn,string d_hoten,string d_namsinh,string d_diachi)
		{
			string xxx=user+"d"+d_mmyy+".pkg_duoc.upd_bhytds";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(xxx,con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_mabn",OracleType.VarChar,8).Value=d_mabn;
				cmd.Parameters.Add("d_hoten",OracleType.NVarChar,70).Value=d_hoten;
				cmd.Parameters.Add("d_namsinh",OracleType.VarChar,4).Value=d_namsinh;
				cmd.Parameters.Add("d_diachi",OracleType.NVarChar,254).Value=d_diachi;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"bhytds");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}
		public bool upd_bhytthuoc(string d_mmyy,long d_id,int d_stt,long d_sttt,int d_makho,int d_manguon,int d_nhomcc,int d_mabd,string d_handung,string d_losx,decimal d_soluong,decimal d_sotien,decimal d_giaban,decimal d_giamua,string d_cachdung)
		{
			string xxx=user+"d"+d_mmyy+".pkg_duoc.upd_bhytthuoc";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(xxx,con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				cmd.Parameters.Add("d_stt",OracleType.Number).Value=d_stt;
				cmd.Parameters.Add("d_sttt",OracleType.Number).Value=d_sttt;
				cmd.Parameters.Add("d_makho",OracleType.Number).Value=d_makho;
				cmd.Parameters.Add("d_manguon",OracleType.Number).Value=d_manguon;
				cmd.Parameters.Add("d_nhomcc",OracleType.Number).Value=d_nhomcc;
				cmd.Parameters.Add("d_mabd",OracleType.Number).Value=d_mabd;
				cmd.Parameters.Add("d_handung",OracleType.VarChar,4).Value=d_handung;
				cmd.Parameters.Add("d_losx",OracleType.VarChar,20).Value=d_losx;
				cmd.Parameters.Add("d_soluong",OracleType.Number).Value=d_soluong;
				cmd.Parameters.Add("d_sotien",OracleType.Number).Value=d_sotien;
				cmd.Parameters.Add("d_giaban",OracleType.Number).Value=d_giaban;
				cmd.Parameters.Add("d_giamua",OracleType.Number).Value=d_giamua;
				cmd.Parameters.Add("d_cachdung",OracleType.NVarChar,254).Value=d_cachdung;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"bhytthuoc");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_bhytthuoc(string d_mmyy,long d_id,int d_stt,long d_sttt,int d_makho,int d_manguon,int d_nhomcc,int d_mabd,string d_handung,string d_losx,decimal d_soluong,decimal d_sotien,decimal d_giaban,decimal d_giamua,string d_cachdung,int d_madoituong)
		{
			string xxx=user+"d"+d_mmyy+".pkg_duoc.upd_bhytthuoc";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(xxx,con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				cmd.Parameters.Add("d_stt",OracleType.Number).Value=d_stt;
				cmd.Parameters.Add("d_sttt",OracleType.Number).Value=d_sttt;
				cmd.Parameters.Add("d_makho",OracleType.Number).Value=d_makho;
				cmd.Parameters.Add("d_manguon",OracleType.Number).Value=d_manguon;
				cmd.Parameters.Add("d_nhomcc",OracleType.Number).Value=d_nhomcc;
				cmd.Parameters.Add("d_mabd",OracleType.Number).Value=d_mabd;
				cmd.Parameters.Add("d_handung",OracleType.VarChar,4).Value=d_handung;
				cmd.Parameters.Add("d_losx",OracleType.VarChar,20).Value=d_losx;
				cmd.Parameters.Add("d_soluong",OracleType.Number).Value=d_soluong;
				cmd.Parameters.Add("d_sotien",OracleType.Number).Value=d_sotien;
				cmd.Parameters.Add("d_giaban",OracleType.Number).Value=d_giaban;
				cmd.Parameters.Add("d_giamua",OracleType.Number).Value=d_giamua;
				cmd.Parameters.Add("d_cachdung",OracleType.NVarChar,254).Value=d_cachdung;
				cmd.Parameters.Add("d_madoituong",OracleType.Number).Value=d_madoituong;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"bhytthuoc");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_bhytcls(string d_mmyy,long d_id,int d_stt,int d_mavp,decimal d_soluong,decimal d_dongia,long d_idchidinh)
		{
			string xxx=user+"d"+d_mmyy+".pkg_duoc.upd_bhytcls";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(xxx,con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				cmd.Parameters.Add("d_stt",OracleType.Number).Value=d_stt;
				cmd.Parameters.Add("d_mavp",OracleType.Number).Value=d_mavp;
				cmd.Parameters.Add("d_soluong",OracleType.Number).Value=d_soluong;
				cmd.Parameters.Add("d_dongia",OracleType.Number).Value=d_dongia;
				cmd.Parameters.Add("d_idchidinh",OracleType.Number).Value=d_idchidinh;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"bhytcls");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public DataTable get_bhytthuoc(string mmyy,DataRow [] r,long id,int madoituong,int nhom)
		{
			DataSet ds=new DataSet();
			ds.ReadXml("..\\..\\..\\xml\\d_bhytthuoc.xml");
			int stt=0;
			int irec=0;
			DataRow [] dr;
			DataTable dttonct;
			decimal sl,sltx,sttx,slton,dongia;
			for(int j=0;j<r.Length;j++)
			{
				sl=decimal.Parse(r[j]["soluong"].ToString());
				dttonct=get_tonkhoct_bhyt(mmyy,int.Parse(r[j]["makho"].ToString()),int.Parse(r[j]["manguon"].ToString()),madoituong,int.Parse(r[j]["mabd"].ToString()));
				dr=dttonct.Select("true","stt");
				irec=dr.Length;
				for(int i=0;i<irec;i++)
				{
					slton=decimal.Parse(dr[i]["tondau"].ToString())+decimal.Parse(dr[i]["slnhap"].ToString())-decimal.Parse(dr[i]["slxuat"].ToString());
					dongia=decimal.Parse(dr[i]["giamua"].ToString());
					sltx=Math.Min(sl,slton);
					if (sltx>0)
					{
						stt=get_stt(ds.Tables[0]);
						sttx=dongia*sltx;
						dr[i]["slxuat"]=decimal.Parse(dr[i]["slxuat"].ToString())+sltx;
						updrec_bhytthuoc(ds.Tables[0],stt,long.Parse(dr[i]["stt"].ToString()),int.Parse(dr[i]["mabd"].ToString()),r[j]["ma"].ToString(),r[j]["ten"].ToString(),r[j]["tenhc"].ToString(),r[j]["dang"].ToString(),r[j]["tenkho"].ToString(),dr[i]["tennguon"].ToString(),dr[i]["tennhomcc"].ToString(),dr[i]["handung"].ToString(),dr[i]["losx"].ToString(),sltx,dongia,sttx,decimal.Parse(dr[i]["giaban_"].ToString()),decimal.Parse(dr[i]["giamua"].ToString()),sttx,r[j]["cachdung"].ToString(),int.Parse(dr[i]["makho"].ToString()),int.Parse(dr[i]["manguon"].ToString()),int.Parse(dr[i]["nhomcc"].ToString()),int.Parse(r[j]["madoituong"].ToString()),null);
						//
						upd_bhytthuoc(mmyy,id,stt,long.Parse(dr[i]["stt"].ToString()),int.Parse(dr[i]["makho"].ToString()),int.Parse(dr[i]["manguon"].ToString()),int.Parse(dr[i]["nhomcc"].ToString()),int.Parse(dr[i]["mabd"].ToString()),dr[i]["handung"].ToString(),dr[i]["losx"].ToString(),sltx,sttx,decimal.Parse(dr[i]["giaban_"].ToString()),decimal.Parse(dr[i]["giamua"].ToString()),r[j]["cachdung"].ToString(),int.Parse(r[j]["madoituong"].ToString()));
						upd_tonkhoct_xuat(insert,mmyy,long.Parse(dr[i]["stt"].ToString()),int.Parse(dr[i]["makho"].ToString()),int.Parse(dr[i]["manguon"].ToString()),int.Parse(dr[i]["nhomcc"].ToString()),int.Parse(dr[i]["mabd"].ToString()),dr[i]["handung"].ToString(),dr[i]["losx"].ToString(),sltx,sttx,decimal.Parse(dr[i]["giaban_"].ToString()),decimal.Parse(dr[i]["giamua"].ToString()));
						execute_data("update d_thuocbhytct set slthuc=slthuc+"+sltx+" where id="+id+" and mabd="+int.Parse(dr[i]["mabd"].ToString())+" and makho="+int.Parse(dr[i]["makho"].ToString()));
						upd_tonkhoth_dutru(duyet,nhom,mmyy,int.Parse(dr[i]["makho"].ToString()),int.Parse(dr[i]["manguon"].ToString()),int.Parse(dr[i]["mabd"].ToString()),sltx);
						//
					}
					sl-=sltx;
					if (sl<=0) break;
				}
				if (sl>0 && id!=0) upd_treo(id,int.Parse(r[j]["stt"].ToString()),int.Parse(r[j]["manguon"].ToString()),int.Parse(r[j]["mabd"].ToString()),sl,"bhythuoc",int.Parse(r[j]["makho"].ToString()),0);
			}
			ds.AcceptChanges();
			return ds.Tables[0];
		}

		public DataTable get_tonkhoct_bhyt(string mmyy,string makho,string kho,string manguon,int madoituong)
		{
			string xxx=user+"d"+mmyy;
			sql="select a.*,b.ten tennguon,c.ten tennhomcc,d.giaban as giaban_ from "+xxx+".d_tonkhoct a,"+user+".d_dmnguon b,"+user+".d_nhomcc c,"+user+".d_dmbd d where a.manguon=b.id and a.nhomcc=c.id(+) and a.mabd=d.id and a.mmyy='"+mmyy+"'";
			if (madoituong==1) sql+=" and d.bhyt<>0";
			if (makho!="") sql+=" and a.makho in ("+makho+")";
			if (kho!="") sql+=" and a.makho in ("+kho.Substring(0,kho.Length-1)+")";
			if (manguon!="") sql+=" and a.manguon in ("+manguon+")";
			sql+=" order by a.stt";
			DataTable tmp=get_data(sql).Tables[0];
			DataRow r1;
			string mmyys="";
			foreach(DataRow r2 in get_data("select mmyy from d_table where substr(mmyy,3,2)||substr(mmyy,1,2)>'"+mmyy.Substring(2,2)+mmyy.Substring(0,2)+"'").Tables[0].Rows)
			{
				mmyys=r2["mmyy"].ToString();
				xxx=user+"d"+mmyys;
				sql="select a.makho,a.stt,sum(a.slxuat) soluong from "+xxx+".d_tonkhoct a,"+user+".d_dmkho d where a.makho=d.id and a.slxuat>0 and a.mmyy='"+mmyys+"'";
				if (makho!="") sql+=" and a.makho in ("+makho+")";
				if (kho!="") sql+=" and a.makho in ("+kho.Substring(0,kho.Length-1)+")";
				if (manguon!="") sql+=" and a.manguon in ("+manguon+")";
				sql+=" group by a.makho,a.stt";
				foreach(DataRow r in get_data(sql).Tables[0].Rows)
				{
					r1=getrowbyid(tmp,"makho="+int.Parse(r["makho"].ToString())+" and stt="+int.Parse(r["stt"].ToString()));
					if (r1!=null) r1["slxuat"]=decimal.Parse(r1["slxuat"].ToString())+decimal.Parse(r["soluong"].ToString());
				}
			}
			return tmp;
		}

		public void updrec_bhytthuoc(DataTable dt,int stt,long sttt,int mabd,string ma,string ten,string tenhc,string dang,string tenkho,string tennguon,string tennhomcc,string handung,string losx,decimal soluong,decimal dongia,decimal sotienmua,decimal giaban,decimal giamua,decimal sotien,string cachdung,int makho,int manguon,int nhomcc,int madoituong,DataTable dtton)
		{
			string exp="stt="+stt;
			DataRow r = getrowbyid (dt,exp); 
			if ( r == null )
			{
				DataRow nrow = dt.NewRow ( ) ;
				nrow["stt"] = stt;
				nrow["sttt"] = sttt;
				nrow["mabd"] = mabd;
				nrow["ma"] = ma;
				nrow["ten"] = ten;
				nrow["tenhc"] = tenhc;
				nrow["dang"] = dang;
				nrow["tenkho"] = tenkho;
				nrow["tennguon"] = tennguon;
				nrow["tennhomcc"] = tennhomcc;
				nrow["handung"] = handung;
				nrow["losx"] = losx;
				nrow["soluong"] = soluong;
				nrow["dongia"] = dongia;
				nrow["sotien"] = sotien;
				nrow["sotienmua"] = sotienmua;
				nrow["giaban"]=giaban;
				nrow["giamua"]=giamua;
				nrow["cachdung"]=cachdung;
				nrow["makho"] = makho;
				nrow["manguon"] = manguon;
				nrow["nhomcc"] = nhomcc;
				nrow["madoituong"]=madoituong;
				dt.Rows.Add ( nrow ) ;
				if (dtton!=null) updrec_tonkho_nguon(dtton,makho,mabd,manguon,soluong,"-");
			}
			else
			{
				DataRow[] dr = dt.Select(exp);
				if (dtton!=null)
				{
					decimal sl=decimal.Parse(dr[0]["soluong"].ToString());
					updrec_tonkho_nguon(dtton,makho,mabd,manguon,sl,"+");
					updrec_tonkho_nguon(dtton,makho,mabd,manguon,soluong,"-");
				}
				dr[0]["sttt"] = sttt;
				dr[0]["mabd"] = mabd;
				dr[0]["ma"] = ma;
				dr[0]["ten"] = ten;
				dr[0]["tenhc"] = tenhc;
				dr[0]["dang"] = dang;
				dr[0]["tenkho"] = tenkho;
				dr[0]["tennguon"] = tennguon;
				dr[0]["tennhomcc"] = tennhomcc;
				dr[0]["handung"] = handung;
				dr[0]["losx"] = losx;
				dr[0]["soluong"] = soluong;
				dr[0]["dongia"] = dongia;
				dr[0]["sotien"] = sotien;
				dr[0]["sotienmua"] = sotienmua;
				dr[0]["giaban"]=giaban;
				dr[0]["giamua"]=giamua;
				dr[0]["cachdung"]=cachdung;
				dr[0]["makho"] = makho;
				dr[0]["manguon"] = manguon;
				dr[0]["nhomcc"] = nhomcc;
				dr[0]["madoituong"]=madoituong;
			}
		}

		public bool upd_treo(long id,int stt,int manguon,int mabd,decimal soluong,string tables,int makho,int madoituong)
		{
			sql="insert into d_treo (id,stt,manguon,mabd,soluong,tables,makho,madoituong) values (:id,:stt,:manguon,:mabd,:soluong,:tables,:makho,:madoituong)";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("id",OracleType.Number).Value=id;
				cmd.Parameters.Add("stt",OracleType.Number).Value=stt;
				cmd.Parameters.Add("manguon",OracleType.Number).Value=manguon;
				cmd.Parameters.Add("mabd",OracleType.Number).Value=mabd;
				cmd.Parameters.Add("soluong",OracleType.Number).Value=soluong;
				cmd.Parameters.Add("tables",OracleType.VarChar,10).Value=tables;
				cmd.Parameters.Add("makho",OracleType.Number).Value=makho;
				cmd.Parameters.Add("madoituong",OracleType.Number).Value=madoituong;
				cmd.ExecuteNonQuery();
				cmd.Dispose();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"d_treo");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}		
			return true;
		}

		public void updrec_tonkho_nguon(DataTable dt,int mabd,int manguon,decimal soluong,string toantu)
		{
			DataRow[] r=dt.Select("id="+mabd+" and manguon="+manguon);
			if (r.Length>0)
			{
				if (toantu=="+")
					r[0]["soluong"]=decimal.Parse(r[0]["soluong"].ToString())+soluong;
				else
					r[0]["soluong"]=decimal.Parse(r[0]["soluong"].ToString())-soluong;
			}
		}
		public DataTable get_tonkhoct_bhyt(string mmyy,int makho,int manguon,int madoituong,int mabd)
		{
			string xxx=user+"d"+mmyy;
			string s_madoituong_bhyt=","+sMaDoituong_BHYT();
			sql="select a.*,b.ten tennguon,c.ten tennhomcc,d.giaban as giaban_ from "+xxx+".d_tonkhoct a,"+user+".d_dmnguon b,"+user+".d_nhomcc c,"+user+".d_dmbd d where a.manguon=b.id and a.nhomcc=c.id(+) and a.mabd=d.id and a.mmyy='"+mmyy+"'";
			if (s_madoituong_bhyt.IndexOf(","+madoituong.ToString()+",")!=-1) sql+=" and d.bhyt<>0";//if (madoituong==1) sql+=" and d.bhyt<>0";
			sql+=" and a.mabd="+mabd+" and a.makho="+makho+" and a.manguon="+manguon+" and a.tondau+a.slnhap-a.slxuat>0";
			sql+=" order by a.stt";
			DataTable tmp=get_data(sql).Tables[0];
			DataRow r1;
			string mmyys="";
			foreach(DataRow r2 in get_data("select mmyy from d_table where substr(mmyy,3,2)||substr(mmyy,1,2)>'"+mmyy.Substring(2,2)+mmyy.Substring(0,2)+"'").Tables[0].Rows)
			{
				mmyys=r2["mmyy"].ToString();
				xxx=user+"d"+mmyys;
				sql="select a.stt,sum(a.slxuat) soluong from "+xxx+".d_tonkhoct a,"+user+".d_dmbd b,"+user+".d_dmkho d where a.mabd=b.id and a.makho=d.id and a.slxuat>0 and a.mmyy='"+mmyys+"'";
				if (s_madoituong_bhyt.IndexOf(","+madoituong.ToString()+",")!=-1) sql+=" and b.bhyt<>0";//if (madoituong==1) sql+=" and b.bhyt<>0";
				sql+=" and a.mabd="+mabd+" and a.makho="+makho+" and a.manguon="+manguon;
				sql+=" group by a.stt";
				foreach(DataRow r in get_data(sql).Tables[0].Rows)
				{
					r1=getrowbyid(tmp,"stt="+long.Parse(r["stt"].ToString()));
					if (r1!=null) r1["slxuat"]=decimal.Parse(r1["slxuat"].ToString())+decimal.Parse(r["soluong"].ToString());
				}
			}
			return tmp;
		}

		public void updrec_tonkho_nguon(DataTable dt,int kho,int mabd,int manguon,decimal soluong,string toantu)
		{
			DataRow[] r=dt.Select("makho="+kho+" and id="+mabd+" and manguon="+manguon);
			if (r.Length>0)
			{
				if (toantu=="+")
					r[0]["soluong"]=decimal.Parse(r[0]["soluong"].ToString())+soluong;
				else
					r[0]["soluong"]=decimal.Parse(r[0]["soluong"].ToString())-soluong;
			}
		}
		public bool upd_hcton(int d_nhom,string d_mmyy,int d_userid)
		{
			if (!dbMmyy(Mmyy_sau(d_mmyy))) return false;
			sql="update d_hcton set userid=:d_userid where nhom=:d_nhom and mmyy=:d_mmyy";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("d_userid",OracleType.Number).Value=d_userid;
				cmd.Parameters.Add("d_nhom",OracleType.Number).Value=d_nhom;
				cmd.Parameters.Add("d_mmyy",OracleType.VarChar,4).Value=d_mmyy;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into d_hcton (nhom,mmyy,userid) values (:d_nhom,:d_mmyy,:d_userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("d_nhom",OracleType.Number).Value=d_nhom;
					cmd.Parameters.Add("d_mmyy",OracleType.VarChar,4).Value=d_mmyy;
					cmd.Parameters.Add("d_userid",OracleType.Number).Value=d_userid;
					cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"d_hcton");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}
		public DataTable get_tonkhoth_dutru_bhyt(int nhom,string mmyy,string makho,string makho_makp,string manguon,int madoituong,string makho_nhomphieu)
		{
			string xxx=user+"d"+mmyy;
			string s_madoituong_bhyt=","+sMaDoituong_BHYT();
			if (bCapnhat_tonkho(nhom))
			{
				sql="select id from d_dmkho where 1=1 ";
				if(nhom!=0)sql+=" and nhom="+nhom;
				if (makho!="") sql+=" and id in ("+makho.Substring(0,makho.Length-1)+")";
				if (makho_makp!="") sql+=" and id in ("+makho_makp.Substring(0,makho_makp.Length-1)+")";
				foreach(DataRow r in get_data(sql).Tables[0].Rows) upd_tonkho(mmyy,int.Parse(r["id"].ToString()));
			}
			sql="select rownum stt,d.ten tennguon,b.ma,trim(b.ten)||' '||b.hamluong ten,b.tenhc,b.dang,c.ten tenkho,";
			sql+="a.tondau+a.slnhap-a.slxuat-case when a.slyeucau>0 then a.slyeucau else 0 end soluong,b.id,a.makho,b.bhyt,";
			sql+="b.mahc,a.manguon,0 tutruc,b.sothe, b.duongdung,(case when b.ketoa=1 then 'Theo toa' else '' end) ketoa ";
			sql+=" from "+xxx+".d_tonkhoth a,"+user+".d_dmbd b,"+user+".d_dmkho c,"+user+".d_dmnguon d where a.mabd=b.id and a.makho=c.id and a.manguon=d.id ";
			if(nhom!=0) sql+=" and c.nhom="+nhom;
			if (makho!="") sql+=" and a.makho in ("+makho.Substring(0,makho.Length-1)+")";
			if (makho_makp!="") sql+=" and a.makho in ("+makho_makp.Substring(0,makho_makp.Length-1)+")";
			if(makho_nhomphieu.Trim().Trim(',')!="") {sql+=" and a.makho in ("+makho_nhomphieu.Trim().Trim(',')+")";}
			if (manguon!="") sql+=" and a.manguon in ("+manguon.Substring(0,manguon.Length-1)+")";
			if (s_madoituong_bhyt.IndexOf(","+madoituong.ToString()+",")!=-1) sql+=" and b.bhyt<>0";//if (madoituong==1) sql+=" and b.bhyt<>0";
			if (bSort_mabd) sql+=" order by b.ma";
			else sql+=" order by b.ten";
			DataTable tmp=get_data(sql).Tables[0];
			string mmyys="";
			DataRow r1;
			foreach(DataRow r2 in get_data("select mmyy from d_table where substr(mmyy,3,2)||substr(mmyy,1,2)>'"+mmyy.Substring(2,2)+mmyy.Substring(0,2)+"'").Tables[0].Rows)
			{
				mmyys=r2["mmyy"].ToString();
				xxx=user+"d"+mmyys;
				sql="select a.makho,a.mabd,a.manguon,sum(a.slxuat+case when a.slyeucau>0 then a.slyeucau else 0 end) soluong from "+xxx+".d_tonkhoth a,"+user+".d_dmbd b where a.mabd=b.id and a.slxuat+case when a.slyeucau>0 then a.slyeucau else 0 end>0 and a.mmyy='"+mmyys+"'";
				if (makho!="") sql+=" and a.makho in ("+makho.Substring(0,makho.Length-1)+")";
				if (makho_makp!="") sql+=" and a.makho in ("+makho_makp.Substring(0,makho_makp.Length-1)+")";
				if (manguon!="") sql+=" and a.manguon in ("+manguon.Substring(0,manguon.Length-1)+")";
				if (s_madoituong_bhyt.IndexOf(","+madoituong.ToString()+",")!=-1) sql+=" and b.bhyt<>0";//if (madoituong==1) sql+=" and b.bhyt<>0";
				sql+=" group by a.makho,a.mabd,a.manguon";
				foreach(DataRow r in get_data(sql).Tables[0].Rows)
				{
					r1=getrowbyid(tmp,"makho="+int.Parse(r["makho"].ToString())+" and id="+int.Parse(r["mabd"].ToString())+" and manguon="+int.Parse(r["manguon"].ToString()));
					if (r1!=null) r1["soluong"]=decimal.Parse(r1["soluong"].ToString())-decimal.Parse(r["soluong"].ToString());
				}
			}
			return tmp;
		}


		public DataTable get_tonkhoth_dutru_bhyt(int nhom,string mmyy,string makho,string makho_makp,string manguon,int madoituong)
		{
			string xxx=user+"d"+mmyy;
			string s_madoituong_bhyt=","+sMaDoituong_BHYT();
			if (bCapnhat_tonkho(nhom))
			{
				sql="select id from d_dmkho where 1=1 ";
				if(nhom!=0)sql+=" and nhom="+nhom;
				if (makho!="") sql+=" and id in ("+makho.Substring(0,makho.Length-1)+")";
				if (makho_makp!="") sql+=" and id in ("+makho_makp.Substring(0,makho_makp.Length-1)+")";
				foreach(DataRow r in get_data(sql).Tables[0].Rows) upd_tonkho(mmyy,int.Parse(r["id"].ToString()));
			}
			sql="select rownum stt,d.ten tennguon,b.ma,trim(b.ten)||' '||b.hamluong ten,b.tenhc,b.dang,c.ten tenkho,";
			sql+="a.tondau+a.slnhap-a.slxuat-case when a.slyeucau>0 then a.slyeucau else 0 end soluong,b.id,a.makho,b.bhyt,";
			sql+="b.mahc,a.manguon,0 tutruc,b.sothe, b.duongdung,(case when b.ketoa=1 then 'Theo toa' else '' end) ketoa ";
			sql+=" from "+xxx+".d_tonkhoth a,"+user+".d_dmbd b,"+user+".d_dmkho c,"+user+".d_dmnguon d where a.mabd=b.id and a.makho=c.id and a.manguon=d.id ";
			if(nhom!=0) sql+=" and c.nhom="+nhom;
			if (makho!="") sql+=" and a.makho in ("+makho.Substring(0,makho.Length-1)+")";
			if (makho_makp!="") sql+=" and a.makho in ("+makho_makp.Substring(0,makho_makp.Length-1)+")";
			if (manguon!="") sql+=" and a.manguon in ("+manguon.Substring(0,manguon.Length-1)+")";
			if (s_madoituong_bhyt.IndexOf(","+madoituong.ToString()+",")!=-1) sql+=" and b.bhyt<>0";//if (madoituong==1) sql+=" and b.bhyt<>0";
			if (bSort_mabd) sql+=" order by b.ma";
			else sql+=" order by b.ten";
			DataTable tmp=get_data(sql).Tables[0];
			string mmyys="";
			DataRow r1;
			foreach(DataRow r2 in get_data("select mmyy from d_table where substr(mmyy,3,2)||substr(mmyy,1,2)>'"+mmyy.Substring(2,2)+mmyy.Substring(0,2)+"'").Tables[0].Rows)
			{
				mmyys=r2["mmyy"].ToString();
				xxx=user+"d"+mmyys;
				sql="select a.makho,a.mabd,a.manguon,sum(a.slxuat+case when a.slyeucau>0 then a.slyeucau else 0 end) soluong from "+xxx+".d_tonkhoth a,"+user+".d_dmbd b where a.mabd=b.id and a.slxuat+case when a.slyeucau>0 then a.slyeucau else 0 end>0 and a.mmyy='"+mmyys+"'";
				if (makho!="") sql+=" and a.makho in ("+makho.Substring(0,makho.Length-1)+")";
				if (makho_makp!="") sql+=" and a.makho in ("+makho_makp.Substring(0,makho_makp.Length-1)+")";
				if (manguon!="") sql+=" and a.manguon in ("+manguon.Substring(0,manguon.Length-1)+")";
				if (s_madoituong_bhyt.IndexOf(","+madoituong.ToString()+",")!=-1) sql+=" and b.bhyt<>0";//if (madoituong==1) sql+=" and b.bhyt<>0";
				sql+=" group by a.makho,a.mabd,a.manguon";
				foreach(DataRow r in get_data(sql).Tables[0].Rows)
				{
					r1=getrowbyid(tmp,"makho="+int.Parse(r["makho"].ToString())+" and id="+int.Parse(r["mabd"].ToString())+" and manguon="+int.Parse(r["manguon"].ToString()));
					if (r1!=null) r1["soluong"]=decimal.Parse(r1["soluong"].ToString())-decimal.Parse(r["soluong"].ToString());
				}
			}
			return tmp;
		}

		public DataTable get_tonkhoth_dutru_bhyt_mabd(int nhom,string mmyy,string makho,string makho_makp,string manguon,int madoituong,string mabd)
		{
			string xxx=user+"d"+mmyy;
			string s_madoituong_bhyt=","+sMaDoituong_BHYT();
			if (bCapnhat_tonkho(nhom))
			{
				sql="select id from d_dmkho where 1=1 ";
				if(nhom!=0)sql+=" and nhom="+nhom;
				if (makho!="") sql+=" and id in ("+makho.Substring(0,makho.Length-1)+")";
				if (makho_makp!="") sql+=" and id in ("+makho_makp.Substring(0,makho_makp.Length-1)+")";
				foreach(DataRow r in get_data(sql).Tables[0].Rows) upd_tonkho(mmyy,int.Parse(r["id"].ToString()));
			}
			sql="select rownum stt,d.ten tennguon,b.ma,trim(b.ten)||' '||b.hamluong ten,b.tenhc,b.dang,c.ten tenkho,";
			sql+="a.tondau+a.slnhap-a.slxuat-case when a.slyeucau>0 then a.slyeucau else 0 end soluong,b.id,a.makho,b.bhyt,";
			sql+="b.mahc,a.manguon,0 tutruc,b.sothe, b.duongdung,(case when b.ketoa=1 then 'Theo toa' else '' end) ketoa ";
			sql+=" from "+xxx+".d_tonkhoth a,"+user+".d_dmbd b,"+user+".d_dmkho c,"+user+".d_dmnguon d where a.mabd=b.id and a.makho=c.id and a.manguon=d.id and b.ma='"+mabd+"'";
			if(nhom!=0) sql+=" and c.nhom="+nhom;
			if (makho!="") sql+=" and a.makho in ("+makho.Substring(0,makho.Length-1)+")";
			if (makho_makp!="") sql+=" and a.makho in ("+makho_makp.Substring(0,makho_makp.Length-1)+")";
			if (manguon!="") sql+=" and a.manguon in ("+manguon.Substring(0,manguon.Length-1)+")";
			if (s_madoituong_bhyt.IndexOf(","+madoituong.ToString()+",")!=-1) sql+=" and b.bhyt<>0";//if (madoituong==1) sql+=" and b.bhyt<>0";
			if (bSort_mabd) sql+=" order by b.ma";
			else sql+=" order by b.ten";
			DataTable tmp=get_data(sql).Tables[0];
			string mmyys="";
			DataRow r1;
			foreach(DataRow r2 in get_data("select mmyy from d_table where substr(mmyy,3,2)||substr(mmyy,1,2)>'"+mmyy.Substring(2,2)+mmyy.Substring(0,2)+"'").Tables[0].Rows)
			{
				mmyys=r2["mmyy"].ToString();
				xxx=user+"d"+mmyys;
				sql="select a.makho,a.mabd,a.manguon,sum(a.slxuat+case when a.slyeucau>0 then a.slyeucau else 0 end) soluong from "+xxx+".d_tonkhoth a,"+user+".d_dmbd b where a.mabd=b.id and a.slxuat+case when a.slyeucau>0 then a.slyeucau else 0 end>0 and a.mmyy='"+mmyys+"'";
				if (makho!="") sql+=" and a.makho in ("+makho.Substring(0,makho.Length-1)+")";
				if (makho_makp!="") sql+=" and a.makho in ("+makho_makp.Substring(0,makho_makp.Length-1)+")";
				if (manguon!="") sql+=" and a.manguon in ("+manguon.Substring(0,manguon.Length-1)+")";
				if (s_madoituong_bhyt.IndexOf(","+madoituong.ToString()+",")!=-1) sql+=" and b.bhyt<>0";//if (madoituong==1) sql+=" and b.bhyt<>0";
				sql+=" group by a.makho,a.mabd,a.manguon";
				foreach(DataRow r in get_data(sql).Tables[0].Rows)
				{
					r1=getrowbyid(tmp,"makho="+int.Parse(r["makho"].ToString())+" and id="+int.Parse(r["mabd"].ToString())+" and manguon="+int.Parse(r["manguon"].ToString()));
					if (r1!=null) r1["soluong"]=decimal.Parse(r1["soluong"].ToString())-decimal.Parse(r["soluong"].ToString());
				}
			}
			return tmp;
		}


		public DataTable get_bhytthuoc(string mmyy,DataTable dtct,long id,int madoituong)
		{
			DataSet ds=new DataSet();
			ds.ReadXml("..\\..\\..\\xml\\d_bhytthuoc.xml");
			int stt=0;
			int irec=0;
			DataRow [] dr;
			decimal sl,sltx,sttx,slton,dongia;
			DataTable dttonct;
			foreach(DataRow r in dtct.Rows)
			{
				if (r["sttt"].ToString()!="0")
					updrec_bhytthuoc(ds.Tables[0],int.Parse(r["stt"].ToString()),long.Parse(r["sttt"].ToString()),int.Parse(r["mabd"].ToString()),r["ma"].ToString(),r["ten"].ToString(),r["tenhc"].ToString(),r["dang"].ToString(),r["tenkho"].ToString(),r["tennguon"].ToString(),r["tennhomcc"].ToString(),r["handung"].ToString(),r["losx"].ToString(),decimal.Parse(r["soluong"].ToString()),decimal.Parse(r["dongia"].ToString()),decimal.Parse(r["sotien"].ToString()),decimal.Parse(r["giaban"].ToString()),decimal.Parse(r["giamua"].ToString()),decimal.Parse(r["soluong"].ToString())*decimal.Parse(r["giaban"].ToString()),r["cachdung"].ToString(),int.Parse(r["makho"].ToString()),int.Parse(r["manguon"].ToString()),int.Parse(r["nhomcc"].ToString()),int.Parse(r["madoituong"].ToString()),null);
				else
				{
					sl=decimal.Parse(r["soluong"].ToString());
					dttonct=get_tonkhoct_bhyt(mmyy,int.Parse(r["makho"].ToString()),int.Parse(r["manguon"].ToString()),madoituong,int.Parse(r["mabd"].ToString()));
					dr=dttonct.Select("true","stt");
					irec=dr.Length;
					for(int i=0;i<irec;i++)
					{
						slton=decimal.Parse(dr[i]["tondau"].ToString())+decimal.Parse(dr[i]["slnhap"].ToString())-decimal.Parse(dr[i]["slxuat"].ToString());
						dongia=decimal.Parse(dr[i]["giamua"].ToString());
						sltx=Math.Min(sl,slton);
						if (sltx>0)
						{
							stt=get_stt(ds.Tables[0]);
							sttx=dongia*sltx;
							dr[i]["slxuat"]=decimal.Parse(dr[i]["slxuat"].ToString())+sltx;
							updrec_bhytthuoc(ds.Tables[0],stt,long.Parse(dr[i]["stt"].ToString()),int.Parse(dr[i]["mabd"].ToString()),r["ma"].ToString(),r["ten"].ToString(),r["tenhc"].ToString(),r["dang"].ToString(),r["tenkho"].ToString(),dr[i]["tennguon"].ToString(),dr[i]["tennhomcc"].ToString(),dr[i]["handung"].ToString(),dr[i]["losx"].ToString(),sltx,dongia,sttx,decimal.Parse(dr[i]["giaban_"].ToString()),decimal.Parse(dr[i]["giamua"].ToString()),sttx,r["cachdung"].ToString(),int.Parse(dr[i]["makho"].ToString()),int.Parse(dr[i]["manguon"].ToString()),int.Parse(dr[i]["nhomcc"].ToString()),int.Parse(r["madoituong"].ToString()),null);
							//
							upd_bhytthuoc(mmyy,id,stt,long.Parse(dr[i]["stt"].ToString()),int.Parse(r["makho"].ToString()),int.Parse(r["manguon"].ToString()),int.Parse(dr[i]["nhomcc"].ToString()),int.Parse(r["mabd"].ToString()),dr[i]["handung"].ToString(),dr[i]["losx"].ToString(),sltx,sttx,decimal.Parse(dr[i]["giaban_"].ToString()),decimal.Parse(dr[i]["giamua"].ToString()),r["cachdung"].ToString(),int.Parse(r["madoituong"].ToString()));
							upd_tonkhoct_xuat(insert,mmyy,long.Parse(dr[i]["stt"].ToString()),int.Parse(r["makho"].ToString()),int.Parse(r["manguon"].ToString()),int.Parse(dr[i]["nhomcc"].ToString()),int.Parse(r["mabd"].ToString()),dr[i]["handung"].ToString(),dr[i]["losx"].ToString(),sltx,sttx,decimal.Parse(dr[i]["giaban_"].ToString()),decimal.Parse(dr[i]["giamua"].ToString()));
							if (r["cachdung"].ToString()!="") upd_dmcachdung(r["cachdung"].ToString());
							//
						}
						sl-=sltx;
						if (sl<=0) break;
					}
					if (sl>0 && id!=0) upd_treo(id,int.Parse(r["stt"].ToString()),int.Parse(r["manguon"].ToString()),int.Parse(r["mabd"].ToString()),sl,"bhytthuoc",int.Parse(r["makho"].ToString()),0);
				}
			}
			ds.AcceptChanges();
			return ds.Tables[0];
		}

		public long get_id_toathuoc
		{
			get
			{
				return getidyymmdd_d(11);
			}
		}

		public bool upd_toathuocll(long d_id,long d_sophieu,string d_mabn,long d_maql,string d_ngay,string d_makp,
			string d_chandoan,string d_maicd,string d_mabs,string d_ghichu,int d_userid)
		{			
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand("pkg_duoc.upd_toathuocll",con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				cmd.Parameters.Add("d_sophieu",OracleType.Number).Value=d_sophieu;
				cmd.Parameters.Add("d_mabn",OracleType.VarChar,8).Value=d_mabn;
				cmd.Parameters.Add("d_maql",OracleType.Number).Value=d_maql;
				cmd.Parameters.Add("d_ngay",OracleType.VarChar,16).Value=d_ngay;
				cmd.Parameters.Add("d_makp",OracleType.VarChar,2).Value=d_makp;
				cmd.Parameters.Add("d_chandoan",OracleType.NVarChar,254).Value=d_chandoan;
				cmd.Parameters.Add("d_maicd",OracleType.VarChar,9).Value=d_maicd;
				cmd.Parameters.Add("d_mabs",OracleType.VarChar,4).Value=d_mabs;
				cmd.Parameters.Add("d_ghichu",OracleType.NVarChar,100).Value=d_ghichu;
				cmd.Parameters.Add("d_userid",OracleType.Number).Value=d_userid;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_toathuocll");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_toathuocct(long d_id,long d_stt,long d_mabd,decimal d_soluong,string d_cachdung)
		{
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand("pkg_duoc.upd_toathuocct",con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				cmd.Parameters.Add("d_stt",OracleType.Number).Value=d_stt;
				cmd.Parameters.Add("d_mabd",OracleType.Number).Value=d_mabd;
				cmd.Parameters.Add("d_soluong",OracleType.Number).Value=d_soluong;
				cmd.Parameters.Add("d_cachdung",OracleType.NVarChar,254).Value=d_cachdung;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_toathuocct");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}
		public bool upd_toathuocct(long d_id,long d_stt,long d_mabd,decimal d_soluong,string d_cachdung, decimal d_songay, string d_ghichu)
		{
			con=new OracleConnection(sConn);
			try
			{
				sql=" update d_toathuocct set mabd=:d_mabd,soluong=:d_soluong,cachdung=:d_cachdung, songay=:d_songay, ghichu=:d_ghichu where id=:d_id and stt=:d_stt";
				con.Open();
				//				cmd=new OracleCommand("pkg_duoc.upd_toathuocct",con);
				//				cmd.CommandType=CommandType.StoredProcedure;
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				
				cmd.Parameters.Add("d_mabd",OracleType.Number).Value=d_mabd;
				cmd.Parameters.Add("d_soluong",OracleType.Number).Value=d_soluong;
				cmd.Parameters.Add("d_cachdung",OracleType.NVarChar,254).Value=d_cachdung;
				cmd.Parameters.Add("d_songay",OracleType.Number).Value=d_songay;
				cmd.Parameters.Add("d_ghichu",OracleType.NVarChar,254).Value=d_ghichu;	
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				cmd.Parameters.Add("d_stt",OracleType.Number).Value=d_stt;
				int ire=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if(ire==0)
				{
					sql=" insert into d_toathuocct(id,stt,mabd,soluong,cachdung, songay, ghichu) values (:d_id,:d_stt,:d_mabd,:d_soluong,:d_cachdung,:d_songay,:d_ghichu)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;

					cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
					cmd.Parameters.Add("d_stt",OracleType.Number).Value=d_stt;
					cmd.Parameters.Add("d_mabd",OracleType.Number).Value=d_mabd;
					cmd.Parameters.Add("d_soluong",OracleType.Number).Value=d_soluong;
					cmd.Parameters.Add("d_cachdung",OracleType.NVarChar,254).Value=d_cachdung;
					cmd.Parameters.Add("d_songay",OracleType.Number).Value=d_songay;
					cmd.Parameters.Add("d_ghichu",OracleType.NVarChar,254).Value=d_ghichu;	
					cmd.ExecuteNonQuery();
				}
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_toathuocct");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}
		public int get_dmthuoc(string d_ten,string d_dang,string d_cachdung,string d_tenhc)
		{
			con=new OracleConnection(sConn);
			con.Open();
			cmd=new OracleCommand("pkg_duoc.get_dmthuoc",con);
			cmd.CommandType=CommandType.StoredProcedure;
			cmd.Parameters.Add("d_ten",OracleType.NVarChar,100).Value=d_ten;
			cmd.Parameters.Add("d_dang",OracleType.NVarChar,20).Value=d_dang;
			cmd.Parameters.Add("d_cachdung",OracleType.NVarChar,50).Value=d_cachdung;
			cmd.Parameters.Add("d_tenhc",OracleType.NVarChar,254).Value=d_tenhc;
			cmd.Parameters.Add("d_id",OracleType.Number).Direction=ParameterDirection.Output;
			cmd.ExecuteScalar();
			int d_ret=int.Parse(cmd.Parameters["d_id"].Value.ToString());
			cmd.Dispose();
			con.Close();con.Dispose();
			return d_ret;
		}

		public DataSet get_thuoc(string tu,string den,string str)
		{
			DateTime dt1=StringToDate(tu).AddDays(-iNgaykiemke);
			DateTime dt2=StringToDate(den).AddDays(iNgaykiemke);
			int y1=dt1.Year,m1=dt1.Month;
			int y2=dt2.Year,m2=dt2.Month;
			int itu,iden;
			string mmyy="";	
			bool be=true;
			DataSet dstmp=new DataSet();
			for(int i=y1;i<=y2;i++)
			{
				itu=(i==y1)?m1:1;
				iden=(i==y2)?m2:12;
				for(int j=itu;j<=iden;j++)
				{
					mmyy=j.ToString().PadLeft(2,'0')+i.ToString().Substring(2,2);
					if (bMmyy(mmyy))
					{
						sql=str.Replace("xxx",user+"d"+mmyy);
						if (be) dstmp=get_data(sql);
						else dstmp.Merge(get_data(sql));
						be=false;
					}
				}
			}
			return dstmp;
		}

		public bool bcongkham_bhyt(int d_nhom)
		{
			ds=get_data("select ten from d_thongso where id=82 and nhom="+d_nhom);
			if (ds.Tables[0].Rows.Count==0) return false;
			return ds.Tables[0].Rows[0][0].ToString()=="1";
		}
		public bool bcongkham_bhyt_dtngoaitru(int d_nhom)
		{
			ds=get_data("select ten from d_thongso where id=1002 and nhom="+d_nhom);
			if (ds.Tables[0].Rows.Count==0) return false;
			return ds.Tables[0].Rows[0][0].ToString()=="1";
		}

		public decimal Congkham(int d_nhom)
		{
			ds=get_data("select ten from d_thongso where id=47 and nhom="+d_nhom);
			if (ds.Tables[0].Rows.Count==0) return 3000;
			return decimal.Parse(ds.Tables[0].Rows[0][0].ToString());
		}
	
		public bool upd_tonkho(string d_mmyy,int d_nhom,int d_loai)
		{
			string xxx=user+"d"+d_mmyy+".pkg_duoc.upd_tonkho";
			con=new OracleConnection(sConn);//get_conn(d_mmyy)
			try
			{
				con.Open();
				cmd=new OracleCommand(xxx,con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_mmyy",OracleType.VarChar,4).Value=d_mmyy;
				cmd.Parameters.Add("d_nhom",OracleType.Number).Value=d_nhom;
				cmd.Parameters.Add("d_loai",OracleType.Number).Value=d_loai;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"tonkho");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_loaiphieu(long d_id,string d_ten,int d_loai,int d_nhom,int d_stt,int d_buoi)
		{
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand("pkg_duoc.upd_loaiphieu",con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				cmd.Parameters.Add("d_ten",OracleType.NVarChar,100).Value=d_ten;
				cmd.Parameters.Add("d_loai",OracleType.Number).Value=d_loai;
				cmd.Parameters.Add("d_nhom",OracleType.Number).Value=d_nhom;
				cmd.Parameters.Add("d_stt",OracleType.Number).Value=d_stt;
				cmd.Parameters.Add("d_buoi",OracleType.Number).Value=d_buoi;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_loaiphieu");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}
		public bool get_ttngay(string d_ngay,string d_makp)
		{
			return get_data("select * from d_ttngay where to_char(ngay,'dd/MM/yyyy')='"+d_ngay+"' and makp='"+d_makp+"'").Tables[0].Rows.Count>0;
		}
		public bool get_paid(long id)
		{
			sql="select mabn from "+user+"d"+mmyy(Ngayhienhanh)+".d_tienthuoc where done=1 and id="+id;
			ds=get_data(sql);
			return ds.Tables[0].Rows.Count>0;
		}
		//nam 10/07/2012
		public bool get_paid(long m_id,int m_mabd)
		{
			if(m_mabd==0)
			{
				//sql="select mabn from "+user+"d"+mmyy(Ngayhienhanh)+".d_tienthuoc where done=0 and mabd ="+ m_mabd + " and id="+id;
				sql="select mabn from "+user+"d"+mmyy(Ngayhienhanh)+".d_tienthuoc where done=0 and id="+m_id;
				ds=get_data(sql);
				return ds.Tables[0].Rows.Count==0;
			}
			else
			{
				sql="select mabn from "+user+"d"+mmyy(Ngayhienhanh)+".d_tienthuoc where done=1 and mabd ="+m_mabd+" and id="+m_id;
				ds=get_data(sql);
				return ds.Tables[0].Rows.Count>0;
			}
				
		}
		public bool get_paid(long m_id,long m_maql,int m_mabd)
		{
			if(m_mabd==0)
			{
				//sql="select mabn from "+user+"d"+mmyy(Ngayhienhanh)+".d_tienthuoc where done=0 and mabd ="+ m_mabd + " and id="+id;
				sql="select mabn from "+user+"d"+mmyy(Ngayhienhanh)+".d_tienthuoc where done=1 and id="+m_id+"and maql="+m_maql+"and mabd="+m_mabd;
				ds=get_data(sql);
				return ds.Tables[0].Rows.Count==0;
			}
			else
			{
				sql="select mabn from "+user+"d"+mmyy(Ngayhienhanh)+".d_tienthuoc where done=1 and mabd ="+m_mabd+" and id="+m_id+ "and maql ="+m_maql;
				ds=get_data(sql);
				return ds.Tables[0].Rows.Count>0;
			}
				
		}
		// end nam
		
		public decimal tamung_conlai(int loai,string mabn,long maql,long idkhoa)
		{
			decimal ret=0;
			sql="select sum(a.tamung-a.thuoc-a.vienphi+a.mien) sotien from v_theodoicongno a,doituong b where a.madoituong=b.madoituong and a.done=0";
			if (loai==1) sql+=" and a.mabn='"+mabn+"'";
			else if (loai==2) sql+=" and a.maql="+maql;
			else if (loai==3) sql+=" and a.idkhoa="+idkhoa;
			ds=get_data(sql+" and (b.mien=0 or b.trasau=0)");
			if (ds.Tables[0].Rows[0]["sotien"].ToString()!="") ret=decimal.Parse(ds.Tables[0].Rows[0]["sotien"].ToString());
			return ret;
		}
		public decimal congno(int loai,string mabn,long maql,long idkhoa)
		{
			decimal ret=0;
			sql="select sum(a.thuoc+a.vienphi-a.tamung-a.mien) sotien from v_theodoicongno a,doituong b where a.madoituong=b.madoituong and a.done=0";
			if (loai==1) sql+=" and a.mabn='"+mabn+"'";
			else if (loai==2) sql+=" and a.maql="+maql;
			else if (loai==3) sql+=" and a.idkhoa="+idkhoa;
			ds=get_data(sql+" and (b.mien=0 or b.trasau=0)");
			if (ds.Tables[0].Rows[0]["sotien"].ToString()!="") ret=decimal.Parse(ds.Tables[0].Rows[0]["sotien"].ToString());
			return ret;
		}
		public bool upd_theodoicongno(string mabn,long maql,long idkhoa,int madoituong,decimal sotien,string fie)
		{
			sql="update v_theodoicongno set "+fie+"="+fie+"+:sotien";
			sql+=" where maql=:maql and idkhoa=:idkhoa and madoituong=:madoituong";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("sotien",OracleType.Number).Value=sotien;
				cmd.Parameters.Add("maql",OracleType.Number).Value=maql;
				cmd.Parameters.Add("idkhoa",OracleType.Number).Value=idkhoa;
				cmd.Parameters.Add("madoituong",OracleType.Number).Value=madoituong;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into v_theodoicongno (mabn,maql,idkhoa,madoituong,"+fie+") values (:mabn,:maql,:idkhoa,:madoituong,:sotien)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("mabn",OracleType.VarChar,8).Value=mabn;
					cmd.Parameters.Add("maql",OracleType.Number).Value=maql;
					cmd.Parameters.Add("idkhoa",OracleType.Number).Value=idkhoa;
					cmd.Parameters.Add("madoituong",OracleType.Number).Value=madoituong;
					cmd.Parameters.Add("sotien",OracleType.Number).Value=sotien;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"v_theodoicongno");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}		
			return true;
		}
		public int get_madoituong(long d_maql)
		{
			try
			{
				ds=get_data("select madoituong from benhandt where maql="+d_maql);
				return (ds.Tables[0].Rows[0][0].ToString()=="")?1:int.Parse(ds.Tables[0].Rows[0][0].ToString());
			}
			catch{return 0;}
		}
		public int get_madoituong(long d_maql,string ngay)
		{
			try
			{
				if (!bMmyy(ngay)) return 0;
				ds=get_data("select madoituong from "+user+mmyy(ngay)+".benhandt where maql="+d_maql);
				return int.Parse(ds.Tables[0].Rows[0][0].ToString());
			}
			catch{return 0;}
		}
		public void upd_theodoicongno(string tt,string mabn,long maql,long idkhoa,int madoituong,decimal sotien,string fie)
		{
			if (tt==delete)
				execute_data("update v_theodoicongno set "+fie+"="+fie+"-"+sotien+" where maql="+maql+" and idkhoa="+idkhoa+" and madoituong="+madoituong);
			else
				upd_theodoicongno(mabn,maql,idkhoa,madoituong,sotien,fie);
		}
		public bool bSongay_sudungthuoc(int d_nhom)
		{
			ds=get_data("select ten from d_thongso where id=139 and nhom="+d_nhom);
			if (ds.Tables[0].Rows.Count==0) return false;
			return ds.Tables[0].Rows[0][0].ToString().Trim()=="1";
		}
		public bool bLockytu_traiphai(int d_nhom)
		{
			ds=get_data("select ten from d_thongso where id=110 and nhom="+d_nhom);
			if (ds.Tables[0].Rows.Count==0) return false;
			return ds.Tables[0].Rows[0][0].ToString()=="1";
		}
		public bool bcstt_linh(int d_nhom)
		{
			ds=get_data("select ten from d_thongso where id=60 and nhom="+d_nhom);
			if (ds.Tables[0].Rows.Count==0) return false;
			return ds.Tables[0].Rows[0][0].ToString()=="1";
		}
		public bool bDutru_khongload_thuoctrung_tutruc(int d_nhom)
		{
			ds=get_data("select ten from d_thongso where id=1014 and nhom="+d_nhom);
			if (ds.Tables[0].Rows.Count==0) return false;
			return ds.Tables[0].Rows[0][0].ToString().Trim()=="1";
		}
		public bool bcstt_haophi(int d_nhom)
		{
			ds=get_data("select ten from d_thongso where id=61 and nhom="+d_nhom);
			if (ds.Tables[0].Rows.Count==0) return false;
			return ds.Tables[0].Rows[0][0].ToString()=="1";
		}
		public bool bQuanlynguon(int d_nhom)
		{
			ds=get_data("select ten from d_thongso where id=17 and nhom="+d_nhom);
			if (ds.Tables[0].Rows.Count==0) return false;
			return ds.Tables[0].Rows[0][0].ToString()=="1";
		}
		public int get_duyet(long d_id,string makho)
		{
			try
			{
				sql="select done from d_duyetkho where idduyet=" + d_id;
				if (makho!="") sql+=" and makho in (" + makho.Substring(0, makho.Length - 1) + ")";
				sql+=" order by done desc";
				ds = get_data(sql);				
				if (ds.Tables[0].Rows.Count==0) return 0;
				else return int.Parse(ds.Tables[0].Rows[0][0].ToString());
			}
			catch{return 0;}
		}
		public DataTable get_tutrucct_dutru(string mmyy,int makp,int makho,int manguon,int mabd,int tutruc)
		{
			string xxx=user+"d"+mmyy;
			sql="select a.*,b.ten tennguon,c.ten tennhomcc,t.chietkhau from "+xxx+".d_tutrucct a,"+user+".d_dmnguon b,"+user+".d_nhomcc c,"+user+".d_dmbd d,"+xxx+".d_theodoi t where a.manguon=b.id and a.nhomcc=c.id and a.mabd=d.id and a.mmyy='"+mmyy+"' and a.makp="+makp;
			if (tutruc==1) sql+=" and d.tutruc=1";
			sql+=" and a.makho="+makho+" and a.manguon="+manguon+" and a.mabd="+mabd+" and a.stt=t.id ";
			sql+=" and a.tondau+a.slnhap-a.slxuat>0 order by a.stt";
			DataTable tmp=get_data(sql).Tables[0];
			DataRow r1;
			string mmyys="",xxxs;
			foreach(DataRow r2 in get_data("select mmyy from d_table where substr(mmyy,3,2)||substr(mmyy,1,2)>'"+mmyy.Substring(2,2)+mmyy.Substring(0,2)+"'").Tables[0].Rows)
			{
				mmyys=r2["mmyy"].ToString();
				xxxs=user+"d"+mmyys;
				sql="select a.stt,sum(a.slxuat) soluong from "+xxxs+".d_tutrucct a,"+user+".d_dmbd d where a.mabd=d.id and a.slxuat>0 and a.mmyy='"+mmyys+"' and a.makp="+makp;
				if (tutruc==1) sql+=" and d.tutruc=1";
				sql+=" and a.makho="+makho+" and a.manguon="+manguon+" and mabd="+mabd;
				sql+=" group by a.stt";
				foreach(DataRow r in get_data(sql).Tables[0].Rows)
				{
					r1=getrowbyid(tmp,"stt="+long.Parse(r["stt"].ToString()));
					if (r1!=null) r1["slxuat"]=decimal.Parse(r1["slxuat"].ToString())+decimal.Parse(r["soluong"].ToString());
				}
			}
			return tmp;
		}
		public DataTable get_tonkhoth_dutru(string mmyy,string makho,string manguon)
		{
			string xxx=user+"d"+mmyy;
			sql="select rownum stt,d.ten tennguon,b.ma,trim(b.ten)||' '||b.hamluong ten,b.tenhc,b.dang,c.ten tenkho,";
			sql+="a.tondau+a.slnhap-a.slxuat-case when a.slyeucau>0 then a.slyeucau else 0 end soluong,b.id,a.makho,";
			sql+="b.bhyt,b.mahc,a.manguon,0 tutruc,b.manhom,b.madoituong,b.choduyet, b.sothe, b.hoichan ";
			sql+=" from "+xxx+".d_tonkhoth a,"+user+".d_dmbd b,"+user+".d_dmkho c,"+user+".d_dmnguon d ";
			sql+=" where a.mabd=b.id and a.makho=c.id and a.manguon=d.id and a.mmyy='"+mmyy+"'";
			if (makho!="") sql+=" and a.makho in ("+makho.Substring(0,makho.Length-1)+")";
			if (manguon!="") sql+=" and a.manguon in ("+manguon.Substring(0,manguon.Length-1)+")";
			if (bSort_mabd) sql+=" order by b.ma";
			else sql+=" order by b.ten";
			DataTable tmp=get_data(sql).Tables[0];
			DataRow r1;
			string mmyys="";
			foreach(DataRow r2 in get_data("select mmyy from d_table where substr(mmyy,3,2)||substr(mmyy,1,2)>'"+mmyy.Substring(2,2)+mmyy.Substring(0,2)+"'").Tables[0].Rows)
			{
				mmyys=r2["mmyy"].ToString();
				xxx=user+"d"+mmyys;
				sql="select makho,mabd,manguon,sum(slxuat+case when slyeucau>0 then slyeucau else 0 end) soluong from "+xxx+".d_tonkhoth where slxuat+case when slyeucau>0 then slyeucau else 0 end>0 and mmyy='"+mmyys+"'";
				if (makho!="") sql+=" and makho in ("+makho.Substring(0,makho.Length-1)+")";
				if (manguon!="") sql+=" and manguon in ("+manguon.Substring(0,manguon.Length-1)+")";
				sql+=" group by makho,mabd,manguon";
				foreach(DataRow r in get_data(sql).Tables[0].Rows)
				{
					r1=getrowbyid(tmp,"makho="+int.Parse(r["makho"].ToString())+" and id="+int.Parse(r["mabd"].ToString())+" and manguon="+int.Parse(r["manguon"].ToString()));
					if (r1!=null) r1["soluong"]=decimal.Parse(r1["soluong"].ToString())-decimal.Parse(r["soluong"].ToString());
				}
			}
			return tmp;
		}
		

		public DataTable get_tonkhoth_dutru(string mmyy,string makho,string manguon, bool bKiemtrathangsau)
		{
			string xxx=user+"d"+mmyy;
			sql="select rownum stt,d.ten tennguon,b.ma,trim(b.ten)||' '||b.hamluong ten,b.tenhc,b.dang,c.ten tenkho,";
			sql+="a.tondau+a.slnhap-a.slxuat-case when a.slyeucau>0 then a.slyeucau else 0 end soluong,b.id,a.makho,";
			sql+="b.bhyt,b.mahc,a.manguon,0 tutruc,b.manhom,b.madoituong,b.choduyet, b.sothe, b.hoichan ";
			sql+=" from "+xxx+".d_tonkhoth a,"+user+".d_dmbd b,"+user+".d_dmkho c,"+user+".d_dmnguon d ";
			sql+=" where a.mabd=b.id and a.makho=c.id and a.manguon=d.id and a.mmyy='"+mmyy+"'";
			if (makho!="") sql+=" and a.makho in ("+makho.Substring(0,makho.Length-1)+")";
			if (manguon!="") sql+=" and a.manguon in ("+manguon.Substring(0,manguon.Length-1)+")";
			if (bSort_mabd) sql+=" order by b.ma";
			else sql+=" order by b.ten";			
			DataTable tmp=get_data(sql).Tables[0];
			DataRow r1;
			string mmyys="";
			if(bKiemtrathangsau)
			{
				foreach(DataRow r2 in get_data("select mmyy from d_table where substr(mmyy,3,2)||substr(mmyy,1,2)>'"+mmyy.Substring(2,2)+mmyy.Substring(0,2)+"'").Tables[0].Rows)
				{
					mmyys=r2["mmyy"].ToString();
					xxx=user+"d"+mmyys;
					sql="select makho,mabd,manguon,sum(slxuat+case when slyeucau>0 then slyeucau else 0 end) soluong from "+xxx+".d_tonkhoth where slxuat+case when slyeucau>0 then slyeucau else 0 end>0 and mmyy='"+mmyys+"'";
					if (makho!="") sql+=" and makho in ("+makho.Substring(0,makho.Length-1)+")";
					if (manguon!="") sql+=" and manguon in ("+manguon.Substring(0,manguon.Length-1)+")";
					sql+=" group by makho,mabd,manguon";
					foreach(DataRow r in get_data(sql).Tables[0].Rows)
					{
						r1=getrowbyid(tmp,"makho="+int.Parse(r["makho"].ToString())+" and id="+int.Parse(r["mabd"].ToString())+" and manguon="+int.Parse(r["manguon"].ToString()));
						if (r1!=null) r1["soluong"]=decimal.Parse(r1["soluong"].ToString())-decimal.Parse(r["soluong"].ToString());
					}
				}
			}
			return tmp;
		}

		public DataTable get_tonkhoth_dutru_botutruc(string mmyy,string makho,string manguon, bool bKiemtrathangsau, bool bBoThuocDanhdauTutruc)
		{
			string xxx=user+"d"+mmyy;
			sql="select rownum stt,d.ten tennguon,b.ma,trim(b.ten)||' '||b.hamluong ten,b.tenhc,b.dang,c.ten tenkho,";
			sql+="a.tondau+a.slnhap-a.slxuat-case when a.slyeucau>0 then a.slyeucau else 0 end soluong,b.id,a.makho,";
			sql+="b.bhyt,b.mahc,a.manguon,0 tutruc,b.manhom,b.madoituong,b.choduyet, b.sothe, b.hoichan ";
			sql+=" from "+xxx+".d_tonkhoth a,"+user+".d_dmbd b,"+user+".d_dmkho c,"+user+".d_dmnguon d ";
			sql+=" where a.mabd=b.id and a.makho=c.id and a.manguon=d.id and a.mmyy='"+mmyy+"'";
			if (makho!="") sql+=" and a.makho in ("+makho.Substring(0,makho.Length-1)+")";
			if (manguon!="") sql+=" and a.manguon in ("+manguon.Substring(0,manguon.Length-1)+")";
			if(bBoThuocDanhdauTutruc) sql+=" and b.tutruc<>1";
			if (bSort_mabd) sql+=" order by b.ma";
			else sql+=" order by b.ten";
//			StreamWriter vsw=new StreamWriter("get_tonkhoth_dutru_botutruc.txt");
//			vsw.WriteLine(sql);
//			vsw.Close();
			DataTable tmp=get_data(sql).Tables[0];
			DataRow r1;
			string mmyys="";
			if(bKiemtrathangsau)
			{
				foreach(DataRow r2 in get_data("select mmyy from d_table where substr(mmyy,3,2)||substr(mmyy,1,2)>'"+mmyy.Substring(2,2)+mmyy.Substring(0,2)+"'").Tables[0].Rows)
				{
					mmyys=r2["mmyy"].ToString();
					xxx=user+"d"+mmyys;
					sql="select makho,mabd,manguon,sum(slxuat+case when slyeucau>0 then slyeucau else 0 end) soluong from "+xxx+".d_tonkhoth where slxuat+case when slyeucau>0 then slyeucau else 0 end>0 and mmyy='"+mmyys+"'";
					if (makho!="") sql+=" and makho in ("+makho.Substring(0,makho.Length-1)+")";
					if (manguon!="") sql+=" and manguon in ("+manguon.Substring(0,manguon.Length-1)+")";
					sql+=" group by makho,mabd,manguon";
					foreach(DataRow r in get_data(sql).Tables[0].Rows)
					{
						r1=getrowbyid(tmp,"makho="+int.Parse(r["makho"].ToString())+" and id="+int.Parse(r["mabd"].ToString())+" and manguon="+int.Parse(r["manguon"].ToString()));
						if (r1!=null) r1["soluong"]=decimal.Parse(r1["soluong"].ToString())-decimal.Parse(r["soluong"].ToString());
					}
				}
			}
			return tmp;
		}
		public DataTable get_tutructh_dutru(string mmyy,int makp,string makho,string manguon,int tutruc,int nhom, bool bKiemtrathangsau)
		{
			string xxx=user+"d"+mmyy;
			upd_tontutruc(mmyy,nhom,makp);
			sql="select rownum stt,d.ten tennguon,b.ma,trim(b.ten)||' '||b.hamluong ten,b.tenhc,b.dang,c.ten tenkho,";
			sql+="a.tondau+a.slnhap-a.slxuat soluong,b.id,a.makho,b.bhyt,b.mahc,a.manguon,1 tutruc,b.manhom,b.madoituong ";
			sql+=" from "+xxx+".d_tutructh a,"+user+".d_dmbd b,"+user+".d_dmkho c,"+user+".d_dmnguon d where a.mabd=b.id and a.makho=c.id and a.manguon=d.id   and a.mmyy='"+mmyy+"' and a.makp="+makp;
			if (tutruc==1) sql+=" and b.tutruc=1";
			if (makho!="") sql+=" and a.makho in ("+makho.Substring(0,makho.Length-1)+")";
			if (manguon!="") sql+=" and a.manguon in ("+manguon.Substring(0,manguon.Length-1)+")";
			sql+=" order by b.ten";
			DataTable tmp=get_data(sql).Tables[0];
			DataRow r1;
			string mmyys="";
			if(bKiemtra_phieu)
			{
				foreach(DataRow r2 in get_data("select mmyy from d_table where substr(mmyy,3,2)||substr(mmyy,1,2)>'"+mmyy.Substring(2,2)+mmyy.Substring(0,2)+"'").Tables[0].Rows)
				{
					mmyys=r2["mmyy"].ToString();
					xxx=user+"d"+mmyys;
					sql="select a.makho,a.mabd,a.manguon,sum(a.slxuat+case when a.slyeucau>0 then a.slyeucau else 0 end) soluong from "+xxx+".d_tutructh a,"+user+".d_dmbd b where a.mabd=b.id and a.slxuat+case when a.slyeucau>0 then a.slyeucau else 0 end>0 and a.mmyy='"+mmyys+"' and a.makp="+makp;
					if (tutruc==1) sql+=" and b.tutruc=1";
					if (makho!="") sql+=" and a.makho in ("+makho.Substring(0,makho.Length-1)+")";
					if (manguon!="") sql+=" and a.manguon in ("+manguon.Substring(0,manguon.Length-1)+")";
					sql+=" group by a.makho,a.mabd,a.manguon";
					foreach(DataRow r in get_data(sql).Tables[0].Rows)
					{
						r1=getrowbyid(tmp,"makho="+int.Parse(r["makho"].ToString())+" and id="+int.Parse(r["mabd"].ToString())+" and manguon="+int.Parse(r["manguon"].ToString()));
						if (r1!=null) r1["soluong"]=decimal.Parse(r1["soluong"].ToString())-decimal.Parse(r["soluong"].ToString());
					}
				}
			}
			return tmp;
		}

		public DataTable get_tutructh_dutru(string mmyy,int makp,string makho,string manguon,int tutruc,int nhom)
		{
			string xxx=user+"d"+mmyy;
			upd_tontutruc(mmyy,nhom,makp);
			sql="select rownum stt,d.ten tennguon,b.ma,trim(b.ten)||' '||b.hamluong ten,b.tenhc,b.dang,c.ten tenkho,";
			sql+="a.tondau+a.slnhap-a.slxuat soluong,b.id,a.makho,b.bhyt,b.mahc,a.manguon,1 tutruc,b.manhom,b.madoituong ";
			sql+=" from "+xxx+".d_tutructh a,"+user+".d_dmbd b,"+user+".d_dmkho c,"+user+".d_dmnguon d where a.mabd=b.id and a.makho=c.id and a.manguon=d.id   and a.mmyy='"+mmyy+"' and a.makp="+makp;
			if (tutruc==1) sql+=" and b.tutruc=1";
			if (makho!="") sql+=" and a.makho in ("+makho.Substring(0,makho.Length-1)+")";
			if (manguon!="") sql+=" and a.manguon in ("+manguon.Substring(0,manguon.Length-1)+")";
			sql+=" order by b.ten";
			DataTable tmp=get_data(sql).Tables[0];
			DataRow r1;
			string mmyys="";
			foreach(DataRow r2 in get_data("select mmyy from d_table where substr(mmyy,3,2)||substr(mmyy,1,2)>'"+mmyy.Substring(2,2)+mmyy.Substring(0,2)+"'").Tables[0].Rows)
			{
				mmyys=r2["mmyy"].ToString();
				xxx=user+"d"+mmyys;
				sql="select a.makho,a.mabd,a.manguon,sum(a.slxuat+case when a.slyeucau>0 then a.slyeucau else 0 end) soluong from "+xxx+".d_tutructh a,"+user+".d_dmbd b where a.mabd=b.id and a.slxuat+case when a.slyeucau>0 then a.slyeucau else 0 end>0 and a.mmyy='"+mmyys+"' and a.makp="+makp;
				if (tutruc==1) sql+=" and b.tutruc=1";
				if (makho!="") sql+=" and a.makho in ("+makho.Substring(0,makho.Length-1)+")";
				if (manguon!="") sql+=" and a.manguon in ("+manguon.Substring(0,manguon.Length-1)+")";
				sql+=" group by a.makho,a.mabd,a.manguon";
				foreach(DataRow r in get_data(sql).Tables[0].Rows)
				{
					r1=getrowbyid(tmp,"makho="+int.Parse(r["makho"].ToString())+" and id="+int.Parse(r["mabd"].ToString())+" and manguon="+int.Parse(r["manguon"].ToString()));
					if (r1!=null) r1["soluong"]=decimal.Parse(r1["soluong"].ToString())-decimal.Parse(r["soluong"].ToString());
				}
			}
			return tmp;
		}

		public bool upd_tontutruc(string d_mmyy,int d_nhom,int d_makp)
		{
			string xxx=user+"d"+d_mmyy+".pkg_duoc.upd_tontutruc";
			con=new OracleConnection(sConn);//get_conn(d_mmyy)
			try
			{
				con.Open();
				cmd=new OracleCommand(xxx,con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_mmyy",OracleType.VarChar,4).Value=d_mmyy;
				cmd.Parameters.Add("d_nhom",OracleType.Number).Value=d_nhom;
				cmd.Parameters.Add("d_makp",OracleType.Number).Value=d_makp;

				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"tontutruc");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public string get_makho(int nhom,int loai,int thuoc)
		{
			string makho="";
			sql="select * from d_dmkho where nhom="+nhom+" and loai="+thuoc;
			makho=get_data("select kho from d_dmphieu where id="+loai).Tables[0].Rows[0][0].ToString();
			if (makho!="") sql+=" and id in ("+makho.Substring(0,makho.Length-1)+")";
			makho="";
			foreach(DataRow r in get_data(sql).Tables[0].Rows) makho+=r["id"].ToString().Trim()+",";
			return makho;
		}
		public DataTable get_tutrucct_dutru(string mmyy,int makp,string makho,string manguon,int tutruc,int nhom)
		{
			string xxx=user+"d"+mmyy;
			upd_tontutruc(mmyy,nhom,makp);
			sql="select rownum stt,d.ten tennguon,b.ma,trim(b.ten)||' '||b.hamluong ten,a.losx,t.sothe,b.dang,";
			sql+="c.ten tenkho,a.tondau+a.slnhap-a.slxuat soluong,b.id,a.makho,b.bhyt,b.mahc,a.manguon,";
			sql+="1 tutruc,b.manhom,b.tenhc,a.stt as sttt ";
			sql+=" from "+xxx+".d_tutrucct a,"+user+".d_dmbd b,"+user+".d_dmkho c,"+user+".d_dmnguon d,"+user+".d_dmnhom e,"+xxx+".d_theodoitscd t";
			sql+=" where a.mabd=b.id and b.manhom=e.id and a.makho=c.id and a.manguon=d.id and a.makp="+makp;
			sql+=" and a.makho=t.makho(+) and a.stt=t.sttt(+) and e.theodoi=1";
			if (tutruc==1) sql+=" and b.tutruc=1";
			if (makho!="") sql+=" and a.makho in ("+makho.Substring(0,makho.Length-1)+")";
			if (manguon!="") sql+=" and a.manguon in ("+manguon.Substring(0,manguon.Length-1)+")";
			sql+=" order by b.ten";
			DataTable tmp=get_data(sql).Tables[0];
			DataRow r1;
			string mmyys="";
			foreach(DataRow r2 in get_data("select mmyy from d_table where substr(mmyy,3,2)||substr(mmyy,1,2)>'"+mmyy.Substring(2,2)+mmyy.Substring(0,2)+"'").Tables[0].Rows)
			{
				mmyys=r2["mmyy"].ToString();
				xxx=user+"d"+mmyys;
				sql="select a.stt,a.makho,a.mabd,a.manguon,sum(a.slxuat) soluong from "+xxx+".d_tutrucct a,"+user+".d_dmbd b,"+user+".d_dmnhom c where a.mabd=b.id and b.manhom=c.id and a.slxuat>0 and a.makp="+makp;
				sql+=" and c.theodoi=1";
				if (tutruc==1) sql+=" and b.tutruc=1";
				if (makho!="") sql+=" and a.makho in ("+makho.Substring(0,makho.Length-1)+")";
				if (manguon!="") sql+=" and a.manguon in ("+manguon.Substring(0,manguon.Length-1)+")";
				sql+=" group by a.stt,a.makho,a.mabd,a.manguon";
				foreach(DataRow r in get_data(sql).Tables[0].Rows)
				{
					r1=getrowbyid(tmp,"sttt="+long.Parse(r["stt"].ToString())+" and makho="+int.Parse(r["makho"].ToString())+" and id="+int.Parse(r["mabd"].ToString())+" and manguon="+int.Parse(r["manguon"].ToString()));
					if (r1!=null) r1["soluong"]=decimal.Parse(r1["soluong"].ToString())-decimal.Parse(r["soluong"].ToString());
				}
			}
			return tmp;
		}
		public DataTable get_tutrucct_dutru(string mmyy,int makp,string makho,string manguon,int tutruc)
		{
			string xxx=user+"d"+mmyy;
			sql="select a.*,b.ten tennguon,c.ten tennhomcc ";
			sql+=" from "+xxx+".d_tutrucct a,"+user+".d_dmnguon b,"+user+".d_nhomcc c,"+user+".d_dmbd d ";
			sql+=" where a.manguon=b.id and a.nhomcc=c.id and a.mabd=d.id and a.mmyy='"+mmyy+"' and a.makp="+makp;
			if (tutruc==1) sql+=" and d.tutruc=1";
			if (makho!="") sql+=" and a.makho in ("+makho.Substring(0,makho.Length-1)+")";
			if (manguon!="") sql+=" and a.manguon in ("+manguon.Substring(0,manguon.Length-1)+")";
			sql+=" order by a.stt";
			DataTable tmp=get_data(sql).Tables[0];
			DataRow r1;
			string mmyys="";
			foreach(DataRow r2 in get_data("select mmyy from d_table where substr(mmyy,3,2)||substr(mmyy,1,2)>'"+mmyy.Substring(2,2)+mmyy.Substring(0,2)+"'").Tables[0].Rows)
			{
				mmyys=r2["mmyy"].ToString();
				xxx=user+"d"+mmyys;
				sql="select a.makho,a.stt,sum(a.slxuat) soluong from "+xxx+".d_tutrucct a,"+user+".d_dmbd d where a.mabd=d.id and a.slxuat>0 and a.mmyy='"+mmyys+"' and a.makp="+makp;
				if (tutruc==1) sql+=" and d.tutruc=1";
				if (makho!="") sql+=" and a.makho in ("+makho.Substring(0,makho.Length-1)+")";
				if (manguon!="") sql+=" and a.manguon in ("+manguon.Substring(0,manguon.Length-1)+")";
				sql+=" group by a.makho,a.stt";
				foreach(DataRow r in get_data(sql).Tables[0].Rows)
				{
					r1=getrowbyid(tmp,"makho="+int.Parse(r["makho"].ToString())+" and stt="+int.Parse(r["stt"].ToString()));
					if (r1!=null) r1["slxuat"]=decimal.Parse(r1["slxuat"].ToString())+decimal.Parse(r["soluong"].ToString());
				}
			}
			return tmp;
		}

		public long get_id_xuatsd
		{
			get
			{
				return getidyymmdd_d(8);
			}
		}
		public long get_id_duyet
		{
			get
			{
				return getidyymmdd_d(14);
			}
		}

		public bool upd_duyetkho(long d_idduyet, int d_makho,int d_done)
		{
			sql = "update d_duyetkho set done=:d_done where idduyet=:d_idduyet and makho=:d_makho";			
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd = new OracleCommand(sql, con);
				cmd.CommandType = CommandType.Text;
				cmd.Parameters.Add("d_done", OracleType.Number).Value = d_done;
				cmd.Parameters.Add("d_idduyet", OracleType.Number).Value = d_idduyet;
				cmd.Parameters.Add("d_makho", OracleType.Number).Value = d_makho;
				int irec = cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec == 0)
				{
					sql = "insert into d_duyetkho (idduyet,makho,done) values (:d_idduyet,:d_makho,:d_done)";
					cmd = new OracleCommand(sql, con);
					cmd.CommandType = CommandType.Text;
					cmd.Parameters.Add("d_idduyet", OracleType.Number).Value = d_idduyet;
					cmd.Parameters.Add("d_makho", OracleType.Number).Value = d_makho;
					cmd.Parameters.Add("d_done", OracleType.Number).Value = d_done;
					cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch (OracleException ex)
			{
				upd_error(ex.Message, sComputer, "d_duyetkho");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_dutrull_pkg(long d_id,long d_idduyet,string d_mabn,long d_maql,long d_idkhoa)
		{
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand("pkg_duoc.upd_dutrull",con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				cmd.Parameters.Add("d_idduyet",OracleType.Number).Value=d_idduyet;
				cmd.Parameters.Add("d_mabn",OracleType.VarChar,8).Value=d_mabn;
				cmd.Parameters.Add("d_maql",OracleType.Number).Value=d_maql;
				cmd.Parameters.Add("d_idkhoa",OracleType.Number).Value=d_idkhoa;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_dutrull");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_dutrull_pkg(long d_id,long d_idduyet,string d_mabn,long d_maql,long d_idkhoa,decimal d_songay)
		{
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand("pkg_duoc.upd_dutrull",con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				cmd.Parameters.Add("d_idduyet",OracleType.Number).Value=d_idduyet;
				cmd.Parameters.Add("d_mabn",OracleType.VarChar,8).Value=d_mabn;
				cmd.Parameters.Add("d_maql",OracleType.Number).Value=d_maql;
				cmd.Parameters.Add("d_idkhoa",OracleType.Number).Value=d_idkhoa;
				cmd.Parameters.Add("d_songay",OracleType.Number).Value=d_songay;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_dutrull");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}
		public bool upd_dausinhton_pkg(long d_id,long d_idkhoa,long d_iddutru,string d_ngay,string d_mabs,string d_manv,decimal d_mach,decimal d_nhietdo,string d_huyetap,decimal d_nhiptho,int d_cannang,string d_phong,string d_giuong,string d_ghichu)
		{
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand("pkg_duoc.upd_dausinhton",con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				cmd.Parameters.Add("d_idkhoa",OracleType.Number).Value=d_idkhoa;
				cmd.Parameters.Add("d_iddutru",OracleType.Number).Value=d_iddutru;
				cmd.Parameters.Add("d_ngay",OracleType.VarChar,16).Value=d_ngay;
				cmd.Parameters.Add("d_mabs",OracleType.VarChar,4).Value=d_mabs;
				cmd.Parameters.Add("d_manv",OracleType.VarChar,4).Value=d_manv;
				cmd.Parameters.Add("d_mach",OracleType.Number).Value=d_mach;
				cmd.Parameters.Add("d_nhietdo",OracleType.Number).Value=d_nhietdo;
				cmd.Parameters.Add("d_huyetap",OracleType.VarChar,7).Value=d_huyetap;
				cmd.Parameters.Add("d_nhiptho",OracleType.Number).Value=d_nhiptho;
				cmd.Parameters.Add("d_cannang",OracleType.Number).Value=d_cannang;
				cmd.Parameters.Add("d_phong",OracleType.VarChar,10).Value=d_phong;
				cmd.Parameters.Add("d_giuong",OracleType.VarChar,10).Value=d_giuong;
				cmd.Parameters.Add("d_ghichu",OracleType.NVarChar,50).Value=d_ghichu;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_dausinhton");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_dausinhton_pkg(long d_id,long d_idkhoa,long d_iddutru,string d_ngay,string d_mabs,string d_manv,decimal d_mach,decimal d_nhietdo,string d_huyetap,decimal d_nhiptho,int d_cannang,string d_phong,string d_giuong,string d_ghichu,string d_nuoctieu,string d_phan)
		{
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand("pkg_duoc.upd_dausinhton",con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				cmd.Parameters.Add("d_idkhoa",OracleType.Number).Value=d_idkhoa;
				cmd.Parameters.Add("d_iddutru",OracleType.Number).Value=d_iddutru;
				cmd.Parameters.Add("d_ngay",OracleType.VarChar,16).Value=d_ngay;
				cmd.Parameters.Add("d_mabs",OracleType.VarChar,4).Value=d_mabs;
				cmd.Parameters.Add("d_manv",OracleType.VarChar,4).Value=d_manv;
				cmd.Parameters.Add("d_mach",OracleType.Number).Value=d_mach;
				cmd.Parameters.Add("d_nhietdo",OracleType.Number).Value=d_nhietdo;
				cmd.Parameters.Add("d_huyetap",OracleType.VarChar,7).Value=d_huyetap;
				cmd.Parameters.Add("d_nhiptho",OracleType.Number).Value=d_nhiptho;
				cmd.Parameters.Add("d_cannang",OracleType.Number).Value=d_cannang;
				cmd.Parameters.Add("d_phong",OracleType.VarChar,10).Value=d_phong;
				cmd.Parameters.Add("d_giuong",OracleType.VarChar,10).Value=d_giuong;
				cmd.Parameters.Add("d_ghichu",OracleType.NVarChar,50).Value=d_ghichu;
				cmd.Parameters.Add("d_nuoctieu",OracleType.NVarChar,100).Value=d_nuoctieu;
				cmd.Parameters.Add("d_phan",OracleType.NVarChar,100).Value=d_phan;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_dausinhton");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_dutruct(long d_id,int d_stt,int d_madoituong,int d_makho,int d_mabd,decimal d_slyeucau,decimal d_slthuc,string d_cachdung,int d_manguon,int d_tutruc)
		{
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand("pkg_duoc.upd_dutruct",con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				cmd.Parameters.Add("d_stt",OracleType.Number).Value=d_stt;
				cmd.Parameters.Add("d_madoituong",OracleType.Number).Value=d_madoituong;
				cmd.Parameters.Add("d_makho",OracleType.Number).Value=d_makho;
				cmd.Parameters.Add("d_mabd",OracleType.Number).Value=d_mabd;
				cmd.Parameters.Add("d_slyeucau",OracleType.Number).Value=d_slyeucau;
				cmd.Parameters.Add("d_slthuc",OracleType.Number).Value=d_slthuc;
				cmd.Parameters.Add("d_cachdung",OracleType.NVarChar,255).Value=d_cachdung;
				cmd.Parameters.Add("d_manguon",OracleType.Number).Value=d_manguon;
				cmd.Parameters.Add("d_tutruc",OracleType.Number).Value=d_tutruc;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_dutruct");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_dutruct(long d_id,int d_stt,int d_madoituong,int d_makho,int d_mabd,decimal d_slyeucau,decimal d_slthuc,string d_cachdung,int d_manguon,int d_tutruc,string d_ghichu)
		{
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand("pkg_duoc.upd_dutruct",con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				cmd.Parameters.Add("d_stt",OracleType.Number).Value=d_stt;
				cmd.Parameters.Add("d_madoituong",OracleType.Number).Value=d_madoituong;
				cmd.Parameters.Add("d_makho",OracleType.Number).Value=d_makho;
				cmd.Parameters.Add("d_mabd",OracleType.Number).Value=d_mabd;
				cmd.Parameters.Add("d_slyeucau",OracleType.Number).Value=d_slyeucau;
				cmd.Parameters.Add("d_slthuc",OracleType.Number).Value=d_slthuc;
				cmd.Parameters.Add("d_cachdung",OracleType.NVarChar,255).Value=d_cachdung;
				cmd.Parameters.Add("d_manguon",OracleType.Number).Value=d_manguon;
				cmd.Parameters.Add("d_tutruc",OracleType.Number).Value=d_tutruc;
				cmd.Parameters.Add("d_ghichu",OracleType.VarChar,10).Value=d_ghichu;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_dutruct");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_dutruct(long d_id,int d_stt,int d_madoituong,int d_makho,int d_mabd,decimal d_slyeucau,decimal d_slthuc,string d_cachdung,int d_manguon,int d_tutruc,string d_ghichu,decimal d_slylenh)
		{
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand("pkg_duoc.upd_dutruct",con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				cmd.Parameters.Add("d_stt",OracleType.Number).Value=d_stt;
				cmd.Parameters.Add("d_madoituong",OracleType.Number).Value=d_madoituong;
				cmd.Parameters.Add("d_makho",OracleType.Number).Value=d_makho;
				cmd.Parameters.Add("d_mabd",OracleType.Number).Value=d_mabd;
				cmd.Parameters.Add("d_slyeucau",OracleType.Number).Value=d_slyeucau;
				cmd.Parameters.Add("d_slthuc",OracleType.Number).Value=d_slthuc;
				cmd.Parameters.Add("d_cachdung",OracleType.NVarChar,255).Value=d_cachdung;
				cmd.Parameters.Add("d_manguon",OracleType.Number).Value=d_manguon;
				cmd.Parameters.Add("d_tutruc",OracleType.Number).Value=d_tutruc;
				cmd.Parameters.Add("d_ghichu",OracleType.VarChar,10).Value=d_ghichu;
				cmd.Parameters.Add("d_slylenh",OracleType.Number).Value=d_slylenh;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_dutruct");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_dutruct(long d_id,int d_stt,int d_madoituong,int d_makho,int d_mabd,decimal d_slyeucau,decimal d_slthuc,string d_cachdung,int d_manguon,int d_tutruc,string d_ghichu,decimal d_slylenh,decimal d_tt,int d_ngoai)
		{
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand("pkg_duoc.upd_dutruct",con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				cmd.Parameters.Add("d_stt",OracleType.Number).Value=d_stt;
				cmd.Parameters.Add("d_madoituong",OracleType.Number).Value=d_madoituong;
				cmd.Parameters.Add("d_makho",OracleType.Number).Value=d_makho;
				cmd.Parameters.Add("d_mabd",OracleType.Number).Value=d_mabd;
				cmd.Parameters.Add("d_slyeucau",OracleType.Number).Value=d_slyeucau;
				cmd.Parameters.Add("d_slthuc",OracleType.Number).Value=d_slthuc;
				cmd.Parameters.Add("d_cachdung",OracleType.NVarChar,255).Value=d_cachdung;
				cmd.Parameters.Add("d_manguon",OracleType.Number).Value=d_manguon;
				cmd.Parameters.Add("d_tutruc",OracleType.Number).Value=d_tutruc;
				cmd.Parameters.Add("d_ghichu",OracleType.VarChar,10).Value=d_ghichu;
				cmd.Parameters.Add("d_slylenh",OracleType.Number).Value=d_slylenh;
				cmd.Parameters.Add("d_tt",OracleType.Number).Value=d_tt;
				cmd.Parameters.Add("d_ngoai",OracleType.Number).Value=d_ngoai;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_dutruct");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_dutruct(long d_id,int d_stt,int d_madoituong,int d_makho,int d_mabd,decimal d_slyeucau,decimal d_slthuc,string d_cachdung,int d_manguon,int d_tutruc,string d_ghichu,decimal d_slylenh,decimal d_tt,int d_ngoai,int d_choduyet)
		{
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand("pkg_duoc.upd_dutruct",con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				cmd.Parameters.Add("d_stt",OracleType.Number).Value=d_stt;
				cmd.Parameters.Add("d_madoituong",OracleType.Number).Value=d_madoituong;
				cmd.Parameters.Add("d_makho",OracleType.Number).Value=d_makho;
				cmd.Parameters.Add("d_mabd",OracleType.Number).Value=d_mabd;
				cmd.Parameters.Add("d_slyeucau",OracleType.Number).Value=d_slyeucau;
				cmd.Parameters.Add("d_slthuc",OracleType.Number).Value=d_slthuc;
				cmd.Parameters.Add("d_cachdung",OracleType.NVarChar,255).Value=d_cachdung;
				cmd.Parameters.Add("d_manguon",OracleType.Number).Value=d_manguon;
				cmd.Parameters.Add("d_tutruc",OracleType.Number).Value=d_tutruc;
				cmd.Parameters.Add("d_ghichu",OracleType.VarChar,10).Value=d_ghichu;
				cmd.Parameters.Add("d_slylenh",OracleType.Number).Value=d_slylenh;
				cmd.Parameters.Add("d_tt",OracleType.Number).Value=d_tt;
				cmd.Parameters.Add("d_ngoai",OracleType.Number).Value=d_ngoai;
				cmd.Parameters.Add("d_choduyet",OracleType.Number).Value=d_choduyet;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_dutruct");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_dutruct(long d_id,int d_stt,int d_madoituong,int d_makho,int d_mabd,decimal d_slyeucau,decimal d_slthuc,string d_cachdung,int d_manguon,int d_tutruc,string d_ghichu,decimal d_slylenh,decimal d_tt,int d_ngoai,int d_choduyet, int d_hoichan)
		{
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand("pkg_duoc.upd_dutruct",con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				cmd.Parameters.Add("d_stt",OracleType.Number).Value=d_stt;
				cmd.Parameters.Add("d_madoituong",OracleType.Number).Value=d_madoituong;
				cmd.Parameters.Add("d_makho",OracleType.Number).Value=d_makho;
				cmd.Parameters.Add("d_mabd",OracleType.Number).Value=d_mabd;
				cmd.Parameters.Add("d_slyeucau",OracleType.Number).Value=d_slyeucau;
				cmd.Parameters.Add("d_slthuc",OracleType.Number).Value=d_slthuc;
				cmd.Parameters.Add("d_cachdung",OracleType.NVarChar,255).Value=d_cachdung;
				cmd.Parameters.Add("d_manguon",OracleType.Number).Value=d_manguon;
				cmd.Parameters.Add("d_tutruc",OracleType.Number).Value=d_tutruc;
				cmd.Parameters.Add("d_ghichu",OracleType.VarChar,10).Value=d_ghichu;
				cmd.Parameters.Add("d_slylenh",OracleType.Number).Value=d_slylenh;
				cmd.Parameters.Add("d_tt",OracleType.Number).Value=d_tt;
				cmd.Parameters.Add("d_ngoai",OracleType.Number).Value=d_ngoai;
				cmd.Parameters.Add("d_choduyet",OracleType.Number).Value=d_choduyet;
				cmd.Parameters.Add("d_hoichan",OracleType.Number).Value=d_hoichan;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_dutruct");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_hoantrall(long d_id,long d_idduyet,string d_mabn,long d_maql,long d_idkhoa,int d_lydo,int d_thuoc)
		{
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand("pkg_duoc.upd_hoantrall",con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				cmd.Parameters.Add("d_idduyet",OracleType.Number).Value=d_idduyet;
				cmd.Parameters.Add("d_mabn",OracleType.VarChar,8).Value=d_mabn;
				cmd.Parameters.Add("d_maql",OracleType.Number).Value=d_maql;
				cmd.Parameters.Add("d_idkhoa",OracleType.Number).Value=d_idkhoa;
				cmd.Parameters.Add("d_lydo",OracleType.Number).Value=d_lydo;
				cmd.Parameters.Add("d_thuoc",OracleType.Number).Value=d_thuoc;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_hoantrall");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_hoantract(long d_id,int d_stt,string d_ngay,int d_madoituong,int d_makho,int d_mabd,decimal d_slyeucau,decimal d_slthuc,int d_manguon)
		{
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand("pkg_duoc.upd_hoantract",con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				cmd.Parameters.Add("d_stt",OracleType.Number).Value=d_stt;
				cmd.Parameters.Add("d_ngay",OracleType.VarChar,10).Value=d_ngay;
				cmd.Parameters.Add("d_madoituong",OracleType.Number).Value=d_madoituong;
				cmd.Parameters.Add("d_makho",OracleType.Number).Value=d_makho;
				cmd.Parameters.Add("d_mabd",OracleType.Number).Value=d_mabd;
				cmd.Parameters.Add("d_slyeucau",OracleType.Number).Value=d_slyeucau;
				cmd.Parameters.Add("d_slthuc",OracleType.Number).Value=d_slthuc;
				cmd.Parameters.Add("d_manguon",OracleType.Number).Value=d_manguon;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_hoantract");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_hoantract(long d_id,int d_stt,string d_ngay,int d_madoituong,int d_makho,int d_mabd,decimal d_slyeucau,decimal d_slthuc,int d_manguon,long d_sttt)
		{
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand("pkg_duoc.upd_hoantract",con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				cmd.Parameters.Add("d_stt",OracleType.Number).Value=d_stt;
				cmd.Parameters.Add("d_ngay",OracleType.VarChar,10).Value=d_ngay;
				cmd.Parameters.Add("d_madoituong",OracleType.Number).Value=d_madoituong;
				cmd.Parameters.Add("d_makho",OracleType.Number).Value=d_makho;
				cmd.Parameters.Add("d_mabd",OracleType.Number).Value=d_mabd;
				cmd.Parameters.Add("d_slyeucau",OracleType.Number).Value=d_slyeucau;
				cmd.Parameters.Add("d_slthuc",OracleType.Number).Value=d_slthuc;
				cmd.Parameters.Add("d_manguon",OracleType.Number).Value=d_manguon;
				cmd.Parameters.Add("d_sttt",OracleType.Number).Value=d_sttt;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_hoantract");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}
		public bool upd_xuatsdll(long d_id,int d_nhom,string d_mabn,long d_maql,long d_idkhoa,string d_ngay,int d_loai,int d_phieu,int d_makp,string d_mmyy,int d_userid,long d_idduyet,int d_thuoc,int d_makhoa,int d_lydo,int d_lk,string d_ghichu,string d_ngayylenh)
		{
			string xxx=user+"d"+d_mmyy+".pkg_duoc.upd_xuatsdll";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(xxx,con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				cmd.Parameters.Add("d_nhom",OracleType.Number).Value=d_nhom;
				cmd.Parameters.Add("d_mabn",OracleType.VarChar,8).Value=d_mabn;
				cmd.Parameters.Add("d_maql",OracleType.Number).Value=d_maql;
				cmd.Parameters.Add("d_idkhoa",OracleType.Number).Value=d_idkhoa;
				cmd.Parameters.Add("d_ngay",OracleType.VarChar,10).Value=d_ngay;
				cmd.Parameters.Add("d_loai",OracleType.Number).Value=d_loai;
				cmd.Parameters.Add("d_phieu",OracleType.Number).Value=d_phieu;
				cmd.Parameters.Add("d_makp",OracleType.Number).Value=d_makp;
				cmd.Parameters.Add("d_mmyy",OracleType.VarChar,4).Value=d_mmyy;
				cmd.Parameters.Add("d_userid",OracleType.Number).Value=d_userid;
				cmd.Parameters.Add("d_idduyet",OracleType.Number).Value=d_idduyet;
				cmd.Parameters.Add("d_thuoc",OracleType.Number).Value=d_thuoc;
				cmd.Parameters.Add("d_makhoa",OracleType.Number).Value=d_makhoa;
				cmd.Parameters.Add("d_lydo",OracleType.Number).Value=d_lydo;
				cmd.Parameters.Add("d_lk",OracleType.Number).Value=d_lk;
				cmd.Parameters.Add("d_ghichu",OracleType.NVarChar,50).Value=d_ghichu;
				cmd.Parameters.Add("d_ngayylenh",OracleType.VarChar,10).Value=d_ngayylenh;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_xuatsdll");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			upd_hcton(d_nhom,d_mmyy,d_userid);
			return true;
		}	

		public bool upd_xuatsdct(string d_mmyy,long d_id,int d_stt,long d_sttt,int d_madoituong,int d_makho,int d_manguon,int d_nhomcc,int d_mabd,string d_handung,string d_losx,decimal d_soluong,decimal d_sotien,decimal d_giaban,decimal d_giamua,int d_sttduyet,string d_sothe,decimal d_namsx,decimal d_namsd)
		{
			string xxx=user+"d"+d_mmyy+".pkg_duoc.upd_xuatsdct";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(xxx,con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				cmd.Parameters.Add("d_stt",OracleType.Number).Value=d_stt;
				cmd.Parameters.Add("d_sttt",OracleType.Number).Value=d_sttt;
				cmd.Parameters.Add("d_madoituong",OracleType.Number).Value=d_madoituong;
				cmd.Parameters.Add("d_makho",OracleType.Number).Value=d_makho;
				cmd.Parameters.Add("d_manguon",OracleType.Number).Value=d_manguon;
				cmd.Parameters.Add("d_nhomcc",OracleType.Number).Value=d_nhomcc;
				cmd.Parameters.Add("d_mabd",OracleType.Number).Value=d_mabd;
				cmd.Parameters.Add("d_handung",OracleType.VarChar,4).Value=d_handung;
				cmd.Parameters.Add("d_losx",OracleType.VarChar,20).Value=d_losx;
				cmd.Parameters.Add("d_soluong",OracleType.Number).Value=d_soluong;
				cmd.Parameters.Add("d_sotien",OracleType.Number).Value=d_sotien;
				cmd.Parameters.Add("d_giaban",OracleType.Number).Value=d_giaban;
				cmd.Parameters.Add("d_giamua",OracleType.Number).Value=d_giamua;
				cmd.Parameters.Add("d_sttduyet",OracleType.Number).Value=d_sttduyet;
				cmd.Parameters.Add("d_sothe",OracleType.VarChar,20).Value=d_sothe;
				cmd.Parameters.Add("d_namsx",OracleType.Number).Value=d_namsx;
				cmd.Parameters.Add("d_namsd",OracleType.Number).Value=d_namsd;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_xuatsdct");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}
		public bool upd_bucstt(string d_mmyy,long d_id,int d_stt,long d_sttt,int d_makho,int d_manguon,int d_nhomcc,int d_mabd,string d_handung,string d_losx,decimal d_soluong,decimal d_sotien,decimal d_giaban,decimal d_giamua,int d_sttduyet)
		{
			string xxx=user+"d"+d_mmyy+".pkg_duoc.upd_bucstt";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(xxx,con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				cmd.Parameters.Add("d_stt",OracleType.Number).Value=d_stt;
				cmd.Parameters.Add("d_sttt",OracleType.Number).Value=d_sttt;
				cmd.Parameters.Add("d_makho",OracleType.Number).Value=d_makho;
				cmd.Parameters.Add("d_manguon",OracleType.Number).Value=d_manguon;
				cmd.Parameters.Add("d_nhomcc",OracleType.Number).Value=d_nhomcc;
				cmd.Parameters.Add("d_mabd",OracleType.Number).Value=d_mabd;
				cmd.Parameters.Add("d_handung",OracleType.VarChar,4).Value=d_handung;
				cmd.Parameters.Add("d_losx",OracleType.VarChar,20).Value=d_losx;
				cmd.Parameters.Add("d_soluong",OracleType.Number).Value=d_soluong;
				cmd.Parameters.Add("d_sotien",OracleType.Number).Value=d_sotien;
				cmd.Parameters.Add("d_giaban",OracleType.Number).Value=d_giaban;
				cmd.Parameters.Add("d_giamua",OracleType.Number).Value=d_giamua;
				cmd.Parameters.Add("d_sttduyet",OracleType.Number).Value=d_sttduyet;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_bucstt");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}
		public void get_xuatsdct_cstt(string mmyy,DataRow [] r,int makp,int makhoa,int tutruc,long id,string mabn,long maql,long idkhoa,int loai,int thuoc,string ngay)
		{
			DataSet ds=new DataSet();
			ds.ReadXml("..\\..\\..\\xml\\d_xuatsdct.xml");
			int stt=0;
			int irec=0;
			DataRow [] dr;
			DataTable dttonct;
			decimal sl,sltx,sttx,slton,dongia;
			string s="";
			for(int j=0;j<r.Length;j++)
			{
				sl=decimal.Parse(r[j]["soluong"].ToString());
				dttonct=get_tutrucct_dutru(mmyy,makp,int.Parse(r[j]["makho"].ToString()),int.Parse(r[j]["manguon"].ToString()),int.Parse(r[j]["mabd"].ToString()),tutruc);
				dr=dttonct.Select("true","stt");
				irec=dr.Length;
				for(int i=0;i<irec;i++)
				{
					slton=decimal.Parse(dr[i]["tondau"].ToString())+decimal.Parse(dr[i]["slnhap"].ToString())-decimal.Parse(dr[i]["slxuat"].ToString());
					dongia=decimal.Parse(dr[i]["giamua"].ToString());
					sltx=Math.Min(sl,slton);
					if (sltx>0)
					{
						stt=get_stt(ds.Tables[0]);
						sttx=dongia*sltx;
						dr[i]["slxuat"]=decimal.Parse(dr[i]["slxuat"].ToString())+sltx;
						updrec_xuatsdct("-",ds.Tables[0],stt,long.Parse(dr[i]["stt"].ToString()),"",int.Parse(r[j]["mabd"].ToString()),"","","","","","","",dr[i]["handung"].ToString(),dr[i]["losx"].ToString(),sltx,dongia,sttx,decimal.Parse(dr[i]["giaban"].ToString()),decimal.Parse(dr[i]["giamua"].ToString()),int.Parse(r[j]["madoituong"].ToString()),int.Parse(r[j]["makho"].ToString()),int.Parse(r[j]["manguon"].ToString()),int.Parse(dr[i]["nhomcc"].ToString()),"",int.Parse(r[j]["stt"].ToString()),tutruc,null);
						//
						if (!upd_xuatsdct(mmyy,id,stt,long.Parse(dr[i]["stt"].ToString()),int.Parse(r[j]["madoituong"].ToString()),int.Parse(dr[i]["makho"].ToString()),int.Parse(dr[i]["manguon"].ToString()),int.Parse(dr[i]["nhomcc"].ToString()),int.Parse(r[j]["mabd"].ToString()),dr[i]["handung"].ToString(),dr[i]["losx"].ToString(),sltx,sttx,decimal.Parse(dr[i]["giaban"].ToString()),decimal.Parse(dr[i]["giamua"].ToString()),int.Parse(r[j]["stt"].ToString()),"",0,0)) s+=r[j]["ten"].ToString().Trim()+";";
						upd_thucxuat_stt(mmyy,id,long.Parse(dr[i]["stt"].ToString()),int.Parse(r[j]["madoituong"].ToString()),int.Parse(dr[i]["makho"].ToString()),int.Parse(dr[i]["manguon"].ToString()),int.Parse(dr[i]["nhomcc"].ToString()),int.Parse(r[j]["mabd"].ToString()),dr[i]["handung"].ToString(),dr[i]["losx"].ToString(),sltx,sttx,decimal.Parse(dr[i]["giaban"].ToString()),decimal.Parse(dr[i]["giamua"].ToString()),"",0,0,stt);
						upd_tonkhoct_thucxuat(insert,mmyy,makp,loai,thuoc,long.Parse(dr[i]["stt"].ToString()),int.Parse(dr[i]["makho"].ToString()),int.Parse(dr[i]["manguon"].ToString()),int.Parse(dr[i]["nhomcc"].ToString()),int.Parse(r[j]["mabd"].ToString()),dr[i]["handung"].ToString(),dr[i]["losx"].ToString(),sltx,sttx,decimal.Parse(dr[i]["giaban"].ToString()),decimal.Parse(dr[i]["giamua"].ToString()),decimal.Parse(dr[i]["chietkhau"].ToString()));
						if (mabn!="")
						{
							upd_tienthuoc_id(insert,mmyy,mabn,maql,idkhoa,ngay,makhoa,loai,int.Parse(r[j]["madoituong"].ToString()),int.Parse(r[j]["mabd"].ToString()),sltx,sttx,decimal.Parse(dr[i]["giaban"].ToString()),decimal.Parse(dr[i]["giamua"].ToString()),id);
							long ll_mavaovien=get_mavaovien(maql);
							execute_data("update "+user+"d"+mmyy+".d_tienthuoc set mavaovien="+(ll_mavaovien==0?get_mavaovien(maql,mmyy):ll_mavaovien)+" where mabn='"+mabn+"' and maql="+maql+" and idkhoa="+idkhoa+" and to_char(ngay,'dd/mm/yyyy')='"+ngay.Substring(0,10).ToString()+"' and makp="+makhoa+" and madoituong="+int.Parse(r[j]["madoituong"].ToString())+" and mabd="+int.Parse(r[j]["mabd"].ToString())+" and giamua="+decimal.Parse(dr[i]["giamua"].ToString())+" and id="+id);
							upd_theodoicongno(insert,mabn,maql,idkhoa,int.Parse(r[j]["madoituong"].ToString()),sttx,"thuoc");
						}
						//
					}
					sl-=sltx;
					if (sl<=0) break;
				}
				if (sl>0 && id!=0) upd_treo(id,int.Parse(r[j]["stt"].ToString()),int.Parse(r[j]["manguon"].ToString()),int.Parse(r[j]["mabd"].ToString()),sl,"dutruct",int.Parse(r[j]["makho"].ToString()),int.Parse(r[j]["madoituong"].ToString()));
			}
			ds.AcceptChanges();
			if (s!="") System.Windows.Forms.MessageBox.Show("Những mặt hàng sau không cập nhật được\n"+s,Msg);
		}
		public void get_xuatsdct_cstt(string mmyy,DataRow [] r,int makp,int makhoa,int tutruc,long id,string mabn,long maql,long idkhoa,int loai,int thuoc,string ngay,decimal id_ktcao)
		{
			DataSet ds=new DataSet();
			ds.ReadXml("..\\..\\..\\xml\\d_xuatsdct.xml");
			int stt=0;
			int irec=0;
			DataRow [] dr;
			DataTable dttonct;
			decimal sl,sltx,sttx,slton,dongia;
			string s="";
			for(int j=0;j<r.Length;j++)
			{
				sl=decimal.Parse(r[j]["soluong"].ToString());
				dttonct=get_tutrucct_dutru(mmyy,makp,int.Parse(r[j]["makho"].ToString()),int.Parse(r[j]["manguon"].ToString()),int.Parse(r[j]["mabd"].ToString()),tutruc);
				dr=dttonct.Select("true","stt");
				irec=dr.Length;
				for(int i=0;i<irec;i++)
				{
					slton=decimal.Parse(dr[i]["tondau"].ToString())+decimal.Parse(dr[i]["slnhap"].ToString())-decimal.Parse(dr[i]["slxuat"].ToString());
					dongia=decimal.Parse(dr[i]["giamua"].ToString());
					sltx=Math.Min(sl,slton);
					if (sltx>0)
					{
						stt=get_stt(ds.Tables[0]);
						sttx=dongia*sltx;
						dr[i]["slxuat"]=decimal.Parse(dr[i]["slxuat"].ToString())+sltx;
						updrec_xuatsdct("-",ds.Tables[0],stt,long.Parse(dr[i]["stt"].ToString()),"",int.Parse(r[j]["mabd"].ToString()),"","","","","","","",dr[i]["handung"].ToString(),dr[i]["losx"].ToString(),sltx,dongia,sttx,decimal.Parse(dr[i]["giaban"].ToString()),decimal.Parse(dr[i]["giamua"].ToString()),int.Parse(r[j]["madoituong"].ToString()),int.Parse(r[j]["makho"].ToString()),int.Parse(r[j]["manguon"].ToString()),int.Parse(dr[i]["nhomcc"].ToString()),"",int.Parse(r[j]["stt"].ToString()),tutruc,null);
						//
						if (!upd_xuatsdct(mmyy,id,stt,long.Parse(dr[i]["stt"].ToString()),int.Parse(r[j]["madoituong"].ToString()),int.Parse(dr[i]["makho"].ToString()),int.Parse(dr[i]["manguon"].ToString()),int.Parse(dr[i]["nhomcc"].ToString()),int.Parse(r[j]["mabd"].ToString()),dr[i]["handung"].ToString(),dr[i]["losx"].ToString(),sltx,sttx,decimal.Parse(dr[i]["giaban"].ToString()),decimal.Parse(dr[i]["giamua"].ToString()),int.Parse(r[j]["stt"].ToString()),"",0,0)) s+=r[j]["ten"].ToString().Trim()+";";
						upd_thucxuat_stt(mmyy,id,long.Parse(dr[i]["stt"].ToString()),int.Parse(r[j]["madoituong"].ToString()),int.Parse(dr[i]["makho"].ToString()),int.Parse(dr[i]["manguon"].ToString()),int.Parse(dr[i]["nhomcc"].ToString()),int.Parse(r[j]["mabd"].ToString()),dr[i]["handung"].ToString(),dr[i]["losx"].ToString(),sltx,sttx,decimal.Parse(dr[i]["giaban"].ToString()),decimal.Parse(dr[i]["giamua"].ToString()),"",0,0,stt);
						upd_tonkhoct_thucxuat(insert,mmyy,makp,loai,thuoc,long.Parse(dr[i]["stt"].ToString()),int.Parse(dr[i]["makho"].ToString()),int.Parse(dr[i]["manguon"].ToString()),int.Parse(dr[i]["nhomcc"].ToString()),int.Parse(r[j]["mabd"].ToString()),dr[i]["handung"].ToString(),dr[i]["losx"].ToString(),sltx,sttx,decimal.Parse(dr[i]["giaban"].ToString()),decimal.Parse(dr[i]["giamua"].ToString()),decimal.Parse(dr[i]["chietkhau"].ToString()));
						if (mabn!="")
						{
							upd_tienthuoc(insert,mmyy,mabn,maql,idkhoa,ngay,makhoa,loai,int.Parse(r[j]["madoituong"].ToString()),int.Parse(r[j]["mabd"].ToString()),sltx,sttx,decimal.Parse(dr[i]["giaban"].ToString()),decimal.Parse(dr[i]["giamua"].ToString()),id_ktcao);
							long ll_mavaovien=get_mavaovien(maql);
							execute_data("update "+user+"d"+mmyy+".d_tienthuoc set id="+id+",mavaovien="+(ll_mavaovien==0?get_mavaovien(maql,mmyy):ll_mavaovien)+" where mabn='"+mabn+"' and maql="+maql+" and idkhoa="+idkhoa+" and to_char(ngay,'dd/mm/yyyy')='"+ngay.Substring(0,10).ToString()+"' and makp="+makhoa+" and madoituong="+int.Parse(r[j]["madoituong"].ToString())+" and mabd="+int.Parse(r[j]["mabd"].ToString())+" and giamua="+decimal.Parse(dr[i]["giamua"].ToString()));
							//							execute_data("update "+user+"d"+mmyy+".d_tienthuoc set id="+id+", mavaovien="+get_mavaovien(maql)+" where mabn='"+mabn+"' and maql="+maql+" and idkhoa="+idkhoa+" and to_char(ngay,'dd/mm/yyyy')='"+ngay.Substring(0,10).ToString()+"' and makp="+makp+" and madoituong="+int.Parse(r[j]["madoituong"].ToString())+" and mabd="+int.Parse(r[j]["mabd"].ToString())+" and giamua="+decimal.Parse(dr[i]["giamua"].ToString()));
							upd_theodoicongno(insert,mabn,maql,idkhoa,int.Parse(r[j]["madoituong"].ToString()),sttx,"thuoc");
						}
						//
					}
					sl-=sltx;
					if (sl<=0) break;
				}
				if (sl>0 && id!=0) upd_treo(id,int.Parse(r[j]["stt"].ToString()),int.Parse(r[j]["manguon"].ToString()),int.Parse(r[j]["mabd"].ToString()),sl,"dutruct",int.Parse(r[j]["makho"].ToString()),int.Parse(r[j]["madoituong"].ToString()));
			}
			ds.AcceptChanges();
			if (s!="") System.Windows.Forms.MessageBox.Show("Những mặt hàng sau không cập nhật được\n"+s,Msg);
		}
		public bool upd_thucxuat_stt(string d_mmyy,long d_id,long d_sttt,int d_madoituong,int d_makho,int d_manguon,int d_nhomc,int d_mabd,string d_handung,string d_losx,decimal d_soluong,decimal d_sotien,decimal d_giaban,decimal d_giamua,string d_sothe,decimal d_namsx,decimal d_namsd,int d_stt)
		{
			string xxx=user+"d"+d_mmyy+".pkg_duoc.upd_thucxuat_stt";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(xxx,con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				cmd.Parameters.Add("d_sttt",OracleType.Number).Value=d_sttt;
				cmd.Parameters.Add("d_madoituong",OracleType.Number).Value=d_madoituong;
				cmd.Parameters.Add("d_makho",OracleType.Number).Value=d_makho;
				cmd.Parameters.Add("d_manguon",OracleType.Number).Value=d_manguon;
				cmd.Parameters.Add("d_nhomcc",OracleType.Number).Value=d_nhomc;
				cmd.Parameters.Add("d_mabd",OracleType.Number).Value=d_mabd;
				cmd.Parameters.Add("d_handung",OracleType.VarChar,4).Value=d_handung;
				cmd.Parameters.Add("d_losx",OracleType.VarChar,20).Value=d_losx;
				cmd.Parameters.Add("d_soluong",OracleType.Number).Value=d_soluong;
				cmd.Parameters.Add("d_sotien",OracleType.Number).Value=d_sotien;
				cmd.Parameters.Add("d_giaban",OracleType.Number).Value=d_giaban;
				cmd.Parameters.Add("d_giamua",OracleType.Number).Value=d_giamua;
				cmd.Parameters.Add("d_sothe",OracleType.VarChar,20).Value=d_sothe;
				cmd.Parameters.Add("d_namsx",OracleType.Number).Value=d_namsx;
				cmd.Parameters.Add("d_namsd",OracleType.Number).Value=d_namsd;
				cmd.Parameters.Add("d_stt",OracleType.Number).Value=d_stt;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_thucxuat");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public void upd_thucxuat(string d_ngay,int d_nhom,int d_loai,int d_phieu,int d_makp,int d_makhoa,string d_mmyy,int d_thuoc,int d_makho)
		{
			string str,xxx=user+"d"+d_mmyy;
			bool bPhattron_doituong=bPhattron_congdondoituong(d_nhom);
			if (d_loai==2)
				str="select a.*,t.chietkhau from "+xxx+".d_tutrucct a,"+xxx+".d_theodoi t where a.stt=t.id and a.mmyy='"+d_mmyy+"'"+" and a.makp="+d_makp;
			else
				str="select a.*,t.chietkhau from "+xxx+".d_tonkhoct a,"+xxx+".d_theodoi t where a.stt=t.id and a.mmyy='"+d_mmyy+"'";
			if (bPhattron_doituong)
			{
				sql="select b.manguon,1 madoituong,b.makho,b.mabd,sum(b.soluong) soluong from "+xxx+".d_xuatsdll a,"+xxx+".d_xuatsdct b ";
				sql+=" where a.id=b.id and a.lk=1 and to_char(a.ngay,'dd/MM/yyyy')='"+d_ngay+"'"+" and a.nhom="+d_nhom+" and loai="+d_loai+" and a.phieu="+d_phieu+" and a.makhoa="+d_makhoa+" and a.mmyy='"+d_mmyy+"'";
				if (d_makho != 0) sql += " and a.lydo=" + d_makho;
				sql+=" group by b.manguon,1,b.makho,b.mabd";
			}
			else
			{
				sql="select b.manguon,b.madoituong,b.makho,b.mabd,sum(b.soluong) soluong from "+xxx+".d_xuatsdll a,"+xxx+".d_xuatsdct b ";
				sql+=" where a.id=b.id and a.lk=1 and to_char(a.ngay,'dd/mm/yyyy')='"+d_ngay+"'"+" and a.nhom="+d_nhom+" and loai="+d_loai+" and a.phieu="+d_phieu+" and a.makhoa="+d_makhoa;
				if (d_makho != 0) sql += " and a.lydo=" + d_makho;
				sql+=" group by b.manguon,b.madoituong,b.makho,b.mabd";
			}
			if (d_loai==3) 
			{
				str="select b.* from "+xxx+".d_xuatsdll a,"+xxx+".d_xuatsdct b ";
				str+=" where a.id=b.id and a.lk=1 and to_char(a.ngay,'dd/mm/yyyy')='"+d_ngay+"'";
				str+=" and a.nhom="+d_nhom+" and loai="+d_loai+" and a.phieu="+d_phieu+" and a.makhoa="+d_makhoa;
				if (d_makho != 0) str += " and a.lydo=" + d_makho;
				upd_hoantra(str,sql,d_ngay,d_nhom,d_loai,d_phieu,d_makp,d_makhoa,d_mmyy,true,d_thuoc,d_makho);
			}
			else upd_xuat(str,sql,d_ngay,d_nhom,d_loai,d_phieu,d_makp,d_makhoa,d_mmyy,true,d_thuoc,d_makho);
		}

		public bool upd_thucxuat(string d_mmyy,long d_id,long d_sttt,int d_madoituong,int d_makho,int d_manguon,int d_nhomc,int d_mabd,string d_handung,string d_losx,decimal d_soluong,decimal d_sotien,decimal d_giaban,decimal d_giamua,string d_sothe,decimal d_namsx,decimal d_namsd)
		{
			string xxx=user+"d"+d_mmyy+".pkg_duoc.upd_thucxuat";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(xxx,con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				cmd.Parameters.Add("d_sttt",OracleType.Number).Value=d_sttt;
				cmd.Parameters.Add("d_madoituong",OracleType.Number).Value=d_madoituong;
				cmd.Parameters.Add("d_makho",OracleType.Number).Value=d_makho;
				cmd.Parameters.Add("d_manguon",OracleType.Number).Value=d_manguon;
				cmd.Parameters.Add("d_nhomcc",OracleType.Number).Value=d_nhomc;
				cmd.Parameters.Add("d_mabd",OracleType.Number).Value=d_mabd;
				cmd.Parameters.Add("d_handung",OracleType.VarChar,4).Value=d_handung;
				cmd.Parameters.Add("d_losx",OracleType.VarChar,20).Value=d_losx;
				cmd.Parameters.Add("d_soluong",OracleType.Number).Value=d_soluong;
				cmd.Parameters.Add("d_sotien",OracleType.Number).Value=d_sotien;
				cmd.Parameters.Add("d_giaban",OracleType.Number).Value=d_giaban;
				cmd.Parameters.Add("d_giamua",OracleType.Number).Value=d_giamua;
				cmd.Parameters.Add("d_sothe",OracleType.VarChar,20).Value=d_sothe;
				cmd.Parameters.Add("d_namsx",OracleType.Number).Value=d_namsx;
				cmd.Parameters.Add("d_namsd",OracleType.Number).Value=d_namsd;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_thucxuat");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public void updrec_xuatsdct(string tt,DataTable dt,int stt,long sttt,string doituong,int mabd,string ma,string ten,string tenhc,string dang,string tenkho,string tennguon,string tennhomcc,string handung,string losx,decimal soluong,decimal dongia,decimal sotien,decimal giaban,decimal giamua,int madoituong,int makho,int manguon,int nhomcc,string ngay,int sttduyet,int tutruc,DataTable dtton)
		{
			string exp="stt="+stt;
			DataRow r = getrowbyid (dt,exp); 
			if ( r == null )
			{
				DataRow nrow = dt.NewRow ( ) ;
				nrow["stt"] = stt;
				nrow["sttt"] = sttt;
				nrow["doituong"] = doituong;
				nrow["mabd"] = mabd;
				nrow["ma"] = ma;
				nrow["ten"] = ten;
				nrow["tenhc"] = tenhc;
				nrow["dang"] = dang;
				nrow["tenkho"] = tenkho;
				nrow["tennguon"] = tennguon;
				nrow["tennhomcc"] = tennhomcc;
				nrow["handung"] = handung;
				nrow["losx"] = losx;
				nrow["soluong"] = soluong;
				nrow["dongia"] = dongia;
				nrow["sotien"] = sotien;
				nrow["giaban"]=giaban;
				nrow["giamua"]=giamua;
				nrow["madoituong"] = madoituong;
				nrow["makho"] = makho;
				nrow["manguon"] = manguon;
				nrow["nhomcc"] = nhomcc;
				nrow["ngay"]=ngay;
				nrow["sttduyet"]=sttduyet;
				nrow["tutruc"]=tutruc;
				dt.Rows.Add ( nrow ) ;
				if (dtton!=null) updrec_tonkho_nguon(dtton,makho,mabd,manguon,soluong,tt);
			}
			else
			{
				DataRow[] dr = dt.Select(exp);
				if (dtton!=null)
				{
					decimal sl=decimal.Parse(dr[0]["soluong"].ToString());
					updrec_tonkho_nguon(dtton,makho,mabd,manguon,sl,"+");
					updrec_tonkho_nguon(dtton,makho,mabd,manguon,soluong,"-");
				}
				dr[0]["sttt"] = sttt;
				dr[0]["doituong"] = doituong;
				dr[0]["mabd"] = mabd;
				dr[0]["ma"] = ma;
				dr[0]["ten"] = ten;
				dr[0]["tenhc"] = tenhc;
				dr[0]["dang"] = dang;
				dr[0]["tenkho"] = tenkho;
				dr[0]["tennguon"] = tennguon;
				dr[0]["tennhomcc"] = tennhomcc;
				dr[0]["handung"] = handung;
				dr[0]["losx"] = losx;
				dr[0]["soluong"] = soluong;
				dr[0]["dongia"] = dongia;
				dr[0]["sotien"] = sotien;
				dr[0]["giaban"]=giaban;
				dr[0]["giamua"]=giamua;
				dr[0]["madoituong"] = madoituong;
				dr[0]["makho"] = makho;
				dr[0]["manguon"] = manguon;
				dr[0]["nhomcc"] = nhomcc;
				dr[0]["ngay"]=ngay;
				dr[0]["sttduyet"]=sttduyet;
				dr[0]["tutruc"]=tutruc;
			}
		}
		public void upd_tienthuoc(string tt,string mmyy,string mabn,long maql,long idkhoa,string ngay,int makp,int loai,int madoituong,int mabd,decimal soluong,decimal sotien,decimal giaban,decimal giamua,decimal id_ktcao)
		{
			string xxx=user+"d"+mmyy;
			if (mabn=="") return;
			if (tt==delete)
			{
				if (loai==1 || loai==2 || loai==4)
					execute_data("update "+xxx+".d_tienthuoc set soluong=soluong-"+soluong+",sotien=sotien-"+sotien+" where mabn='"+mabn+"' and maql="+maql+" and idkhoa="+idkhoa+" and to_char(ngay,'dd/mm/yyyy')='"+ngay+"' and makp="+makp+" and madoituong="+madoituong+" and mabd="+mabd+" and giamua="+giamua+" and id_ktcao="+id_ktcao);
				else
					execute_data("update "+xxx+".d_tienthuoc set soluong=soluong+"+soluong+",sotien=sotien+"+sotien+" where mabn='"+mabn+"' and maql="+maql+" and idkhoa="+idkhoa+" and to_char(ngay,'dd/mm/yyyy')='"+ngay+"' and makp="+makp+" and madoituong="+madoituong+" and mabd="+mabd+" and giamua="+giamua+" and id_ktcao="+id_ktcao);
			}
			else if (tt==insert)
			{
				if (loai==1 || loai==2 || loai==4)
					upd_tienthuoc(mmyy,mabn,maql,idkhoa,ngay,makp,madoituong,mabd,soluong,sotien,giaban,giamua,id_ktcao);
				else
					upd_tienthuoc(mmyy,mabn,maql,idkhoa,ngay,makp,madoituong,mabd,-soluong,-sotien,giaban,giamua,id_ktcao);
			}
		}
		public void upd_tienthuoc(string tt,string mmyy,string mabn,long maql,long idkhoa,string ngay,int makp,int loai,int madoituong,int mabd,decimal soluong,decimal sotien,decimal giaban,decimal giamua)
		{
			string xxx=user+"d"+mmyy;
			if (mabn=="") return;
			if (tt==delete)
			{
				if (loai==1 || loai==2 || loai==4)
					execute_data("update "+xxx+".d_tienthuoc set soluong=soluong-"+soluong+",sotien=sotien-"+sotien+" where mabn='"+mabn+"' and maql="+maql+" and idkhoa="+idkhoa+" and to_char(ngay,'dd/mm/yyyy')='"+ngay+"' and makp="+makp+" and madoituong="+madoituong+" and mabd="+mabd+" and giamua="+giamua);
				else
					execute_data("update "+xxx+".d_tienthuoc set soluong=soluong+"+soluong+",sotien=sotien+"+sotien+" where mabn='"+mabn+"' and maql="+maql+" and idkhoa="+idkhoa+" and to_char(ngay,'dd/mm/yyyy')='"+ngay+"' and makp="+makp+" and madoituong="+madoituong+" and mabd="+mabd+" and giamua="+giamua);
			}
			else if (tt==insert)
			{
				if (loai==1 || loai==2 || loai==4)
					//upd_tienthuoc(mmyy,mabn,maql,idkhoa,ngay,makp,madoituong,mabd,soluong,sotien,giaban,giamua);
					upd_tienthuoc(mmyy,mabn,maql,idkhoa,ngay,makp,madoituong,mabd,soluong,sotien,giaban,giamua);
				else
					upd_tienthuoc(mmyy,mabn,maql,idkhoa,ngay,makp,madoituong,mabd,-soluong,-sotien,giaban,giamua);
			}
		}
		//ThanhCuong 26/06/2012 - 
		public void upd_tienthuoc_id(string tt,string mmyy,string mabn,long maql,long idkhoa,string ngay,int makp,int loai,int madoituong,int mabd,decimal soluong,decimal sotien,decimal giaban,decimal giamua,decimal id)
		{
			string xxx=user+"d"+mmyy;
			if (mabn=="") return;
			if (tt==delete)
			{
				if (loai==1 || loai==2 || loai==4)
					execute_data("update "+xxx+".d_tienthuoc set soluong=soluong-"+soluong+",sotien=sotien-"+sotien+" where mabn='"+mabn+"' and maql="+maql+" and idkhoa="+idkhoa+" and to_char(ngay,'dd/mm/yyyy')='"+ngay+"' and makp="+makp+" and madoituong="+madoituong+" and mabd="+mabd+" and giamua="+giamua+" and id="+id);
				else
					execute_data("update "+xxx+".d_tienthuoc set soluong=soluong+"+soluong+",sotien=sotien+"+sotien+" where mabn='"+mabn+"' and maql="+maql+" and idkhoa="+idkhoa+" and to_char(ngay,'dd/mm/yyyy')='"+ngay+"' and makp="+makp+" and madoituong="+madoituong+" and mabd="+mabd+" and giamua="+giamua+" and id="+id);
			}
			else if (tt==insert)
			{
				if (loai==1 || loai==2 || loai==4)
					upd_tienthuoc1(mmyy,mabn,maql,idkhoa,ngay,makp,madoituong,mabd,soluong,sotien,giaban,giamua,id);
				else
					upd_tienthuoc1(mmyy,mabn,maql,idkhoa,ngay,makp,madoituong,mabd,-soluong,-sotien,giaban,giamua,id);
			}
		}
		//End
		public bool upd_tienthuoc(string d_mmyy,string d_mabn,long d_maql,long d_idkhoa,string d_ngay,int d_makp,int d_madoituong,int d_mabd,decimal d_soluong,decimal d_sotien,decimal d_giaban,decimal d_giamua, decimal d_id_ktcao)
		{
			string xxx=user+"d"+d_mmyy;//+".pkg_duoc.upd_tienthuoc";
			sql="update "+xxx+".d_tienthuoc set soluong=soluong+:d_soluong,sotien=sotien+:d_sotien,giaban=:d_giaban where mabn=:d_mabn and maql=:d_maql and idkhoa=:d_idkhoa and to_char(ngay,'dd/mm/yyyy')=:d_ngay and makp=:d_makp and madoituong=:d_madoituong and mabd=:d_mabd and giamua=:d_giamua and id_ktcao=:d_id_ktcao";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("d_soluong",OracleType.Number).Value=d_soluong;
				cmd.Parameters.Add("d_sotien",OracleType.Number).Value=d_sotien;
				cmd.Parameters.Add("d_giaban",OracleType.Number).Value=d_giaban;
				cmd.Parameters.Add("d_mabn",OracleType.VarChar,8).Value=d_mabn;
				cmd.Parameters.Add("d_maql",OracleType.Number).Value=d_maql;
				cmd.Parameters.Add("d_idkhoa",OracleType.Number).Value=d_idkhoa;
				cmd.Parameters.Add("d_ngay",OracleType.VarChar,10).Value=d_ngay;
				cmd.Parameters.Add("d_makp",OracleType.Number).Value=d_makp;
				cmd.Parameters.Add("d_madoituong",OracleType.Number).Value=d_madoituong;
				cmd.Parameters.Add("d_mabd",OracleType.Number).Value=d_mabd;
				cmd.Parameters.Add("d_giamua",OracleType.Number).Value=d_giamua;
				cmd.Parameters.Add("d_id_ktcao",OracleType.Number).Value=d_id_ktcao;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".d_tienthuoc(mabn,maql,idkhoa,ngay,makp,madoituong,mabd,soluong,sotien,giaban,done,giamua,id_ktcao) values (:d_mabn,:d_maql,:d_idkhoa,to_date(:d_ngay,'dd/mm/yyyy'),:d_makp,:d_madoituong,:d_mabd,:d_soluong,:d_sotien,:d_giaban,0,:d_giamua,:d_id_ktcao)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("d_mabn",OracleType.VarChar,8).Value=d_mabn;
					cmd.Parameters.Add("d_maql",OracleType.Number).Value=d_maql;
					cmd.Parameters.Add("d_idkhoa",OracleType.Number).Value=d_idkhoa;
					cmd.Parameters.Add("d_ngay",OracleType.VarChar,10).Value=d_ngay;
					cmd.Parameters.Add("d_makp",OracleType.Number).Value=d_makp;
					cmd.Parameters.Add("d_madoituong",OracleType.Number).Value=d_madoituong;
					cmd.Parameters.Add("d_mabd",OracleType.Number).Value=d_mabd;
					cmd.Parameters.Add("d_soluong",OracleType.Number).Value=d_soluong;
					cmd.Parameters.Add("d_sotien",OracleType.Number).Value=d_sotien;
					cmd.Parameters.Add("d_giaban",OracleType.Number).Value=d_giaban;
					cmd.Parameters.Add("d_giamua",OracleType.Number).Value=d_giamua;
					cmd.Parameters.Add("d_id_ktcao",OracleType.Number).Value=d_id_ktcao;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_tienthuoc");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_tienthuoc(string d_mmyy,string d_mabn,long d_maql,long d_idkhoa,string d_ngay,int d_makp,int d_madoituong,int d_mabd,decimal d_soluong,decimal d_sotien,decimal d_giaban,decimal d_giamua)
		{
			string xxx=user+"d"+d_mmyy+".pkg_duoc.upd_tienthuoc";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(xxx,con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_mabn",OracleType.VarChar,8).Value=d_mabn;
				cmd.Parameters.Add("d_maql",OracleType.Number).Value=d_maql;
				cmd.Parameters.Add("d_idkhoa",OracleType.Number).Value=d_idkhoa;
				cmd.Parameters.Add("d_ngay",OracleType.VarChar,10).Value=d_ngay;
				cmd.Parameters.Add("d_makp",OracleType.Number).Value=d_makp;
				cmd.Parameters.Add("d_madoituong",OracleType.Number).Value=d_madoituong;
				cmd.Parameters.Add("d_mabd",OracleType.Number).Value=d_mabd;
				cmd.Parameters.Add("d_soluong",OracleType.Number).Value=d_soluong;
				cmd.Parameters.Add("d_sotien",OracleType.Number).Value=d_sotien;
				cmd.Parameters.Add("d_giaban",OracleType.Number).Value=d_giaban;
				cmd.Parameters.Add("d_giamua",OracleType.Number).Value=d_giamua;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_tienthuoc");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_tienthuoc1(string d_mmyy,string d_mabn,long d_maql,long d_idkhoa,string d_ngay,int d_makp,int d_madoituong,int d_mabd,decimal d_soluong,decimal d_sotien,decimal d_giaban,decimal d_giamua,decimal d_id)
		{
			string xxx=user+"d"+d_mmyy;
			
			sql="update "+xxx+".d_tienthuoc set giaban=:d_giaban,soluong=soluong+:d_soluong,sotien=sotien+:d_sotien ";
			sql+="where mabn=:d_mabn and maql=:d_maql and idkhoa=:d_idkhoa and to_char(ngay,'dd/mm/yyyy')=:d_ngay and makp=:d_makp and madoituong=:d_madoituong and mabd=:d_mabd and giamua=:d_giamua and id=:d_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("d_giaban",OracleType.Number).Value=d_giaban;
				cmd.Parameters.Add("d_soluong",OracleType.Number).Value=d_soluong;
				cmd.Parameters.Add("d_sotien",OracleType.Number).Value=d_sotien;
				cmd.Parameters.Add("d_mabn",OracleType.VarChar,8).Value=d_mabn;
				cmd.Parameters.Add("d_maql",OracleType.Number).Value=d_maql;
				cmd.Parameters.Add("d_idkhoa",OracleType.Number).Value=d_idkhoa;
				cmd.Parameters.Add("d_ngay",OracleType.VarChar,10).Value=d_ngay;
				cmd.Parameters.Add("d_makp",OracleType.Number).Value=d_makp;
				cmd.Parameters.Add("d_madoituong",OracleType.Number).Value=d_madoituong;
				cmd.Parameters.Add("d_mabd",OracleType.Number).Value=d_mabd;
				cmd.Parameters.Add("d_giamua",OracleType.Number).Value=d_giamua;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".d_tienthuoc(mabn,maql,idkhoa,ngay,makp,madoituong,mabd,soluong,sotien,giaban,done,giamua,id) values ";
					sql+="(:d_mabn,:d_maql,:d_idkhoa,to_date(:d_ngay,'dd/mm/yyyy'),:d_makp,:d_madoituong,:d_mabd,:d_soluong,:d_sotien,:d_giaban,0,:d_giamua,:d_id)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("d_mabn",OracleType.VarChar,8).Value=d_mabn;
					cmd.Parameters.Add("d_maql",OracleType.Number).Value=d_maql;
					cmd.Parameters.Add("d_idkhoa",OracleType.Number).Value=d_idkhoa;
					cmd.Parameters.Add("d_ngay",OracleType.VarChar,10).Value=d_ngay;
					cmd.Parameters.Add("d_makp",OracleType.Number).Value=d_makp;
					cmd.Parameters.Add("d_madoituong",OracleType.Number).Value=d_madoituong;
					cmd.Parameters.Add("d_mabd",OracleType.Number).Value=d_mabd;
					cmd.Parameters.Add("d_soluong",OracleType.Number).Value=d_soluong;
					cmd.Parameters.Add("d_sotien",OracleType.Number).Value=d_sotien;
					cmd.Parameters.Add("d_giaban",OracleType.Number).Value=d_giaban;
					cmd.Parameters.Add("d_giamua",OracleType.Number).Value=d_giamua;
					cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"d_tienthuoc");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}		
			return true;
		}

		public void upd_tonkhoct_thucxuat(string tt,string mmyy,int makp,int loai,int thuoc,long stt,int makho,int manguon,int nhomcc,int mabd,string handung,string losx,decimal soluong,decimal sotien,decimal giaban,decimal giamua,decimal chietkhau)
		{
			string xxx=user+"d"+mmyy;
			if (tt==delete)
			{
				if (thuoc==1)
				{
					if (loai==1 || loai==4)
					{
						execute_data("update "+xxx+".d_tonkhoct set slxuat=slxuat-"+soluong+",stxuat=stxuat-"+sotien+" where mmyy='"+mmyy+"' and makho="+makho+" and stt="+stt);
						upd_tonkhoth(tt,mmyy,makho,mabd,manguon,soluong,"slxuat");
					}
					else if (loai==2)
					{
						execute_data("update "+xxx+".d_tutrucct set slxuat=slxuat-"+soluong+",stxuat=stxuat-"+sotien+" where mmyy='"+mmyy+"' and makp="+makp+" and makho="+makho+" and stt="+stt);
						upd_tutructh(tt,mmyy,makp,makho,mabd,manguon,soluong,"slxuat");
					}
					else
					{
						execute_data("update "+xxx+".d_tonkhoct set slnhap=slnhap-"+soluong+",stnhap=stnhap-"+sotien+" where mmyy='"+mmyy+"' and makho="+makho+" and stt="+stt);
						upd_tonkhoth(tt,mmyy,makho,mabd,manguon,soluong,"slnhap");
					}
				}
				else if (thuoc==2)
				{
					if (loai==4)
					{
						execute_data("update "+xxx+".d_tonkhoct set slxuat=slxuat-"+soluong+",stxuat=stxuat-"+sotien+" where mmyy='"+mmyy+"' and makho="+makho+" and stt="+stt);
						upd_tonkhoth(tt,mmyy,makho,mabd,manguon,soluong,"slxuat");
						execute_data("update "+xxx+".d_tutrucct set slnhap=slnhap-"+soluong+",stnhap=stnhap-"+sotien+" where mmyy='"+mmyy+"' and makp="+makp+" and makho="+makho+" and stt="+stt);
						upd_tutructh(tt,mmyy,makp,makho,mabd,manguon,soluong,"slnhap");
					}
					else if (loai==2)
					{
						execute_data("update "+xxx+".d_tutrucct set slnhap=slnhap-"+soluong+",stnhap=stnhap-"+sotien+" where mmyy='"+mmyy+"' and makp="+makp+" and makho="+makho+" and stt="+stt);
						upd_tutructh(tt,mmyy,makp,makho,mabd,manguon,soluong,"slnhap");
					}
					else if (loai==3)
					{
						execute_data("update "+xxx+".d_tonkhoct set slnhap=slnhap-"+soluong+",stnhap=stnhap-"+sotien+" where mmyy='"+mmyy+"' and makho="+makho+" and stt="+stt);
						upd_tonkhoth(tt,mmyy,makho,mabd,manguon,soluong,"slnhap");
						execute_data("update "+xxx+".d_tutrucct set slxuat=slxuat-"+soluong+",stxuat=stxuat-"+sotien+" where mmyy='"+mmyy+"' and makp="+makp+" and makho="+makho+" and stt="+stt);
						upd_tutructh(tt,mmyy,makp,makho,mabd,manguon,soluong,"slxuat");
					}
				}
			}
			else if (tt==insert)
			{
				if (thuoc==1)
				{
					if (loai==1 || loai==4)
					{
						execute_data("update "+xxx+".d_tonkhoct set slxuat=slxuat+"+soluong+",stxuat=stxuat+"+sotien+" where mmyy='"+mmyy+"' and makho="+makho+" and stt="+stt);
						upd_tonkhoth(tt,mmyy,makho,mabd,manguon,soluong,"slxuat");
					}
					else if (loai==2)
					{
						execute_data("update "+xxx+".d_tutrucct set slxuat=slxuat+"+soluong+",stxuat=stxuat+"+sotien+" where mmyy='"+mmyy+"' and makp="+makp+" and makho="+makho+" and stt="+stt);
						upd_tutructh(tt,mmyy,makp,makho,mabd,manguon,soluong,"slxuat");
					}
					else
					{
						upd_tonkhoct(mmyy,makho,manguon,nhomcc,stt,mabd,handung,losx,soluong,sotien,giaban,giamua,"slnhap","stnhap");
						upd_tonkhoth(tt,mmyy,makho,mabd,manguon,soluong,"slnhap");
					}
				}
				else if (thuoc==2)
				{
					if (loai==4)
					{
						upd_tonkhoct(mmyy,makho,manguon,nhomcc,stt,mabd,handung,losx,soluong,sotien,giaban,giamua,"slxuat","stxuat");
						upd_tonkhoth(tt,mmyy,makho,mabd,manguon,soluong,"slxuat");
						upd_tutrucct(mmyy,makp,makho,manguon,nhomcc,stt,mabd,handung,losx,soluong,sotien,giaban,giamua,"slnhap","stnhap");
						upd_tutructh(tt,mmyy,makp,makho,mabd,manguon,soluong,"slnhap");
					}
					else if (loai==2)
					{
						upd_tutrucct(mmyy,makp,makho,manguon,nhomcc,stt,mabd,handung,losx,soluong,sotien,giaban,giamua,"slnhap","stnhap");
						upd_tutructh(tt,mmyy,makp,makho,mabd,manguon,soluong,"slnhap");
					}
					else if (loai==3)
					{
						upd_tutrucct(mmyy,makp,makho,manguon,nhomcc,stt,mabd,handung,losx,soluong,sotien,giaban,giamua,"slxuat","stxuat");
						upd_tutructh(tt,mmyy,makp,makho,mabd,manguon,soluong,"slxuat");
						upd_tonkhoct(mmyy,makho,manguon,nhomcc,stt,mabd,handung,losx,soluong,sotien,giaban,giamua,"slnhap","stnhap");
						upd_tonkhoth(tt,mmyy,makho,mabd,manguon,soluong,"slnhap");
						if (get_data("select * from "+xxx+".d_theodoi where id="+stt).Tables[0].Rows.Count==0)
							upd_theodoi(mmyy,stt,mabd,manguon,nhomcc,handung,losx,"",0,0,0,0,0,giamua,giaban,chietkhau);
					}
				}
			}
		}

		public bool upd_tutrucct(string d_mmyy,int d_makp,int d_makho,int d_manguon,int d_nhomcc,long d_stt,int d_mabd,string d_handung,string d_losx,decimal d_tondau,decimal d_sttondau,decimal d_giaban,decimal d_giamua)
		{
			string xxx=user+"d"+d_mmyy+".pkg_duoc.upd_tutrucct";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(xxx,con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_mmyy",OracleType.VarChar,4).Value=d_mmyy;
				cmd.Parameters.Add("d_makp",OracleType.Number).Value=d_makp;
				cmd.Parameters.Add("d_makho",OracleType.Number).Value=d_makho;
				cmd.Parameters.Add("d_manguon",OracleType.Number).Value=d_manguon;
				cmd.Parameters.Add("d_nhomcc",OracleType.Number).Value=d_nhomcc;
				cmd.Parameters.Add("d_stt",OracleType.Number).Value=d_stt;
				cmd.Parameters.Add("d_mabd",OracleType.Number).Value=d_mabd;
				cmd.Parameters.Add("d_handung",OracleType.VarChar,4).Value=d_handung;
				cmd.Parameters.Add("d_losx",OracleType.VarChar,20).Value=d_losx;
				cmd.Parameters.Add("d_tondau",OracleType.Number).Value=d_tondau;
				cmd.Parameters.Add("d_sttondau",OracleType.Number).Value=d_sttondau;
				cmd.Parameters.Add("d_giaban",OracleType.Number).Value=d_giaban;
				cmd.Parameters.Add("d_giamua",OracleType.Number).Value=d_giamua;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_tutrucct");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_tutrucct(string mmyy,int makp,int makho,int manguon,int nhomcc,long stt,int mabd,string handung,string losx,decimal soluong,decimal sotien,decimal giaban,decimal giamua,string fie1,string fie2)
		{
			string xxx=user+"d"+mmyy;
			sql="update "+xxx+".d_tutrucct set "+fie1+"="+fie1+"+:soluong,"+fie2+"="+fie2+"+:sotien,";
			sql+="manguon=:manguon,nhomcc=:nhomcc,mabd=:mabd,handung=:handung,losx=:losx,";
			sql+="giaban=:giaban,giamua=:giamua ";
			sql+="where makp=:makp and makho=:makho and stt=:stt";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("soluong",OracleType.Number).Value=soluong;
				cmd.Parameters.Add("sotien",OracleType.Number).Value=sotien;
				cmd.Parameters.Add("manguon",OracleType.Number).Value=manguon;
				cmd.Parameters.Add("nhomcc",OracleType.Number).Value=nhomcc;
				cmd.Parameters.Add("mabd",OracleType.Number).Value=mabd;
				cmd.Parameters.Add("handung",OracleType.VarChar,4).Value=handung;
				cmd.Parameters.Add("losx",OracleType.VarChar,20).Value=losx;
				cmd.Parameters.Add("giaban",OracleType.Number).Value=giaban;
				cmd.Parameters.Add("giamua",OracleType.Number).Value=giamua;
				cmd.Parameters.Add("makp",OracleType.Number).Value=makp;
				cmd.Parameters.Add("makho",OracleType.Number).Value=makho;
				cmd.Parameters.Add("stt",OracleType.Number).Value=stt;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".d_tutrucct(mmyy,manguon,nhomcc,stt,mabd,handung,losx,giaban,giamua,makp,makho,"+fie1+","+fie2+") values ";
					sql+="(:mmyy,:manguon,:nhomcc,:stt,:mabd,:handung,:losx,:giaban,:giamua,:makp,:makho,:soluong,:sotien)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("mmyy",OracleType.VarChar,4).Value=mmyy;
					cmd.Parameters.Add("manguon",OracleType.Number).Value=manguon;
					cmd.Parameters.Add("nhomcc",OracleType.Number).Value=nhomcc;
					cmd.Parameters.Add("stt",OracleType.Number).Value=stt;
					cmd.Parameters.Add("mabd",OracleType.Number).Value=mabd;
					cmd.Parameters.Add("handung",OracleType.VarChar,4).Value=handung;
					cmd.Parameters.Add("losx",OracleType.VarChar,20).Value=losx;
					cmd.Parameters.Add("giaban",OracleType.Number).Value=giaban;
					cmd.Parameters.Add("giamua",OracleType.Number).Value=giamua;
					cmd.Parameters.Add("makp",OracleType.Number).Value=makp;
					cmd.Parameters.Add("makho",OracleType.Number).Value=makho;
					cmd.Parameters.Add("soluong",OracleType.Number).Value=soluong;
					cmd.Parameters.Add("sotien",OracleType.Number).Value=sotien;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
					upd_dmbd_sudung(mabd);
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"d_tutrucct");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_tutructh(string mmyy,int makp,int makho,int manguon,int mabd,decimal soluong,string fie)
		{
			string xxx=user+"d"+mmyy;
			sql="update "+xxx+".d_tutructh set "+fie+"="+fie+"+:soluong where makp=:makp and makho=:makho and manguon=:manguon and mabd=:mabd";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("soluong",OracleType.Number).Value=soluong;
				cmd.Parameters.Add("makp",OracleType.Number).Value=makp;
				cmd.Parameters.Add("makho",OracleType.Number).Value=makho;
				cmd.Parameters.Add("manguon",OracleType.Number).Value=manguon;
				cmd.Parameters.Add("mabd",OracleType.Number).Value=mabd;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+xxx+".d_tutructh(mmyy,makp,makho,manguon,mabd,"+fie+") values ";
					sql+="(:mmyy,:makp,:makho,:manguon,:mabd,:soluong)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("mmyy",OracleType.VarChar,4).Value=mmyy;
					cmd.Parameters.Add("makp",OracleType.Number).Value=makp;
					cmd.Parameters.Add("makho",OracleType.Number).Value=makho;
					cmd.Parameters.Add("manguon",OracleType.Number).Value=manguon;
					cmd.Parameters.Add("mabd",OracleType.Number).Value=mabd;
					cmd.Parameters.Add("soluong",OracleType.Number).Value=soluong;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"d_tutructh");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}		
			return true;
		}

		public void upd_tutructh(string tt,string mmyy,int makp,int makho,int mabd,int manguon,decimal soluong,string fie)
		{
			string xxx=user+"d"+mmyy;
			if (tt==delete) execute_data("update "+xxx+".d_tutructh set "+fie+"="+fie+"-"+soluong+" where mmyy='"+mmyy+"' and makp="+makp+" and makho="+makho+" and mabd="+mabd+" and manguon="+manguon);
			else if (tt==insert) upd_tutructh(mmyy,makp,makho,manguon,mabd,soluong,fie);
		}
		public void updrec_dutrull_songay(DataTable dt,long id,string mabn,long maql,long idkhoa,string hoten,string mabs,string manv,string ngay,decimal mach,decimal nhietdo,string huyetap,decimal nhiptho,int cannang,string phong,string giuong,string ghichu,int read,decimal songay)
		{
			string exp="id="+id;
			DataRow r = getrowbyid (dt,exp); 
			if ( r == null )
			{
				DataRow nrow = dt.NewRow ( ) ;
				nrow["id"] = id;
				nrow["mabn"] = mabn;
				nrow["maql"] = maql;
				nrow["idkhoa"] = idkhoa;
				nrow["hoten"] = hoten;
				nrow["mabs"] = mabs;
				nrow["manv"] = manv;
				nrow["ngay"] = ngay;
				nrow["mach"] = mach;
				nrow["nhietdo"] = nhietdo;
				nrow["huyetap"] = huyetap;
				nrow["nhiptho"] = nhiptho;
				nrow["cannang"] = cannang;
				nrow["phong"] = phong;
				nrow["giuong"] = giuong;
				nrow["ghichu"] = ghichu;
				nrow["read"]=read;
				nrow["songay"]=songay;
				dt.Rows.Add ( nrow ) ;
			}
			else
			{
				DataRow[] dr = dt.Select(exp);
				dr[0]["mabn"] = mabn;
				dr[0]["maql"] = maql;
				dr[0]["idkhoa"] = idkhoa;
				dr[0]["hoten"] = hoten;
				dr[0]["mabs"] = mabs;
				dr[0]["manv"] = manv;
				dr[0]["ngay"] = ngay;
				dr[0]["mach"] = mach;
				dr[0]["nhietdo"] = nhietdo;
				dr[0]["huyetap"] = huyetap;
				dr[0]["nhiptho"] = nhiptho;
				dr[0]["cannang"] = cannang;
				dr[0]["phong"] = phong;
				dr[0]["giuong"] = giuong;
				dr[0]["ghichu"] = ghichu;
				dr[0]["read"]=read;
				dr[0]["songay"]=songay;
			}
		}

		public void updrec_dutruct_ghichu_tt(string tt,DataTable dt,int stt,string doituong,int mabd,string ma,string ten,string tenhc,string dang,string tenkho,decimal soluong,int madoituong,int makho,string cachdung,string mahc,int manguon,int tutruc,long idvpkhoa,DataTable dtton,string ghichu,decimal slylenh,decimal sott,int ngoai,int choduyet, int hoichan,int songaythuoc)
		{
			string exp="stt="+stt;
			DataRow r = getrowbyid (dt,exp); 
			if ( r == null )
			{
				DataRow nrow = dt.NewRow ( ) ;
				nrow["stt"] = stt;
				nrow["tt"]=sott;
				nrow["ngoai"]=ngoai;
				nrow["doituong"] = doituong;
				nrow["mabd"] = mabd;
				nrow["ma"] = ma;
				nrow["ten"] = ten;
				nrow["tenhc"] = tenhc;
				nrow["dang"] = dang;
				nrow["tenkho"] = tenkho;
				nrow["soluong"] = soluong;
				nrow["madoituong"] = madoituong;
				nrow["makho"] = makho;
				nrow["cachdung"]=cachdung;
				nrow["mahc"]=mahc;
				nrow["manguon"]=manguon;
				nrow["tutruc"]=tutruc;
				nrow["idvpkhoa"]=idvpkhoa;
				nrow["ghichu"]=ghichu;
				nrow["slylenh"]=slylenh;
				nrow["choduyet"]=choduyet;
				nrow["hoichan"]=hoichan;
				nrow["ngaythuoc"]=songaythuoc;
				dt.Rows.Add ( nrow ) ;
				if (dtton!=null && idvpkhoa==0 && ngoai==0) updrec_tonkho_tutruc(dtton,makho,mabd,tutruc,soluong,tt);
			}
			else
			{
				DataRow[] dr = dt.Select(exp);
				if (dtton!=null && idvpkhoa==0 && ngoai==0)
				{
					decimal sl=decimal.Parse(dr[0]["soluong"].ToString());
					updrec_tonkho_tutruc(dtton,makho,mabd,tutruc,sl,"+");
					updrec_tonkho_tutruc(dtton,makho,mabd,tutruc,soluong,"-");
				}
				dr[0]["doituong"] = doituong;
				dr[0]["mabd"] = mabd;
				dr[0]["ma"] = ma;
				dr[0]["ten"] = ten;
				dr[0]["tenhc"] = tenhc;
				dr[0]["dang"] = dang;
				dr[0]["tenkho"] = tenkho;
				dr[0]["soluong"] = soluong;
				dr[0]["madoituong"] = madoituong;
				dr[0]["makho"] = makho;
				dr[0]["cachdung"]=cachdung;
				dr[0]["mahc"]=mahc;
				dr[0]["manguon"]=manguon;
				dr[0]["tutruc"]=tutruc;
				dr[0]["idvpkhoa"]=idvpkhoa;
				dr[0]["ghichu"]=ghichu;
				dr[0]["slylenh"]=slylenh;
				dr[0]["tt"]=sott;
				dr[0]["ngoai"]=ngoai;
				dr[0]["choduyet"]=choduyet;
				dr[0]["hoichan"]=hoichan;
				dr[0]["ngaythuoc"]=songaythuoc;
			}
		}

		public void updrec_dutruct_ghichu(string tt,DataTable dt,int stt,string doituong,int mabd,string ma,string ten,string tenhc,string dang,string tenkho,decimal soluong,int madoituong,int makho,string cachdung,string mahc,int manguon,int tutruc,long idvpkhoa,DataTable dtton,string ghichu,decimal slylenh)
		{
			string exp="stt="+stt;
			DataRow r = getrowbyid (dt,exp); 
			if ( r == null )
			{
				DataRow nrow = dt.NewRow ( ) ;
				nrow["stt"] = stt;
				nrow["doituong"] = doituong;
				nrow["mabd"] = mabd;
				nrow["ma"] = ma;
				nrow["ten"] = ten;
				nrow["tenhc"] = tenhc;
				nrow["dang"] = dang;
				nrow["tenkho"] = tenkho;
				nrow["soluong"] = soluong;
				nrow["madoituong"] = madoituong;
				nrow["makho"] = makho;
				nrow["cachdung"]=cachdung;
				nrow["mahc"]=mahc;
				nrow["manguon"]=manguon;
				nrow["tutruc"]=tutruc;
				nrow["idvpkhoa"]=idvpkhoa;
				nrow["ghichu"]=ghichu;
				nrow["slylenh"]=slylenh;
				dt.Rows.Add ( nrow ) ;
				if (dtton!=null && idvpkhoa==0) updrec_tonkho_tutruc(dtton,makho,mabd,tutruc,soluong,tt);
			}
			else
			{
				DataRow[] dr = dt.Select(exp);
				if (dtton!=null && idvpkhoa==0)
				{
					decimal sl=decimal.Parse(dr[0]["soluong"].ToString());
					updrec_tonkho_tutruc(dtton,makho,mabd,tutruc,sl,"+");
					updrec_tonkho_tutruc(dtton,makho,mabd,tutruc,soluong,"-");
				}
				dr[0]["doituong"] = doituong;
				dr[0]["mabd"] = mabd;
				dr[0]["ma"] = ma;
				dr[0]["ten"] = ten;
				dr[0]["tenhc"] = tenhc;
				dr[0]["dang"] = dang;
				dr[0]["tenkho"] = tenkho;
				dr[0]["soluong"] = soluong;
				dr[0]["madoituong"] = madoituong;
				dr[0]["makho"] = makho;
				dr[0]["cachdung"]=cachdung;
				dr[0]["mahc"]=mahc;
				dr[0]["manguon"]=manguon;
				dr[0]["tutruc"]=tutruc;
				dr[0]["idvpkhoa"]=idvpkhoa;
				dr[0]["ghichu"]=ghichu;
				dr[0]["slylenh"]=slylenh;
			}
		}
		public bool bTinnhan(int d_nhom)
		{
			ds=get_data("select ten from d_thongso where id=111 and nhom="+d_nhom);
			if (ds.Tables[0].Rows.Count==0) return false;
			return ds.Tables[0].Rows[0][0].ToString()=="1";
		}
		public string sDomain(int d_nhom)
		{
			ds=get_data("select ten from d_thongso where id=112 and nhom="+d_nhom);
			if (ds.Tables[0].Rows.Count==0) return System.Environment.UserDomainName;
			return ds.Tables[0].Rows[0][0].ToString().Trim();
		}

		public void del_dangduyet(int d_nhom,string d_tu,string d_den,int d_loai,int d_makp)
		{
			execute_data("delete from d_dangduyet where nhom="+d_nhom+" and tu='"+d_tu+"' and den='"+d_den+"' and loai="+d_loai+" and makp="+d_makp);
		}

		public DataSet get_dangduyet(int d_nhom,string d_tu,int d_loai)
		{
			return get_data("select a.computer,b.ten from d_dangduyet a,d_duockp b where a.makp=b.id(+) and a.nhom="+d_nhom+" and a.tu='"+d_tu.Substring(0,10)+"' and a.loai="+d_loai+" and to_char(a.ngayud,'dd/mm/yyyy')='"+ngayhienhanh_server.Substring(0,10)+"'");
		}

		public DataSet get_dangduyet(int d_nhom,string d_tu,int d_loai,int d_makp)
		{
			return get_data("select a.computer,b.ten from d_dangduyet a,d_duockp b where a.makp=b.id(+) and a.nhom="+d_nhom+" and a.tu='"+d_tu.Substring(0,10)+"' and a.loai="+d_loai+" and a.makp="+d_makp+" and to_char(a.ngayud,'dd/mm/yyyy')='"+ngayhienhanh_server.Substring(0,10)+"'");
		}
		public void upd_duyet(int i_makp,int i_nhom,int i_loai,int i_phieu,string s_ngay,string s_makho,bool buhaophi)
		{
			string tenfile="d_dutrull";
			if (i_loai==4 || buhaophi) tenfile="d_haophill";
			else
			{
				switch (i_loai)
				{
					case 2: tenfile="d_xtutrucll";break;
					case 3: tenfile="d_hoantrall";break;
				}
			}
			sql="select distinct a.idduyet from "+tenfile+" a,d_ngayduyet b where a.id=b.idduyet and b.nhom="+i_nhom+" and b.loai="+i_loai+" and b.phieu="+i_phieu+" and b.makp="+i_makp+" and to_char(b.ngay,'dd/mm/yyyy')='"+s_ngay+"'";
			if (s_makho!="") sql+=" and b.makho='"+s_makho+"'";
			foreach(DataRow r in get_data(sql).Tables[0].Rows)
			{
				execute_data("update d_duyet set done=1 where id="+long.Parse(r["idduyet"].ToString()));
				if (s_makho == "") execute_data("update d_duyetkho set done=1 where idduyet=" + long.Parse(r["idduyet"].ToString()));
				else
				{
					foreach(DataRow r1 in get_data("select * from d_dmkho where id in ("+s_makho.Substring(0,s_makho.Length-1)+")").Tables[0].Rows)
						execute_data("update d_duyetkho set done=1 where idduyet=" + long.Parse(r["idduyet"].ToString())+" and makho="+int.Parse(r1["id"].ToString()));
				}
			}
			sql="delete from d_ngayduyet where nhom="+i_nhom+" and loai="+i_loai+" and phieu="+i_phieu+" and makp="+i_makp+" and to_char(ngay,'dd/mm/yyyy')='"+s_ngay+"'";
			if (s_makho!="") sql+=" and makho='"+s_makho+"'";
			execute_data(sql);
		}

		public bool get_duyet(int i_makp,int i_nhom,int i_loai,int i_phieu,string s_ngay,string s_makho)
		{
			sql="select * from d_ngayduyet where nhom="+i_nhom+" and loai="+i_loai+" and phieu="+i_phieu+" and makp="+i_makp+" and to_char(ngay,'dd/mm/yyyy')='"+s_ngay+"'";
			if (s_makho!="") sql+=" and makho='"+s_makho+"'";
			return get_data(sql).Tables[0].Rows.Count>0;
		}

		public void upd_theodoiduyet(string ngay,int nhom,int loai,int makp,int done) 
		{
			if (done==1) upd_theodoiduyet(nhom,ngay,loai,makp);
			else execute_data("delete from d_theodoiduyet where nhom="+nhom+" and to_char(ngay,'dd/mm/yyyy')='"+ngay+"' and loai="+loai+" and makp="+makp);
		}

		public bool upd_theodoiduyet(int nhom,string ngay,int loai,int makp)
		{
			sql="update d_theodoiduyet set nhom=:nhom where nhom=:nhom and to_char(ngay,'dd/mm/yyyy')=:ngay and loai=:loai and makp=:makp";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("nhom",OracleType.Number).Value=nhom;
				cmd.Parameters.Add("nhom",OracleType.Number).Value=nhom;
				cmd.Parameters.Add("ngay",OracleType.VarChar,10).Value=ngay;
				cmd.Parameters.Add("loai",OracleType.Number).Value=loai;
				cmd.Parameters.Add("makp",OracleType.Number).Value=makp;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into d_theodoiduyet(nhom,ngay,loai,makp) values ";
					sql+="(:nhom,to_date(:ngay,'dd/mm/yyyy'),:loai,:makp)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("nhom",OracleType.Number).Value=nhom;
					cmd.Parameters.Add("ngay",OracleType.VarChar,10).Value=ngay;
					cmd.Parameters.Add("loai",OracleType.Number).Value=loai;
					cmd.Parameters.Add("makp",OracleType.Number).Value=makp;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"d_theodoiduyet");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}		
			return true;
		}
		public void netsend(string domain,string computer,string message)
		{
			string filerun=@"net";
			string arg=" send /domain:"+domain+" "+computer+":"+message;
			run f=new run(filerun,arg,true);
			f.Launch();
		}
		public DataTable get_duyet(int i_nhom,int i_loai,int i_phieu,string s_ngay,int i_makp,string s_tenkp,
			string s_mmyy,string s_kho,bool bBuhaophi,bool bThua,int i_thuoc,bool bCongdon,bool bTutrucchung,
			bool bTaisan,bool bHaophi,string makho_auto_duyet)
		{
			if (makho_auto_duyet!="")
			{
				s_kho=makho_auto_duyet;
				if (s_kho.Substring(s_kho.Length-1,1)!=",") s_kho+=",";
			}
			string file1,file2;
			bool bSlthuc_yeucau,_bPhattron,_bBucstt_tronso,_bBucstt_nguon,bSolan=false,bCstt=bcstt_linh(i_nhom);
			if (bBuhaophi)
			{
				file1="d_haophill";file2="d_haophict";
			}
			else
			{
				switch (i_loai)
				{
					case 1: file1="d_dutrull";file2="d_dutruct";
						break;
					case 2: file1="d_xtutrucll";file2="d_xtutrucct";
						break;
					case 3: file1="d_hoantrall";file2="d_hoantract";
						break;
					default: file1="d_haophill";file2="d_haophict";
						break;
				}
			}
			bSlthuc_yeucau=bSLDuyet_nho_yeucau(i_nhom);
			_bPhattron=bPhattron(i_nhom);
			_bBucstt_tronso=bBucstt_tronso(i_nhom);
			_bBucstt_nguon=bBucstt_nguon(i_nhom);
			//if (i_loai==1) bSolan=bSolan_linhthuoc(i_nhom);
			if (i_loai==4 || bBuhaophi) //hao phi
			{
				sql="select a.id,trim(a.sophieu)||'/'||trim(c.makp) mabn,'"+s_tenkp+"' hoten,0 maql,0 idkhoa,f.doituong,g.ten tenkho,d.ma,";
				sql+="trim(d.ten)||' '||d.hamluong ten,nvl(d.tenhc,' ') tenhc,d.dang,b.slyeucau-b.slthuc soluong,b.slyeucau-b.slthuc soluongcu,b.slyeucau-b.slthuc soluongyc,0001.00 sltd,";
				sql+="b.madoituong,b.makho,b.mabd,c.makp,c.makhoa,c.phieu,b.stt,a.idduyet,b.manguon,h.ten tennguon,b.tutruc,'xx/xx/xxxx' ngay,0000000.00 coso,0000000.00 ton,d.phatsau,d.hamluong";
				sql+=",d.dongia as giamua,d.giaban,'0000' handung,' ' losx,0 as tt,' ' as tu,' ' as den,0 as sttt,to_char(d.bhyt) as bhyt,i.ten as tennhom,0 as solan,'"+s_ngay+"' as ngayvv,0 as treo";
				sql+=" from "+file1+" a,"+file2+" b,d_duyet c,d_dmbd d,d_doituong f,d_dmkho g,d_dmnguon h,d_dmnhom i";
				sql+=" where a.id=b.id and a.idduyet=c.id and b.mabd=d.id and b.madoituong=f.madoituong and b.makho=g.id and b.manguon=h.id and d.manhom=i.id";
				sql+=" and c.done<>0 and b.slyeucau>b.slthuc and c.nhom="+i_nhom+" and c.loai in (2,4) ";
				if (bTutrucchung) sql+=" and c.makp="+i_makp;
				else sql+=" and c.makhoa="+i_makp;
				sql+=" and to_char(c.ngay,'dd/mm/yyyy')='"+s_ngay+"'";
				if (s_kho!="") sql+=" and b.makho in ("+s_kho.Substring(0,s_kho.Length-1)+")";
				if (bBuhaophi) sql+=" and b.tutruc=1";
				else sql+=" and b.tutruc=0";
				sql+=" and c.phieu="+i_phieu;
				sql+=" order by c.makp,a.id,b.stt";
			}
			else
			{
				sql="";
				if (i_loai==2 && _bBucstt_tronso)
				{
					sql=" select a.id,a.mabn,e.hoten,a.maql,a.idkhoa,f.doituong,g.ten tenkho,d.ma,";
					sql+=" trim(d.ten)||' '||d.hamluong ten,nvl(d.tenhc,' ') tenhc,d.dang,b.slyeucau-b.slthuc soluong,b.slyeucau-b.slthuc soluongcu,b.slyeucau-b.slthuc soluongyc,0001.00 sltd,";
					sql+=" b.madoituong,b.makho,b.mabd,c.makp,c.makhoa,c.phieu,b.stt,a.idduyet,b.manguon,h.ten tennguon,0 as tutruc,'xx/xx/xxxx' ngay,0000000.00 coso,0000000.00 ton,d.phatsau,d.hamluong";
					sql+=",d.dongia as giamua,d.giaban,'0000' handung,' ' losx,0 as tt,to_char(c.ngay,'dd/mm') as tu,to_char(c.ngay+decode(a.songay,0,1,a.songay)-1,'dd/mm') as den,0 as sttt,to_char(d.bhyt) as bhyt,i.ten as tennhom,0 as solan,'"+s_ngay+"' as ngayvv,1 as treo";
					sql+=" from d_xtutrucll a,d_treoduyet b,d_duyet c,d_dmbd d,btdbn e,d_doituong f,d_dmkho g,d_dmnguon h,d_dmnhom i";
					sql+=" where a.id=b.id and a.idduyet=c.id and b.mabd=d.id and a.mabn=e.mabn and b.madoituong=f.madoituong and b.makho=g.id and b.manguon=h.id and d.manhom=i.id";
					sql+=" and c.done<>0 and b.slyeucau>b.slthuc and c.nhom="+i_nhom;
					sql+=" and a.maql<>0";
					if (bTutrucchung) sql+=" and c.makp="+i_makp;
					else sql+=" and c.makhoa="+i_makp;
					sql+=" union all ";
				}
				sql+=" select a.id,";
				if (bThua || i_thuoc==2 || bTaisan) sql+=" trim(a.mabn)||'/'||trim(c.makp) mabn,'"+s_tenkp+"' hoten,";
				else sql+=" a.mabn,e.hoten hoten,";
				sql+="a.maql,a.idkhoa,f.doituong,g.ten tenkho,d.ma,";
				sql+="trim(d.ten)||' '||d.hamluong ten,nvl(d.tenhc,' ') tenhc,d.dang,b.slyeucau-b.slthuc soluong,b.slyeucau-b.slthuc soluongcu,b.slyeucau-b.slthuc soluongyc,0001.00 sltd,";
				sql+="b.madoituong,b.makho,b.mabd,c.makp,c.makhoa,c.phieu,b.stt,a.idduyet,b.manguon,h.ten tennguon,0 tutruc,";
				if (i_loai==3) sql+="to_char(b.ngay,'dd/mm/yyyy') ngay ";
				else sql+="'xx/xx/xxxx' ngay ";
				sql+=",0000000.00 coso,0000000.00 ton,d.phatsau,d.hamluong";
				sql+=",d.dongia as giamua,d.giaban,'0000' handung,' ' losx,0 as tt";
				if (i_loai==3) sql+=",' ' as tu,' ' as den,b.sttt";
				else sql+=",to_char(c.ngay,'dd/mm') as tu,to_char(c.ngay+decode(a.songay,0,1,a.songay)-1,'dd/mm') as den,0 as sttt";
				sql+=",to_char(d.bhyt) as bhyt,i.ten as tennhom,0 as solan,";
				if (bSolan) sql+="to_char(j.ngay,'dd/mm/yyyy') as ngayvv,0 as treo";
				else sql+="'"+s_ngay+"' as ngayvv,0 as treo";
				sql+=" from "+file1+" a,"+file2+" b,d_duyet c,d_dmbd d,btdbn e,d_doituong f,d_dmkho g,d_dmnguon h,d_dmnhom i";
				if (bSolan) sql+=",benhandt j";
				sql+=" where a.id=b.id and a.idduyet=c.id and b.mabd=d.id ";
				if (bSolan) sql+=" and a.maql=j.maql ";
				if (bThua || i_thuoc==2 || bTaisan || bHaophi) sql+=" and a.mabn=e.mabn(+) and a.maql=0";
				else sql+=" and a.mabn=e.mabn and a.maql<>0";
				sql+=" and b.madoituong=f.madoituong and b.makho=g.id and b.manguon=h.id and d.manhom=i.id";
				sql+=" and c.done<>0 and b.slyeucau>b.slthuc and c.nhom="+i_nhom+" and c.loai="+i_loai;
				if (bTutrucchung) sql+=" and c.makp="+i_makp;
				else sql+=" and c.makhoa="+i_makp;
				sql+=" and to_char(c.ngay,'dd/mm/yyyy')='"+s_ngay+"'";
				if (s_kho!="") sql+=" and b.makho in ("+s_kho.Substring(0,s_kho.Length-1)+")";
				if (i_loai==1) sql+=" and b.tutruc=0";
				sql+=" and c.phieu="+i_phieu;
				if (i_loai!=2) sql+=" order by a.mabn,a.id,b.stt";
				if (i_loai==2 && bCstt) //lay tutruc -> du tru
				{
					sql+=" and b.idvpkhoa=0";
					sql+=" union all select a.id,a.mabn,e.hoten,a.maql,a.idkhoa,f.doituong,g.ten tenkho,d.ma,";
					sql+=" trim(d.ten)||' '||d.hamluong ten,nvl(d.tenhc,' ') tenhc,d.dang,b.slyeucau-b.slthuc soluong,b.slyeucau-b.slthuc soluongcu,b.slyeucau-b.slthuc soluongyc,0001.00 sltd,";
					sql+=" b.madoituong,b.makho,b.mabd,c.makp,c.makhoa,c.phieu,b.stt,a.idduyet,b.manguon,h.ten tennguon,b.tutruc,'xx/xx/xxxx' ngay,0000000.00 coso,0000000.00 ton,d.phatsau,d.hamluong";
					sql+=",d.dongia as giamua,d.giaban,'0000' handung,' ' losx,0 as tt,to_char(c.ngay,'dd/mm') as tu,to_char(c.ngay+decode(a.songay,0,1,a.songay)-1,'dd/mm') as den,0 as sttt,to_char(d.bhyt) as bhyt,i.ten as tennhom,0 as solan,'"+s_ngay+"' as ngayvv,0 as treo";
					sql+=" from d_dutrull a,d_dutruct b,d_duyet c,d_dmbd d,btdbn e,d_doituong f,d_dmkho g,d_dmnguon h,d_dmnhom i";
					sql+=" where a.id=b.id and a.idduyet=c.id and b.mabd=d.id and a.mabn=e.mabn and b.madoituong=f.madoituong and b.makho=g.id and b.manguon=h.id and d.manhom=i.id";
					sql+=" and c.done<>0 and b.slyeucau>b.slthuc and b.tutruc=1 and c.nhom="+i_nhom+" and c.loai=1 ";
					if (bTutrucchung) sql+=" and c.makp="+i_makp;
					else sql+=" and c.makhoa="+i_makp;
					sql+=" and a.maql<>0";
					sql+=" and to_char(c.ngay,'dd/mm/yyyy')='"+s_ngay+"'";
					if (s_kho!="") sql+=" and b.makho in ("+s_kho.Substring(0,s_kho.Length-1)+")";
					sql+=" and c.phieu="+i_phieu;
				}
			}
			DataTable dt=new DataTable();
			DataTable dtct=new DataTable();
			DataTable dtton=new DataTable();
			dt=get_data(sql).Tables[0];
			if (i_loai==3 && i_thuoc==2) dtton=get_tutructh_duyet(s_mmyy,s_kho,i_makp);
			else dtton=get_tonkhoth_duyet(s_mmyy,s_kho);
			if (bCongdon)
			{
				dtct=dt.Copy();
				dt.Clear();
				DataRow r2,r3;
				DataRow [] dr;
				foreach(DataRow r4 in dtct.Rows)
				{
					sql="makho="+int.Parse(r4["makho"].ToString())+" and mabd="+int.Parse(r4["mabd"].ToString());
					if (_bBucstt_nguon) sql+=" and manguon="+int.Parse(r4["manguon"].ToString());
					if (!bPhattron_congdondoituong(i_nhom)) sql+=" and madoituong="+int.Parse(r4["madoituong"].ToString());
					r2=getrowbyid(dt,sql);
					if (r2==null)
					{
						r3=dt.NewRow();
						r3["makho"]=r4["makho"].ToString();
						r3["tenkho"]=r4["tenkho"].ToString();
						r3["makp"]=r4["makp"].ToString();
						r3["makhoa"]=r4["makhoa"].ToString();
						r3["manguon"]=r4["manguon"].ToString();
						r3["tennguon"]=r4["tennguon"].ToString();
						r3["mabd"]=r4["mabd"].ToString();
						r3["ma"]=r4["ma"].ToString();
						r3["ten"]=r4["ten"].ToString();
						r3["tenhc"]=r4["tenhc"].ToString();
						r3["dang"]=r4["dang"].ToString();
						r3["madoituong"]=r4["madoituong"].ToString();
						r3["tutruc"]=r4["tutruc"].ToString();
						r3["coso"]=r4["coso"].ToString();
						r3["ton"]=r4["ton"].ToString();
						r3["phatsau"]=r4["phatsau"].ToString();
						r3["soluong"]=r4["soluong"].ToString();
						r3["ngay"]=r4["ngay"].ToString();
						r3["sltd"]=r4["sltd"].ToString();
						r3["soluongcu"]=r4["soluongcu"].ToString();
						r3["soluongyc"]=r4["soluongyc"].ToString();
						r3["giamua"]=r4["giamua"].ToString();
						r3["giaban"]=r4["giaban"].ToString();
						r3["handung"]=r4["handung"].ToString();
						r3["losx"]=r4["losx"].ToString();
						r3["bhyt"]=r4["bhyt"].ToString();
						r3["tennhom"]=r4["tennhom"].ToString();
						dt.Rows.Add(r3);
					}
					else
					{
						dr=dt.Select(sql);
						if (dr.Length>0)
						{
							dr[0]["soluong"]=decimal.Parse(dr[0]["soluong"].ToString())+decimal.Parse(r4["soluong"].ToString());
							dr[0]["soluongcu"]=decimal.Parse(dr[0]["soluongcu"].ToString())+decimal.Parse(r4["soluongcu"].ToString());
							dr[0]["soluongyc"]=decimal.Parse(dr[0]["soluongyc"].ToString())+decimal.Parse(r4["soluongyc"].ToString());
						}
					}
				}
			}
			dt.Columns.Add("Chon",typeof(bool));
			DataRow r,r1;
			int tt=1;
			decimal _soluong=0,d_soluongcu,d_soluongton,d_soluong;
			int i_mabd,i_makho,i_manguon;
			foreach (DataRow row in dt.Rows)
			{
				if (row["phatsau"].ToString()=="1") row["chon"]=true;
				else row["chon"]=false;
				row["tt"]=tt++;
				//				if (i_loai==2 || bBuhaophi)
				//				{
				//					r=getrowbyid(dtcstt,"makp="+i_makp+" and mabd="+int.Parse(row["mabd"].ToString()));
				//					if (r!=null) row["coso"]=r["soluong"].ToString();
				//				}
				#region kiem tra ton kho
				if ((i_loai==3 && i_thuoc==1)==false)
				{
					d_soluong=decimal.Parse(row["soluong"].ToString());
					i_mabd=int.Parse(row["mabd"].ToString());
					i_makho=int.Parse(row["makho"].ToString());
					i_manguon=int.Parse(row["manguon"].ToString());
					if (i_loai==1 || i_loai==2 || bBuhaophi)
					{
						sql="soluong>"+d_soluong+" and makho="+i_makho+" and id="+i_mabd;
						sql+=" and manguon="+i_manguon;
						r=getrowbyid(dtton,sql);
						if (r==null)
						{
							sql="soluong>="+d_soluong+" and makho="+i_makho+" and ten='"+row["ten"].ToString()+"' and dang='"+row["dang"].ToString()+"' and hamluong='"+row["hamluong"].ToString()+"'";
							if (_bBucstt_nguon) sql+=" and manguon="+i_manguon;
							r1=getrowbyid(dtton,sql);
							if (r1!=null)
							{
								row["mabd"]=r1["id"].ToString();
								row["ten"]=r1["ten"].ToString();
								row["dang"]=r1["dang"].ToString();
								row["manguon"]=r1["manguon"].ToString();
								i_mabd=int.Parse(row["mabd"].ToString());
								i_manguon=int.Parse(row["manguon"].ToString());
							}
							else //tuong duong
							{
								bool bFound=false;
								foreach(DataRow r2 in get_data("select mabd,soluong from d_dmbdtd where id="+int.Parse(row["mabd"].ToString())).Tables[0].Rows)
								{
									d_soluong=decimal.Parse(row["soluong"].ToString())*decimal.Parse(r2["soluong"].ToString());
									sql="makho="+i_makho+" and id="+int.Parse(r2["mabd"].ToString())+" and soluong>="+d_soluong;
									if (_bBucstt_nguon) sql+=" and manguon="+i_manguon;
									r1=getrowbyid(dtton,sql);
									if (r1!=null)
									{
										row["mabd"]=r1["id"].ToString();
										row["ten"]=r1["ten"].ToString();
										row["dang"]=r1["dang"].ToString();
										row["manguon"]=r1["manguon"].ToString();
										row["soluong"]=d_soluong;
										row["sltd"]=r2["soluong"].ToString();
										i_mabd=int.Parse(row["mabd"].ToString());
										i_manguon=int.Parse(row["manguon"].ToString());
										bFound=true;
										break;
									}
								}
								//hoatchat - hamluong - dvt 
								if (!bFound && row["tenhc"].ToString()!="")
								{
									d_soluong=decimal.Parse(row["soluong"].ToString());
									sql="soluong>="+d_soluong+" and makho="+i_makho+" and tenhc='"+row["tenhc"].ToString()+"'"+" and dang='"+row["dang"].ToString()+"' and hamluong='"+row["hamluong"].ToString()+"'";
									if (_bBucstt_nguon) sql+=" and manguon="+i_manguon;
									r1=getrowbyid(dtton,sql);
									if (r1!=null)
									{
										row["mabd"]=r1["id"].ToString();
										row["ten"]=r1["ten"].ToString();
										row["dang"]=r1["dang"].ToString();
										row["manguon"]=r1["manguon"].ToString();
										i_mabd=int.Parse(row["mabd"].ToString());
										i_manguon=int.Parse(row["manguon"].ToString());
									}
								}
							}
						}
					}
					d_soluongcu=0;
					d_soluongton=get_slton_nguon(dtton,i_makho,i_mabd,i_manguon,d_soluongcu);
					if (d_soluong>d_soluongton) row["soluong"]=Math.Max(d_soluongton,0);
					updrec_tonkho_nguon(dtton,i_makho,i_mabd,i_manguon,d_soluong-d_soluongcu,"-");
					dtton.AcceptChanges();
					if (row["soluong"].ToString().Trim()=="0") row["chon"]=true;
					r=getrowbyid(dtton,"makho="+i_makho+" and manguon="+i_manguon+" and id="+i_mabd);
					if (r!=null) row["ton"]=r["soluong"].ToString();
				}
				#endregion
				if (bSolan)
				{
					_soluong=0;
					sql="select sum(b.soluong*decode(a.loai,3,-1,1)) as soluong from xxx.d_xuatsdll a,xxx.d_thucxuat b ";
					sql+=" where a.id=b.id and a.maql="+long.Parse(row["maql"].ToString())+" and b.mabd="+long.Parse(row["mabd"].ToString());
					foreach(DataRow r4 in get_data_mmyy(sql,row["ngayvv"].ToString(),s_ngay,true).Tables[0].Rows)
						if (r4["soluong"].ToString()!="") _soluong+=decimal.Parse(r4["soluong"].ToString());
					row["solan"]=_soluong;
				}
			}
			if (i_loai==2 && _bBucstt_tronso && !bCongdon)
			{
				ds.Clear();
				DataRow r5,r6,r7;
				DataRow [] dr;
				#region sum
				foreach(DataRow r4 in dt.Rows)
				{
					r4["chon"]=true;
					sql="id="+int.Parse(r4["mabd"].ToString())+" and makho="+int.Parse(r4["makho"].ToString());
					if (_bBucstt_nguon) sql+=" and manguon="+int.Parse(r4["manguon"].ToString());
					r5=getrowbyid(dtton,sql);
					if (r5!=null)
					{
						r6=getrowbyid(ds.Tables[0],sql);
						if (r6==null)
						{
							r7=ds.Tables[0].NewRow();
							r7["makho"]=r4["makho"].ToString();
							r7["manguon"]=r4["manguon"].ToString();
							r7["id"]=r4["mabd"].ToString();
							r7["slyeucau"]=r4["soluong"].ToString();
							r7["slphat"]=r5["slphat"].ToString();
							r7["min"]=r4["soluong"].ToString();
							ds.Tables[0].Rows.Add(r7);
						}
						else 
						{
							dr=ds.Tables[0].Select(sql);
							if (dr.Length>0)
							{
								dr[0]["min"]=Math.Min(decimal.Parse(dr[0]["min"].ToString()),decimal.Parse(r4["soluong"].ToString()));
								dr[0]["slyeucau"]=decimal.Parse(dr[0]["slyeucau"].ToString())+decimal.Parse(r4["soluong"].ToString());
							}
						}
					}
				}
				#endregion 
				foreach(DataRow r4 in ds.Tables[0].Rows)
				{
					r4["slyeucau"]=Math.Floor(double.Parse(r4["slyeucau"].ToString())/double.Parse(r4["slphat"].ToString()));
					r4["min"]=r4["slyeucau"].ToString();
				}
				string sort="makho,mabd";
				if (_bBucstt_nguon) sql+=",manguon=";
				decimal sum=0;
				foreach(DataRow r4 in dt.Select("chon=true",sort))
				{
					sql="makho="+int.Parse(r4["makho"].ToString())+" and id="+int.Parse(r4["mabd"].ToString());
					if (_bBucstt_nguon) sql+=" and manguon="+int.Parse(r4["manguon"].ToString());
					dr=ds.Tables[0].Select(sql);
					if (dr.Length>0)
					{
						sum=Math.Min(decimal.Parse(r4["soluong"].ToString()),decimal.Parse(dr[0]["min"].ToString()));
						dr[0]["min"]=decimal.Parse(dr[0]["min"].ToString())-sum;
						r4["soluong"]=sum;
						r4["chon"]=false;
					}
				}
			}
			return (bCongdon)?dtct:dt;
		}

		public void upd_duyet(DataTable dt,string s_mmyy,int i_nhom,int i_loai,int i_phieu,int i_makp,int i_makhoa,
			string s_ngay,string s_kho,bool bTutrucchung,bool bBuhaophi,int i_thuoc,int i_userid,bool bCongdon,string s_makp,string makho_auto_duyet)
		{
			string xxx=user+"d"+s_mmyy;
			if (makho_auto_duyet!="")
			{
				s_kho=makho_auto_duyet;
				if (s_kho.Substring(s_kho.Length-1,1)!=",") s_kho+=",";
			}
			bool _bPhattron=bPhattron(i_nhom);
			bool _bBucstt_tronso=bBucstt_tronso(i_nhom);
			bool _b1kho=b1kho(s_kho);
			sql="select * from d_duockp where nhom like '%"+i_nhom.ToString()+",%'";
			sql+=" order by stt";
			DataTable dtkp=get_data(sql).Tables[0];	
			string file2;
			switch (i_loai)
			{
				case 1: file2="d_dutruct";
					break;
				case 2: file2="d_xtutrucct";
					break;
				default: file2="d_haophict";
					break;
			}
			
			bool duyet_khoa=bDuyet_khoa;
			if (duyet_khoa) upd_dangduyet(i_nhom,s_ngay,s_ngay,i_loai,(bTutrucchung)?i_makp:i_makhoa);			
			string s_makhoa="";
			if (bBuhaophi) phieu_butruc(dt,s_mmyy,s_ngay,i_nhom,i_makp,i_loai,i_phieu,_bPhattron,i_thuoc,s_kho,file2,bBuhaophi,_b1kho,i_userid,bCongdon,s_makp,bTutrucchung,_bBucstt_tronso);
			else
			{
				switch (i_loai)
				{
					case 1: phieu_dutru(dt,s_mmyy,s_ngay,i_nhom,i_makp,i_loai,i_phieu,_bPhattron,i_thuoc,s_kho,file2,bBuhaophi,_b1kho,i_userid);
						break;
					case 2: phieu_butruc(dt,s_mmyy,s_ngay,i_nhom,i_makp,i_loai,i_phieu,_bPhattron,i_thuoc,s_kho,file2,bBuhaophi,_b1kho,i_userid,bCongdon,s_makp,bTutrucchung,_bBucstt_tronso);
						break;
					default: phieu_dutru(dt,s_mmyy,s_ngay,i_nhom,i_makp,i_loai,i_phieu,_bPhattron,i_thuoc,s_kho,file2,bBuhaophi,_b1kho,i_userid);
						break;
				}
			}
			if (_bPhattron || _bBucstt_tronso)
			{
				if (i_loai==2 || bBuhaophi) upd_thucbucstt(s_ngay,i_nhom,i_loai,i_phieu,i_makp,i_makhoa,s_mmyy,(_b1kho) ? int.Parse(s_kho.Substring(0, s_kho.Length - 1)) : 0,false);
				else 
				{
					sql="select b.* from "+xxx+".d_xuatsdll a,"+xxx+".d_xuatsdct b where a.id=b.id and a.nhom="+i_nhom+" and a.loai="+i_loai+" and a.phieu="+i_phieu+" and to_char(a.ngay,'dd/mm/yyyy')='"+s_ngay+"' and a.makp="+i_makp;
					foreach(DataRow r in get_data(sql).Tables[0].Rows)
						upd_tonkhoct_thucxuat(delete,s_mmyy,i_makp,i_loai,i_thuoc,long.Parse(r["sttt"].ToString()),int.Parse(r["makho"].ToString()),int.Parse(r["manguon"].ToString()),int.Parse(r["nhomcc"].ToString()),int.Parse(r["mabd"].ToString()),r["handung"].ToString(),r["losx"].ToString(),decimal.Parse(r["soluong"].ToString()),decimal.Parse(r["soluong"].ToString())*decimal.Parse(r["giamua"].ToString()),decimal.Parse(r["giaban"].ToString()),decimal.Parse(r["giamua"].ToString()),0);
					upd_thucxuat(s_ngay,i_nhom,i_loai,i_phieu,i_makp,i_makhoa,s_mmyy,i_thuoc,(_b1kho) ? int.Parse(s_kho.Substring(0, s_kho.Length - 1)) : 0);
					//upd_thucxuat(s_ngay,i_nhom,i_loai,i_phieu,i_makp,i_makhoa,s_mmyy,i_thuoc,(_b1kho) ? int.Parse(s_kho.Substring(0, s_kho.Length - 1)) : 0);
				}
			}

			if (s_makhoa!="")
				foreach(DataRow r in dtkp.Select("id in ("+s_makhoa.Substring(0,s_makhoa.Length-1)+")"))
					upd_theodoiduyet(s_ngay,i_nhom,i_loai,int.Parse(r["id"].ToString()),2);
			else upd_theodoiduyet(s_ngay,i_nhom,i_loai,i_makp,2);

			sql="select * from d_dmkho where nhom="+i_nhom;
			if (s_kho!="") sql+=" and id in ("+s_kho.Substring(0,s_kho.Length-1)+")";
			DataRow r1;
			foreach(DataRow r in get_data(sql).Tables[0].Rows)
			{
				r1 = getrowbyid(dt, "makho=" + int.Parse(r["id"].ToString()));
				if (r1!=null)
				{
					if (s_makhoa!="")
						foreach(DataRow r2 in dtkp.Select("id in ("+s_makhoa.Substring(0,s_makhoa.Length-1)+")"))
							upd_daduyet(i_nhom,s_ngay,int.Parse(r2["id"].ToString()),i_loai,i_phieu,int.Parse(r["id"].ToString()));
					else upd_daduyet(i_nhom,s_ngay,i_makhoa,i_loai,i_phieu,int.Parse(r["id"].ToString()));
				}
			}
			if (duyet_khoa) del_dangduyet(i_nhom,s_ngay,s_ngay,i_loai,(bTutrucchung)?i_makp:i_makhoa);
			int itable=tableid("","d_ngayduyet");
			upd_eve_tables(s_mmyy,itable,i_userid,"upd");
			upd_eve_upd_del(s_mmyy,itable,i_userid,"upd",i_nhom.ToString()+"^"+i_loai.ToString()+"^"+i_makp.ToString()+"^"+s_ngay+"^0^"+i_phieu.ToString()+"^"+s_kho+"^ ^");
		}

		private void phieu_dutru(DataTable dt,string s_mmyy,string s_ngay,int i_nhom,int i_makp,int i_loai,
			int i_phieu,bool bPhattron,int i_thuoc,string s_kho,string file2,bool bBuhaophi,bool _b1kho,int i_userid)
		{
			string xxx=user+"d"+s_mmyy;
			DataTable dtct;
			string usr=user,s_sttduyet;
			long id=0,idduyet=0;
			DataRow [] dr=dt.Select("chon=false and soluong>0","id,stt");
			for(int i=0;i<dr.Length;i++)
			{
				if (idduyet!=long.Parse(dr[i]["id"].ToString()))
				{
					idduyet=long.Parse(dr[i]["id"].ToString());
					id=get_id_xuatsd;
					upd_xuatsdll(id,i_nhom,dr[i]["mabn"].ToString(),long.Parse(dr[i]["maql"].ToString()),long.Parse(dr[i]["idkhoa"].ToString()),s_ngay,i_loai,i_phieu,int.Parse(dr[i]["makp"].ToString()),s_mmyy,i_userid,idduyet,i_thuoc,int.Parse(dr[i]["makhoa"].ToString()),(_b1kho) ? int.Parse(s_kho.Substring(0, s_kho.Length - 1)) : 0,(bPhattron)?1:0,"",s_ngay);
					sql="select a.*,b.ten tennguon,c.ten tennhomcc,t.chietkhau from "+xxx+".d_tonkhoct a,"+usr+".d_dmnguon b,"+user+".d_nhomcc c,"+xxx+".d_theodoi t where a.stt=t.id and a.manguon=b.id and a.nhomcc=c.id and a.mmyy='"+s_mmyy+"'";
					dtct=get_xuatsdct(s_mmyy,dt.Select("chon=false and id="+idduyet,"stt"),sql,id,idduyet,bPhattron,i_thuoc,i_loai,file2,int.Parse(dr[i]["makp"].ToString()),int.Parse(dr[i]["makhoa"].ToString()),dr[i]["mabn"].ToString(),long.Parse(dr[i]["maql"].ToString()),long.Parse(dr[i]["idkhoa"].ToString()),s_ngay,decimal.Parse(dr[i]["sltd"].ToString()),bBuhaophi,i_nhom);
					s_sttduyet="";
					foreach(DataRow r4 in dtct.Rows) s_sttduyet+=r4["sttduyet"].ToString().Trim()+",";
					upd_ngayduyet(i_nhom,i_loai,i_phieu,int.Parse(dr[i]["makhoa"].ToString()),s_ngay,idduyet,s_kho,s_sttduyet);
					execute_data("update d_duyet set done=2 where id="+long.Parse(dr[i]["idduyet"].ToString()));
					if (s_kho == "") execute_data("update d_duyetkho set done=2 where idduyet=" + long.Parse(dr[i]["idduyet"].ToString()));
					else
					{
						foreach (DataRow r4 in get_data("select * from d_dmkho where id in (" + s_kho.Substring(0, s_kho.Length - 1) + ")").Tables[0].Rows)
							execute_data("update d_duyetkho set done=2 where idduyet=" + long.Parse(dr[i]["idduyet"].ToString()) + " and makho=" + int.Parse(r4["id"].ToString()));
					}
				}
			}
		}

		private DataTable butruc_congdon(DataTable dtct,string s_ngay,int i_nhom)
		{
			DataRow [] dr1,dr=dtct.Select("chon=false and soluong>0","makho,manguon,madoituong,mabd");
			DataTable dt=dtct.Copy();
			dt.Columns.Add("Chon",typeof(bool));
			foreach(DataRow r in dt.Rows) r["chon"]=true;
			bool congdondoituong=bPhattron_congdondoituong(i_nhom),_bBucstt_nguon=bBucstt_nguon(i_nhom);
			decimal d_soluong=0,d_soluongcu=0;
			foreach(DataRow r in dr)
			{
				sql="makho="+int.Parse(r["makho"].ToString())+" and mabd="+int.Parse(r["mabd"].ToString());
				if (_bBucstt_nguon) sql+=" and manguon="+int.Parse(r["manguon"].ToString());
				if (!congdondoituong) sql+=" and madoituong="+int.Parse(r["madoituong"].ToString());
				d_soluong=decimal.Parse(r["soluong"].ToString());
				foreach(DataRow r1 in dt.Select(sql,"id"))
				{
					d_soluongcu=Math.Min(decimal.Parse(r1["soluong"].ToString()),d_soluong);
					if (d_soluongcu>0)
					{
						r1["soluong"]=d_soluongcu.ToString();
						r1["chon"]=false;
						d_soluong-=d_soluongcu; 
					}
				}
				if (d_soluong>0)
				{
					sql+=" and chon=false";
					dr1=dt.Select(sql,"id");
					if (dr1.Length>0) dr1[0]["soluong"]=decimal.Parse(dr1[0]["soluong"].ToString())+d_soluong;
				}
			}
			dt.AcceptChanges();
			return dt;
		}

		private void phieu_butruc(DataTable dt,string s_mmyy,string s_ngay,int i_nhom,int i_makp,int i_loai,
			int i_phieu,bool bPhattron,int i_thuoc,string s_kho,string file2,bool bBuhaophi,bool _b1kho,
			int i_userid,bool bCongdon,string s_makp,bool bTutrucchung,bool bBucstt_tronso)
		{
			string xxx=user+"d"+s_mmyy;
			if (bCongdon) dt=butruc_congdon(dt,s_ngay,i_nhom);
			DataTable dtct;
			long id=0,idduyet=0;
			string s_makhoa=i_makp.ToString()+",",usr=user,s_sttduyet="";
			if (bTutrucchung)
			{
				s_makhoa="";
				foreach(DataRow r4 in dt.Select("chon=false and soluong>0","makhoa"))
					if (s_makhoa.IndexOf(r4["makhoa"].ToString().Trim()+",")==-1)
						s_makhoa+=r4["makhoa"].ToString().Trim()+",";
			}
			DataRow [] dr=dt.Select("chon=false and soluong>0 and makhoa in ("+s_makhoa.Substring(0,s_makhoa.Length-1)+")","id,stt");
			for(int i=0;i<dr.Length;i++)
			{
				if (idduyet!=long.Parse(dr[i]["id"].ToString()))
				{
					idduyet=long.Parse(dr[i]["id"].ToString());
					id=get_id_xuatsd;
					upd_xuatsdll(id,i_nhom,dr[i]["mabn"].ToString(),long.Parse(dr[i]["maql"].ToString()),long.Parse(dr[i]["idkhoa"].ToString()),s_ngay,i_loai,i_phieu,int.Parse(dr[i]["makp"].ToString()),s_mmyy,i_userid,idduyet,i_thuoc,int.Parse(dr[i]["makhoa"].ToString()),(_b1kho) ? int.Parse(s_kho.Substring(0, s_kho.Length - 1)) : 0,(bPhattron)?1:0,"",s_ngay);
					sql="select a.*,b.ten tennguon,c.ten tennhomcc,t.chietkhau from "+xxx+".d_tonkhoct a,"+usr+".d_dmnguon b,"+usr+".d_nhomcc c,"+xxx+".d_theodoi t where a.stt=t.id and a.manguon=b.id and a.nhomcc=c.id and a.mmyy='"+s_mmyy+"'";
					dtct=get_xuatsdct(s_mmyy,dt.Select("chon=false and id="+idduyet,"stt"),sql,id,idduyet,bPhattron,i_thuoc,i_loai,file2,int.Parse(dr[i]["makp"].ToString()),int.Parse(dr[i]["makhoa"].ToString()),dr[i]["mabn"].ToString(),long.Parse(dr[i]["maql"].ToString()),long.Parse(dr[i]["idkhoa"].ToString()),s_ngay,decimal.Parse(dr[i]["sltd"].ToString()),bBuhaophi,i_nhom);
					s_sttduyet="";
					foreach(DataRow r4 in dtct.Select("treo=0")) s_sttduyet+=r4["sttduyet"].ToString().Trim()+",";
					upd_ngayduyet(i_nhom,i_loai,i_phieu,int.Parse(dr[i]["makhoa"].ToString()),s_ngay,idduyet,s_kho,s_sttduyet);
					execute_data("update d_duyet set done=2 where id="+long.Parse(dr[i]["idduyet"].ToString()));
					if (s_kho == "") execute_data("update d_duyetkho set done=2 where idduyet=" + long.Parse(dr[i]["idduyet"].ToString()));
					else
					{
						foreach (DataRow r4 in get_data("select * from d_dmkho where id in (" + s_kho.Substring(0, s_kho.Length - 1) + ")").Tables[0].Rows)
							execute_data("update d_duyetkho set done=2 where idduyet=" + long.Parse(dr[i]["idduyet"].ToString()) + " and makho=" + int.Parse(r4["id"].ToString()));
					}
				}
			}
			foreach(DataRow r4 in dt.Select("chon=true"))
				upd_ngayduyet(i_nhom,i_loai,i_phieu,int.Parse(r4["makhoa"].ToString()),s_ngay,long.Parse(r4["id"].ToString()),s_kho,"");
			if (bBucstt_tronso)
			{
				foreach(DataRow r4 in dt.Select("treo=1"))
					execute_data("update d_treoduyet set slthuc=slthuc+"+decimal.Parse(r4["soluong"].ToString())+" where id="+long.Parse(r4["id"].ToString())+" and stt="+int.Parse(r4["stt"].ToString()));
				foreach(DataRow r4 in dt.Select("chon=true or soluongyc<>soluong"))
				{
					upd_treoduyet(long.Parse(r4["id"].ToString()),int.Parse(r4["stt"].ToString()),int.Parse(r4["madoituong"].ToString()),int.Parse(r4["makho"].ToString()),int.Parse(r4["mabd"].ToString()),decimal.Parse(r4["soluongyc"].ToString()),(decimal.Parse(r4["soluongyc"].ToString())==decimal.Parse(r4["soluong"].ToString()))?0:decimal.Parse(r4["soluong"].ToString()),int.Parse(r4["manguon"].ToString()));
					execute_data("update d_xtutrucct set slthuc="+decimal.Parse(r4["soluongyc"].ToString())+" where id="+long.Parse(r4["id"].ToString())+" and stt="+int.Parse(r4["stt"].ToString()));
				}
			}
		}
		private long get_id(string d_ngay,int d_nhom,int d_loai,int d_phieu,int d_makhoa,string d_mmyy,int d_makho,string d_table,bool bChung,int d_makp)
		{
			try
			{
				string xxx=user+"d"+d_mmyy;
				sql="select a.id from "+xxx+".d_xuatsdll a,"+xxx+"."+d_table+" b where a.id=b.id and a.lk=1 and to_char(a.ngay,'dd/mm/yyyy')='"+d_ngay+"'"+" and a.nhom="+d_nhom+" and a.loai="+d_loai+" and a.phieu="+d_phieu;
				if (bChung) sql+=" and a.makp="+d_makp;
				else sql+=" and a.makhoa="+d_makhoa;
				sql+=" and a.mmyy='"+d_mmyy+"'";
				if (d_makho != 0) sql += " and a.lydo=" + d_makho;
				ds=get_data(sql);
				if (ds.Tables[0].Rows.Count==0) return 0;
				else return long.Parse(ds.Tables[0].Rows[0][0].ToString());
			}
			catch{return 0;}
		}

		public void upd_thucxuat_cstt(long d_id,string d_ngay,int d_nhom,int d_loai,int d_phieu,int d_makp,int d_makhoa,string d_mmyy,int d_thuoc,int d_makho)
		{
			string xxx=user+"d"+d_mmyy;
			string str="select a.*,t.chietkhau from "+xxx+".d_tutrucct a,"+xxx+".d_theodoi t where a.stt=t.id and a.mmyy='"+d_mmyy+"'"+" and a.makp="+d_makp;
			sql="select b.manguon,b.madoituong,b.makho,b.mabd,sum(b.soluong) soluong from "+xxx+".d_xuatsdll a,"+xxx+".d_xuatsdct b ";
			sql+=" where a.id=b.id and a.lk=1 and to_char(a.ngay,'dd/mm/yyyy')='"+d_ngay+"'"+" and a.nhom="+d_nhom+" and loai="+d_loai+" and a.phieu="+d_phieu+" and a.makhoa="+d_makhoa+" and a.mmyy='"+d_mmyy+"'";
			if (d_makho != 0) sql += " and a.lydo=" + d_makho;
			sql+=" and a.id="+d_id+" group by b.manguon,b.madoituong,b.makho,b.mabd";
			upd_xuat(str,sql,d_ngay,d_nhom,d_loai,d_phieu,d_makp,d_makhoa,d_mmyy,false,d_thuoc,d_makho);
		}

		private void upd_xuat(string str,string sql,string d_ngay,int d_nhom,int d_loai,int d_phieu,int d_makp,int d_makhoa,string d_mmyy,bool bRound,int d_thuoc,int d_makho)
		{
			DataRow [] dr;
			DataRow r1;
			DataTable dttonct;
			decimal sl,slton,sltx,sttx,dongia;
			double slqd,d_sl1,d_sl2;
			int j;
			long id=0;
			DataTable dt=get_data("select id,soluong from d_dmbd where nhom="+d_nhom+" order by id").Tables[0];
			foreach(DataRow r in get_data(sql).Tables[0].Rows)
			{
				r1=getrowbyid(dt,"id="+int.Parse(r["mabd"].ToString()));
				if (r1!=null)
				{
					d_sl1=double.Parse(r["soluong"].ToString());
					d_sl2=double.Parse(r1["soluong"].ToString());
					if (bRound && (d_sl2!=1 || r["soluong"].ToString().IndexOf(".")!=-1)) 
					{
						if (r["soluong"].ToString().IndexOf(".")!=-1)
						{
							j=(d_sl1==d_sl2)?0:1;
							slqd=(Math.Floor(d_sl1/d_sl2)+j)*d_sl2;
						}
						else slqd=Convert.ToInt16(Math.Ceiling((d_sl1-1)/d_sl2))*d_sl2;
						sl=Convert.ToDecimal(slqd);
					}
					else sl=Convert.ToDecimal(r["soluong"].ToString());
					sql=str+" and a.tondau+a.slnhap-a.slxuat>0 and a.makho="+int.Parse(r["makho"].ToString())+" and t.manguon="+int.Parse(r["manguon"].ToString())+" and a.mabd="+int.Parse(r["mabd"].ToString());
					sql+=" order by a.stt";
					dttonct=get_data(sql).Tables[0];
					dr=dttonct.Select("true","stt");
					for(int i=0;i<dr.Length;i++)
					{
						slton=decimal.Parse(dr[i]["tondau"].ToString())+decimal.Parse(dr[i]["slnhap"].ToString())-decimal.Parse(dr[i]["slxuat"].ToString());
						dongia=decimal.Parse(dr[i]["giamua"].ToString());
						sltx=Math.Min(sl,slton);
						if (sltx>0)
						{
							id=get_id(d_ngay,d_nhom,d_loai,d_phieu,d_makhoa,d_mmyy,d_makho,"d_xuatsdct",false,d_makp);
							sttx=dongia*sltx;
							updrec_tonkhoct(dttonct,int.Parse(r["makho"].ToString()),long.Parse(dr[i]["stt"].ToString()),sltx,sttx,"+");
							upd_thucxuat(d_mmyy,id,long.Parse(dr[i]["stt"].ToString()),int.Parse(r["madoituong"].ToString()),int.Parse(dr[i]["makho"].ToString()),int.Parse(dr[i]["manguon"].ToString()),int.Parse(dr[i]["nhomcc"].ToString()),int.Parse(r["mabd"].ToString()),dr[i]["handung"].ToString(),dr[i]["losx"].ToString(),sltx,sttx,decimal.Parse(dr[i]["giaban"].ToString()),decimal.Parse(dr[i]["giamua"].ToString()),"",0,0);
							upd_tonkhoct_thucxuat(insert,d_mmyy,d_makp,d_loai,d_thuoc,long.Parse(dr[i]["stt"].ToString()),int.Parse(dr[i]["makho"].ToString()),int.Parse(dr[i]["manguon"].ToString()),int.Parse(dr[i]["nhomcc"].ToString()),int.Parse(r["mabd"].ToString()),dr[i]["handung"].ToString(),dr[i]["losx"].ToString(),sltx,sttx,decimal.Parse(dr[i]["giaban"].ToString()),decimal.Parse(dr[i]["giamua"].ToString()),decimal.Parse(dr[i]["chietkhau"].ToString()));
							dttonct.AcceptChanges();
						}
						sl-=sltx;
						if (sl<=0) break;
					}
					if (id!=0 && sl>0) upd_treo(id,0,int.Parse(r["manguon"].ToString()),int.Parse(r["mabd"].ToString()),sl,"thucxuat",int.Parse(r["makho"].ToString()),0);
				}
			}
		}

		private void upd_hoantra(string str,string sql,string d_ngay,int d_nhom,int d_loai,int d_phieu,int d_makp,int d_makhoa,string d_mmyy,bool bRound,int d_thuoc,int d_makho)
		{
			DataRow [] dr;
			DataRow r1;
			DataTable dttonct;
			decimal sl,sltx,sttx,dongia;
			long id=0;
			DataTable dt=get_data("select id,soluong from d_dmbd where nhom="+d_nhom+" order by id").Tables[0];
			foreach(DataRow r in get_data(sql).Tables[0].Rows)
			{
				r1=getrowbyid(dt,"id="+int.Parse(r["mabd"].ToString()));
				if (r1!=null)
				{			
					sl=Convert.ToDecimal(Math.Floor(double.Parse(r["soluong"].ToString())));
					sql=str+" and b.makho="+int.Parse(r["makho"].ToString())+" and b.manguon="+int.Parse(r["manguon"].ToString())+" and b.mabd="+int.Parse(r["mabd"].ToString());
					sql+=" order by b.stt";
					dttonct=get_data(sql).Tables[0];
					dr=dttonct.Select("true","stt");
					for(int i=0;i<dr.Length;i++)
					{
						sltx=sl;
						dongia=decimal.Parse(dr[i]["giamua"].ToString());
						if (sltx>0)
						{
							id=get_id(d_ngay,d_nhom,d_loai,d_phieu,d_makhoa,d_mmyy,d_makho,"d_xuatsdct",false,d_makp);
							sttx=dongia*sltx;
							updrec_tonkhoct(dttonct,int.Parse(r["makho"].ToString()),long.Parse(dr[i]["sttt"].ToString()),sltx,sttx,"+");
							upd_thucxuat(d_mmyy,id,long.Parse(dr[i]["sttt"].ToString()),int.Parse(r["madoituong"].ToString()),int.Parse(dr[i]["makho"].ToString()),int.Parse(dr[i]["manguon"].ToString()),int.Parse(dr[i]["nhomcc"].ToString()),int.Parse(r["mabd"].ToString()),dr[i]["handung"].ToString(),dr[i]["losx"].ToString(),sltx,sttx,decimal.Parse(dr[i]["giaban"].ToString()),decimal.Parse(dr[i]["giamua"].ToString()),"",0,0);
							if (d_loai==3 && d_thuoc==2)
								upd_tonkhoct_thucxuat_taisan(insert,d_mmyy,d_makp,d_loai,d_thuoc,long.Parse(dr[i]["sttt"].ToString()),int.Parse(dr[i]["makho"].ToString()),int.Parse(dr[i]["manguon"].ToString()),int.Parse(dr[i]["nhomcc"].ToString()),int.Parse(r["mabd"].ToString()),dr[i]["handung"].ToString(),dr[i]["losx"].ToString(),sltx,sttx,decimal.Parse(dr[i]["giaban"].ToString()),decimal.Parse(dr[i]["giamua"].ToString()),int.Parse(r["madoituong"].ToString()),0);
							else
								upd_tonkhoct_thucxuat(insert,d_mmyy,d_makp,d_loai,d_thuoc,long.Parse(dr[i]["sttt"].ToString()),int.Parse(dr[i]["makho"].ToString()),int.Parse(dr[i]["manguon"].ToString()),int.Parse(dr[i]["nhomcc"].ToString()),int.Parse(r["mabd"].ToString()),dr[i]["handung"].ToString(),dr[i]["losx"].ToString(),sltx,sttx,decimal.Parse(dr[i]["giaban"].ToString()),decimal.Parse(dr[i]["giamua"].ToString()),0);
							dttonct.AcceptChanges();
						}
						sl-=sltx;
						if (sl<=0) break;
					}
					if (id!=0 && sl>0) upd_treo(id,0,int.Parse(r["manguon"].ToString()),int.Parse(r["mabd"].ToString()),sl,"thucxuat",int.Parse(r["makho"].ToString()),0);
				}
			}
		}
		public bool bPhattron(int d_nhom)
		{
			ds=get_data("select ten from d_thongso where id=63 and nhom="+d_nhom);
			if (ds.Tables[0].Rows.Count==0) return false;
			return ds.Tables[0].Rows[0][0].ToString()=="1";
		}
		public bool b1kho(string makho)
		{
			if (makho == "") return false;
			else
			{
				int i = 0;
				for (int j = 0; j < makho.Length; j++)
					if (makho.Substring(j, 1) == ",") i++;
				return i < 2;
			}
		}
		public bool bBucstt_tronso(int d_nhom)
		{
			ds=get_data("select ten from d_thongso where id=125 and nhom="+d_nhom);
			if (ds.Tables[0].Rows.Count==0) return false;
			return ds.Tables[0].Rows[0][0].ToString().Trim()=="1";
		}
		public bool bPhattron_congdondoituong(int d_nhom)
		{
			ds=get_data("select ten from d_thongso where id=69 and nhom="+d_nhom);
			if (ds.Tables[0].Rows.Count==0) return false;
			return ds.Tables[0].Rows[0][0].ToString()=="1";
		}

		public bool bSLDuyet_nho_yeucau(int d_nhom)
		{
			ds=get_data("select ten from d_thongso where id=78 and nhom="+d_nhom);
			if (ds.Tables[0].Rows.Count==0) return false;
			return ds.Tables[0].Rows[0][0].ToString()=="1";
		}

		public decimal get_slton_nguon(DataTable dt,int makho,int mabd,int manguon,decimal soluong)
		{
			DataRow r=getrowbyid(dt,"makho="+makho+" and id="+mabd+" and manguon="+manguon);
			if (r==null) return 0;
			else return decimal.Parse(r["soluong"].ToString())+soluong;
		}

		public DataTable get_tonkhoth_duyet(string mmyy,string kho)
		{
			string xxx=user+"d"+mmyy;
			sql="select b.id,a.makho,a.tondau+a.slnhap-a.slxuat soluong,a.manguon,trim(b.ten)||' '||b.hamluong ten,b.dang,b.ma,b.tenhc,b.mahc,b.soluong as slphat,a.tondau+a.slnhap-a.slxuat toncuoi,c.ten as tenhang,d.ten as tenkho from "+xxx+".d_tonkhoth a,"+user+".d_dmbd b,"+user+".d_dmhang c,"+user+".d_dmkho d where a.mabd=b.id and b.mahang=c.id  and a.makho=d.id ";
			if (kho!="") sql+=" and a.makho in ("+kho.Substring(0,kho.Length-1)+")";
			DataTable tmp=get_data(sql).Tables[0];
			return tmp;
		}
		public DataTable get_tutructh_duyet(string mmyy,string kho,int makp)
		{
			string xxx=user+"d"+mmyy;
			sql="select b.id,a.makho,a.tondau+a.slnhap-a.slxuat soluong,a.manguon,trim(b.ten)||' '||b.hamluong ten,b.dang,";
			sql+="b.ma,b.tenhc,b.mahc,b.soluong as slphat,a.tondau+a.slnhap-a.slxuat toncuoi,c.ten as tenhang,";
			sql+="d.ten as tenkho from "+xxx+".d_tutructh a,"+user+".d_dmbd b,"+user+".d_dmhang c,"+user+".d_dmkho d ";
			sql+=" where a.mabd=b.id  and b.mahang=c.id and a.makho=d.id ";
			if (kho!="") sql+=" and a.makho in ("+kho.Substring(0,kho.Length-1)+")";
			sql+=" and a.makp="+makp;
			DataTable tmp=get_data(sql).Tables[0];
			DataRow r1;
			string mmyys="";
			foreach(DataRow r2 in get_data("select mmyy from d_table where substr(mmyy,3,2)||substr(mmyy,1,2)>'"+mmyy.Substring(2,2)+mmyy.Substring(0,2)+"'").Tables[0].Rows)
			{
				mmyys=r2["mmyy"].ToString();
				xxx=user+"d"+mmyys;
				sql="select makho,mabd,manguon,sum(slxuat) soluong from "+xxx+".d_tutructh where slxuat>0 and mmyy='"+mmyys+"'";
				if (kho!="") sql+=" and makho in ("+kho.Substring(0,kho.Length-1)+")";
				sql+=" and makp="+makp;
				sql+=" group by makho,mabd,manguon";
				foreach(DataRow r in get_data(sql).Tables[0].Rows)
				{
					r1=getrowbyid(tmp,"makho="+int.Parse(r["makho"].ToString())+" and id="+int.Parse(r["mabd"].ToString())+" and manguon="+int.Parse(r["manguon"].ToString()));
					if (r1!=null) r1["soluong"]=decimal.Parse(r1["soluong"].ToString())-decimal.Parse(r["soluong"].ToString());
				}
			}
			return tmp;
		}
		public DataTable get_xuatsdct(string mmyy,DataRow [] r,string str,long id,long idduyet,bool bPhattron,int thuoc,int loai,string file,int makp,int makhoa,string mabn,long maql,long idkhoa,string ngay,decimal sltd,bool bBuhaophi,int nhom)
		{
			DataSet ds=new DataSet();
			ds.ReadXml("..\\..\\..\\xml\\d_xuatsdct.xml");
			DataColumn dc=new DataColumn();
			dc.ColumnName="treo";
			dc.DataType=Type.GetType("System.Decimal");
			ds.Tables[0].Columns.Add(dc);
			int stt=0;
			int irec=0;
			DataRow [] dr;
			DataTable dttonct;
			string tenfile,sothe,xxx=user+"d"+mmyy;
			bool Bucstt_tronso=bBucstt_tronso(nhom);
			decimal sl,sltx,sttx,slton,dongia,namsx,namsd,tyle;
			long idts=0;
			for(int i=0;i<r.Length;i++)
			{
				sl=decimal.Parse(r[i]["soluong"].ToString());
				sql=str+" and a.tondau+a.slnhap-a.slxuat>0 and a.makho="+int.Parse(r[i]["makho"].ToString())+" and a.mabd="+int.Parse(r[i]["mabd"].ToString())+" and a.manguon="+int.Parse(r[i]["manguon"].ToString());
				sql+=" order by a.stt";
				dttonct=get_data(sql).Tables[0];
				dr=dttonct.Select("true","stt");
				irec=dr.Length;
				for(int j=0;j<irec;j++)
				{
					slton=decimal.Parse(dr[j]["tondau"].ToString())+decimal.Parse(dr[j]["slnhap"].ToString())-decimal.Parse(dr[j]["slxuat"].ToString());
					dongia=decimal.Parse(dr[j]["giamua"].ToString());
					sltx=Math.Min(sl,Math.Max(0,slton));
					if (sltx>0)
					{
						stt=get_stt(ds.Tables[0]);
						sttx=dongia*sltx;
						dr[j]["slxuat"]=decimal.Parse(dr[j]["slxuat"].ToString())+sltx;
						updrec_xuatsdct_treo("-",ds.Tables[0],stt,long.Parse(dr[j]["stt"].ToString()),r[i]["doituong"].ToString(),int.Parse(r[i]["mabd"].ToString()),r[i]["ma"].ToString(),r[i]["ten"].ToString(),r[i]["tenhc"].ToString(),r[i]["dang"].ToString(),r[i]["tenkho"].ToString(),dr[j]["tennguon"].ToString(),dr[j]["tennhomcc"].ToString(),dr[j]["handung"].ToString(),dr[j]["losx"].ToString(),sltx,dongia,sttx,decimal.Parse(dr[j]["giaban"].ToString()),decimal.Parse(dr[j]["giamua"].ToString()),int.Parse(r[i]["madoituong"].ToString()),int.Parse(r[i]["makho"].ToString()),int.Parse(dr[j]["manguon"].ToString()),int.Parse(dr[j]["nhomcc"].ToString()),r[i]["ngay"].ToString(),int.Parse(r[i]["stt"].ToString()),int.Parse(r[i]["tutruc"].ToString()),null,int.Parse(r[i]["treo"].ToString()));
						//
						if (loai==2)
						{
							upd_bucstt(mmyy,id,stt,long.Parse(dr[j]["stt"].ToString()),int.Parse(dr[j]["makho"].ToString()),int.Parse(dr[j]["manguon"].ToString()),int.Parse(dr[j]["nhomcc"].ToString()),int.Parse(r[i]["mabd"].ToString()),dr[j]["handung"].ToString(),dr[j]["losx"].ToString(),sltx,sttx,decimal.Parse(dr[j]["giaban"].ToString()),decimal.Parse(dr[j]["giamua"].ToString()),int.Parse(r[i]["stt"].ToString()));
							if (!bPhattron)
							{
								upd_thucbucstt_stt(mmyy,id,long.Parse(dr[j]["stt"].ToString()),int.Parse(dr[j]["makho"].ToString()),int.Parse(dr[j]["manguon"].ToString()),int.Parse(dr[j]["nhomcc"].ToString()),int.Parse(r[i]["mabd"].ToString()),dr[j]["handung"].ToString(),dr[j]["losx"].ToString(),sltx,sttx,decimal.Parse(dr[j]["giaban"].ToString()),decimal.Parse(dr[j]["giamua"].ToString()),stt);
								upd_tonkhoct_thucbucstt(insert,mmyy,makp,long.Parse(dr[j]["stt"].ToString()),int.Parse(dr[j]["makho"].ToString()),int.Parse(dr[j]["manguon"].ToString()),int.Parse(dr[j]["nhomcc"].ToString()),int.Parse(r[i]["mabd"].ToString()),dr[j]["handung"].ToString(),dr[j]["losx"].ToString(),sltx,sttx,decimal.Parse(dr[j]["giaban"].ToString()),decimal.Parse(dr[j]["giamua"].ToString()));
							}
							tenfile=(bBuhaophi)?"d_haophict":(r[i]["tutruc"].ToString()=="1")?"d_dutruct":file;
							execute_data("update "+tenfile+" set slthuc=slthuc+"+sltx/sltd+" where id="+idduyet+" and stt="+int.Parse(r[i]["stt"].ToString()));
							//if (Bucstt_tronso) execute_data("update d_treoduyet set slthuc=slthuc+"+sltx/sltd+" where id="+idduyet+" and stt="+int.Parse(r[i]["stt"].ToString()));
						}
						else
						{
							upd_xuatsdct(mmyy,id,stt,long.Parse(dr[j]["stt"].ToString()),int.Parse(r[i]["madoituong"].ToString()),int.Parse(dr[j]["makho"].ToString()),int.Parse(dr[j]["manguon"].ToString()),int.Parse(dr[j]["nhomcc"].ToString()),int.Parse(r[i]["mabd"].ToString()),dr[j]["handung"].ToString(),dr[j]["losx"].ToString(),sltx,sttx,decimal.Parse(dr[j]["giaban"].ToString()),decimal.Parse(dr[j]["giamua"].ToString()),int.Parse(r[i]["stt"].ToString()),"",0,0);
							if (!bPhattron)
							{
								upd_thucxuat_stt(mmyy,id,long.Parse(dr[j]["stt"].ToString()),int.Parse(r[i]["madoituong"].ToString()),int.Parse(dr[j]["makho"].ToString()),int.Parse(dr[j]["manguon"].ToString()),int.Parse(dr[j]["nhomcc"].ToString()),int.Parse(r[i]["mabd"].ToString()),dr[j]["handung"].ToString(),dr[j]["losx"].ToString(),sltx,sttx,decimal.Parse(dr[j]["giaban"].ToString()),decimal.Parse(dr[j]["giamua"].ToString()),"",0,0,stt);
								//upd_tonkhoct_thucxuat(insert,mmyy,makp,loai,thuoc,long.Parse(dr[j]["stt"].ToString()),int.Parse(dr[j]["makho"].ToString()),int.Parse(dr[j]["manguon"].ToString()),int.Parse(dr[j]["nhomcc"].ToString()),int.Parse(r[i]["mabd"].ToString()),dr[j]["handung"].ToString(),dr[j]["losx"].ToString(),sltx,sttx,decimal.Parse(dr[j]["giaban"].ToString()),decimal.Parse(dr[j]["giamua"].ToString()),decimal.Parse(dr[j]["chietkhau"].ToString()));
							}
							upd_tonkhoct_thucxuat(insert,mmyy,makp,loai,thuoc,long.Parse(dr[j]["stt"].ToString()),int.Parse(dr[j]["makho"].ToString()),int.Parse(dr[j]["manguon"].ToString()),int.Parse(dr[j]["nhomcc"].ToString()),int.Parse(r[i]["mabd"].ToString()),dr[j]["handung"].ToString(),dr[j]["losx"].ToString(),sltx,sttx,decimal.Parse(dr[j]["giaban"].ToString()),decimal.Parse(dr[j]["giamua"].ToString()),decimal.Parse(dr[j]["chietkhau"].ToString()));
							if (thuoc==1 && loai==1)
							{
								upd_tienthuoc(insert,mmyy,mabn,maql,idkhoa,ngay,makhoa,loai,int.Parse(r[i]["madoituong"].ToString()),int.Parse(r[i]["mabd"].ToString()),sltx,sttx,decimal.Parse(dr[j]["giaban"].ToString()),decimal.Parse(dr[j]["giamua"].ToString()));
								execute_data("update "+user+"d"+mmyy+".d_tienthuoc set id="+id+", mavaovien="+get_mavaovien(maql)+" where mabn='"+mabn+"' and maql="+maql+" and idkhoa="+idkhoa+" and to_char(ngay,'dd/mm/yyyy')='"+ngay.Substring(0,10).ToString()+"' and makp="+makp+" and madoituong="+int.Parse(r[i]["madoituong"].ToString())+" and mabd="+int.Parse(r[i]["mabd"].ToString())+" and giamua="+decimal.Parse(dr[j]["giamua"].ToString()));
								upd_theodoicongno(insert,mabn,maql,idkhoa,int.Parse(r[i]["madoituong"].ToString()),sttx,"thuoc");
							}
							execute_data("update "+file+" set slthuc=slthuc+"+sltx+" where id="+idduyet+" and stt="+int.Parse(r[i]["stt"].ToString()));
							if (loai!=3) upd_tonkhoth_dutru(duyet,nhom,mmyy,int.Parse(r[i]["makho"].ToString()),int.Parse(dr[j]["manguon"].ToString()),int.Parse(r[i]["mabd"].ToString()),sltx);
						}
						//
						//if (thuoc==2)
						//{
						if (get_theodoi(int.Parse(dr[j]["mabd"].ToString())))
						{
							idts=get_id_tscd;
							tyle=0;namsx=DateTime.Now.Year;namsd=namsx;sothe="";
							foreach(DataRow r2 in get_data("select * from "+xxx+".d_theodoitscd where makho="+int.Parse(dr[j]["makho"].ToString())+" and sttt="+long.Parse(dr[j]["stt"].ToString())).Tables[0].Rows)
							{
								tyle=decimal.Parse(r2["tyle"].ToString());
								sothe=r2["sothe"].ToString();
								namsx=decimal.Parse(r2["namsx"].ToString());
								namsd=decimal.Parse(r2["namsd"].ToString());
							}
							upd_tscdkhoa(idts,makp,int.Parse(dr[j]["makho"].ToString()),int.Parse(dr[j]["manguon"].ToString()),int.Parse(dr[j]["nhomcc"].ToString()),long.Parse(dr[j]["stt"].ToString()),int.Parse(dr[j]["mabd"].ToString()),dr[j]["losx"].ToString(),sothe,sttx,tyle,namsx,namsd);
							upd_tscdlc(idts,get_stt_tscd(idts,"d_tscdkem"),makp,ngay,"Mua mới");
						}
						//}
					}
					sl-=sltx;
					if (sl<=0) break;
				}
				if (sl>0 && id!=0) upd_treo(id,int.Parse(r[i]["stt"].ToString()),int.Parse(r[i]["manguon"].ToString()),int.Parse(r[i]["mabd"].ToString()),sl,"xuatsdct",int.Parse(r[i]["makho"].ToString()),int.Parse(r[i]["madoituong"].ToString()));
			}
			ds.AcceptChanges();
			return ds.Tables[0];
		}
		
		public bool upd_tscdkhoa(long d_id,int d_makp,int d_makho,int d_manguon,int d_nhomcc,long d_stt,int d_mabd,string d_losx,string d_sothe,decimal d_sotien,decimal d_tyle,decimal d_namsx,decimal d_namsd)
		{
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand("pkg_duoc.upd_tscdkhoa",con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				cmd.Parameters.Add("d_makp",OracleType.Number).Value=d_makp;
				cmd.Parameters.Add("d_makho",OracleType.Number).Value=d_makho;
				cmd.Parameters.Add("d_manguon",OracleType.Number).Value=d_manguon;
				cmd.Parameters.Add("d_nhomcc",OracleType.Number).Value=d_nhomcc;
				cmd.Parameters.Add("d_stt",OracleType.Number).Value=d_stt;
				cmd.Parameters.Add("d_mabd",OracleType.Number).Value=d_mabd;
				cmd.Parameters.Add("d_losx",OracleType.VarChar,20).Value=d_losx;
				cmd.Parameters.Add("d_sothe",OracleType.VarChar,20).Value=d_sothe;
				cmd.Parameters.Add("d_tyle",OracleType.Number).Value=d_tyle;
				cmd.Parameters.Add("d_sotien",OracleType.Number).Value=d_sotien;
				cmd.Parameters.Add("d_namsx",OracleType.Number).Value=d_namsx;
				cmd.Parameters.Add("d_namsd",OracleType.Number).Value=d_namsd;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_tscdkhoa");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_tscdkem(long d_id,int d_stt,string d_ngay,int d_mabd,string d_diengiai)
		{
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand("pkg_duoc.upd_tscdkem",con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				cmd.Parameters.Add("d_stt",OracleType.Number).Value=d_stt;
				cmd.Parameters.Add("d_ngay",OracleType.VarChar,10).Value=d_ngay;
				cmd.Parameters.Add("d_mabd",OracleType.Number).Value=d_mabd;
				cmd.Parameters.Add("d_diengiai",OracleType.NVarChar,100).Value=d_diengiai;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_tscdkem");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_tscdsc(long d_id,int d_stt,string d_ngay,string d_diengiai,string d_nguoidenghi,int d_noisc)
		{
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand("pkg_duoc.upd_tscdsc",con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				cmd.Parameters.Add("d_stt",OracleType.Number).Value=d_stt;
				cmd.Parameters.Add("d_ngay",OracleType.VarChar,10).Value=d_ngay;
				cmd.Parameters.Add("d_diengiai",OracleType.NVarChar,100).Value=d_diengiai;
				cmd.Parameters.Add("d_nguoidenghi",OracleType.NVarChar,50).Value=d_nguoidenghi;
				cmd.Parameters.Add("d_noisc",OracleType.Number).Value=d_noisc;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_tscdsc");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_tscdlc(long d_id,int d_stt,int d_makp,string d_ngay,string d_diengiai)
		{
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand("pkg_duoc.upd_tscdlc",con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				cmd.Parameters.Add("d_stt",OracleType.Number).Value=d_stt;
				cmd.Parameters.Add("d_makp",OracleType.Number).Value=d_makp;
				cmd.Parameters.Add("d_ngay",OracleType.VarChar,10).Value=d_ngay;
				cmd.Parameters.Add("d_diengiai",OracleType.NVarChar,100).Value=d_diengiai;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_tscdlc");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public int get_stt_tscd(long id,string table)
		{
			try
			{
				sql="select max(stt) as so from "+table+" where id="+id;
				ds=get_data(sql);
				if (ds.Tables[0].Rows[0]["so"].ToString()=="") return 1;
				else return int.Parse(ds.Tables[0].Rows[0]["so"].ToString())+1;
			}
			catch{return 1;}
		}

		public bool get_theodoi(int mabd)
		{
			return get_data("select * from d_dmbd a,d_dmnhom b where a.manhom=b.id and b.theodoi=1 and a.id="+mabd).Tables[0].Rows.Count==1;
		}
		public long get_id_tscd
		{
			get
			{
				return getidyymmdd_d(20);
			}
		}
		public bool upd_daduyet(int d_nhom,string d_ngay,int d_makp,int d_loai,int d_phieu,int d_makho)
		{
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand("pkg_duoc.upd_daduyet",con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_nhom",OracleType.Number).Value=d_nhom;
				cmd.Parameters.Add("d_ngay",OracleType.VarChar,10).Value=d_ngay;
				cmd.Parameters.Add("d_makp",OracleType.Number).Value=d_makp;
				cmd.Parameters.Add("d_loai",OracleType.Number).Value=d_loai;
				cmd.Parameters.Add("d_phieu",OracleType.Number).Value=d_phieu;
				cmd.Parameters.Add("d_makho",OracleType.Number).Value=d_makho;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_daduyet");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_dangduyet(int d_nhom,string d_tu,string d_den,int d_loai,int d_makp)
		{
			sql = "update d_dangduyet set nhom=:d_nhom where nhom=:d_nhom and tu=:d_tu and den=:d_den and loai=:d_loai and makp=:d_makp";
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd = new OracleCommand(sql, con);
				cmd.CommandType = CommandType.Text;
				cmd.Parameters.Add("d_nhom", OracleType.Number).Value = d_nhom;
				cmd.Parameters.Add("d_nhom", OracleType.Number).Value = d_nhom;
				cmd.Parameters.Add("d_tu", OracleType.VarChar,10).Value = d_tu.Substring(0,10);
				cmd.Parameters.Add("d_den", OracleType.VarChar,10).Value = d_den.Substring(0,10);
				cmd.Parameters.Add("d_loai", OracleType.Number).Value = d_loai;
				cmd.Parameters.Add("d_makp", OracleType.Number).Value = d_makp;
				int irec = cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec == 0)
				{
					sql = "insert into d_dangduyet (nhom,tu,den,loai,makp,computer) values (:d_nhom,:d_tu,:d_den,:d_loai,:d_makp,:sComputer)";
					cmd = new OracleCommand(sql, con);
					cmd.CommandType = CommandType.Text;
					cmd.Parameters.Add("d_nhom", OracleType.Number).Value = d_nhom;
					cmd.Parameters.Add("d_tu", OracleType.VarChar,10).Value = d_tu.Substring(0,10);
					cmd.Parameters.Add("d_den", OracleType.VarChar,10).Value = d_den.Substring(0,10);
					cmd.Parameters.Add("d_loai", OracleType.Number).Value = d_loai;
					cmd.Parameters.Add("d_makp", OracleType.Number).Value = d_makp;
					cmd.Parameters.Add("sComputer", OracleType.VarChar,50).Value = sComputer;
					cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch (OracleException ex)
			{
				upd_error(ex.Message, sComputer, "d_dangduyet");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}
		public bool upd_ngayduyet(int d_nhom,int d_loai,int d_phieu,int d_makp,string d_ngay,long d_idduyet,string d_makho,string d_sttduyet)
		{
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand("pkg_duoc.upd_ngayduyet",con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_nhom",OracleType.Number).Value=d_nhom;
				cmd.Parameters.Add("d_loai",OracleType.Number).Value=d_loai;
				cmd.Parameters.Add("d_phieu",OracleType.Number).Value=d_phieu;
				cmd.Parameters.Add("d_makp",OracleType.Number).Value=d_makp;
				cmd.Parameters.Add("d_ngay",OracleType.VarChar,10).Value=d_ngay;
				cmd.Parameters.Add("d_idduyet",OracleType.Number).Value=d_idduyet;
				cmd.Parameters.Add("d_makho",OracleType.VarChar,254).Value=d_makho;
				cmd.Parameters.Add("d_sttduyet",OracleType.VarChar,254).Value=d_sttduyet;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_ngayduyet");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}
		
		public void upd_thucbucstt(string d_ngay,int d_nhom,int d_loai,int d_phieu,int d_makp,int d_makhoa,string d_mmyy,int d_makho,bool bChung)
		{
			string xxx=user+"d"+d_mmyy;
			string str="select * from "+xxx+".d_tonkhoct where mmyy='"+d_mmyy+"'";
			sql="select b.manguon,b.makho,b.mabd,sum(b.soluong) soluong from "+xxx+".d_xuatsdll a,"+xxx+".d_bucstt b ";
			sql+=" where a.id=b.id and a.lk=1 and to_char(a.ngay,'dd/mm/yyyy')='"+d_ngay+"'";
			sql+=" and a.nhom="+d_nhom+" and loai="+d_loai+" and a.phieu="+d_phieu;
			if (bChung) sql+=" and a.makp="+d_makp;
			else sql+=" and a.makhoa="+d_makhoa;	//sql+=" and a.makhoa="+d_makhoa;
			if (d_makho != 0) sql += " and a.lydo=" + d_makho;
			sql+=" group by b.manguon,b.makho,b.mabd";
			upd_xuatbucstt(str,sql,d_ngay,d_nhom,d_loai,d_phieu,d_makp,d_makhoa,d_mmyy,d_makho,true,bChung);
		}
		private void upd_xuatbucstt(string str,string sql,string d_ngay,int d_nhom,int d_loai,int d_phieu,int d_makp,int d_makhoa,string d_mmyy,int d_makho,bool bRound,bool bChung)
		{
			DataRow [] dr;
			DataRow r1;
			DataTable dttonct;
			decimal sl,slton,sltx,sttx,dongia;
			double slqd,d_sl1,d_sl2;
			long id=0;
			int j;
			DataTable dt=get_data("select id,soluong from d_dmbd where nhom="+d_nhom+" order by id").Tables[0];
			foreach(DataRow r in get_data(sql).Tables[0].Rows)
			{
				r1=getrowbyid(dt,"id="+int.Parse(r["mabd"].ToString()));
				if (r1!=null)
				{
					d_sl1=double.Parse(r["soluong"].ToString());
					d_sl2=double.Parse(r1["soluong"].ToString());
					if (bRound && (d_sl2!=1 || r["soluong"].ToString().IndexOf(".")!=-1)) 
					{
						if (r["soluong"].ToString().IndexOf(".")!=-1)
						{
							j=(d_sl1==d_sl2)?0:1;
							slqd=(Math.Floor(d_sl1/d_sl2)+j)*d_sl2;
						}
						else slqd=Convert.ToInt16(Math.Ceiling((d_sl1-1)/d_sl2))*d_sl2;
						sl=Convert.ToDecimal(slqd);
					}
					else sl=Convert.ToDecimal(r["soluong"].ToString());
					sql=str+" and tondau+slnhap-slxuat>0 and makho="+int.Parse(r["makho"].ToString())+" and manguon="+int.Parse(r["manguon"].ToString())+" and mabd="+int.Parse(r["mabd"].ToString());
					sql+=" order by stt";
					dttonct=get_data(sql).Tables[0];
					dr=dttonct.Select("true","stt");
					for(int i=0;i<dr.Length;i++)
					{
						slton=decimal.Parse(dr[i]["tondau"].ToString())+decimal.Parse(dr[i]["slnhap"].ToString())-decimal.Parse(dr[i]["slxuat"].ToString());
						dongia=decimal.Parse(dr[i]["giamua"].ToString());
						sltx=Math.Min(sl,slton);
						if (sltx>0)
						{
							id=get_id(d_ngay,d_nhom,d_loai,d_phieu,d_makhoa,d_mmyy,d_makho,"d_bucstt",bChung,d_makp);
							sttx=dongia*sltx;
							updrec_tonkhoct(dttonct,int.Parse(r["makho"].ToString()),long.Parse(dr[i]["stt"].ToString()),sltx,sttx,"+");
							upd_thucbucstt(d_mmyy,id,long.Parse(dr[i]["stt"].ToString()),int.Parse(dr[i]["makho"].ToString()),int.Parse(dr[i]["manguon"].ToString()),int.Parse(dr[i]["nhomcc"].ToString()),int.Parse(r["mabd"].ToString()),dr[i]["handung"].ToString(),dr[i]["losx"].ToString(),sltx,sttx,decimal.Parse(dr[i]["giaban"].ToString()),decimal.Parse(dr[i]["giamua"].ToString()));
							upd_tonkhoct_thucbucstt(insert,d_mmyy,d_makp,long.Parse(dr[i]["stt"].ToString()),int.Parse(dr[i]["makho"].ToString()),int.Parse(dr[i]["manguon"].ToString()),int.Parse(dr[i]["nhomcc"].ToString()),int.Parse(r["mabd"].ToString()),dr[i]["handung"].ToString(),dr[i]["losx"].ToString(),sltx,sttx,decimal.Parse(dr[i]["giaban"].ToString()),decimal.Parse(dr[i]["giamua"].ToString()));
							dttonct.AcceptChanges();
						}
						sl-=sltx;
						if (sl<=0) break;
					}
					if (id!=0 && sl>0) upd_treo(id,0,int.Parse(r["manguon"].ToString()),int.Parse(r["mabd"].ToString()),sl,"thucbucstt",int.Parse(r["makho"].ToString()),0);
				}
			}
		}
		public bool upd_thucbucstt_stt(string d_mmyy,long d_id,long d_sttt,int d_makho,int d_manguon,int d_nhomc,int d_mabd,string d_handung,string d_losx,decimal d_soluong,decimal d_sotien,decimal d_giaban,decimal d_giamua,int d_stt)
		{
			string xxx=user+"d"+d_mmyy+".pkg_duoc.upd_thucbucstt_stt";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(xxx,con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				cmd.Parameters.Add("d_sttt",OracleType.Number).Value=d_sttt;
				cmd.Parameters.Add("d_makho",OracleType.Number).Value=d_makho;
				cmd.Parameters.Add("d_manguon",OracleType.Number).Value=d_manguon;
				cmd.Parameters.Add("d_nhomcc",OracleType.Number).Value=d_nhomc;
				cmd.Parameters.Add("d_mabd",OracleType.Number).Value=d_mabd;
				cmd.Parameters.Add("d_handung",OracleType.VarChar,4).Value=d_handung;
				cmd.Parameters.Add("d_losx",OracleType.VarChar,20).Value=d_losx;
				cmd.Parameters.Add("d_soluong",OracleType.Number).Value=d_soluong;
				cmd.Parameters.Add("d_sotien",OracleType.Number).Value=d_sotien;
				cmd.Parameters.Add("d_giaban",OracleType.Number).Value=d_giaban;
				cmd.Parameters.Add("d_giamua",OracleType.Number).Value=d_giamua;
				cmd.Parameters.Add("d_stt",OracleType.Number).Value=d_stt;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_thucbucstt");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}
		public void upd_tonkhoct_thucbucstt(string tt,string mmyy,int makp,long stt,int makho,int manguon,int nhomcc,int mabd,string handung,string losx,decimal soluong,decimal sotien,decimal giaban,decimal giamua)
		{
			string xxx=user+"d"+mmyy;
			if (tt==delete)
			{
				execute_data("update "+xxx+".d_tonkhoct set slxuat=slxuat-"+soluong+",stxuat=stxuat-"+sotien+"	where mmyy='"+mmyy+"' and makho="+makho+" and stt="+stt);
				execute_data("update "+xxx+".d_tutrucct set slnhap=slnhap-"+soluong+",stnhap=stnhap-"+sotien+"	where mmyy='"+mmyy+"' and makp="+makp+" and makho="+makho+" and stt="+stt);
			}
			else if (tt==insert)
			{
				execute_data("update "+xxx+".d_tonkhoct set slxuat=slxuat+"+soluong+",stxuat=stxuat+"+sotien+" where mmyy='"+mmyy+"' and makho="+makho+" and stt="+stt);
				upd_tutrucct(mmyy,makp,makho,manguon,nhomcc,stt,mabd,handung,losx,soluong,sotien,giaban,giamua,"slnhap","stnhap");
			}
			upd_tonkhoth(tt,mmyy,makho,mabd,manguon,soluong,"slxuat");
			upd_tutructh(tt,mmyy,makp,makho,mabd,manguon,soluong,"slnhap");
		}

		public void upd_tonkhoct_thucxuat_taisan(string tt,string mmyy,int makp,int loai,int thuoc,long stt,int makho,int manguon,int nhomcc,int mabd,string handung,string losx,decimal soluong,decimal sotien,decimal giaban,decimal giamua,int khonhan,decimal chietkhau)
		{
			string xxx=user+"d"+mmyy;
			if (tt==delete)
			{
				if (thuoc==1)
				{
					if (loai==1 || loai==4)
					{
						execute_data("update "+xxx+".d_tonkhoct set slxuat=slxuat-"+soluong+",stxuat=stxuat-"+sotien+" where mmyy='"+mmyy+"' and makho="+makho+" and stt="+stt);
						upd_tonkhoth(tt,mmyy,makho,mabd,manguon,soluong,"slxuat");
					}
					else if (loai==2)
					{
						execute_data("update "+xxx+".d_tutrucct set slxuat=slxuat-"+soluong+",stxuat=stxuat-"+sotien+" where mmyy='"+mmyy+"' and makp="+makp+" and makho="+makho+" and stt="+stt);
						upd_tutructh(tt,mmyy,makp,makho,mabd,manguon,soluong,"slxuat");
					}
					else
					{
						execute_data("update "+xxx+".d_tonkhoct set slnhap=slnhap-"+soluong+",stnhap=stnhap-"+sotien+" where mmyy='"+mmyy+"' and makho="+makho+" and stt="+stt);
						upd_tonkhoth(tt,mmyy,makho,mabd,manguon,soluong,"slnhap");
					}
				}
				else if (thuoc==2)
				{
					if (loai==4)
					{
						execute_data("update "+xxx+".d_tonkhoct set slxuat=slxuat-"+soluong+",stxuat=stxuat-"+sotien+" where mmyy='"+mmyy+"' and makho="+makho+" and stt="+stt);
						upd_tonkhoth(tt,mmyy,makho,mabd,manguon,soluong,"slxuat");
						execute_data("update "+xxx+".d_tutrucct set slnhap=slnhap-"+soluong+",stnhap=stnhap-"+sotien+" where mmyy='"+mmyy+"' and makp="+makp+" and makho="+makho+" and stt="+stt);
						upd_tutructh(tt,mmyy,makp,makho,mabd,manguon,soluong,"slnhap");
					}
					else if (loai==2)
					{
						execute_data("update "+xxx+".d_tutrucct set slnhap=slnhap-"+soluong+",stnhap=stnhap-"+sotien+" where mmyy='"+mmyy+"' and makp="+makp+" and makho="+makho+" and stt="+stt);
						upd_tutructh(tt,mmyy,makp,makho,mabd,manguon,soluong,"slnhap");
					}
					else if (loai==3)
					{
						execute_data("update "+xxx+".d_tonkhoct set slnhap=slnhap-"+soluong+",stnhap=stnhap-"+sotien+" where mmyy='"+mmyy+"' and makho="+khonhan+" and stt="+stt);
						upd_tonkhoth(tt,mmyy,khonhan,mabd,manguon,soluong,"slnhap");
						execute_data("update "+xxx+".d_tutrucct set slxuat=slxuat-"+soluong+",stxuat=stxuat-"+sotien+" where mmyy='"+mmyy+"' and makp="+makp+" and makho="+makho+" and stt="+stt);
						upd_tutructh(tt,mmyy,makp,makho,mabd,manguon,soluong,"slxuat");
					}
				}
			}
			else if (tt==insert)
			{
				if (thuoc==1)
				{
					if (loai==1 || loai==4)
					{
						execute_data("update "+xxx+".d_tonkhoct set slxuat=slxuat+"+soluong+",stxuat=stxuat+"+sotien+" where mmyy='"+mmyy+"' and makho="+makho+" and stt="+stt);
						upd_tonkhoth(tt,mmyy,makho,mabd,manguon,soluong,"slxuat");
					}
					else if (loai==2)
					{
						execute_data("update "+xxx+".d_tutrucct set slxuat=slxuat+"+soluong+",stxuat=stxuat+"+sotien+" where mmyy='"+mmyy+"' and makp="+makp+" and makho="+makho+" and stt="+stt);
						upd_tutructh(tt,mmyy,makp,makho,mabd,manguon,soluong,"slxuat");
					}
					else
					{
						upd_tonkhoct(mmyy,makho,manguon,nhomcc,stt,mabd,handung,losx,soluong,sotien,giaban,giamua,"slnhap","stnhap");
						upd_tonkhoth(tt,mmyy,makho,mabd,manguon,soluong,"slnhap");
					}
				}
				else if (thuoc==2)
				{
					if (loai==4)
					{
						upd_tonkhoct(mmyy,makho,manguon,nhomcc,stt,mabd,handung,losx,soluong,sotien,giaban,giamua,"slxuat","stxuat");
						upd_tonkhoth(tt,mmyy,makho,mabd,manguon,soluong,"slxuat");
						upd_tutrucct(mmyy,makp,makho,manguon,nhomcc,stt,mabd,handung,losx,soluong,sotien,giaban,giamua,"slnhap","stnhap");
						upd_tutructh(tt,mmyy,makp,makho,mabd,manguon,soluong,"slnhap");
					}
					else if (loai==2)
					{
						upd_tutrucct(mmyy,makp,makho,manguon,nhomcc,stt,mabd,handung,losx,soluong,sotien,giaban,giamua,"slnhap","stnhap");
						upd_tutructh(tt,mmyy,makp,makho,mabd,manguon,soluong,"slnhap");
					}
					else if (loai==3)
					{
						upd_tutrucct(mmyy,makp,makho,manguon,nhomcc,stt,mabd,handung,losx,soluong,sotien,giaban,giamua,"slxuat","stxuat");
						upd_tutructh(tt,mmyy,makp,makho,mabd,manguon,soluong,"slxuat");
						upd_tonkhoct(mmyy,khonhan,manguon,nhomcc,stt,mabd,handung,losx,soluong,sotien,giaban,giamua,"slnhap","stnhap");
						upd_tonkhoth(tt,mmyy,khonhan,mabd,manguon,soluong,"slnhap");
						if (get_data("select * from "+xxx+".d_theodoi where id="+stt).Tables[0].Rows.Count==0)
						{
							int namsx=DateTime.Now.Year,namsd=namsx,baohanh=0,nguongoc=0,tinhtrang=0;
							string sothe="";
							foreach(DataRow r2 in get_data("select * from "+xxx+".d_theodoitscd where makho="+makho+" and sttt="+stt).Tables[0].Rows)
							{
								sothe=r2["sothe"].ToString();
								namsx=int.Parse(r2["namsx"].ToString());
								namsd=int.Parse(r2["namsd"].ToString());
								baohanh=int.Parse(r2["baohanh"].ToString());
								nguongoc=int.Parse(r2["nguongoc"].ToString());
								tinhtrang=int.Parse(r2["tinhtrang"].ToString());
							}
							upd_theodoi(mmyy,stt,mabd,manguon,nhomcc,handung,losx,sothe,namsx,namsd,baohanh,nguongoc,tinhtrang,giamua,giaban,chietkhau);
						}
					}
				}
			}
		}

		public bool upd_treoduyet(long d_id,int d_stt,int d_madoituong,int d_makho,int d_mabd,decimal d_slyeucau,decimal d_slthuc,int d_manguon)
		{
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand("pkg_duoc.upd_treoduyet",con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				cmd.Parameters.Add("d_stt",OracleType.Number).Value=d_stt;
				cmd.Parameters.Add("d_madoituong",OracleType.Number).Value=d_madoituong;
				cmd.Parameters.Add("d_makho",OracleType.Number).Value=d_makho;
				cmd.Parameters.Add("d_mabd",OracleType.Number).Value=d_mabd;
				cmd.Parameters.Add("d_slyeucau",OracleType.Number).Value=d_slyeucau;
				cmd.Parameters.Add("d_slthuc",OracleType.Number).Value=d_slthuc;
				cmd.Parameters.Add("d_manguon",OracleType.Number).Value=d_manguon;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_treoduyet");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}
		public void updrec_tonkhoct(DataTable dt,long stt,decimal soluong,decimal sotien,string toantu)
		{
			DataRow[] r=dt.Select("stt="+stt);
			if (r.Length>0)
			{
				if (toantu=="+")
				{
					r[0]["slxuat"]=decimal.Parse(r[0]["slxuat"].ToString())+soluong;
					r[0]["stxuat"]=decimal.Parse(r[0]["stxuat"].ToString())+sotien;
				}
				else 
				{
					r[0]["slxuat"]=decimal.Parse(r[0]["slxuat"].ToString())-soluong;
					r[0]["stxuat"]=decimal.Parse(r[0]["stxuat"].ToString())-sotien;
				}
			}
		}

		public void updrec_xuatsdct_treo(string tt,DataTable dt,int stt,long sttt,string doituong,int mabd,string ma,string ten,string tenhc,string dang,string tenkho,string tennguon,string tennhomcc,string handung,string losx,decimal soluong,decimal dongia,decimal sotien,decimal giaban,decimal giamua,int madoituong,int makho,int manguon,int nhomcc,string ngay,int sttduyet,int tutruc,DataTable dtton,int treo)
		{
			string exp="stt="+stt;
			DataRow r = getrowbyid (dt,exp); 
			if ( r == null )
			{
				DataRow nrow = dt.NewRow ( ) ;
				nrow["stt"] = stt;
				nrow["sttt"] = sttt;
				nrow["doituong"] = doituong;
				nrow["mabd"] = mabd;
				nrow["ma"] = ma;
				nrow["ten"] = ten;
				nrow["tenhc"] = tenhc;
				nrow["dang"] = dang;
				nrow["tenkho"] = tenkho;
				nrow["tennguon"] = tennguon;
				nrow["tennhomcc"] = tennhomcc;
				nrow["handung"] = handung;
				nrow["losx"] = losx;
				nrow["soluong"] = soluong;
				nrow["dongia"] = dongia;
				nrow["sotien"] = sotien;
				nrow["giaban"]=giaban;
				nrow["giamua"]=giamua;
				nrow["madoituong"] = madoituong;
				nrow["makho"] = makho;
				nrow["manguon"] = manguon;
				nrow["nhomcc"] = nhomcc;
				nrow["ngay"]=ngay;
				nrow["sttduyet"]=sttduyet;
				nrow["tutruc"]=tutruc;
				nrow["treo"]=treo;
				dt.Rows.Add ( nrow ) ;
				if (dtton!=null) updrec_tonkho_nguon(dtton,makho,mabd,manguon,soluong,tt);
			}
			else
			{
				DataRow[] dr = dt.Select(exp);
				if (dtton!=null)
				{
					decimal sl=decimal.Parse(dr[0]["soluong"].ToString());
					updrec_tonkho_nguon(dtton,makho,mabd,manguon,sl,"+");
					updrec_tonkho_nguon(dtton,makho,mabd,manguon,soluong,"-");
				}
				dr[0]["sttt"] = sttt;
				dr[0]["doituong"] = doituong;
				dr[0]["mabd"] = mabd;
				dr[0]["ma"] = ma;
				dr[0]["ten"] = ten;
				dr[0]["tenhc"] = tenhc;
				dr[0]["dang"] = dang;
				dr[0]["tenkho"] = tenkho;
				dr[0]["tennguon"] = tennguon;
				dr[0]["tennhomcc"] = tennhomcc;
				dr[0]["handung"] = handung;
				dr[0]["losx"] = losx;
				dr[0]["soluong"] = soluong;
				dr[0]["dongia"] = dongia;
				dr[0]["sotien"] = sotien;
				dr[0]["giaban"]=giaban;
				dr[0]["giamua"]=giamua;
				dr[0]["madoituong"] = madoituong;
				dr[0]["makho"] = makho;
				dr[0]["manguon"] = manguon;
				dr[0]["nhomcc"] = nhomcc;
				dr[0]["ngay"]=ngay;
				dr[0]["sttduyet"]=sttduyet;
				dr[0]["tutruc"]=tutruc;
				dr[0]["treo"]=treo;
			}
		}
		public bool upd_thucbucstt(string d_mmyy,long d_id,long d_sttt,int d_makho,int d_manguon,int d_nhomc,int d_mabd,string d_handung,string d_losx,decimal d_soluong,decimal d_sotien,decimal d_giaban,decimal d_giamua)
		{
			string xxx=user+"d"+d_mmyy+".pkg_duoc.upd_thucbucstt";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(xxx,con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				cmd.Parameters.Add("d_sttt",OracleType.Number).Value=d_sttt;
				cmd.Parameters.Add("d_makho",OracleType.Number).Value=d_makho;
				cmd.Parameters.Add("d_manguon",OracleType.Number).Value=d_manguon;
				cmd.Parameters.Add("d_nhomcc",OracleType.Number).Value=d_nhomc;
				cmd.Parameters.Add("d_mabd",OracleType.Number).Value=d_mabd;
				cmd.Parameters.Add("d_handung",OracleType.VarChar,4).Value=d_handung;
				cmd.Parameters.Add("d_losx",OracleType.VarChar,20).Value=d_losx;
				cmd.Parameters.Add("d_soluong",OracleType.Number).Value=d_soluong;
				cmd.Parameters.Add("d_sotien",OracleType.Number).Value=d_sotien;
				cmd.Parameters.Add("d_giaban",OracleType.Number).Value=d_giaban;
				cmd.Parameters.Add("d_giamua",OracleType.Number).Value=d_giamua;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_thucbucstt");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public void updrec_tonkhoct(DataTable dt,int kho,long stt,decimal soluong,decimal sotien,string toantu)
		{
			DataRow[] r=dt.Select("makho="+kho+" and stt="+stt);
			if (r.Length>0)
			{
				if (toantu=="+")
				{
					r[0]["slxuat"]=decimal.Parse(r[0]["slxuat"].ToString())+soluong;
					r[0]["stxuat"]=decimal.Parse(r[0]["stxuat"].ToString())+sotien;
				}
				else 
				{
					r[0]["slxuat"]=decimal.Parse(r[0]["slxuat"].ToString())-soluong;
					r[0]["stxuat"]=decimal.Parse(r[0]["stxuat"].ToString())-sotien;
				}
			}
		}

		public DataTable get_thuoc(string mabn,int makp,string ngay,string table)
		{
			sql="select to_char(a.ngay,'dd/mm/yyyy') ngay,d.ten from d_duyet a,"+table+" b,d_dausinhton c,d_loaiphieu d ";
			sql+=" where a.id=b.idduyet and b.id=c.iddutru and a.phieu=d.id ";
			sql+=" and b.mabn='"+mabn+"'"+" and to_char(c.ngay,'dd/mm/yyyy')='"+ngay.Substring(0,10)+"'";
			sql+=" and a.makp="+makp;
			return get_data(sql).Tables[0];
		}
		public bool upd_duyet_pkg(long d_id,int d_nhom,string d_ngay,int d_loai,int d_phieu,int d_makp,int d_done,string d_mmyy,int d_userid,int d_makhoa)
		{
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand("pkg_duoc.upd_duyet",con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				cmd.Parameters.Add("d_nhom",OracleType.Number).Value=d_nhom;
				cmd.Parameters.Add("d_ngay",OracleType.VarChar,10).Value=d_ngay;
				cmd.Parameters.Add("d_loai",OracleType.Number).Value=d_loai;
				cmd.Parameters.Add("d_phieu",OracleType.Number).Value=d_phieu;
				cmd.Parameters.Add("d_makp",OracleType.Number).Value=d_makp;
				cmd.Parameters.Add("d_done",OracleType.Number).Value=d_done;
				cmd.Parameters.Add("d_mmyy",OracleType.VarChar,4).Value=d_mmyy;
				cmd.Parameters.Add("d_userid",OracleType.Number).Value=d_userid;
				cmd.Parameters.Add("d_makhoa",OracleType.Number).Value=d_makhoa;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_duyet");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}
		public bool bTrucoso(int d_nhom)
		{
			ds=get_data("select ten from d_thongso where id=92 and nhom="+d_nhom);
			if (ds.Tables[0].Rows.Count==0) return false;
			return ds.Tables[0].Rows[0][0].ToString()=="1";
		}
		private int get_loai_doituong(int madoituong)
		{
			ds=get_data("select loai from d_doituong where madoituong="+madoituong);
			if (ds.Tables[0].Rows.Count>0) return int.Parse(ds.Tables[0].Rows[0]["loai"].ToString());
			else return 0;
		}

		public decimal get_dongia(string mmyy,int makp,int mabd,int makho,int manguon,int madoituong)
		{
			int fie=(get_loai_doituong(madoituong)==0)?0:1;
			sql="select giamua,giaban from "+user+"d"+mmyy+".d_tutrucct where makp="+makp+" and mabd="+mabd+" and makho="+makho+" and manguon="+manguon;
			sql+=" order by stt";
			ds=get_data(sql);
			if (ds.Tables[0].Rows.Count>0) return decimal.Parse(ds.Tables[0].Rows[0][fie].ToString());
			else return 0;
		}

		public bool upd_haophill(long d_id,long d_idduyet,string d_sophieu)
		{
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand("pkg_duoc.upd_haophill",con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				cmd.Parameters.Add("d_idduyet",OracleType.Number).Value=d_idduyet;
				cmd.Parameters.Add("d_sophieu",OracleType.VarChar,8).Value=d_sophieu;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_haophill");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_haophict(long d_id,int d_stt,int d_madoituong,int d_makho,int d_mabd,decimal d_slyeucau,decimal d_slthuc,int d_manguon,int d_tutruc)
		{
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand("pkg_duoc.upd_haophict",con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				cmd.Parameters.Add("d_stt",OracleType.Number).Value=d_stt;
				cmd.Parameters.Add("d_madoituong",OracleType.Number).Value=d_madoituong;
				cmd.Parameters.Add("d_makho",OracleType.Number).Value=d_makho;
				cmd.Parameters.Add("d_mabd",OracleType.Number).Value=d_mabd;
				cmd.Parameters.Add("d_slyeucau",OracleType.Number).Value=d_slyeucau;
				cmd.Parameters.Add("d_slthuc",OracleType.Number).Value=d_slthuc;
				cmd.Parameters.Add("d_manguon",OracleType.Number).Value=d_manguon;
				cmd.Parameters.Add("d_tutruc",OracleType.Number).Value=d_tutruc;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_haophict");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_xtutrucll(long d_id,long d_idduyet,string d_mabn,long d_maql,long d_idkhoa)
		{
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand("pkg_duoc.upd_xtutrucll",con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				cmd.Parameters.Add("d_idduyet",OracleType.Number).Value=d_idduyet;
				cmd.Parameters.Add("d_mabn",OracleType.VarChar,8).Value=d_mabn;
				cmd.Parameters.Add("d_maql",OracleType.Number).Value=d_maql;
				cmd.Parameters.Add("d_idkhoa",OracleType.Number).Value=d_idkhoa;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_xtutrucll");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_xtutrucll(long d_id,long d_idduyet,string d_mabn,long d_maql,long d_idkhoa,decimal d_songay)
		{
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand("pkg_duoc.upd_xtutrucll",con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				cmd.Parameters.Add("d_idduyet",OracleType.Number).Value=d_idduyet;
				cmd.Parameters.Add("d_mabn",OracleType.VarChar,8).Value=d_mabn;
				cmd.Parameters.Add("d_maql",OracleType.Number).Value=d_maql;
				cmd.Parameters.Add("d_idkhoa",OracleType.Number).Value=d_idkhoa;
				cmd.Parameters.Add("d_songay",OracleType.Number).Value=d_songay;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_xtutrucll");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_xtutrucct(long d_id,int d_stt,int d_madoituong,int d_makho,int d_mabd,decimal d_slyeucau,decimal d_slthuc,string d_cachdung,int d_manguon,long d_idvpkhoa)
		{
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand("pkg_duoc.upd_xtutrucct",con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				cmd.Parameters.Add("d_stt",OracleType.Number).Value=d_stt;
				cmd.Parameters.Add("d_madoituong",OracleType.Number).Value=d_madoituong;
				cmd.Parameters.Add("d_makho",OracleType.Number).Value=d_makho;
				cmd.Parameters.Add("d_mabd",OracleType.Number).Value=d_mabd;
				cmd.Parameters.Add("d_slyeucau",OracleType.Number).Value=d_slyeucau;
				cmd.Parameters.Add("d_slthuc",OracleType.Number).Value=d_slthuc;
				cmd.Parameters.Add("d_cachdung",OracleType.NVarChar,255).Value=d_cachdung;
				cmd.Parameters.Add("d_manguon",OracleType.Number).Value=d_manguon;
				cmd.Parameters.Add("d_idvpkhoa",OracleType.Number).Value=d_idvpkhoa;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_xtutrucct");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_xtutrucct(long d_id,int d_stt,int d_madoituong,int d_makho,int d_mabd,decimal d_slyeucau,decimal d_slthuc,string d_cachdung,int d_manguon,long d_idvpkhoa,string d_ghichu)
		{
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand("pkg_duoc.upd_xtutrucct",con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				cmd.Parameters.Add("d_stt",OracleType.Number).Value=d_stt;
				cmd.Parameters.Add("d_madoituong",OracleType.Number).Value=d_madoituong;
				cmd.Parameters.Add("d_makho",OracleType.Number).Value=d_makho;
				cmd.Parameters.Add("d_mabd",OracleType.Number).Value=d_mabd;
				cmd.Parameters.Add("d_slyeucau",OracleType.Number).Value=d_slyeucau;
				cmd.Parameters.Add("d_slthuc",OracleType.Number).Value=d_slthuc;
				cmd.Parameters.Add("d_cachdung",OracleType.NVarChar,255).Value=d_cachdung;
				cmd.Parameters.Add("d_manguon",OracleType.Number).Value=d_manguon;
				cmd.Parameters.Add("d_idvpkhoa",OracleType.Number).Value=d_idvpkhoa;
				cmd.Parameters.Add("d_ghichu",OracleType.VarChar,10).Value=d_ghichu;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_xtutrucct");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_xtutrucct(long d_id,int d_stt,int d_madoituong,int d_makho,int d_mabd,decimal d_slyeucau,decimal d_slthuc,string d_cachdung,int d_manguon,long d_idvpkhoa,string d_ghichu,decimal d_slylenh)
		{
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand("pkg_duoc.upd_xtutrucct",con);
				cmd.CommandType=CommandType.StoredProcedure;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				cmd.Parameters.Add("d_stt",OracleType.Number).Value=d_stt;
				cmd.Parameters.Add("d_madoituong",OracleType.Number).Value=d_madoituong;
				cmd.Parameters.Add("d_makho",OracleType.Number).Value=d_makho;
				cmd.Parameters.Add("d_mabd",OracleType.Number).Value=d_mabd;
				cmd.Parameters.Add("d_slyeucau",OracleType.Number).Value=d_slyeucau;
				cmd.Parameters.Add("d_slthuc",OracleType.Number).Value=d_slthuc;
				cmd.Parameters.Add("d_cachdung",OracleType.NVarChar,255).Value=d_cachdung;
				cmd.Parameters.Add("d_manguon",OracleType.Number).Value=d_manguon;
				cmd.Parameters.Add("d_idvpkhoa",OracleType.Number).Value=d_idvpkhoa;
				cmd.Parameters.Add("d_ghichu",OracleType.VarChar,10).Value=d_ghichu;
				cmd.Parameters.Add("d_slylenh",OracleType.Number).Value=d_slylenh;
				cmd.ExecuteNonQuery();
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_xtutrucct");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}
		public void updrec_dutrull(DataTable dt,long id,string mabn,long maql,long idkhoa,string hoten,string mabs,string manv,string ngay,decimal mach,decimal nhietdo,string huyetap,decimal nhiptho,int cannang,string phong,string giuong,string ghichu,int read)
		{
			string exp="id="+id;
			DataRow r = getrowbyid (dt,exp); 
			if ( r == null )
			{
				DataRow nrow = dt.NewRow ( ) ;
				nrow["id"] = id;
				nrow["mabn"] = mabn;
				nrow["maql"] = maql;
				nrow["idkhoa"] = idkhoa;
				nrow["hoten"] = hoten;
				nrow["mabs"] = mabs;
				nrow["manv"] = manv;
				nrow["ngay"] = ngay;
				nrow["mach"] = mach;
				nrow["nhietdo"] = nhietdo;
				nrow["huyetap"] = huyetap;
				nrow["nhiptho"] = nhiptho;
				nrow["cannang"] = cannang;
				nrow["phong"] = phong;
				nrow["giuong"] = giuong;
				nrow["ghichu"] = ghichu;
				nrow["read"]=read;
				dt.Rows.Add ( nrow ) ;
			}
			else
			{
				DataRow[] dr = dt.Select(exp);
				dr[0]["mabn"] = mabn;
				dr[0]["maql"] = maql;
				dr[0]["idkhoa"] = idkhoa;
				dr[0]["hoten"] = hoten;
				dr[0]["mabs"] = mabs;
				dr[0]["manv"] = manv;
				dr[0]["ngay"] = ngay;
				dr[0]["mach"] = mach;
				dr[0]["nhietdo"] = nhietdo;
				dr[0]["huyetap"] = huyetap;
				dr[0]["nhiptho"] = nhiptho;
				dr[0]["cannang"] = cannang;
				dr[0]["phong"] = phong;
				dr[0]["giuong"] = giuong;
				dr[0]["ghichu"] = ghichu;
				dr[0]["read"]=read;
			}
		}

		public int iMavp_congkham(int d_nhom)
		{
			ds=get_data("select ten from d_thongso where id=127 and nhom="+d_nhom);
			if (ds.Tables[0].Rows.Count==0) return 0;
			return int.Parse(ds.Tables[0].Rows[0][0].ToString().Trim());
		}

		#endregion

		public void close()
		{
			if (con!=null)
			{
				con.Close();con.Dispose();
			}
		}

		public bool upd_tttiepdon(string ngay,long maql,string bacsy,string benhvien,string dienthoai)
		{
			string table=user+mmyy(ngay)+".tttiepdon";
			sql="update "+table+" set bacsy=:bacsy,benhvien=:benhvien,dienthoai=:dienthoai where maql="+maql;
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("bacsy",OracleType.NVarChar,254).Value=bacsy;
				cmd.Parameters.Add("benhvien",OracleType.NVarChar,254).Value=benhvien;
				cmd.Parameters.Add("dienthoai",OracleType.VarChar,30).Value=dienthoai;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into "+table+"(maql,bacsy,benhvien,dienthoai) values ("+maql+",:bacsy,:benhvien,:dienthoai)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("bacsy",OracleType.NVarChar,254).Value=bacsy;
					cmd.Parameters.Add("benhvien",OracleType.NVarChar,254).Value=benhvien;
					cmd.Parameters.Add("dienthoai",OracleType.VarChar,30).Value=dienthoai;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,table);
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public DataTable getChidinh(string ngay, long id)
		{
			if (!bMmyy(mmyy(ngay))) return null;
			else return get_data("select * from "+user+mmyy(ngay)+".v_chidinh where id="+id).Tables[0];
		}
		public bool kiemtra_sothe(string sothe)
		{
			string val= "QWERTYUIOPASDFGHJKLZXCVBNM0123456789";
			int i=0,len = sothe.Trim().Length;
			bool bError = false;
			while (i < len && !bError)
			{
				bError = val.IndexOf(sothe.Substring(i, 1)) == -1;
				i++;
			}
			try
			{
				int iii=0;
				if(sothe.Length==15 || sothe.Length==20)
				{
					iii=int.Parse(sothe.Substring(2,1));
				}
			}
			catch {bError=true;}
			return bError;
		}
		public DataSet get_data_v(string mmyy,string sql)
		{		
			try
			{
				con=new OracleConnection(get_conn_v(mmyy));
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				dest=new OracleDataAdapter(cmd);
				ds=new DataSet();
				dest.Fill(ds);	
				cmd.Dispose();				
				con.Close();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message.ToString().Trim()+"-SQL:"+sql,sComputer,"?");
			}
			return ds;
		}
		public int iNhompttt
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=143");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 0;}
			}
		}

		public bool upd_m_thongso_tim(string stable, string m_ctlname, string m_ctltext, string m_loai)
		{
			sql = "update " + user + "." + stable + " set controltext=:m_ctltext where controlname=:m_ctlname";
			con = new OracleConnection (sConn);
			try
			{
				con.Open();
				cmd = new OracleCommand(sql, con);
				cmd.CommandType = CommandType.Text;

				cmd.Parameters.Add("m_ctltext", OracleType.NVarChar).Value = m_ctltext;
				cmd.Parameters.Add("m_ctlname", OracleType.VarChar).Value = m_ctlname;

				int irec = cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec == 0)
				{
					sql = "insert into " + user + "." + stable + " (controlname, controltext, loai, ngayud) values (:m_ctlname,:m_ctltext,:m_loai,sysdate)";
					cmd = new OracleCommand(sql, con);
					cmd.CommandType = CommandType.Text;
					cmd.Parameters.Add("m_ctlname", OracleType.VarChar).Value = m_ctlname;
					cmd.Parameters.Add("m_ctltext", OracleType.NVarChar).Value = m_ctltext;
					cmd.Parameters.Add("m_loai", OracleType.VarChar).Value = m_loai;
					irec = cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch (OracleException ex)
			{
				upd_error(ex.Message, sComputer, "upd_m_thongso_tim");
				return false;
			}
			finally
			{
				con.Close(); con.Dispose();
			}
			return true;
		}

		public bool delete_cacdung(string scachdung)
		{
			
			sql="delete d_dmcachdung where ten=:m_ten";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				
				cmd.Parameters.Add("m_ten",OracleType.NVarChar).Value=scachdung;
				cmd.ExecuteNonQuery();
				cmd.Dispose();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"delete_cacdung");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public string f_get_cdkemtheo(string ngay, long m_maql, int i_loai)
		{
			string m_cdkemtheo="", m_icdkemtheo="";
			string xxx="";
			if (i_loai == 1 || i_loai==2) xxx = user;
			else xxx = user + mmyy(ngay.Substring(0, 10));
			sql="select * from "+xxx+".cdkemtheo where maql = "+m_maql +" and loai="+i_loai;
			foreach(DataRow r in get_data(sql).Tables[0].Rows)
			{
				m_cdkemtheo+=(m_cdkemtheo.Trim().IndexOf(r["chandoan"].ToString()+",")<0)?r["chandoan"].ToString()+", ":"";
				m_icdkemtheo+=(m_icdkemtheo.Trim().IndexOf(r["maicd"].ToString()+",")<0)?r["maicd"].ToString()+", ":"";
			}
			if(m_cdkemtheo.Trim().Trim(',')!="")
			{
				return m_cdkemtheo.Trim().Trim(',')+" ["+m_icdkemtheo.Trim().Trim(',')+"]";
			}
			else
				return "";
		}
		public bool bDoituong_co_chenhlech(string smadoituong)
		{
			if(smadoituong.Trim().Trim(',')=="")return false;
			return get_data ("select chenhlech from "+user+".doituong where chenhlech=1 and madoituong in("+smadoituong.Trim().Trim(',')+")").Tables[0].Rows.Count>0;
		}

		public string get_tendoituong(string smadoituong)
		{			
			return get_data ("select doituong from "+user+".doituong where madoituong in("+smadoituong.Trim().Trim(',')+")").Tables[0].Rows[0]["doituong"].ToString();
		}
		public string f_get_mavp_congkham()
		{
			string s_mavpck="";
			string asql="select distinct mavp from btdkp_bv ";
			DataSet lds=get_data(asql);
			foreach(DataRow r in lds.Tables[0].Rows)
			{
				s_mavpck +=r["mavp"].ToString()+",";
			}
			return s_mavpck.Trim().Trim(',');
		}
		public bool bDaduyet_chiphi_mau38(long l_maql, string tu, string den)
		{
			string asql="select mavaovien, id, to_char(ngay,'dd/mm/yyyy')ngay from xxx.bhytkb where maql="+l_maql;
			DataSet lds=get_data_mmyy_d(asql,tu,den,true);
			return lds.Tables[0].Rows.Count>0;
		}
		public int f_get_loaipk(int idkp)
		{
			string asql="select loaikp from d_duockp where id="+idkp;
			try
			{
				return int.Parse(get_data(asql).Tables[0].Rows[0]["loaikp"].ToString());
			}
			catch {return 0;}
		}

		public bool upd_sotoathuoc(string m_yy, string m_makp, long m_sotoa)
		{
			sql="update d_sotoathuoc set sotoa=:m_sotoa where makp=:m_makp and yy=:m_yy";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_sotoa",OracleType.Number).Value=m_sotoa;
				cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
				cmd.Parameters.Add("m_yy",OracleType.VarChar,2).Value=m_yy;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into d_sotoathuoc (sotoa,makp,yy) values (:m_sotoa,:m_makp,:m_yy)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_sotoa",OracleType.Number).Value=m_sotoa;
					cmd.Parameters.Add("m_makp",OracleType.VarChar,2).Value=m_makp;
					cmd.Parameters.Add("m_yy",OracleType.VarChar,2).Value=m_yy;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"d_sotoathuoc");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}
		public long f_get_sotoa_thuocF3(string m_yy,string m_makp)
		{
			long l_sotoa=0;
			sql="select sotoa+1 as sotoa from d_sotoathuoc where makp='"+m_makp+"' and yy='"+m_yy+"'";
			DataSet lds=get_data(sql);
			if(lds!=null && lds.Tables.Count<0)
			{
				l_sotoa=1;				
			}
			else if(lds.Tables[0].Rows.Count==0) l_sotoa=1;
			else l_sotoa=long.Parse(lds.Tables[0].Rows[0]["sotoa"].ToString());
			upd_sotoathuoc(m_yy,m_makp,l_sotoa);
			return l_sotoa;
		}

		#region thongso_binh
		public bool bPTTT_Xuatvien
		{
			//1: Khi BN xuat vien van cho nhap PTTT
			//0: Khi BN xuat vien  khong cho nhap PTTT
			get
			{
				try
				{
					DataSet ds = get_data("select ten from " + user + ".thongso where id=1004");//I13 
					return int.Parse(ds.Tables[0].Rows[0][0].ToString()) == 1;
				}
				catch { return false; }
			}
		}
		public bool bCapve_Phongluu
		{
			//1: Khi BN xuat vien van cho nhap PTTT
			//0: Khi BN xuat vien  khong cho nhap PTTT
			get
			{
				try
				{
					DataSet ds = get_data("select ten from " + user + ".thongso where id=1002");//I13 
					return int.Parse(ds.Tables[0].Rows[0][0].ToString()) == 1;
				}
				catch { return false; }
			}
		}
		public bool bBhytTraituyen_vuotdinhmuc
		{
			//E23
			//1: Khi BN Trai tuyen: chi phi <100.000: moi tinh ty le bn tra
			//0: Khi BN Trai tuyen: luong tinh ty le BN tra
			get
			{
				try
				{
					DataSet ds = get_data("select ten from " + user + ".thongso where id=1005");//I13 
					return int.Parse(ds.Tables[0].Rows[0][0].ToString()) == 1;
				}
				catch { return false; }
			}
		}
		public bool bTienGiuongTudong_khongtinh
		{
			//E23
			//1: Chi quan ly phong giuong, nhung khong tinh tien giuong
			//0: quan ly phong giuong, va tinh tien giuong tu dong
			get
			{
				try
				{
					DataSet ds = get_data("select ten from " + user + ".thongso where id=1006");//I13 
					return int.Parse(ds.Tables[0].Rows[0][0].ToString()) == 1;
				}
				catch { return false; }
			}
		}

		public bool bPKThu2_tinhtheogia_taikham
		{
			//G71
			//1: Khi dang ky cung luc nhieu phong kham, phong kham thu 2 tro di tinh theo gia tai kham
			//0: Phong kham nao tinh theo gia kham tung ung cua phong kham do
			get
			{
				try
				{
					DataSet ds = get_data("select ten from " + user + ".thongso where id=1007");//I13 
					return int.Parse(ds.Tables[0].Rows[0][0].ToString()) == 1;
				}
				catch { return false; }
			}
		}

		public bool bDangkykham_bhyt_khongchoChidinh
		{
			//Tab ccan lam sang
			//1: Khi dang ky neu la BHYT khong duoc phep chi dinh
			//0: duoc phap chi dinh cho tat ca doi tuong
			get
			{
				try
				{
					DataSet ds = get_data("select ten from " + user + ".thongso where id=1008");//I13 
					return int.Parse(ds.Tables[0].Rows[0][0].ToString()) == 1;
				}
				catch { return false; }
			}
		}
		public bool bSovaovien_tudong_ngoaitru_chungnoitru
		{
			//Tab MS tu dong
			//1: So ngoai tru tang tu dong, tang lien tuc chung voi noi tru
			//0: khong tang tu dong
			get
			{
				try
				{
					DataSet ds = get_data("select ten from " + user + ".thongso where id=1009");//I13 
					return int.Parse(ds.Tables[0].Rows[0][0].ToString()) == 1;
				}
				catch { return false; }
			}
		}

		public bool bSovaovien_tudong_ngoaitru_rieng
		{
			//Tab MS tu dong
			//1: So ngoai tru tang tu dong, tang theo day so rieng: dua table capid where ma=-5
			//0: khong tang tu dong
			get
			{
				try
				{
					DataSet ds = get_data("select ten from " + user + ".thongso where id=1010");//I13 
					return int.Parse(ds.Tables[0].Rows[0][0].ToString()) == 1;
				}
				catch { return false; }
			}
		}
		public bool bSuadt_vienphi
		{
			//chi sua doi tuong ban dau trong thuoc
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1011");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		public bool bLocThuoc_doituong
		{
			//1: Khi load danh muc thuoc thi load theo doi tuong
			//0: load tat ca, khi luu moi xu ly lai doi tuong
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1012");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return true;}
			}
		}
		public bool bCaptoaBHYT_S_T_C_T
		{
			//F49: cap toa sang - trua - chieu - toi
			//1: Nhap co 4 o sang - trua - chieu - toi
			//0: Nhap theo cach cu
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1013");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bNgoaitru_suathongtinnhapvien
		{
			//C05.1: Sua thong tin nhap vien trong ngoai tru			
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1014");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		public bool bDoituong_BHYT(int imadoituong)
		{
			bool bBHYT=false;
			if(imadoituong==1) bBHYT =true;
			else
			{
				string sql1="select madoituong, doituong from "+user+".doituong where madoituong="+imadoituong+" and bhyt>0";
				try
				{
					DataSet lds=get_data(sql1);

					bBHYT=lds.Tables[0].Rows.Count>0;
				}
				catch {bBHYT=false;}
			}
			return bBHYT;
		}
		public bool bDoituong_BHYT(int imadoituong, DataTable dtdoituong)
		{
			bool bBHYT=false;
			if(imadoituong==1) bBHYT =true;
			else
			{
				DataRow dr=getrowbyid(dtdoituong,"bhyt>0 and madoituong="+imadoituong.ToString());
				bBHYT = dr!=null;				
			}
			return bBHYT;
		}
		public bool bDoituong_BHYT(string smadoituong)
		{
			bool bBHYT=false;
			if(smadoituong=="1") bBHYT =true;
			else if (smadoituong.Trim()=="")bBHYT=false;
			else
			{
				string sql1="select madoituong, doituong from "+user+".doituong where madoituong="+smadoituong +" and bhyt>0";
				try
				{
					DataSet lds=get_data(sql1);

					bBHYT=lds.Tables[0].Rows.Count>0;
				}
				catch {bBHYT=false;}
			}
			return bBHYT;
		}
		public bool bDoituong_BHYT(string smadoituong, DataTable dtdoituong)
		{
			bool bBHYT=false;
			if(smadoituong =="1") bBHYT =true;
			else if(smadoituong.Trim()=="") bBHYT=false;
			else
			{
				DataRow dr=getrowbyid(dtdoituong,"bhyt>0 and madoituong="+smadoituong.ToString());
				bBHYT = dr!=null;				
			}
			return bBHYT;
		}
		public string sMaDoituong_BHYT()
		{
			string sMadtBHYT="1,";			
			string sql1="select madoituong, doituong from "+user+".doituong where madoituong<>1 and bhyt>0";
			foreach(DataRow dr in get_data(sql1).Tables[0].Rows)
			{
				sMadtBHYT+=dr["madoituong"].ToString()+",";
			}
			
			return sMadtBHYT;
		}

		public bool bDoituong_cochenhlech(string m_madoituong)
		{
			bool bCochenhlech=false;
			
			string sql1="select madoituong, doituong, chenhlech from "+user+".doituong where madoituong="+m_madoituong+" and chenhlech>0";
			try
			{
				DataSet lds=get_data(sql1);

				bCochenhlech=lds.Tables[0].Rows.Count>0;
			}
			catch {bCochenhlech=false;}
			
			return bCochenhlech;
		}
		public bool bInchuky_chidinh
		{
			//H14
			get
			{
				try
				{					
					DataSet ds=get_data("select ten from thongso where id=1030");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		public bool bInchuky_chidinh_phongkham
		{
			//H14.1
			get
			{
				try
				{					
					DataSet ds=get_data("select ten from thongso where id=1031");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		public bool bInchuky_chidinh_phongluu
		{
			//H14.2
			get
			{
				try
				{					
					DataSet ds=get_data("select ten from thongso where id=1032");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		public bool bInchuky_chidinh_noitru
		{
			//H14.3
			get
			{
				try
				{					
					DataSet ds=get_data("select ten from thongso where id=1033");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		public bool bThuoc_Hoichan_Khong_BHYT
		{
			//F53
			get
			{
				try
				{					
					DataSet ds=get_data("select ten from thongso where id=1034");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public int iDoituong_thuoc_hoichan
		{
			//F54
			get
			{
				try
				{					
					DataSet ds=get_data("select ten from thongso where id=1035");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 2;}
			}
		}
		public int iDoituong_thuoc_cho_BGD_duyet
		{
			//F56
			get
			{
				try
				{					
					DataSet ds=get_data("select ten from thongso where id=1036");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 2;}
			}
		}
		public bool bThuoc_BGDDuyet_Khong_BHYT
		{
			//F55
			get
			{
				try
				{					
					DataSet ds=get_data("select ten from thongso where id=1037");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bThanhtoan_theokhoa
		{
			//G32.1
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1038");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		public bool bBieu2_nhapvien_la_nhapkhoa
		{
			//A18
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1039");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return true;}
			}
		}//Thuy 24.04.2012
		public bool bChoPhepSuaChanDoanTrongGiayRaVien
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1059");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return true;}
			}
		}
		public bool bTiengiuong_khoadau_ra_vao_1
		{
			//
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1040");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return true;}
			}
		}
		public bool bkhonginchidinh_dathuchien
		{
			//
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1041");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		public string sDoituong_1lankham_chicaptoa1lan
		{
			//
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1042");
					return ds.Tables[0].Rows[0][0].ToString();
				}
				catch{return "";}
			}
		}
		public bool bBHYT_Traituyen_tinh_Tyle_khac
		{
			//E23
			//true lay trong v_giavp.bhyt_tt
			get
			{
				try
				{
					DataSet ds = get_data("select ten from " + user + ".thongso where id=1046");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString()) == 1;
				}
				catch { return false; }
			}
		}

		public bool bBNraphongluu_Khongxuattutruc
		{
			//F58
			//true : bat buot phai lay van tay
			get
			{
				try
				{
					DataSet ds = get_data("select ten from " + user + ".thongso where id=1048");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString()) == 1;
				}
				catch { return false; }
			}
		}

		public bool bVienphiKhoa_lietkegia
		{
			//H16
			get
			{
				try
				{
					DataSet ds = get_data("select ten from " + user + ".thongso where id=1050");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString()) == 1;
				}
				catch { return false; }
			}
		}

		public bool bToaBHYT_dain_khongchohuy
		{
			//F60
			get
			{
				try
				{
					DataSet ds = get_data("select ten from " + user + ".thongso where id=1051");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString()) == 1;
				}
				catch { return false; }
			}
		}
		public bool bChuyenkham_tinhcongkham_bhyt
		{
			//G68.1
			get
			{
				try
				{
					DataSet ds = get_data("select ten from " + user + ".thongso where id=1052");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString()) == 1;
				}
				catch { return bChuyenkham_tinhcong; }
			}
		}
		public bool bDutru_khongnhapsole
		{
			//F61
			get
			{
				try
				{
					DataSet ds = get_data("select ten from " + user + ".thongso where id=1053");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString()) == 1;
				}
				catch { return false; }
			}
		}
		public bool bSoluutru_bang_sovaovien_ngoaitru
		{
			//D31
			get
			{
				try
				{
					DataSet ds = get_data("select ten from " + user + ".thongso where id=1054");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString()) == 1;
				}
				catch { return false; }
			}
		}

		public bool bSoluutru_phongluu_tangtudong_khive
		{
			//D32
			get
			{
				try
				{
					DataSet ds = get_data("select ten from " + user + ".thongso where id=1055");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString()) == 1;
				}
				catch { return false; }
			}
		}

		public bool bXuattutruc_khongchophep_lonhon_ngayhienhanh
		{
			//F62
			get
			{
				try
				{
					DataSet ds = get_data("select ten from " + user + ".thongso where id=1056");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString()) == 1;
				}
				catch { return false; }
			}
		}

		public bool bQuanly_tuongtacthuoc
		{
			//F63
			get
			{
				try
				{
					DataSet ds = get_data("select ten from " + user + ".thongso where id=1057");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString()) == 1;
				}
				catch { return false; }
			}
		}
		
		public string s_Matuyetruoc_khongnhap_chandoan
		{
			//C61
			get
			{
				try
				{
					DataSet ds = get_data("select ten from " + user + ".thongso where id=1071");
					return ds.Tables[0].Rows[0][0].ToString();
				}
				catch { return ""; }
			}
		}
		//
		public string s_Mabv_dttreem
		{
			//C61
			get
			{
				try
				{
					DataSet ds = get_data("select ten from " + user + ".thongso where id=1072");
					return ds.Tables[0].Rows[0][0].ToString();
				}
				catch { return ""; }
			}
		}

		public bool bThanhtoanchenhlech_thuoc
		{
			//G74
			get
			{
				try
				{
					DataSet ds = get_data("select ten from " + user + ".thongso where id=1073");
					return ds.Tables[0].Rows[0][0].ToString()=="1";
				}
				catch { return false; }
			}
		}
		public bool bMatreem_cv531_10022011
		{
			//G74
			get
			{
				try
				{
					DataSet ds = get_data("select ten from " + user + ".thongso where id=1074");
					return ds.Tables[0].Rows[0][0].ToString()=="1";
				}
				catch { return false; }
			}
		}


		public bool bPhongluu_daravien(string m_mabn, long m_maql)
		{
			bool bln=false;
			string sql="select mabn, maql, to_char(ngay,'dd/mm/yyyy') ngay, ttlucrv from "+user+".xuatvien where mabn='"+m_mabn+"' and maql="+m_maql+" and makp='99'";
			DataSet lds=get_data(sql);
			if(lds!=null && lds.Tables.Count>0 && lds.Tables[0].Rows.Count>0) bln=true;
			return bln;
		}
		#endregion thongso_binh

		#region EMR
		public bool upd_emr_dm(decimal v_id, decimal v_id_loai, decimal v_stt, string v_ma, string v_ten, string v_viettat, string v_ghichu, string v_giatri, decimal v_userid)
		{
			sql="update emr_dm set id_loai=:v_id_loai,stt=:v_stt,ma=:v_ma,ten=:v_ten,viettat=:v_viettat,ghichu=:v_ghichu,giatri=:v_giatri,userid=:v_userid where id=:v_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("v_id_loai",OracleType.Number).Value=v_id_loai;
				cmd.Parameters.Add("v_stt",OracleType.Number).Value=v_stt;
				cmd.Parameters.Add("v_ma",OracleType.NVarChar,50).Value=v_ma;
				cmd.Parameters.Add("v_ten",OracleType.NVarChar,500).Value=v_ten;
				cmd.Parameters.Add("v_viettat",OracleType.NVarChar,250).Value=v_viettat;
				cmd.Parameters.Add("v_ghichu",OracleType.NVarChar,250).Value=v_ghichu;
				cmd.Parameters.Add("v_giatri",OracleType.NVarChar,2000).Value=v_giatri;
				cmd.Parameters.Add("v_userid",OracleType.Number).Value=v_userid;
				cmd.Parameters.Add("v_id",OracleType.Number).Value=v_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into emr_dm (id,id_loai,stt,ma,ten,viettat,ghichu,giatri,userid) values (:v_id,:v_id_loai,:v_stt,:v_ma,:v_ten,:v_viettat,:v_ghichu,:v_giatri,:v_userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("v_id",OracleType.Number).Value=v_id;
					cmd.Parameters.Add("v_id_loai",OracleType.Number).Value=v_id_loai;
					cmd.Parameters.Add("v_stt",OracleType.Number).Value=v_stt;
					cmd.Parameters.Add("v_ma",OracleType.NVarChar,50).Value=v_ma;
					cmd.Parameters.Add("v_ten",OracleType.NVarChar,500).Value=v_ten;
					cmd.Parameters.Add("v_viettat",OracleType.NVarChar,250).Value=v_viettat;
					cmd.Parameters.Add("v_ghichu",OracleType.NVarChar,250).Value=v_ghichu;
					cmd.Parameters.Add("v_giatri",OracleType.NVarChar,2000).Value=v_giatri;
					cmd.Parameters.Add("v_userid",OracleType.Number).Value=v_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(Exception ex)//OracleException ex)
			{
				upd_error(ex.Message,sComputer,"emr_dm");
				return false;
			}
			finally
			{
				con.Close();
				con.Dispose();
			}		
			return true;
		}

		public bool upd_emr_dmmau(decimal v_id, decimal v_id_emr, decimal v_stt, string v_noidung, decimal v_macdinh, decimal v_userid)
		{
			sql="update emr_dmmau set id_emr=:v_id_emr,stt=:v_stt,noidung=:v_noidung,macdinh=:v_macdinh,userid=:v_userid where id=:v_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("v_id_emr",OracleType.Number).Value=v_id_emr;
				cmd.Parameters.Add("v_stt",OracleType.Number).Value=v_stt;
				cmd.Parameters.Add("v_noidung",OracleType.NVarChar,500).Value=v_noidung;
				cmd.Parameters.Add("v_macdinh",OracleType.Number).Value=v_macdinh;
				cmd.Parameters.Add("v_userid",OracleType.Number).Value=v_userid;
				cmd.Parameters.Add("v_id",OracleType.Number).Value=v_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into emr_dmmau(id,id_emr,stt,noidung,macdinh,userid) values (:v_id,:v_id_emr,:v_stt,:v_noidung,:v_macdinh,:v_userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("v_id",OracleType.Number).Value=v_id;
					cmd.Parameters.Add("v_id_emr",OracleType.Number).Value=v_id_emr;
					cmd.Parameters.Add("v_stt",OracleType.Number).Value=v_stt;
					cmd.Parameters.Add("v_noidung",OracleType.NVarChar,500).Value=v_noidung;
					cmd.Parameters.Add("v_macdinh",OracleType.Number).Value=v_macdinh;
					cmd.Parameters.Add("v_userid",OracleType.Number).Value=v_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"emr_dmmau");
				return false;
			}
			finally
			{
				con.Close();
				con.Dispose();
			}		
			return true;
		}

		public bool upd_emr_noidungll(decimal v_id, string v_mabn, decimal v_mavaovien, decimal v_maql, decimal v_loaiba, decimal v_loaiphieu, string v_ngay16, string v_mabs, string v_ghichu, decimal v_userid, string v_chandoan, string v_maicd)
		{
			sql="update emr_noidungll set mabn=:v_mabn,mavaovien=:v_mavaovien,maql=:v_maql,loaiba=:v_loaiba,loaiphieu=:v_loaiphieu,ngay=to_date(:v_ngay,'dd/mm/yyyy hh24:mi'),mabs=:v_mabs,ghichu=:v_ghichu,userid=:v_userid, chandoan=:v_chandoan, maicd=:v_maicd where id=:v_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("v_mabn",OracleType.NVarChar,8).Value=v_mabn;
				cmd.Parameters.Add("v_mavaovien",OracleType.Number).Value=v_mavaovien;
				cmd.Parameters.Add("v_maql",OracleType.Number).Value=v_maql;
				cmd.Parameters.Add("v_loaiba",OracleType.Number).Value=v_loaiba;
				cmd.Parameters.Add("v_loaiphieu",OracleType.Number).Value=v_loaiphieu;
				cmd.Parameters.Add("v_ngay",OracleType.NVarChar,16).Value=v_ngay16;
				cmd.Parameters.Add("v_mabs",OracleType.NVarChar,4).Value=v_mabs;
				cmd.Parameters.Add("v_ghichu",OracleType.NVarChar,500).Value=v_ghichu;
				cmd.Parameters.Add("v_userid",OracleType.Number).Value=v_userid;
				cmd.Parameters.Add("v_chandoan",OracleType.NVarChar,255).Value=v_chandoan;
				cmd.Parameters.Add("v_maicd",OracleType.VarChar,9).Value=v_maicd;
				cmd.Parameters.Add("v_id",OracleType.Number).Value=v_id;

				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into emr_noidungll(id,mabn,mavaovien,maql,loaiba,loaiphieu,ngay,mabs,ghichu,userid, chandoan, maicd) values (:v_id,:v_mabn,:v_mavaovien,:v_maql,:v_loaiba,:v_loaiphieu,to_date(:v_ngay,'dd/mm/yyyy hh24:mi'),:v_mabs,:v_ghichu,:v_userid, :v_chandoan, :v_maicd)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("v_id",OracleType.Number).Value=v_id;
					cmd.Parameters.Add("v_mabn",OracleType.NVarChar,8).Value=v_mabn;
					cmd.Parameters.Add("v_mavaovien",OracleType.Number).Value=v_mavaovien;
					cmd.Parameters.Add("v_maql",OracleType.Number).Value=v_maql;
					cmd.Parameters.Add("v_loaiba",OracleType.Number).Value=v_loaiba;
					cmd.Parameters.Add("v_loaiphieu",OracleType.Number).Value=v_loaiphieu;
					cmd.Parameters.Add("v_ngay",OracleType.NVarChar,16).Value=v_ngay16;
					cmd.Parameters.Add("v_mabs",OracleType.NVarChar,4).Value=v_mabs;
					cmd.Parameters.Add("v_ghichu",OracleType.NVarChar,500).Value=v_ghichu;
					cmd.Parameters.Add("v_userid",OracleType.Number).Value=v_userid;
					cmd.Parameters.Add("v_chandoan",OracleType.NVarChar,255).Value=v_chandoan;
					cmd.Parameters.Add("v_maicd",OracleType.VarChar,9).Value=v_maicd;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"emr_noidungll");
				return false;
			}
			finally
			{
				con.Close();
				con.Dispose();
			}		
			return true;
		}

		public bool upd_emr_noidungct(decimal v_id, decimal v_id_emr, decimal v_stt, string v_ketqua, string v_ghichu, decimal v_userid)
		{
			sql="update emr_noidungct set ketqua=:v_ketqua,ghichu=:v_ghichu,userid=:v_userid where id=:v_id and id_emr=:v_id_emr and stt=:v_stt";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("v_ketqua",OracleType.NVarChar,500).Value=v_ketqua;
				cmd.Parameters.Add("v_ghichu",OracleType.NVarChar,500).Value=v_ghichu;
				cmd.Parameters.Add("v_userid",OracleType.Number).Value=v_userid;
				cmd.Parameters.Add("v_id",OracleType.Number).Value=v_id;
				cmd.Parameters.Add("v_id_emr",OracleType.Number).Value=v_id_emr;
				cmd.Parameters.Add("v_stt",OracleType.Number).Value=v_stt;
				
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into emr_noidungct(id,id_emr,stt,ketqua,ghichu,userid) values (:v_id,:v_id_emr,:v_stt,:v_ketqua,:v_ghichu,:v_userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("v_id",OracleType.Number).Value=v_id;
					cmd.Parameters.Add("v_id_emr",OracleType.Number).Value=v_id_emr;
					cmd.Parameters.Add("v_stt",OracleType.Number).Value=v_stt;
					cmd.Parameters.Add("v_ketqua",OracleType.NVarChar,8).Value=v_ketqua;
					cmd.Parameters.Add("v_ghichu",OracleType.NVarChar,500).Value=v_ghichu;
					cmd.Parameters.Add("v_userid",OracleType.Number).Value=v_userid;
					
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"emr_noidungct");
				return false;
			}
			finally
			{
				con.Close();
				con.Dispose();
			}		
			return true;
		}

		#endregion

		#region dingduong_kimquang
		//		public bool upd_di_hoantract(string mmyy,long d_id,int d_stt,string d_ngay,decimal d_madoituong,decimal d_idthucdon,decimal d_slyeucau,decimal d_slthuc,string d_ghichu,decimal d_vpkhoa)
		//		{
		//			con = new OracleConnection(sConn);
		//			try
		//			{
		//				con.Open();
		//				string sql = "update " + user + mmyy + ".di_hoantract set ngay=to_date('"+ d_ngay + "','dd/mm/yyyy'),madoituong=" + d_madoituong +",idthucdon='"+d_idthucdon+"',slyeucau=" + d_slyeucau + ",slthuc="+d_slthuc+",ghichu='"+d_ghichu+ "',vpkhoa="+ d_vpkhoa +" where id=" + d_id + " and stt=" + d_stt;
		//				cmd = new OracleCommand(sql, con);
		//				if (cmd.ExecuteNonQuery() == 0)
		//				{
		//					sql = "insert into " + user + mmyy + ".di_hoantract(id,stt,ngay,madoituong,idthucdon,slyeucau,slthuc,ghichu,vpkhoa)";
		//					sql += " values(" + d_id + "," + d_stt + ",to_date('" + d_ngay + "','dd/mm/yyyy')," + d_madoituong + "," + d_idthucdon + "," + d_slyeucau + "," + d_slthuc +",'"+ d_ghichu + "'," + d_vpkhoa + ")";
		//					cmd.CommandText = sql;
		//					cmd.ExecuteNonQuery();
		//				}
		//			}
		//			catch (Exception ex) { upd_di_error(ex.Message, sComputer, "di_hoantract"); return false; }
		//			finally {con.Close();con.Dispose();}
		//			return true;
		//		}
		//		public bool upd_di_hoantract(string mmyy,long d_id,int d_stt,string d_ngay,decimal d_madoituong,decimal d_idthucdon,decimal d_slyeucau,decimal d_slthuc,string d_ghichu,decimal d_vpkhoa,int idgioan,string id_thucdonct)
		//		{
		//			con = new OracleConnection(sConn);
		//			try
		//			{
		//				con.Open();
		//				string sql = "update " + user + mmyy + ".di_hoantract set ngay=to_date('"+ d_ngay + "','dd/mm/yyyy'),madoituong=" + d_madoituong +",idthucdon='"+d_idthucdon+"',slyeucau=" + d_slyeucau + ",slthuc="+d_slthuc+",ghichu=:d_ghichu ,vpkhoa="+ d_vpkhoa +",idgioan="+idgioan+",idthucdonct="+id_thucdonct+" where id=" + d_id + " and stt=" + d_stt;
		//				cmd = new OracleCommand(sql, con);
		//				cmd.CommandType= CommandType.Text;
		//				cmd.Parameters.Add("d_ghichu",OracleType.NVarChar,500).Value=d_ghichu;
		//				if (cmd.ExecuteNonQuery() == 0)
		//				{
		//					cmd.Dispose();
		//					sql = "insert into " + user + mmyy + ".di_hoantract(id,stt,ngay,madoituong,idthucdon,slyeucau,slthuc,ghichu,vpkhoa,idgioan,idthucdonct)";
		//					sql += " values(" + d_id + "," + d_stt + ",to_date('" + d_ngay + "','dd/mm/yyyy')," + d_madoituong + "," + d_idthucdon + "," + d_slyeucau + "," + d_slthuc +",:d_ghichu," + d_vpkhoa + ","+idgioan+","+id_thucdonct+")";
		//					cmd= new OracleCommand(sql,con);
		//					cmd.CommandType = CommandType.Text;
		//					cmd.Parameters.Add("d_ghichu",OracleType.NVarChar,500).Value = d_ghichu;
		//					cmd.ExecuteNonQuery();
		//				}
		//			}
		//			catch (Exception ex) { upd_di_error(ex.Message, sComputer, "di_hoantract"); return false; }
		//			finally 
		//			{
		//				con.Close();
		//				con.Dispose();
		//				cmd.Dispose();
		//			}
		//			return true;
		//		}
		//		public bool upd_di_hoantrall(string mmyy,long d_id,long d_idduyet,string d_mabn,long d_maql,long d_idkhoa)
		//		{
		//			con = new OracleConnection(sConn);
		//			try
		//			{
		//				con.Open();
		//				string sql = "update " + user + mmyy + ".di_hoantrall set idduyet=" + d_idduyet + ",mabn= '" + d_mabn +"',maql=" + d_maql + ",idkhoa=" + d_idkhoa;
		//				sql+= " where id=" + d_id;
		//				cmd = new OracleCommand(sql, con);
		//				if (cmd.ExecuteNonQuery() == 0)
		//				{
		//					sql = "insert into " + user + mmyy + ".di_hoantrall (id,idduyet,mabn,maql,idkhoa)";
		//					sql += " values(" + d_id + "," + d_idduyet + ",'" + d_mabn + "'," + d_maql + "," + d_idkhoa +")";
		//					cmd.CommandText = sql;
		//					cmd.ExecuteNonQuery();
		//				}
		//			}
		//			catch (Exception ex) { upd_di_error(ex.Message, sComputer, "di_hoantrall"); return false; }
		//			finally {con.Close();con.Dispose();}
		//			return true;
		//		}
		//		public bool upd_di_hoantrall(string mmyy,long d_id,long d_idduyet,string d_mabn,long d_maql,long d_idkhoa,string d_ngayhoantra)
		//		{
		//			con = new OracleConnection(sConn);
		//			try
		//			{
		//				con.Open();
		//				string sql = "update " + user + mmyy + ".di_hoantrall set idduyet=" + d_idduyet + ",mabn= '" + d_mabn +"',maql=" + d_maql + ",idkhoa=" + d_idkhoa + ",ngayhoantra=to_date('"+ d_ngayhoantra + "','dd/mm/yyyy')";
		//				sql+= " where id=" + d_id;
		//				cmd = new OracleCommand(sql, con);
		//				if (cmd.ExecuteNonQuery() == 0)
		//				{
		//					sql = "insert into " + user + mmyy + ".di_hoantrall (id,idduyet,mabn,maql,idkhoa, ngayhoantra)";
		//					sql += " values(" + d_id + "," + d_idduyet + ",'" + d_mabn + "'," + d_maql + "," + d_idkhoa + ",to_date('"+ d_ngayhoantra + "','dd/mm/yyyy'))";
		//					cmd.CommandText = sql;
		//					cmd.ExecuteNonQuery();
		//				}
		//			}
		//			catch (Exception ex) { upd_di_error(ex.Message, sComputer, "di_hoantrall"); return false; }
		//			finally {con.Close();con.Dispose();}
		//			return true;
		//		}
		//		public void updrec_di_hoantract(DataTable dt, int stt, int id, string ngay, decimal d_madoituong ,decimal idthucan, string ma, string ten, decimal slyeucau, decimal slthuc, decimal dongia , string ghichu, decimal vpkhoa)
		//		{
		//			string exp = "stt=" + stt;
		//			DataRow r = getrowbyid(dt, exp);
		//			if (r == null)
		//			{
		//				DataRow nrow = dt.NewRow();
		//				nrow["id"] = id;
		//				nrow["stt"] = stt;
		//				nrow["ngay"]= ngay;
		//				nrow["madoituong"]= d_madoituong;
		//				nrow["idthucan"]= idthucan;
		//				nrow["ma"] = ma;
		//				nrow["ten"] = ten;
		//				nrow["slyeucau"] = slyeucau;
		//				nrow["slthuc"] = slthuc;
		//				nrow["dongia"] = dongia;
		//				nrow["ghichu"] = ghichu;
		//				nrow["ngayud"] = DateTime.Now;
		//				nrow["vpkhoa"] = vpkhoa;
		//				dt.Rows.Add(nrow);
		//			}
		//			else
		//			{
		//				DataRow[] dr = dt.Select(exp);
		//				dr[0]["id"] = id;
		//				dr[0]["stt"] = stt;
		//				dr[0]["ngay"] = ngay;
		//				dr[0]["madoituong"] = d_madoituong;
		//				dr[0]["idthucan"] = idthucan;
		//				dr[0]["ma"] = ma;
		//				dr[0]["ten"] = ten;
		//				dr[0]["slyeucau"] = slyeucau;
		//				dr[0]["slthuc"] = slthuc;
		//				dr[0]["dongia"] = dongia;
		//				dr[0]["ghichu"] = ghichu;
		//				dr[0]["ngayud"] = DateTime.Now;
		//				dr[0]["vpkhoa"] = vpkhoa;
		//			}
		//		}
		//		public void updrec_di_hoantract(DataTable dt, int stt, int id, string ngay, decimal d_madoituong ,decimal idthucan, string ma, string ten, decimal slyeucau, decimal slthuc, decimal dongia , string ghichu, decimal vpkhoa,string idgioan,string id_thucdonct,string gioan)
		//		{
		//			string exp = "stt=" + stt;
		//			DataRow r = getrowbyid(dt, exp);
		//			if (r == null)
		//			{
		//				DataRow nrow = dt.NewRow();
		//				nrow["id"] = id;
		//				nrow["stt"] = stt;
		//				nrow["ngay"]= ngay;
		//				nrow["madoituong"]= d_madoituong;
		//				nrow["idthucan"]= idthucan;
		//				nrow["ma"] = ma;
		//				nrow["ten"] = ten;
		//				nrow["slyeucau"] = slyeucau;
		//				nrow["slthuc"] = slthuc;
		//				nrow["dongia"] = dongia;
		//				nrow["ghichu"] = ghichu;
		//				nrow["ngayud"] = DateTime.Now;
		//				nrow["vpkhoa"] = vpkhoa;
		//				nrow["idgioan"] = int.Parse(idgioan==""? "0":idgioan);
		//				nrow["idthucdonct"] = id_thucdonct;
		//				nrow["gioan"] = gioan;
		//				dt.Rows.Add(nrow);
		//			}
		//			else
		//			{
		//				DataRow[] dr = dt.Select(exp);
		//				dr[0]["id"] = id;
		//				dr[0]["stt"] = stt;
		//				dr[0]["ngay"] = ngay;
		//				dr[0]["madoituong"] = d_madoituong;
		//				dr[0]["idthucan"] = idthucan;
		//				dr[0]["ma"] = ma;
		//				dr[0]["ten"] = ten;
		//				dr[0]["slyeucau"] = slyeucau;
		//				dr[0]["slthuc"] = slthuc;
		//				dr[0]["dongia"] = dongia;
		//				dr[0]["ghichu"] = ghichu;
		//				dr[0]["ngayud"] = DateTime.Now;
		//				dr[0]["vpkhoa"] = vpkhoa;
		//				dr[0]["idgioan"] = int.Parse(idgioan==""? "0":idgioan);
		//				dr[0]["idthucdonct"] = id_thucdonct;
		//				dr[0]["gioan"] = gioan;
		//			}
		//		}
		//		public void updrec_di_hoantrall(DataTable dt,long id, long idduyet,string mabn,string hoten,long maql,long idkhoa)
		//		{
		//			string exp="id="+id;
		//			DataRow r = getrowbyid (dt,exp); 
		//			if ( r == null )
		//			{
		//				DataRow nrow = dt.NewRow ( ) ;
		//				nrow["id"] = id;
		//				nrow["idduyet"] = idduyet;
		//				nrow["mabn"] = mabn;
		//				nrow["hoten"] = hoten;
		//				nrow["maql"] = maql;
		//				nrow["idkhoa"] = idkhoa;
		//				dt.Rows.Add ( nrow ) ;
		//			}
		//			else
		//			{
		//				DataRow[] dr = dt.Select(exp);
		//				dr[0]["id"] = id;
		//				dr[0]["idduyet"] = idduyet;
		//				dr[0]["mabn"] = mabn;
		//				dr[0]["hoten"] = hoten;
		//				dr[0]["maql"] = maql;
		//				dr[0]["idkhoa"] = idkhoa;
		//			}
		//		}
		//		public bool upd_di_duyet(string mmyy, long id, string ngay, string makp, int phieu, int sobn, int hienco, int vao, int ra, int cat, int bao,int userid, int loai)
		//		{
		//			con = new OracleConnection(sConn);
		//			con.Open();
		//			string sql = "update " + user + mmyy + ".di_duyet set sobn=" + sobn + ",hienco=" + hienco + ",vao=" + vao + ",ra=" + ra + ",cat=" + cat + ",bao=" + bao + ",loai = " + loai + " where id=" + id;
		//			cmd = new OracleCommand(sql, con);
		//			try
		//			{
		//				if (cmd.ExecuteNonQuery() == 0)
		//				{
		//					sql = "insert into " + user + mmyy + ".di_duyet(id,ngay,makp,phieu,sobn,hienco,vao,ra,cat,bao,done,userid, loai) values(" + id + ",to_date('" + ngay + "','dd/mm/yyyy'),'" + makp + "'," + phieu + "," + sobn + "," + hienco + "," + vao + "," + ra + "," + cat + "," + bao + ",0," + userid + "," + loai +")";
		//					cmd.CommandText = sql;
		//					cmd.ExecuteNonQuery();
		//				}
		//			}
		//			catch (Exception ex) { upd_di_error(ex.Message, sComputer, "di_duyet"); return false; }
		//			finally {con.Close();con.Dispose();}
		//			return true;
		//		}
		//		public bool upd_di_danhmuc(string di_table, long di_id, decimal di_stt, string di_ma, string di_ten, int di_userid, int di_loai)
		//		{
		//			sql = "update " + user+"."+di_table + " set stt=:di_stt,ma=:di_ma,ten=:di_ten,userid=:di_userid, loai=:di_loai where id=:di_id";
		//			con = new OracleConnection(sConn);
		//			try
		//			{
		//				con.Open();
		//				cmd = new OracleCommand(sql, con);
		//				cmd.CommandType = CommandType.Text;
		//				cmd.Parameters.Add("di_stt", OracleType.Number).Value = di_stt;
		//				cmd.Parameters.Add("di_ma", OracleType.VarChar, 10).Value = di_ma;
		//				cmd.Parameters.Add("di_ten", OracleType.NVarChar,254).Value = di_ten;
		//				cmd.Parameters.Add("di_userid", OracleType.Number).Value = di_userid;
		//				cmd.Parameters.Add("di_id", OracleType.Number).Value = di_id;
		//				cmd.Parameters.Add("di_loai", OracleType.Number).Value = di_loai;
		//				int irec = cmd.ExecuteNonQuery();
		//				cmd.Dispose();
		//				if (irec == 0)
		//				{
		//					sql = "insert into " + user+"."+di_table + " (id,stt,ma,ten,userid,loai) values (:di_id,:di_stt,:di_ma,:di_ten,:di_userid,:di_loai)";
		//					cmd = new OracleCommand(sql, con);
		//					cmd.CommandType = CommandType.Text;
		//					cmd.Parameters.Add("di_id", OracleType.Number).Value = di_id;
		//					cmd.Parameters.Add("di_stt", OracleType.Number).Value = di_stt;
		//					cmd.Parameters.Add("di_ma", OracleType.VarChar, 10).Value = di_ma;
		//					cmd.Parameters.Add("di_ten", OracleType.NVarChar,254).Value = di_ten;
		//					cmd.Parameters.Add("di_userid", OracleType.Number).Value = di_userid;
		//					cmd.Parameters.Add("di_loai", OracleType.Number).Value = di_loai;
		//					irec = cmd.ExecuteNonQuery();
		//					cmd.Dispose();
		//				}
		//			}
		//			catch (OracleException ex)
		//			{
		//				upd_di_error(ex.Message, sComputer, di_table);
		//				return false;
		//			}
		//			finally
		//			{
		//				con.Close();con.Dispose();
		//			}
		//			return true;
		//		}
		//		public bool upd_di_kthucdonll(string mmyy, long id, long idduyet,string mabn, long maql, long idkhoa, int madoituong, int idcu, int moi, int dacbiet, string giuong,string maicd,string chandoan,string mabs,string yta,string ghichu)
		//		{
		//			con = new OracleConnection(sConn);
		//			try
		//			{
		//				con.Open();
		//				string sql = "update " + user + mmyy + ".di_kthucdonll set mabn='" + mabn + "',maql=" + maql + ",idkhoa=" + idkhoa ;
		//				sql+=",madoituong=" + madoituong + ",idcu=" + idcu + ",moi=" + moi + ",dacbiet=" + dacbiet + ",giuong='" + giuong + "'";
		//				sql+=",maicd='"+maicd+"'";
		//				sql+=",chandoan=:chandoan";
		//				sql+=",mabs='"+mabs+"',yta='"+yta+"',ghichu=:ghichu where id=" + id;
		//				cmd = new OracleCommand(sql, con);
		//				cmd.Parameters.Add("chandoan", OracleType.NVarChar,254).Value = chandoan;
		//				cmd.Parameters.Add("ghichu", OracleType.NVarChar,254).Value = ghichu;
		//				if (cmd.ExecuteNonQuery() == 0)
		//				{
		//					sql = "insert into " + user + mmyy + ".di_kthucdonll(id,idduyet,mabn,maql,idkhoa,madoituong,idcu,moi,dacbiet,giuong,maicd,chandoan,mabs,yta,ghichu)";
		//					sql += " values(" + id + "," + idduyet + ",'" + mabn + "'," + maql + "," + idkhoa + "," + madoituong + "," + idcu + "," + moi + "," + dacbiet + ",'" + giuong + "','"+maicd+"',:chandoan,'"+mabs+"','"+yta+"',:ghichu)";
		//					cmd.CommandText = sql;
		//					cmd.Parameters.Add("chandoan", OracleType.NVarChar,254).Value = chandoan;
		//					cmd.Parameters.Add("ghichu", OracleType.NVarChar,254).Value = ghichu;
		//					cmd.ExecuteNonQuery();
		//				}
		//			}
		//			catch (Exception ex) { upd_di_error(ex.Message, sComputer, "di_kthucdonll"); return false; }
		//			finally {con.Close();con.Dispose();}
		//			return true;
		//		}
		#endregion
		#region dingduong_kimquang
		public bool upd_di_hoantract(string mmyy,long d_id,int d_stt,string d_ngay,decimal d_madoituong,decimal d_idthucdon,decimal d_slyeucau,decimal d_slthuc,string d_ghichu,decimal d_vpkhoa,int idgioan,string id_thucdonct)
		{
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				string sql = "update " + user + mmyy + ".di_hoantract set ngay=to_date('"+ d_ngay + "','dd/mm/yyyy'),madoituong=" + d_madoituong +",idthucdon='"+d_idthucdon+"',slyeucau=" + d_slyeucau + ",slthuc="+d_slthuc+",ghichu=:d_ghichu ,vpkhoa="+ d_vpkhoa +",idgioan="+idgioan+",idthucdonct="+id_thucdonct+" where id=" + d_id + " and stt=" + d_stt;
				cmd = new OracleCommand(sql, con);
				cmd.CommandType= CommandType.Text;
				cmd.Parameters.Add("d_ghichu",OracleType.NVarChar,500).Value=d_ghichu;
				if (cmd.ExecuteNonQuery() == 0)
				{
					cmd.Dispose();
					sql = "insert into " + user + mmyy + ".di_hoantract(id,stt,ngay,madoituong,idthucdon,slyeucau,slthuc,ghichu,vpkhoa,idgioan,idthucdonct)";
					sql += " values(" + d_id + "," + d_stt + ",to_date('" + d_ngay + "','dd/mm/yyyy')," + d_madoituong + "," + d_idthucdon + "," + d_slyeucau + "," + d_slthuc +",:d_ghichu," + d_vpkhoa + ","+idgioan+","+id_thucdonct+")";
					cmd= new OracleCommand(sql,con);
					cmd.CommandType = CommandType.Text;
					cmd.Parameters.Add("d_ghichu",OracleType.NVarChar,500).Value = d_ghichu;
					cmd.ExecuteNonQuery();
				}
			}
			catch (Exception ex) { upd_di_error(ex.Message, sComputer, "di_hoantract"); return false; }
			finally 
			{
				con.Close();
				con.Dispose();
				cmd.Dispose();
			}
			return true;
		}
		public bool upd_di_hoantrall(string mmyy,long d_id,long d_idduyet,string d_mabn,long d_maql,long d_idkhoa)
		{
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				string sql = "update " + user + mmyy + ".di_hoantrall set idduyet=" + d_idduyet + ",mabn= '" + d_mabn +"',maql=" + d_maql + ",idkhoa=" + d_idkhoa;
				sql+= " where id=" + d_id;
				cmd = new OracleCommand(sql, con);
				cmd.CommandType=CommandType.Text;
				if (cmd.ExecuteNonQuery() == 0)
				{
					cmd.Dispose();
					sql = "insert into " + user + mmyy + ".di_hoantrall (id,idduyet,mabn,maql,idkhoa)";
					sql += " values(" + d_id + "," + d_idduyet + ",'" + d_mabn + "'," + d_maql + "," + d_idkhoa +")";
					cmd = new OracleCommand(sql,con);
					cmd.CommandType = CommandType.Text;
					cmd.ExecuteNonQuery();
				}
			}
			catch (Exception ex) { upd_di_error(ex.Message, sComputer, "di_hoantrall"); return false; }
			finally {con.Close();con.Dispose();cmd.Dispose();}
			return true;
		}

		public bool upd_di_hoantrall(string mmyy,long d_id,long d_idduyet,string d_mabn,long d_maql,long d_idkhoa,string d_ngayhoantra)
		{
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				string sql = "update " + user + mmyy + ".di_hoantrall set idduyet=" + d_idduyet + ",mabn= '" + d_mabn +"',maql=" + d_maql + ",idkhoa=" + d_idkhoa + ",ngayhoantra=to_date('"+ d_ngayhoantra + "','dd/mm/yyyy')";
				sql+= " where id=" + d_id;
				cmd = new OracleCommand(sql, con);
				if (cmd.ExecuteNonQuery() == 0)
				{
					sql = "insert into " + user + mmyy + ".di_hoantrall (id,idduyet,mabn,maql,idkhoa, ngayhoantra)";
					sql += " values(" + d_id + "," + d_idduyet + ",'" + d_mabn + "'," + d_maql + "," + d_idkhoa + ",to_date('"+ d_ngayhoantra + "','dd/mm/yyyy'))";
					cmd.CommandText = sql;
					cmd.ExecuteNonQuery();
				}
			}
			catch (Exception ex) { upd_di_error(ex.Message, sComputer, "di_hoantrall"); return false; }
			finally {con.Close();con.Dispose();}
			return true;
		}
		public void updrec_di_hoantract(DataTable dt, int stt, int id, string ngay, decimal d_madoituong ,decimal idthucan, string ma, string ten, decimal slyeucau, decimal slthuc, decimal dongia , string ghichu, decimal vpkhoa,string idgioan,string id_thucdonct,string gioan)
		{
			string exp = "stt=" + stt;
			DataRow r = getrowbyid(dt, exp);
			if (r == null)
			{
				DataRow nrow = dt.NewRow();
				nrow["id"] = id;
				nrow["stt"] = stt;
				nrow["ngay"]= ngay;
				nrow["madoituong"]= d_madoituong;
				nrow["idthucan"]= idthucan;
				nrow["ma"] = ma;
				nrow["ten"] = ten;
				nrow["slyeucau"] = slyeucau;
				nrow["slthuc"] = slthuc;
				nrow["dongia"] = dongia;
				nrow["ghichu"] = ghichu;
				nrow["ngayud"] = DateTime.Now;
				nrow["vpkhoa"] = vpkhoa;
				nrow["idgioan"] = int.Parse(idgioan==""? "0":idgioan);
				nrow["idthucdonct"] = id_thucdonct;
				nrow["gioan"] = gioan;
				dt.Rows.Add(nrow);
			}
			else
			{
				DataRow[] dr = dt.Select(exp);
				dr[0]["id"] = id;
				dr[0]["stt"] = stt;
				dr[0]["ngay"] = ngay;
				dr[0]["madoituong"] = d_madoituong;
				dr[0]["idthucan"] = idthucan;
				dr[0]["ma"] = ma;
				dr[0]["ten"] = ten;
				dr[0]["slyeucau"] = slyeucau;
				dr[0]["slthuc"] = slthuc;
				dr[0]["dongia"] = dongia;
				dr[0]["ghichu"] = ghichu;
				dr[0]["ngayud"] = DateTime.Now;
				dr[0]["vpkhoa"] = vpkhoa;
				dr[0]["idgioan"] = int.Parse(idgioan==""? "0":idgioan);
				dr[0]["idthucdonct"] = id_thucdonct;
				dr[0]["gioan"] = gioan;
			}
		}
		public void updrec_di_hoantrall(DataTable dt,long id, long idduyet,string mabn,string hoten,long maql,long idkhoa)
		{
			string exp="id="+id;
			DataRow r = getrowbyid (dt,exp); 
			if ( r == null )
			{
				DataRow nrow = dt.NewRow ( ) ;
				nrow["id"] = id;
				nrow["idduyet"] = idduyet;
				nrow["mabn"] = mabn;
				nrow["hoten"] = hoten;
				nrow["maql"] = maql;
				nrow["idkhoa"] = idkhoa;
				dt.Rows.Add ( nrow ) ;
			}
			else
			{
				DataRow[] dr = dt.Select(exp);
				dr[0]["id"] = id;
				dr[0]["idduyet"] = idduyet;
				dr[0]["mabn"] = mabn;
				dr[0]["hoten"] = hoten;
				dr[0]["maql"] = maql;
				dr[0]["idkhoa"] = idkhoa;
			}
		}
		public bool upd_di_duyet(string mmyy, long id, string ngay, string makp, int phieu, int sobn, int hienco, int vao, int ra, int cat, int bao,int userid, int loai)
		{
			con = new OracleConnection(sConn);
			con.Open();
			string sql = "update " + user + mmyy + ".di_duyet set sobn=" + sobn + ",hienco=" + hienco + ",vao=" + vao + ",ra=" + ra + ",cat=" + cat + ",bao=" + bao + ",loai = " + loai + " where id=" + id;
			cmd = new OracleCommand(sql, con);
			try
			{
				if (cmd.ExecuteNonQuery() == 0)
				{
					sql = "insert into " + user + mmyy + ".di_duyet(id,ngay,makp,phieu,sobn,hienco,vao,ra,cat,bao,done,userid, loai) values(" + id + ",to_date('" + ngay + "','dd/mm/yyyy'),'" + makp + "'," + phieu + "," + sobn + "," + hienco + "," + vao + "," + ra + "," + cat + "," + bao + ",0," + userid + "," + loai +")";
					cmd.CommandText = sql;
					cmd.ExecuteNonQuery();
				}
			}
			catch (Exception ex) { upd_di_error(ex.Message, sComputer, "di_duyet"); return false; }
			finally {con.Close();con.Dispose();}
			return true;
		}
		public bool upd_di_danhmuc(string di_table, long di_id, decimal di_stt, string di_ma, string di_ten, int di_userid, int di_loai)
		{
			sql = "update " + user+"."+di_table + " set stt=:di_stt,ma=:di_ma,ten=:di_ten,userid=:di_userid, loai=:di_loai where id=:di_id";
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd = new OracleCommand(sql, con);
				cmd.CommandType = CommandType.Text;
				cmd.Parameters.Add("di_stt", OracleType.Number).Value = di_stt;
				cmd.Parameters.Add("di_ma", OracleType.VarChar, 10).Value = di_ma;
				cmd.Parameters.Add("di_ten", OracleType.NVarChar,254).Value = di_ten;
				cmd.Parameters.Add("di_userid", OracleType.Number).Value = di_userid;
				cmd.Parameters.Add("di_id", OracleType.Number).Value = di_id;
				cmd.Parameters.Add("di_loai", OracleType.Number).Value = di_loai;
				int irec = cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec == 0)
				{
					sql = "insert into " + user+"."+di_table + " (id,stt,ma,ten,userid,loai) values (:di_id,:di_stt,:di_ma,:di_ten,:di_userid,:di_loai)";
					cmd = new OracleCommand(sql, con);
					cmd.CommandType = CommandType.Text;
					cmd.Parameters.Add("di_id", OracleType.Number).Value = di_id;
					cmd.Parameters.Add("di_stt", OracleType.Number).Value = di_stt;
					cmd.Parameters.Add("di_ma", OracleType.VarChar, 10).Value = di_ma;
					cmd.Parameters.Add("di_ten", OracleType.NVarChar,254).Value = di_ten;
					cmd.Parameters.Add("di_userid", OracleType.Number).Value = di_userid;
					cmd.Parameters.Add("di_loai", OracleType.Number).Value = di_loai;
					irec = cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch (OracleException ex)
			{
				upd_di_error(ex.Message, sComputer, di_table);
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}
			return true;
		}
		#endregion
		/// <summary>
		/// Nhóm viện phí của chi phí vận chuyển, ID của bảng v_nhomvp
		/// </summary>
		public int IDNhomVienPhiVanChuyen
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1060");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return -1;}
			}
		}
		public string TenNhomVienPhiVanChuyen
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from v_nhomvp where ma in(select ten from thongso where id=1060)");
					return ds.Tables[0].Rows[0][0].ToString();
				}
				catch{return "";}
			}
		}//
		int i_Soledongiakhithanhtoan=0;
		/// <summary>
		/// Làm tròn số lẻ của đơn giá khi thanh toán, cả thuốc + dịch vụ
		/// </summary>
		public int SoLeDonGiaKhiThanhToan
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1061");
					i_Soledongiakhithanhtoan= int.Parse(ds.Tables[0].Rows[0][0].ToString());
					return i_Soledongiakhithanhtoan;
				}
				catch{return 0;}
			}
			set
			{
				i_Soledongiakhithanhtoan=value;
			}
		}
		string s_Madtthehuong100cpvc="1+2+4+6";
		public string MaDoiTuongTheHuong100CPVC
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1063");
					s_Madtthehuong100cpvc= ds.Tables[0].Rows[0][0].ToString().Trim('+').Replace("+",",");
					return s_Madtthehuong100cpvc.Trim(',');
				}
				catch{return "";}
			}
			set
			{
				s_Madtthehuong100cpvc=value;
			}
		}

		public bool bMedibv(string s_table)
		{
			try
			{
				return get_data("select * from dba_users where username='"+s_table.ToUpper()+"'").Tables[0].Rows.Count >0;
			}
			catch
			{
				return false;
			}

		}
		#region Chuyen_pkg_code
		public bool upd_duyet(long d_id,int d_nhom,string d_ngay,int d_loai,int d_phieu,int d_makp,int d_done,string d_mmyy,int d_userid,int d_makhoa)
		{
			sql=" update d_duyet set nhom=:d_nhom,ngay=to_date(:d_ngay,'dd/mm/yyyy'),loai=:d_loai,phieu=:d_phieu,makp=:d_makp,mmyy=:d_mmyy,userid=:d_userid,makhoa=:d_makhoa where id=:d_id";						
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;//.StoredProcedure;				
				cmd.Parameters.Add("d_nhom",OracleType.Number).Value=d_nhom;
				cmd.Parameters.Add("d_ngay",OracleType.VarChar,10).Value=d_ngay;
				cmd.Parameters.Add("d_loai",OracleType.Number).Value=d_loai;
				cmd.Parameters.Add("d_phieu",OracleType.Number).Value=d_phieu;
				cmd.Parameters.Add("d_makp",OracleType.Number).Value=d_makp;
				//cmd.Parameters.Add("d_done",OracleType.Number).Value=d_done;
				cmd.Parameters.Add("d_mmyy",OracleType.VarChar,4).Value=d_mmyy;
				cmd.Parameters.Add("d_userid",OracleType.Number).Value=d_userid;
				cmd.Parameters.Add("d_makhoa",OracleType.Number).Value=d_makhoa;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				int irec=cmd.ExecuteNonQuery();
				if(irec==0)
				{
					sql="insert into d_duyet(id,nhom,ngay,loai,phieu,makp,done,mmyy,userid,makhoa) values (:d_id,:d_nhom,to_date(:d_ngay,'dd/mm/yyyy'),:d_loai,:d_phieu,:d_makp,:d_done,:d_mmyy,:d_userid,:d_makhoa)";
					cmd.Dispose();
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;//.StoredProcedure;					
					cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
					cmd.Parameters.Add("d_nhom",OracleType.Number).Value=d_nhom;
					cmd.Parameters.Add("d_ngay",OracleType.VarChar,10).Value=d_ngay;
					cmd.Parameters.Add("d_loai",OracleType.Number).Value=d_loai;
					cmd.Parameters.Add("d_phieu",OracleType.Number).Value=d_phieu;
					cmd.Parameters.Add("d_makp",OracleType.Number).Value=d_makp;
					cmd.Parameters.Add("d_done",OracleType.Number).Value=d_done;
					cmd.Parameters.Add("d_mmyy",OracleType.VarChar,4).Value=d_mmyy;
					cmd.Parameters.Add("d_userid",OracleType.Number).Value=d_userid;
					cmd.Parameters.Add("d_makhoa",OracleType.Number).Value=d_makhoa;
					
					cmd.ExecuteNonQuery();
				}
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_duyet");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_dutrull(long d_id,long d_idduyet,string d_mabn,long d_maql,long d_idkhoa)
		{
			sql="update d_dutrull set idduyet=:d_idduyet,mabn=:d_mabn,maql=:d_maql,idkhoa=:d_idkhoa where id=:d_id";
			
			con=new OracleConnection(sConn);

			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				
				cmd.Parameters.Add("d_idduyet",OracleType.Number).Value=d_idduyet;
				cmd.Parameters.Add("d_mabn",OracleType.VarChar,8).Value=d_mabn;
				cmd.Parameters.Add("d_maql",OracleType.Number).Value=d_maql;
				cmd.Parameters.Add("d_idkhoa",OracleType.Number).Value=d_idkhoa;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				int irec=cmd.ExecuteNonQuery();
				if(irec==0)
				{
					sql=" insert into d_dutrull(id,idduyet,mabn,maql,idkhoa) values (:d_id,:d_idduyet,:d_mabn,:d_maql,:d_idkhoa)";
					cmd.Dispose();
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;

					cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
					cmd.Parameters.Add("d_idduyet",OracleType.Number).Value=d_idduyet;
					cmd.Parameters.Add("d_mabn",OracleType.VarChar,8).Value=d_mabn;
					cmd.Parameters.Add("d_maql",OracleType.Number).Value=d_maql;
					cmd.Parameters.Add("d_idkhoa",OracleType.Number).Value=d_idkhoa;
					cmd.ExecuteNonQuery();
				}
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_dutrull");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}
		public bool upd_dutrull(long d_id,long d_idduyet,string d_mabn,long d_maql,long d_idkhoa,decimal d_songay)
		{
			sql=" update d_dutrull set idduyet=:d_idduyet,mabn=:d_mabn,maql=:d_maql,idkhoa=:d_idkhoa,songay=:d_songay where id=:d_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				
				cmd.Parameters.Add("d_idduyet",OracleType.Number).Value=d_idduyet;
				cmd.Parameters.Add("d_mabn",OracleType.VarChar,8).Value=d_mabn;
				cmd.Parameters.Add("d_maql",OracleType.Number).Value=d_maql;
				cmd.Parameters.Add("d_idkhoa",OracleType.Number).Value=d_idkhoa;
				cmd.Parameters.Add("d_songay",OracleType.Number).Value=d_songay;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				int irec=cmd.ExecuteNonQuery();
				if(irec==0)
				{
					sql=" insert into d_dutrull(id,idduyet,mabn,maql,idkhoa,songay) values (:d_id,:d_idduyet,:d_mabn,:d_maql,:d_idkhoa,:d_songay)";
					cmd.Dispose();
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
					cmd.Parameters.Add("d_idduyet",OracleType.Number).Value=d_idduyet;
					cmd.Parameters.Add("d_mabn",OracleType.VarChar,8).Value=d_mabn;
					cmd.Parameters.Add("d_maql",OracleType.Number).Value=d_maql;
					cmd.Parameters.Add("d_idkhoa",OracleType.Number).Value=d_idkhoa;
					cmd.Parameters.Add("d_songay",OracleType.Number).Value=d_songay;
					cmd.ExecuteNonQuery();
				}
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_dutrull");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}
		public bool upd_dausinhton(long d_id,long d_idkhoa,long d_iddutru,string d_ngay,string d_mabs,string d_manv,decimal d_mach,decimal d_nhietdo,string d_huyetap,decimal d_nhiptho,int d_cannang,string d_phong,string d_giuong,string d_ghichu)
		{
			sql=" update d_dausinhton set idkhoa=:d_idkhoa,iddutru=:d_iddutru,ngay=to_date(:d_ngay,'dd/mm/yyyy hh24:mi'),mabs=:d_mabs,manv=:d_manv,mach=:d_mach,nhietdo=:d_nhietdo,huyetap=:d_huyetap,nhiptho=:d_nhiptho,cannang=:d_cannang,phong=:d_phong,giuong=:d_giuong,ghichu=:d_ghichu where id=:d_id";			
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				
				cmd.Parameters.Add("d_idkhoa",OracleType.Number).Value=d_idkhoa;
				cmd.Parameters.Add("d_iddutru",OracleType.Number).Value=d_iddutru;
				cmd.Parameters.Add("d_ngay",OracleType.VarChar,16).Value=d_ngay;
				cmd.Parameters.Add("d_mabs",OracleType.VarChar,4).Value=d_mabs;
				cmd.Parameters.Add("d_manv",OracleType.VarChar,4).Value=d_manv;
				cmd.Parameters.Add("d_mach",OracleType.Number).Value=d_mach;
				cmd.Parameters.Add("d_nhietdo",OracleType.Number).Value=d_nhietdo;
				cmd.Parameters.Add("d_huyetap",OracleType.VarChar,7).Value=d_huyetap;
				cmd.Parameters.Add("d_nhiptho",OracleType.Number).Value=d_nhiptho;
				cmd.Parameters.Add("d_cannang",OracleType.Number).Value=d_cannang;
				cmd.Parameters.Add("d_phong",OracleType.VarChar,10).Value=d_phong;
				cmd.Parameters.Add("d_giuong",OracleType.VarChar,10).Value=d_giuong;
				cmd.Parameters.Add("d_ghichu",OracleType.NVarChar,50).Value=d_ghichu;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				int irec=cmd.ExecuteNonQuery();
				if(irec==0)
				{
					sql=" insert into d_dausinhton(id,idkhoa,iddutru,ngay,mabs,manv,mach,nhietdo,huyetap,nhiptho,cannang,phong,giuong,ghichu) ";
					sql+=" values (:d_id,:d_idkhoa,:d_iddutru,to_date(:d_ngay,'dd/mm/yyyy hh24:mi'),:d_mabs,:d_manv,:d_mach,:d_nhietdo,:d_huyetap,:d_nhiptho,:d_cannang,:d_phong,:d_giuong,:d_ghichu)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
					cmd.Parameters.Add("d_idkhoa",OracleType.Number).Value=d_idkhoa;
					cmd.Parameters.Add("d_iddutru",OracleType.Number).Value=d_iddutru;
					cmd.Parameters.Add("d_ngay",OracleType.VarChar,16).Value=d_ngay;
					cmd.Parameters.Add("d_mabs",OracleType.VarChar,4).Value=d_mabs;
					cmd.Parameters.Add("d_manv",OracleType.VarChar,4).Value=d_manv;
					cmd.Parameters.Add("d_mach",OracleType.Number).Value=d_mach;
					cmd.Parameters.Add("d_nhietdo",OracleType.Number).Value=d_nhietdo;
					cmd.Parameters.Add("d_huyetap",OracleType.VarChar,7).Value=d_huyetap;
					cmd.Parameters.Add("d_nhiptho",OracleType.Number).Value=d_nhiptho;
					cmd.Parameters.Add("d_cannang",OracleType.Number).Value=d_cannang;
					cmd.Parameters.Add("d_phong",OracleType.VarChar,10).Value=d_phong;
					cmd.Parameters.Add("d_giuong",OracleType.VarChar,10).Value=d_giuong;
					cmd.Parameters.Add("d_ghichu",OracleType.NVarChar,50).Value=d_ghichu;
					cmd.ExecuteNonQuery();

				}
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_dausinhton");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		public bool upd_dausinhton(long d_id,long d_idkhoa,long d_iddutru,string d_ngay,string d_mabs,string d_manv,decimal d_mach,decimal d_nhietdo,string d_huyetap,decimal d_nhiptho,int d_cannang,string d_phong,string d_giuong,string d_ghichu,string d_nuoctieu,string d_phan)
		{

			sql=" update d_dausinhton set idkhoa=:d_idkhoa,iddutru=:d_iddutru,ngay=to_date(:d_ngay,'dd/mm/yyyy hh24:mi'),mabs=:d_mabs,manv=:d_manv,mach=:d_mach,nhietdo=:d_nhietdo,huyetap=:d_huyetap,nhiptho=:d_nhiptho,cannang=:d_cannang,phong=:d_phong,giuong=:d_giuong,ghichu=:d_ghichu,nuoctieu=:d_nuoctieu,phan=:d_phan where id=:d_id";
			
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("d_idkhoa",OracleType.Number).Value=d_idkhoa;
				cmd.Parameters.Add("d_iddutru",OracleType.Number).Value=d_iddutru;
				cmd.Parameters.Add("d_ngay",OracleType.VarChar,16).Value=d_ngay;
				cmd.Parameters.Add("d_mabs",OracleType.VarChar,4).Value=d_mabs;
				cmd.Parameters.Add("d_manv",OracleType.VarChar,4).Value=d_manv;
				cmd.Parameters.Add("d_mach",OracleType.Number).Value=d_mach;
				cmd.Parameters.Add("d_nhietdo",OracleType.Number).Value=d_nhietdo;
				cmd.Parameters.Add("d_huyetap",OracleType.VarChar,7).Value=d_huyetap;
				cmd.Parameters.Add("d_nhiptho",OracleType.Number).Value=d_nhiptho;
				cmd.Parameters.Add("d_cannang",OracleType.Number).Value=d_cannang;
				cmd.Parameters.Add("d_phong",OracleType.VarChar,10).Value=d_phong;
				cmd.Parameters.Add("d_giuong",OracleType.VarChar,10).Value=d_giuong;
				cmd.Parameters.Add("d_ghichu",OracleType.NVarChar,50).Value=d_ghichu;
				cmd.Parameters.Add("d_nuoctieu",OracleType.NVarChar,100).Value=d_nuoctieu;
				cmd.Parameters.Add("d_phan",OracleType.NVarChar,100).Value=d_phan;
				cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
				int irec=cmd.ExecuteNonQuery();
				if(irec==0)
				{
					sql=" insert into d_dausinhton(id,idkhoa,iddutru,ngay,mabs,manv,mach,nhietdo,huyetap,nhiptho,cannang,phong,giuong,ghichu,nuoctieu,phan) ";
					sql+=" values (:d_id,:d_idkhoa,:d_iddutru,to_date(:d_ngay,'dd/mm/yyyy hh24:mi'),:d_mabs,:d_manv,:d_mach,:d_nhietdo,:d_huyetap,:d_nhiptho,:d_cannang,:d_phong,:d_giuong,:d_ghichu,:d_nuoctieu,:d_phan)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("d_id",OracleType.Number).Value=d_id;
					cmd.Parameters.Add("d_idkhoa",OracleType.Number).Value=d_idkhoa;
					cmd.Parameters.Add("d_iddutru",OracleType.Number).Value=d_iddutru;
					cmd.Parameters.Add("d_ngay",OracleType.VarChar,16).Value=d_ngay;
					cmd.Parameters.Add("d_mabs",OracleType.VarChar,4).Value=d_mabs;
					cmd.Parameters.Add("d_manv",OracleType.VarChar,4).Value=d_manv;
					cmd.Parameters.Add("d_mach",OracleType.Number).Value=d_mach;
					cmd.Parameters.Add("d_nhietdo",OracleType.Number).Value=d_nhietdo;
					cmd.Parameters.Add("d_huyetap",OracleType.VarChar,7).Value=d_huyetap;
					cmd.Parameters.Add("d_nhiptho",OracleType.Number).Value=d_nhiptho;
					cmd.Parameters.Add("d_cannang",OracleType.Number).Value=d_cannang;
					cmd.Parameters.Add("d_phong",OracleType.VarChar,10).Value=d_phong;
					cmd.Parameters.Add("d_giuong",OracleType.VarChar,10).Value=d_giuong;
					cmd.Parameters.Add("d_ghichu",OracleType.NVarChar,50).Value=d_ghichu;
					cmd.Parameters.Add("d_nuoctieu",OracleType.NVarChar,100).Value=d_nuoctieu;
					cmd.Parameters.Add("d_phan",OracleType.NVarChar,100).Value=d_phan;
					cmd.ExecuteNonQuery();
				}
			}
			catch(Exception ex)
			{
				upd_error(ex.Message,sComputer,"d_dausinhton");
				return false;
			}
			finally
			{
				cmd.Dispose();
				con.Close();con.Dispose();
			}
			return true;
		}

		#endregion
		public bool upd_henpttt(long m_id,string m_mabn,long m_mavaovien,long m_maql,string m_maicd,string m_chandoan,
			string m_huongdieutri,string m_ngayvaovien,int m_userid)
		{
			sql="update pttt_hen set mabn=:m_mabn,mavaovien=:m_mavaovien,maql=:m_maql,maicd=:m_maicd,chandoan=:m_chandoan, ";
			sql+="huongdieutri=:m_huongdieutri,ngayvaovien=to_date(:m_ngayvaovien,'dd/mm/yyyy hh24:mi'),userid=:m_userid ";
			sql+="where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_mabn",OracleType.VarChar,254).Value=m_mabn;
				cmd.Parameters.Add("m_mavaovien",OracleType.Number,254).Value=m_mavaovien;
				cmd.Parameters.Add("m_maql",OracleType.Number,254).Value=m_maql;
				cmd.Parameters.Add("m_maicd",OracleType.VarChar,30).Value=m_maicd;
				cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,254).Value=m_chandoan;
				cmd.Parameters.Add("m_huongdieutri",OracleType.NVarChar,254).Value=m_huongdieutri;
				cmd.Parameters.Add("m_ngayvaovien",OracleType.VarChar,30).Value=m_ngayvaovien;
				cmd.Parameters.Add("m_userid",OracleType.Number,30).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number,30).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into pttt_hen(id,mabn,mavaovien,maql,maicd,chandoan,huongdieutri,ngayvaovien,userid) ";
					sql+="values (:m_id,:m_mabn,:m_mavaovien,:m_maql,:m_maicd,:m_chandoan,:m_huongdieutri,to_date(:m_ngayvaovien,'dd/mm/yyyy hh24:mi'),:m_userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.VarChar,30).Value=m_id;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar,254).Value=m_mabn;
					cmd.Parameters.Add("m_mavaovien",OracleType.Number,254).Value=m_mavaovien;
					cmd.Parameters.Add("m_maql",OracleType.Number,254).Value=m_maql;
					cmd.Parameters.Add("m_maicd",OracleType.VarChar,30).Value=m_maicd;
					cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,254).Value=m_chandoan;
					cmd.Parameters.Add("m_huongdieutri",OracleType.NVarChar,254).Value=m_huongdieutri;
					cmd.Parameters.Add("m_ngayvaovien",OracleType.VarChar,30).Value=m_ngayvaovien;
					cmd.Parameters.Add("m_userid",OracleType.Number,30).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"pttt_hen");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}	
			return true;
		}

		public bool f_daduyet_mau38(string m_ngay, string m_mabn, long m_mavaovien)
		{
			sql="select id, ngay from xxx.bhytkb where mabn='"+m_mabn+"' and mavaovien="+m_mavaovien;
			DataSet lds=get_data_mmyy_d(sql,m_ngay,m_ngay,true);
			if(lds==null || lds.Tables.Count<=0 || lds.Tables[0].Rows.Count<=0) return false;
			else return lds.Tables[0].Rows.Count>0;
		}
		public bool f_daduyet_mau38(string m_ngay, string m_mabn, long m_mavaovien, long m_maql)//thanhcuong-14082011
		{
			sql="select id, ngay from xxx.bhytkb where mabn='"+m_mabn+"' and mavaovien="+m_mavaovien+" and maql="+m_maql;
			DataSet lds=get_data_mmyy_d(sql,m_ngay,m_ngay,true);
			if(lds==null || lds.Tables.Count<=0 || lds.Tables[0].Rows.Count<=0) return false;
			else return lds.Tables[0].Rows.Count>0;
		}
		public string f_get_nhomkho_dlogin(int i_userid)
		{
			sql="select nhomkho from dlogin where id="+i_userid;
			DataSet lds=get_data(sql);
			if(lds==null ||lds.Tables.Count<0 || lds.Tables[0].Rows.Count<=0) return "";
			else return lds.Tables[0].Rows[0]["nhomkho"].ToString();
		}
		#region ThanhCuong
		public bool bSuaThongTin_F10//ThanhCuong 16/04/2012
		{
			//Cho phép sửa thông tin BN trong F10
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1155");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		public bool bTiepDon_CapTheMoi//ThanhCuong 07/04/2012
		{
			//Mỗi lần tiếp đón là cấp thẻ TE mới
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1154");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		public bool b_khamdichvu_chenhlech// nam ngay 12/06/2012
		{
			
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=2542");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}

		public bool bcapmavaovienkhacnhautrongngay  // nam ngay 19/07/2012 G88 
		{
			
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=2543");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		public bool bMien_dmNguon //thanhcuong-19072011
		{
			//F21. Chức năng miễn trong danh mục nguồn (Duoc)
			get
			{
				try
				{
					DataSet ds=get_data("select ten from d_thongso where id=1023");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		public bool bMien_dmKho //thanhcuong-19072011
		{
			//F21. Chức năng miễn trong danh mục kho (Duoc)
			get
			{
				try
				{
					DataSet ds=get_data("select ten from d_thongso where id=1024");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		public bool bBH_chitra_1congkham_ConLaiKhongTinh
		{
			//ThanhCuong-27062011
			//G72.1 BN BHYT đăng ký khám nhiều PHÒNG KHÁM DỊCH VỤ (hoặc chuyển khám), BHYT chỉ trả công khám đầu còn lại không tính
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1090");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		public string makpXuatTuTrucThayBNphongluu
		{
			//các mã khoa phòng xuất tủ trực thấy bệnh nhân phòng lưu
			get
			{
				try
				{
					ds=get_data("select ten from thongso where id=1085");
					if (ds.Tables[0].Rows.Count==0) return "";
					return ds.Tables[0].Rows[0][0].ToString().Trim();
				}
				catch{return "";}
			}
		}
		public string makpCDthayBNphongluu
		{
			//các mã khoa phòng chỉ định thấy bệnh nhân phòng lưu
			get
			{
				try
				{
					ds=get_data("select ten from thongso where id=1087");
					if (ds.Tables[0].Rows.Count==0) return "";
					return ds.Tables[0].Rows[0][0].ToString().Trim();
				}
				catch{return "";}
			}
		}
		public int get_sophieucls(string mmyy, string mabn, long mavaovien, string ngay, int madoituong, int userid)
		{
			int so = 0;
			string xxx = user + mmyy;
			DataTable dt = get_data("select so from " + xxx + ".v_sophieucls where so<>0 and mabn='" + mabn + "' and mavaovien=" + mavaovien + " and to_char(ngay,'dd/mm/yyyy')='" + ngay + "' and madoituong=" + madoituong).Tables[0];
			if (dt.Rows.Count > 0)
			{
				so = int.Parse(dt.Rows[0]["so"].ToString());
				execute_data("update " + xxx + ".v_sophieucls set lanin=lanin+1 where mabn='" + mabn + "' and mavaovien=" + mavaovien + " and to_char(ngay,'dd/mm/yyyy')='" + ngay + "' and madoituong=" + madoituong);
			}
			else
			{
				sql = "update " + xxx + ".d_capsotoa set sotoa=sotoa+1 where id=-89 and to_char(ngay,'dd/mm/yyyy')='" + ngay + "'";
				if (madoituong < 0) sql += " and loai=" + madoituong;
				else if (madoituong == 1) sql += " and loai=0";
				else sql += " and loai=1";
				sql += " and userid=" + userid;
				if (con != null)
				{
					con.Close(); con.Dispose();
				}
				con = new OracleConnection(sConn);
				con.Open();
				cmd = new OracleCommand(sql, con);
				cmd.CommandType = CommandType.Text;
				cmd.ExecuteNonQuery();
				cmd.Dispose();
				//
				sql = "select sotoa from " + xxx + ".d_capsotoa where id=-89 and to_char(ngay,'dd/mm/yyyy')='" + ngay + "'";
				if (madoituong < 0) sql += " and loai=" + madoituong;
				else if (madoituong == 1) sql += " and loai=0";
				else sql += " and loai=1";
				sql += " and userid=" + userid;
				cmd = new OracleCommand(sql, con);
				cmd.CommandType = CommandType.Text;
				dest = new OracleDataAdapter(cmd);
				ds = new DataSet();
				dest.Fill(ds);
				cmd.Dispose();
				//
				con.Close(); con.Dispose();
				so = int.Parse(ds.Tables[0].Rows[0]["sotoa"].ToString());
				upd_sophieucls(mmyy, mabn, mavaovien, ngay, madoituong, so, userid);
			}
			return so;
		}
		public void upd_sophieucls(string mmyy, string mabn, long mavaovien, string ngay, int madoituong, int so, int userid)
		{
			sql = "insert into " + user + mmyy + ".v_sophieucls(mabn,mavaovien,ngay,madoituong,so,lanin,userid) values ('" + mabn + "'," + mavaovien + ",to_date('" + ngay + "','dd/mm/yyyy hh24:mi')," + madoituong + "," + so + ",1," + userid + ")";
			execute_data(sql);
		}
		
		public bool bKhoaCDthayBNphongluu
		{
			//H21. Khoa chỉ định thấy bệnh nhân phòng lưu
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1086");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		public bool bKhoaXuatTuTrucThayBNphongluu
		{
			//F65. Khoa xuất tủ trực thấy bệnh nhân phòng lưu
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1084");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		public bool bDoituong_ngoaitru
		{
			//c62.
			//Nếu là true thì chỉ có quyền admin mới được sửa đối tượng trong bệnh án ngoại trú.
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1080");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		public bool bTTRV_ChiLayMaBenh_KhiXuaKhoa
		{
			//c68.
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1135");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		public bool bTTRV_ChiLayMaBenh_KhiXuatVien
		{
			//c69.
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1156");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		public bool bDanhSach_ChoKham//ThanhCuong 19/05/2012
		{
			//c70.
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1157");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		public bool bQuanLyDieuDuongkb//ThanhCuong 28/05/2012
		{
			//c71.
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1159");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		public int songaychokham
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1158");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 3;}
			}
		}
		public bool bXuatkhoa_Xuatvien_ngaygio
		{
			//c64.
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1136");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		public bool bCPVC_TinhTyLe
		{
			//G77.1
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1137");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		public bool bKoQuanLy_lichhen
		{
			//c65
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1138");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		public bool bUserSuaTD
		{
			//c66
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1139");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		public bool bBHYT_CK_1PK_1CK
		{
			//G68.2
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1140");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		//		public bool bTTgiuong
		//		{
		//			//Phóng Giường (Trong ngày BN chuyển giường thì tính tiền giường có giờ lâu hơn(in TTRV))
		//			get
		//			{
		//				try
		//				{
		//					DataSet ds=get_data("select ten from thongso where id=1139");
		//					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
		//				}
		//				catch{return false;}
		//			}
		//		}
		public bool bChiDinhDangKy
		{
			//H.18
			//Nếu là true thì chỉ có quyền admin mới được nhập trong frmTiepdon
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1078");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		public bool bchiDinh_VPNhapKhoa
		{
			//H.19
			//Nếu là true thì chỉ có quyền admin mới được nhập trong frmNhapkhoa
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1079");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		//ThanhCuong - Quản lý chống nhiễm khuẩn
		public bool upd_nhiemkhuan(long m_id,string m_mabn,long m_maql,long m_mavaovien,long m_idkhoa,string m_ngaynhiem,string m_ngaykhoinhiem,
			string m_chandoan,int m_userid)
		{
			sql="update nhiemkhuan set mabn=:m_mabn,maql=:m_maql,mavaovien=:m_mavaovien,idkhoa=:m_idkhoa,ngaynhiem=to_date(:m_ngaynhiem,'dd/mm/yyyy'),ngaykhoinhiem=to_date(:m_ngaykhoinhiem,'dd/mm/yyyy'),chandoan=:m_chandoan,userid=:m_userid ";
			sql+="where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
				cmd.Parameters.Add("m_maql",OracleType.Number,22).Value=m_maql;
				cmd.Parameters.Add("m_mavaovien",OracleType.Number,22).Value=m_mavaovien;
				cmd.Parameters.Add("m_idkhoa",OracleType.Number,22).Value=m_idkhoa;
				cmd.Parameters.Add("m_ngaynhiem",OracleType.VarChar,30).Value=m_ngaynhiem;
				if(m_ngaykhoinhiem!="" && m_ngaykhoinhiem!="  /  /    " && m_ngaykhoinhiem!="/  /") cmd.Parameters.Add("m_ngaykhoinhiem",OracleType.VarChar,30).Value=m_ngaykhoinhiem;
				else cmd.Parameters.Add("m_ngaykhoinhiem",OracleType.VarChar,30).Value=DBNull.Value;
				cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,254).Value=m_chandoan;
				cmd.Parameters.Add("m_userid",OracleType.Number,7).Value=m_userid;
				cmd.Parameters.Add("m_id",OracleType.Number,22).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into nhiemkhuan(id,mabn,maql,mavaovien,idkhoa,ngaynhiem,ngaykhoinhiem,chandoan,userid) ";
					sql+="values (:m_id,:m_mabn,:m_maql,:m_mavaovien,:m_idkhoa,to_date(:m_ngaynhiem,'dd/mm/yyyy'),to_date(:m_ngaykhoinhiem,'dd/mm/yyyy'),:m_chandoan,:m_userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number,22).Value=m_id;
					cmd.Parameters.Add("m_mabn",OracleType.VarChar,8).Value=m_mabn;
					cmd.Parameters.Add("m_maql",OracleType.Number,22).Value=m_maql;
					cmd.Parameters.Add("m_mavaovien",OracleType.Number,22).Value=m_mavaovien;
					cmd.Parameters.Add("m_idkhoa",OracleType.Number,22).Value=m_idkhoa;//ThanhCuong
					cmd.Parameters.Add("m_ngaynhiem",OracleType.VarChar,30).Value=m_ngaynhiem;
					if(m_ngaykhoinhiem!="" && m_ngaykhoinhiem!="  /  /    " && m_ngaykhoinhiem!="/  /") cmd.Parameters.Add("m_ngaykhoinhiem",OracleType.VarChar,30).Value=m_ngaykhoinhiem;
					else cmd.Parameters.Add("m_ngaykhoinhiem",OracleType.VarChar,30).Value=DBNull.Value;
					cmd.Parameters.Add("m_chandoan",OracleType.NVarChar,254).Value=m_chandoan;
					cmd.Parameters.Add("m_userid",OracleType.Number,7).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"nhiemkhuan");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}	
			return true;
		} 
		public bool upd_nhiemkhuan_ks(long m_id,int m_mabd,string m_ngay,decimal m_soluong,int m_userid)
		{
			sql="update nhiemkhuan_ks set soluong=(soluong+"+m_soluong+"),userid=:m_userid ";
			sql+="where id=:m_id and mabd=:m_mabd and ngay=to_date(:m_ngay,'dd/mm/yyyy')";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				//				cmd.Parameters.Add("m_soluong",OracleType.Number).Value=m_soluong;
				cmd.Parameters.Add("m_userid",OracleType.Number,7).Value=m_userid;
				if(m_ngay!="") cmd.Parameters.Add("m_ngay",OracleType.VarChar,30).Value=m_ngay;
				else cmd.Parameters.Add("m_ngay",OracleType.VarChar,30).Value=DBNull.Value;
				cmd.Parameters.Add("m_mabd",OracleType.Number,7).Value=m_mabd;
				cmd.Parameters.Add("m_id",OracleType.Number,22).Value=m_id;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into nhiemkhuan_ks(id,mabd,ngay,soluong,userid) ";
					sql+="values (:m_id,:m_mabd,to_date(:m_ngay,'dd/mm/yyyy'),:m_soluong,:m_userid)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number,22).Value=m_id;
					cmd.Parameters.Add("m_mabd",OracleType.Number,7).Value=m_mabd;
					if(m_ngay!="") cmd.Parameters.Add("m_ngay",OracleType.VarChar,30).Value=m_ngay;
					else cmd.Parameters.Add("m_ngay",OracleType.VarChar,30).Value=DBNull.Value;
					cmd.Parameters.Add("m_soluong",OracleType.Number).Value=m_soluong;
					cmd.Parameters.Add("m_userid",OracleType.Number,7).Value=m_userid;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"nhiemkhuan_ks");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}	
			return true;
		} 
		//Tạo id nhiễm khuẩn
		public long get_id_nhiemkhuan
		{
			get
			{
				return getidyymmdd(15);
			}
		}
		public string get_cholam(string mabn)
		{
			sql = "select cholam from " + user + ".btdbn where mabn='" + mabn + "'";
			ds = get_data(sql);
			if (ds.Tables[0].Rows.Count > 0) return ds.Tables[0].Rows[0]["cholam"].ToString().Trim();
			else return "";
		}
		public bool bAdminInlaidonthuoc
		{
			get
			{
				try
				{
					DataSet ds = get_data("select ten from " + user + ".thongso where id=1141");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString()) == 1;
				}
				catch { return true; }
			}
		}
		public bool bSophieu_chidinh
		{
			get
			{
				try
				{
					return get_data("select ten from " + user + ".thongso where id=1142").Tables[0].Rows[0]["ten"].ToString() == "1";
				}
				catch
				{
					return false;
				}
			}
		}
		public bool bAdminInlaiphieuchidinh
		{
			//H21
			get
			{
				try
				{
					DataSet ds = get_data("select ten from " + user + ".thongso where id=1143");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString()) == 1;
				}
				catch { return true; }
			}
		}
		public bool bChidinh_loaivp
		{
			
			get
			{
				try
				{
					DataSet ds = get_data("select ten from " + user + ".thongso where id=1144");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString()) == 1;
				}
				catch { return false; }
			}
		}
		public bool bChidinh_thutienlien
		{
			get
			{
				try
				{
					DataSet ds = get_data("select ten from " + user + ".thongso where id=1145");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString()) == 1;
				}
				catch { return false; }
			}
		}
		public string mien_chenhlech_cholam
		{
			get
			{
				try
				{
					DataSet ds = get_data("select ten from " + user + ".thongso where id=1146");
					return ds.Tables[0].Rows[0][0].ToString().Trim();
				}
				catch { return ""; }
			}
		}
		public bool bChuky
		{
			get
			{
				try
				{
					DataSet ds = get_data("select ten from " + user + ".thongso where id=1147");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString()) == 1;
				}
				catch { return false; }
			}
		}
		public int mien_chenhlech
		{
			get
			{
				try
				{
					DataSet ds = get_data("select ten from " + user + ".thongso where id=1148");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch { return 0; }
			}
		}
		public int mien_chenhlech_doituong
		{
			get
			{
				try
				{
					DataSet ds = get_data("select ten from " + user + ".thongso where id=1149");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch { return 0; }
			}
		}
		//		public string getkho(int i_thuoc, int i_nhom, bool bThua, DataTable dtmakp, int i_makp, int i_loai, string ngay, DataTable dtletet)
		//		{
		//			string s_makho = "", s_kho = "", s_ngay = ngay, s_khong = "", s_khong1 = "";//, s_nguon_khoa = "";
		//			DataRow r;
		//			bool bPhatthuoc_kho = bPhatthuoc_kho_khoa;
		//			string sPhatthuoc_kho = sPhatthuoc_kho_khoa, s_khophat = iPhatthuoc_kho_khoa.ToString() + ",";
		//			string s_khophat2 = iPhatthuoc_kho_khoa2.ToString().ToString() + ",";
		//			string s_khoa_tua = sPhatthuoc_k_tua, s_kho_tua = iPhatthuoc_k_tua.ToString() + ",";
		//
		//			sql = "select * from " + user + ".d_dmkho where nhom=" + i_nhom;
		//			if (i_thuoc == 1) sql += " and loai=" + i_thuoc;
		//			if (bThua) sql += " and thua=1";
		//			else
		//			{
		//				r = getrowbyid(dtmakp, "id=" + i_makp);
		//				if (r != null)
		//				{
		//					s_kho = r["makho"].ToString();//kho trong khai bao khoa phong
		//					s_khong = "," + s_kho;
		//					//s_nguon_khoa = r["nguon"].ToString();
		//				}
		//				s_makho = get_data("select kho from " + user + ".d_dmphieu where id=" + i_loai).Tables[0].Rows[0][0].ToString();
		//				s_khong1 = "," + s_makho;
		//				int hh1, hh2, hh3, mm1, mm2, mm3, hh4, hh5, hh6, mm4, mm5, mm6;
		//				string kho = "";
		//				s_ngay = ngay;
		//				r = getrowbyid(dtletet, "ngay='" + s_ngay.Substring(0, 5) + "'");
		//				bool bLetet = r != null;
		//				hh3 = int.Parse(sGiobaocao.Substring(0, 2));
		//				mm3 = int.Parse(sGiobaocao.Substring(3, 2));
		//				hh4 = int.Parse(sGiotrua_tu.Substring(0, 2));
		//				mm4 = int.Parse(sGiotrua_tu.Substring(3, 2));
		//				hh5 = int.Parse(sGiotrua_den.Substring(0, 2));
		//				mm5 = int.Parse(sGiotrua_den.Substring(3, 2));
		//				hh6 = int.Parse(sGiochunhat.Substring(0, 2));
		//				mm6 = int.Parse(sGiochunhat.Substring(3, 2));
		//				DateTime dt = (bNgoaigio_ylenh) ? StringToDate(s_ngay.Substring(0, 10)) : StringToDate(ngayhienhanh_server.Substring(0, 10));
		//				string ddd = dt.DayOfWeek.ToString().Substring(0, 3);
		//				if (i_loai == 1 && i_nhom == nhom_duoc && s_makho != "" && (gio_linh != "00:00" || sGiochunhat != "00:00") && (sGiotrua_tu != sGiotrua_den))
		//				{
		//					hh1 = int.Parse(s_ngay.Substring(11, 2));
		//					mm1 = int.Parse(s_ngay.Substring(14, 2));
		//					hh2 = int.Parse(gio_linh.Substring(0, 2));
		//					mm2 = int.Parse(gio_linh.Substring(3, 2));
		//					kho = kho_linh.Trim().Trim(',');//lay ma kho ngoai trong khai bao he thong
		//					if (kho != "") kho += ",";
		//					if (gio_linh != "00:00")
		//					{
		//						if (hh6 != 0 || mm6 != 0)
		//						{
		//							if (bLetet
		//								|| ((ddd == "Sat") && (hh1 > hh6 || (hh1 == hh6 && mm1 > mm6)))
		//								|| ((ddd == "Sun") && (hh1 > hh6 || (hh1 == hh6 && mm1 > mm6)))
		//								|| hh1 > hh2 || (hh1 == hh2 && mm1 > mm2) || hh1 < hh3 || (hh1 == hh3 && mm1 < mm3)
		//								|| ((ddd != "Sat" || ddd != "Sun") && (hh1 > hh4 || (hh1 == hh4 && mm1 > mm4)) && (hh1 < hh5 || (hh1 == hh5 && mm1 < mm5))))
		//							{
		//								s_makho = kho;//s_makho: kho duoc tinh trong khai bao nhom phieu; ngoai gio: lay kho ngoai gio trong khai bao he thong
		//								s_kho = kho;// "";
		//							}
		//							else
		//							{
		//								if (kho != "" && s_makho != "") s_makho = remove_text(s_makho, kho);//s_makho = s_makho.Remove(s_makho.IndexOf(kho), kho.Length);// && s_makho.IndexOf(kho) != -1
		//								if (kho != "" && s_kho != "") s_kho = remove_text(s_kho, kho); // s_kho = s_kho.Remove(s_kho.IndexOf(kho), kho.Length);//&& s_kho.IndexOf(kho) != -1
		//							}
		//						}
		//						else if (bLetet || ddd == "Sat" || ddd == "Sun" || hh1 > hh2 || (hh1 == hh2 && mm1 > mm2) || hh1 < hh3 || (hh1 == hh3 && mm1 < mm3)
		//							|| ((ddd != "Sat" || ddd != "Sun") && (hh1 > hh4 || (hh1 == hh4 && mm1 > mm4)) && (hh1 < hh5 || (hh1 == hh5 && mm1 < mm5))))
		//						{
		//							s_makho = kho;
		//							s_kho = kho;// "";
		//						}
		//						else
		//						{
		//							if (kho != "" && s_makho != "") s_makho = remove_text(s_makho, kho);// s_makho = s_makho.Remove(s_makho.IndexOf(kho), kho.Length);//&& s_makho.IndexOf(kho) != -1
		//							if (kho != "" && s_kho != "") s_kho = remove_text(s_kho, kho); //s_kho = s_kho.Remove(s_kho.IndexOf(kho), kho.Length);// && s_kho.IndexOf(kho) != -1
		//						}
		//					}
		//					else
		//					{
		//						if (bLetet || ddd == "Sat" || ddd == "Sun"
		//							|| ((ddd == "Fri") && (hh1 > hh6 || (hh1 == hh6 && mm1 > mm6)))
		//							|| ((ddd == "Mon") && (hh1 < hh3 || (hh1 == hh3 && mm1 < mm3))))
		//						{
		//							s_makho = kho;
		//							s_kho = kho;// "";
		//						}
		//						else
		//						{
		//							if (kho != "" && s_makho != "") s_makho = remove_text(s_makho, kho); //s_makho = s_makho.Remove(s_makho.IndexOf(kho), kho.Length);//&& s_makho.IndexOf(kho) != -1
		//							if (kho != "" && s_kho != "") s_kho = remove_text(s_kho, kho); //s_kho = s_kho.Remove(s_kho.IndexOf(kho), kho.Length);// && s_kho.IndexOf(kho) != -1
		//						}
		//					}
		//				}
		//					/*else if (i_loai == 1 && bPhieulinh_chanle)
		//					{
		//						int ngaycl = (bNgoaigio_ylenh) ? int.Parse(s_ngay.Substring(0, 2)) : int.Parse(ngayhienhanh_server.Substring(0, 2));
		//						s_makho = (ngaycl % 2 == 0) ? Kho_ngaychan : Kho_ngayle;
		//						s_kho = "";
		//					}*/
		//				else if (i_loai != 2 && bPhatthuoc_kho)
		//				{
		//					/*if (s_khoa_tua.IndexOf(i_makp.ToString().PadLeft(3, '0')) == -1) s_kho = "";
		//					else s_makho = "";*/
		//					//19042009
		//					int khon = 0;
		//					string sql1;
		//					string stime = (ngay.Length == 10) ? "'dd/mm/yyyy'" : "'dd/mm/yyyy hh24:mi'";
		//					sql1 = "select * from " + user + ".d_khonghi where " + for_ngay("tu", stime) + "<=to_date('" + ngay + "'," + stime + ")";
		//					sql1 += " and " + for_ngay("den", stime) + ">=to_date('" + ngay + "'," + stime + ")";
		//					if (s_makho != "") sql1 += " and makho in (" + s_makho.Substring(0, s_makho.Length - 1) + ")";
		//					foreach (DataRow r1 in get_data(sql1).Tables[0].Rows)
		//					{
		//						khon = int.Parse(r1["makho"].ToString());
		//						break;
		//					}
		//					//s_kho = "";
		//					if (khon != 0) sql += " and id not in (" + khon.ToString().Substring(0, khon.ToString().Length) + ")";
		//					else
		//					{
		//						if (sPhatthuoc_kho.IndexOf(i_makp.ToString().PadLeft(3, '0')) != -1)
		//							sql += " and id not in (" + s_khophat2.Substring(0, s_khophat2.Length - 1) + ")";//s_makho = s_khophat;
		//						else if (s_khophat.Length > 1)
		//							sql += " and id not in (" + s_khophat.Substring(0, s_khophat.Length - 1) + ")";
		//					}
		//				}
		//				//add them kho khong loc theo gio
		//				foreach (DataRow r1 in get_data("select * from " + user + ".d_dmkho where ngoaigio=0 and nhom=" + i_nhom).Tables[0].Rows)
		//					if (s_khong.IndexOf("," + r1["id"].ToString() + ",") != -1 && s_khong1.IndexOf("," + r1["id"].ToString() + ",") != -1) { s_makho += r1["id"].ToString() + ","; s_kho += r1["id"].ToString() + ","; }
		//				//
		//				if (s_makho.Trim().Trim(',') != "") sql += " and id in (" + s_makho.Trim().Trim(',') + ")"; //s_makho.Substring(0, s_makho.Length - 1) + ")";
		//				if (s_kho.Trim().Trim(',') != "") sql += " and id in (" + s_kho.Trim().Trim(',') + ")";//s_kho.Substring(0, s_kho.Length - 1) + ")";
		//			}
		//			sql += " order by stt";
		//			return sql;
		//		}
		public bool bPhatthuoc_kho_khoa
		{
			get
			{
				try
				{
					DataSet ds = get_data("select ten from " + user + ".thongso where id=1150");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString()) == 1;
				}
				catch { return false; }
			}
		}
		/// <summary>
		/// Tính tiền theo từng dịch vụ
		/// </summary>
		public bool bktCao_tinhtungDV
		{
			get
			{
				try
				{
					DataSet ds = get_data("select ten from " + user + ".thongso where id=1151");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString()) == 1;
				}
				catch { return false; }
			}
		}
		public bool bPhieulinh_chanle
		{
			get
			{
				try
				{
					DataSet ds = get_data("select ten from " + user + ".thongso where id=1151");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString()) == 1;
				}
				catch { return false; }
			}
		}
		//
		#endregion
		public bool QuanLyTheTu
		{
			//D33. Quản lý thẻ từ
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1152");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString())==1;
				}
				catch{return false;}
			}
		}
		#region Ly Thanh Cuong (điều kiện vụ kế hoạch)
		public bool upd_kh_dm_dk(string m_ma,string m_ten, string m_dk,string m_table)
		{
			sql="update " + m_table + " set ten=:m_ten,dk=:m_dk where ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_ten",OracleType.NVarChar,100).Value=m_ten;
				cmd.Parameters.Add("m_dk",OracleType.NVarChar,50).Value=m_dk;
				cmd.Parameters.Add("m_ma",OracleType.VarChar,3).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into " + m_table + "(ma,ten,dk) values ";
					sql+="(:m_ma,:m_ten,:m_dk)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_ma",OracleType.VarChar,3).Value=m_ma;
					cmd.Parameters.Add("m_ten",OracleType.NVarChar,100).Value=m_ten;
					cmd.Parameters.Add("m_dk",OracleType.NVarChar,50).Value=m_dk;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer," + m_table + ");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_kh_dm(int m_ma,string m_stt, string m_ten,string m_table)
		{
			sql="update " + m_table + " set stt=:m_stt,ten=:m_ten where ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_stt",OracleType.NVarChar,2).Value=m_stt;
				cmd.Parameters.Add("m_ten",OracleType.NVarChar,100).Value=m_ten;
				cmd.Parameters.Add("m_ma",OracleType.VarChar,2).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into " + m_table + "(ma,stt,ten) values ";
					sql+="(:m_ma,:m_stt,:m_ten)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_ma",OracleType.VarChar,2).Value=m_ma;
					cmd.Parameters.Add("m_stt",OracleType.NVarChar,2).Value=m_stt;
					cmd.Parameters.Add("m_ten",OracleType.NVarChar,100).Value=m_ten;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer," + m_table + ");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		public bool upd_kh_dm_dv(int m_ma,string m_stt, string m_ten,string m_table,string m_donvi)
		{
			sql="update " + m_table + " set stt=:m_stt,ten=:m_ten,donvi=:m_donvi where ma=:m_ma";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_stt",OracleType.NVarChar,2).Value=m_stt;
				cmd.Parameters.Add("m_ten",OracleType.NVarChar,100).Value=m_ten;
				cmd.Parameters.Add("m_donvi",OracleType.NVarChar,20).Value=m_donvi;
				cmd.Parameters.Add("m_ma",OracleType.VarChar,2).Value=m_ma;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into " + m_table + "(ma,stt,ten,donvi) values ";
					sql+="(:m_ma,:m_stt,:m_ten,:m_donvi)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_ma",OracleType.VarChar,2).Value=m_ma;
					cmd.Parameters.Add("m_stt",OracleType.NVarChar,2).Value=m_stt;
					cmd.Parameters.Add("m_ten",OracleType.NVarChar,100).Value=m_ten;
					cmd.Parameters.Add("m_donvi",OracleType.NVarChar,20).Value=m_donvi;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer," + m_table + ");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}


		public void CapNhat_dk_VuKeHoach()
		{
			//update datapase
			sql=" alter table "+ user + ".kh_bieu_05 add C15 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_bieu_05 add stt varchar2(3)";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_bieu_05 add tuyen number(3,0)";
			execute_data(sql);
			try
			{
				sql=" alter table "+ user +".kh_bieu_05 drop constraint pk_kh_bieu_05  cascade";
				execute_data(sql);
				sql=" drop index "+ user +".pk_kh_bieu_05 ";
				execute_data(sql);
				sql=" alter table "+ user +".kh_bieu_05 add constraint pk_kh_bieu_05 primary key (id,ma,stt)";
				execute_data(sql);
			}
			catch
			{
				sql=" delete from "+ user + ".kh_bieu_05 where stt is null";
				execute_data(sql);
				sql=" alter table "+ user +".kh_bieu_05 drop constraint pk_kh_bieu_05  cascade";
				execute_data(sql);
				sql=" drop index "+ user +".pk_kh_bieu_05 ";
				execute_data(sql);
				sql=" alter table "+ user +".kh_bieu_05 add constraint pk_kh_bieu_05 primary key (id,ma,stt)";
				execute_data(sql);
			}
			//
			sql=" alter table "+ user + ".kh_bieu_10 add stt varchar2(3)";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_bieu_10 add tuyen number(3,0)";
			execute_data(sql);
			try
			{
				sql=" alter table "+ user +".kh_bieu_10 drop constraint pk_kh_bieu_10  cascade";
				execute_data(sql);
				sql=" drop index "+ user +".pk_kh_bieu_10 ";
				execute_data(sql);
				sql=" alter table "+ user +".kh_bieu_10 add constraint pk_kh_bieu_10 primary key (id,ma,stt)";
				execute_data(sql);
			}
			catch
			{
				sql=" delete from "+ user + ".kh_bieu_10 where stt is null";
				execute_data(sql);
				sql=" alter table "+ user +".kh_bieu_10 drop constraint pk_kh_bieu_10  cascade";
				execute_data(sql);
				sql=" drop index "+ user +".pk_kh_bieu_10 ";
				execute_data(sql);
				sql=" alter table "+ user +".kh_bieu_10 add constraint pk_kh_bieu_10 primary key (id,ma,stt)";
				execute_data(sql);
			}
			//
			sql=" alter table "+ user + ".kh_bieu_124 add stt varchar2(3)";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_bieu_124 add tuyen number(3,0)";
			execute_data(sql);
			try
			{
				sql=" alter table "+ user +".kh_bieu_124 drop constraint pk_kh_bieu_124  cascade";
				execute_data(sql);
				sql=" drop index "+ user +".pk_kh_bieu_124 ";
				execute_data(sql);
				sql=" alter table "+ user +".kh_bieu_124 add constraint pk_kh_bieu_124 primary key (id,ma,stt)";
				execute_data(sql);
			}
			catch
			{
				sql=" delete from "+ user + ".kh_bieu_124 where stt is null";
				execute_data(sql);
				sql=" alter table "+ user +".kh_bieu_124 drop constraint pk_kh_bieu_124  cascade";
				execute_data(sql);
				sql=" drop index "+ user +".pk_kh_bieu_124 ";
				execute_data(sql);
				sql=" alter table "+ user +".kh_bieu_124 add constraint pk_kh_bieu_124 primary key (id,ma,stt)";
				execute_data(sql);
			}
			//
			sql=" alter table "+ user + ".kh_bieu_132 add stt varchar2(3)";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_bieu_132 add tuyen number(3,0)";
			execute_data(sql);
			try
			{
				sql=" alter table "+ user +".kh_bieu_132 drop constraint pk_kh_bieu_132  cascade";
				execute_data(sql);
				sql=" drop index "+ user +".pk_kh_bieu_132 ";
				execute_data(sql);
				sql=" alter table "+ user +".kh_bieu_132 add constraint pk_kh_bieu_132 primary key (id,ma,stt)";
				execute_data(sql);
			}
			catch
			{
				sql=" delete from "+ user + ".kh_bieu_132 where stt is null";
				execute_data(sql);
				sql=" alter table "+ user +".kh_bieu_132 drop constraint pk_kh_bieu_132  cascade";
				execute_data(sql);
				sql=" drop index "+ user +".pk_kh_bieu_132 ";
				execute_data(sql);
				sql=" alter table "+ user +".kh_bieu_132 add constraint pk_kh_bieu_132 primary key (id,ma,stt)";
				execute_data(sql);
			}
			//
			
			sql=" alter table "+ user + ".kh_bieu_11 add stt varchar2(3)";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_bieu_11 add tuyen number(3,0)";
			execute_data(sql);
			try
			{
				sql=" alter table "+ user +".kh_bieu_11 drop constraint pk_kh_bieu_11  cascade";
				execute_data(sql);
				sql=" drop index "+ user +".pk_kh_bieu_11 ";
				execute_data(sql);
				sql=" alter table "+ user +".kh_bieu_11 add constraint pk_kh_bieu_11 primary key (id,ma,stt)";
				execute_data(sql);
			}
			catch
			{
				sql=" delete from "+ user + ".kh_bieu_11 where stt is null";
				execute_data(sql);
				sql=" alter table "+ user +".kh_bieu_11 drop constraint pk_kh_bieu_11  cascade";
				execute_data(sql);
				sql=" drop index "+ user +".pk_kh_bieu_11 ";
				execute_data(sql);
				sql=" alter table "+ user +".kh_bieu_11 add constraint pk_kh_bieu_11 primary key (id,ma,stt)";
				execute_data(sql);
			}
			//
			sql=" alter table "+ user + ".kh_bieu_09 add stt varchar2(3)";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_bieu_09 add tuyen number(3,0)";
			execute_data(sql);
			try
			{
				sql=" alter table "+ user +".kh_bieu_09 drop constraint pk_kh_bieu_09  cascade";
				execute_data(sql);
				sql=" drop index "+ user +".pk_kh_bieu_09 ";
				execute_data(sql);
				sql=" alter table "+ user +".kh_bieu_09 add constraint pk_kh_bieu_09 primary key (id,ma,stt)";
				execute_data(sql);
			}
			catch
			{
				sql=" delete from "+ user + ".kh_bieu_09 where stt is null";
				execute_data(sql);
				sql=" alter table "+ user +".kh_bieu_09 drop constraint pk_kh_bieu_09  cascade";
				execute_data(sql);
				sql=" drop index "+ user +".pk_kh_bieu_09 ";
				execute_data(sql);
				sql=" alter table "+ user +".kh_bieu_09 add constraint pk_kh_bieu_09 primary key (id,ma,stt)";
				execute_data(sql);
			}
			//
			sql=" alter table "+ user + ".kh_bieu_144 add stt varchar2(3)";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_bieu_144 add tuyen number(3,0)";
			execute_data(sql);
			try
			{
				sql=" alter table "+ user +".kh_bieu_144 drop constraint pk_kh_bieu_144  cascade";
				execute_data(sql);
				sql=" drop index "+ user +".pk_kh_bieu_144 ";
				execute_data(sql);
				sql=" alter table "+ user +".kh_bieu_144 add constraint pk_kh_bieu_144 primary key (id,ma,stt)";
				execute_data(sql);
			}
			catch
			{
				sql=" delete from "+ user + ".kh_bieu_144 where stt is null";
				execute_data(sql);
				sql=" alter table "+ user +".kh_bieu_144 drop constraint pk_kh_bieu_144  cascade";
				execute_data(sql);
				sql=" drop index "+ user +".pk_kh_bieu_144 ";
				execute_data(sql);
				sql=" alter table "+ user +".kh_bieu_144 add constraint pk_kh_bieu_144 primary key (id,ma,stt)";
				execute_data(sql);
			}
			//
			sql=" alter table "+ user + ".kh_bieu_121 add stt varchar2(3)";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_bieu_121 add tuyen number(3,0)";
			execute_data(sql);
			try
			{
				sql=" alter table "+ user +".kh_bieu_121 drop constraint pk_kh_bieu_121  cascade";
				execute_data(sql);
				sql=" drop index "+ user +".pk_kh_bieu_121 ";
				execute_data(sql);
				sql=" alter table "+ user +".kh_bieu_121 add constraint pk_kh_bieu_121 primary key (id,ma,stt)";
				execute_data(sql);
			}
			catch
			{
				sql=" delete from "+ user + ".kh_bieu_121 where stt is null";
				execute_data(sql);
				sql=" alter table "+ user +".kh_bieu_121 drop constraint pk_kh_bieu_121  cascade";
				execute_data(sql);
				sql=" drop index "+ user +".pk_kh_bieu_121 ";
				execute_data(sql);
				sql=" alter table "+ user +".kh_bieu_121 add constraint pk_kh_bieu_121 primary key (id,ma,stt)";
				execute_data(sql);
			}
			//
			sql=" alter table "+ user + ".kh_bieu_122 add stt varchar2(3)";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_bieu_122 add tuyen number(3,0)";
			execute_data(sql);
			try
			{
				sql=" alter table "+ user +".kh_bieu_122 drop constraint pk_kh_bieu_122  cascade";
				execute_data(sql);
				sql=" drop index "+ user +".pk_kh_bieu_122 ";
				execute_data(sql);
				sql=" alter table "+ user +".kh_bieu_122 add constraint pk_kh_bieu_122 primary key (id,ma,stt)";
				execute_data(sql);
			}
			catch
			{
				sql=" delete from "+ user + ".kh_bieu_122 where stt is null";
				execute_data(sql);
				sql=" alter table "+ user +".kh_bieu_122 drop constraint pk_kh_bieu_122  cascade";
				execute_data(sql);
				sql=" drop index "+ user +".pk_kh_bieu_122 ";
				execute_data(sql);
				sql=" alter table "+ user +".kh_bieu_122 add constraint pk_kh_bieu_122 primary key (id,ma,stt)";
				execute_data(sql);
			}
			//
			sql=" alter table "+ user + ".kh_bieu_141 add stt varchar2(3)";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_bieu_141 add tuyen number(3,0)";
			execute_data(sql);
			try
			{
				sql=" alter table "+ user +".kh_bieu_141 drop constraint pk_kh_bieu_141  cascade";
				execute_data(sql);
				sql=" drop index "+ user +".pk_kh_bieu_141 ";
				execute_data(sql);
				sql=" alter table "+ user +".kh_bieu_141 add constraint pk_kh_bieu_141 primary key (id,ma,stt)";
				execute_data(sql);
			}
			catch
			{
				sql=" delete from "+ user + ".kh_bieu_141 where stt is null";
				execute_data(sql);
				sql=" alter table "+ user +".kh_bieu_141 drop constraint pk_kh_bieu_141  cascade";
				execute_data(sql);
				sql=" drop index "+ user +".pk_kh_bieu_141 ";
				execute_data(sql);
				sql=" alter table "+ user +".kh_bieu_141 add constraint pk_kh_bieu_141 primary key (id,ma,stt)";
				execute_data(sql);
			}
			//

			sql=" alter table "+ user + ".kh_dm_05 add C15 number DEFAULT 0";
			execute_data(sql);

			sql=" alter table "+ user + ".kh_bieu_06 add C32 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_bieu_06 add C33 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_bieu_06 add C34 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_bieu_06 add C35 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_bieu_06 add C36 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_bieu_06 add C37 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_bieu_06 add C38 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_dm_06 add C32 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_dm_06 add C33 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_dm_06 add C34 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_dm_06 add C35 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_dm_06 add C36 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_dm_06 add C37 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_dm_06 add C38 number DEFAULT 0";
			execute_data(sql);

			sql=" alter table "+ user + ".kh_dm_07 add donvi nvarchar2(20)";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_dm_07 add C10 nvarchar2(200)";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_bieu_07 add C10 nvarchar2(200)";
			execute_data(sql);

			sql=" alter table "+ user + ".kh_dm_131 add C24 nvarchar2(200)";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_bieu_131 add C24 nvarchar2(200)";
			execute_data(sql);

			sql=" alter table "+ user + ".kh_bieu_141 add C29 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_bieu_141 add C30 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_bieu_141 add C31 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_bieu_141 add C32 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_bieu_141 add C33 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_bieu_141 add C34 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_bieu_141 add C35 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_bieu_141 add C36 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_bieu_141 add C37 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_bieu_141 add C38 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_bieu_141 add C39 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_bieu_141 add C40 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_bieu_141 add C41 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_bieu_141 add C42 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_bieu_141 add C43 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_bieu_141 add C44 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_bieu_141 add C45 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_bieu_141 add C46 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_bieu_141 add C47 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_bieu_141 add C48 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_bieu_141 add C49 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_bieu_141 add C50 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_bieu_141 add C51 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_bieu_141 add C52 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_bieu_141 add C53 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_bieu_141 add C54 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_bieu_141 add C55 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_bieu_141 add C56 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_dm_141 add C29 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_dm_141 add C30 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_dm_141 add C31 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_dm_141 add C32 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_dm_141 add C33 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_dm_141 add C34 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_dm_141 add C35 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_dm_141 add C36 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_dm_141 add C37 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_dm_141 add C38 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_dm_141 add C39 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_dm_141 add C40 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_dm_141 add C41 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_dm_141 add C42 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_dm_141 add C43 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_dm_141 add C44 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_dm_141 add C45 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_dm_141 add C46 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_dm_141 add C47 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_dm_141 add C48 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_dm_141 add C49 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_dm_141 add C50 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_dm_141 add C51 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_dm_141 add C52 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_dm_141 add C53 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_dm_141 add C54 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_dm_141 add C55 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_dm_141 add C56 number DEFAULT 0";
			execute_data(sql);

			sql=" alter table "+ user + ".kh_bieu_15 add C07 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_bieu_15 add C08 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_bieu_15 add C09 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_bieu_15 add C10 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_bieu_15 add C11 number DEFAULT 0";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_bieu_15 add C12 number DEFAULT 0";
			execute_data(sql);

			sql=" alter table "+ user + ".kh_dm_15_dk modify ten nvarchar2(200) default ' '";
			execute_data(sql);

			sql=" alter table "+ user + ".kh_dm_08 add donvi nvarchar2(20) default ' '";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_bieu_08 modify c06 nvarchar2(200) default ' '";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_dm_08 modify c06 nvarchar2(200) default ' '";
			execute_data(sql);

			sql=" alter table "+ user + ".kh_bieu_123 modify c20 nvarchar2(200) default ' '";
			execute_data(sql);
			sql=" alter table "+ user + ".kh_dm_123 modify c20 nvarchar2(200) default ' '";
			execute_data(sql);
			//


			//Biểu 01
			upd_kh_dm_dk("C01","","","kh_dm_01_dk");
			upd_kh_dm_dk("C02","Tên huyện, thị xã, thành phố","","kh_dm_01_dk");
			upd_kh_dm_dk("C03","Dân số có đến 1/7","","kh_dm_01_dk");
			upd_kh_dm_dk("C04","Trong đó\\Nữ","","kh_dm_01_dk");
			upd_kh_dm_dk("C05","Trong đó\\Trẻ em < 5 tuổi","","kh_dm_01_dk");
			upd_kh_dm_dk("C06","Trong đó\\Trẻ em < 6 tuổi","","kh_dm_01_dk");
			upd_kh_dm_dk("C07","Trong đó\\Trẻ em < 15 tuổi","","kh_dm_01_dk");
			upd_kh_dm_dk("C08","TS xã phường, thị trấn","","kh_dm_01_dk");
			upd_kh_dm_dk("C09","Trong đó: Vùng sâu","","kh_dm_01_dk");
			upd_kh_dm_dk("C10","Trong đó: Vùng núi","","kh_dm_01_dk");
			upd_kh_dm_dk("C11","Trong đó: Hải đảo","","kh_dm_01_dk");
			upd_kh_dm_dk("C12","Trong đó: Đồng bằng","","kh_dm_01_dk");
			upd_kh_dm_dk("C13","Số thôn/ bản","","kh_dm_01_dk");
			//Biểu 02
			upd_kh_dm_dk("C01","Số trẻ đẻ sống\\Tổng số","","kh_dm_02_dk");
			upd_kh_dm_dk("C02","Số trẻ đẻ sống\\Trong đó: Nữ","","kh_dm_02_dk");
			upd_kh_dm_dk("C03","Tổng số chết\\Tổng số","","kh_dm_02_dk");
			upd_kh_dm_dk("C04","Tổng số chết\\Trong đó: Nữ","","kh_dm_02_dk");
			upd_kh_dm_dk("C05","Trong đó\\Chết < 1 tuổi\\Tổng số","","kh_dm_02_dk");
			upd_kh_dm_dk("C06","Trong đó\\Chết < 1 tuổi\\Nữ","","kh_dm_02_dk");
			upd_kh_dm_dk("C07","Trong đó\\Chết < 5 tuổi\\Tổng số","","kh_dm_02_dk");
			upd_kh_dm_dk("C08","Trong đó\\Chết < 5 tuổi\\Nữ","","kh_dm_02_dk");
			upd_kh_dm_dk("C09","Chết mẹ","","kh_dm_02_dk");
			//Biểu 04a
			upd_kh_dm_dk("C01","Bệnh viện\\Cơ sở","","kh_dm_05_dk");
			upd_kh_dm_dk("C02","Bệnh viện\\Giường bệnh\\KH","","kh_dm_05_dk");
			upd_kh_dm_dk("C03","Bệnh viện\\Giường bệnh\\Thực kê","","kh_dm_05_dk");
			upd_kh_dm_dk("C04","Điều dưỡng\\Cơ sở","","kh_dm_05_dk");
			upd_kh_dm_dk("C05","Điều dưỡng\\Giường","","kh_dm_05_dk");
			upd_kh_dm_dk("C06","Phòng khám\\Cơ sở","","kh_dm_05_dk");
			upd_kh_dm_dk("C07","Phòng khám\\Giường","","kh_dm_05_dk");
			upd_kh_dm_dk("C08","Nhà hộ sinh\\Cơ sở","","kh_dm_05_dk");
			upd_kh_dm_dk("C09","Nhà hộ sinh\\Giường","","kh_dm_05_dk");
			upd_kh_dm_dk("C10","Khu điều trị phong\\Cơ sở","","kh_dm_05_dk");
			upd_kh_dm_dk("C11","Khu điều trị phong\\Giường","","kh_dm_05_dk");
			upd_kh_dm_dk("C12","Trạm y tế\\Cơ sở","","kh_dm_05_dk");
			upd_kh_dm_dk("C13","Trạm y tế\\Giường","","kh_dm_05_dk");
			upd_kh_dm_dk("C14","Cơ sở khác\\Cơ sở","","kh_dm_05_dk");
			upd_kh_dm_dk("C15","Cơ sở khác\\Giường","","kh_dm_05_dk");
			//Biểu 04b
			upd_kh_dm_dk("C01","Trạm y tế có\\Tổ YHCT","","kh_dm_04_dk");
			upd_kh_dm_dk("C02","Trạm y tế có\\Bác sỹ","","kh_dm_04_dk");
			upd_kh_dm_dk("C03","Trạm y tế có\\NHS/ YSSN","","kh_dm_04_dk");
			upd_kh_dm_dk("C04","Số xã không có trạm","","kh_dm_04_dk");
			upd_kh_dm_dk("C05","Số TYT đạt chuẩn QG","","kh_dm_04_dk");
			upd_kh_dm_dk("C06","Số thôn bản có NVYT","","kh_dm_04_dk");
			//Biểu 05
			upd_kh_dm_dk("C01","Tổng số\\Tổng số","","kh_dm_06_dk");
			upd_kh_dm_dk("C02","Tổng số\\Trong đó: Nữ","","kh_dm_06_dk");
			upd_kh_dm_dk("C03","Tỉnh/Thành phố\\QLNN\\Tổng số","","kh_dm_06_dk");
			upd_kh_dm_dk("C04","Tỉnh/Thành phố\\QLNN\\Trong đó: Nữ","","kh_dm_06_dk");
			upd_kh_dm_dk("C05","Tỉnh/Thành phố\\Phòng bệnh\\Tổng số","","kh_dm_06_dk");
			upd_kh_dm_dk("C06","Tỉnh/Thành phố\\Phòng bệnh\\Trong đó: Nữ","","kh_dm_06_dk");
			upd_kh_dm_dk("C07","Tỉnh/Thành phố\\Chữa bệnh\\Tổng số","","kh_dm_06_dk");
			upd_kh_dm_dk("C08","Tỉnh/Thành phố\\Chữa bệnh\\Trong đó: Nữ","","kh_dm_06_dk");
			upd_kh_dm_dk("C09","Tỉnh/Thành phố\\Chi cục dân số\\Tổng số","","kh_dm_06_dk");
			upd_kh_dm_dk("C10","Tỉnh/Thành phố\\Chi cục dân số\\Trong đó: Nữ","","kh_dm_06_dk");
			upd_kh_dm_dk("C11","Tỉnh/Thành phố\\Đào tạo(THYT...)\\Tổng số","","kh_dm_06_dk");
			upd_kh_dm_dk("C12","Tỉnh/Thành phố\\Đào tạo(THYT...)\\Trong đó: Nữ","","kh_dm_06_dk");
			upd_kh_dm_dk("C13","Tỉnh/Thành phố\\Công ty Dược\\Tổng số","","kh_dm_06_dk");
			upd_kh_dm_dk("C14","Tỉnh/Thành phố\\Công ty Dược\\Trong đó: Nữ","","kh_dm_06_dk");
			upd_kh_dm_dk("C15","Quận/Huyện\\QLNN\\Tổng số","","kh_dm_06_dk");
			upd_kh_dm_dk("C16","Quận/Huyện\\QLNN\\Trong đó: Nữ","","kh_dm_06_dk");
			upd_kh_dm_dk("C17","Quận/Huyện\\Phòng bệnh\\Tổng số","","kh_dm_06_dk");
			upd_kh_dm_dk("C18","Quận/Huyện\\Phòng bệnh\\Trong đó: Nữ","","kh_dm_06_dk");
			upd_kh_dm_dk("C19","Quận/Huyện\\Chữa bệnh\\Tổng số","","kh_dm_06_dk");
			upd_kh_dm_dk("C20","Quận/Huyện\\Chữa bệnh\\Trong đó: Nữ","","kh_dm_06_dk");
			upd_kh_dm_dk("C21","Trung tâm dân số\\Tổng số","","kh_dm_06_dk");
			upd_kh_dm_dk("C22","Trung tâm dân số\\Trong đó: Nữ","","kh_dm_06_dk");
			upd_kh_dm_dk("C23","Tuyến xã\\Trạm y tế\\Tổng số","","kh_dm_06_dk");
			upd_kh_dm_dk("C24","Tuyến xã\\Trạm y tế\\Trong đó: Nữ","","kh_dm_06_dk");
			upd_kh_dm_dk("C25","Tuyến xã\\Thôn bản\\Tổng số","","kh_dm_06_dk");
			upd_kh_dm_dk("C26","Tuyến xã\\Thôn bản\\Trong đó: Nữ","","kh_dm_06_dk");
			upd_kh_dm_dk("C27","Y tế ngành\\QLNN\\Tổng số","","kh_dm_06_dk");
			upd_kh_dm_dk("C28","Y tế ngành\\QLNN\\Trong đó: Nữ","","kh_dm_06_dk");
			upd_kh_dm_dk("C29","Y tế ngành\\Phòng bệnh\\Tổng số","","kh_dm_06_dk");
			upd_kh_dm_dk("C30","Y tế ngành\\Phòng bệnh\\Trong đó: Nữ","","kh_dm_06_dk");
			upd_kh_dm_dk("C31","Y tế ngành\\Chữa bệnh\\Tổng số","","kh_dm_06_dk");
			upd_kh_dm_dk("C32","Y tế ngành\\Chữa bệnh\\Trong đó: Nữ","","kh_dm_06_dk");
			upd_kh_dm_dk("C33","Tư nhân\\Bệnh viện\\Tổng số","","kh_dm_06_dk");
			upd_kh_dm_dk("C34","Tư nhân\\Bệnh viện\\Trong đó: Nữ","","kh_dm_06_dk");
			upd_kh_dm_dk("C35","Tư nhân\\Phòng khám\\Tổng số","","kh_dm_06_dk");
			upd_kh_dm_dk("C36","Tư nhân\\Phòng khám\\Trong đó: Nữ","","kh_dm_06_dk");
			upd_kh_dm_dk("C37","Tư nhân\\Cơ sở khác\\Tổng số","","kh_dm_06_dk");
			upd_kh_dm_dk("C38","Tư nhân\\Cơ sở khác\\Trong đó: Nữ","","kh_dm_06_dk");

			execute_data("delete from kh_dm_06");
			upd_kh_dm(0," ","Tổng số","kh_dm_06");
			upd_kh_dm(1,"1","Tiến sỹ Y","kh_dm_06");
			upd_kh_dm(2,"2","Thạc sỹ Y","kh_dm_06");
			upd_kh_dm(3,"3","Chuyên khoa II","kh_dm_06");
			upd_kh_dm(4,"4","Chuyên khoa I","kh_dm_06");
			upd_kh_dm(5,"5","Bác sỹ","kh_dm_06");
			upd_kh_dm(6,"6","Tiến sỹ Dược","kh_dm_06");
			upd_kh_dm(7,"7","Thạc sỹ Dược","kh_dm_06");
			upd_kh_dm(8,"8","Chuyên khoa II Dược","kh_dm_06");
			upd_kh_dm(9,"9","Chuyên khoa I Dược","kh_dm_06");
			upd_kh_dm(10,"10","Dược sỹ đại học","kh_dm_06");
			upd_kh_dm(11,"11","Thạc sỹ y tế Công cộng","kh_dm_06");
			upd_kh_dm(12,"12","Đại học y tế Công cộng","kh_dm_06");
			upd_kh_dm(13,"13","Cao đẳng y tế Công cộng","kh_dm_06");
			upd_kh_dm(14,"14","Y sỹ","kh_dm_06");
			upd_kh_dm(15," ","Trong đó: Y sỹ sản nhi","kh_dm_06");
			upd_kh_dm(16,"15","KTV y đại học","kh_dm_06");
			upd_kh_dm(17,"16","KTV y cao đẳng","kh_dm_06");
			upd_kh_dm(18,"17","KTV y trung học","kh_dm_06");
			upd_kh_dm(19,"18","KTV y sơ học","kh_dm_06");
			upd_kh_dm(20,"19","Dược sỹ/KTV TH dược","kh_dm_06");
			upd_kh_dm(21,"20","Dược tá","kh_dm_06");
			upd_kh_dm(22,"21","ĐD(y tá) Đại học","kh_dm_06");
			upd_kh_dm(23,"22","ĐD(y tá) Cao đẳng","kh_dm_06");
			upd_kh_dm(24,"23","ĐD(y tá) Trung học","kh_dm_06");
			upd_kh_dm(25,"24","ĐD(y tá) Sơ học","kh_dm_06");
			upd_kh_dm(26,"25","Hộ sinh Đại học","kh_dm_06");
			upd_kh_dm(27,"26","Hộ sinh Cao đẳng","kh_dm_06");
			upd_kh_dm(28,"27","Hộ sinh Trung học","kh_dm_06");
			upd_kh_dm(29,"28","Hộ sinh Sơ học","kh_dm_06");
			upd_kh_dm(30,"29","Lương y/ Lương dược","kh_dm_06");
			upd_kh_dm(31,"30","Đại học ngành khác","kh_dm_06");
			upd_kh_dm(32,"31","Cán bộ khác","kh_dm_06");
			//Biểu 06
			execute_data("delete from kh_dm_08");
			upd_kh_dm_dv(0,"I","Tham gia BHYT","kh_dm_08","Triệu đồng");
			upd_kh_dm_dv(1,"1","Tổng số người tham gia BHYT","kh_dm_08","Triệu người");
			upd_kh_dm_dv(2," ","Trong đó:","kh_dm_08"," ");
			upd_kh_dm_dv(3," ","		Người nghèo","kh_dm_08","Triệu người");
			upd_kh_dm_dv(4," ","		Tự nguyện","kh_dm_08","Triệu người");
			upd_kh_dm_dv(5," ","		Trẻ em < 6 tuổi","kh_dm_08","Triệu người");
			upd_kh_dm_dv(6,"2","Tỷ lệ tham gia BHYT","kh_dm_08","%");
			upd_kh_dm_dv(7,"II","Thu BHYT","kh_dm_08","Triệu đồng");
			upd_kh_dm_dv(8," ","Tổng số thu BHYT","kh_dm_08","Tỷ đồng");
			upd_kh_dm_dv(9," ","Trong đó:","kh_dm_08"," ");
			upd_kh_dm_dv(10," ","		Người nghèo","kh_dm_08","Tỷ đồng");
			upd_kh_dm_dv(11," ","		Tự nguyện","kh_dm_08","Tỷ đồng");
			upd_kh_dm_dv(12," ","		Trẻ em < 6 tuổi","kh_dm_08","Tỷ đồng");
			upd_kh_dm_dv(13,"III","Khám chữa bệnh có BHYT","kh_dm_08","%");
			upd_kh_dm_dv(14,"1","Khám và điều trị ngoại trú","kh_dm_08","Ngàn lượt");
			upd_kh_dm_dv(15," ","Trong đó:","kh_dm_08"," ");
			upd_kh_dm_dv(16," ","		Người nghèo","kh_dm_08","Ngàn lượt");
			upd_kh_dm_dv(17," ","		Trẻ em < 6 tuổi","kh_dm_08","Ngàn lượt");
			upd_kh_dm_dv(18,"2","Khám và điều trị nội trú","kh_dm_08","Ngàn lượt");
			upd_kh_dm_dv(19," ","Trong đó:","kh_dm_08"," ");
			upd_kh_dm_dv(20," ","		Người nghèo","kh_dm_08","Ngàn lượt");
			upd_kh_dm_dv(21," ","		Trẻ em < 6 tuổi","kh_dm_08","Ngàn lượt");
			upd_kh_dm_dv(22,"IV","Chi BHYT","kh_dm_08","Triệu đồng");
			upd_kh_dm_dv(23,"1","Khám và điều trị ngoại trú","kh_dm_08","Triệu đồng");
			upd_kh_dm_dv(24," ","Trong đó:","kh_dm_08"," ");
			upd_kh_dm_dv(25," ","		Người nghèo","kh_dm_08","Triệu đồng");
			upd_kh_dm_dv(26," ","		Trẻ em < 6 tuổi","kh_dm_08","Triệu đồng");
			upd_kh_dm_dv(27,"2","Khám và điều trị nội trú","kh_dm_08","Triệu đồng");
			upd_kh_dm_dv(28," ","Trong đó:","kh_dm_08"," ");
			upd_kh_dm_dv(29," ","		Người nghèo","kh_dm_08","Triệu đồng");
			upd_kh_dm_dv(30," ","		Trẻ em < 6 tuổi","kh_dm_08","Triệu đồng");
			upd_kh_dm_dv(31,"V","Chi phí trung bình 1 lượt khám & điều trị ngoại trú","kh_dm_08","Ngàn đồng");
			upd_kh_dm_dv(32,"VI","Chi phí trung bình 1 lượt khám & điều trị nội trú","kh_dm_08","Ngàn đồng");

			upd_kh_dm_dk("C01","Tổng số","","kh_dm_08_dk");
			upd_kh_dm_dk("C02","Ghi chú","","kh_dm_08_dk");
			//Biểu 07
			upd_kh_dm_dk("C01","Năm trước","","kh_dm_07_dk");
			upd_kh_dm_dk("C02","Năm nay","","kh_dm_07_dk");
			upd_kh_dm_dk("C03","Tốc độ tăng","","kh_dm_07_dk");
			upd_kh_dm_dk("C10","Ghi chú","","kh_dm_07_dk");

			execute_data("delete from kh_dm_07");
			upd_kh_dm_dv(0,"1","Doanh thu sản xuất","kh_dm_07","Triệu đồng");
			upd_kh_dm_dv(1,"2","Xuất khẩu","kh_dm_07","1000 USD");
			upd_kh_dm_dv(2,"3","Nhập khẩu","kh_dm_07","1000 USD");
			upd_kh_dm_dv(3," "," - Thành phẩm","kh_dm_07","1000 USD");
			upd_kh_dm_dv(4," ","     Tỷ trọng TP/ Nhập khẩu","kh_dm_07","%");
			upd_kh_dm_dv(5," "," - Nguyên liệu","kh_dm_07","1000 USD");
			upd_kh_dm_dv(6," ","     Tỷ trọng NL/ Nhập khẩu","kh_dm_07","%");
			//Biểu 08
			execute_data("delete from kh_dm_123");
			upd_kh_dm(0," ","Tổng số","kh_dm_123");
			upd_kh_dm(1,"1","Y sỹ đa khoa","kh_dm_123");
			upd_kh_dm(2,"2","Y sỹ y học cổ truyền","kh_dm_123");
			upd_kh_dm(3,"3","Điều dưỡng đại học","kh_dm_123");
			upd_kh_dm(4,"4","Điều dưỡng cao đẳng","kh_dm_123");
			upd_kh_dm(5,"5","Điều dưỡng trung học","kh_dm_123");
			upd_kh_dm(6,"6","Điều dưỡng sơ học","kh_dm_123");
			upd_kh_dm(7,"7","Hộ sinh đại học","kh_dm_123");
			upd_kh_dm(8,"8","Hộ sinh cao đẳng","kh_dm_123");
			upd_kh_dm(9,"9","Hộ sinh trung học","kh_dm_123");
			upd_kh_dm(10,"10","Hộ sinh sơ học","kh_dm_123");
			upd_kh_dm(11,"11","Kỹ thuật viên y cao đẳng","kh_dm_123");
			upd_kh_dm(12,"12","Kỹ thuật viên y trung học","kh_dm_123");
			upd_kh_dm(13,"13","Kỹ thuật viên y sơ học","kh_dm_123");
			upd_kh_dm(14,"14","Dược sỹ trung học","kh_dm_123");
			upd_kh_dm(15,"15","Dược tá","kh_dm_123");
			upd_kh_dm(16,"16","Công nhân kỹ thuật thiết bị y tế","kh_dm_123");
			upd_kh_dm(17,"17","Nhân viên y tế thôn bản","kh_dm_123");
			upd_kh_dm(18,"18","Khác","kh_dm_123");

			upd_kh_dm_dk("C01","Số tuyển sinh trong năm\\Tổng số","","kh_dm_123_dk");
			upd_kh_dm_dk("C02","Số tuyển sinh trong năm\\Trong đó: Hệ chính quy","","kh_dm_123_dk");
			upd_kh_dm_dk("C03","Số tuyển sinh trong năm\\Trong đó: Nữ","","kh_dm_123_dk");
			upd_kh_dm_dk("C04","Số tuyển sinh trong năm\\Trong đó: Dân tộc ít người","","kh_dm_123_dk");
			upd_kh_dm_dk("C05","Số tốt nghiệp trong năm\\Tổng số","","kh_dm_123_dk");
			upd_kh_dm_dk("C06","Số tốt nghiệp trong năm\\Trong đó: Hệ chính quy","","kh_dm_123_dk");
			upd_kh_dm_dk("C07","Số tốt nghiệp trong năm\\Trong đó: Nữ","","kh_dm_123_dk");
			upd_kh_dm_dk("C08","Số tốt nghiệp trong năm\\Trong đó: Dân tộc ít người","","kh_dm_123_dk");
			upd_kh_dm_dk("C09","Số hiện có cuối năm\\Tổng số","","kh_dm_123_dk");
			upd_kh_dm_dk("C10","Số hiện có cuối năm\\Trong đó: Hệ chính quy","","kh_dm_123_dk");
			upd_kh_dm_dk("C11","Số hiện có cuối năm\\Trong đó: Nữ","","kh_dm_123_dk");
			upd_kh_dm_dk("C12","Số hiện có cuối năm\\Trong đó: Dân tộc ít người","","kh_dm_123_dk");
			upd_kh_dm_dk("C20","Ghi chú","","kh_dm_123_dk");
			//Biểu 09
			upd_kh_dm_dk("C01","Phụ nữ có thai\\Tổng số","","kh_dm_10_dk");
			upd_kh_dm_dk("C02","Phụ nữ có thai\\Trong đó: Vị thành niên","","kh_dm_10_dk");
			upd_kh_dm_dk("C03","Tổng số lần khám thai","","kh_dm_10_dk");
			upd_kh_dm_dk("C04","Số đẻ được quản lý thai","","kh_dm_10_dk");
			upd_kh_dm_dk("C05","Số phụ nữ đẻ được tiêm đủ UV","","kh_dm_10_dk");
			upd_kh_dm_dk("C06","Phụ nữ đẻ\\Tổng số PN đẻ","","kh_dm_10_dk");
			upd_kh_dm_dk("C07","Phụ nữ đẻ\\Trong đó\\Khám>=3 lần trong 3 kỳ","","kh_dm_10_dk");
			upd_kh_dm_dk("C08","Phụ nữ đẻ\\Trong đó\\FX/GH","","kh_dm_10_dk");
			upd_kh_dm_dk("C09","Phụ nữ đẻ\\Trong đó\\Mổ lấy thai","","kh_dm_10_dk");
			upd_kh_dm_dk("C10","Phụ nữ đẻ\\Trong đó\\Đẻ con thứ 3 trở lên","","kh_dm_10_dk");
			upd_kh_dm_dk("C11","Phụ nữ đẻ\\Trong đó\\Đẻ do CBYT đỡ","","kh_dm_10_dk");
			upd_kh_dm_dk("C12","Phụ nữ đẻ\\Trong đó\\Đẻ tại cơ sở y tế","","kh_dm_10_dk");
			upd_kh_dm_dk("C13","Số bà mẹ/trẻ SS được chăm sóc sau sinh\\Tổng số","","kh_dm_10_dk");
			upd_kh_dm_dk("C14","Số bà mẹ/trẻ SS được chăm sóc sau sinh\\Trong đó: ","","kh_dm_10_dk");
			//Biểu 10 
			upd_kh_dm_dk("C01","Băng huyết\\Mắc","","kh_dm_124_dk");
			upd_kh_dm_dk("C02","Băng huyết\\Chết","","kh_dm_124_dk");
			upd_kh_dm_dk("C03","Sản giật\\Mắc","","kh_dm_124_dk");
			upd_kh_dm_dk("C04","Sản giật\\Chết","","kh_dm_124_dk");
			upd_kh_dm_dk("C05","Uốn ván SS\\Mắc","","kh_dm_124_dk");
			upd_kh_dm_dk("C06","Uốn ván SS\\Chết","","kh_dm_124_dk");
			upd_kh_dm_dk("C07","Vỡ tử cung\\Mắc","","kh_dm_124_dk");
			upd_kh_dm_dk("C08","Vỡ tử cung\\Chết","","kh_dm_124_dk");
			upd_kh_dm_dk("C09","Nhiễm trùng\\Mắc","","kh_dm_124_dk");
			upd_kh_dm_dk("C10","Nhiễm trùng\\Chết","","kh_dm_124_dk");
			//Biểu 11 
			upd_kh_dm_dk("C01","Tổng số lần khám phụ khoa","","kh_dm_132_dk");
			upd_kh_dm_dk("C02","Tổng số lượt chữa phụ khoa","","kh_dm_132_dk");
			upd_kh_dm_dk("C03","Phá thai\\Số phá thai theo tuần\\<=7 tuần","","kh_dm_132_dk");
			upd_kh_dm_dk("C04","Phá thai\\Số phá thai theo tuần\\trên 7 đến <= 12 tuần","","kh_dm_132_dk");
			upd_kh_dm_dk("C05","Phá thai\\Số phá thai theo tuần\\>12 tuần","","kh_dm_132_dk");
			upd_kh_dm_dk("C06","Phá thai\\Trong đó: vị thành niên","","kh_dm_132_dk");
			upd_kh_dm_dk("C07","Tai biến do nạo phá thai\\Số mắc","","kh_dm_132_dk");
			upd_kh_dm_dk("C08","Tai biến do nạo phá thai\\Số chết","","kh_dm_132_dk");
			//Biểu 12
			upd_kh_dm_dk("C01","Tổng số người mới thực hiện BPTT","","kh_dm_11_dk");
			upd_kh_dm_dk("C02","Trong đó\\Số mới đặt dụng cụ tử cung","","kh_dm_11_dk");
			upd_kh_dm_dk("C03","Trong đó\\Thuốc tránh thai\\Thuốc viên","","kh_dm_11_dk");
			upd_kh_dm_dk("C04","Trong đó\\Thuốc tránh thai\\Thuốc tiêm","","kh_dm_11_dk");
			upd_kh_dm_dk("C05","Trong đó\\Thuốc tránh thai\\Thuốc cấy","","kh_dm_11_dk");
			upd_kh_dm_dk("C06","Trong đó\\Bao cao su","","kh_dm_11_dk");
			upd_kh_dm_dk("C07","Trong đó\\Triệt sản mới\\Tổng số","","kh_dm_11_dk");
			upd_kh_dm_dk("C08","Trong đó\\Triệt sản mới\\\\Nữ","","kh_dm_11_dk");
			upd_kh_dm_dk("C09","Tai biến do thực hiện KHHGĐ\\Số mắc","","kh_dm_11_dk");
			upd_kh_dm_dk("C10","Tai biến do thực hiện KHHGĐ\\Số chết","","kh_dm_11_dk");
			//Biểu 13 
			upd_kh_dm_dk("C01","Số trẻ đẻ ra sống\\Tổng số","","kh_dm_09_dk");
			upd_kh_dm_dk("C02","Số trẻ đẻ ra sống\\Trong đó: Nữ","","kh_dm_09_dk");
			upd_kh_dm_dk("C03","Số trẻ được cân\\Tổng số","","kh_dm_09_dk");
			upd_kh_dm_dk("C04","Số trẻ được cân\\Trong đó: <2500g","","kh_dm_09_dk");
			upd_kh_dm_dk("C05","Chết thai nhi và chết trẻ em < 7 ngày\\Thai nhi chết từ 22 tuần đến khi đẻ","","kh_dm_09_dk");
			upd_kh_dm_dk("C06","Chết thai nhi và chết trẻ em < 7 ngày\\Số chết của trẻ em < 7 ngày tuổi","","kh_dm_09_dk");
			upd_kh_dm_dk("C07","Chết thai nhi và chết trẻ em < 7 ngày\\Số chết sơ sinh (<=28 ngày)","","kh_dm_09_dk");
			upd_kh_dm_dk("C08","Tỷ lệ SDD trẻ em < 5 tuổi (cân nặng/tuổi)","","kh_dm_09_dk");
			//Biểu 14 
			upd_kh_dm_dk("C01","Số trẻ<1 tuổi","","kh_dm_133_dk");
			upd_kh_dm_dk("C02","Số trẻ TCĐĐ 7 loại vắc xin","","kh_dm_133_dk");
			upd_kh_dm_dk("C03","Trong đó: BCG","","kh_dm_133_dk");
			upd_kh_dm_dk("C04","Trong đó: DPT","","kh_dm_133_dk");
			upd_kh_dm_dk("C05","Trong đó: OPV","","kh_dm_133_dk");
			upd_kh_dm_dk("C06","Trong đó: Viêm gan B","","kh_dm_133_dk");
			upd_kh_dm_dk("C07","Trong đó: Sởi","","kh_dm_133_dk");
			upd_kh_dm_dk("C08","Viêm não Nhật bản","","kh_dm_133_dk");
			upd_kh_dm_dk("C09","Tả","","kh_dm_133_dk");
			upd_kh_dm_dk("C10","Thương hàn","","kh_dm_133_dk");
			upd_kh_dm_dk("C11","Số phụ nữ có thai được tiêm UV2+","","kh_dm_133_dk");
			//Biểu 16.1 kh_dm_121_dk
			upd_kh_dm_dk("C01","Lần khám bệnh\\Tổng số","","kh_dm_121_dk");
			upd_kh_dm_dk("C02","Lần khám bệnh\\Trong đó: YHCT","","kh_dm_121_dk");
			upd_kh_dm_dk("C03","Lần khám bệnh\\Trong đó: TE<6 tuổi","","kh_dm_121_dk");
			upd_kh_dm_dk("C04","Khám dự phòng","","kh_dm_121_dk");
			upd_kh_dm_dk("C05","Số lượt điều trị nội trú\\Tổng số","","kh_dm_121_dk");
			upd_kh_dm_dk("C06","Số lượt điều trị nội trú\\Trong đó: YHCT","","kh_dm_121_dk");
			upd_kh_dm_dk("C07","Số lượt điều trị nội trú\\Trong đó: TE<6 tuổi","","kh_dm_121_dk");
			upd_kh_dm_dk("C08","Tổng số ngày điều trị nội trú","","kh_dm_121_dk");
			//Biểu 15 
			upd_kh_dm_dk("C01","Sởi\\M","","kh_dm_144_dk");
			upd_kh_dm_dk("C02","Sởi\\C","","kh_dm_144_dk");
			upd_kh_dm_dk("C03","Ho gà\\M","","kh_dm_144_dk");
			upd_kh_dm_dk("C04","Ho gà\\C","","kh_dm_144_dk");
			upd_kh_dm_dk("C05","LMC\\M","","kh_dm_144_dk");
			upd_kh_dm_dk("C06","LMC\\C","","kh_dm_144_dk");
			upd_kh_dm_dk("C07","Bạch hầu\\M","","kh_dm_144_dk");
			upd_kh_dm_dk("C08","Bạch hầu\\C","","kh_dm_144_dk");
			upd_kh_dm_dk("C09","UVSS\\M","","kh_dm_144_dk");
			upd_kh_dm_dk("C10","UVSS\\C","","kh_dm_144_dk");
			upd_kh_dm_dk("C11","UVkhác\\M","","kh_dm_144_dk");
			upd_kh_dm_dk("C12","UVkhác\\C","","kh_dm_144_dk");
			upd_kh_dm_dk("C13","Lao màng não\\M","","kh_dm_144_dk");
			upd_kh_dm_dk("C14","Lao màng não\\C","","kh_dm_144_dk");
			upd_kh_dm_dk("C15","Lao khác\\M","","kh_dm_144_dk");
			upd_kh_dm_dk("C16","Lao khác\\C","","kh_dm_144_dk");
			upd_kh_dm_dk("C17","Viêm gan vi rút\\M","","kh_dm_144_dk");
			upd_kh_dm_dk("C18","Viêm gan vi rút\\C","","kh_dm_144_dk");
			upd_kh_dm_dk("C19","Viêm não vi rút\\M","","kh_dm_144_dk");
			upd_kh_dm_dk("C20","Viêm não vi rút\\C","","kh_dm_144_dk");
			upd_kh_dm_dk("C21","Tả\\M","","kh_dm_144_dk");
			upd_kh_dm_dk("C22","Tả\\C","","kh_dm_144_dk");
			upd_kh_dm_dk("C23","Thương hàn\\M","","kh_dm_144_dk");
			upd_kh_dm_dk("C24","Thương hàn\\C","","kh_dm_144_dk");
			//Biểu 16.2 
			upd_kh_dm_dk("C01","Số lượt điều trị ngoại trú\\Tổng số","","kh_dm_122_dk");
			upd_kh_dm_dk("C02","Số lượt điều trị ngoại trú\\Trong đó: YHCT","","kh_dm_122_dk");
			upd_kh_dm_dk("C03","Số lượt điều trị ngoại trú\\Trong đó: TE<6 tuổi","","kh_dm_122_dk");
			upd_kh_dm_dk("C04","Số chết tại cơ sở y tế\\Tổng số","","kh_dm_122_dk");
			upd_kh_dm_dk("C05","Số chết tại cơ sở y tế\\Trong đó: Chết<1 tuổi","","kh_dm_122_dk");
			upd_kh_dm_dk("C06","Số chết tại cơ sở y tế\\Trong đó: Chết<5 tuổi","","kh_dm_122_dk");
			upd_kh_dm_dk("C07","Số lần xét nghiệm","","kh_dm_122_dk");
			upd_kh_dm_dk("C08","Số lần chụp X quang","","kh_dm_122_dk");
			upd_kh_dm_dk("C09","Số lần chụp cắt lớp","","kh_dm_122_dk");
			upd_kh_dm_dk("C10","Số lần siêu âm","","kh_dm_122_dk");
			upd_kh_dm_dk("C11","Tổng số phẫu thuật","","kh_dm_122_dk");
			//Biểu 17 
			upd_kh_dm_dk("C01","Số lượng","","kh_dm_131_dk");
			upd_kh_dm_dk("C24","Ghi chú","","kh_dm_131_dk");

			execute_data("delete from kh_dm_131");
			upd_kh_dm(0,"I","Phòng Chống Lao","kh_dm_131");
			upd_kh_dm(1,"1","Tổng số BN được thu nhận","kh_dm_131");
			upd_kh_dm(2,"2","Số BN lao phổi AFB(+)","kh_dm_131");
			upd_kh_dm(3," ","Trong đó: - Mới","kh_dm_131");
			upd_kh_dm(4," ","		- Tái phát","kh_dm_131");
			upd_kh_dm(5," ","		- Thất bại","kh_dm_131");
			upd_kh_dm(6," ","		- Điều trị lại","kh_dm_131");
			upd_kh_dm(7,"3","Lao phổi AFB(-)","kh_dm_131");
			upd_kh_dm(8,"4","Bệnh nhân Lao ngoài phổi","kh_dm_131");
			upd_kh_dm(9,"5","Khác","kh_dm_131");
			upd_kh_dm(10,"6","Kết quả điều trị Lao phổi AFB(+) mới","kh_dm_131");
			upd_kh_dm(11," ","Trong đó: - Điều trị thành công","kh_dm_131");
			upd_kh_dm(12," ","			-Số chết","kh_dm_131");
			upd_kh_dm(13,"II","Phòng chống Sốt rét","kh_dm_131");
			upd_kh_dm(14,"1","Số bệnh nhân được xét nghiệm sốt rét","kh_dm_131");
			upd_kh_dm(15," ","Trong đó: Số có KSTRT","kh_dm_131");
			upd_kh_dm(16,"2","Tổng số bệnh nhân SR","kh_dm_131");
			upd_kh_dm(17," "," - Số BNSR được xét nghiệm","kh_dm_131");
			upd_kh_dm(18," "," - Số BN sốt rét ngoại tỉnh","kh_dm_131");
			upd_kh_dm(19,"3","Số bệnh nhân sốt rét thường","kh_dm_131");
			upd_kh_dm(20," ","Trong đó: Trẻ em < 5 tuổi","kh_dm_131");
			upd_kh_dm(21," ","			Trẻ em 5 - 14 tuổi","kh_dm_131");
			upd_kh_dm(22," ","			Phụ nữ có thai","kh_dm_131");
			upd_kh_dm(23,"4","Số BNSR có KST","kh_dm_131");
			upd_kh_dm(24," ","Trong đó: Trẻ em < 5 tuổi","kh_dm_131");
			upd_kh_dm(25," ","			Trẻ em 5 - 14 tuổi","kh_dm_131");
			upd_kh_dm(26," ","			Phụ nữ có thai","kh_dm_131");
			upd_kh_dm(27,"5","Số bệnh nhân SRAT","kh_dm_131");
			upd_kh_dm(28," "," - Trong đó: Trẻ em < 5 tuổi","kh_dm_131");
			upd_kh_dm(29," ","			Trẻ em 5 - 14 tuổi","kh_dm_131");
			upd_kh_dm(30," ","			Phụ nữ có thai","kh_dm_131");
			upd_kh_dm(31," "," - Số BNSRAT có KST","kh_dm_131");
			upd_kh_dm(32,"6","Số BN chết sốt rét","kh_dm_131");
			upd_kh_dm(33," ","Trong đó: Trẻ em < 5 tuổi","kh_dm_131");
			upd_kh_dm(34," ","			Trẻ em 5 - 14 tuổi","kh_dm_131");
			upd_kh_dm(35," ","			Phụ nữ có thai","kh_dm_131");
			upd_kh_dm(36,"III","Phòng chống HIV/AIDS","kh_dm_131");
			upd_kh_dm(37,"1","Số hiện mắc HIV","kh_dm_131");
			upd_kh_dm(38," ","Trong đó: Nữ","kh_dm_131");
			upd_kh_dm(39," ","			Số mới phát hiện HIV","kh_dm_131");
			upd_kh_dm(40,"2","Số hiện mắc AIDS","kh_dm_131");
			upd_kh_dm(41," ","Trong đó: Nữ","kh_dm_131");
			upd_kh_dm(42," ","			Số mới chuyển sang AIDS","kh_dm_131");
			upd_kh_dm(43,"3","Số chết do bị AIDS","kh_dm_131");
			upd_kh_dm(44,"IV","Sức khỏe Tâm thần","kh_dm_131");
			upd_kh_dm(45,"1","Số hiện mắc động kinh","kh_dm_131");
			upd_kh_dm(46," ","Số bệnh nhân đã quản lý","kh_dm_131");
			upd_kh_dm(47," ","Trong đó: Số mới","kh_dm_131");
			upd_kh_dm(48," ","			Số đang điều trị < 5 tuổi","kh_dm_131");
			upd_kh_dm(49," ","			Số tử vong","kh_dm_131");
			upd_kh_dm(50,"V","Phòng chống Hoa liễu","kh_dm_131");
			upd_kh_dm(43,"1","Số bệnh nhân lậu mới phát hiện trong kỳ","kh_dm_131");
			upd_kh_dm(44," ","Trong đó: Lậu mắt trẻ sơ sinh","kh_dm_131");
			upd_kh_dm(45,"2","Số bệnh giang mai mới phát hiện","kh_dm_131");
			upd_kh_dm(46," ","Trong đó: Giang mai bẩm sinh","kh_dm_131");
			upd_kh_dm(47,"VI","Phòng chống bệnh Phong","kh_dm_131");
			upd_kh_dm(48,"1","Số bệnh nhân hiện mắc bệnh phong","kh_dm_131");
			upd_kh_dm(49," ","Trong đó: Số bệnh nhân mới phát hiện","kh_dm_131");
			upd_kh_dm(50," ","Số bệnh nhân Phong mới bị tàn tật độ II","kh_dm_131");
			//Biểu 18
			upd_kh_dm_dk("C01","Tả\\M","","kh_dm_141_dk");
			upd_kh_dm_dk("C02","Tả\\C","","kh_dm_141_dk");
			upd_kh_dm_dk("C03","Thương hàn\\M","","kh_dm_141_dk");
			upd_kh_dm_dk("C04","Thương hàn\\C","","kh_dm_141_dk");
			upd_kh_dm_dk("C05","Ly trực trùng\\M","","kh_dm_141_dk");
			upd_kh_dm_dk("C06","Ly trực trùng\\C","","kh_dm_141_dk");
			upd_kh_dm_dk("C07","Lỵ A mip\\M","","kh_dm_141_dk");
			upd_kh_dm_dk("C08","Lỵ A mip\\C","","kh_dm_141_dk");
			upd_kh_dm_dk("C09","Hội chứng lỵ\\M","","kh_dm_141_dk");
			upd_kh_dm_dk("C10","Hội chứng lỵ\\C","","kh_dm_141_dk");
			upd_kh_dm_dk("C11","Tiêu chảy\\M","","kh_dm_141_dk");
			upd_kh_dm_dk("C12","Tiêu chảy\\C","","kh_dm_141_dk");
			upd_kh_dm_dk("C13","Viêm não vi rút\\M","","kh_dm_141_dk");
			upd_kh_dm_dk("C14","Viêm não vi rút\\C","","kh_dm_141_dk");
			upd_kh_dm_dk("C15","Sốt xuất huyết\\M","","kh_dm_141_dk");
			upd_kh_dm_dk("C16","Sốt xuất huyết\\C","","kh_dm_141_dk");
			upd_kh_dm_dk("C17","B. Chân - Tay - Miệng\\M","","kh_dm_141_dk");
			upd_kh_dm_dk("C18","B. Chân - Tay - Miệng\\C","","kh_dm_141_dk");
			upd_kh_dm_dk("C19","Viêm gan vi rút\\M","","kh_dm_141_dk");
			upd_kh_dm_dk("C20","Viêm gan vi rút\\C","","kh_dm_141_dk");
			upd_kh_dm_dk("C21","Dại và nghi dại\\M","","kh_dm_141_dk");
			upd_kh_dm_dk("C22","Dại và nghi dại\\C","","kh_dm_141_dk");
			upd_kh_dm_dk("C23","Viêm màng não mô cầu\\M","","kh_dm_141_dk");
			upd_kh_dm_dk("C24","Viêm màng não mô cầu\\C","","kh_dm_141_dk");
			upd_kh_dm_dk("C25","Thủy đậu\\M","","kh_dm_141_dk");
			upd_kh_dm_dk("C26","Thủy đậu\\C","","kh_dm_141_dk");
			upd_kh_dm_dk("C27","Uốn ván\\M","","kh_dm_141_dk");
			upd_kh_dm_dk("C28","Uốn ván\\C","","kh_dm_141_dk");
			upd_kh_dm_dk("C29","Quai bị\\M","","kh_dm_141_dk");
			upd_kh_dm_dk("C30","Quai bị\\C","","kh_dm_141_dk");
			upd_kh_dm_dk("C31","Viêm đường\\M","","kh_dm_141_dk");
			upd_kh_dm_dk("C32","Viêm đường\\C","","kh_dm_141_dk");
			upd_kh_dm_dk("C33","Viêm phế quản\\M","","kh_dm_141_dk");
			upd_kh_dm_dk("C34","Viêm phế quản\\C","","kh_dm_141_dk");
			upd_kh_dm_dk("C35","Viêm phổi\\M","","kh_dm_141_dk");
			upd_kh_dm_dk("C36","Viêm phổi\\C","","kh_dm_141_dk");
			upd_kh_dm_dk("C37","Cúm A(H5N1)\\M","","kh_dm_141_dk");
			upd_kh_dm_dk("C38","Cúm A(H5N1)\\C","","kh_dm_141_dk");
			upd_kh_dm_dk("C39","Cúm A(H1N1)\\M","","kh_dm_141_dk");
			upd_kh_dm_dk("C40","Cúm A(H1N1)\\C","","kh_dm_141_dk"); 
			upd_kh_dm_dk("C41","Dịch hạch\\M","","kh_dm_141_dk");
			upd_kh_dm_dk("C42","Dịch hạch\\C","","kh_dm_141_dk");
			upd_kh_dm_dk("C43","Lepto\\M","","kh_dm_141_dk");
			upd_kh_dm_dk("C44","Lepto\\C","","kh_dm_141_dk");
			upd_kh_dm_dk("C45","Tai nạn, ngộ độc, chấn thương các loại\\Tự tử\\M","","kh_dm_141_dk");
			upd_kh_dm_dk("C46","Tai nạn, ngộ độc, chấn thương các loại\\Tự tử\\C","","kh_dm_141_dk");
			upd_kh_dm_dk("C47","Tai nạn, ngộ độc, chấn thương các loại\\Ngộ độc TP\\M","","kh_dm_141_dk");
			upd_kh_dm_dk("C48","Tai nạn, ngộ độc, chấn thương các loại\\Ngộ độc TP\\C","","kh_dm_141_dk");
			upd_kh_dm_dk("C49","Tai nạn, ngộ độc, chấn thương các loại\\TNGT\\M","","kh_dm_141_dk");
			upd_kh_dm_dk("C50","Tai nạn, ngộ độc, chấn thương các loại\\TNGT\\C","","kh_dm_141_dk");
			upd_kh_dm_dk("C51","Tai nạn, ngộ độc, chấn thương các loại\\TNLĐ\\M","","kh_dm_141_dk");
			upd_kh_dm_dk("C52","Tai nạn, ngộ độc, chấn thương các loại\\TNLĐ\\C","","kh_dm_141_dk");
			upd_kh_dm_dk("C53","Tai nạn, ngộ độc, chấn thương các loại\\NĐ h/chất\\M","","kh_dm_141_dk");
			upd_kh_dm_dk("C54","Tai nạn, ngộ độc, chấn thương các loại\\NĐ h/chất\\C","","kh_dm_141_dk");
			upd_kh_dm_dk("C55","Tai nạn, ngộ độc, chấn thương các loại\\TN khác\\M","","kh_dm_141_dk");
			upd_kh_dm_dk("C56","Tai nạn, ngộ độc, chấn thương các loại\\TN khác\\C","","kh_dm_141_dk");
			//Biểu 19
			upd_kh_dm_dk("C01","Tại khoa khám bệnh\\Tổng số","","kh_dm_15_dk");
			upd_kh_dm_dk("C02","Tại khoa khám bệnh\\Trong đó: Nữ","","kh_dm_15_dk");
			upd_kh_dm_dk("C03","Tại khoa khám bệnh\\Trong đó: TE<15","","kh_dm_15_dk");
			upd_kh_dm_dk("C04","Tại khoa khám bệnh\\Trong đó: Số tử vong","","kh_dm_15_dk");
			upd_kh_dm_dk("C05","Điều trị nội trú\\Tổng số\\Mắc\\TS","","kh_dm_15_dk");
			upd_kh_dm_dk("C06","Điều trị nội trú\\Tổng số\\Mắc\\Nữ","","kh_dm_15_dk");
			upd_kh_dm_dk("C07","Điều trị nội trú\\Tổng số\\Số tử vong\\TS","","kh_dm_15_dk");
			upd_kh_dm_dk("C08","Điều trị nội trú\\Tổng số\\Số tử vong\\Nữ","","kh_dm_15_dk");
			upd_kh_dm_dk("C09","Điều trị nội trú\\Trong đó TE<15 tuổi\\Mắc\\TS","","kh_dm_15_dk");
			upd_kh_dm_dk("C10","Điều trị nội trú\\Trong đó TE<15 tuổi\\Mắc\\<5 tuổi","","kh_dm_15_dk");
			upd_kh_dm_dk("C11","Điều trị nội trú\\Trong đó TE<15 tuổi\\Số tử vong\\TS","","kh_dm_15_dk");
			upd_kh_dm_dk("C12","Điều trị nội trú\\Trong đó TE<15 tuổi\\Số tử vong\\<5 tuổi","","kh_dm_15_dk");
			//
			
		}
		#endregion
		//linh 17022012
		public bool ApDungQuanLyBHYTTraiTuyenTuNhanNgay15022012
		{
			get
			{
				try
				{
					return get_data("select ten from thongso where id=1153").Tables[0].Rows[0][0].ToString()=="1";
				}
				catch
				{
					return false;
				}
			}
		}
		public const string NgayApDungBHYTTraiTuyenTuNhan15022012="15/02/2012";
		// Thanh Cường - 24/05/2013 - đọc file excle -> dataset
		public DataSet get_excel(string fileName)
		{
			OleDbConnection con = this.ReturnConnection(fileName);
			con.Open();
			OleDbCommand cmd = new OleDbCommand("SELECT * FROM [Sheet1$]", con);
			OleDbDataAdapter dest = new OleDbDataAdapter();
			dest.SelectCommand = cmd;
			DataSet ds = new DataSet();
			dest.Fill(ds);
			cmd.Dispose();
			con.Close();
			return ds;
		}
		private OleDbConnection ReturnConnection(string fileName)
		{
			return new OleDbConnection("Provider=Microsoft.Jet.OLEDB.4.0;" +
				"Data Source=" + fileName + ";" +
				" Jet OLEDB:Engine Type=5;Extended Properties=\"Excel 8.0;\"");
		}
		public bool upd_tenvien(string m_mabv,string m_tenbv)
		{
			sql="insert into dmnoicapbhyt (mabv,tenbv) values (:m_mabv,:m_tenbv)";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_mabv",OracleType.VarChar,9).Value=m_mabv;
				cmd.Parameters.Add("m_tenbv",OracleType.NVarChar,100).Value=m_tenbv;
				cmd.ExecuteNonQuery();
				cmd.Dispose();
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"dmnoicapbhyt");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}
		//end
		public bool updmbankham(int m_id,string m_ma,string m_ten,string m_makp)
		{
			sql="update dmbankham set ma=:m_ma,ten=:m_ten,makp=:m_makp where id=:m_id";
			con=new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd=new OracleCommand(sql,con);
				cmd.CommandType=CommandType.Text;
				cmd.Parameters.Add("m_ma",OracleType.NVarChar,6).Value=m_ma;
				cmd.Parameters.Add("m_ten",OracleType.NVarChar,254).Value=m_ten;
				cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
				cmd.Parameters.Add("m_makp",OracleType.NVarChar,2).Value=m_makp;
				int irec=cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec==0)
				{
					sql="insert into dmbankham (id,ma,ten,makp) values (:m_id,:m_ma,:m_ten,:m_makp)";
					cmd=new OracleCommand(sql,con);
					cmd.CommandType=CommandType.Text;
					cmd.Parameters.Add("m_id",OracleType.Number).Value=m_id;
					cmd.Parameters.Add("m_ma",OracleType.NVarChar,6).Value=m_ma;
					cmd.Parameters.Add("m_ten",OracleType.NVarChar,254).Value=m_ten;
					cmd.Parameters.Add("m_makp",OracleType.NVarChar,2).Value=m_makp;
					irec=cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch(OracleException ex)
			{
				upd_error(ex.Message,sComputer,"dmbankham");
				return false;
			}
			finally
			{
				con.Close();con.Dispose();
			}		
			return true;
		}

		#region QRCode - thanhcuong
		public bool upd_bhyt_qrcode(string m_sothe, string m_hoten, string m_ngaysinh, int m_gioitinh, string m_diachi, string m_mabv, string m_tungay, string m_denngay, string m_ngaycap, string m_maql_bhxh, string m_makiemtra_bhxh, int m_userid, string m_mabn)
		{
			sql = "update bhyt_qrcode set hoten=:m_hoten, ngaysinh=to_date(:m_ngaysinh,'dd/mm/yyyy'), gioitinh=:m_gioitinh, diachi=:m_diachi, ngaycap=to_date(:m_ngaycap,'dd/mm/yyyy'), maql_bhxh=:m_maql_bhxh, makiemtra_bhxh=:m_makiemtra_bhxh, userid=" + m_userid;
			sql += " where sothe='" + m_sothe + "' and to_char(tungay,'dd/mm/yyyy')='" + m_tungay + "' and to_char(denngay,'dd/mm/yyyy')='" + m_denngay + "' and mabv='" + m_mabv + "' and mabn='"+m_mabn +"'";
			if (con != null)
			{
				con.Close(); con.Dispose();
			}
			con = new OracleConnection(sConn);
			try
			{
				con.Open();
				cmd = new OracleCommand(sql, con);
				cmd.CommandType = CommandType.Text;
				cmd.Parameters.Add("m_hoten", OracleType.NVarChar).Value = m_hoten;
				cmd.Parameters.Add("m_ngaysinh", OracleType.NVarChar, 10).Value = m_ngaysinh;
				cmd.Parameters.Add("m_gioitinh", OracleType.Number).Value = m_gioitinh;
				cmd.Parameters.Add("m_diachi", OracleType.NVarChar).Value = m_diachi;
				cmd.Parameters.Add("m_ngaycap", OracleType.NVarChar, 10).Value = m_ngaycap;
				cmd.Parameters.Add("m_maql_bhxh", OracleType.NVarChar, 30).Value = m_maql_bhxh;
				cmd.Parameters.Add("m_makiemtra_bhxh", OracleType.NVarChar, 30).Value = m_makiemtra_bhxh;                
				int irec = cmd.ExecuteNonQuery();
				cmd.Dispose();
				if (irec == 0)
				{
					sql = "insert into bhyt_qrcode(sothe, ngaysinh, gioitinh, mabv,tungay, denngay, ngaycap, userid, mabn, hoten, diachi, maql_bhxh, makiemtra_bhxh) ";
					sql += " values('" + m_sothe + "', to_date('" + m_ngaysinh + "','dd/mm/yyyy'), " + m_gioitinh + ", '" + m_mabv + "', to_date('" + m_tungay + "','dd/mm/yyyy'), to_date('" + m_denngay + "','dd/mm/yyyy'), to_date('" + m_ngaycap + "','dd/mm/yyyy'), " + m_userid + ",'" + m_mabn + "',:m_hoten, :m_diachi, :m_maql_bhxh, :m_makiemtra_bhxh)";
					cmd = new OracleCommand(sql, con);
					cmd.CommandType = CommandType.Text;
					cmd.Parameters.Add("m_hoten", OracleType.NVarChar).Value = m_hoten;                  
					cmd.Parameters.Add("m_diachi", OracleType.NVarChar).Value = m_diachi;                    
					cmd.Parameters.Add("m_maql_bhxh", OracleType.NVarChar, 30).Value = m_maql_bhxh;
					cmd.Parameters.Add("m_makiemtra_bhxh", OracleType.NVarChar, 30).Value = m_makiemtra_bhxh;    
					irec = cmd.ExecuteNonQuery();
					cmd.Dispose();
				}
			}
			catch (OracleException ex)
			{
				upd_error(ex.Message,sComputer,"bhyt_qrcode");
				return false;
			}
			finally
			{

				con.Close(); con.Dispose();
			}
			return true;
		}
        #endregion

		public int iNhomvptienan
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from thongso where id=1176");
					return int.Parse(ds.Tables[0].Rows[0][0].ToString());
				}
				catch{return 0;}
			}
		}
		public string TenNhomvptienan
		{
			get
			{
				try
				{
					DataSet ds=get_data("select ten from v_nhomvp where ma in(select ten from thongso where id=1176)");
					return ds.Tables[0].Rows[0][0].ToString();
				}
				catch{return "";}
			}
		}//
		public decimal dTienAn
		{
			get
			{
				try
				{
					this.ds = get_data("select ten from thongso where id=1177");
					return decimal.Parse(ds.Tables[0].Rows[0][0].ToString().Trim());
				}
				catch
				{
					return 0;
				}
			}
		}
	}
	public class Goisothuthu
	{
		[DllImport("winmm.dll", SetLastError = true, CallingConvention = CallingConvention.Winapi)]
		static extern bool PlaySound(string pszSound,
			IntPtr hMod, SoundFlags sf);
		[Flags]
			public enum SoundFlags : int
		{
			SND_SYNC = 0x0000,  /* play synchronously (default) */
			SND_ASYNC = 0x0001,  /* play asynchronously */
			SND_NODEFAULT = 0x0002,  /* silence (!default) if sound not found */
			SND_MEMORY = 0x0004,  /* pszSound points to a memory file */
			SND_LOOP = 0x0008,  /* loop the sound until next sndPlaySound */
			SND_NOSTOP = 0x0010,  /* don't stop any currently playing sound */
			SND_NOWAIT = 0x00002000, /* don't wait if the driver is busy */
			SND_ALIAS = 0x00010000, /* name is a registry alias */
			SND_ALIAS_ID = 0x00110000, /* alias is a predefined ID */
			SND_FILENAME = 0x00020000, /* name is file name */
			SND_RESOURCE = 0x00040004  /* name is resource name or atom */
		}
		string chuoiso="";
		string quayso="";
		AccessData m = new AccessData();
		string sComputer="";
		string ngay="";int id=0;string s1="";string s2="";bool update=false;
		public Goisothuthu(string _ngay,int _id,string _s1,string _s2,bool _update)
		{
			ngay=_ngay;id=_id;s1=_s1;s2=_s2;update=_update;	
			sComputer=System.Environment.MachineName.Trim().ToUpper();
		}
		public void docso()
		{
			ArrayList m_afile = new ArrayList();
			char num0 = '0', num1 = '0', num2 = '0', num3 = '0';
			string[] so ={ "0", "1", "2", "3", "4", "5", "6", "7", "8", "9" };
			if (chuoiso.Length == 4) { num0 = chuoiso[0]; num1 = chuoiso[1]; num2 = chuoiso[2]; num3 = chuoiso[3]; }
			if (chuoiso.Length == 3) { num0 = '0'; num1 = chuoiso[0]; num2 = chuoiso[1]; num3 = chuoiso[2]; }
			if (chuoiso.Length == 2) { num0 = '0'; num1 = '0'; num2 = chuoiso[0]; num3 = chuoiso[1]; }
			if (chuoiso.Length == 1) { num0 = '0'; num1 = '0'; num2 = '0'; num3 = chuoiso[0]; }
			m_afile.Add("..//..//..//AMTHANHSO//ding_dong.wav");
			m_afile.Add("..//..//..//AMTHANHSO//moi_benh_nhan.wav");
			if (chuoiso.Length == 4)
			{
				m_afile.Add("..//..//..//AMTHANHSO//" + num0.ToString() + ".wav");
				m_afile.Add("..//..//..//AMTHANHSO//" + num1.ToString() + ".wav");
				m_afile.Add("..//..//..//AMTHANHSO//" + num2.ToString() + ".wav");
				m_afile.Add("..//..//..//AMTHANHSO//" + num3.ToString() + ".wav");

			}
			if (chuoiso.Length == 3)
			{
				m_afile.Add("..//..//..//AMTHANHSO//" + num0.ToString() + ".wav");
				m_afile.Add("..//..//..//AMTHANHSO//" + num1.ToString() + ".wav");
				m_afile.Add("..//..//..//AMTHANHSO//" + num2.ToString() + ".wav");

			}
			if (chuoiso.Length == 2)
			{
				m_afile.Add("..//..//..//AMTHANHSO//" + num0.ToString() + ".wav");
				m_afile.Add("..//..//..//AMTHANHSO//" + num1.ToString() + ".wav");
			}
			if (chuoiso.Length == 1)
			{
				m_afile.Add("..//..//..//AMTHANHSO//" + num0.ToString() + ".wav");
			}
			m_afile.Add("..//..//..//AMTHANHSO//denquayso.wav");//denquayso
			m_afile.Add("..//..//..//AMTHANHSO//" + quayso + ".wav");//denquayso
			if (m_afile.Count > 0)
			{
				foreach (string t in m_afile.ToArray())
				{
					// PlaySound(t, 0, 1);
					PlaySound(@t, IntPtr.Zero,
						SoundFlags.SND_FILENAME | SoundFlags.SND_NOWAIT);
				}
			}
		}

		private void Play(string num)
		{
			ArrayList m_afile = new ArrayList();
			char num0 = '0', num1 = '0', num2 = '0', num3 = '0';
			//linh
			string[] so ={ "0", "1", "2", "3", "4", "5", "6", "7", "8", "9" };
			//num = num.TrimStart("0".ToCharArray());
			//end
			bool bChucngantram = m.bChuctramngan;
			m_afile.Clear();
			int delay = 0;
			if (num.Length == 4) { num0 = num[0]; num1 = num[1]; num2 = num[2]; num3 = num[3]; }
			if (num.Length == 3) { num0 = '0'; num1 = num[0]; num2 = num[1]; num3 = num[2]; }
			if (num.Length == 2) { num0 = '0'; num1 = '0'; num2 = num[0]; num3 = num[1]; }
			if (num.Length == 1) { num0 = '0'; num1 = '0'; num2 = '0'; num3 = num[0]; }

			if (!bChucngantram)
			{
				for (int i = 0; i < num.Length; i++)
				{
					m_afile.Add("..//..//..//data//num//s" + so[int.Parse(num[i].ToString())] + ".wav");
				}
				//if (num.Length == 4) m_afile.Add("..//..//..//data//num//s" + num0.ToString() + ".wav");
				//if (num.Length >= 3) m_afile.Add("..//..//..//data//num//s" + num1.ToString() + ".wav");
				//if (num.Length >= 2) m_afile.Add("..//..//..//data//num//s" + num2.ToString() + ".wav");
				//if (num.Length >= 1) m_afile.Add("..//..//..//data//num//s" + num3.ToString() + ".wav");
			}
				//end linh
			else
			{
				if (num.Length == 4)
				{
					m_afile.Add("..//..//..//data//num//s" + num0.ToString() + ".wav");
					m_afile.Add("..//..//..//data//num//sg.wav");
				}
				if (num.Length >= 3)
				{
					if (num1 != '0' || num2 != '0' || num3 != '0')
					{
						m_afile.Add("..//..//..//data//num//s" + num1.ToString() + ".wav");
						m_afile.Add("..//..//..//data//num//sa.wav");
					}
				}
				if (num.Length >= 2)
				{
					if (num2 != '0')
					{
						if (num2 == '1')
						{
							m_afile.Add("..//..//..//data//num//sb.wav");
						}
						else
						{
							m_afile.Add("..//..//..//data//num//s" + num2.ToString() + ".wav");
							m_afile.Add("..//..//..//data//num//sc.wav");
						}
					}
					else
					{
						if (num3 != '0')
						{
							m_afile.Add("..//..//..//data//num//sf.wav");
						}
					}
				}
				if (num.Length >= 1)
				{
					if (num3 != '0')
					{
						if (num3 == '1' && num2 > '1')
						{
							m_afile.Add("..//..//..//data//num//sd.wav");
						}
						else if (num3 == '5' && num2 != '0')
						{
							m_afile.Add("..//..//..//data//num//se.wav");
						}
						else
						{
							m_afile.Add("..//..//..//data//num//s" + num3.ToString() + ".wav");
						}
					}
				}
			}
			if (m_afile.Count > 0)
			{
				foreach (string t in m_afile.ToArray())
				{
					//System.Threading.Thread.Sleep(delay);
					PlaySound(t, IntPtr.Zero,
						SoundFlags.SND_FILENAME | SoundFlags.SND_NOWAIT);
				}
			}
		}
		public void goi_dangky()
		{			
			string s=m.Hoten_khongdau(sComputer).Trim();
			//int d1 = _delay1, d2 = _delay2, d3 = _delay3, d4 = _delay4,d5=_delay6;
			if (s1 == s2)
			{
				//PlaySound("..\\..\\..\\data\\lyric\\m4.wav", 0, 1);
				//System.Threading.Thread.Sleep(d2);
				PlaySound("..\\..\\..\\data\\lyric\\m4.wav", IntPtr.Zero,
					SoundFlags.SND_FILENAME | SoundFlags.SND_NOWAIT);

				Play(s1);
				//System.Threading.Thread.Sleep(d4);
				PlaySound("..\\..\\..\\data\\lyric\\m3.wav", IntPtr.Zero,
					SoundFlags.SND_FILENAME | SoundFlags.SND_NOWAIT);
				if (System.IO.File.Exists("..\\..\\..\\data\\td\\" + s + ".wav"))
				{
					//System.Threading.Thread.Sleep(d5);
					PlaySound("..\\..\\..\\data\\td\\" + s + ".wav", IntPtr.Zero,
						SoundFlags.SND_FILENAME | SoundFlags.SND_NOWAIT);
				}
			}
			else
			{
				PlaySound("..\\..\\..\\data\\lyric\\m1.wav", IntPtr.Zero,
					SoundFlags.SND_FILENAME | SoundFlags.SND_NOWAIT);
				//System.Threading.Thread.Sleep(d1);
				Play(s1);
				//System.Threading.Thread.Sleep(d2);
				PlaySound("..\\..\\..\\data\\lyric\\m2.wav", IntPtr.Zero,
					SoundFlags.SND_FILENAME | SoundFlags.SND_NOWAIT);
				//System.Threading.Thread.Sleep(d3);
				Play(s2);
				//System.Threading.Thread.Sleep(d4);
				PlaySound("..\\..\\..\\data\\lyric\\m3.wav", IntPtr.Zero,
					SoundFlags.SND_FILENAME | SoundFlags.SND_NOWAIT);
				if (System.IO.File.Exists("..\\..\\..\\data\\td\\" +  s + ".wav"))
				{
					//System.Threading.Thread.Sleep(d5);
					PlaySound("..\\..\\..\\data\\td\\" +  s + ".wav", IntPtr.Zero,
						SoundFlags.SND_FILENAME | SoundFlags.SND_NOWAIT);
				}
			}
			if (update) {m.upd_stttiepdon(id, ngay, long.Parse(s2));}
		}
		
	}
}
